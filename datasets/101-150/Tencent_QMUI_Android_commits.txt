File: qmui/src/main/java/com/qmuiteam/qmui/util/QMUINotchHelper.java
Patch:
@@ -280,7 +280,7 @@ private static void getOfficialSafeInsetRect(View view, Rect out) {
         if(rootWindowInsets == null){
             return;
         }
-        Insets cutoutInsets = rootWindowInsets.getInsets(WindowInsetsCompat.Type.systemBars() | WindowInsetsCompat.Type.displayCutout());
+        Insets cutoutInsets = rootWindowInsets.getInsets(WindowInsetsCompat.Type.statusBars() | WindowInsetsCompat.Type.displayCutout());
         out.set(cutoutInsets.left, cutoutInsets.top, cutoutInsets.right, cutoutInsets.bottom);
     }
 

File: qmui/src/main/java/com/qmuiteam/qmui/skin/QMUISkinLayoutInflaterFactory.java
Patch:
@@ -15,6 +15,7 @@
  */
 package com.qmuiteam.qmui.skin;
 
+import android.annotation.SuppressLint;
 import android.app.Activity;
 import android.content.Context;
 import android.content.res.Resources;
@@ -95,7 +96,7 @@ public View onCreateView(View parent, String name, Context context, AttributeSet
                         }
                     }
                 }else{
-                    if(Build.VERSION.SDK_INT >= Build.VERSION_CODES.P){
+                    if(Build.VERSION.SDK_INT >= Build.VERSION_CODES.Q){
                         if(!sDidCheckLayoutInflaterCreateViewExitFourArgMethod){
                             try{
                                 LayoutInflater.class.getDeclaredMethod(
@@ -136,7 +137,7 @@ public View onCreateView(View parent, String name, Context context, AttributeSet
     private View originCreateViewForLowSDK(String name, Context context, AttributeSet attrs)
             throws NoSuchFieldException, IllegalArgumentException,
             IllegalAccessException, InflateException, ClassNotFoundException {
-        Field field = LayoutInflater.class.getDeclaredField("mConstructorArgs");
+        @SuppressLint("SoonBlockedPrivateApi") Field field = LayoutInflater.class.getDeclaredField("mConstructorArgs");
         field.setAccessible(true);
         Object[] mConstructorArgs = (Object[]) field.get(mOriginLayoutInflater);
         Object lastContext = mConstructorArgs[0];

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUICollapsingTopBarLayout.java
Patch:
@@ -1142,7 +1142,7 @@ public static class LayoutParams extends FrameLayout.LayoutParams {
                 COLLAPSE_MODE_PARALLAX
         })
         @Retention(RetentionPolicy.SOURCE)
-        @interface CollapseMode {
+        public @interface CollapseMode {
         }
 
         /**

File: qmui/src/main/java/com/qmuiteam/qmui/widget/popup/QMUINormalPopup.java
Patch:
@@ -60,7 +60,7 @@ public class QMUINormalPopup<T extends QMUIBasePopup> extends QMUIBasePopup<T> {
     public static final int ANIM_SPEC = 4;
 
     @IntDef(value = {ANIM_AUTO, ANIM_GROW_FROM_LEFT, ANIM_GROW_FROM_RIGHT, ANIM_GROW_FROM_CENTER, ANIM_SPEC})
-    @interface AnimStyle {
+    public @interface AnimStyle {
     }
 
     public static final int DIRECTION_TOP = 0;

File: qmui/src/main/java/com/qmuiteam/qmui/widget/pullLayout/QMUIPullLayout.java
Patch:
@@ -1022,6 +1022,7 @@ public final static class PullAction {
         private final float mPullRate;
         private final float mReceivedFlingFraction;
         private final int mActionInitOffset;
+        @PullEdge
         private final int mPullEdge;
         private final float mScrollSpeedPerPixel;
         private final boolean mNeedReceiveFlingFromTargetView;
@@ -1037,7 +1038,7 @@ public final static class PullAction {
                    boolean isTargetCanOverPull,
                    float targetPullRate,
                    int actionInitOffset,
-                   int pullEdge,
+                   @PullEdge int pullEdge,
                    float scrollSpeedPerPixel,
                    boolean needReceiveFlingFromTargetView,
                    float receivedFlingFraction,
@@ -1107,6 +1108,7 @@ public boolean isCanOverPull() {
             return mCanOverPull;
         }
 
+        @PullEdge
         public int getPullEdge() {
             return mPullEdge;
         }

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/home/HomeFragment.java
Patch:
@@ -69,13 +69,13 @@ public boolean isViewFromObject(View view, Object object) {
         }
 
         @Override
-        public int PageCount() {
+        public int getCount() {
             return mPages.size();
         }
 
         @Override
         public Object instantiateItem(final ViewGroup container, int position) {
-            HomeController page = mPages.get(Pager.getPagerFromPositon(position));
+            HomeController page = mPages.get(Pager.getPagerFromPosition(position));
             ViewGroup.LayoutParams params = new ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);
             container.addView(page, params);
             return page;

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/home/HomeFragment.java
Patch:
@@ -69,13 +69,13 @@ public boolean isViewFromObject(View view, Object object) {
         }
 
         @Override
-        public int PageCount() {
+        public int getCount() {
             return mPages.size();
         }
 
         @Override
         public Object instantiateItem(final ViewGroup container, int position) {
-            HomeController page = mPages.get(Pager.getPagerFromPositon(position));
+            HomeController page = mPages.get(Pager.getPagerFromPosition(position));
             ViewGroup.LayoutParams params = new ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);
             container.addView(page, params);
             return page;

File: qmui/src/main/java/com/qmuiteam/qmui/widget/popup/QMUINormalPopup.java
Patch:
@@ -459,7 +459,7 @@ private void adjustShowInfo(ShowInfo showInfo) {
             }
             if (showInfo.direction == DIRECTION_BOTTOM) {
                 if (shouldShowShadow()) {
-                    showInfo.y += mArrowHeight;
+                    showInfo.y += Math.min(mShadowInset, mArrowHeight);
                 }
                 showInfo.decorationTop = Math.max(showInfo.decorationTop, mArrowHeight);
             } else if (showInfo.direction == DIRECTION_TOP) {

File: compiler/src/main/java/com/qmuiteam/qmuidemo/compiler/WidgetProcessor.java
Patch:
@@ -17,6 +17,7 @@
 package com.qmuiteam.qmuidemo.compiler;
 
 import com.google.auto.service.AutoService;
+import com.qmuiteam.qmuidemo.lib.annotation.Widget;
 import com.squareup.javapoet.ClassName;
 import com.squareup.javapoet.FieldSpec;
 import com.squareup.javapoet.JavaFile;
@@ -25,7 +26,6 @@
 import com.squareup.javapoet.TypeName;
 import com.squareup.javapoet.TypeSpec;
 import com.squareup.javapoet.WildcardTypeName;
-import com.qmuiteam.qmuidemo.lib.annotation.Widget;
 
 import java.io.IOException;
 import java.util.LinkedHashSet;

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUITopBarLayout.java
Patch:
@@ -74,7 +74,7 @@ public QMUITopBarLayout(Context context, AttributeSet attrs, int defStyleAttr) {
                 ViewGroup.LayoutParams.MATCH_PARENT, mTopBar.getTopBarHeight());
         addView(mTopBar, lp);
         QMUIWindowInsetHelper.handleWindowInsets(this,
-                WindowInsetsCompat.Type.statusBars() | WindowInsetsCompat.Type.displayCutout(), true);
+                WindowInsetsCompat.Type.statusBars() | WindowInsetsCompat.Type.displayCutout(), true, true);
     }
 
     public QMUITopBar getTopBar() {

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/components/qqface/QDQQFaceUsageFragment.java
Patch:
@@ -103,7 +103,7 @@ private void initData() {
         TextParser textParser = new EmojiTextParser(QDQQFaceManager.getInstance());
         mMarqueeTypeView1.setFadeWidth(QMUIDisplayHelper.dp2px(getContext(), 40));
         mMarqueeTypeView1.setTextParser(textParser);
-        mMarqueeTypeView1.setText("飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀这是一行很长很长[微笑][微笑][微笑][微笑]的文本，但是[微笑][微笑][微笑][微笑]只能单行显示");
+        mMarqueeTypeView1.setText("🙃🙃🙃🙃飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀飘呀这是一行很长很长[微笑][微笑][微笑][微笑]的文本，但是[微笑][微笑][微笑][微笑]只能单行显示");
         mMarqueeTypeView2.setFadeWidth(QMUIDisplayHelper.dp2px(getContext(), 40));
         mMarqueeTypeView2.setTextParser(textParser);
         mMarqueeTypeView2.setText("[大哭]我太短了，实在是飘不动了");
@@ -118,9 +118,9 @@ private void initData() {
         lineLayout.setMoreUnderlineColor(Color.BLUE);
         mLineType1.setLineHeight(QMUIDisplayHelper.dp2px(getContext(), 36));
         mLineType1.setTextColor(Color.BLACK);
-        mLineType1.setTextSize(QMUIDisplayHelper.sp2px(getContext(), 33));
+        mLineType1.setTextSize(QMUIDisplayHelper.sp2px(getContext(), 15));
         mLineType1.setTextParser(textParser);
-        mLineType1.setText("QMUI Android 的设计[微笑]目的是用于辅助快速搭建一个具备基本设计还原[微笑]效果的 Android 项目，" +
+        mLineType1.setText("QMUI Android 的设计[微笑]目的🙃🙃🙃🙃是用于辅助快速搭建一个具备基本设计还原[微笑]效果的 Android 项目，" +
                 "同时利用自身[微笑]提供的丰富控件及兼容处理，让开[微笑]发者能专注于业务需求而无需耗费[微笑]精力在基础代[微笑]码的设计上。" +
                 "不管是新项目的创建，或是已有项[微笑]目的维护，均可使开[微笑]发效率和项目[微笑]质量得到大幅度提升。");
         mLineType1.addBgEffect(10, 30, QMUIColorHelper.setColorAlpha(Color.RED, 0.5f));

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUITopBarLayout.java
Patch:
@@ -41,9 +41,6 @@
  * 这是一个对 {@link QMUITopBar} 的代理类，需要它的原因是：
  * 我们用 fitSystemWindows 实现沉浸式状态栏后，需要将 {@link QMUITopBar} 的背景衍生到状态栏后面，这个时候 fitSystemWindows 是通过
  * 更改 padding 实现的，而 {@link QMUITopBar} 是在高度固定的前提下做各种行为的，例如按钮的垂直居中，因此我们需要在外面包裹一层并消耗 padding
- * <p>
- * 这个类一般是配合 {@link QMUIWindowInsetLayout} 使用，并需要设置 fitSystemWindows 为 true
- * </p>
  *
  * @author cginechen
  * @date 2016-11-26

File: qmui/src/main/java/com/qmuiteam/qmui/nestedScroll/QMUIContinuousNestedTopAreaBehavior.java
Patch:
@@ -113,7 +113,7 @@ public boolean onInterceptTouchEvent(@NonNull CoordinatorLayout parent,
                 final int yDiff = Math.abs(y - lastMotionY);
                 if (yDiff > touchSlop) {
                     isBeingDragged = true;
-                    if(child instanceof WebView){
+                    if(child instanceof WebView || child instanceof QMUIContinuousNestedTopDelegateLayout){
                         // dispatch cancel event not work in webView sometimes.
                         MotionEvent cancelEvent = MotionEvent.obtain(ev);
                         cancelEvent.offsetLocation(-child.getLeft(), -child.getTop());

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUISlider.java
Patch:
@@ -245,12 +245,12 @@ public boolean onTouchEvent(MotionEvent event) {
             }
 
         } else if (action == MotionEvent.ACTION_MOVE) {
-            removeCallbacks(mLongPressAction);
             int x = (int) event.getX();
             int dx = x - mLastTouchX;
             mLastTouchX = x;
             if (!mIsMoving && mIsThumbTouched) {
                 if (Math.abs(mLastTouchX - mDownTouchX) > mTouchSlop) {
+                    removeCallbacks(mLongPressAction);
                     mIsMoving = true;
                     if (mCallback != null) {
                         mCallback.onStartMoving(this, mCurrentProgress, mTickCount);

File: qmui/src/main/java/com/qmuiteam/qmui/widget/tab/QMUITabView.java
Patch:
@@ -160,6 +160,7 @@ public void bind(QMUITab tab) {
                         QMUILangHelper.formatNumberToLimitedDigits(mTab.signCount, mTab.signCountDigits));
                 mSignCountView.setMinWidth(QMUIResHelper.getAttrDimen(getContext(),
                         R.attr.qmui_tab_sign_count_view_min_size_with_text));
+                signCountLp.width = ViewGroup.LayoutParams.WRAP_CONTENT;
                 signCountLp.height = QMUIResHelper.getAttrDimen(getContext(),
                         R.attr.qmui_tab_sign_count_view_min_size_with_text);
             } else {

File: arch/src/main/java/com/qmuiteam/qmui/arch/scheme/QMUISchemeHandleInterpolator.java
Patch:
@@ -19,14 +19,13 @@
 import android.app.Activity;
 
 import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
 
 import java.util.Map;
 
 public interface QMUISchemeHandleInterpolator {
     boolean intercept(@NonNull QMUISchemeHandler schemeHandler,
                       @NonNull Activity activity,
                       @NonNull String action,
-                      @Nullable Map<String, String> params,
+                      @NonNull Map<String, String> params,
                       @NonNull String origin);
 }

File: arch/src/main/java/com/qmuiteam/qmui/arch/scheme/QMUISchemeParamValueDecoder.java
Patch:
@@ -20,7 +20,6 @@
 import android.net.Uri;
 
 import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
 
 import java.util.Map;
 
@@ -30,9 +29,9 @@ public class QMUISchemeParamValueDecoder implements QMUISchemeHandleInterpolator
     public boolean intercept(@NonNull QMUISchemeHandler schemeHandler,
                              @NonNull Activity activity,
                              @NonNull String action,
-                             @Nullable Map<String, String> params,
+                             @NonNull Map<String, String> params,
                              @NonNull String origin) {
-        if (params != null) {
+        if (!params.isEmpty()) {
             for (String key : params.keySet()) {
                 String oldValue = params.get(key);
                 if (oldValue != null && oldValue.length() > 0) {

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/manager/QDSchemeManager.java
Patch:
@@ -21,7 +21,6 @@
 import android.widget.Toast;
 
 import androidx.annotation.NonNull;
-import androidx.annotation.Nullable;
 
 import com.qmuiteam.qmui.arch.QMUISwipeBackActivityManager;
 import com.qmuiteam.qmui.arch.scheme.QMUISchemeHandleInterpolator;
@@ -52,7 +51,7 @@ private QDSchemeManager() {
                     public boolean intercept(@NonNull QMUISchemeHandler schemeHandler,
                                              @NonNull Activity activity,
                                              @NonNull String action,
-                                             @Nullable Map<String, String> params,
+                                             @NonNull Map<String, String> params,
                                              @NonNull String origin) {
                         // Log the scheme.
                         Log.i(TAG, "handle scheme: " + origin);

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUISlider.java
Patch:
@@ -647,9 +647,8 @@ public void run() {
             mIsMoving = true;
             int oldProgress = mCurrentProgress;
             checkTouch(mLastTouchX, getMaxThumbOffset());
-            if (mIsThumbTouched) {
-                mThumbView.setPress(true);
-            }
+            mIsThumbTouched = true;
+            mThumbView.setPress(true);
             if (mCallback != null && oldProgress != mCurrentProgress) {
                 mCallback.onLongTouch(QMUISlider.this, mCurrentProgress, mTickCount);
             }

File: qmui/src/main/java/com/qmuiteam/qmui/util/QMUIDeviceHelper.java
Patch:
@@ -310,7 +310,8 @@ public static long getTotalStorageSize() {
         return getInnerStorageSize() + getExtraStorageSize();
     }
 
-    private static int getNumOfCores() {
+    // From Matrix
+    public static int getCpuCoreCount() {
         if (sCpuCoreCount != -1) {
             return sCpuCoreCount;
         }

File: qmui/src/main/java/com/qmuiteam/qmui/qqface/QMUIQQFaceCompiler.java
Patch:
@@ -142,7 +142,7 @@ public int compare(QMUITouchableSpan o1, QMUITouchableSpan o2) {
             return elementList;
         }
         elementList = realCompile(text, start, end, spans, spanInfo);
-        if(!hasClickableSpans){
+        if(!hasClickableSpans && !inSpan){
             mCache.put(text, elementList);
         }
         return elementList;

File: qmui/src/main/java/com/qmuiteam/qmui/widget/popup/QMUINormalPopup.java
Patch:
@@ -415,7 +415,7 @@ private void adjustShowInfo(ShowInfo showInfo) {
             }
             if (showInfo.direction == DIRECTION_BOTTOM) {
                 if (shouldShowShadow()) {
-                    showInfo.y += mArrowHeight;
+                    showInfo.y += Math.min(mShadowInset, mArrowHeight);
                 }
                 showInfo.decorationTop = Math.max(showInfo.decorationTop, mArrowHeight);
             } else if (showInfo.direction == DIRECTION_TOP) {

File: arch/src/main/java/com/qmuiteam/qmui/arch/QMUIFragment.java
Patch:
@@ -555,9 +555,10 @@ public void onScrollStateChange(int state, float scrollPercent) {
                         // unbind mSwipeBackgroundView util onDestroy
                         if (getActivity() != null) {
                             sPopBackWhenSwipeFinished = true;
-                            popBackStack();
+                            // must call before popBackStack. mSwipeBackgroundView maybe released in popBackStack
                             int exitAnim = mSwipeBackgroundView.hasChildWindow() ?
                                     R.anim.swipe_back_exit_still : R.anim.swipe_back_exit;
+                            popBackStack();
                             getActivity().overridePendingTransition(R.anim.swipe_back_enter, exitAnim);
                             sPopBackWhenSwipeFinished = false;
                         }

File: qmui/src/main/java/com/qmuiteam/qmui/recyclerView/QMUIRVDraggableScrollBar.java
Patch:
@@ -478,7 +478,7 @@ public void handle(@NotNull @NonNull RecyclerView recyclerView,
         invalidate();
     }
 
-    interface Callback {
+    public interface Callback {
         void onDragStarted();
 
         void onDragToPercent(float percent);

File: qmui/src/main/java/com/qmuiteam/qmui/widget/tab/QMUIBasicTabSegment.java
Patch:
@@ -801,6 +801,7 @@ private final class Container extends ViewGroup {
         public Container(Context context) {
             super(context);
             setClipChildren(false);
+            setWillNotDraw(false);
         }
 
         @Override
@@ -938,8 +939,8 @@ protected void onLayout(boolean changed, int l, int t, int r, int b) {
         }
 
         @Override
-        protected void dispatchDraw(Canvas canvas) {
-            super.dispatchDraw(canvas);
+        protected void onDraw(Canvas canvas) {
+            super.onDraw(canvas);
             if (mIndicator != null && (!mHideIndicatorWhenTabCountLessTwo || mTabAdapter.getSize() > 1)) {
                 mIndicator.draw(this, canvas, getPaddingTop(), getHeight() - getPaddingBottom());
             }

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUIProgressBar.java
Patch:
@@ -283,7 +283,7 @@ protected void onDraw(Canvas canvas) {
             mText = mQMUIProgressBarTextGenerator.generateText(this, mValue, mMaxValue);
         }
         if(((mType == TYPE_RECT || mType == TYPE_ROUND_RECT) && mBgRect == null) ||
-                (mType == TYPE_CIRCLE && mCenterPoint == null)){
+                ((mType == TYPE_CIRCLE || mType == TYPE_FILL_CIRCLE) && mCenterPoint == null)){
             // npe protect, sometimes measure may not be called by parent.
             configShape();
         }
@@ -331,7 +331,6 @@ private void drawRoundRect(Canvas canvas) {
 
     private void drawCircle(Canvas canvas, boolean useCenter) {
         canvas.drawCircle(mCenterPoint.x, mCenterPoint.y, mCircleRadius, mBackgroundPaint);
-        float halfStroke = mStrokeWidth / 2f;
         mArcOval.left = mCenterPoint.x - mCircleRadius;
         mArcOval.right = mCenterPoint.x + mCircleRadius;
         mArcOval.top = mCenterPoint.y - mCircleRadius;

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUIPagerAdapter.java
Patch:
@@ -61,7 +61,6 @@ public Object instantiateItem(@NonNull ViewGroup container, int position) {
     @Override
     public final void destroyItem(@NonNull ViewGroup container, int position, @NonNull Object object) {
         destroy(container, position, object);
-
     }
 
     /**

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUITopBar.java
Patch:
@@ -144,7 +144,7 @@ void init(Context context, AttributeSet attrs, int defStyleAttr) {
         mClearLeftPaddingWhenAddLeftBackView = array.getBoolean(R.styleable.QMUITopBar_qmui_topbar_clear_left_padding_when_add_left_back_view, false);
         mTitleGravity = array.getInt(R.styleable.QMUITopBar_qmui_topbar_title_gravity, Gravity.CENTER);
         mTitleTextSize = array.getDimensionPixelSize(R.styleable.QMUITopBar_qmui_topbar_title_text_size, QMUIDisplayHelper.sp2px(context, 17));
-        mTitleTextSizeWithSubTitle = array.getDimensionPixelSize(R.styleable.QMUITopBar_qmui_topbar_title_text_size, QMUIDisplayHelper.sp2px(context, 16));
+        mTitleTextSizeWithSubTitle = array.getDimensionPixelSize(R.styleable.QMUITopBar_qmui_topbar_title_text_size_with_subtitle, QMUIDisplayHelper.sp2px(context, 16));
         mSubTitleTextSize = array.getDimensionPixelSize(R.styleable.QMUITopBar_qmui_topbar_subtitle_text_size, QMUIDisplayHelper.sp2px(context, 11));
         mTitleTextColor = array.getColor(R.styleable.QMUITopBar_qmui_topbar_title_color, QMUIResHelper.getAttrColor(context, R.attr.qmui_config_color_gray_1));
         mSubTitleTextColor = array.getColor(R.styleable.QMUITopBar_qmui_topbar_subtitle_color, QMUIResHelper.getAttrColor(context, R.attr.qmui_config_color_gray_4));

File: qmui/src/main/java/com/qmuiteam/qmui/skin/handler/QMUISkinRuleHintColorHandler.java
Patch:
@@ -18,7 +18,7 @@ protected void handle(@NotNull View view, @NotNull String name, ColorStateList c
         } else if (view instanceof TextInputLayout) {
             ((TextInputLayout) view).setHintTextColor(colorStateList);
         }else if(view instanceof QMUISlider){
-            ((QMUISlider)view).setBarProgressColor(colorStateList.getDefaultColor());
+            ((QMUISlider)view).setRecordProgressColor(colorStateList.getDefaultColor());
         }else{
             QMUISkinHelper.warnRuleNotSupport(view, name);
         }

File: qmui/src/main/java/com/qmuiteam/qmui/util/QMUIStatusBarHelper.java
Patch:
@@ -265,7 +265,7 @@ private static boolean Android6SetStatusBarLightMode(Window window, boolean ligh
         if (light) {
             systemUi |= View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR;
         } else {
-            systemUi ^= View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR;
+            systemUi &= ~View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR;
         }
         decorView.setSystemUiVisibility(systemUi);
         if (QMUIDeviceHelper.isMIUIV9()) {

File: qmui/src/main/java/com/qmuiteam/qmui/util/QMUIStatusBarHelper.java
Patch:
@@ -265,7 +265,7 @@ private static boolean Android6SetStatusBarLightMode(Window window, boolean ligh
         if (light) {
             systemUi |= View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR;
         } else {
-            systemUi ^= View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR;
+            systemUi &= ~View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR;
         }
         decorView.setSystemUiVisibility(systemUi);
         if (QMUIDeviceHelper.isMIUIV9()) {

File: qmui/src/main/java/com/qmuiteam/qmui/skin/QMUISkinManager.java
Patch:
@@ -643,7 +643,9 @@ public void addSkinChangeListener(@NonNull OnSkinChangeListener listener) {
         while (iterator.hasNext()) {
             Object item = iterator.next().get();
             if (item != null) {
-                return;
+                if(item == listener){
+                    return;
+                }
             } else {
                 iterator.remove();
             }

File: qmui/src/main/java/com/qmuiteam/qmui/span/QMUITextSizeSpan.java
Patch:
@@ -78,7 +78,7 @@ public void draw(@NonNull Canvas canvas, CharSequence text, int start, int end,
     @Override
     public void handle(@NonNull View view, @NonNull QMUISkinManager manager, int skinIndex, @NonNull Resources.Theme theme) {
         if(view instanceof TextView){
-            mPaint.setColor(((TextView)view).getPaint().getColor());
+            mPaint.setColor(((TextView)view).getTextColors().getDefaultColor());
         }
     }
 }

File: type/src/main/java/com/qmuiteam/qmui/type/Line.java
Patch:
@@ -240,6 +240,7 @@ public void layout(TypeEnvironment env, boolean dropLastIfSpace, boolean isEnd)
             if (i > 0 && (el.getWordPart() == Element.WORD_PART_WHOLE
                     || el.getWordPart() == Element.WORD_PART_START)) {
                 x += addSpace;
+                mElements.get(i - 1).setNextGapWidth(addSpace);
             }
             el.setX((int) x);
             x += el.getMeasureWidth();

File: type/src/main/java/com/qmuiteam/qmui/type/TypeEnvironment.java
Patch:
@@ -64,7 +64,7 @@ public enum Alignment {
     private int mLastLineJustifyMaxWidth = (int) (Resources.getSystem().getDisplayMetrics().density * 36);
 
     private int mTextColor = Color.BLACK;
-    private int mBackgroundColor;
+    private int mBackgroundColor = Color.TRANSPARENT;
 
     private Paint mPaint = new Paint();
     private Paint mBgPaint = new Paint();

File: type/src/main/java/com/qmuiteam/qmui/type/element/CharOrPhraseElement.java
Patch:
@@ -17,10 +17,8 @@
 package com.qmuiteam.qmui.type.element;
 
 import android.graphics.Canvas;
-import android.graphics.Color;
 import android.graphics.Paint;
 
-import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 
 import com.qmuiteam.qmui.type.TypeEnvironment;
@@ -49,6 +47,8 @@ protected void onMeasure(TypeEnvironment env) {
 
     @Override
     protected void onDraw(TypeEnvironment env, Canvas canvas) {
+        drawBg(env, canvas);
         canvas.drawText(toString(), getX(), getY() + getBaseLine(), env.getPaint());
+        drawBorder(env, canvas);
     }
 }

File: type/src/main/java/com/qmuiteam/qmui/type/element/DrawableElement.java
Patch:
@@ -34,9 +34,11 @@ protected void onMeasure(TypeEnvironment env) {
 
     @Override
     protected void onDraw(TypeEnvironment env, Canvas canvas) {
+        drawBg(env, canvas);
         canvas.save();
         canvas.translate(getX(), getY());
         mDrawable.draw(canvas);
         canvas.restore();
+        drawBorder(env, canvas);
     }
 }

File: type/src/main/java/com/qmuiteam/qmui/type/element/EmojiElement.java
Patch:
@@ -34,9 +34,11 @@ protected void onMeasure(TypeEnvironment env) {
 
     @Override
     protected void onDraw(TypeEnvironment env, Canvas canvas) {
+        drawBg(env, canvas);
         canvas.save();
         canvas.translate(getX(), getY());
         mDrawable.draw(canvas);
         canvas.restore();
+        drawBorder(env, canvas);
     }
 }

File: type/src/main/java/com/qmuiteam/qmui/type/element/IgnoreEffectElement.java
Patch:
@@ -23,9 +23,9 @@
 
 import java.util.List;
 
-public class EffectElement extends Element {
+public class IgnoreEffectElement extends Element {
 
-    public EffectElement(final List<Element> list) {
+    public IgnoreEffectElement(final List<Element> list) {
         super(' ', null, -1, -1, "");
         addEnvironmentUpdater(new EnvironmentUpdater() {
             @Override

File: type/src/main/java/com/qmuiteam/qmui/type/parser/EmojiTextParser.java
Patch:
@@ -123,6 +123,6 @@ public TypeModel parse(CharSequence text) {
             }
             map.put(tmp.getIndex(), tmp);
         }
-        return new TypeModel(map, first, last, null);
+        return new TypeModel(text, map, first, last, null);
     }
 }

File: type/src/main/java/com/qmuiteam/qmui/type/parser/PlainTextParser.java
Patch:
@@ -59,6 +59,6 @@ public TypeModel parse(CharSequence text) {
             }
             map.put(tmp.getIndex(), tmp);
         }
-        return new TypeModel(map, first, last, null);
+        return new TypeModel(text, map, first, last, null);
     }
 }

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUISlider.java
Patch:
@@ -167,6 +167,8 @@ public int getCurrentProgress() {
     public void setTickCount(int tickCount) {
         if (mTickCount != tickCount) {
             mTickCount = tickCount;
+            setCurrentProgress(QMUILangHelper.constrain(mCurrentProgress, 0, mTickCount));
+            mThumbView.render(mCurrentProgress, mTickCount);
             invalidate();
         }
     }

File: qmui/src/main/java/com/qmuiteam/qmui/widget/tab/QMUITabBuilder.java
Patch:
@@ -116,7 +116,7 @@ public class QMUITabBuilder {
      */
     float selectedTabIconScale = 1f;
 
-    float typefaceUpdateAreaPercent = 0.75f;
+    float typefaceUpdateAreaPercent = 0.25f;
 
     /**
      * signCount or redPoint

File: qmui/src/main/java/com/qmuiteam/qmui/widget/tab/QMUITabView.java
Patch:
@@ -140,6 +140,7 @@ public boolean onTouchEvent(MotionEvent event) {
     public void bind(QMUITab tab) {
         mCollapsingTextHelper.setTextSize(tab.normalTextSize, tab.selectedTextSize, false);
         mCollapsingTextHelper.setTypeface(tab.normalTypeface, tab.selectedTypeface, false);
+        mCollapsingTextHelper.setTypefaceUpdateAreaPercent(tab.typefaceUpdateAreaPercent);
         int gravity = Gravity.LEFT | Gravity.TOP;
         mCollapsingTextHelper.setGravity(gravity, gravity, false);
         mCollapsingTextHelper.setText(tab.getText());

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/home/HomeFragment.java
Patch:
@@ -17,6 +17,7 @@
 package com.qmuiteam.qmuidemo.fragment.home;
 
 import android.content.Context;
+import android.graphics.Typeface;
 import android.view.LayoutInflater;
 import android.view.View;
 import android.view.ViewGroup;
@@ -150,6 +151,7 @@ protected View onCreateView() {
     private void initTabs() {
 
         QMUITabBuilder builder = mTabSegment.tabBuilder();
+        builder.setTypeface(null, Typeface.DEFAULT_BOLD);
         builder.setSelectedIconScale(1.2f)
                 .setTextSize(QMUIDisplayHelper.sp2px(getContext(), 13), QMUIDisplayHelper.sp2px(getContext(), 15))
                 .setDynamicChangeIconColor(false);

File: qmui/src/main/java/com/qmuiteam/qmui/recyclerView/QMUIRVItemSwipeAction.java
Patch:
@@ -838,7 +838,7 @@ View findChildView(MotionEvent event) {
         for (int i = mRecoverAnimations.size() - 1; i >= 0; i--) {
             final RecoverAnimation anim = mRecoverAnimations.get(i);
             final View view = anim.mViewHolder.itemView;
-            if (hitTest(view, x, y, anim.mX, anim.mY)) {
+            if (hitTest(view, x, y, view.getX(), view.getY())) {
                 return view;
             }
         }

File: arch/src/main/java/com/qmuiteam/qmui/arch/QMUIFragmentActivity.java
Patch:
@@ -238,6 +238,7 @@ public int startFragmentAndDestroyCurrent(QMUIFragment fragment, final boolean u
         FragmentTransaction transaction = getSupportFragmentManager().beginTransaction()
                 .setCustomAnimations(transitionConfig.enter, transitionConfig.exit,
                         transitionConfig.popenter, transitionConfig.popout)
+                .setPrimaryNavigationFragment(null)
                 .replace(getContextViewId(), fragment, tagName);
         int index = transaction.commit();
         Utils.modifyOpForStartFragmentAndDestroyCurrent(fragmentManager, fragment, useNewTransitionConfigWhenPop, transitionConfig);
@@ -262,6 +263,7 @@ public int startFragment(QMUIFragment fragment) {
         return fragmentManager.beginTransaction()
                 .setCustomAnimations(transitionConfig.enter, transitionConfig.exit, transitionConfig.popenter, transitionConfig.popout)
                 .replace(getContextViewId(), fragment, tagName)
+                .setPrimaryNavigationFragment(null)
                 .addToBackStack(tagName)
                 .commit();
     }

File: qmui/src/main/java/com/qmuiteam/qmui/widget/tab/QMUITabAdapter.java
Patch:
@@ -46,7 +46,7 @@ protected void onBindTab(QMUITab item, QMUITabView view, int position) {
     @Override
     public void onClick(QMUITabView view) {
         int index = getViews().indexOf(view);
-        mTabSegment.onClickTab(index);
+        mTabSegment.onClickTab(view, index);
     }
 
     @Override

File: arch/src/main/java/com/qmuiteam/qmui/arch/InnerBaseActivity.java
Patch:
@@ -131,13 +131,13 @@ private void checkLatestVisitRecord() {
         sLatestVisitActivityUUid = mUUid;
 
         if (!shouldPerformLatestVisitRecord()) {
-            QMUILatestVisit.getInstance(this).clearFragmentLatestVisitRecord();
+            QMUILatestVisit.getInstance(this).clearActivityLatestVisitRecord();
             return;
         }
 
         LatestVisitRecord latestVisitRecord = cls.getAnnotation(LatestVisitRecord.class);
         if(latestVisitRecord == null || (latestVisitRecord.onlyForDebug() && !QMUIConfig.DEBUG)){
-            QMUILatestVisit.getInstance(this).clearFragmentLatestVisitRecord();
+            QMUILatestVisit.getInstance(this).clearActivityLatestVisitRecord();
             return;
         }
         QMUILatestVisit.getInstance(this).performLatestVisitRecord(this);

File: type/src/main/java/com/qmuiteam/qmui/type/element/BreakWordLineElement.java
Patch:
@@ -16,7 +16,7 @@
 
 package com.qmuiteam.qmui.type.element;
 
-public class BreakWordLineElement extends CharElement {
+public class BreakWordLineElement extends CharOrPhraseElement {
 
     public BreakWordLineElement() {
         super('-', -1, -1);

File: type/src/main/java/com/qmuiteam/qmui/type/parser/PlainTextParser.java
Patch:
@@ -17,7 +17,7 @@
 package com.qmuiteam.qmui.type.parser;
 
 import com.qmuiteam.qmui.type.TypeModel;
-import com.qmuiteam.qmui.type.element.CharElement;
+import com.qmuiteam.qmui.type.element.CharOrPhraseElement;
 import com.qmuiteam.qmui.type.element.Element;
 import com.qmuiteam.qmui.type.element.NextParagraphElement;
 
@@ -44,7 +44,7 @@ public TypeModel parse(CharSequence text) {
                     tmp = new NextParagraphElement(c, null, index, i);
                 }
             } else {
-                tmp = new CharElement(c, index, i);
+                tmp = new CharOrPhraseElement(c, index, i);
             }
 
             ParserHelper.handleWordPart(c, last, tmp);
@@ -59,6 +59,6 @@ public TypeModel parse(CharSequence text) {
             }
             map.put(tmp.getIndex(), tmp);
         }
-        return new TypeModel(map, first, last);
+        return new TypeModel(map, first, last, null);
     }
 }

File: qmui/src/main/java/com/qmuiteam/qmui/widget/dialog/QMUIBottomSheetRootLayout.java
Patch:
@@ -20,7 +20,6 @@
 import android.util.AttributeSet;
 
 import com.qmuiteam.qmui.R;
-import com.qmuiteam.qmui.layout.QMUILinearLayout;
 import com.qmuiteam.qmui.layout.QMUIPriorityLinearLayout;
 import com.qmuiteam.qmui.skin.QMUISkinHelper;
 import com.qmuiteam.qmui.skin.QMUISkinValueBuilder;
@@ -58,7 +57,7 @@ public QMUIBottomSheetRootLayout(Context context, AttributeSet attrs) {
     protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
         int widthSize = MeasureSpec.getSize(widthMeasureSpec);
         int widthMode = MeasureSpec.getMode(widthMeasureSpec);
-        if(widthSize > mMaxWidth){
+        if (widthSize > mMaxWidth) {
             widthMeasureSpec = MeasureSpec.makeMeasureSpec(mMaxWidth, widthMode);
         }
         int heightSize = MeasureSpec.getSize(heightMeasureSpec);

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/components/QDEmptyViewFragment.java
Patch:
@@ -19,6 +19,7 @@
 import android.view.LayoutInflater;
 import android.view.View;
 
+import com.qmuiteam.qmui.skin.QMUISkinManager;
 import com.qmuiteam.qmui.widget.QMUIEmptyView;
 import com.qmuiteam.qmui.widget.QMUITopBarLayout;
 import com.qmuiteam.qmui.widget.dialog.QMUIBottomSheet;
@@ -78,6 +79,7 @@ public void onClick(View view) {
 
     private void showBottomSheetList() {
         new QMUIBottomSheet.BottomListSheetBuilder(getActivity())
+                .setSkinManager(QMUISkinManager.defaultInstance(getContext()))
                 .addItem(getResources().getString(R.string.emptyView_mode_title_double_text))
                 .addItem(getResources().getString(R.string.emptyView_mode_title_single_text))
                 .addItem(getResources().getString(R.string.emptyView_mode_title_loading))

File: arch-annotation/src/main/java/com/qmuiteam/qmui/arch/annotation/LatestVisitRecord.java
Patch:
@@ -19,4 +19,5 @@
 @Retention(RetentionPolicy.RUNTIME)
 @Target(ElementType.TYPE)
 public @interface LatestVisitRecord {
+    boolean onlyForDebug() default false;
 }

File: arch/src/main/java/com/qmuiteam/qmui/arch/InnerBaseActivity.java
Patch:
@@ -123,8 +123,9 @@ public final void onLatestVisitArgumentChanged() {
     private void checkLatestVisitRecord() {
         Class<? extends InnerBaseActivity> cls = getClass();
         sLatestVisitActivityUUid = mUUid;
-        if (!cls.isAnnotationPresent(LatestVisitRecord.class)) {
-            QMUILatestVisit.getInstance(this).clearActivityLatestVisitRecord();
+        LatestVisitRecord latestVisitRecord = cls.getAnnotation(LatestVisitRecord.class);
+        if(latestVisitRecord == null || (latestVisitRecord.onlyForDebug() && !BuildConfig.DEBUG)){
+            QMUILatestVisit.getInstance(this).clearFragmentLatestVisitRecord();
             return;
         }
         QMUILatestVisit.getInstance(this).performLatestVisitRecord(this);

File: qmui/src/main/java/com/qmuiteam/qmui/widget/dialog/QMUIBottomSheetRootLayout.java
Patch:
@@ -21,11 +21,12 @@
 
 import com.qmuiteam.qmui.R;
 import com.qmuiteam.qmui.layout.QMUILinearLayout;
+import com.qmuiteam.qmui.layout.QMUIPriorityLinearLayout;
 import com.qmuiteam.qmui.skin.QMUISkinHelper;
 import com.qmuiteam.qmui.skin.QMUISkinValueBuilder;
 import com.qmuiteam.qmui.util.QMUIResHelper;
 
-public class QMUIBottomSheetRootLayout extends QMUILinearLayout {
+public class QMUIBottomSheetRootLayout extends QMUIPriorityLinearLayout {
 
     private final int mUsePercentMinHeight;
     private final float mHeightPercent;

File: arch/src/main/java/com/qmuiteam/qmui/arch/QMUIFragment.java
Patch:
@@ -564,6 +564,9 @@ public int getDragDirection(SwipeBackLayout swipeBackLayout, SwipeBackLayout.Vie
                     }
                 });
         mListenerRemover = swipeBackLayout.addSwipeListener(mSwipeListener);
+        if(isCreateForSwipeBack){
+            swipeBackLayout.setTag(R.id.fragment_container_view_tag, this);
+        }
         return swipeBackLayout;
     }
 

File: arch/src/main/java/com/qmuiteam/qmui/arch/QMUIFragmentActivity.java
Patch:
@@ -361,8 +361,7 @@ public static Intent intentOf(@NonNull Context context,
         if (dstId == FirstFragmentFinder.NO_ID) {
             String fragmentName = firstFragment.getName();
             throw new RuntimeException("Can not find ID for " + fragmentName +
-                    "; You must add annotation MayFirstFragment which include " + targetActivity.getName() +
-                    " in " + fragmentName + " .");
+                    "; You must add " + fragmentName + " to " +  targetActivity.getName() + " with annotation @FirstFragments.");
         }
         intent.putExtra(QMUI_INTENT_DST_FRAGMENT, dstId);
         if (fragmentArgs != null) {

File: qmui/src/main/java/com/qmuiteam/qmui/widget/dialog/QMUIDialog.java
Patch:
@@ -858,11 +858,11 @@ public AutoResizeDialogBuilder(Context context) {
 
         @Nullable
         @Override
-        protected View onCreateContent(QMUIDialog dialog, QMUIDialogView parent, Context context) {
-            mScrollView = wrapWithScroll(onBuildContent(dialog));
+        protected View onCreateContent(@NonNull QMUIDialog dialog,@NonNull QMUIDialogView parent, @NonNull Context context) {
+            mScrollView = wrapWithScroll(onBuildContent(dialog, context));
             return mScrollView;
         }
 
-        public abstract View onBuildContent(QMUIDialog dialog);
+        public abstract View onBuildContent(@NonNull QMUIDialog dialog, @NonNull Context context);
     }
 }

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUIRadiusImageView2.java
Patch:
@@ -73,7 +73,6 @@ public QMUIRadiusImageView2(Context context, AttributeSet attrs, int defStyleAtt
     }
 
     private void init(Context context, AttributeSet attrs, int defStyleAttr) {
-        setScaleType(ScaleType.CENTER_CROP);
         mLayoutHelper = new QMUILayoutHelper(context, attrs, defStyleAttr, this);
         setChangeAlphaWhenPress(false);
         setChangeAlphaWhenDisable(false);

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/components/QDRadiusImageView2ScaleTypeFragment.java
Patch:
@@ -46,7 +46,6 @@ public class QDRadiusImageView2ScaleTypeFragment extends BaseFragment {
     protected View onCreateView() {
         View root = LayoutInflater.from(getActivity()).inflate(R.layout.fragment_radius_imageview2_scale_type, null);
         ButterKnife.bind(this, root);
-
         initTopBar();
 
         return root;

File: qmui/src/main/java/com/qmuiteam/qmui/widget/dialog/QMUIBottomSheet.java
Patch:
@@ -433,7 +433,7 @@ public RecyclerView.LayoutParams generateDefaultLayoutParams() {
                 }
             }
             LinearLayout footerView = null;
-            if (mContentFooterViews != null && mContentHeaderViews.size() > 0) {
+            if (mContentFooterViews != null && mContentFooterViews.size() > 0) {
                 footerView = new LinearLayout(context);
                 footerView.setOrientation(LinearLayout.VERTICAL);
                 for (View view : mContentFooterViews) {

File: arch/src/main/java/com/qmuiteam/qmui/arch/InnerBaseActivity.java
Patch:
@@ -52,7 +52,6 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
                     new QMUISkinLayoutInflaterFactory(this, layoutInflater));
         }
         super.onCreate(savedInstanceState);
-        mSkinManager = QMUISkinManager.defaultInstance(this);
     }
 
     void convertToTranslucentCauseOrientationChanged() {
@@ -85,6 +84,9 @@ public void onConfigurationChanged(Configuration newConfig) {
         }
     }
 
+    public QMUISkinManager getSkinManager() {
+        return mSkinManager;
+    }
 
     @Override
     protected void onStart() {

File: qmui/src/main/java/com/qmuiteam/qmui/skin/QMUISkinManager.java
Patch:
@@ -592,7 +592,7 @@ public void changeSkin(int index) {
             if (item == null) {
                 mSkinChangeListeners.remove(i);
             } else {
-                item.onSkinChange(oldIndex, mCurrentSkin);
+                item.onSkinChange(this, oldIndex, mCurrentSkin);
             }
         }
     }
@@ -629,7 +629,7 @@ public int getCurrentSkin() {
     }
 
     public interface OnSkinChangeListener {
-        void onSkinChange(int oldSkin, int newSkin);
+        void onSkinChange(QMUISkinManager skinManager, int oldSkin, int newSkin);
     }
 
     class ViewSkinCurrent{

File: qmui/src/main/java/com/qmuiteam/qmui/widget/dialog/QMUIBottomSheetBaseBuilder.java
Patch:
@@ -48,7 +48,6 @@ public abstract class QMUIBottomSheetBaseBuilder<T extends QMUIBottomSheetBaseBu
 
     public QMUIBottomSheetBaseBuilder(Context context) {
         mContext = context;
-        mSkinManager = QMUISkinManager.defaultInstance(context);
     }
 
     @SuppressWarnings("unchecked")

File: qmui/src/main/java/com/qmuiteam/qmui/widget/dialog/QMUIDialogBuilder.java
Patch:
@@ -106,7 +106,6 @@ public static void setOnProvideDefaultTheme(OnProvideDefaultTheme onProvideDefau
 
     public QMUIDialogBuilder(Context context) {
         this.mContext = context;
-        mSkinManager = QMUISkinManager.defaultInstance(context);
     }
 
     public Context getBaseContext() {

File: qmui/src/main/java/com/qmuiteam/qmui/widget/dialog/QMUITipDialog.java
Patch:
@@ -113,7 +113,6 @@ public static class Builder {
 
         public Builder(Context context) {
             mContext = context;
-            mSkinManager = QMUISkinManager.defaultInstance(context);
         }
 
         /**
@@ -244,7 +243,6 @@ public static class CustomBuilder {
 
         public CustomBuilder(Context context) {
             mContext = context;
-            mSkinManager = QMUISkinManager.defaultInstance(context);
         }
 
         public CustomBuilder setSkinManager(@Nullable QMUISkinManager skinManager) {

File: qmui/src/main/java/com/qmuiteam/qmui/widget/popup/QMUIBasePopup.java
Patch:
@@ -52,9 +52,9 @@ public abstract class QMUIBasePopup<T extends QMUIBasePopup> {
     private QMUISkinManager mSkinManager;
     private QMUISkinManager.OnSkinChangeListener mOnSkinChangeListener = new QMUISkinManager.OnSkinChangeListener() {
         @Override
-        public void onSkinChange(int oldSkin, int newSkin) {
+        public void onSkinChange(QMUISkinManager skinManager, int oldSkin, int newSkin) {
             if (mDimAmountAttr != 0) {
-                Resources.Theme theme = QMUISkinManager.defaultInstance(mContext).getTheme(newSkin);
+                Resources.Theme theme = skinManager.getTheme(newSkin);
                 mDimAmount = QMUIResHelper.getAttrFloatValue(theme, mDimAmountAttr);
                 updateDimAmount(mDimAmount);
                 QMUIBasePopup.this.onSkinChange(oldSkin, newSkin);
@@ -87,7 +87,6 @@ public boolean onTouch(View v, MotionEvent event) {
 
     public QMUIBasePopup(Context context) {
         mContext = context;
-        mSkinManager = QMUISkinManager.defaultInstance(context);
         mWindowManager = (WindowManager) context.getSystemService(Context.WINDOW_SERVICE);
         mWindow = new PopupWindow(context);
         initWindow();

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/QDWebExplorerFragment.java
Patch:
@@ -32,6 +32,7 @@
 import android.widget.ProgressBar;
 import android.widget.ZoomButtonsController;
 
+import com.qmuiteam.qmui.skin.QMUISkinManager;
 import com.qmuiteam.qmui.util.QMUILangHelper;
 import com.qmuiteam.qmui.util.QMUIResHelper;
 import com.qmuiteam.qmui.widget.QMUITopBarLayout;
@@ -156,6 +157,7 @@ public void onClick(QMUIDialog dialog, int index) {
                                     popBackStack();
                                 }
                             })
+                            .setSkinManager(QMUISkinManager.defaultInstance(getContext()))
                             .show();
                 } else {
                     doDownload(url);

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/components/QDBottomSheetFragment.java
Patch:
@@ -23,6 +23,7 @@
 import android.widget.ListView;
 import android.widget.Toast;
 
+import com.qmuiteam.qmui.skin.QMUISkinManager;
 import com.qmuiteam.qmui.widget.QMUITopBarLayout;
 import com.qmuiteam.qmui.widget.dialog.QMUIBottomSheet;
 import com.qmuiteam.qmuidemo.R;
@@ -155,6 +156,7 @@ private void showSimpleBottomSheetList(boolean gravityCenter,
                                            boolean withMark) {
         QMUIBottomSheet.BottomListSheetBuilder builder = new QMUIBottomSheet.BottomListSheetBuilder(getActivity());
         builder.setGravityCenter(gravityCenter)
+                .setSkinManager(QMUISkinManager.defaultInstance(getContext()))
                 .setTitle(title)
                 .setAddCancelBtn(addCancelBtn)
                 .setAllowDrag(allowDragDismiss)
@@ -193,6 +195,7 @@ private void showSimpleBottomSheetGrid() {
                 .addItem(R.mipmap.icon_more_operation_share_chat, "分享到私信", TAG_SHARE_CHAT, QMUIBottomSheet.BottomGridSheetBuilder.FIRST_LINE)
                 .addItem(R.mipmap.icon_more_operation_save, "保存到本地", TAG_SHARE_LOCAL, QMUIBottomSheet.BottomGridSheetBuilder.SECOND_LINE)
                 .setAddCancelBtn(true)
+                .setSkinManager(QMUISkinManager.defaultInstance(getContext()))
                 .setOnSheetItemClickListener(new QMUIBottomSheet.BottomGridSheetBuilder.OnSheetItemClickListener() {
                     @Override
                     public void onClick(QMUIBottomSheet dialog, View itemView) {

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/lab/QDWebViewBridgeFragment.java
Patch:
@@ -21,6 +21,7 @@
 import android.webkit.WebChromeClient;
 import android.widget.Toast;
 
+import com.qmuiteam.qmui.skin.QMUISkinManager;
 import com.qmuiteam.qmui.util.QMUIDisplayHelper;
 import com.qmuiteam.qmui.widget.dialog.QMUIDialog;
 import com.qmuiteam.qmui.widget.dialog.QMUIDialogAction;
@@ -68,6 +69,7 @@ public void onClick(QMUIDialog dialog, int index) {
                                 dialog.dismiss();
                             }
                         }))
+                        .setSkinManager(QMUISkinManager.defaultInstance(getContext()))
                         .show();
             }
         });

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/lab/QDWebViewFixFragment.java
Patch:
@@ -20,6 +20,7 @@
 import android.view.View;
 import android.webkit.WebChromeClient;
 
+import com.qmuiteam.qmui.skin.QMUISkinManager;
 import com.qmuiteam.qmui.util.QMUIDisplayHelper;
 import com.qmuiteam.qmui.widget.dialog.QMUIDialog;
 import com.qmuiteam.qmui.widget.dialog.QMUIDialogAction;
@@ -61,6 +62,7 @@ public void onClick(QMUIDialog dialog, int index) {
                                 dialog.dismiss();
                             }
                         }))
+                        .setSkinManager(QMUISkinManager.defaultInstance(getContext()))
                         .show();
             }
         });

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/util/QDDrawableHelperFragment.java
Patch:
@@ -24,6 +24,7 @@
 import android.view.View;
 import android.widget.ImageView;
 
+import com.qmuiteam.qmui.skin.QMUISkinManager;
 import com.qmuiteam.qmui.util.QMUIDisplayHelper;
 import com.qmuiteam.qmui.util.QMUIDrawableHelper;
 import com.qmuiteam.qmui.util.QMUIViewHelper;
@@ -118,6 +119,7 @@ private void initContent() {
             @Override
             public void onClick(View v) {
                 QMUIDialog.CustomDialogBuilder dialogBuilder = new QMUIDialog.CustomDialogBuilder(getContext());
+                dialogBuilder.setSkinManager(QMUISkinManager.defaultInstance(getContext()));
                 dialogBuilder.setLayout(R.layout.drawablehelper_createfromview);
                 final QMUIDialog dialog = dialogBuilder.setTitle("示例效果（点击下图关闭本浮层）").create();
                 ImageView displayImageView = (ImageView) dialog.findViewById(R.id.createFromViewDisplay);

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/manager/UpgradeTipTask.java
Patch:
@@ -24,6 +24,7 @@
 import android.text.Spanned;
 import android.view.View;
 
+import com.qmuiteam.qmui.skin.QMUISkinManager;
 import com.qmuiteam.qmui.span.QMUIBlockSpaceSpan;
 import com.qmuiteam.qmui.span.QMUITouchableSpan;
 import com.qmuiteam.qmui.util.QMUIDisplayHelper;
@@ -53,6 +54,7 @@ public void upgrade(Activity activity) {
         String title = String.format(activity.getString(R.string.app_upgrade_tip_title), QMUIPackageHelper.getAppVersion(activity));
         CharSequence message = getUpgradeWord(activity);
         new QMUIDialog.MessageDialogBuilder(activity)
+                .setSkinManager(QMUISkinManager.defaultInstance(activity))
                 .setTitle(title)
                 .setMessage(message)
                 .create(R.style.ReleaseDialogTheme)

File: skin-maker/src/main/java/com/qmuiteam/qmui/skin/QMUISkinMaker.java
Patch:
@@ -569,6 +569,7 @@ interface ValueUpdater {
 
     private void chooseAttr(View anchorView, ValueWriter valueWriter) {
         SkinAttrChooseMakerPopup popup = new SkinAttrChooseMakerPopup(anchorView.getContext(), mAttrsInR, valueWriter);
+        popup.skinManager(QMUISkinManager.defaultInstance(anchorView.getContext()));
         popup.show(anchorView);
     }
 

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUITopBar.java
Patch:
@@ -274,8 +274,8 @@ public QMUIQQFaceView setSubTitle(String subTitle) {
      *
      * @param resId TopBar 的副标题 resId
      */
-    public void setSubTitle(int resId) {
-        setSubTitle(getResources().getString(resId));
+    public QMUIQQFaceView setSubTitle(int resId) {
+        return setSubTitle(getResources().getString(resId));
     }
 
     private QMUIQQFaceView getSubTitleView() {
@@ -288,7 +288,7 @@ private QMUIQQFaceView getSubTitleView() {
             mSubTitleView.setTextColor(mSubTitleTextColor);
             QMUISkinSimpleDefaultAttrProvider provider = new QMUISkinSimpleDefaultAttrProvider();
             provider.setDefaultSkinAttr(QMUISkinValueBuilder.TEXT_COLOR, R.attr.qmui_skin_support_topbar_subtitle_color);
-            mTitleView.setTag(R.id.qmui_skin_default_attr_provider, provider);
+            mSubTitleView.setTag(R.id.qmui_skin_default_attr_provider, provider);
             LinearLayout.LayoutParams titleLp = generateTitleViewAndSubTitleViewLp();
             titleLp.topMargin = QMUIDisplayHelper.dp2px(getContext(), 1);
             makeSureTitleContainerView().addView(mSubTitleView, titleLp);

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUITopBar.java
Patch:
@@ -674,7 +674,7 @@ int getTopBarHeight() {
      * @param alpha 取值范围：[0, 255]，255表示不透明
      */
     public void setBackgroundAlpha(int alpha) {
-        this.getBackground().setAlpha(alpha);
+        this.getBackground().mutate().setAlpha(alpha);
     }
 
     /**

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUITopBarLayout.java
Patch:
@@ -163,7 +163,7 @@ public void removeCenterViewAndTitleView() {
      * @param alpha 取值范围：[0, 255]，255表示不透明
      */
     public void setBackgroundAlpha(int alpha) {
-        this.getBackground().setAlpha(alpha);
+        this.getBackground().mutate().setAlpha(alpha);
     }
 
     /**

File: qmui/src/main/java/com/qmuiteam/qmui/nestedScroll/QMUIContinuousNestedTopDelegateLayout.java
Patch:
@@ -540,7 +540,7 @@ public void onNestedPreScroll(@NonNull View target, int dx, int dy, @NonNull int
         dispatchNestedPreScroll(dx, dy, consumed, null, type);
         int unconsumed = dy - consumed[1];
         if (unconsumed > 0) {
-            int topMargin = getPaddingTop() + (mHeaderView == null ? 0 : mHeaderView.getHeight());
+            int topMargin = Math.min(mOffsetRange, getPaddingTop() + (mHeaderView == null ? 0 : mHeaderView.getHeight()));
             if (mOffsetCurrent + unconsumed <= topMargin) {
                 offsetTo(mOffsetCurrent + unconsumed);
                 consumed[1] += unconsumed;

File: qmui/src/main/java/com/qmuiteam/qmui/skin/QMUISkinHelper.java
Patch:
@@ -94,7 +94,7 @@ public static void refreshViewSkin(@NonNull View view){
     public static void syncViewSkin(@NonNull View view, @NonNull View sourceView){
         QMUISkinManager.ViewSkinCurrent source = QMUISkinManager.getViewSkinCurrent(sourceView);
         if (source != null) {
-            QMUISkinManager.ViewSkinCurrent skin = QMUISkinManager.getViewSkinCurrent(sourceView);
+            QMUISkinManager.ViewSkinCurrent skin = QMUISkinManager.getViewSkinCurrent(view);
             if(!source.equals(skin)) {
                 QMUISkinManager.of(source.managerName, view.getContext()).dispatch(view, source.index);
             }

File: qmui/src/main/java/com/qmuiteam/qmui/widget/popup/QMUINormalPopup.java
Patch:
@@ -159,8 +159,8 @@ public T edgeProtection(int distance) {
 
     public T edgeProtection(int left, int top, int right, int bottom) {
         mEdgeProtectionLeft = left;
-        mEdgeProtectionRight = top;
-        mEdgeProtectionTop = right;
+        mEdgeProtectionTop = top;
+        mEdgeProtectionRight = right;
         mEdgeProtectionBottom = bottom;
         return (T) this;
     }
@@ -683,4 +683,4 @@ protected void dispatchDraw(Canvas canvas) {
             }
         }
     }
-}
\ No newline at end of file
+}

File: lintrule/src/main/java/com/qmuiteam/qmui/lint/QMUIJavaVectorDrawableDetector.java
Patch:
@@ -93,6 +93,7 @@ public void visitMethod(@NotNull JavaContext context,
                         // 若文件存在，并且包含首行包含 vector，则为 Vector Drawable，抛出警告
                         context.report(ISSUE_JAVA_VECTOR_DRAWABLE, method, context.getLocation(method), expression.toString() + " 为 Vector Drawable，请使用 getVectorDrawable 方法获取，避免 4.0 及以下版本的系统产生 Crash");
                     }
+                    reader.close();
                     fileInputStream.close();
                 } catch (Exception ignored) {
                 }

File: qmui/src/main/java/com/qmuiteam/qmui/recyclerView/QMUIRVDraggableScrollBar.java
Patch:
@@ -442,7 +442,7 @@ private int getCurrentOffset(@NonNull RecyclerView recyclerView) {
     }
 
     private float calculatePercent(@NonNull RecyclerView recyclerView) {
-        return getCurrentOffset(recyclerView) * 1f / getScrollRange(recyclerView);
+        return QMUILangHelper.constrain(getCurrentOffset(recyclerView) * 1f / getScrollRange(recyclerView), 0f, 1f);
     }
 
     public Drawable ensureScrollBar(Context context) {

File: qmui/src/main/java/com/qmuiteam/qmui/widget/dialog/QMUIBottomSheetBehavior.java
Patch:
@@ -20,11 +20,11 @@
 import android.view.View;
 import android.view.ViewGroup;
 
-import com.google.android.material.bottomsheet.BottomSheetBehavior;
-
 import androidx.annotation.NonNull;
 import androidx.coordinatorlayout.widget.CoordinatorLayout;
 
+import com.google.android.material.bottomsheet.BottomSheetBehavior;
+
 public class QMUIBottomSheetBehavior<V extends ViewGroup> extends BottomSheetBehavior<V> {
     private boolean mAllowDrag = true;
     private boolean mMotionEventCanDrag = true;

File: qmui/src/main/java/com/qmuiteam/qmui/widget/dialog/QMUIBottomSheetListItemView.java
Patch:
@@ -172,7 +172,6 @@ public void render(@NonNull QMUIBottomSheetListItemModel itemModel, boolean isCh
             }
         }
         builder.clear();
-        QMUISkinManager.defaultInstance(getContext()).refreshTheme(mIconView);
 
         mTextView.setText(itemModel.text);
         if(itemModel.typeface != null){
@@ -181,10 +180,10 @@ public void render(@NonNull QMUIBottomSheetListItemModel itemModel, boolean isCh
         if(itemModel.textSkinColorAttr != 0){
             builder.textColor(itemModel.textSkinColorAttr);
             QMUISkinHelper.setSkinValue(mTextView, builder);
+            mTextView.setTextColor(QMUISkinHelper.getSkinColorStateList(mTextView, itemModel.textSkinColorAttr));
         }else{
-            QMUISkinHelper.setSkinValue(mIconView, "");
+            QMUISkinHelper.setSkinValue(mTextView, "");
         }
-        QMUISkinManager.defaultInstance(getContext()).refreshTheme(mTextView);
 
         mRedPointView.setVisibility(itemModel.hasRedPoint ? View.VISIBLE : View.GONE);
 

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/activity/TranslucentActivity.java
Patch:
@@ -25,6 +25,7 @@
 import com.qmuiteam.qmui.arch.annotation.LatestVisitRecord;
 import com.qmuiteam.qmui.arch.record.RecordArgumentEditor;
 import com.qmuiteam.qmui.widget.QMUITopBar;
+import com.qmuiteam.qmui.widget.QMUITopBarLayout;
 import com.qmuiteam.qmuidemo.R;
 import com.qmuiteam.qmuidemo.base.BaseActivity;
 
@@ -39,7 +40,7 @@
 @LatestVisitRecord
 public class TranslucentActivity extends BaseActivity {
 
-    @BindView(R.id.topbar) QMUITopBar mTopBar;
+    @BindView(R.id.topbar) QMUITopBarLayout mTopBar;
 
     @Override
     protected void onCreate(Bundle savedInstanceState) {
@@ -55,7 +56,6 @@ protected void onCreate(Bundle savedInstanceState) {
     }
 
     private void initTopBar() {
-        mTopBar.setBackgroundColor(ContextCompat.getColor(this, R.color.app_color_theme_4));
         mTopBar.addLeftBackImageButton().setOnClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View v) {

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/lab/QDContinuousNestedScroll2Fragment.java
Patch:
@@ -56,7 +56,7 @@ protected void initCoordinatorLayout() {
         mCoordinatorLayout.addOnScrollListener(new QMUIContinuousNestedScrollLayout.OnScrollListener() {
 
             @Override
-            public void onScroll(int topCurrent, int topRange, int offsetCurrent,
+            public void onScroll(QMUIContinuousNestedScrollLayout scrollLayout, int topCurrent, int topRange, int offsetCurrent,
                                  int offsetRange, int bottomCurrent, int bottomRange) {
                 Log.i(TAG, String.format("topCurrent = %d; topRange = %d; " +
                                 "offsetCurrent = %d; offsetRange = %d; " +
@@ -65,7 +65,7 @@ public void onScroll(int topCurrent, int topRange, int offsetCurrent,
             }
 
             @Override
-            public void onScrollStateChange(int newScrollState, boolean fromTopBehavior) {
+            public void onScrollStateChange(QMUIContinuousNestedScrollLayout scrollLayout, int newScrollState, boolean fromTopBehavior) {
 
             }
         });

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/lab/QDContinuousNestedScroll7Fragment.java
Patch:
@@ -95,7 +95,7 @@ protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
 
         mCoordinatorLayout.addOnScrollListener(new QMUIContinuousNestedScrollLayout.OnScrollListener() {
             @Override
-            public void onScroll(int topCurrent, int topRange, int offsetCurrent,
+            public void onScroll(QMUIContinuousNestedScrollLayout scrollLayout, int topCurrent, int topRange, int offsetCurrent,
                                  int offsetRange, int bottomCurrent, int bottomRange) {
                 Log.i(TAG, String.format("topCurrent = %d; topRange = %d; " +
                                 "offsetCurrent = %d; offsetRange = %d; " +
@@ -104,7 +104,7 @@ public void onScroll(int topCurrent, int topRange, int offsetCurrent,
             }
 
             @Override
-            public void onScrollStateChange(int newScrollState, boolean fromTopBehavior) {
+            public void onScrollStateChange(QMUIContinuousNestedScrollLayout scrollLayout, int newScrollState, boolean fromTopBehavior) {
                 Log.i(TAG, String.format("newScrollState = %d; fromTopBehavior = %b",
                         newScrollState, fromTopBehavior));
             }

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/lab/QDContinuousNestedScroll8Fragment.java
Patch:
@@ -113,7 +113,7 @@ public RecyclerView.LayoutParams generateDefaultLayoutParams() {
 
         mCoordinatorLayout.addOnScrollListener(new QMUIContinuousNestedScrollLayout.OnScrollListener() {
             @Override
-            public void onScroll(int topCurrent, int topRange, int offsetCurrent,
+            public void onScroll(QMUIContinuousNestedScrollLayout scrollLayout, int topCurrent, int topRange, int offsetCurrent,
                                  int offsetRange, int bottomCurrent, int bottomRange) {
                 Log.i(TAG, String.format("topCurrent = %d; topRange = %d; " +
                                 "offsetCurrent = %d; offsetRange = %d; " +
@@ -122,7 +122,7 @@ public void onScroll(int topCurrent, int topRange, int offsetCurrent,
             }
 
             @Override
-            public void onScrollStateChange(int newScrollState, boolean fromTopBehavior) {
+            public void onScrollStateChange(QMUIContinuousNestedScrollLayout scrollLayout, int newScrollState, boolean fromTopBehavior) {
 
             }
         });

File: qmui/src/main/java/com/qmuiteam/qmui/qqface/QMUIQQFaceView.java
Patch:
@@ -1496,7 +1496,7 @@ private void drawQQFace(Canvas canvas, int res, @Nullable Drawable specialDrawab
         }
         int top = getPaddingTop();
         if (line > 1) {
-            top = (line - 1) * (mFontHeight + mLineSpace) + top;
+            top = mCurrentDrawBaseLine - mFirstBaseLine;
         }
         canvas.save();
         canvas.translate(mCurrentDrawUsedWidth, top);

File: skin-maker/src/main/java/com/qmuiteam/qmui/skin/QMUISkinMaker.java
Patch:
@@ -842,6 +842,9 @@ protected Boolean doInBackground(Void... voids) {
             }
             MMKV kv = MMKV.mmkvWithID(MMKV_ID);
             String[] keys = kv.allKeys();
+            if(keys == null || keys.length == 0){
+                return false;
+            }
             HashMap<String, ArrayList<String>> result = new HashMap<>();
             for (String key : keys) {
                 String value = kv.decodeString(key);

File: arch/src/main/java/com/qmuiteam/qmui/arch/QMUIActivity.java
Patch:
@@ -107,7 +107,8 @@ public void onScrollOverThreshold() {
     private SwipeBackLayout.Callback mSwipeCallback = new SwipeBackLayout.Callback() {
         @Override
         public boolean canSwipeBack(SwipeBackLayout layout, int dragDirection, int moveEdge) {
-            return QMUISwipeBackActivityManager.getInstance().canSwipeBack() && canDragBack();
+            return QMUISwipeBackActivityManager.getInstance().canSwipeBack() &&
+                    canDragBack(layout.getContext(), dragDirection, moveEdge);
         }
 
         @Override

File: arch/src/main/java/com/qmuiteam/qmui/arch/InnerBaseActivity.java
Patch:
@@ -46,7 +46,8 @@ class InnerBaseActivity extends AppCompatActivity implements LatestVisitArgument
     protected void onCreate(@Nullable Bundle savedInstanceState) {
         if(followSkin()){
             LayoutInflater layoutInflater = LayoutInflater.from(this);
-            LayoutInflaterCompat.setFactory2(layoutInflater, new QMUISkinLayoutInflaterFactory(this));
+            LayoutInflaterCompat.setFactory2(layoutInflater,
+                    new QMUISkinLayoutInflaterFactory(this, layoutInflater));
         }
         super.onCreate(savedInstanceState);
     }

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/components/qqface/QDQQFaceUsageFragment.java
Patch:
@@ -18,6 +18,7 @@
 
 import android.graphics.Color;
 import android.text.SpannableString;
+import android.text.Spanned;
 import android.view.Gravity;
 import android.view.LayoutInflater;
 import android.view.View;

File: qmui/src/main/java/com/qmuiteam/qmui/nestedScroll/QMUIContinuousNestedScrollLayout.java
Patch:
@@ -333,7 +333,7 @@ public void onNestedScroll(View target, int dxConsumed, int dyConsumed, int dxUn
         super.onNestedScroll(target, dxConsumed, dyConsumed, dxUnconsumed, dyUnconsumed, type);
         if(dyUnconsumed > 0 && getCurrentScroll() >= getScrollRange()){
             // RecyclerView does not stop scroller when over scroll with NestedScrollingParent
-            mBottomView.stopScroll();
+            stopScroll();
         }
     }
 

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/manager/QDSkinManager.java
Patch:
@@ -74,7 +74,7 @@ public static void register(Activity activity) {
     }
 
     public static void unRegister(Activity activity) {
-        for (int i = mListenActivityList.size() - 1; i >= 0; i++) {
+        for (int i = mListenActivityList.size() - 1; i >= 0; i--) {
             WeakReference<Activity> wr = mListenActivityList.get(i);
             if (wr.get() == null || wr.get() == activity) {
                 mListenActivityList.remove(wr);

File: qmui/src/main/java/com/qmuiteam/qmui/nestedScroll/QMUIContinuousNestedTopAreaBehavior.java
Patch:
@@ -29,6 +29,7 @@
 import androidx.annotation.NonNull;
 import androidx.coordinatorlayout.widget.CoordinatorLayout;
 import androidx.core.view.ViewCompat;
+import static android.view.View.MEASURED_SIZE_MASK;
 import static com.qmuiteam.qmui.QMUIInterpolatorStaticHolder.QUNITIC_INTERPOLATOR;
 
 public class QMUIContinuousNestedTopAreaBehavior extends QMUIViewOffsetBehavior<View> {
@@ -272,7 +273,7 @@ public boolean onMeasureChild(@NonNull CoordinatorLayout parent, @NonNull View c
 
         } else {
             parent.onMeasureChild(child, parentWidthMeasureSpec, widthUsed,
-                    View.MeasureSpec.makeMeasureSpec(availableHeight, View.MeasureSpec.UNSPECIFIED), heightUsed);
+                    View.MeasureSpec.makeMeasureSpec(MEASURED_SIZE_MASK, View.MeasureSpec.AT_MOST), heightUsed);
         }
         return true;
     }

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUIViewPager.java
Patch:
@@ -152,7 +152,7 @@ public WrapperPagerAdapter(QMUIPagerAdapter adapter) {
         @Override
         public int getCount() {
             int count = mAdapter.getCount();
-            if (mEnableLoop && count >= 3) {
+            if (mEnableLoop && count > 3) {
                 count *= mInfiniteRatio;
             }
             return count;

File: arch-compiler/src/main/java/com/qmuiteam/qmui/arch/FirstFragmentProcessor.java
Patch:
@@ -125,9 +125,8 @@ private void processCodeGeneration(TypeElement container, TypeElement[] fragment
         ExecutableElement iGetIdByFragmentClass = getOverrideMethod(
                 FirstFragmentFinderName, "getIdByFragmentClass");
         MethodSpec.Builder getIdByFragmentClass = MethodSpec.overriding(iGetIdByFragmentClass)
-                .addStatement("return mClassToIdMap.getOrDefault($L, $T.NO_ID)",
-                        iGetIdByFragmentClass.getParameters().get(0).getSimpleName().toString(),
-                        FirstFragmentFinderName);
+                .addStatement("Integer id = mClassToIdMap.get($L)", iGetIdByFragmentClass.getParameters().get(0).getSimpleName().toString())
+                .addStatement("return id != null ? id :$T.NO_ID", FirstFragmentFinderName);
 
         try {
             finderClassBuilder

File: qmui/src/main/java/com/qmuiteam/qmui/nestedScroll/QMUIContinuousNestedScrollLayout.java
Patch:
@@ -272,6 +272,9 @@ public void checkLayout() {
 
         if (offsetCurrent >= offsetRange || (offsetCurrent > 0 && mKeepBottomAreaStableWhenCheckLayout)) {
             mTopView.consumeScroll(Integer.MAX_VALUE);
+            if(mBottomView.getCurrentScroll() > 0){
+                mTopAreaBehavior.setTopAndBottomOffset(-offsetRange);
+            }
             return;
         }
 

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/components/QDDialogFragment.java
Patch:
@@ -409,7 +409,7 @@ public View onBuildContent(QMUIDialog dialog, ScrollView parent) {
             textView.setText("观察聚焦输入框后，键盘升起降下时 dialog 的高度自适应变化。\n\n" +
                     "QMUI Android 的设计目的是用于辅助快速搭建一个具备基本设计还原效果的 Android 项目，" +
                     "同时利用自身提供的丰富控件及兼容处理，让开发者能专注于业务需求而无需耗费精力在基础代码的设计上。" +
-                    "不管是新项目的创建，或是已有项目的维护，均可使开发效率和项目质量得到大幅度提升。");
+                    "不管是新项目的创建，或是已有项目的维护，均可使开发效率和项目质量得到大幅度提升。\n\n QMUI Android 的设计目的是用于辅助快速搭建一个具备基本设计还原效果的 Android 项目。");
             textView.setTextColor(ContextCompat.getColor(getContext(), R.color.app_color_description));
             textView.setLayoutParams(new LinearLayout.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.WRAP_CONTENT));
             layout.addView(textView);

File: arch/src/main/java/com/qmuiteam/qmui/arch/QMUIFragmentActivity.java
Patch:
@@ -266,7 +266,7 @@ public void popBackStack() {
             if (toExec != null) {
                 if (toExec instanceof QMUIFragment) {
                     QMUIFragment mFragment = (QMUIFragment) toExec;
-                    startFragment(mFragment);
+                    startFragmentAndDestroyCurrent(mFragment, false);
                 } else if (toExec instanceof Intent) {
                     Intent intent = (Intent) toExec;
                     startActivity(intent);

File: arch/src/main/java/com/qmuiteam/qmui/arch/QMUILatestVisit.java
Patch:
@@ -4,14 +4,15 @@
 import android.content.Context;
 import android.content.Intent;
 import android.os.Bundle;
-import android.support.annotation.MainThread;
 
 import com.qmuiteam.qmui.arch.record.DefaultLatestVisitStorage;
 import com.qmuiteam.qmui.arch.record.QMUILatestVisitStorage;
 import com.qmuiteam.qmui.arch.record.RecordArgumentEditor;
 import com.qmuiteam.qmui.arch.record.RecordArgumentEditorImpl;
 import com.qmuiteam.qmui.arch.record.RecordIdClassMap;
 
+import androidx.annotation.MainThread;
+
 public class QMUILatestVisit {
     private static QMUILatestVisit sInstance;
     private QMUILatestVisitStorage mStorage;

File: arch/src/main/java/com/qmuiteam/qmui/arch/record/DefaultLatestVisitStorage.java
Patch:
@@ -4,11 +4,12 @@
 import android.content.Intent;
 import android.content.SharedPreferences;
 import android.os.Bundle;
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
 
 import java.util.Map;
 
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+
 public class DefaultLatestVisitStorage implements QMUILatestVisitStorage {
 
     private static final String SP_NAME = "qmui_latest_visit";

File: arch/src/main/java/com/qmuiteam/qmui/arch/record/QMUILatestVisitStorage.java
Patch:
@@ -2,11 +2,12 @@
 
 import android.content.Intent;
 import android.os.Bundle;
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
 
 import java.util.Map;
 
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
+
 public interface QMUILatestVisitStorage {
 
     int NOT_EXIST = -1;

File: arch/src/main/java/com/qmuiteam/qmui/arch/record/RecordArgumentEditor.java
Patch:
@@ -1,9 +1,9 @@
 package com.qmuiteam.qmui.arch.record;
 
-import android.support.annotation.Nullable;
-
 import java.util.Map;
 
+import androidx.annotation.Nullable;
+
 public interface RecordArgumentEditor {
 
     RecordArgumentEditor putString(String key, @Nullable String value);

File: arch/src/main/java/com/qmuiteam/qmui/arch/record/RecordArgumentEditorImpl.java
Patch:
@@ -1,10 +1,10 @@
 package com.qmuiteam.qmui.arch.record;
 
-import android.support.annotation.Nullable;
-
 import java.util.HashMap;
 import java.util.Map;
 
+import androidx.annotation.Nullable;
+
 
 public class RecordArgumentEditorImpl implements RecordArgumentEditor {
 

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUIRadiusImageView.java
Patch:
@@ -520,7 +520,7 @@ private void drawBorder(Canvas canvas, int borderWidth) {
         mBorderPaint.setStrokeWidth(borderWidth);
         if (mIsCircle) {
             canvas.drawCircle(mRectF.centerX(), mRectF.centerY(),
-                    Math.min(mRectF.width(), mRectF.height()) - halfBorderWidth, mBorderPaint);
+                    Math.min(mRectF.width(), mRectF.height()) / 2 - halfBorderWidth, mBorderPaint);
         } else {
             mDrawRectF.left = mRectF.left + halfBorderWidth;
             //noinspection SuspiciousNameCombination

File: qmui/src/main/java/com/qmuiteam/qmui/util/QMUINotchHelper.java
Patch:
@@ -471,12 +471,12 @@ public static boolean isNotchOfficialSupport(){
     }
 
     /**
-     * fitSystemWindows 对小米挖孔屏横屏挖孔区域无效
+     * fitSystemWindows 对小米、vivo挖孔屏横屏挖孔区域无效
      * @param view
      * @return
      */
     public static boolean needFixLandscapeNotchAreaFitSystemWindow(View view){
-       return QMUIDeviceHelper.isXiaomi() && QMUINotchHelper.hasNotch(view);
+       return (QMUIDeviceHelper.isXiaomi() || QMUIDeviceHelper.isVivo()) && QMUINotchHelper.hasNotch(view);
     }
 
 }

File: qmui/src/main/java/com/qmuiteam/qmui/widget/section/QMUISectionDiffCallback.java
Patch:
@@ -81,7 +81,7 @@ private void generateIndex(List<QMUISection<H, T>> list,
                 continue;
             }
             generationInfo.appendIndex(i, ITEM_INDEX_SECTION_HEADER);
-            if (section.isFold() || section.getItemCount() == 0) {
+            if (section.isFold()) {
                 continue;
             }
             onGenerateCustomIndexBeforeItemList(generationInfo, section, i);

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUITopBar.java
Patch:
@@ -145,7 +145,7 @@ private void init(Context context, AttributeSet attrs, int defStyleAttr) {
     }
 
     void getCommonFieldFormTypedArray(Context context, TypedArray array) {
-        mLeftBackDrawableRes = array.getResourceId(R.styleable.QMUITopBar_qmui_topbar_left_back_drawable_id, R.id.qmui_topbar_item_left_back);
+        mLeftBackDrawableRes = array.getResourceId(R.styleable.QMUITopBar_qmui_topbar_left_back_drawable_id, R.drawable.qmui_icon_topbar_back);
         mTitleGravity = array.getInt(R.styleable.QMUITopBar_qmui_topbar_title_gravity, Gravity.CENTER);
         mTitleTextSize = array.getDimensionPixelSize(R.styleable.QMUITopBar_qmui_topbar_title_text_size, QMUIDisplayHelper.sp2px(context, 17));
         mTitleTextSizeWithSubTitle = array.getDimensionPixelSize(R.styleable.QMUITopBar_qmui_topbar_title_text_size, QMUIDisplayHelper.sp2px(context, 16));

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/lab/QDContinuousNestedScroll1Fragment.java
Patch:
@@ -16,6 +16,7 @@
 
 package com.qmuiteam.qmuidemo.fragment.lab;
 
+import android.os.Bundle;
 import android.view.View;
 import android.view.ViewGroup;
 import android.widget.Toast;
@@ -37,6 +38,7 @@
 import java.util.Collections;
 import java.util.List;
 
+import androidx.annotation.Nullable;
 import androidx.coordinatorlayout.widget.CoordinatorLayout;
 import androidx.recyclerview.widget.LinearLayoutManager;
 import androidx.recyclerview.widget.RecyclerView;

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/util/QDNotchHelperFragment.java
Patch:
@@ -26,15 +26,13 @@
 import android.widget.FrameLayout;
 import android.widget.TextView;
 
-import com.qmuiteam.qmui.arch.annotation.MaybeFirstIn;
 import com.qmuiteam.qmui.util.QMUIDisplayHelper;
 import com.qmuiteam.qmui.util.QMUIResHelper;
 import com.qmuiteam.qmui.util.QMUIViewHelper;
 import com.qmuiteam.qmui.widget.QMUITopBarLayout;
 import com.qmuiteam.qmui.widget.tab.QMUITab;
 import com.qmuiteam.qmui.widget.tab.QMUITabBuilder;
 import com.qmuiteam.qmui.widget.tab.QMUITabSegment;
-import com.qmuiteam.qmuidemo.QDMainActivity;
 import com.qmuiteam.qmuidemo.R;
 import com.qmuiteam.qmuidemo.base.BaseFragment;
 import com.qmuiteam.qmuidemo.lib.Group;
@@ -48,7 +46,6 @@
 import butterknife.ButterKnife;
 import butterknife.OnClick;
 
-@MaybeFirstIn(container = {QDMainActivity.class})
 @Widget(group = Group.Helper, name = "QMUINotchHelper", iconRes = R.mipmap.icon_grid_status_bar_helper)
 public class QDNotchHelperFragment extends BaseFragment {
     private static final String TAG = "QDNotchHelperFragment";

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUIPagerAdapter.java
Patch:
@@ -67,14 +67,14 @@ public final void destroyItem(@NonNull ViewGroup container, int position, @NonNu
     /**
      * sometimes you may need to perform some operations on all items,
      * such as perform cleanup when the ViewPager is destroyed
-     * notice: this not
+     * once the action return true, then do not handle remain items
      *
      * @param action
      */
     public void each(@NonNull Action action) {
         int size = mScrapItems.size();
         for (int i = 0; i < size; i++) {
-            Object item = mScrapItems.indexOfValue(i);
+            Object item = mScrapItems.valueAt(i);
             if (action.call(item)) {
                 break;
             }

File: arch-compiler/src/main/java/com/qmuiteam/qmui/arch/ArchProcessor.java
Patch:
@@ -211,7 +211,7 @@ private ExecutableElement getOverrideMethod(ClassName creator, String methodName
                 return (ExecutableElement) ele;
             }
         }
-        throw new RuntimeException("method createHRouterRule of interface HRouterRuleCreator not found");
+        throw new RuntimeException(String.format("method %s of interface FirstFragmentFinder not found", methodName));
     }
 
     private void error(Element element, String message, Object... args) {

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/manager/UpgradeTipTask.java
Patch:
@@ -68,7 +68,7 @@ private void appendBlockSpace(Context context, SpannableStringBuilder builder) {
     public CharSequence getUpgradeWord(final Activity activity) {
         SpannableStringBuilder text = new SpannableStringBuilder();
         if(mNewVersion == QDUpgradeManager.VERSION_1_4_0){
-            text.append("1. Updated arch library to 0.5.0. Provide annotation MaybeFirstIn and DefaultFirstFragment.\n");
+            text.append("1. Updated arch library to 0.6.0. Provide annotation MaybeFirstIn and DefaultFirstFragment.\n");
             text.append("2. Updated lint library to 1.1.0 to Support Android Studio 3.4+.\n");
             text.append("3. Replaced parent theme of QMUI.Compat with Theme.AppCompat.DayNight.\n");
             text.append("4. Fixed issues: ");

File: arch/src/main/java/com/qmuiteam/qmui/arch/QMUIActivity.java
Patch:
@@ -62,7 +62,7 @@ public void onScroll(int edgeFlag, float scrollPercent) {
             if (mSwipeBackgroundView != null) {
                 scrollPercent = Math.max(0f, Math.min(1f, scrollPercent));
                 int targetOffset = (int) (Math.abs(backViewInitOffset()) * (1 - scrollPercent));
-                SwipeBackLayout.offsetInScroll(mSwipeBackgroundView, edgeFlag, targetOffset);
+                SwipeBackLayout.offsetInSwipeBack(mSwipeBackgroundView, edgeFlag, targetOffset);
             }
         }
 
@@ -82,7 +82,7 @@ public void onEdgeTouch(int edgeFlag) {
                             ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT));
                 }
                 mSwipeBackgroundView.bind(prevActivity, QMUIActivity.this, restoreSubWindowWhenDragBack());
-                SwipeBackLayout.offsetInEdgeTouch(mSwipeBackgroundView, edgeFlag,
+                SwipeBackLayout.offsetInSwipeBack(mSwipeBackgroundView, edgeFlag,
                         Math.abs(backViewInitOffset()));
             }
         }

File: arch/src/main/java/com/qmuiteam/qmui/arch/Utils.java
Patch:
@@ -248,7 +248,6 @@ static Field getOpPopExitAnimField(Object op) {
         return getOpField(op, "mPopExitAnim", "popExitAnim");
     }
 
-
     interface OpHandler {
         boolean handle(Object op);
 

File: qmui/src/main/java/com/qmuiteam/qmui/widget/dialog/QMUIDialog.java
Patch:
@@ -27,6 +27,8 @@
 import android.os.Build;
 import android.os.Bundle;
 import androidx.annotation.LayoutRes;
+import androidx.appcompat.widget.AppCompatEditText;
+
 import android.text.InputType;
 import android.text.method.TransformationMethod;
 import android.view.Gravity;
@@ -405,7 +407,7 @@ public EditTextDialogBuilder setInputType(int inputType) {
 
         @Override
         protected void onCreateContent(QMUIDialog dialog, ViewGroup parent, Context context) {
-            mEditText = new EditText(context);
+            mEditText = new AppCompatEditText(context);
             MessageDialogBuilder.assignMessageTvWithAttr(mEditText, hasTitle(), R.attr.qmui_dialog_edit_content_style);
             mEditText.setFocusable(true);
             mEditText.setFocusableInTouchMode(true);

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/lab/QDContinuousNestedScrollBaseFragment.java
Patch:
@@ -17,7 +17,6 @@
 package com.qmuiteam.qmuidemo.fragment.lab;
 
 import android.os.Bundle;
-import android.support.annotation.Nullable;
 import android.view.LayoutInflater;
 import android.view.View;
 

File: qmui/src/main/java/com/qmuiteam/qmui/nestedScroll/IQMUIContinuousNestedScrollCommon.java
Patch:
@@ -17,11 +17,11 @@
 package com.qmuiteam.qmui.nestedScroll;
 
 import android.os.Bundle;
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
-import android.support.v7.widget.RecyclerView;
 import android.view.View;
 
+import androidx.annotation.NonNull;
+import androidx.recyclerview.widget.RecyclerView;
+
 public interface IQMUIContinuousNestedScrollCommon {
 
     int SCROLL_STATE_IDLE = RecyclerView.SCROLL_STATE_IDLE;

File: qmui/src/main/java/com/qmuiteam/qmui/nestedScroll/QMUIContinuousNestedTopLinearLayout.java
Patch:
@@ -18,11 +18,12 @@
 
 import android.content.Context;
 import android.os.Bundle;
-import android.support.annotation.NonNull;
 import android.util.AttributeSet;
 
 import com.qmuiteam.qmui.layout.QMUILinearLayout;
 
+import androidx.annotation.NonNull;
+
 public class QMUIContinuousNestedTopLinearLayout extends QMUILinearLayout implements IQMUIContinuousNestedTopView {
 
 

File: qmui/src/main/java/com/qmuiteam/qmui/nestedScroll/QMUIContinuousNestedTopWebView.java
Patch:
@@ -19,12 +19,13 @@
 import android.content.Context;
 import android.os.Build;
 import android.os.Bundle;
-import android.support.annotation.NonNull;
 import android.util.AttributeSet;
 
 import com.qmuiteam.qmui.util.QMUIDisplayHelper;
 import com.qmuiteam.qmui.widget.webview.QMUIWebView;
 
+import androidx.annotation.NonNull;
+
 public class QMUIContinuousNestedTopWebView extends QMUIWebView implements IQMUIContinuousNestedTopView {
 
     public static final String KEY_SCROLL_INFO = "@qmui_scroll_info_top_webview";

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUIProgressBar.java
Patch:
@@ -23,14 +23,15 @@
 import android.graphics.Paint;
 import android.graphics.Point;
 import android.graphics.RectF;
-import android.support.v4.view.ViewCompat;
 import android.util.AttributeSet;
 import android.util.Log;
 import android.view.View;
 
 import com.qmuiteam.qmui.R;
 import com.qmuiteam.qmui.util.QMUIDisplayHelper;
 
+import androidx.core.view.ViewCompat;
+
 /**
  * 一个进度条控件，通过颜色变化显示进度，支持环形和矩形两种形式，主要特性如下：
  * <ol>

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/lab/QDContinuousNestedScrollFragment.java
Patch:
@@ -17,7 +17,6 @@
 package com.qmuiteam.qmuidemo.fragment.lab;
 
 import android.os.Bundle;
-import android.support.annotation.Nullable;
 import android.view.LayoutInflater;
 import android.view.View;
 
@@ -30,6 +29,7 @@
 import com.qmuiteam.qmuidemo.lib.annotation.Widget;
 import com.qmuiteam.qmuidemo.manager.QDDataManager;
 
+import androidx.annotation.Nullable;
 import butterknife.BindView;
 import butterknife.ButterKnife;
 

File: qmui/src/main/java/com/qmuiteam/qmui/nestedScroll/QMUIContinuousNestedTopDelegateLayout.java
Patch:
@@ -544,11 +544,12 @@ public void onNestedPreScroll(@NonNull View target, int dx, int dy, @NonNull int
                 offsetTo(topMargin);
             }
         } else if (unconsumed < 0) {
-            int b = mOffsetRange + getHeight() - getPaddingBottom() - (mFooterView != null ? mFooterView.getHeight() : 0);
+            int bottomMargin = getPaddingBottom() + (mFooterView != null ? mFooterView.getHeight() : 0);
+            int b = mOffsetRange - bottomMargin;
             if (mOffsetCurrent + unconsumed >= b) {
                 offsetTo(mOffsetCurrent + unconsumed);
                 consumed[1] += unconsumed;
-            } else if (mOffsetRange > b) {
+            } else if (mOffsetCurrent > b) {
                 consumed[1] += b - mOffsetCurrent;
                 offsetTo(b);
             }

File: qmui/src/main/java/com/qmuiteam/qmui/nestedScroll/QMUIContinuousNestedTopDelegateLayout.java
Patch:
@@ -551,7 +551,7 @@ public void onNestedPreScroll(@NonNull View target, int dx, int dy, @NonNull int
                 offsetTo(topMargin);
             }
         } else if (unconsumed < 0) {
-            int b = mOffsetRange - getPaddingBottom() - (mFooterView != null ? mFooterView.getHeight() : 0);
+            int b = mOffsetRange + getHeight() - getPaddingBottom() - (mFooterView != null ? mFooterView.getHeight() : 0);
             if (mOffsetCurrent + unconsumed >= b) {
                 offsetTo(mOffsetCurrent + unconsumed);
                 consumed[1] += unconsumed;

File: qmui/src/main/java/com/qmuiteam/qmui/nestedScroll/QMUIContinuousNestedBottomDelegateLayout.java
Patch:
@@ -485,7 +485,7 @@ private void ensureVelocityTracker() {
     }
 
     @Override
-    public boolean onInterceptHoverEvent(MotionEvent ev) {
+    public boolean onInterceptTouchEvent(MotionEvent ev) {
         if (touchSlop < 0) {
             touchSlop = ViewConfiguration.get(getContext()).getScaledTouchSlop();
         }
@@ -504,6 +504,7 @@ public boolean onInterceptHoverEvent(MotionEvent ev) {
                 if (isPointInHeaderBounds(x, y)) {
                     lastMotionY = y;
                     this.activePointerId = ev.getPointerId(0);
+                    startNestedScroll(ViewCompat.SCROLL_AXIS_VERTICAL, ViewCompat.TYPE_TOUCH);
                 }
                 break;
             }
@@ -539,6 +540,7 @@ public boolean onInterceptHoverEvent(MotionEvent ev) {
             case MotionEvent.ACTION_UP: {
                 isBeingDragged = false;
                 this.activePointerId = INVALID_POINTER;
+                stopNestedScroll(ViewCompat.TYPE_TOUCH);
                 break;
             }
         }

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/lab/QDContinuousNestedScroll7Fragment.java
Patch:
@@ -105,7 +105,8 @@ public void onScroll(int topCurrent, int topRange, int offsetCurrent,
 
             @Override
             public void onScrollStateChange(int newScrollState, boolean fromTopBehavior) {
-
+                Log.i(TAG, String.format("newScrollState = %d; fromTopBehavior = %b",
+                        newScrollState, fromTopBehavior));
             }
         });
     }

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUIProgressBar.java
Patch:
@@ -265,7 +265,9 @@ private void drawCircle(Canvas canvas) {
         mArcOval.right = mCenterPoint.x + mCircleRadius;
         mArcOval.top = mCenterPoint.y - mCircleRadius;
         mArcOval.bottom = mCenterPoint.y + mCircleRadius;
-        canvas.drawArc(mArcOval, 270, 360 * mValue / mMaxValue, false, mPaint);
+        if(mValue > 0){
+            canvas.drawArc(mArcOval, 270, 360f * mValue / mMaxValue, false, mPaint);
+        }
         if (mText != null && mText.length() > 0) {
             Paint.FontMetricsInt fontMetrics = mTextPaint.getFontMetricsInt();
             float baseline = mArcOval.top + (mArcOval.height() - fontMetrics.bottom + fontMetrics.top) / 2 - fontMetrics.top;

File: qmui/src/main/java/com/qmuiteam/qmui/nestedScroll/IQMUIContinuousNestedScrollCommon.java
Patch:
@@ -16,10 +16,11 @@
 
 package com.qmuiteam.qmui.nestedScroll;
 
-import android.support.annotation.Nullable;
-import android.support.v7.widget.RecyclerView;
 import android.view.View;
 
+import androidx.annotation.Nullable;
+import androidx.recyclerview.widget.RecyclerView;
+
 public interface IQMUIContinuousNestedScrollCommon {
 
     int SCROLL_STATE_IDLE = RecyclerView.SCROLL_STATE_IDLE;

File: qmui/src/main/java/com/qmuiteam/qmui/nestedScroll/QMUIContinuousNestedTopAreaBehavior.java
Patch:
@@ -229,7 +229,7 @@ void scroll(@NonNull CoordinatorLayout parent, @NonNull View child, int dy) {
             unConsumed = ((IQMUIContinuousNestedTopView) child).consumeScroll(unConsumed);
         }
         onNestedScroll(parent, child, child, 0, dy - unConsumed,
-                0, unConsumed, ViewCompat.TYPE_TOUCH, mScrollConsumed);
+                0, unConsumed, ViewCompat.TYPE_TOUCH);
 
     }
 
@@ -318,8 +318,7 @@ public void onNestedPreScroll(@NonNull CoordinatorLayout parent, @NonNull View c
     @Override
     public void onNestedScroll(@NonNull CoordinatorLayout parent, @NonNull View child,
                                @NonNull View target, int dxConsumed, int dyConsumed,
-                               int dxUnconsumed, int dyUnconsumed,
-                               int type, @NonNull int[] consumed) {
+                               int dxUnconsumed, int dyUnconsumed, int type) {
         if (target.getParent() != parent) {
             return;
         }

File: qmui/src/main/java/com/qmuiteam/qmui/util/QMUIViewHelper.java
Patch:
@@ -35,6 +35,7 @@
 import android.graphics.drawable.Drawable;
 import android.os.Build;
 import androidx.annotation.ColorInt;
+import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 import androidx.core.content.ContextCompat;
 import android.view.TouchDelegate;

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/lab/QDContinuousNestedScroll2Fragment.java
Patch:
@@ -16,7 +16,6 @@
 
 package com.qmuiteam.qmuidemo.fragment.lab;
 
-import android.support.design.widget.CoordinatorLayout;
 import android.util.Log;
 import android.view.ViewGroup;
 
@@ -28,6 +27,8 @@
 import com.qmuiteam.qmuidemo.lib.Group;
 import com.qmuiteam.qmuidemo.lib.annotation.Widget;
 
+import androidx.coordinatorlayout.widget.CoordinatorLayout;
+
 @Widget(group = Group.Other, name = "webview + part sticky header + viewpager")
 public class QDContinuousNestedScroll2Fragment extends QDContinuousNestedScrollBaseFragment {
     private static final String TAG = "ContinuousNestedScroll";

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/lab/QDContinuousNestedScroll7Fragment.java
Patch:
@@ -17,8 +17,6 @@
 package com.qmuiteam.qmuidemo.fragment.lab;
 
 import android.graphics.Color;
-import android.support.design.widget.CoordinatorLayout;
-import android.support.v7.widget.AppCompatTextView;
 import android.util.Log;
 import android.view.Gravity;
 import android.view.ViewGroup;
@@ -32,6 +30,9 @@
 import com.qmuiteam.qmuidemo.lib.Group;
 import com.qmuiteam.qmuidemo.lib.annotation.Widget;
 
+import androidx.appcompat.widget.AppCompatTextView;
+import androidx.coordinatorlayout.widget.CoordinatorLayout;
+
 @Widget(group = Group.Other, name = "(header + webview + bottom) + (part sticky header + viewpager)")
 public class QDContinuousNestedScroll7Fragment extends QDContinuousNestedScrollBaseFragment {
     private static final String TAG = "ContinuousNestedScroll";

File: qmui/src/main/java/com/qmuiteam/qmui/widget/section/QMUIStickySectionItemDecoration.java
Patch:
@@ -83,6 +83,7 @@ private void setHeaderVisibility(boolean visibility) {
     public void onDrawOver(@NonNull Canvas c, @NonNull RecyclerView parent,
                            @NonNull RecyclerView.State state) {
 
+
         ViewGroup sectionContainer = mWeakSectionContainer.get();
         if (sectionContainer == null || parent.getChildCount() == 0) {
             return;
@@ -127,7 +128,7 @@ public void onDrawOver(@NonNull Canvas c, @NonNull RecyclerView parent,
 
         setHeaderVisibility(true);
 
-        int contactPoint = sectionContainer.getHeight();
+        int contactPoint = sectionContainer.getHeight() - 1;
         final View childInContact = parent.findChildViewUnder(parent.getWidth() / 2, contactPoint);
         if (childInContact == null) {
             mTargetTop = parent.getTop();

File: qmui/src/main/java/com/qmuiteam/qmui/nestedScroll/QMUIContinuousNestedScrollLayout.java
Patch:
@@ -100,7 +100,7 @@ public void setTopAreaView(View topView, @Nullable LayoutParams layoutParams) {
 
     public void setBottomAreaView(View bottomView, @Nullable LayoutParams layoutParams) {
         if (!(bottomView instanceof IQMUIContinuousNestedBottomView)) {
-            throw new IllegalStateException("topView must implement from IQMUIContinuousNestedTopView");
+            throw new IllegalStateException("bottomView must implement from IQMUIContinuousNestedBottomView");
         }
         if (mBottomView != null) {
             removeView(((View) mBottomView));

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/lab/QDContinuousNestedScroll6Fragment.java
Patch:
@@ -60,7 +60,7 @@ protected void initCoordinatorLayout() {
             @Override
             protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
                 super.onMeasure(widthMeasureSpec, MeasureSpec.makeMeasureSpec(
-                        QMUIDisplayHelper.dp2px(getContext(), 200), MeasureSpec.EXACTLY
+                        QMUIDisplayHelper.dp2px(getContext(), 1000), MeasureSpec.EXACTLY
                 ));
             }
         };
@@ -75,7 +75,7 @@ protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
             @Override
             protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
                 super.onMeasure(widthMeasureSpec, MeasureSpec.makeMeasureSpec(
-                        QMUIDisplayHelper.dp2px(getContext(), 200), MeasureSpec.EXACTLY
+                        QMUIDisplayHelper.dp2px(getContext(), 1000), MeasureSpec.EXACTLY
                 ));
             }
         };
@@ -89,7 +89,7 @@ protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
 
         int matchParent = ViewGroup.LayoutParams.MATCH_PARENT;
         CoordinatorLayout.LayoutParams topLp = new CoordinatorLayout.LayoutParams(
-                matchParent, matchParent);
+                matchParent, ViewGroup.LayoutParams.WRAP_CONTENT);
         topLp.setBehavior(new QMUIContinuousNestedTopAreaBehavior(getContext()));
         mCoordinatorLayout.setTopAreaView(mTopLinearLayout, topLp);
 

File: qmui/src/main/java/com/qmuiteam/qmui/layout/QMUILayoutHelper.java
Patch:
@@ -696,6 +696,7 @@ public void dispatchRoundBorderDraw(Canvas canvas) {
 
         if (mRadius == 0 || (!useFeature() && mOuterNormalColor == 0)) {
             mClipPaint.setStyle(Paint.Style.STROKE);
+            mClipPaint.setColor(mBorderColor);
             canvas.drawRect(mBorderRect, mClipPaint);
             return;
         }

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/components/QDGroupListViewFragment.java
Patch:
@@ -120,6 +120,9 @@ public void onClick(View v) {
                 if (v instanceof QMUICommonListItemView) {
                     CharSequence text = ((QMUICommonListItemView) v).getText();
                     Toast.makeText(getActivity(), text + " is Clicked", Toast.LENGTH_SHORT).show();
+                    if (((QMUICommonListItemView) v).getAccessoryType() == QMUICommonListItemView.ACCESSORY_TYPE_SWITCH) {
+                        ((QMUICommonListItemView) v).getSwitch().toggle();
+                    }
                 }
             }
         };

File: arch/src/main/java/com/qmuiteam/qmui/arch/QMUIFragment.java
Patch:
@@ -131,6 +131,7 @@ protected void startFragmentAndDestroyCurrent(QMUIFragment fragment, boolean use
         QMUIFragmentActivity baseFragmentActivity = this.getBaseFragmentActivity();
         if (baseFragmentActivity != null) {
             if (this.isAttachedToActivity()) {
+                ViewCompat.setTranslationZ(mCacheSwipeBackLayout, --mBackStackIndex);
                 baseFragmentActivity.startFragmentAndDestroyCurrent(fragment, useNewTransitionConfigWhenPop);
             } else {
                 Log.e("QMUIFragment", "fragment not attached:" + this);
@@ -588,6 +589,7 @@ public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container,
         }
 
         ViewCompat.setTranslationZ(swipeBackLayout, mBackStackIndex);
+        Log.i(TAG, getClass().getSimpleName() + " onCreateView: mBackStackIndex = " + mBackStackIndex);
 
         swipeBackLayout.setFitsSystemWindows(false);
 

File: qmui/src/main/java/com/qmuiteam/qmui/widget/pullRefreshLayout/QMUIPullRefreshLayout.java
Patch:
@@ -924,12 +924,13 @@ public boolean dispatchTouchEvent(MotionEvent ev) {
                     // 这里必须要 dispatch 一次 down 事件，否则不能触发 NestScroll，具体可参考 RecyclerView
                     // down 过程中会触发 onStopNestedScroll，mNestScrollDurationRefreshing 必须在之后
                     // 置为false，否则会触发 finishPull
+                    ev.offsetLocation(0, -mSystemTouchSlop-1);
                     ev.setAction(MotionEvent.ACTION_DOWN);
                     super.dispatchTouchEvent(ev);
                     mNestScrollDurationRefreshing = false;
                     ev.setAction(action);
                     // offset touch slop, 避免触发点击事件
-                    ev.offsetLocation(0, mSystemTouchSlop + 1);
+                    ev.offsetLocation(0, mSystemTouchSlop+1);
                 }
             } else {
                 mNestScrollDurationRefreshing = false;

File: qmui/src/main/java/com/qmuiteam/qmui/qqface/QMUIQQFaceView.java
Patch:
@@ -1406,7 +1406,7 @@ public boolean onTouch(int x, int y) {
                 top = (mStartLine - 1) * (mFontHeight + mLineSpace) + top;
             }
 
-            int bottom = (mEndLine - 1) * (mFontHeight + mLineSpace) + top + mFontHeight;
+            int bottom = (mEndLine - 1) * (mFontHeight + mLineSpace) + getPaddingTop() + mFontHeight;
 
             if (y < top || y > bottom) {
                 return false;

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUITabSegment.java
Patch:
@@ -743,7 +743,7 @@ private void setTextViewTypeface(TextView tv, boolean selected) {
             return;
         }
         boolean isBold = selected ? mTypefaceProvider.isSelectedTabBold() : mTypefaceProvider.isNormalTabBold();
-        tv.setTypeface(null, isBold ? Typeface.BOLD : Typeface.NORMAL);
+        tv.setTypeface(mTypefaceProvider.getTypeface(), isBold ? Typeface.BOLD : Typeface.NORMAL);
     }
 
     public void updateIndicatorPosition(final int index, float offsetPercent) {
@@ -1006,6 +1006,8 @@ public interface TypefaceProvider {
         boolean isNormalTabBold();
 
         boolean isSelectedTabBold();
+
+        @Nullable Typeface getTypeface();
     }
 
     public static class TabLayoutOnPageChangeListener implements ViewPager.OnPageChangeListener {

File: qmui/src/main/java/com/qmuiteam/qmui/layout/QMUILayoutHelper.java
Patch:
@@ -621,7 +621,7 @@ public void drawDividers(Canvas canvas, int w, int h) {
         if (mBottomDividerHeight > 0) {
             mDividerPaint.setStrokeWidth(mBottomDividerHeight);
             mDividerPaint.setColor(mBottomDividerColor);
-            if (mTopDividerAlpha < 255) {
+            if (mBottomDividerAlpha < 255) {
                 mDividerPaint.setAlpha(mBottomDividerAlpha);
             }
             float y = (float) Math.floor(h - mBottomDividerHeight * 1f / 2);

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUIProgressBar.java
Patch:
@@ -238,7 +238,7 @@ public void setProgress(int progress) {
     }
     
     public void setProgress(int progress, boolean animated) {
-        if (progress > mMaxValue && progress < 0) {
+        if (progress > mMaxValue || progress < 0) {
             return;
         }
         if (isAnimating) {

File: arch/src/main/java/com/qmuiteam/qmui/arch/QMUIFragment.java
Patch:
@@ -321,11 +321,11 @@ public boolean handle(Object op) {
                                 cmdField.setAccessible(true);
                                 int cmd = (int) cmdField.get(op);
                                 if (cmd == 1) {
-                                    Field popEnterAnimField = op.getClass().getDeclaredField("popEnterAnim");
+                                    Field popEnterAnimField = op.getClass().getDeclaredField("popExitAnim");
                                     popEnterAnimField.setAccessible(true);
                                     popEnterAnimField.set(op, 0);
                                 } else if (cmd == 3) {
-                                    Field popExitAnimField = op.getClass().getDeclaredField("popExitAnim");
+                                    Field popExitAnimField = op.getClass().getDeclaredField("popEnterAnim");
                                     popExitAnimField.setAccessible(true);
                                     popExitAnimField.set(op, 0);
                                 }

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUIWindowInsetLayout.java
Patch:
@@ -6,8 +6,8 @@
 import android.os.Build;
 import android.support.v4.view.ViewCompat;
 import android.util.AttributeSet;
-import android.widget.FrameLayout;
 
+import com.qmuiteam.qmui.layout.QMUIFrameLayout;
 import com.qmuiteam.qmui.util.QMUIWindowInsetHelper;
 
 /**
@@ -21,7 +21,7 @@
  * @author cginechen
  * @date 2016-03-25
  */
-public class QMUIWindowInsetLayout extends FrameLayout implements IWindowInsetLayout {
+public class QMUIWindowInsetLayout extends QMUIFrameLayout implements IWindowInsetLayout {
     private QMUIWindowInsetHelper mQMUIWindowInsetHelper;
 
     public QMUIWindowInsetLayout(Context context) {

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/manager/QDDataManager.java
Patch:
@@ -24,6 +24,7 @@
 import com.qmuiteam.qmuidemo.fragment.lab.QDAnimationListViewFragment;
 import com.qmuiteam.qmuidemo.fragment.lab.QDArchTestFragment;
 import com.qmuiteam.qmuidemo.fragment.lab.QDSnapHelperFragment;
+import com.qmuiteam.qmuidemo.fragment.lab.QDWebViewFixFragment;
 import com.qmuiteam.qmuidemo.fragment.util.QDColorHelperFragment;
 import com.qmuiteam.qmuidemo.fragment.util.QDDeviceHelperFragment;
 import com.qmuiteam.qmuidemo.fragment.util.QDDrawableHelperFragment;
@@ -113,6 +114,7 @@ private void initLabDesc() {
         mLabNames.add(QDAnimationListViewFragment.class);
         mLabNames.add(QDSnapHelperFragment.class);
         mLabNames.add(QDArchTestFragment.class);
+        mLabNames.add(QDWebViewFixFragment.class);
     }
 
     public QDItemDescription getDescription(Class<? extends BaseFragment> cls) {

File: arch/src/main/java/com/qmuiteam/qmui/arch/InnerBaseActivity.java
Patch:
@@ -10,7 +10,7 @@
 //Fix the bug: Only fullscreen activities can request orientation in Android version 26, 27
 class InnerBaseActivity extends AppCompatActivity {
     private static int NO_REQUESTED_ORIENTATION_SET = -100;
-    private boolean mConvertToTranslucentCauseOrientationChanged = true;
+    private boolean mConvertToTranslucentCauseOrientationChanged = false;
     private int mPendingRequestedOrientation = NO_REQUESTED_ORIENTATION_SET;
 
     void convertToTranslucentCauseOrientationChanged() {
@@ -20,8 +20,8 @@ void convertToTranslucentCauseOrientationChanged() {
 
     @Override
     public void setRequestedOrientation(int requestedOrientation) {
-        if (mConvertToTranslucentCauseOrientationChanged && Build.VERSION.SDK_INT == Build.VERSION_CODES.O
-                || Build.VERSION.SDK_INT == Build.VERSION_CODES.O_MR1) {
+        if (mConvertToTranslucentCauseOrientationChanged && (Build.VERSION.SDK_INT == Build.VERSION_CODES.O
+                || Build.VERSION.SDK_INT == Build.VERSION_CODES.O_MR1)) {
             Log.i("InnerBaseActivity", "setRequestedOrientation when activity is translucent");
             mPendingRequestedOrientation = requestedOrientation;
         } else {

File: arch/src/main/java/com/qmuiteam/qmui/arch/QMUIFragment.java
Patch:
@@ -63,7 +63,7 @@ public abstract class QMUIFragment extends Fragment {
 
 
     public static final int RESULT_CANCELED = Activity.RESULT_CANCELED;
-    public static final int RESULT_OK = Activity.RESULT_CANCELED;
+    public static final int RESULT_OK = Activity.RESULT_OK;
     public static final int RESULT_FIRST_USER = Activity.RESULT_FIRST_USER;
 
     public static final int ANIMATION_ENTER_STATUS_NOT_START = -1;

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUITabSegment.java
Patch:
@@ -179,7 +179,7 @@ public void onClick(View v) {
             int index = (int) v.getTag();
             Tab model = getAdapter().getItem(index);
             if (model != null) {
-                selectTab(index, !model.isDynamicChangeIconColor());
+                selectTab(index, !mHasIndicator && !model.isDynamicChangeIconColor());
             }
             if (mOnTabClickListener != null) {
                 mOnTabClickListener.onTabClick(index);

File: qmui/src/main/java/com/qmuiteam/qmui/widget/dialog/QMUIDialogAction.java
Patch:
@@ -12,6 +12,7 @@
 import com.qmuiteam.qmui.R;
 import com.qmuiteam.qmui.layout.QMUIButton;
 import com.qmuiteam.qmui.util.QMUISpanHelper;
+import com.qmuiteam.qmui.util.QMUIViewHelper;
 
 import java.lang.annotation.Retention;
 import java.lang.annotation.RetentionPolicy;
@@ -120,7 +121,7 @@ public void onClick(View v) {
     private QMUIButton generateActionButton(Context context, CharSequence text, int iconRes) {
         // button 有提供 buttonStyle, 覆盖第三个参数不是好选择
         QMUIButton button = new QMUIButton(context);
-        button.setBackground(null);
+        QMUIViewHelper.setBackground(button, null);
         button.setMinHeight(0);
         button.setMinimumHeight(0);
         button.setChangeAlphaWhenDisable(true);
@@ -140,7 +141,7 @@ private QMUIButton generateActionButton(Context context, CharSequence text, int
             } else if (attr == R.styleable.QMUIDialogActionStyleDef_qmui_dialog_action_button_padding_horizontal) {
                 paddingHor = a.getDimensionPixelSize(attr, 0);
             } else if (attr == R.styleable.QMUIDialogActionStyleDef_android_background) {
-                button.setBackground(a.getDrawable(attr));
+                QMUIViewHelper.setBackground(button, a.getDrawable(attr));
             } else if (attr == R.styleable.QMUIDialogActionStyleDef_android_minWidth) {
                 int miniWidth = a.getDimensionPixelSize(attr, 0);
                 button.setMinWidth(miniWidth);

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/components/qqface/QDQQFacePerformanceTestFragment.java
Patch:
@@ -8,6 +8,7 @@
 
 import com.qmuiteam.qmui.widget.QMUITabSegment;
 import com.qmuiteam.qmui.widget.QMUITopBar;
+import com.qmuiteam.qmui.widget.QMUITopBarLayout;
 import com.qmuiteam.qmuidemo.manager.QDDataManager;
 import com.qmuiteam.qmuidemo.base.BaseFragment;
 import com.qmuiteam.qmuidemo.fragment.components.QDTabSegmentFixModeFragment;
@@ -30,7 +31,7 @@
 
 @Widget(group = Group.Other, name = "性能观测")
 public class QDQQFacePerformanceTestFragment extends BaseFragment {
-    @BindView(R.id.topbar) QMUITopBar mTopBar;
+    @BindView(R.id.topbar) QMUITopBarLayout mTopBar;
     @BindView(R.id.tabSegment) QMUITabSegment mTabSegment;
     @BindView(R.id.contentViewPager) ViewPager mContentViewPager;
 

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUINotchConsumeLayout.java
Patch:
@@ -38,12 +38,13 @@ protected void onConfigurationChanged(Configuration newConfig) {
     }
 
     @Override
-    public void notifyInsetMaybeChanged() {
+    public boolean notifyInsetMaybeChanged() {
         setPadding(
                 QMUINotchHelper.getSafeInsetLeft(this),
                 QMUINotchHelper.getSafeInsetTop(this),
                 QMUINotchHelper.getSafeInsetRight(this),
                 QMUINotchHelper.getSafeInsetBottom(this)
         );
+        return true;
     }
 }

File: qmui/src/main/java/com/qmuiteam/qmui/util/QMUINotchHelper.java
Patch:
@@ -160,7 +160,7 @@ private static Rect getSafeInsetRect(Context context) {
             }
             sXiaomiIsNotchSetToShow = isXiaomiNotchSetToShow;
         }
-        int screenRotation = getScreenRotataion(context);
+        int screenRotation = getScreenRotation(context);
         if (screenRotation == Surface.ROTATION_90) {
             if (sRotation90SafeInset == null) {
                 sRotation90SafeInset = getRectInfoRotation90(context);
@@ -340,7 +340,7 @@ public static int getNotchHeightInVivo(Context context){
      * @param context
      * @return
      */
-    private static int getScreenRotataion(Context context) {
+    private static int getScreenRotation(Context context) {
         WindowManager w = (WindowManager) context.getSystemService(Context.WINDOW_SERVICE);
         if (w == null) {
             return Surface.ROTATION_0;

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/QDAboutFragment.java
Patch:
@@ -7,7 +7,6 @@
 import android.widget.TextView;
 
 import com.qmuiteam.qmui.util.QMUIPackageHelper;
-import com.qmuiteam.qmui.widget.QMUITopBar;
 import com.qmuiteam.qmui.widget.QMUITopBarLayout;
 import com.qmuiteam.qmui.widget.grouplist.QMUIGroupListView;
 import com.qmuiteam.qmuidemo.R;

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/components/viewpager/QDFitSystemWindowViewPagerFragment.java
Patch:
@@ -17,6 +17,7 @@
 import com.qmuiteam.qmuidemo.fragment.QDAboutFragment;
 import com.qmuiteam.qmuidemo.fragment.components.QDButtonFragment;
 import com.qmuiteam.qmuidemo.fragment.components.QDCollapsingTopBarLayoutFragment;
+import com.qmuiteam.qmuidemo.fragment.components.QDTabSegmentFragment;
 import com.qmuiteam.qmuidemo.lib.annotation.Widget;
 
 import butterknife.BindView;
@@ -69,7 +70,7 @@ public int getCount() {
             public CharSequence getPageTitle(int position) {
                 switch (position) {
                     case 0:
-                        return "Button";
+                        return "TabSegment";
                     case 1:
                         return "CollapsingTopBar";
                     case 2:
@@ -82,7 +83,7 @@ public CharSequence getPageTitle(int position) {
             protected Object hydrate(ViewGroup container, int position) {
                 switch (position) {
                     case 0:
-                        return new QDButtonFragment();
+                        return new QDTabSegmentFragment();
                     case 1:
                         return new QDCollapsingTopBarLayoutFragment();
                     case 2:

File: arch/src/main/java/com/qmuiteam/qmui/arch/QMUIFragmentActivity.java
Patch:
@@ -38,7 +38,7 @@ public FrameLayout getFragmentContainer() {
     public void onBackPressed() {
         QMUIFragment fragment = getCurrentFragment();
         if (fragment != null) {
-            popBackStack();
+            fragment.popBackStack();
         }
     }
 

File: qmui/src/main/java/com/qmuiteam/qmui/widget/dialog/QMUIDialog.java
Patch:
@@ -190,6 +190,7 @@ protected void onCreateContent(QMUIDialog dialog, ViewGroup parent, Context cont
                 mTextView = new QMUISpanTouchFixTextView(context);
                 assignMessageTvWithAttr(mTextView, hasTitle(), R.attr.qmui_dialog_message_content_style);
                 mTextView.setText(mMessage);
+                mTextView.setMovementMethodDefault();
 
 
                 mScrollContainer = new QMUIWrapContentScrollView(context);
@@ -306,6 +307,7 @@ protected void onCreateContent(QMUIDialog dialog, ViewGroup parent, Context cont
             if (mMessage != null && mMessage.length() != 0) {
                 mScrollContainer = new QMUIWrapContentScrollView(context);
                 mTextView = new QMUISpanTouchFixTextView(context);
+                mTextView.setMovementMethodDefault();
                 MessageDialogBuilder.assignMessageTvWithAttr(mTextView, hasTitle(), R.attr.qmui_dialog_message_content_style);
                 ScrollView.LayoutParams lp = new ScrollView.LayoutParams(
                         ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT);

File: qmui/src/main/java/com/qmuiteam/qmui/widget/popup/QMUIPopup.java
Patch:
@@ -147,7 +147,7 @@ private void calculatePosition(View attachedView) {
                     break;
                 case DIRECTION_BOTTOM:
                     mY = attachedViewLocation[1] + attachedView.getHeight();
-                    if (mY > mScreenSize.y - mPopupTopBottomMinMargin) {
+                    if (mY > mScreenSize.y - mPopupTopBottomMinMargin - mWindowHeight) {
                         mY = attachedViewLocation[1] - mWindowHeight;
                         mDirection = DIRECTION_TOP;
                     }

File: qmui/src/main/java/com/qmuiteam/qmui/widget/dialog/QMUIDialogMenuItemView.java
Patch:
@@ -2,6 +2,7 @@
 
 import android.annotation.SuppressLint;
 import android.content.Context;
+import android.graphics.drawable.Drawable;
 import android.text.TextUtils;
 import android.util.TypedValue;
 import android.view.Gravity;
@@ -149,7 +150,7 @@ public void setText(CharSequence text) {
 
         @Override
         protected void notifyCheckChange(boolean isChecked) {
-            mCheckedView.setSelected(isChecked);
+            QMUIViewHelper.safeSetImageViewSelected(mCheckedView, isChecked);
         }
     }
 
@@ -199,7 +200,7 @@ public void setText(CharSequence text) {
 
         @Override
         protected void notifyCheckChange(boolean isChecked) {
-            mCheckedView.setSelected(isChecked);
+            QMUIViewHelper.safeSetImageViewSelected(mCheckedView, isChecked);
         }
     }
 }

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/home/HomeFragment.java
Patch:
@@ -1,6 +1,5 @@
 package com.qmuiteam.qmuidemo.fragment.home;
 
-import android.graphics.drawable.Drawable;
 import android.support.v4.content.ContextCompat;
 import android.support.v4.view.PagerAdapter;
 import android.support.v4.view.ViewPager;
@@ -9,11 +8,10 @@
 import android.view.ViewGroup;
 import android.widget.FrameLayout;
 
-import com.qmuiteam.qmui.util.QMUIDisplayHelper;
 import com.qmuiteam.qmui.util.QMUIResHelper;
 import com.qmuiteam.qmui.widget.QMUITabSegment;
-import com.qmuiteam.qmuidemo.base.BaseFragment;
 import com.qmuiteam.qmuidemo.R;
+import com.qmuiteam.qmuidemo.base.BaseFragment;
 
 import java.util.HashMap;
 

File: qmui/src/main/java/com/qmuiteam/qmui/widget/popup/QMUIBasePopup.java
Patch:
@@ -7,6 +7,7 @@
 import android.graphics.drawable.ColorDrawable;
 import android.graphics.drawable.Drawable;
 import android.os.Build;
+import android.support.v4.view.ViewCompat;
 import android.util.AttributeSet;
 import android.util.Log;
 import android.view.Display;
@@ -113,7 +114,7 @@ public final void show(View view) {
 
 
     public final void show(View parent, View anchorView) {
-        if(!anchorView.isAttachedToWindow()){
+        if(!ViewCompat.isAttachedToWindow(anchorView)){
             return;
         }
         onShowConfig();
@@ -128,7 +129,7 @@ public final void show(View parent, View anchorView) {
         onShowEnd();
 
         // 在相关的View被移除时，window也自动移除。避免当Fragment退出后，Fragment中弹出的PopupWindow还存在于界面上。
-        anchorView.addOnAttachStateChangeListener(new View.OnAttachStateChangeListener() {
+        parent.addOnAttachStateChangeListener(new View.OnAttachStateChangeListener() {
             @Override
             public void onViewAttachedToWindow(View v) {
 

File: qmui/src/main/java/com/qmuiteam/qmui/widget/roundwidget/QMUIRoundButtonDrawable.java
Patch:
@@ -138,6 +138,9 @@ public static QMUIRoundButtonDrawable fromAttributeSet(Context context, Attribut
             isRadiusAdjustBounds = false;
         } else {
             bg.setCornerRadius(mRadius);
+            if(mRadius > 0){
+                isRadiusAdjustBounds = false;
+            }
         }
         bg.setIsRadiusAdjustBounds(isRadiusAdjustBounds);
         return bg;

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/home/HomeFragment.java
Patch:
@@ -86,6 +86,7 @@ private void initTabs() {
         int selectColor = QMUIResHelper.getAttrColor(getActivity(), R.attr.qmui_config_color_blue);
         mTabSegment.setDefaultNormalColor(normalColor);
         mTabSegment.setDefaultSelectedColor(selectColor);
+//        mTabSegment.setDefaultTabIconPosition(QMUITabSegment.ICON_POSITION_BOTTOM);
         QMUITabSegment.Tab component = new QMUITabSegment.Tab(
                 ContextCompat.getDrawable(getContext(), R.mipmap.icon_tabbar_component),
                 ContextCompat.getDrawable(getContext(), R.mipmap.icon_tabbar_component_selected),

File: qmui/src/main/java/com/qmuiteam/qmui/widget/roundwidget/QMUIRoundButtonDrawable.java
Patch:
@@ -138,9 +138,6 @@ public static QMUIRoundButtonDrawable fromAttributeSet(Context context, Attribut
             isRadiusAdjustBounds = false;
         } else {
             bg.setCornerRadius(mRadius);
-            if(mRadius > 0){
-                isRadiusAdjustBounds = false;
-            }
         }
         bg.setIsRadiusAdjustBounds(isRadiusAdjustBounds);
         return bg;

File: qmui/src/main/java/com/qmuiteam/qmui/widget/pullRefreshLayout/QMUIPullRefreshLayout.java
Patch:
@@ -480,6 +480,7 @@ private void ensureTargetView() {
                 if (!view.equals(mRefreshView)) {
                     onSureTargetView(view);
                     mTargetView = view;
+                    break;
                 }
             }
         }

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUIFloatLayout.java
Patch:
@@ -300,14 +300,15 @@ private void layoutWithGravityLeft(int parentWidth) {
             }
             final int childw = child.getMeasuredWidth();
             final int childh = child.getMeasuredHeight();
-            lineHeight = Math.max(lineHeight, childh);
             if (childPositionX + childw > childMaxRight) {
+                // 换行
                 childPositionX = getPaddingLeft();
                 childPositionY += (lineHeight + mChildVerticalSpacing);
                 lineHeight = 0;
             }
             child.layout(childPositionX, childPositionY, childPositionX + childw, childPositionY + childh);
             childPositionX += childw + mChildHorizontalSpacing;
+            lineHeight = Math.max(lineHeight, childh);
         }
 
         // 如果布局的子View少于childCount，则表示有一些子View不需要布局

File: qmui/src/main/java/com/qmuiteam/qmui/widget/pullRefreshLayout/QMUIPullRefreshLayout.java
Patch:
@@ -405,12 +405,12 @@ public boolean onTouchEvent(MotionEvent ev) {
                 startDragging(x, y);
 
                 if (mIsDragging) {
-                    float dy = y - mLastMotionY;
+                    float dy = (y - mLastMotionY) * mDragRate;
                     if (dy >= 0) {
                         moveTargetView(dy, true);
                     } else {
                         int move = moveTargetView(dy, true);
-                        float delta = Math.abs(dy * mDragRate) - Math.abs(move);
+                        float delta = Math.abs(dy) - Math.abs(move);
                         if (delta > 0) {
                             // 重新dispatch一次down事件，使得列表可以继续滚动
                             ev.setAction(MotionEvent.ACTION_DOWN);
@@ -719,7 +719,7 @@ public boolean onNestedFling(View target, float velocityX, float velocityY, bool
     }
 
     private int moveTargetView(float dy, boolean isDragging) {
-        int target = (int) (mTargetCurrentOffset + dy * mDragRate);
+        int target = (int) (mTargetCurrentOffset + dy);
         return moveTargetViewTo(target, isDragging);
     }
 

File: qmui/src/main/java/com/qmuiteam/qmui/widget/roundwidget/QMUIRoundButton.java
Patch:
@@ -35,7 +35,7 @@ public QMUIRoundButton(Context context) {
     }
 
     public QMUIRoundButton(Context context, AttributeSet attrs) {
-        super(context, attrs);
+        super(context, attrs, R.attr.QMUIButtonStyle);
         init(context, attrs, R.attr.QMUIButtonStyle);
     }
 

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/QDApplication.java
Patch:
@@ -7,6 +7,7 @@
 import com.squareup.leakcanary.LeakCanary;
 
 /**
+ * Demo 的 Application 入口。
  * Created by cgine on 16/3/22.
  */
 public class QDApplication extends Application {

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/activity/TranslucentActivity.java
Patch:
@@ -16,6 +16,7 @@
 import butterknife.ButterKnife;
 
 /**
+ * 沉浸式状态栏的调用示例。
  * Created by Kayo on 2016/12/12.
  */
 

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/adaptor/QDRecyclerViewAdapter.java
Patch:
@@ -13,6 +13,7 @@
 import java.util.List;
 
 /**
+ * Demo 中通用的 RecyclerView Adapter。
  * Created by sm on 2015/5/3.
  */
 public class QDRecyclerViewAdapter extends RecyclerView.Adapter<QDRecyclerViewAdapter.ViewHolder> {

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/base/BaseRecyclerAdapter.java
Patch:
@@ -83,6 +83,7 @@ public void setOnItemLongClickListener(OnItemLongClickListener listener) {
         mLongClickListener = listener;
     }
 
+    @SuppressWarnings("SameReturnValue")
     abstract public int getItemLayoutId(int viewType);
 
     abstract public void bindData(RecyclerViewHolder holder, int position, T item);

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/QDAboutFragment.java
Patch:
@@ -19,6 +19,8 @@
 import butterknife.ButterKnife;
 
 /**
+ * 关于界面
+ *
  * Created by Kayo on 2016/11/18.
  */
 public class QDAboutFragment extends BaseFragment {

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/components/QDBottomSheetFragment.java
Patch:
@@ -23,6 +23,7 @@
 import butterknife.ButterKnife;
 
 /**
+ * {@link QMUIBottomSheet} 的使用示例。
  * Created by cgspine on 15/9/15.
  */
 

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/components/QDDialogFragment.java
Patch:
@@ -37,6 +37,7 @@
 import butterknife.ButterKnife;
 
 /**
+ * {@link QMUIDialog} 的使用示例。
  * Created by cgspine on 15/9/15.
  */
 @Widget(widgetClass = QMUIDialog.class, iconRes = R.mipmap.icon_grid_dialog)

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/components/QDEmptyViewFragment.java
Patch:
@@ -16,6 +16,7 @@
 import butterknife.ButterKnife;
 
 /**
+ * {@link QMUIEmptyView} 的使用示例。
  * Created by cgspine on 15/9/14.
  */
 

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/components/QDGroupListViewFragment.java
Patch:
@@ -19,6 +19,7 @@
 import butterknife.ButterKnife;
 
 /**
+ * {@link QMUIGroupListView} 的使用示例。
  * Created by Kayo on 2016/11/21.
  */
 

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/components/QDProgressBarFragment.java
Patch:
@@ -20,6 +20,7 @@
 import butterknife.ButterKnife;
 
 /**
+ * {@link QMUIProgressBar} 的使用示例。
  * Created by cgspine on 15/9/15.
  */
 @Widget(widgetClass = QMUIProgressBar.class, iconRes = R.mipmap.icon_grid_progress_bar)

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/components/QDRadiusImageViewFragment.java
Patch:
@@ -18,6 +18,7 @@
 import butterknife.ButterKnife;
 
 /**
+ * {@link QMUIRadiusImageView} 的使用示例。
  * Created by cgspine on 15/9/15.
  */
 @Widget(widgetClass = QMUIRadiusImageView.class, iconRes = R.mipmap.icon_grid_radius_image_view)

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/components/QDTipDialogFragment.java
Patch:
@@ -22,6 +22,7 @@
 import butterknife.ButterKnife;
 
 /**
+ * {@link QMUITipDialog} 的使用示例。
  * Created by Kayo on 2016/11/21.
  */
 @Widget(widgetClass = QMUITipDialog.class, iconRes = R.mipmap.icon_grid_tip_dialog)

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/components/viewpager/QDFitSystemWindowViewPagerFragment.java
Patch:
@@ -1,5 +1,6 @@
 package com.qmuiteam.qmuidemo.fragment.components.viewpager;
 
+import android.annotation.SuppressLint;
 import android.support.v4.app.Fragment;
 import android.support.v4.app.FragmentTransaction;
 import android.view.LayoutInflater;
@@ -90,6 +91,7 @@ protected Object hydrate(ViewGroup container, int position) {
                 }
             }
 
+            @SuppressLint("CommitTransaction")
             @Override
             protected void populate(ViewGroup container, Object item, int position) {
                 String name = makeFragmentName(container.getId(), position);
@@ -110,6 +112,7 @@ protected void populate(ViewGroup container, Object item, int position) {
                 }
             }
 
+            @SuppressLint("CommitTransaction")
             @Override
             protected void destroy(ViewGroup container, int position, Object object) {
                 if (mCurrentTransaction == null) {

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/home/HomeUtilController.java
Patch:
@@ -4,7 +4,7 @@
 
 import com.qmuiteam.qmuidemo.QDDataManager;
 
-/**
+/** 主界面，关于 QMUI Util 部分的展示。
  * Created by Kayo on 2016/11/21.
  */
 

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/lab/QDSnapHelperFragment.java
Patch:
@@ -22,7 +22,7 @@
 import butterknife.BindView;
 import butterknife.ButterKnife;
 
-/**
+/** 使用 {@link SnapHelper} 实现 {@link RecyclerView} 按页滚动。
  * Created by cgspine on 15/9/15.
  */
 

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/util/QDColorHelperFragment.java
Patch:
@@ -20,6 +20,7 @@
 import butterknife.ButterKnife;
 
 /**
+ * {@link QMUIColorHelper} 的使用示例。
  * Created by Kayo on 2016/12/1.
  */
 

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/util/QDDeviceHelperFragment.java
Patch:
@@ -21,6 +21,7 @@
 import butterknife.ButterKnife;
 
 /**
+ * {@link QMUIDeviceHelper} 的使用示例。
  * Created by Kayo on 2016/12/2.
  */
 

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/util/QDDrawableHelperFragment.java
Patch:
@@ -26,6 +26,7 @@
 import butterknife.ButterKnife;
 
 /**
+ * {@link QMUIDrawableHelper} 的使用示例。
  * Created by Kayo on 2016/12/5.
  */
 

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/util/QDSpanFragment.java
Patch:
@@ -29,6 +29,7 @@
 import butterknife.ButterKnife;
 
 /**
+ * QMUI 中各种 Span 的使用示例。
  * Created by Kayo on 2016/12/15.
  */
 

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/util/QDStatusBarHelperFragment.java
Patch:
@@ -20,6 +20,7 @@
 import butterknife.ButterKnife;
 
 /**
+ * {@link QMUIStatusBarHelper} 的使用示例。
  * Created by Kayo on 2016/12/12.
  */
 

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/util/QDViewHelperAnimationFadeFragment.java
Patch:
@@ -2,6 +2,7 @@
 
 import android.view.LayoutInflater;
 import android.view.View;
+import android.view.animation.Animation;
 import android.widget.TextView;
 
 import com.qmuiteam.qmui.util.QMUIViewHelper;
@@ -17,6 +18,8 @@
 import butterknife.ButterKnife;
 
 /**
+ * {@link QMUIViewHelper#fadeIn(View, int, Animation.AnimationListener, boolean)} 与
+ * {@link QMUIViewHelper#fadeOut(View, int, Animation.AnimationListener, boolean)} 的使用示例。
  * Created by Kayo on 2017/2/7.
  */
 

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/util/QDViewHelperAnimationSlideFragment.java
Patch:
@@ -2,6 +2,7 @@
 
 import android.view.LayoutInflater;
 import android.view.View;
+import android.view.animation.Animation;
 import android.widget.TextView;
 
 import com.qmuiteam.qmui.util.QMUIDirection;
@@ -18,6 +19,8 @@
 import butterknife.ButterKnife;
 
 /**
+ * {@link QMUIViewHelper#slideIn(View, int, Animation.AnimationListener, boolean, QMUIDirection)} 与
+ * {@link QMUIViewHelper#slideOut(View, int, Animation.AnimationListener, boolean, QMUIDirection)} 的使用示例。
  * Created by Kayo on 2017/2/7.
  */
 

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/util/QDViewHelperBackgroundAnimationBlinkFragment.java
Patch:
@@ -18,6 +18,7 @@
 import butterknife.ButterKnife;
 
 /**
+ * {@link QMUIViewHelper#playBackgroundBlinkAnimation(View, int)} 的使用示例。
  * Created by Kayo on 2017/2/7.
  */
 

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/util/QDViewHelperBackgroundAnimationFullFragment.java
Patch:
@@ -18,6 +18,7 @@
 import butterknife.ButterKnife;
 
 /**
+ * {@link QMUIViewHelper#playViewBackgroundAnimation(View, int, int, long)} 的使用示例。
  * Created by Kayo on 2017/2/7.
  */
 

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/util/QDViewHelperFragment.java
Patch:
@@ -17,6 +17,7 @@
 import butterknife.ButterKnife;
 
 /**
+ * {@link QMUIViewHelper} 内各种方法的使用示例。
  * Created by Kayo on 2017/02/04.
  */
 

File: qmui/src/main/java/com/qmuiteam/qmui/qqface/QMUIQQFaceCompiler.java
Patch:
@@ -106,6 +106,7 @@ public void setCache(LruCache<CharSequence, ElementList> cache) {
         mCache = cache;
     }
 
+    @SuppressWarnings("ConstantConditions")
     private ElementList realCompile(CharSequence text, int start, int end, QMUITouchableSpan[] spans, int[] spanInfo) {
         int size = text.length();
         int nearSpanIndex = -1;

File: qmui/src/main/java/com/qmuiteam/qmui/qqface/QMUIQQFaceView.java
Patch:
@@ -801,8 +801,7 @@ private void toNewDrawLine(int startLeft) {
     }
 
     /**
-     * @param startLeft
-     * @param paragraph 是否是段落切换
+     * 控制段落切换
      */
     private void toNewDrawLine(int startLeft, boolean paragraph) {
         int addOn = (paragraph ? mParagraphSpace : 0) + mLineSpace;

File: qmui/src/main/java/com/qmuiteam/qmui/util/QMUIWindowInsetHelper.java
Patch:
@@ -4,7 +4,6 @@
 import android.annotation.TargetApi;
 import android.graphics.Rect;
 import android.os.Build;
-import android.support.design.widget.AppBarLayout;
 import android.support.design.widget.CoordinatorLayout;
 import android.support.v4.view.ViewCompat;
 import android.support.v4.view.WindowInsetsCompat;

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUIAppBarLayout.java
Patch:
@@ -35,6 +35,7 @@ public QMUIAppBarLayout(Context context, AttributeSet attrs) {
     @Override
     public boolean applySystemWindowInsets19(final Rect insets) {
         if (ViewCompat.getFitsSystemWindows(this)) {
+            //noinspection TryWithIdenticalCatches
             try {
                 Field field = AppBarLayout.class.getDeclaredField("mLastInsets");
                 field.setAccessible(true);

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUICollapsingTopBarLayout.java
Patch:
@@ -654,6 +654,8 @@ public void setStatusBarScrim(@Nullable Drawable drawable) {
         }
     }
 
+    // 从系统源码获取，不作检测
+    @SuppressWarnings("ConstantConditions")
     @Override
     protected void drawableStateChanged() {
         super.drawableStateChanged();

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUITopBar.java
Patch:
@@ -677,8 +677,6 @@ public int computeAndSetBackgroundAlpha(int currentOffset, int alphaBeginOffset,
 
     /**
      * 设置是否要 Topbar 底部的分割线
-     *
-     * @param enabled
      */
     public void setBackgroundDividerEnabled(boolean enabled) {
         if (enabled) {

File: qmui/src/main/java/com/qmuiteam/qmui/widget/dialog/QMUIDialog.java
Patch:
@@ -686,6 +686,7 @@ public void onClick(View v) {
             });
             mRootView.getViewTreeObserver().addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() {
                 public void onGlobalLayout() {
+                    //noinspection ConstantConditions
                     View mDecor = mDialog.getWindow().getDecorView();
                     Rect r = new Rect();
                     mDecor.getWindowVisibleDisplayFrame(r);

File: qmui/src/main/java/com/qmuiteam/qmui/widget/popup/QMUIBasePopup.java
Patch:
@@ -79,7 +79,7 @@ public final void show(View view) {
     /**
      *
      * @param parent a parent view to get the {@link android.view.View#getWindowToken()} token from
-     * @param anchorView
+     * @param anchorView provide anchor for positioning
      */
     public final void show(View parent, View anchorView) {
         preShow();

File: qmui/src/main/java/com/qmuiteam/qmui/span/QMUIBlockSpaceSpan.java
Patch:
@@ -31,7 +31,7 @@ public int getSize(@NonNull Paint paint, CharSequence text, int start, int end,
     }
 
     @Override
-    public void draw(@NonNull Canvas canvas, CharSequence text, int start, int end, float x, int top, int y, int bottom, Paint paint) {
+    public void draw(@NonNull Canvas canvas, CharSequence text, int start, int end, float x, int top, int y, int bottom, @NonNull Paint paint) {
 
     }
 }

File: qmui/src/main/java/com/qmuiteam/qmui/util/QMUIColorHelper.java
Patch:
@@ -11,9 +11,9 @@ public class QMUIColorHelper {
     /**
      * 设置颜色的alpha值
      *
-     * @param color
+     * @param color 需要被设置的颜色值
      * @param alpha 取值为[0,1]，0表示全透明，1表示不透明
-     * @return
+     * @return 返回改变了 alpha 值的颜色值
      */
     public static int setColorAlpha(@ColorInt int color, float alpha) {
         return color & 0x00ffffff | (int) (alpha * 255) << 24; // 清掉alpha信息后加上新的alpha信息

File: qmui/src/main/java/com/qmuiteam/qmui/util/QMUIKeyboardHelper.java
Patch:
@@ -29,8 +29,6 @@ public class QMUIKeyboardHelper {
      * 针对给定的editText显示软键盘（editText会先获得焦点）. 可以和{@link #hideKeyboard(View)}
      * 搭配使用，进行键盘的显示隐藏控制。
      *
-     * @param editText
-     * @author handleychen
      */
 
     public static void showKeyboard(final EditText editText, boolean delay) {
@@ -61,7 +59,6 @@ public void run() {
      * 隐藏软键盘 可以和{@link #showKeyboard(EditText, boolean)}搭配使用，进行键盘的显示隐藏控制。
      *
      * @param view 当前页面上任意一个可用的view
-     * @author handleychen
      */
     public static boolean hideKeyboard(final View view) {
         if (null == view)

File: qmui/src/main/java/com/qmuiteam/qmui/util/QMUIStatusBarHelper.java
Patch:
@@ -204,6 +204,7 @@ private static boolean Android6SetStatusBarLightMode(Window window, boolean ligh
      * @param dark   是否把状态栏字体及图标颜色设置为深色
      * @return boolean 成功执行返回 true
      */
+    @SuppressWarnings("unchecked")
     public static boolean MIUISetStatusBarLightMode(Window window, boolean dark) {
         boolean result = false;
         if (window != null) {
@@ -349,7 +350,7 @@ public static int getStatusbarHeight(Context context) {
     }
 
     private static void initStatusBarHeight(Context context) {
-        Class<?> clazz = null;
+        Class<?> clazz;
         Object obj = null;
         Field field = null;
         try {

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUIFontFitTextView.java
Patch:
@@ -13,7 +13,7 @@
 /**
  * 使 {@link TextView} 在宽度固定的情况下，文字多到一行放不下时能缩小文字大小来自适应
  *
- * @from http://stackoverflow.com/questions/2617266/how-to-adjust-text-font-size-to-fit-textview
+ * http://stackoverflow.com/questions/2617266/how-to-adjust-text-font-size-to-fit-textview
  */
 public class QMUIFontFitTextView extends TextView {
 

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUILoadingView.java
Patch:
@@ -6,6 +6,7 @@
 import android.graphics.Canvas;
 import android.graphics.Color;
 import android.graphics.Paint;
+import android.support.annotation.NonNull;
 import android.util.AttributeSet;
 import android.view.View;
 import android.view.animation.LinearInterpolator;
@@ -144,7 +145,7 @@ protected void onDetachedFromWindow() {
     }
 
     @Override
-    protected void onVisibilityChanged(View changedView, int visibility) {
+    protected void onVisibilityChanged(@NonNull View changedView, int visibility) {
         super.onVisibilityChanged(changedView, visibility);
         if (visibility == VISIBLE) {
             start();

File: qmui/src/main/java/com/qmuiteam/qmui/widget/QMUITopBarLayout.java
Patch:
@@ -183,7 +183,7 @@ public int computeAndSetBackgroundAlpha(int currentOffset, int alphaBeginOffset,
     /**
      * 设置是否要 Topbar 底部的分割线
      *
-     * @param enabled
+     * @param enabled true 为显示底部分割线，false 则不显示
      */
     public void setBackgroundDividerEnabled(boolean enabled) {
         if (enabled) {

File: qmui/src/main/java/com/qmuiteam/qmui/widget/dialog/QMUIDialog.java
Patch:
@@ -364,6 +364,7 @@ public void clear() {
             mMenuItemViews.clear();
         }
 
+        @SuppressWarnings("unchecked")
         public T addItem(QMUIDialogMenuItemView itemView, final OnClickListener listener) {
             itemView.setMenuIndex(mMenuItemViews.size());
             itemView.setListener(new QMUIDialogMenuItemView.MenuItemViewListener() {

File: qmui/src/main/java/com/qmuiteam/qmui/widget/dialog/QMUIDialogBuilder.java
Patch:
@@ -59,6 +59,7 @@ public QMUIDialogBuilder(Context context) {
     /**
      * 设置对话框顶部的标题文字
      */
+    @SuppressWarnings("unchecked")
     public T setTitle(String title) {
         if (title != null && title.length() > 0) {
             this.mTitle = title + mContext.getString(R.string.qmui_tool_fixellipsize);
@@ -78,6 +79,7 @@ public T setTitle(int resId) {
     /**
      * 添加对话框底部的操作按钮
      */
+    @SuppressWarnings("unchecked")
     public T addAction(@Nullable QMUIDialogAction action) {
         if (action != null) {
             mActions.add(action);
@@ -174,6 +176,7 @@ protected T addAction(int iconRes, int strRes, @QMUIDialogAction.Prop int prop,
      * @param prop     属性
      * @param listener 点击回调事件
      */
+    @SuppressWarnings("unchecked")
     protected T addAction(int iconRes, String str, @QMUIDialogAction.Prop int prop, @QMUIDialogAction.Type int type, QMUIDialogAction.ActionListener listener) {
         QMUIDialogAction action = new QMUIDialogAction(mContext, iconRes, str, type, prop, listener);
         mActions.add(action);

File: qmui/src/main/java/com/qmuiteam/qmui/widget/dialog/QMUITipDialog.java
Patch:
@@ -11,16 +11,15 @@
 import android.util.TypedValue;
 import android.view.Gravity;
 import android.view.LayoutInflater;
-import android.view.View;
 import android.view.ViewGroup;
 import android.view.Window;
 import android.view.WindowManager;
 import android.widget.ImageView;
 import android.widget.LinearLayout;
 import android.widget.TextView;
 
-import com.qmuiteam.qmui.util.QMUIDisplayHelper;
 import com.qmuiteam.qmui.R;
+import com.qmuiteam.qmui.util.QMUIDisplayHelper;
 import com.qmuiteam.qmui.widget.QMUILoadingView;
 
 import java.lang.annotation.Retention;
@@ -210,7 +209,7 @@ public QMUITipDialog create() {
             QMUITipDialog dialog = new QMUITipDialog(mContext);
             dialog.setContentView(R.layout.qmui_tip_dialog_layout);
             ViewGroup contentWrap = (ViewGroup) dialog.findViewById(R.id.contentWrap);
-            View customView = LayoutInflater.from(mContext).inflate(mContentLayoutId, contentWrap, true);
+            LayoutInflater.from(mContext).inflate(mContentLayoutId, contentWrap, true);
             return dialog;
         }
     }

File: qmui/src/main/java/com/qmuiteam/qmui/widget/grouplist/QMUICommonListItemView.java
Patch:
@@ -34,7 +34,7 @@
  * <ul>
  *     <li>通过 {@link #setText(SpannableString)} 设置一行文字</li>
  *     <li>通过 {@link #setDetailText(String)} 设置一行说明文字, 并通过 {@link #setOrientation(int)} 设置说明文字的位置,
- *     也可以在 xml 中使用 {@link com.qmuiteam.qmui.R.styleable#QMUICommonListItemView_orientation} 设置。</li>
+ *     也可以在 xml 中使用 {@link com.qmuiteam.qmui.R.styleable#QMUICommonListItemView_qmui_orientation} 设置。</li>
  *     <li>通过 {@link #setAccessoryType(int)} 设置右侧 View 的类型, 可选的类型见 {@link QMUICommonListItemAccessoryType},
  *     也可以在 xml 中使用 {@link com.qmuiteam.qmui.R.styleable#QMUICommonListItemView_qmui_accessory_type} 设置。</li>
  * </ul>
@@ -360,9 +360,9 @@ public ViewGroup getAccessoryContainerView() {
     }
 
     /**
-     * 添加自定义的AccessoryView
+     * 添加自定义的 Accessory View
      *
-     * @param view
+     * @param view 自定义的 Accessory View
      */
     public void addAccessoryCustomView(View view) {
         if (mAccessoryType == ACCESSORY_TYPE_CUSTOM) {

File: qmui/src/main/java/com/qmuiteam/qmui/widget/pullRefreshLayout/QMUIPullRefreshLayout.java
Patch:
@@ -480,7 +480,6 @@ private void ensureTargetView() {
 
     /**
      * 确定TargetView, 提供机会给子类来做一些初始化的操作
-     * @param targetView
      */
     protected void onSureTargetView(View targetView){
 

File: qmui/src/main/java/com/qmuiteam/qmui/widget/textview/QMUILinkTextView.java
Patch:
@@ -131,7 +131,7 @@ public void removeAutoLinkMaskCompat(int mask) {
     /**
      * 是否强制把TextView的事件强制传递给父元素。TextView在有ClickSpan的情况下默认会消耗掉事件
      *
-     * @param needForceEventToParent
+     * @param needForceEventToParent true 为强制把TextView的事件强制传递给父元素，false 则不传递
      */
     public void setNeedForceEventToParent(boolean needForceEventToParent) {
         if (mNeedForceEventToParent != needForceEventToParent) {

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/QDAboutFragment.java
Patch:
@@ -49,7 +49,7 @@ public void onClick(View v) {
                 .addItemView(mAboutGroupListView.createItemView(getResources().getString(R.string.about_item_github)), new View.OnClickListener() {
                     @Override
                     public void onClick(View v) {
-                        String url = "https://github.com/QMUI/QMUIDemo_Android";
+                        String url = "https://github.com/QMUI/QMUI_Android";
                         Intent intent = new Intent(Intent.ACTION_VIEW);
                         intent.setData(Uri.parse(url));
                         startActivity(intent);

File: qmuidemo/src/main/java/com/qmuiteam/qmuidemo/fragment/components/viewpager/QDViewPagerFragment.java
Patch:
@@ -9,8 +9,6 @@
 import com.qmuiteam.qmuidemo.QDDataManager;
 import com.qmuiteam.qmuidemo.R;
 import com.qmuiteam.qmuidemo.base.BaseFragment;
-import com.qmuiteam.qmuidemo.fragment.components.qqface.QDQQFacePerformanceTestFragment;
-import com.qmuiteam.qmuidemo.fragment.components.qqface.QDQQFaceUsageFragment;
 import com.qmuiteam.qmuidemo.lib.annotation.Widget;
 import com.qmuiteam.qmuidemo.model.QDItemDescription;
 
@@ -22,7 +20,7 @@
  * @date 2017-09-13
  */
 
-@Widget(widgetClass = QMUIViewPager.class, iconRes = R.mipmap.icon_grid_in_progress)
+@Widget(widgetClass = QMUIViewPager.class, iconRes = R.mipmap.icon_grid_pager_layout_manager)
 public class QDViewPagerFragment extends BaseFragment{
     @BindView(R.id.topbar) QMUITopBar mTopBar;
     @BindView(R.id.groupListView) QMUIGroupListView mGroupListView;

File: qmui/src/main/java/com/qmuiteam/qmui/widget/grouplist/QMUICommonListItemView.java
Patch:
@@ -36,7 +36,7 @@
  *     <li>通过 {@link #setDetailText(String)} 设置一行说明文字, 并通过 {@link #setOrientation(int)} 设置说明文字的位置,
  *     也可以在 xml 中使用 {@link com.qmuiteam.qmui.R.styleable#QMUICommonListItemView_orientation} 设置。</li>
  *     <li>通过 {@link #setAccessoryType(int)} 设置右侧 View 的类型, 可选的类型见 {@link QMUICommonListItemAccessoryType},
- *     也可以在 xml 中使用 {@link com.qmuiteam.qmui.R.styleable#QMUICommonListItemView_accessory_type} 设置。</li>
+ *     也可以在 xml 中使用 {@link com.qmuiteam.qmui.R.styleable#QMUICommonListItemView_qmui_accessory_type} 设置。</li>
  * </ul>
  *
  * @author chantchen
@@ -130,8 +130,8 @@ protected void init(Context context, AttributeSet attrs, int defStyleAttr) {
         LayoutInflater.from(context).inflate(R.layout.qmui_common_list_item, this, true);
 
         TypedArray array = context.obtainStyledAttributes(attrs, R.styleable.QMUICommonListItemView, defStyleAttr, 0);
-        @QMUICommonListItemOrientation int orientation = array.getInt(R.styleable.QMUICommonListItemView_orientation, HORIZONTAL);
-        @QMUICommonListItemAccessoryType int accessoryType = array.getInt(R.styleable.QMUICommonListItemView_accessory_type, ACCESSORY_TYPE_NONE);
+        @QMUICommonListItemOrientation int orientation = array.getInt(R.styleable.QMUICommonListItemView_qmui_orientation, HORIZONTAL);
+        @QMUICommonListItemAccessoryType int accessoryType = array.getInt(R.styleable.QMUICommonListItemView_qmui_accessory_type, ACCESSORY_TYPE_NONE);
         final int initTitleColor = array.getColor(R.styleable.QMUICommonListItemView_qmui_commonList_titleColor, QMUIResHelper.getAttrColor(getContext(), R.attr.qmui_config_color_gray_1));
         final int initDetailColor = array.getColor(R.styleable.QMUICommonListItemView_qmui_commonList_detailColor, QMUIResHelper.getAttrColor(getContext(), R.attr.qmui_config_color_gray_5));
         array.recycle();

