File: yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/service/task/BpmProcessInstanceServiceImpl.java
Patch:
@@ -1 +1 @@
-package cn.iocoder.yudao.module.bpm.service.task;import cn.hutool.core.collection.CollUtil;import cn.hutool.core.collection.ListUtil;import cn.hutool.core.lang.Assert;import cn.hutool.core.util.ArrayUtil;import cn.hutool.core.util.ObjectUtil;import cn.hutool.core.util.StrUtil;import cn.iocoder.yudao.framework.common.pojo.PageResult;import cn.iocoder.yudao.framework.common.util.date.DateUtils;import cn.iocoder.yudao.framework.common.util.json.JsonUtils;import cn.iocoder.yudao.framework.common.util.object.ObjectUtils;import cn.iocoder.yudao.framework.common.util.object.PageUtils;import cn.iocoder.yudao.module.bpm.api.task.dto.BpmProcessInstanceCreateReqDTO;import cn.iocoder.yudao.module.bpm.controller.admin.definition.vo.model.simple.BpmSimpleModelNodeVO;import cn.iocoder.yudao.module.bpm.controller.admin.task.vo.instance.*;import cn.iocoder.yudao.module.bpm.controller.admin.task.vo.instance.BpmApprovalDetailRespVO.ActivityNodeTask;import cn.iocoder.yudao.module.bpm.controller.admin.task.vo.task.BpmTaskRespVO;import cn.iocoder.yudao.module.bpm.convert.task.BpmProcessInstanceConvert;import cn.iocoder.yudao.module.bpm.dal.dataobject.definition.BpmProcessDefinitionInfoDO;import cn.iocoder.yudao.module.bpm.enums.ErrorCodeConstants;import cn.iocoder.yudao.module.bpm.enums.definition.BpmModelTypeEnum;import cn.iocoder.yudao.module.bpm.enums.definition.BpmSimpleModelNodeType;import cn.iocoder.yudao.module.bpm.enums.task.BpmProcessInstanceStatusEnum;import cn.iocoder.yudao.module.bpm.enums.task.BpmReasonEnum;import cn.iocoder.yudao.module.bpm.enums.task.BpmTaskStatusEnum;import cn.iocoder.yudao.module.bpm.framework.flowable.core.candidate.BpmTaskCandidateInvoker;import cn.iocoder.yudao.module.bpm.framework.flowable.core.candidate.strategy.dept.BpmTaskCandidateStartUserSelectStrategy;import cn.iocoder.yudao.module.bpm.framework.flowable.core.enums.BpmnModelConstants;import cn.iocoder.yudao.module.bpm.framework.flowable.core.enums.BpmnVariableConstants;import cn.iocoder.yudao.module.bpm.framework.flowable.core.event.BpmProcessInstanceEventPublisher;import cn.iocoder.yudao.module.bpm.framework.flowable.core.util.BpmnModelUtils;import cn.iocoder.yudao.module.bpm.framework.flowable.core.util.FlowableUtils;import cn.iocoder.yudao.module.bpm.framework.flowable.core.util.SimpleModelUtils;import cn.iocoder.yudao.module.bpm.service.definition.BpmProcessDefinitionService;import cn.iocoder.yudao.module.bpm.service.message.BpmMessageService;import cn.iocoder.yudao.module.system.api.dept.DeptApi;import cn.iocoder.yudao.module.system.api.dept.dto.DeptRespDTO;import cn.iocoder.yudao.module.system.api.user.AdminUserApi;import cn.iocoder.yudao.module.system.api.user.dto.AdminUserRespDTO;import jakarta.annotation.Resource;import jakarta.validation.Valid;import lombok.extern.slf4j.Slf4j;import org.flowable.bpmn.constants.BpmnXMLConstants;import org.flowable.bpmn.model.*;import org.flowable.engine.HistoryService;import org.flowable.engine.RuntimeService;import org.flowable.engine.history.HistoricActivityInstance;import org.flowable.engine.history.HistoricProcessInstance;import org.flowable.engine.history.HistoricProcessInstanceQuery;import org.flowable.engine.repository.ProcessDefinition;import org.flowable.engine.runtime.ProcessInstance;import org.flowable.task.api.history.HistoricTaskInstance;import org.springframework.context.annotation.Lazy;import org.springframework.stereotype.Service;import org.springframework.transaction.annotation.Transactional;import org.springframework.validation.annotation.Validated;import java.util.*;import static cn.iocoder.yudao.framework.common.exception.util.ServiceExceptionUtil.exception;import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.*;import static cn.iocoder.yudao.module.bpm.controller.admin.task.vo.instance.BpmApprovalDetailRespVO.ActivityNode;import static cn.iocoder.yudao.module.bpm.enums.ErrorCodeConstants.*;import static cn.iocoder.yudao.module.bpm.framework.flowable.core.enums.BpmnModelConstants.START_USER_NODE_ID;import static java.util.Arrays.asList;import static java.util.Collections.singletonList;import static org.flowable.bpmn.constants.BpmnXMLConstants.*;/** * 流程实例 Service 实现类 * <p> * ProcessDefinition & ProcessInstance & Execution & Task 的关系： * 1. <a href="https://blog.csdn.net/bobozai86/article/details/105210414" /> * <p> * HistoricProcessInstance & ProcessInstance 的关系： * 1. <a href=" https://my.oschina.net/843294669/blog/71902" /> * <p> * 简单来说，前者 = 历史 + 运行中的流程实例，后者仅是运行中的流程实例 * * @author 芋道源码 */@Service@Validated@Slf4jpublic class BpmProcessInstanceServiceImpl implements BpmProcessInstanceService {    @Resource    private RuntimeService runtimeService;    @Resource    private HistoryService historyService;    @Resource    private BpmProcessDefinitionService processDefinitionService;    @Resource    @Lazy // 避免循环依赖    private BpmTaskService taskService;    @Resource    private BpmMessageService messageService;    @Resource    private AdminUserApi adminUserApi;    @Resource    private DeptApi deptApi;    @Resource    private BpmProcessInstanceEventPublisher processInstanceEventPublisher;    @Resource    private BpmTaskCandidateInvoker taskCandidateInvoker;    // ========== Query 查询相关方法 ==========    @Override    public ProcessInstance getProcessInstance(String id) {        return runtimeService.createProcessInstanceQuery()                .includeProcessVariables()                .processInstanceId(id)                .singleResult();    }    @Override    public List<ProcessInstance> getProcessInstances(Set<String> ids) {        return runtimeService.createProcessInstanceQuery().processInstanceIds(ids).list();    }    @Override    public HistoricProcessInstance getHistoricProcessInstance(String id) {        return historyService.createHistoricProcessInstanceQuery().processInstanceId(id).includeProcessVariables().singleResult();    }    @Override    public List<HistoricProcessInstance> getHistoricProcessInstances(Set<String> ids) {        return historyService.createHistoricProcessInstanceQuery().processInstanceIds(ids).list();    }    @Override    public PageResult<HistoricProcessInstance> getProcessInstancePage(Long userId,                                                                      BpmProcessInstancePageReqVO pageReqVO) {        // 通过 BpmProcessInstanceExtDO 表，先查询到对应的分页        HistoricProcessInstanceQuery processInstanceQuery = historyService.createHistoricProcessInstanceQuery()                .includeProcessVariables()                .processInstanceTenantId(FlowableUtils.getTenantId())                .orderByProcessInstanceStartTime().desc();        if (userId != null) { // 【我的流程】菜单时，需要传递该字段            processInstanceQuery.startedBy(String.valueOf(userId));        } else if (pageReqVO.getStartUserId() != null) { // 【管理流程】菜单时，才会传递该字段            processInstanceQuery.startedBy(String.valueOf(pageReqVO.getStartUserId()));        }        if (StrUtil.isNotEmpty(pageReqVO.getName())) {            processInstanceQuery.processInstanceNameLike("%" + pageReqVO.getName() + "%");        }        if (StrUtil.isNotEmpty(pageReqVO.getProcessDefinitionKey())) {            processInstanceQuery.processDefinitionKey(pageReqVO.getProcessDefinitionKey());        }        if (StrUtil.isNotEmpty(pageReqVO.getCategory())) {            processInstanceQuery.processDefinitionCategory(pageReqVO.getCategory());        }        if (pageReqVO.getStatus() != null) {            processInstanceQuery.variableValueEquals(BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_STATUS, pageReqVO.getStatus());        }        if (ArrayUtil.isNotEmpty(pageReqVO.getCreateTime())) {            processInstanceQuery.startedAfter(DateUtils.of(pageReqVO.getCreateTime()[0]));            processInstanceQuery.startedBefore(DateUtils.of(pageReqVO.getCreateTime()[1]));        }        // 查询数量        long processInstanceCount = processInstanceQuery.count();        if (processInstanceCount == 0) {            return PageResult.empty(processInstanceCount);        }        // 查询列表        List<HistoricProcessInstance> processInstanceList = processInstanceQuery.listPage(PageUtils.getStart(pageReqVO), pageReqVO.getPageSize());        return new PageResult<>(processInstanceList, processInstanceCount);    }    private Map<String, String> getFormFieldsPermission(BpmnModel bpmnModel,                                                        String activityId, String taskId) {        // 1. 获取流程活动编号。流程活动 Id 为空事，从流程任务中获取流程活动 Id        if (StrUtil.isEmpty(activityId) && StrUtil.isNotEmpty(taskId)) {            activityId = Optional.ofNullable(taskService.getHistoricTask(taskId))                    .map(HistoricTaskInstance::getTaskDefinitionKey).orElse(null);        }        if (StrUtil.isEmpty(activityId)) {            return null;        }        // 2. 从 BpmnModel 中解析表单字段权限        return BpmnModelUtils.parseFormFieldsPermission(bpmnModel, activityId);    }    @Override    public BpmApprovalDetailRespVO getApprovalDetail(Long loginUserId, BpmApprovalDetailReqVO reqVO) {        // 1.1 从 reqVO 中，读取公共变量        Long startUserId = loginUserId; // 流程发起人        HistoricProcessInstance historicProcessInstance = null; // 流程实例        Integer processInstanceStatus = BpmProcessInstanceStatusEnum.NOT_START.getStatus(); // 流程状态        Map<String, Object> processVariables = reqVO.getProcessVariables(); // 流程变量        // 1.2 如果是流程已发起的场景，则使用流程实例的数据        if (reqVO.getProcessInstanceId() != null) {            historicProcessInstance = getHistoricProcessInstance(reqVO.getProcessInstanceId());            if (historicProcessInstance == null) {                throw exception(ErrorCodeConstants.PROCESS_INSTANCE_NOT_EXISTS);            }            startUserId = Long.valueOf(historicProcessInstance.getStartUserId());            processInstanceStatus = FlowableUtils.getProcessInstanceStatus(historicProcessInstance);            processVariables = historicProcessInstance.getProcessVariables();        }        // 1.3 读取其它相关数据        ProcessDefinition processDefinition = processDefinitionService.getProcessDefinition(                historicProcessInstance != null ? historicProcessInstance.getProcessDefinitionId() : reqVO.getProcessDefinitionId());        BpmProcessDefinitionInfoDO processDefinitionInfo = processDefinitionService.getProcessDefinitionInfo(processDefinition.getId());        BpmnModel bpmnModel = processDefinitionService.getProcessDefinitionBpmnModel(processDefinition.getId());        // 2.1 已结束 + 进行中的活动节点        List<ActivityNode> endActivityNodes = null; // 已结束的审批信息        List<ActivityNode> runActivityNodes = null; // 进行中的审批信息        List<HistoricActivityInstance> activities = null; // 流程实例列表        if (reqVO.getProcessInstanceId() != null) {            activities = taskService.getActivityListByProcessInstanceId(reqVO.getProcessInstanceId());            List<HistoricTaskInstance> tasks = taskService.getTaskListByProcessInstanceId(reqVO.getProcessInstanceId(), true);            endActivityNodes = getEndActivityNodeList(startUserId, bpmnModel, processDefinitionInfo,                    historicProcessInstance, processInstanceStatus, activities, tasks);            runActivityNodes = getRunApproveNodeList(startUserId, bpmnModel, processDefinition, processVariables, activities, tasks);        }        // 2.2 流程已经结束，直接 return，无需预测        if (BpmProcessInstanceStatusEnum.isProcessEndStatus(processInstanceStatus)) {            return buildApprovalDetail(reqVO, bpmnModel, processDefinition, processDefinitionInfo, historicProcessInstance,                    processInstanceStatus, endActivityNodes, runActivityNodes, null, null);        }        // 3.1 计算当前登录用户的待办任务        // TODO @jason：有一个极端情况，如果一个用户有 2 个 task A 和 B，A 已经通过，B 需要审核。这个时，通过 A 进来，todo 拿到 B，会不会表单权限不一致哈。        BpmTaskRespVO todoTask = taskService.getFirstTodoTask(loginUserId, reqVO.getProcessInstanceId());        // 3.2 预测未运行节点的审批信息        List<ActivityNode> simulateActivityNodes = getSimulateApproveNodeList(startUserId, bpmnModel, processDefinitionInfo,                processVariables, activities);        // 4. 拼接最终数据        return buildApprovalDetail(reqVO, bpmnModel, processDefinition, processDefinitionInfo, historicProcessInstance,                processInstanceStatus, endActivityNodes, runActivityNodes, simulateActivityNodes, todoTask);    }    /**     * 拼接审批详情的最终数据     * <p>     * 主要是，拼接审批人的用户信息、部门信息     */    private BpmApprovalDetailRespVO buildApprovalDetail(BpmApprovalDetailReqVO reqVO,                                                        BpmnModel bpmnModel,                                                        ProcessDefinition processDefinition,                                                        BpmProcessDefinitionInfoDO processDefinitionInfo,                                                        HistoricProcessInstance processInstance,                                                        Integer processInstanceStatus,                                                        List<ActivityNode> endApprovalNodeInfos,                                                        List<ActivityNode> runningApprovalNodeInfos,                                                        List<ActivityNode> simulateApprovalNodeInfos,                                                        BpmTaskRespVO todoTask) {        // 1. 获取所有需要读取用户信息的 userIds        List<ActivityNode> approveNodes = newArrayList(asList(endApprovalNodeInfos, runningApprovalNodeInfos, simulateApprovalNodeInfos));        Set<Long> userIds = BpmProcessInstanceConvert.INSTANCE.parseUserIds(processInstance, approveNodes, todoTask);        Map<Long, AdminUserRespDTO> userMap = adminUserApi.getUserMap(userIds);        Map<Long, DeptRespDTO> deptMap = deptApi.getDeptMap(convertSet(userMap.values(), AdminUserRespDTO::getDeptId));        // 2. 表单权限        String taskId = reqVO.getTaskId() == null && todoTask != null ? todoTask.getId() : reqVO.getTaskId();        Map<String, String> formFieldsPermission = getFormFieldsPermission(bpmnModel, reqVO.getActivityId(), taskId);        // 3. 拼接数据        return BpmProcessInstanceConvert.INSTANCE.buildApprovalDetail(bpmnModel, processDefinition, processDefinitionInfo, processInstance,                processInstanceStatus, approveNodes, todoTask, formFieldsPermission, userMap, deptMap);    }    /**     * 获得【已结束】的活动节点们     */    private List<ActivityNode> getEndActivityNodeList(Long startUserId, BpmnModel bpmnModel,                                                      BpmProcessDefinitionInfoDO processDefinitionInfo,                                                      HistoricProcessInstance historicProcessInstance, Integer processInstanceStatus,                                                      List<HistoricActivityInstance> activities, List<HistoricTaskInstance> tasks) {        // 遍历 tasks 列表，只处理已结束的 UserTask        // 为什么不通过 activities 呢？因为，加签场景下，它只存在于 tasks，没有 activities，导致如果遍历 activities 的话，它无法成为一个节点        List<HistoricTaskInstance> endTasks = filterList(tasks, task -> task.getEndTime() != null);        List<ActivityNode> approvalNodes = convertList(endTasks, task -> {            FlowElement flowNode = BpmnModelUtils.getFlowElementById(bpmnModel, task.getTaskDefinitionKey());            ActivityNode activityNode = new ActivityNode().setId(task.getTaskDefinitionKey()).setName(task.getName())                    .setNodeType(START_USER_NODE_ID.equals(task.getTaskDefinitionKey()) ?                            BpmSimpleModelNodeType.START_USER_NODE.getType() : BpmSimpleModelNodeType.APPROVE_NODE.getType())                    .setStatus(FlowableUtils.getTaskStatus(task))                    .setCandidateStrategy(BpmnModelUtils.parseCandidateStrategy(flowNode))                    .setStartTime(DateUtils.of(task.getCreateTime())).setEndTime(DateUtils.of(task.getEndTime()))                    .setTasks(singletonList(BpmProcessInstanceConvert.INSTANCE.buildApprovalTaskInfo(task)));            // 如果是取消状态，则跳过            if (BpmTaskStatusEnum.isCancelStatus(activityNode.getStatus())) {                return null;            }            return activityNode;        });        // 遍历 activities，只处理已结束的 StartEvent、EndEvent        List<HistoricActivityInstance> endActivities = filterList(activities, activity -> activity.getEndTime() != null                && (StrUtil.equalsAny(activity.getActivityType(), ELEMENT_EVENT_START, ELEMENT_EVENT_END)));        endActivities.forEach(activity -> {            // StartEvent：只处理 BPMN 的场景。因为，SIMPLE 情况下，已经有 START_USER_NODE 节点            if (ELEMENT_EVENT_START.equals(activity.getActivityType())                    && BpmModelTypeEnum.BPMN.getType().equals(processDefinitionInfo.getModelType())) {                ActivityNodeTask startTask = new ActivityNodeTask().setId(BpmnModelConstants.START_USER_NODE_ID)                        .setAssignee(startUserId).setStatus(BpmTaskStatusEnum.APPROVE.getStatus());                ActivityNode startNode = new ActivityNode().setId(startTask.getId())                        .setName(BpmSimpleModelNodeType.START_USER_NODE.getName())                        .setNodeType(BpmSimpleModelNodeType.START_USER_NODE.getType())                        .setStatus(startTask.getStatus()).setTasks(ListUtil.of(startTask))                        .setStartTime(DateUtils.of(activity.getStartTime())).setEndTime(DateUtils.of(activity.getEndTime()));                approvalNodes.add(0, startNode);                return;            }            // EndEvent            if (ELEMENT_EVENT_END.equals(activity.getActivityType())) {                if (BpmProcessInstanceStatusEnum.isRejectStatus(processInstanceStatus)) {                    // 拒绝情况下，不需要展示 EndEvent 结束节点。原因是：前端已经展示 x 效果，无需重复展示                    return;                }                ActivityNode endNode = new ActivityNode().setId(activity.getId())                        .setName(BpmSimpleModelNodeType.END_NODE.getName())                        .setNodeType(BpmSimpleModelNodeType.END_NODE.getType()).setStatus(processInstanceStatus)                        .setStartTime(DateUtils.of(activity.getStartTime())).setEndTime(DateUtils.of(activity.getEndTime()));                String reason = FlowableUtils.getProcessInstanceReason(historicProcessInstance);                if (StrUtil.isNotEmpty(reason)) {                    endNode.setTasks(singletonList(new ActivityNodeTask().setId(endNode.getId())                            .setStatus(endNode.getStatus()).setReason(reason)));                }                approvalNodes.add(endNode);            }        });        return approvalNodes;    }    /**     * 获得【进行中】的活动节点们     */    private List<ActivityNode> getRunApproveNodeList(Long startUserId,                                                     BpmnModel bpmnModel,                                                     ProcessDefinition processDefinition,                                                     Map<String, Object> processVariables,                                                     List<HistoricActivityInstance> activities,                                                     List<HistoricTaskInstance> tasks) {        // 构建运行中的任务，基于 activityId 分组        List<HistoricActivityInstance> runActivities = filterList(activities, activity -> activity.getEndTime() == null                && (StrUtil.equalsAny(activity.getActivityType(), ELEMENT_TASK_USER)));        Map<String, List<HistoricActivityInstance>> runningTaskMap = convertMultiMap(runActivities, HistoricActivityInstance::getActivityId);        // 按照 activityId 分组，构建 ApprovalNodeInfo 节点        Map<String, HistoricTaskInstance> taskMap = convertMap(tasks, HistoricTaskInstance::getId);        return convertList(runningTaskMap.entrySet(), entry -> {            String activityId = entry.getKey();            List<HistoricActivityInstance> taskActivities = entry.getValue();            // 构建活动节点            FlowElement flowNode = BpmnModelUtils.getFlowElementById(bpmnModel, activityId);            HistoricActivityInstance firstActivity = CollUtil.getFirst(taskActivities); // 取第一个任务，会签/或签的任务，开始时间相同            ActivityNode activityNode = new ActivityNode().setId(firstActivity.getActivityId()).setName(firstActivity.getActivityName())                    .setNodeType(BpmSimpleModelNodeType.APPROVE_NODE.getType()).setStatus(BpmTaskStatusEnum.RUNNING.getStatus())                    .setCandidateStrategy(BpmnModelUtils.parseCandidateStrategy(flowNode))                    .setStartTime(DateUtils.of(CollUtil.getFirst(taskActivities).getStartTime()))                    .setTasks(new ArrayList<>());            // 处理每个任务的 tasks 属性            for (HistoricActivityInstance activity : taskActivities) {                HistoricTaskInstance task = taskMap.get(activity.getTaskId());                activityNode.getTasks().add(BpmProcessInstanceConvert.INSTANCE.buildApprovalTaskInfo(task));                // 加签子任务，需要过滤掉已经完成的加签子任务                List<HistoricTaskInstance> childrenTasks = filterList(                        taskService.getAllChildrenTaskListByParentTaskId(activity.getTaskId(), tasks),                        childTask -> childTask.getEndTime() == null);                if (CollUtil.isNotEmpty(childrenTasks)) {                    activityNode.getTasks().addAll(convertList(childrenTasks, BpmProcessInstanceConvert.INSTANCE::buildApprovalTaskInfo));                }            }            // 处理每个任务的 candidateUsers 属性：如果是依次审批，需要预测它的后续审批人。因为 Task 是审批完一个，创建一个新的 Task            if (BpmnModelUtils.isSequentialUserTask(flowNode)) {                List<Long> candidateUserIds = getTaskCandidateUserList(bpmnModel, flowNode.getId(),                        startUserId, processDefinition.getId(), processVariables);                // 截取当前审批人位置后面的候选人，不包含当前审批人                ActivityNodeTask approvalTaskInfo = CollUtil.getFirst(activityNode.getTasks());                Assert.notNull(approvalTaskInfo, "任务不能为空");                int index = CollUtil.indexOf(candidateUserIds, userId -> ObjectUtils.equalsAny(userId, approvalTaskInfo.getOwner(),                        approvalTaskInfo.getAssignee())); // 委派或者向前加签情况，需要先比较 owner                activityNode.setCandidateUserIds(CollUtil.sub(candidateUserIds, index + 1, candidateUserIds.size()));            }            return activityNode;        });    }    /**     * 获得【预测（未来）】的活动节点们     */    private List<ActivityNode> getSimulateApproveNodeList(Long startUserId, BpmnModel bpmnModel,                                                          BpmProcessDefinitionInfoDO processDefinitionInfo,                                                          Map<String, Object> processVariables,                                                          List<HistoricActivityInstance> activities) {        // TODO @芋艿：【可优化】在驳回场景下，未来的预测准确性不高。原因是，驳回后，HistoricActivityInstance 包括了历史的操作，不是只有 startEvent 到当前节点的记录        Set<String> runActivityIds = convertSet(activities, HistoricActivityInstance::getActivityId);        // 情况一：BPMN 设计器        if (Objects.equals(BpmModelTypeEnum.BPMN.getType(), processDefinitionInfo.getModelType())) {            List<FlowElement> flowElements = BpmnModelUtils.simulateProcess(bpmnModel, processVariables);            return convertList(flowElements, flowElement -> buildNotRunApproveNodeForBpmn(startUserId, bpmnModel,                    processDefinitionInfo, processVariables, flowElement, runActivityIds));        }        // 情况二：SIMPLE 设计器        if (Objects.equals(BpmModelTypeEnum.SIMPLE.getType(), processDefinitionInfo.getModelType())) {            BpmSimpleModelNodeVO simpleModel = JsonUtils.parseObject(processDefinitionInfo.getSimpleModel(), BpmSimpleModelNodeVO.class);            List<BpmSimpleModelNodeVO> simpleNodes = SimpleModelUtils.simulateProcess(simpleModel, processVariables);            return convertList(simpleNodes, simpleNode -> buildNotRunApproveNodeForSimple(startUserId, bpmnModel,                    processDefinitionInfo, processVariables, simpleNode, runActivityIds));        }        throw new IllegalArgumentException("未知设计器类型：" + processDefinitionInfo.getModelType());    }    private ActivityNode buildNotRunApproveNodeForSimple(Long startUserId, BpmnModel bpmnModel,                                                         BpmProcessDefinitionInfoDO processDefinitionInfo, Map<String, Object> processVariables,                                                         BpmSimpleModelNodeVO node, Set<String> runActivityIds) {        // TODO @芋艿：【可优化】在驳回场景下，未来的预测准确性不高。原因是，驳回后，HistoricActivityInstance 包括了历史的操作，不是只有 startEvent 到当前节点的记录        if (runActivityIds.contains(node.getId())) {            return null;        }        ActivityNode activityNode = new ActivityNode().setId(node.getId()).setName(node.getName())                .setNodeType(node.getType()).setCandidateStrategy(node.getCandidateStrategy())                .setStatus(BpmTaskStatusEnum.NOT_START.getStatus());        // 1. 开始节点/审批节点        if (ObjectUtils.equalsAny(node.getType(),                BpmSimpleModelNodeType.START_USER_NODE.getType(),                BpmSimpleModelNodeType.APPROVE_NODE.getType())) {            List<Long> candidateUserIds = getTaskCandidateUserList(bpmnModel, node.getId(),                    startUserId, processDefinitionInfo.getProcessDefinitionId(), processVariables);            activityNode.setCandidateUserIds(candidateUserIds);            return activityNode;        }        // 2. 结束节点        if (BpmSimpleModelNodeType.END_NODE.getType().equals(node.getType())) {            return activityNode;        }        // 3. 抄送节点        if (CollUtil.isEmpty(runActivityIds) && // 流程发起时：需要展示抄送节点，用于选择抄送人                BpmSimpleModelNodeType.COPY_NODE.getType().equals(node.getType())) {            return activityNode;        }        return null;    }    private ActivityNode buildNotRunApproveNodeForBpmn(Long startUserId, BpmnModel bpmnModel,                                                       BpmProcessDefinitionInfoDO processDefinitionInfo, Map<String, Object> processVariables,                                                       FlowElement node, Set<String> runActivityIds) {        if (runActivityIds.contains(node.getId())) {            return null;        }        ActivityNode activityNode = new ActivityNode().setId(node.getId()).setStatus(BpmTaskStatusEnum.NOT_START.getStatus());        // 1. 开始节点        if (node instanceof StartEvent) {            return activityNode.setName(BpmSimpleModelNodeType.START_USER_NODE.getName())                    .setNodeType(BpmSimpleModelNodeType.START_USER_NODE.getType());        }        // 2. 审批节点        if (node instanceof UserTask) {            List<Long> candidateUserIds = getTaskCandidateUserList(bpmnModel, node.getId(),                    startUserId, processDefinitionInfo.getProcessDefinitionId(), processVariables);            return activityNode.setName(node.getName()).setNodeType(BpmSimpleModelNodeType.APPROVE_NODE.getType())                    .setCandidateStrategy(BpmnModelUtils.parseCandidateStrategy(node))                    .setCandidateUserIds(candidateUserIds);        }        // 3. 结束节点        if (node instanceof EndEvent) {            return activityNode.setName(BpmSimpleModelNodeType.END_NODE.getName())                    .setNodeType(BpmSimpleModelNodeType.END_NODE.getType());        }        return null;    }    private List<Long> getTaskCandidateUserList(BpmnModel bpmnModel, String activityId,                                                Long startUserId, String processDefinitionId, Map<String, Object> processVariables) {        Set<Long> userIds = taskCandidateInvoker.calculateUsersByActivity(bpmnModel, activityId,                startUserId, processDefinitionId, processVariables);        return new ArrayList<>(userIds);    }    @Override    public BpmProcessInstanceBpmnModelViewRespVO getProcessInstanceBpmnModelView(String id) {        // 1.1 获得流程实例        HistoricProcessInstance processInstance = getHistoricProcessInstance(id);        if (processInstance == null) {            return null;        }        // 1.2 获得流程定义        BpmnModel bpmnModel = processDefinitionService.getProcessDefinitionBpmnModel(processInstance.getProcessDefinitionId());        if (bpmnModel == null) {            return null;        }        BpmSimpleModelNodeVO simpleModel = null;        BpmProcessDefinitionInfoDO processDefinitionInfo = processDefinitionService.getProcessDefinitionInfo(                processInstance.getProcessDefinitionId());        if (processDefinitionInfo != null && BpmModelTypeEnum.SIMPLE.getType().equals(processDefinitionInfo.getModelType())) {            simpleModel = JsonUtils.parseObject(processDefinitionInfo.getSimpleModel(), BpmSimpleModelNodeVO.class);        }        // 1.3 获得流程实例对应的活动实例列表 + 任务列表        List<HistoricActivityInstance> activities = taskService.getActivityListByProcessInstanceId(id);        List<HistoricTaskInstance> tasks = taskService.getTaskListByProcessInstanceId(id, true);        // 2.1 拼接进度信息        Set<String> unfinishedTaskActivityIds = convertSet(activities, HistoricActivityInstance::getActivityId,                activityInstance -> activityInstance.getEndTime() == null);        Set<String> finishedTaskActivityIds = convertSet(activities, HistoricActivityInstance::getActivityId,                activityInstance -> activityInstance.getEndTime() != null                        && ObjectUtil.notEqual(activityInstance.getActivityType(), BpmnXMLConstants.ELEMENT_SEQUENCE_FLOW));        Set<String> finishedSequenceFlowActivityIds = convertSet(activities, HistoricActivityInstance::getActivityId,                activityInstance -> activityInstance.getEndTime() != null                        && ObjectUtil.equals(activityInstance.getActivityType(), BpmnXMLConstants.ELEMENT_SEQUENCE_FLOW));        // 特殊：会签情况下，会有部分已完成（审批）、部分未完成（待审批），此时需要 finishedTaskActivityIds 移除掉        finishedTaskActivityIds.removeAll(unfinishedTaskActivityIds);        // 特殊：如果流程实例被拒绝，则需要计算是哪个活动节点。        // 注意，只取最后一个。因为会存在多次拒绝的情况，拒绝驳回到指定节点        Set<String> rejectTaskActivityIds = CollUtil.newHashSet();        if (BpmProcessInstanceStatusEnum.isRejectStatus(FlowableUtils.getProcessInstanceStatus(processInstance))) {            tasks.stream()                    .filter(task -> BpmTaskStatusEnum.isRejectStatus(FlowableUtils.getTaskStatus(task)))                    .max(Comparator.comparing(HistoricTaskInstance::getEndTime))                    .ifPresent(reject -> rejectTaskActivityIds.add(reject.getTaskDefinitionKey()));            finishedTaskActivityIds.removeAll(rejectTaskActivityIds);        }        // 2.2 拼接基础信息        Set<Long> userIds = BpmProcessInstanceConvert.INSTANCE.parseUserIds02(processInstance, tasks);        Map<Long, AdminUserRespDTO> userMap = adminUserApi.getUserMap(userIds);        Map<Long, DeptRespDTO> deptMap = deptApi.getDeptMap(convertSet(userMap.values(), AdminUserRespDTO::getDeptId));        return BpmProcessInstanceConvert.INSTANCE.buildProcessInstanceBpmnModelView(processInstance, tasks, bpmnModel, simpleModel,                unfinishedTaskActivityIds, finishedTaskActivityIds, finishedSequenceFlowActivityIds, rejectTaskActivityIds,                userMap, deptMap);    }    // ========== Update 写入相关方法 ==========    @Override    @Transactional(rollbackFor = Exception.class)    public String createProcessInstance(Long userId, @Valid BpmProcessInstanceCreateReqVO createReqVO) {        // 获得流程定义        ProcessDefinition definition = processDefinitionService.getProcessDefinition(createReqVO.getProcessDefinitionId());        // 发起流程        return createProcessInstance0(userId, definition, createReqVO.getVariables(), null,                createReqVO.getStartUserSelectAssignees());    }    @Override    public String createProcessInstance(Long userId, @Valid BpmProcessInstanceCreateReqDTO createReqDTO) {        return FlowableUtils.executeAuthenticatedUserId(userId, () -> {            // 获得流程定义            ProcessDefinition definition = processDefinitionService.getActiveProcessDefinition(createReqDTO.getProcessDefinitionKey());            // 发起流程            return createProcessInstance0(userId, definition, createReqDTO.getVariables(), createReqDTO.getBusinessKey(),                    createReqDTO.getStartUserSelectAssignees());        });    }    private String createProcessInstance0(Long userId, ProcessDefinition definition,                                          Map<String, Object> variables, String businessKey,                                          Map<String, List<Long>> startUserSelectAssignees) {        // 1.1 校验流程定义        if (definition == null) {            throw exception(PROCESS_DEFINITION_NOT_EXISTS);        }        if (definition.isSuspended()) {            throw exception(PROCESS_DEFINITION_IS_SUSPENDED);        }        BpmProcessDefinitionInfoDO processDefinitionInfo = processDefinitionService.getProcessDefinitionInfo(definition.getId());        if (processDefinitionInfo == null) {            throw exception(PROCESS_DEFINITION_NOT_EXISTS);        }        // 1.2 校验是否能够发起        if (!processDefinitionService.canUserStartProcessDefinition(processDefinitionInfo, userId)) {            throw exception(PROCESS_INSTANCE_START_USER_CAN_START);        }        // 1.3 校验发起人自选审批人        validateStartUserSelectAssignees(definition, startUserSelectAssignees);        // 2. 创建流程实例        if (variables == null) {            variables = new HashMap<>();        }        FlowableUtils.filterProcessInstanceFormVariable(variables); // 过滤一下，避免 ProcessInstance 系统级的变量被占用        variables.put(BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_START_USER_ID, userId); // 设置流程变量，发起人 ID        variables.put(BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_STATUS, // 流程实例状态：审批中                BpmProcessInstanceStatusEnum.RUNNING.getStatus());        if (CollUtil.isNotEmpty(startUserSelectAssignees)) {            variables.put(BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_START_USER_SELECT_ASSIGNEES, startUserSelectAssignees);        }        ProcessInstance instance = runtimeService.createProcessInstanceBuilder()                .processDefinitionId(definition.getId())                .businessKey(businessKey)                .name(definition.getName().trim())                .variables(variables)                .start();        return instance.getId();    }    private void validateStartUserSelectAssignees(ProcessDefinition definition, Map<String, List<Long>> startUserSelectAssignees) {        // 1. 获得发起人自选审批人的 UserTask/ServiceTask 列表        BpmnModel bpmnModel = processDefinitionService.getProcessDefinitionBpmnModel(definition.getId());        List<Task> tasks = BpmTaskCandidateStartUserSelectStrategy.getStartUserSelectTaskList(bpmnModel);        if (CollUtil.isEmpty(tasks)) {            return;        }        // 2. 校验发起人自选审批人的审批人和抄送人是否都配置了        tasks.forEach(task -> {            List<Long> assignees = startUserSelectAssignees != null ? startUserSelectAssignees.get(task.getId()) : null;            if (CollUtil.isEmpty(assignees)) {                throw exception(PROCESS_INSTANCE_START_USER_SELECT_ASSIGNEES_NOT_CONFIG, task.getName());            }            Map<Long, AdminUserRespDTO> userMap = adminUserApi.getUserMap(assignees);            assignees.forEach(assignee -> {                if (userMap.get(assignee) == null) {                    throw exception(PROCESS_INSTANCE_START_USER_SELECT_ASSIGNEES_NOT_EXISTS, task.getName(), assignee);                }            });        });    }    @Override    public void cancelProcessInstanceByStartUser(Long userId, @Valid BpmProcessInstanceCancelReqVO cancelReqVO) {        // 1.1 校验流程实例存在        ProcessInstance instance = getProcessInstance(cancelReqVO.getId());        if (instance == null) {            throw exception(PROCESS_INSTANCE_CANCEL_FAIL_NOT_EXISTS);        }        // 1.2 只能取消自己的        if (!Objects.equals(instance.getStartUserId(), String.valueOf(userId))) {            throw exception(PROCESS_INSTANCE_CANCEL_FAIL_NOT_SELF);        }        // 2. 取消流程        updateProcessInstanceCancel(cancelReqVO.getId(),                BpmReasonEnum.CANCEL_PROCESS_INSTANCE_BY_START_USER.format(cancelReqVO.getReason()));    }    @Override    public void cancelProcessInstanceByAdmin(Long userId, BpmProcessInstanceCancelReqVO cancelReqVO) {        // 1.1 校验流程实例存在        ProcessInstance instance = getProcessInstance(cancelReqVO.getId());        if (instance == null) {            throw exception(PROCESS_INSTANCE_CANCEL_FAIL_NOT_EXISTS);        }        // 2. 取消流程        AdminUserRespDTO user = adminUserApi.getUser(userId).getCheckedData();        updateProcessInstanceCancel(cancelReqVO.getId(),                BpmReasonEnum.CANCEL_PROCESS_INSTANCE_BY_ADMIN.format(user.getNickname(), cancelReqVO.getReason()));    }    private void updateProcessInstanceCancel(String id, String reason) {        // 1. 更新流程实例 status        runtimeService.setVariable(id, BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_STATUS,                BpmProcessInstanceStatusEnum.CANCEL.getStatus());        runtimeService.setVariable(id, BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_REASON, reason);        // 2. 结束流程        taskService.moveTaskToEnd(id);    }    @Override    public void updateProcessInstanceReject(ProcessInstance processInstance, String reason) {        runtimeService.setVariable(processInstance.getProcessInstanceId(), BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_STATUS,                BpmProcessInstanceStatusEnum.REJECT.getStatus());        runtimeService.setVariable(processInstance.getProcessInstanceId(), BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_REASON,                BpmReasonEnum.REJECT_TASK.format(reason));    }    // ========== Event 事件相关方法 ==========    @Override    public void processProcessInstanceCompleted(ProcessInstance instance) {        // 注意：需要基于 instance 设置租户编号，避免 Flowable 内部异步时，丢失租户编号        FlowableUtils.execute(instance.getTenantId(), () -> {            // 1.1 获取当前状态            Integer status = (Integer) instance.getProcessVariables().get(BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_STATUS);            String reason = (String) instance.getProcessVariables().get(BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_REASON);            // 1.2 当流程状态还是审批状态中，说明审批通过了，则变更下它的状态            // 为什么这么处理？因为流程完成，并且完成了，说明审批通过了            if (Objects.equals(status, BpmProcessInstanceStatusEnum.RUNNING.getStatus())) {                status = BpmProcessInstanceStatusEnum.APPROVE.getStatus();                runtimeService.setVariable(instance.getId(), BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_STATUS, status);            }            // 2. 发送对应的消息通知            if (Objects.equals(status, BpmProcessInstanceStatusEnum.APPROVE.getStatus())) {                messageService.sendMessageWhenProcessInstanceApprove(BpmProcessInstanceConvert.INSTANCE.buildProcessInstanceApproveMessage(instance));            } else if (Objects.equals(status, BpmProcessInstanceStatusEnum.REJECT.getStatus())) {                messageService.sendMessageWhenProcessInstanceReject(                        BpmProcessInstanceConvert.INSTANCE.buildProcessInstanceRejectMessage(instance, reason));            }            // 3. 发送流程实例的状态事件            processInstanceEventPublisher.sendProcessInstanceResultEvent(                    BpmProcessInstanceConvert.INSTANCE.buildProcessInstanceStatusEvent(this, instance, status));        });    }}
\ No newline at end of file
+package cn.iocoder.yudao.module.bpm.service.task;import cn.hutool.core.collection.CollUtil;import cn.hutool.core.collection.ListUtil;import cn.hutool.core.lang.Assert;import cn.hutool.core.util.ArrayUtil;import cn.hutool.core.util.ObjectUtil;import cn.hutool.core.util.StrUtil;import cn.iocoder.yudao.framework.common.pojo.PageResult;import cn.iocoder.yudao.framework.common.util.date.DateUtils;import cn.iocoder.yudao.framework.common.util.json.JsonUtils;import cn.iocoder.yudao.framework.common.util.object.ObjectUtils;import cn.iocoder.yudao.framework.common.util.object.PageUtils;import cn.iocoder.yudao.module.bpm.api.task.dto.BpmProcessInstanceCreateReqDTO;import cn.iocoder.yudao.module.bpm.controller.admin.definition.vo.model.simple.BpmSimpleModelNodeVO;import cn.iocoder.yudao.module.bpm.controller.admin.task.vo.instance.*;import cn.iocoder.yudao.module.bpm.controller.admin.task.vo.instance.BpmApprovalDetailRespVO.ActivityNodeTask;import cn.iocoder.yudao.module.bpm.controller.admin.task.vo.task.BpmTaskRespVO;import cn.iocoder.yudao.module.bpm.convert.task.BpmProcessInstanceConvert;import cn.iocoder.yudao.module.bpm.dal.dataobject.definition.BpmProcessDefinitionInfoDO;import cn.iocoder.yudao.module.bpm.enums.ErrorCodeConstants;import cn.iocoder.yudao.module.bpm.enums.definition.BpmModelTypeEnum;import cn.iocoder.yudao.module.bpm.enums.definition.BpmSimpleModelNodeType;import cn.iocoder.yudao.module.bpm.enums.task.BpmProcessInstanceStatusEnum;import cn.iocoder.yudao.module.bpm.enums.task.BpmReasonEnum;import cn.iocoder.yudao.module.bpm.enums.task.BpmTaskStatusEnum;import cn.iocoder.yudao.module.bpm.framework.flowable.core.candidate.BpmTaskCandidateInvoker;import cn.iocoder.yudao.module.bpm.framework.flowable.core.candidate.strategy.dept.BpmTaskCandidateStartUserSelectStrategy;import cn.iocoder.yudao.module.bpm.framework.flowable.core.enums.BpmnModelConstants;import cn.iocoder.yudao.module.bpm.framework.flowable.core.enums.BpmnVariableConstants;import cn.iocoder.yudao.module.bpm.framework.flowable.core.event.BpmProcessInstanceEventPublisher;import cn.iocoder.yudao.module.bpm.framework.flowable.core.util.BpmnModelUtils;import cn.iocoder.yudao.module.bpm.framework.flowable.core.util.FlowableUtils;import cn.iocoder.yudao.module.bpm.framework.flowable.core.util.SimpleModelUtils;import cn.iocoder.yudao.module.bpm.service.definition.BpmProcessDefinitionService;import cn.iocoder.yudao.module.bpm.service.message.BpmMessageService;import cn.iocoder.yudao.module.system.api.dept.DeptApi;import cn.iocoder.yudao.module.system.api.dept.dto.DeptRespDTO;import cn.iocoder.yudao.module.system.api.user.AdminUserApi;import cn.iocoder.yudao.module.system.api.user.dto.AdminUserRespDTO;import lombok.extern.slf4j.Slf4j;import org.flowable.bpmn.constants.BpmnXMLConstants;import org.flowable.bpmn.model.*;import org.flowable.engine.HistoryService;import org.flowable.engine.RuntimeService;import org.flowable.engine.history.HistoricActivityInstance;import org.flowable.engine.history.HistoricProcessInstance;import org.flowable.engine.history.HistoricProcessInstanceQuery;import org.flowable.engine.repository.ProcessDefinition;import org.flowable.engine.runtime.ProcessInstance;import org.flowable.task.api.history.HistoricTaskInstance;import org.springframework.context.annotation.Lazy;import org.springframework.stereotype.Service;import org.springframework.transaction.annotation.Transactional;import org.springframework.validation.annotation.Validated;import javax.validation.Valid;import javax.annotation.Resource;import java.util.*;import static cn.iocoder.yudao.framework.common.exception.util.ServiceExceptionUtil.exception;import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.*;import static cn.iocoder.yudao.module.bpm.controller.admin.task.vo.instance.BpmApprovalDetailRespVO.ActivityNode;import static cn.iocoder.yudao.module.bpm.enums.ErrorCodeConstants.*;import static cn.iocoder.yudao.module.bpm.framework.flowable.core.enums.BpmnModelConstants.START_USER_NODE_ID;import static java.util.Arrays.asList;import static java.util.Collections.singletonList;import static org.flowable.bpmn.constants.BpmnXMLConstants.*;/** * 流程实例 Service 实现类 * <p> * ProcessDefinition & ProcessInstance & Execution & Task 的关系： * 1. <a href="https://blog.csdn.net/bobozai86/article/details/105210414" /> * <p> * HistoricProcessInstance & ProcessInstance 的关系： * 1. <a href=" https://my.oschina.net/843294669/blog/71902" /> * <p> * 简单来说，前者 = 历史 + 运行中的流程实例，后者仅是运行中的流程实例 * * @author 芋道源码 */@Service@Validated@Slf4jpublic class BpmProcessInstanceServiceImpl implements BpmProcessInstanceService {    @Resource    private RuntimeService runtimeService;    @Resource    private HistoryService historyService;    @Resource    private BpmProcessDefinitionService processDefinitionService;    @Resource    @Lazy // 避免循环依赖    private BpmTaskService taskService;    @Resource    private BpmMessageService messageService;    @Resource    private AdminUserApi adminUserApi;    @Resource    private DeptApi deptApi;    @Resource    private BpmProcessInstanceEventPublisher processInstanceEventPublisher;    @Resource    private BpmTaskCandidateInvoker taskCandidateInvoker;    // ========== Query 查询相关方法 ==========    @Override    public ProcessInstance getProcessInstance(String id) {        return runtimeService.createProcessInstanceQuery()                .includeProcessVariables()                .processInstanceId(id)                .singleResult();    }    @Override    public List<ProcessInstance> getProcessInstances(Set<String> ids) {        return runtimeService.createProcessInstanceQuery().processInstanceIds(ids).list();    }    @Override    public HistoricProcessInstance getHistoricProcessInstance(String id) {        return historyService.createHistoricProcessInstanceQuery().processInstanceId(id).includeProcessVariables().singleResult();    }    @Override    public List<HistoricProcessInstance> getHistoricProcessInstances(Set<String> ids) {        return historyService.createHistoricProcessInstanceQuery().processInstanceIds(ids).list();    }    @Override    public PageResult<HistoricProcessInstance> getProcessInstancePage(Long userId,                                                                      BpmProcessInstancePageReqVO pageReqVO) {        // 通过 BpmProcessInstanceExtDO 表，先查询到对应的分页        HistoricProcessInstanceQuery processInstanceQuery = historyService.createHistoricProcessInstanceQuery()                .includeProcessVariables()                .processInstanceTenantId(FlowableUtils.getTenantId())                .orderByProcessInstanceStartTime().desc();        if (userId != null) { // 【我的流程】菜单时，需要传递该字段            processInstanceQuery.startedBy(String.valueOf(userId));        } else if (pageReqVO.getStartUserId() != null) { // 【管理流程】菜单时，才会传递该字段            processInstanceQuery.startedBy(String.valueOf(pageReqVO.getStartUserId()));        }        if (StrUtil.isNotEmpty(pageReqVO.getName())) {            processInstanceQuery.processInstanceNameLike("%" + pageReqVO.getName() + "%");        }        if (StrUtil.isNotEmpty(pageReqVO.getProcessDefinitionKey())) {            processInstanceQuery.processDefinitionKey(pageReqVO.getProcessDefinitionKey());        }        if (StrUtil.isNotEmpty(pageReqVO.getCategory())) {            processInstanceQuery.processDefinitionCategory(pageReqVO.getCategory());        }        if (pageReqVO.getStatus() != null) {            processInstanceQuery.variableValueEquals(BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_STATUS, pageReqVO.getStatus());        }        if (ArrayUtil.isNotEmpty(pageReqVO.getCreateTime())) {            processInstanceQuery.startedAfter(DateUtils.of(pageReqVO.getCreateTime()[0]));            processInstanceQuery.startedBefore(DateUtils.of(pageReqVO.getCreateTime()[1]));        }        // 查询数量        long processInstanceCount = processInstanceQuery.count();        if (processInstanceCount == 0) {            return PageResult.empty(processInstanceCount);        }        // 查询列表        List<HistoricProcessInstance> processInstanceList = processInstanceQuery.listPage(PageUtils.getStart(pageReqVO), pageReqVO.getPageSize());        return new PageResult<>(processInstanceList, processInstanceCount);    }    private Map<String, String> getFormFieldsPermission(BpmnModel bpmnModel,                                                        String activityId, String taskId) {        // 1. 获取流程活动编号。流程活动 Id 为空事，从流程任务中获取流程活动 Id        if (StrUtil.isEmpty(activityId) && StrUtil.isNotEmpty(taskId)) {            activityId = Optional.ofNullable(taskService.getHistoricTask(taskId))                    .map(HistoricTaskInstance::getTaskDefinitionKey).orElse(null);        }        if (StrUtil.isEmpty(activityId)) {            return null;        }        // 2. 从 BpmnModel 中解析表单字段权限        return BpmnModelUtils.parseFormFieldsPermission(bpmnModel, activityId);    }    @Override    public BpmApprovalDetailRespVO getApprovalDetail(Long loginUserId, BpmApprovalDetailReqVO reqVO) {        // 1.1 从 reqVO 中，读取公共变量        Long startUserId = loginUserId; // 流程发起人        HistoricProcessInstance historicProcessInstance = null; // 流程实例        Integer processInstanceStatus = BpmProcessInstanceStatusEnum.NOT_START.getStatus(); // 流程状态        Map<String, Object> processVariables = reqVO.getProcessVariables(); // 流程变量        // 1.2 如果是流程已发起的场景，则使用流程实例的数据        if (reqVO.getProcessInstanceId() != null) {            historicProcessInstance = getHistoricProcessInstance(reqVO.getProcessInstanceId());            if (historicProcessInstance == null) {                throw exception(ErrorCodeConstants.PROCESS_INSTANCE_NOT_EXISTS);            }            startUserId = Long.valueOf(historicProcessInstance.getStartUserId());            processInstanceStatus = FlowableUtils.getProcessInstanceStatus(historicProcessInstance);            processVariables = historicProcessInstance.getProcessVariables();        }        // 1.3 读取其它相关数据        ProcessDefinition processDefinition = processDefinitionService.getProcessDefinition(                historicProcessInstance != null ? historicProcessInstance.getProcessDefinitionId() : reqVO.getProcessDefinitionId());        BpmProcessDefinitionInfoDO processDefinitionInfo = processDefinitionService.getProcessDefinitionInfo(processDefinition.getId());        BpmnModel bpmnModel = processDefinitionService.getProcessDefinitionBpmnModel(processDefinition.getId());        // 2.1 已结束 + 进行中的活动节点        List<ActivityNode> endActivityNodes = null; // 已结束的审批信息        List<ActivityNode> runActivityNodes = null; // 进行中的审批信息        List<HistoricActivityInstance> activities = null; // 流程实例列表        if (reqVO.getProcessInstanceId() != null) {            activities = taskService.getActivityListByProcessInstanceId(reqVO.getProcessInstanceId());            List<HistoricTaskInstance> tasks = taskService.getTaskListByProcessInstanceId(reqVO.getProcessInstanceId(), true);            endActivityNodes = getEndActivityNodeList(startUserId, bpmnModel, processDefinitionInfo,                    historicProcessInstance, processInstanceStatus, activities, tasks);            runActivityNodes = getRunApproveNodeList(startUserId, bpmnModel, processDefinition, processVariables, activities, tasks);        }        // 2.2 流程已经结束，直接 return，无需预测        if (BpmProcessInstanceStatusEnum.isProcessEndStatus(processInstanceStatus)) {            return buildApprovalDetail(reqVO, bpmnModel, processDefinition, processDefinitionInfo, historicProcessInstance,                    processInstanceStatus, endActivityNodes, runActivityNodes, null, null);        }        // 3.1 计算当前登录用户的待办任务        // TODO @jason：有一个极端情况，如果一个用户有 2 个 task A 和 B，A 已经通过，B 需要审核。这个时，通过 A 进来，todo 拿到 B，会不会表单权限不一致哈。        BpmTaskRespVO todoTask = taskService.getFirstTodoTask(loginUserId, reqVO.getProcessInstanceId());        // 3.2 预测未运行节点的审批信息        List<ActivityNode> simulateActivityNodes = getSimulateApproveNodeList(startUserId, bpmnModel, processDefinitionInfo,                processVariables, activities);        // 4. 拼接最终数据        return buildApprovalDetail(reqVO, bpmnModel, processDefinition, processDefinitionInfo, historicProcessInstance,                processInstanceStatus, endActivityNodes, runActivityNodes, simulateActivityNodes, todoTask);    }    /**     * 拼接审批详情的最终数据     * <p>     * 主要是，拼接审批人的用户信息、部门信息     */    private BpmApprovalDetailRespVO buildApprovalDetail(BpmApprovalDetailReqVO reqVO,                                                        BpmnModel bpmnModel,                                                        ProcessDefinition processDefinition,                                                        BpmProcessDefinitionInfoDO processDefinitionInfo,                                                        HistoricProcessInstance processInstance,                                                        Integer processInstanceStatus,                                                        List<ActivityNode> endApprovalNodeInfos,                                                        List<ActivityNode> runningApprovalNodeInfos,                                                        List<ActivityNode> simulateApprovalNodeInfos,                                                        BpmTaskRespVO todoTask) {        // 1. 获取所有需要读取用户信息的 userIds        List<ActivityNode> approveNodes = newArrayList(asList(endApprovalNodeInfos, runningApprovalNodeInfos, simulateApprovalNodeInfos));        Set<Long> userIds = BpmProcessInstanceConvert.INSTANCE.parseUserIds(processInstance, approveNodes, todoTask);        Map<Long, AdminUserRespDTO> userMap = adminUserApi.getUserMap(userIds);        Map<Long, DeptRespDTO> deptMap = deptApi.getDeptMap(convertSet(userMap.values(), AdminUserRespDTO::getDeptId));        // 2. 表单权限        String taskId = reqVO.getTaskId() == null && todoTask != null ? todoTask.getId() : reqVO.getTaskId();        Map<String, String> formFieldsPermission = getFormFieldsPermission(bpmnModel, reqVO.getActivityId(), taskId);        // 3. 拼接数据        return BpmProcessInstanceConvert.INSTANCE.buildApprovalDetail(bpmnModel, processDefinition, processDefinitionInfo, processInstance,                processInstanceStatus, approveNodes, todoTask, formFieldsPermission, userMap, deptMap);    }    /**     * 获得【已结束】的活动节点们     */    private List<ActivityNode> getEndActivityNodeList(Long startUserId, BpmnModel bpmnModel,                                                      BpmProcessDefinitionInfoDO processDefinitionInfo,                                                      HistoricProcessInstance historicProcessInstance, Integer processInstanceStatus,                                                      List<HistoricActivityInstance> activities, List<HistoricTaskInstance> tasks) {        // 遍历 tasks 列表，只处理已结束的 UserTask        // 为什么不通过 activities 呢？因为，加签场景下，它只存在于 tasks，没有 activities，导致如果遍历 activities 的话，它无法成为一个节点        List<HistoricTaskInstance> endTasks = filterList(tasks, task -> task.getEndTime() != null);        List<ActivityNode> approvalNodes = convertList(endTasks, task -> {            FlowElement flowNode = BpmnModelUtils.getFlowElementById(bpmnModel, task.getTaskDefinitionKey());            ActivityNode activityNode = new ActivityNode().setId(task.getTaskDefinitionKey()).setName(task.getName())                    .setNodeType(START_USER_NODE_ID.equals(task.getTaskDefinitionKey()) ?                            BpmSimpleModelNodeType.START_USER_NODE.getType() : BpmSimpleModelNodeType.APPROVE_NODE.getType())                    .setStatus(FlowableUtils.getTaskStatus(task))                    .setCandidateStrategy(BpmnModelUtils.parseCandidateStrategy(flowNode))                    .setStartTime(DateUtils.of(task.getCreateTime())).setEndTime(DateUtils.of(task.getEndTime()))                    .setTasks(singletonList(BpmProcessInstanceConvert.INSTANCE.buildApprovalTaskInfo(task)));            // 如果是取消状态，则跳过            if (BpmTaskStatusEnum.isCancelStatus(activityNode.getStatus())) {                return null;            }            return activityNode;        });        // 遍历 activities，只处理已结束的 StartEvent、EndEvent        List<HistoricActivityInstance> endActivities = filterList(activities, activity -> activity.getEndTime() != null                && (StrUtil.equalsAny(activity.getActivityType(), ELEMENT_EVENT_START, ELEMENT_EVENT_END)));        endActivities.forEach(activity -> {            // StartEvent：只处理 BPMN 的场景。因为，SIMPLE 情况下，已经有 START_USER_NODE 节点            if (ELEMENT_EVENT_START.equals(activity.getActivityType())                    && BpmModelTypeEnum.BPMN.getType().equals(processDefinitionInfo.getModelType())) {                ActivityNodeTask startTask = new ActivityNodeTask().setId(BpmnModelConstants.START_USER_NODE_ID)                        .setAssignee(startUserId).setStatus(BpmTaskStatusEnum.APPROVE.getStatus());                ActivityNode startNode = new ActivityNode().setId(startTask.getId())                        .setName(BpmSimpleModelNodeType.START_USER_NODE.getName())                        .setNodeType(BpmSimpleModelNodeType.START_USER_NODE.getType())                        .setStatus(startTask.getStatus()).setTasks(ListUtil.of(startTask))                        .setStartTime(DateUtils.of(activity.getStartTime())).setEndTime(DateUtils.of(activity.getEndTime()));                approvalNodes.add(0, startNode);                return;            }            // EndEvent            if (ELEMENT_EVENT_END.equals(activity.getActivityType())) {                if (BpmProcessInstanceStatusEnum.isRejectStatus(processInstanceStatus)) {                    // 拒绝情况下，不需要展示 EndEvent 结束节点。原因是：前端已经展示 x 效果，无需重复展示                    return;                }                ActivityNode endNode = new ActivityNode().setId(activity.getId())                        .setName(BpmSimpleModelNodeType.END_NODE.getName())                        .setNodeType(BpmSimpleModelNodeType.END_NODE.getType()).setStatus(processInstanceStatus)                        .setStartTime(DateUtils.of(activity.getStartTime())).setEndTime(DateUtils.of(activity.getEndTime()));                String reason = FlowableUtils.getProcessInstanceReason(historicProcessInstance);                if (StrUtil.isNotEmpty(reason)) {                    endNode.setTasks(singletonList(new ActivityNodeTask().setId(endNode.getId())                            .setStatus(endNode.getStatus()).setReason(reason)));                }                approvalNodes.add(endNode);            }        });        return approvalNodes;    }    /**     * 获得【进行中】的活动节点们     */    private List<ActivityNode> getRunApproveNodeList(Long startUserId,                                                     BpmnModel bpmnModel,                                                     ProcessDefinition processDefinition,                                                     Map<String, Object> processVariables,                                                     List<HistoricActivityInstance> activities,                                                     List<HistoricTaskInstance> tasks) {        // 构建运行中的任务，基于 activityId 分组        List<HistoricActivityInstance> runActivities = filterList(activities, activity -> activity.getEndTime() == null                && (StrUtil.equalsAny(activity.getActivityType(), ELEMENT_TASK_USER)));        Map<String, List<HistoricActivityInstance>> runningTaskMap = convertMultiMap(runActivities, HistoricActivityInstance::getActivityId);        // 按照 activityId 分组，构建 ApprovalNodeInfo 节点        Map<String, HistoricTaskInstance> taskMap = convertMap(tasks, HistoricTaskInstance::getId);        return convertList(runningTaskMap.entrySet(), entry -> {            String activityId = entry.getKey();            List<HistoricActivityInstance> taskActivities = entry.getValue();            // 构建活动节点            FlowElement flowNode = BpmnModelUtils.getFlowElementById(bpmnModel, activityId);            HistoricActivityInstance firstActivity = CollUtil.getFirst(taskActivities); // 取第一个任务，会签/或签的任务，开始时间相同            ActivityNode activityNode = new ActivityNode().setId(firstActivity.getActivityId()).setName(firstActivity.getActivityName())                    .setNodeType(BpmSimpleModelNodeType.APPROVE_NODE.getType()).setStatus(BpmTaskStatusEnum.RUNNING.getStatus())                    .setCandidateStrategy(BpmnModelUtils.parseCandidateStrategy(flowNode))                    .setStartTime(DateUtils.of(CollUtil.getFirst(taskActivities).getStartTime()))                    .setTasks(new ArrayList<>());            // 处理每个任务的 tasks 属性            for (HistoricActivityInstance activity : taskActivities) {                HistoricTaskInstance task = taskMap.get(activity.getTaskId());                activityNode.getTasks().add(BpmProcessInstanceConvert.INSTANCE.buildApprovalTaskInfo(task));                // 加签子任务，需要过滤掉已经完成的加签子任务                List<HistoricTaskInstance> childrenTasks = filterList(                        taskService.getAllChildrenTaskListByParentTaskId(activity.getTaskId(), tasks),                        childTask -> childTask.getEndTime() == null);                if (CollUtil.isNotEmpty(childrenTasks)) {                    activityNode.getTasks().addAll(convertList(childrenTasks, BpmProcessInstanceConvert.INSTANCE::buildApprovalTaskInfo));                }            }            // 处理每个任务的 candidateUsers 属性：如果是依次审批，需要预测它的后续审批人。因为 Task 是审批完一个，创建一个新的 Task            if (BpmnModelUtils.isSequentialUserTask(flowNode)) {                List<Long> candidateUserIds = getTaskCandidateUserList(bpmnModel, flowNode.getId(),                        startUserId, processDefinition.getId(), processVariables);                // 截取当前审批人位置后面的候选人，不包含当前审批人                ActivityNodeTask approvalTaskInfo = CollUtil.getFirst(activityNode.getTasks());                Assert.notNull(approvalTaskInfo, "任务不能为空");                int index = CollUtil.indexOf(candidateUserIds, userId -> ObjectUtils.equalsAny(userId, approvalTaskInfo.getOwner(),                        approvalTaskInfo.getAssignee())); // 委派或者向前加签情况，需要先比较 owner                activityNode.setCandidateUserIds(CollUtil.sub(candidateUserIds, index + 1, candidateUserIds.size()));            }            return activityNode;        });    }    /**     * 获得【预测（未来）】的活动节点们     */    private List<ActivityNode> getSimulateApproveNodeList(Long startUserId, BpmnModel bpmnModel,                                                          BpmProcessDefinitionInfoDO processDefinitionInfo,                                                          Map<String, Object> processVariables,                                                          List<HistoricActivityInstance> activities) {        // TODO @芋艿：【可优化】在驳回场景下，未来的预测准确性不高。原因是，驳回后，HistoricActivityInstance 包括了历史的操作，不是只有 startEvent 到当前节点的记录        Set<String> runActivityIds = convertSet(activities, HistoricActivityInstance::getActivityId);        // 情况一：BPMN 设计器        if (Objects.equals(BpmModelTypeEnum.BPMN.getType(), processDefinitionInfo.getModelType())) {            List<FlowElement> flowElements = BpmnModelUtils.simulateProcess(bpmnModel, processVariables);            return convertList(flowElements, flowElement -> buildNotRunApproveNodeForBpmn(startUserId, bpmnModel,                    processDefinitionInfo, processVariables, flowElement, runActivityIds));        }        // 情况二：SIMPLE 设计器        if (Objects.equals(BpmModelTypeEnum.SIMPLE.getType(), processDefinitionInfo.getModelType())) {            BpmSimpleModelNodeVO simpleModel = JsonUtils.parseObject(processDefinitionInfo.getSimpleModel(), BpmSimpleModelNodeVO.class);            List<BpmSimpleModelNodeVO> simpleNodes = SimpleModelUtils.simulateProcess(simpleModel, processVariables);            return convertList(simpleNodes, simpleNode -> buildNotRunApproveNodeForSimple(startUserId, bpmnModel,                    processDefinitionInfo, processVariables, simpleNode, runActivityIds));        }        throw new IllegalArgumentException("未知设计器类型：" + processDefinitionInfo.getModelType());    }    private ActivityNode buildNotRunApproveNodeForSimple(Long startUserId, BpmnModel bpmnModel,                                                         BpmProcessDefinitionInfoDO processDefinitionInfo, Map<String, Object> processVariables,                                                         BpmSimpleModelNodeVO node, Set<String> runActivityIds) {        // TODO @芋艿：【可优化】在驳回场景下，未来的预测准确性不高。原因是，驳回后，HistoricActivityInstance 包括了历史的操作，不是只有 startEvent 到当前节点的记录        if (runActivityIds.contains(node.getId())) {            return null;        }        ActivityNode activityNode = new ActivityNode().setId(node.getId()).setName(node.getName())                .setNodeType(node.getType()).setCandidateStrategy(node.getCandidateStrategy())                .setStatus(BpmTaskStatusEnum.NOT_START.getStatus());        // 1. 开始节点/审批节点        if (ObjectUtils.equalsAny(node.getType(),                BpmSimpleModelNodeType.START_USER_NODE.getType(),                BpmSimpleModelNodeType.APPROVE_NODE.getType())) {            List<Long> candidateUserIds = getTaskCandidateUserList(bpmnModel, node.getId(),                    startUserId, processDefinitionInfo.getProcessDefinitionId(), processVariables);            activityNode.setCandidateUserIds(candidateUserIds);            return activityNode;        }        // 2. 结束节点        if (BpmSimpleModelNodeType.END_NODE.getType().equals(node.getType())) {            return activityNode;        }        // 3. 抄送节点        if (CollUtil.isEmpty(runActivityIds) && // 流程发起时：需要展示抄送节点，用于选择抄送人                BpmSimpleModelNodeType.COPY_NODE.getType().equals(node.getType())) {            return activityNode;        }        return null;    }    private ActivityNode buildNotRunApproveNodeForBpmn(Long startUserId, BpmnModel bpmnModel,                                                       BpmProcessDefinitionInfoDO processDefinitionInfo, Map<String, Object> processVariables,                                                       FlowElement node, Set<String> runActivityIds) {        if (runActivityIds.contains(node.getId())) {            return null;        }        ActivityNode activityNode = new ActivityNode().setId(node.getId()).setStatus(BpmTaskStatusEnum.NOT_START.getStatus());        // 1. 开始节点        if (node instanceof StartEvent) {            return activityNode.setName(BpmSimpleModelNodeType.START_USER_NODE.getName())                    .setNodeType(BpmSimpleModelNodeType.START_USER_NODE.getType());        }        // 2. 审批节点        if (node instanceof UserTask) {            List<Long> candidateUserIds = getTaskCandidateUserList(bpmnModel, node.getId(),                    startUserId, processDefinitionInfo.getProcessDefinitionId(), processVariables);            return activityNode.setName(node.getName()).setNodeType(BpmSimpleModelNodeType.APPROVE_NODE.getType())                    .setCandidateStrategy(BpmnModelUtils.parseCandidateStrategy(node))                    .setCandidateUserIds(candidateUserIds);        }        // 3. 结束节点        if (node instanceof EndEvent) {            return activityNode.setName(BpmSimpleModelNodeType.END_NODE.getName())                    .setNodeType(BpmSimpleModelNodeType.END_NODE.getType());        }        return null;    }    private List<Long> getTaskCandidateUserList(BpmnModel bpmnModel, String activityId,                                                Long startUserId, String processDefinitionId, Map<String, Object> processVariables) {        Set<Long> userIds = taskCandidateInvoker.calculateUsersByActivity(bpmnModel, activityId,                startUserId, processDefinitionId, processVariables);        return new ArrayList<>(userIds);    }    @Override    public BpmProcessInstanceBpmnModelViewRespVO getProcessInstanceBpmnModelView(String id) {        // 1.1 获得流程实例        HistoricProcessInstance processInstance = getHistoricProcessInstance(id);        if (processInstance == null) {            return null;        }        // 1.2 获得流程定义        BpmnModel bpmnModel = processDefinitionService.getProcessDefinitionBpmnModel(processInstance.getProcessDefinitionId());        if (bpmnModel == null) {            return null;        }        BpmSimpleModelNodeVO simpleModel = null;        BpmProcessDefinitionInfoDO processDefinitionInfo = processDefinitionService.getProcessDefinitionInfo(                processInstance.getProcessDefinitionId());        if (processDefinitionInfo != null && BpmModelTypeEnum.SIMPLE.getType().equals(processDefinitionInfo.getModelType())) {            simpleModel = JsonUtils.parseObject(processDefinitionInfo.getSimpleModel(), BpmSimpleModelNodeVO.class);        }        // 1.3 获得流程实例对应的活动实例列表 + 任务列表        List<HistoricActivityInstance> activities = taskService.getActivityListByProcessInstanceId(id);        List<HistoricTaskInstance> tasks = taskService.getTaskListByProcessInstanceId(id, true);        // 2.1 拼接进度信息        Set<String> unfinishedTaskActivityIds = convertSet(activities, HistoricActivityInstance::getActivityId,                activityInstance -> activityInstance.getEndTime() == null);        Set<String> finishedTaskActivityIds = convertSet(activities, HistoricActivityInstance::getActivityId,                activityInstance -> activityInstance.getEndTime() != null                        && ObjectUtil.notEqual(activityInstance.getActivityType(), BpmnXMLConstants.ELEMENT_SEQUENCE_FLOW));        Set<String> finishedSequenceFlowActivityIds = convertSet(activities, HistoricActivityInstance::getActivityId,                activityInstance -> activityInstance.getEndTime() != null                        && ObjectUtil.equals(activityInstance.getActivityType(), BpmnXMLConstants.ELEMENT_SEQUENCE_FLOW));        // 特殊：会签情况下，会有部分已完成（审批）、部分未完成（待审批），此时需要 finishedTaskActivityIds 移除掉        finishedTaskActivityIds.removeAll(unfinishedTaskActivityIds);        // 特殊：如果流程实例被拒绝，则需要计算是哪个活动节点。        // 注意，只取最后一个。因为会存在多次拒绝的情况，拒绝驳回到指定节点        Set<String> rejectTaskActivityIds = CollUtil.newHashSet();        if (BpmProcessInstanceStatusEnum.isRejectStatus(FlowableUtils.getProcessInstanceStatus(processInstance))) {            tasks.stream()                    .filter(task -> BpmTaskStatusEnum.isRejectStatus(FlowableUtils.getTaskStatus(task)))                    .max(Comparator.comparing(HistoricTaskInstance::getEndTime))                    .ifPresent(reject -> rejectTaskActivityIds.add(reject.getTaskDefinitionKey()));            finishedTaskActivityIds.removeAll(rejectTaskActivityIds);        }        // 2.2 拼接基础信息        Set<Long> userIds = BpmProcessInstanceConvert.INSTANCE.parseUserIds02(processInstance, tasks);        Map<Long, AdminUserRespDTO> userMap = adminUserApi.getUserMap(userIds);        Map<Long, DeptRespDTO> deptMap = deptApi.getDeptMap(convertSet(userMap.values(), AdminUserRespDTO::getDeptId));        return BpmProcessInstanceConvert.INSTANCE.buildProcessInstanceBpmnModelView(processInstance, tasks, bpmnModel, simpleModel,                unfinishedTaskActivityIds, finishedTaskActivityIds, finishedSequenceFlowActivityIds, rejectTaskActivityIds,                userMap, deptMap);    }    // ========== Update 写入相关方法 ==========    @Override    @Transactional(rollbackFor = Exception.class)    public String createProcessInstance(Long userId, @Valid BpmProcessInstanceCreateReqVO createReqVO) {        // 获得流程定义        ProcessDefinition definition = processDefinitionService.getProcessDefinition(createReqVO.getProcessDefinitionId());        // 发起流程        return createProcessInstance0(userId, definition, createReqVO.getVariables(), null,                createReqVO.getStartUserSelectAssignees());    }    @Override    public String createProcessInstance(Long userId, @Valid BpmProcessInstanceCreateReqDTO createReqDTO) {        return FlowableUtils.executeAuthenticatedUserId(userId, () -> {            // 获得流程定义            ProcessDefinition definition = processDefinitionService.getActiveProcessDefinition(createReqDTO.getProcessDefinitionKey());            // 发起流程            return createProcessInstance0(userId, definition, createReqDTO.getVariables(), createReqDTO.getBusinessKey(),                    createReqDTO.getStartUserSelectAssignees());        });    }    private String createProcessInstance0(Long userId, ProcessDefinition definition,                                          Map<String, Object> variables, String businessKey,                                          Map<String, List<Long>> startUserSelectAssignees) {        // 1.1 校验流程定义        if (definition == null) {            throw exception(PROCESS_DEFINITION_NOT_EXISTS);        }        if (definition.isSuspended()) {            throw exception(PROCESS_DEFINITION_IS_SUSPENDED);        }        BpmProcessDefinitionInfoDO processDefinitionInfo = processDefinitionService.getProcessDefinitionInfo(definition.getId());        if (processDefinitionInfo == null) {            throw exception(PROCESS_DEFINITION_NOT_EXISTS);        }        // 1.2 校验是否能够发起        if (!processDefinitionService.canUserStartProcessDefinition(processDefinitionInfo, userId)) {            throw exception(PROCESS_INSTANCE_START_USER_CAN_START);        }        // 1.3 校验发起人自选审批人        validateStartUserSelectAssignees(definition, startUserSelectAssignees);        // 2. 创建流程实例        if (variables == null) {            variables = new HashMap<>();        }        FlowableUtils.filterProcessInstanceFormVariable(variables); // 过滤一下，避免 ProcessInstance 系统级的变量被占用        variables.put(BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_START_USER_ID, userId); // 设置流程变量，发起人 ID        variables.put(BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_STATUS, // 流程实例状态：审批中                BpmProcessInstanceStatusEnum.RUNNING.getStatus());        if (CollUtil.isNotEmpty(startUserSelectAssignees)) {            variables.put(BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_START_USER_SELECT_ASSIGNEES, startUserSelectAssignees);        }        ProcessInstance instance = runtimeService.createProcessInstanceBuilder()                .processDefinitionId(definition.getId())                .businessKey(businessKey)                .name(definition.getName().trim())                .variables(variables)                .start();        return instance.getId();    }    private void validateStartUserSelectAssignees(ProcessDefinition definition, Map<String, List<Long>> startUserSelectAssignees) {        // 1. 获得发起人自选审批人的 UserTask/ServiceTask 列表        BpmnModel bpmnModel = processDefinitionService.getProcessDefinitionBpmnModel(definition.getId());        List<Task> tasks = BpmTaskCandidateStartUserSelectStrategy.getStartUserSelectTaskList(bpmnModel);        if (CollUtil.isEmpty(tasks)) {            return;        }        // 2. 校验发起人自选审批人的审批人和抄送人是否都配置了        tasks.forEach(task -> {            List<Long> assignees = startUserSelectAssignees != null ? startUserSelectAssignees.get(task.getId()) : null;            if (CollUtil.isEmpty(assignees)) {                throw exception(PROCESS_INSTANCE_START_USER_SELECT_ASSIGNEES_NOT_CONFIG, task.getName());            }            Map<Long, AdminUserRespDTO> userMap = adminUserApi.getUserMap(assignees);            assignees.forEach(assignee -> {                if (userMap.get(assignee) == null) {                    throw exception(PROCESS_INSTANCE_START_USER_SELECT_ASSIGNEES_NOT_EXISTS, task.getName(), assignee);                }            });        });    }    @Override    public void cancelProcessInstanceByStartUser(Long userId, @Valid BpmProcessInstanceCancelReqVO cancelReqVO) {        // 1.1 校验流程实例存在        ProcessInstance instance = getProcessInstance(cancelReqVO.getId());        if (instance == null) {            throw exception(PROCESS_INSTANCE_CANCEL_FAIL_NOT_EXISTS);        }        // 1.2 只能取消自己的        if (!Objects.equals(instance.getStartUserId(), String.valueOf(userId))) {            throw exception(PROCESS_INSTANCE_CANCEL_FAIL_NOT_SELF);        }        // 2. 取消流程        updateProcessInstanceCancel(cancelReqVO.getId(),                BpmReasonEnum.CANCEL_PROCESS_INSTANCE_BY_START_USER.format(cancelReqVO.getReason()));    }    @Override    public void cancelProcessInstanceByAdmin(Long userId, BpmProcessInstanceCancelReqVO cancelReqVO) {        // 1.1 校验流程实例存在        ProcessInstance instance = getProcessInstance(cancelReqVO.getId());        if (instance == null) {            throw exception(PROCESS_INSTANCE_CANCEL_FAIL_NOT_EXISTS);        }        // 2. 取消流程        AdminUserRespDTO user = adminUserApi.getUser(userId).getCheckedData();        updateProcessInstanceCancel(cancelReqVO.getId(),                BpmReasonEnum.CANCEL_PROCESS_INSTANCE_BY_ADMIN.format(user.getNickname(), cancelReqVO.getReason()));    }    private void updateProcessInstanceCancel(String id, String reason) {        // 1. 更新流程实例 status        runtimeService.setVariable(id, BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_STATUS,                BpmProcessInstanceStatusEnum.CANCEL.getStatus());        runtimeService.setVariable(id, BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_REASON, reason);        // 2. 结束流程        taskService.moveTaskToEnd(id);    }    @Override    public void updateProcessInstanceReject(ProcessInstance processInstance, String reason) {        runtimeService.setVariable(processInstance.getProcessInstanceId(), BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_STATUS,                BpmProcessInstanceStatusEnum.REJECT.getStatus());        runtimeService.setVariable(processInstance.getProcessInstanceId(), BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_REASON,                BpmReasonEnum.REJECT_TASK.format(reason));    }    // ========== Event 事件相关方法 ==========    @Override    public void processProcessInstanceCompleted(ProcessInstance instance) {        // 注意：需要基于 instance 设置租户编号，避免 Flowable 内部异步时，丢失租户编号        FlowableUtils.execute(instance.getTenantId(), () -> {            // 1.1 获取当前状态            Integer status = (Integer) instance.getProcessVariables().get(BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_STATUS);            String reason = (String) instance.getProcessVariables().get(BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_REASON);            // 1.2 当流程状态还是审批状态中，说明审批通过了，则变更下它的状态            // 为什么这么处理？因为流程完成，并且完成了，说明审批通过了            if (Objects.equals(status, BpmProcessInstanceStatusEnum.RUNNING.getStatus())) {                status = BpmProcessInstanceStatusEnum.APPROVE.getStatus();                runtimeService.setVariable(instance.getId(), BpmnVariableConstants.PROCESS_INSTANCE_VARIABLE_STATUS, status);            }            // 2. 发送对应的消息通知            if (Objects.equals(status, BpmProcessInstanceStatusEnum.APPROVE.getStatus())) {                messageService.sendMessageWhenProcessInstanceApprove(BpmProcessInstanceConvert.INSTANCE.buildProcessInstanceApproveMessage(instance));            } else if (Objects.equals(status, BpmProcessInstanceStatusEnum.REJECT.getStatus())) {                messageService.sendMessageWhenProcessInstanceReject(                        BpmProcessInstanceConvert.INSTANCE.buildProcessInstanceRejectMessage(instance, reason));            }            // 3. 发送流程实例的状态事件            processInstanceEventPublisher.sendProcessInstanceResultEvent(                    BpmProcessInstanceConvert.INSTANCE.buildProcessInstanceStatusEvent(this, instance, status));        });    }}
\ No newline at end of file

File: yudao-module-pay/yudao-module-pay-biz/src/main/java/cn/iocoder/yudao/module/pay/job/notify/PayNotifyJob.java
Patch:
@@ -4,7 +4,7 @@
 import cn.iocoder.yudao.framework.tenant.core.job.TenantJob;
 import cn.iocoder.yudao.module.pay.service.notify.PayNotifyService;
 import com.xxl.job.core.handler.annotation.XxlJob;
-import jakarta.annotation.Resource;
+import javax.annotation.Resource;
 import lombok.extern.slf4j.Slf4j;
 import org.springframework.stereotype.Component;
 

File: yudao-module-pay/yudao-module-pay-biz/src/main/java/cn/iocoder/yudao/module/pay/job/order/PayOrderExpireJob.java
Patch:
@@ -4,7 +4,7 @@
 import cn.iocoder.yudao.framework.tenant.core.job.TenantJob;
 import cn.iocoder.yudao.module.pay.service.order.PayOrderService;
 import com.xxl.job.core.handler.annotation.XxlJob;
-import jakarta.annotation.Resource;
+import javax.annotation.Resource;
 import lombok.extern.slf4j.Slf4j;
 import org.springframework.stereotype.Component;
 

File: yudao-module-pay/yudao-module-pay-biz/src/main/java/cn/iocoder/yudao/module/pay/job/order/PayOrderSyncJob.java
Patch:
@@ -4,7 +4,7 @@
 import cn.iocoder.yudao.framework.tenant.core.job.TenantJob;
 import cn.iocoder.yudao.module.pay.service.order.PayOrderService;
 import com.xxl.job.core.handler.annotation.XxlJob;
-import jakarta.annotation.Resource;
+import javax.annotation.Resource;
 import lombok.extern.slf4j.Slf4j;
 import org.springframework.stereotype.Component;
 

File: yudao-module-pay/yudao-module-pay-biz/src/main/java/cn/iocoder/yudao/module/pay/job/refund/PayRefundSyncJob.java
Patch:
@@ -4,7 +4,7 @@
 import cn.iocoder.yudao.framework.tenant.core.job.TenantJob;
 import cn.iocoder.yudao.module.pay.service.refund.PayRefundService;
 import com.xxl.job.core.handler.annotation.XxlJob;
-import jakarta.annotation.Resource;
+import javax.annotation.Resource;
 import lombok.extern.slf4j.Slf4j;
 import org.springframework.stereotype.Component;
 

File: yudao-module-pay/yudao-module-pay-biz/src/main/java/cn/iocoder/yudao/module/pay/job/notify/PayNotifyJob.java
Patch:
@@ -4,7 +4,7 @@
 import cn.iocoder.yudao.framework.tenant.core.job.TenantJob;
 import cn.iocoder.yudao.module.pay.service.notify.PayNotifyService;
 import com.xxl.job.core.handler.annotation.XxlJob;
-import jakarta.annotation.Resource;
+import javax.annotation.Resource;
 import lombok.extern.slf4j.Slf4j;
 import org.springframework.stereotype.Component;
 

File: yudao-module-pay/yudao-module-pay-biz/src/main/java/cn/iocoder/yudao/module/pay/job/order/PayOrderExpireJob.java
Patch:
@@ -4,7 +4,7 @@
 import cn.iocoder.yudao.framework.tenant.core.job.TenantJob;
 import cn.iocoder.yudao.module.pay.service.order.PayOrderService;
 import com.xxl.job.core.handler.annotation.XxlJob;
-import jakarta.annotation.Resource;
+import javax.annotation.Resource;
 import lombok.extern.slf4j.Slf4j;
 import org.springframework.stereotype.Component;
 

File: yudao-module-pay/yudao-module-pay-biz/src/main/java/cn/iocoder/yudao/module/pay/job/order/PayOrderSyncJob.java
Patch:
@@ -4,7 +4,7 @@
 import cn.iocoder.yudao.framework.tenant.core.job.TenantJob;
 import cn.iocoder.yudao.module.pay.service.order.PayOrderService;
 import com.xxl.job.core.handler.annotation.XxlJob;
-import jakarta.annotation.Resource;
+import javax.annotation.Resource;
 import lombok.extern.slf4j.Slf4j;
 import org.springframework.stereotype.Component;
 

File: yudao-module-pay/yudao-module-pay-biz/src/main/java/cn/iocoder/yudao/module/pay/job/refund/PayRefundSyncJob.java
Patch:
@@ -4,7 +4,7 @@
 import cn.iocoder.yudao.framework.tenant.core.job.TenantJob;
 import cn.iocoder.yudao.module.pay.service.refund.PayRefundService;
 import com.xxl.job.core.handler.annotation.XxlJob;
-import jakarta.annotation.Resource;
+import javax.annotation.Resource;
 import lombok.extern.slf4j.Slf4j;
 import org.springframework.stereotype.Component;
 

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/logger/dto/LoginLogCreateReqDTO.java
Patch:
@@ -1,9 +1,9 @@
 package cn.iocoder.yudao.module.system.api.logger.dto;
 
 import io.swagger.v3.oas.annotations.media.Schema;
-import jakarta.validation.constraints.NotEmpty;
-import jakarta.validation.constraints.NotNull;
-import jakarta.validation.constraints.Size;
+import javax.validation.constraints.NotEmpty;
+import javax.validation.constraints.NotNull;
+import javax.validation.constraints.Size;
 import lombok.Data;
 
 @Schema(description = "RPC 服务 - 登录日志创建 Request DTO")

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/logger/dto/LoginLogCreateReqDTO.java
Patch:
@@ -1,9 +1,9 @@
 package cn.iocoder.yudao.module.system.api.logger.dto;
 
 import io.swagger.v3.oas.annotations.media.Schema;
-import jakarta.validation.constraints.NotEmpty;
-import jakarta.validation.constraints.NotNull;
-import jakarta.validation.constraints.Size;
+import javax.validation.constraints.NotEmpty;
+import javax.validation.constraints.NotNull;
+import javax.validation.constraints.Size;
 import lombok.Data;
 
 @Schema(description = "RPC 服务 - 登录日志创建 Request DTO")

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/enums/DictTypeConstants.java
Patch:
@@ -13,6 +13,7 @@ public interface DictTypeConstants {
     // ========== SYSTEM 模块 ==========
 
     String USER_SEX = "system_user_sex"; // 用户性别
+    String DATA_SCOPE = "system_data_scope"; // 数据范围
 
     String LOGIN_TYPE = "system_login_type"; // 登录日志的类型
     String LOGIN_RESULT = "system_login_result"; // 登录结果

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/enums/ErrorCodeConstants.java
Patch:
@@ -27,10 +27,10 @@ public interface ErrorCodeConstants {
     // ========== 角色模块 1-002-002-000 ==========
     ErrorCode ROLE_NOT_EXISTS = new ErrorCode(1_002_002_000, "角色不存在");
     ErrorCode ROLE_NAME_DUPLICATE = new ErrorCode(1_002_002_001, "已经存在名为【{}】的角色");
-    ErrorCode ROLE_CODE_DUPLICATE = new ErrorCode(1_002_002_002, "已经存在编码为【{}】的角色");
+    ErrorCode ROLE_CODE_DUPLICATE = new ErrorCode(1_002_002_002, "已经存在标识为【{}】的角色");
     ErrorCode ROLE_CAN_NOT_UPDATE_SYSTEM_TYPE_ROLE = new ErrorCode(1_002_002_003, "不能操作类型为系统内置的角色");
     ErrorCode ROLE_IS_DISABLE = new ErrorCode(1_002_002_004, "名字为【{}】的角色已被禁用");
-    ErrorCode ROLE_ADMIN_CODE_ERROR = new ErrorCode(1_002_002_005, "编码【{}】不能使用");
+    ErrorCode ROLE_ADMIN_CODE_ERROR = new ErrorCode(1_002_002_005, "标识【{}】不能使用");
 
     // ========== 用户模块 1-002-003-000 ==========
     ErrorCode USER_USERNAME_EXISTS = new ErrorCode(1_002_003_000, "用户账号已经存在");

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/permission/vo/role/RoleRespVO.java
Patch:
@@ -46,7 +46,8 @@ public class RoleRespVO {
     private String remark;
 
     @Schema(description = "数据范围，参见 DataScopeEnum 枚举类", requiredMode = Schema.RequiredMode.REQUIRED, example = "1")
-    @ExcelProperty("数据范围")
+    @ExcelProperty(value = "数据范围", converter = DictConvert.class)
+    @DictFormat(DictTypeConstants.DATA_SCOPE)
     private Integer dataScope;
 
     @Schema(description = "数据范围(指定部门数组)", example = "1")

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/permission/RoleController.java
Patch:
@@ -93,8 +93,8 @@ public void export(HttpServletResponse response, @Validated RolePageReqVO export
         exportReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);
         List<RoleDO> list = roleService.getRolePage(exportReqVO).getList();
         // 输出
-        ExcelUtils.write(response, "角色数据.xls", "数据", RoleExportExcelVO.class,
-                BeanUtils.toBean(list, RoleExportExcelVO.class));
+        ExcelUtils.write(response, "角色数据.xls", "数据", RoleRespVO.class,
+                BeanUtils.toBean(list, RoleRespVO.class));
     }
 
 }

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/enums/DictTypeConstants.java
Patch:
@@ -13,6 +13,7 @@ public interface DictTypeConstants {
     // ========== SYSTEM 模块 ==========
 
     String USER_SEX = "system_user_sex"; // 用户性别
+    String DATA_SCOPE = "system_data_scope"; // 数据范围
 
     String LOGIN_TYPE = "system_login_type"; // 登录日志的类型
     String LOGIN_RESULT = "system_login_result"; // 登录结果

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/enums/ErrorCodeConstants.java
Patch:
@@ -27,10 +27,10 @@ public interface ErrorCodeConstants {
     // ========== 角色模块 1-002-002-000 ==========
     ErrorCode ROLE_NOT_EXISTS = new ErrorCode(1_002_002_000, "角色不存在");
     ErrorCode ROLE_NAME_DUPLICATE = new ErrorCode(1_002_002_001, "已经存在名为【{}】的角色");
-    ErrorCode ROLE_CODE_DUPLICATE = new ErrorCode(1_002_002_002, "已经存在编码为【{}】的角色");
+    ErrorCode ROLE_CODE_DUPLICATE = new ErrorCode(1_002_002_002, "已经存在标识为【{}】的角色");
     ErrorCode ROLE_CAN_NOT_UPDATE_SYSTEM_TYPE_ROLE = new ErrorCode(1_002_002_003, "不能操作类型为系统内置的角色");
     ErrorCode ROLE_IS_DISABLE = new ErrorCode(1_002_002_004, "名字为【{}】的角色已被禁用");
-    ErrorCode ROLE_ADMIN_CODE_ERROR = new ErrorCode(1_002_002_005, "编码【{}】不能使用");
+    ErrorCode ROLE_ADMIN_CODE_ERROR = new ErrorCode(1_002_002_005, "标识【{}】不能使用");
 
     // ========== 用户模块 1-002-003-000 ==========
     ErrorCode USER_USERNAME_EXISTS = new ErrorCode(1_002_003_000, "用户账号已经存在");

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/permission/RoleController.java
Patch:
@@ -93,8 +93,8 @@ public void export(HttpServletResponse response, @Validated RolePageReqVO export
         exportReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);
         List<RoleDO> list = roleService.getRolePage(exportReqVO).getList();
         // 输出
-        ExcelUtils.write(response, "角色数据.xls", "数据", RoleRespVO.class,
-                BeanUtils.toBean(list, RoleRespVO.class));
+        ExcelUtils.write(response, "角色数据.xls", "数据", RoleExportExcelVO.class,
+                BeanUtils.toBean(list, RoleExportExcelVO.class));
     }
 
 }

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/permission/vo/role/RoleSaveReqVO.java
Patch:
@@ -24,7 +24,7 @@ public class RoleSaveReqVO {
 
     @NotBlank(message = "角色标志不能为空")
     @Size(max = 100, message = "角色标志长度不能超过 100 个字符")
-    @Schema(description = "角色编码", requiredMode = Schema.RequiredMode.REQUIRED, example = "ADMIN")
+    @Schema(description = "角色标志", requiredMode = Schema.RequiredMode.REQUIRED, example = "ADMIN")
     @DiffLogField(name = "角色标志")
     private String code;
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/permission/vo/role/RoleSaveReqVO.java
Patch:
@@ -40,6 +40,7 @@ public class RoleSaveReqVO {
     private Integer status;
 
     @Schema(description = "备注", example = "我是一个角色")
+    @Size(max = 500, message = "备注长度不能超过 500 个字符")
     @DiffLogField(name = "备注")
     private String remark;
 

File: yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/controller/admin/task/BpmProcessInstanceController.java
Patch:
@@ -135,7 +135,7 @@ public CommonResult<BpmProcessInstanceRespVO> getProcessInstance(@RequestParam("
                 processDefinitionService.getProcessDefinitionBpmnModel(processInstance.getProcessDefinitionId()));
         AdminUserRespDTO startUser = adminUserApi.getUser(NumberUtils.parseLong(processInstance.getStartUserId())).getCheckedData();
         DeptRespDTO dept = null;
-        if (startUser != null) {
+        if (startUser != null && startUser.getDeptId() != null) {
             dept = deptApi.getDept(startUser.getDeptId()).getCheckedData();
         }
         return success(BpmProcessInstanceConvert.INSTANCE.buildProcessInstance(processInstance,

File: yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/service/definition/BpmModelServiceImpl.java
Patch:
@@ -262,7 +262,9 @@ private void updateProcessDefinitionSuspended(String deploymentId) {
     }
 
     private Model getModelByKey(String key) {
-        return repositoryService.createModelQuery().modelKey(key).singleResult();
+        return repositoryService.createModelQuery()
+                .modelTenantId(FlowableUtils.getTenantId())
+                .modelKey(key).singleResult();
     }
 
     @Override

File: yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/dal/mysql/spu/ProductSpuMapper.java
Patch:
@@ -30,7 +30,8 @@ default PageResult<ProductSpuDO> selectPage(ProductSpuPageReqVO reqVO) {
                 .likeIfPresent(ProductSpuDO::getName, reqVO.getName())
                 .eqIfPresent(ProductSpuDO::getCategoryId, reqVO.getCategoryId())
                 .betweenIfPresent(ProductSpuDO::getCreateTime, reqVO.getCreateTime())
-                .orderByDesc(ProductSpuDO::getSort);
+                .orderByDesc(ProductSpuDO::getSort)
+                .orderByDesc(ProductSpuDO::getId);
         appendTabQuery(tabType, queryWrapper);
         return selectPage(reqVO, queryWrapper);
     }

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/dal/dataobject/business/CrmBusinessStatusDO.java
Patch:
@@ -1,5 +1,6 @@
 package cn.iocoder.yudao.module.crm.dal.dataobject.business;
 
+import cn.iocoder.yudao.framework.mybatis.core.dataobject.BaseDO;
 import com.baomidou.mybatisplus.annotation.KeySequence;
 import com.baomidou.mybatisplus.annotation.TableId;
 import com.baomidou.mybatisplus.annotation.TableName;
@@ -19,7 +20,7 @@
 @Builder
 @NoArgsConstructor
 @AllArgsConstructor
-public class CrmBusinessStatusDO {
+public class CrmBusinessStatusDO extends BaseDO {
 
     /**
      * 主键

File: yudao-module-erp/yudao-module-erp-api/src/main/java/cn/iocoder/yudao/module/erp/enums/common/ErpBizTypeEnum.java
Patch:
@@ -20,7 +20,7 @@ public enum ErpBizTypeEnum implements IntArrayValuable {
     PURCHASE_RETURN(12, "采购退货"),
 
     SALE_ORDER(20, "销售订单"),
-    SALE_OUT(21, "销售订单"),
+    SALE_OUT(21, "销售出库"),
     SALE_RETURN(22, "销售退货"),
     ;
 

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/dal/dataobject/file/FileContentDO.java
Patch:
@@ -28,8 +28,8 @@ public class FileContentDO extends BaseDO {
     /**
      * 编号，数据库自增
      */
-    @TableId(type = IdType.INPUT)
-    private String id;
+    @TableId
+    private Long id;
     /**
      * 配置编号
      *

File: yudao-module-mall/yudao-module-statistics-biz/src/main/java/cn/iocoder/yudao/module/statistics/dal/mysql/trade/TradeOrderStatisticsMapper.java
Patch:
@@ -58,7 +58,7 @@ List<TradeOrderTrendRespVO> selectListByPayTimeBetweenAndGroupByMonth(@Param("be
 
     Long selectCountByStatusAndDeliveryType(@Param("status") Integer status, @Param("deliveryType") Integer deliveryType);
 
-    TradeOrderSummaryRespVO selectPaySummaryByPayStatusAndPayTimeBetween(@Param("payStatus") Integer payStatus,
+    TradeOrderSummaryRespVO selectPaySummaryByPayStatusAndPayTimeBetween(@Param("payStatus") Boolean payStatus,
                                                                          @Param("beginTime") LocalDateTime beginTime,
                                                                          @Param("endTime") LocalDateTime endTime);
 

File: yudao-module-mall/yudao-module-statistics-biz/src/main/java/cn/iocoder/yudao/module/statistics/service/trade/TradeOrderStatisticsServiceImpl.java
Patch:
@@ -75,9 +75,9 @@ public DataComparisonRespVO<TradeOrderSummaryRespVO> getOrderComparison() {
 
     private TradeOrderSummaryRespVO getPayPriceSummary(LocalDateTime date) {
         LocalDateTime beginTime = LocalDateTimeUtil.beginOfDay(date);
-        LocalDateTime endTime = LocalDateTimeUtil.beginOfDay(date);
+        LocalDateTime endTime = LocalDateTimeUtil.endOfDay(date);
         return tradeOrderStatisticsMapper.selectPaySummaryByPayStatusAndPayTimeBetween(
-                PayOrderStatusEnum.SUCCESS.getStatus(), beginTime, endTime);
+                Boolean.TRUE, beginTime, endTime);
     }
 
     @Override

File: yudao-module-member/yudao-module-member-biz/src/main/java/cn/iocoder/yudao/module/member/controller/admin/user/vo/MemberUserBaseVO.java
Patch:
@@ -38,7 +38,7 @@ public class MemberUserBaseVO {
     private String name;
 
     @Schema(description = "用户性别", example = "1")
-    private Byte sex;
+    private Integer sex;
 
     @Schema(description = "所在地编号", example = "4371")
     private Long areaId;

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/enums/common/SexEnum.java
Patch:
@@ -17,7 +17,7 @@ public enum SexEnum {
     /** 女 */
     FEMALE(2),
     /* 未知 */
-    UNKNOWN(3);
+    UNKNOWN(0);
 
     /**
      * 性别

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/user/UserController.java
Patch:
@@ -119,6 +119,9 @@ public CommonResult<List<UserSimpleRespVO>> getSimpleUserList() {
     @PreAuthorize("@ss.hasPermission('system:user:query')")
     public CommonResult<UserRespVO> getUser(@RequestParam("id") Long id) {
         AdminUserDO user = userService.getUser(id);
+        if (user == null) {
+            return success(null);
+        }
         // 拼接数据
         DeptDO dept = deptService.getDept(user.getDeptId());
         return success(UserConvert.INSTANCE.convert(user, dept));

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/permission/RoleServiceImpl.java
Patch:
@@ -18,6 +18,7 @@
 import cn.iocoder.yudao.module.system.enums.permission.RoleTypeEnum;
 import com.google.common.annotations.VisibleForTesting;
 import com.mzt.logapi.context.LogRecordContext;
+import com.mzt.logapi.service.impl.DiffParseFunction;
 import com.mzt.logapi.starter.annotation.LogRecord;
 import lombok.extern.slf4j.Slf4j;
 import org.springframework.cache.annotation.CacheEvict;
@@ -116,6 +117,7 @@ public void deleteRole(Long id) {
         permissionService.processRoleDeleted(id);
 
         // 3. 记录操作日志上下文
+        LogRecordContext.putVariable(DiffParseFunction.OLD_OBJECT, BeanUtils.toBean(role, RoleSaveReqVO.class));
         LogRecordContext.putVariable("role", role);
     }
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/sms/SmsCodeServiceImpl.java
Patch:
@@ -67,7 +67,8 @@ private String createSmsCode(String mobile, Integer scene, String ip) {
         }
 
         // 创建验证码记录
-        String code = String.valueOf(randomInt(smsCodeProperties.getBeginCode(), smsCodeProperties.getEndCode() + 1));
+        String code = String.format("%0" + smsCodeProperties.getEndCode().toString().length() + "d",
+                randomInt(smsCodeProperties.getBeginCode(), smsCodeProperties.getEndCode() + 1));
         SmsCodeDO newSmsCode = SmsCodeDO.builder().mobile(mobile).code(code).scene(scene)
                 .todayIndex(lastSmsCode != null && isToday(lastSmsCode.getCreateTime()) ? lastSmsCode.getTodayIndex() + 1 : 1)
                 .createIp(ip).used(false).build();

File: yudao-module-erp/yudao-module-erp-api/src/main/java/cn/iocoder/yudao/module/erp/enums/common/ErpBizTypeEnum.java
Patch:
@@ -20,7 +20,7 @@ public enum ErpBizTypeEnum implements IntArrayValuable {
     PURCHASE_RETURN(12, "采购退货"),
 
     SALE_ORDER(20, "销售订单"),
-    SALE_OUT(21, "销售订单"),
+    SALE_OUT(21, "销售出库"),
     SALE_RETURN(22, "销售退货"),
     ;
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/sms/SmsCallbackController.java
Patch:
@@ -26,7 +26,7 @@ public class SmsCallbackController {
 
     @PostMapping("/aliyun")
     @PermitAll
-    @Operation(summary = "阿里云短信的回调", description = "参见 https://help.aliyun.com/document_detail/120998.html 文档")
+    @Operation(summary = "阿里云短信的回调", description = "参见 https://help.aliyun.com/zh/sms/developer-reference/configure-delivery-receipts-1 文档")
     public CommonResult<Boolean> receiveAliyunSmsStatus(HttpServletRequest request) throws Throwable {
         String text = ServletUtils.getBody(request);
         smsSendService.receiveSmsStatus(SmsChannelEnum.ALIYUN.getCode(), text);
@@ -35,7 +35,7 @@ public CommonResult<Boolean> receiveAliyunSmsStatus(HttpServletRequest request)
 
     @PostMapping("/tencent")
     @PermitAll
-    @Operation(summary = "腾讯云短信的回调", description = "参见 https://cloud.tencent.com/document/product/382/52077 文档")
+    @Operation(summary = "腾讯云短信的回调", description = "参见 https://cloud.tencent.com/document/product/382/59178 文档")
     public CommonResult<Boolean> receiveTencentSmsStatus(HttpServletRequest request) throws Throwable {
         String text = ServletUtils.getBody(request);
         smsSendService.receiveSmsStatus(SmsChannelEnum.TENCENT.getCode(), text);

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/dal/mysql/permission/RoleMapper.java
Patch:
@@ -21,7 +21,7 @@ default PageResult<RoleDO> selectPage(RolePageReqVO reqVO) {
                 .likeIfPresent(RoleDO::getCode, reqVO.getCode())
                 .eqIfPresent(RoleDO::getStatus, reqVO.getStatus())
                 .betweenIfPresent(BaseDO::getCreateTime, reqVO.getCreateTime())
-                .orderByDesc(RoleDO::getId));
+                .orderByAsc(RoleDO::getSort));
     }
 
     default RoleDO selectByName(String name) {

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/codegen/vo/column/CodegenColumnRespVO.java
Patch:
@@ -30,9 +30,6 @@ public class CodegenColumnRespVO {
     @Schema(description = "是否主键", requiredMode = Schema.RequiredMode.REQUIRED, example = "false")
     private Boolean primaryKey;
 
-    @Schema(description = "是否自增", requiredMode = Schema.RequiredMode.REQUIRED, example = "true")
-    private Boolean autoIncrement;
-
     @Schema(description = "排序", requiredMode = Schema.RequiredMode.REQUIRED, example = "10")
     private Integer ordinalPosition;
 

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/convert/codegen/CodegenConvert.java
Patch:
@@ -41,7 +41,6 @@ public interface CodegenConvert {
             @Mapping(source = "comment", target = "columnComment"),
             @Mapping(source = "metaInfo.nullable", target = "nullable"),
             @Mapping(source = "keyFlag", target = "primaryKey"),
-            @Mapping(source = "keyIdentityFlag", target = "autoIncrement"),
             @Mapping(source = "columnType.type", target = "javaType"),
             @Mapping(source = "propertyName", target = "javaField"),
     })

File: yudao-module-infra/yudao-module-infra-biz/src/test/java/cn/iocoder/yudao/module/infra/service/codegen/inner/CodegenBuilderTest.java
Patch:
@@ -72,7 +72,6 @@ public void testBuildColumns() {
         assertEquals("编号", column.getColumnComment());
         assertFalse(column.getNullable());
         assertTrue(column.getPrimaryKey());
-        assertTrue(column.getAutoIncrement());
         assertEquals(1, column.getOrdinalPosition());
         assertEquals("Long", column.getJavaType());
         assertEquals("id", column.getJavaField());

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/dal/mysql/oauth2/OAuth2AccessTokenMapper.java
Patch:
@@ -3,6 +3,7 @@
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.mybatis.core.mapper.BaseMapperX;
 import cn.iocoder.yudao.framework.mybatis.core.query.LambdaQueryWrapperX;
+import cn.iocoder.yudao.framework.tenant.core.aop.TenantIgnore;
 import cn.iocoder.yudao.module.system.controller.admin.oauth2.vo.token.OAuth2AccessTokenPageReqVO;
 import cn.iocoder.yudao.module.system.dal.dataobject.oauth2.OAuth2AccessTokenDO;
 import org.apache.ibatis.annotations.Mapper;
@@ -13,6 +14,7 @@
 @Mapper
 public interface OAuth2AccessTokenMapper extends BaseMapperX<OAuth2AccessTokenDO> {
 
+    @TenantIgnore // 获取 token 的时候，需要忽略租户编号。原因是：一些场景下，可能不会传递 tenant-id 请求头，例如说文件上传、积木报表等等
     default OAuth2AccessTokenDO selectByAccessToken(String accessToken) {
         return selectOne(OAuth2AccessTokenDO::getAccessToken, accessToken);
     }

File: yudao-framework/yudao-common/src/main/java/cn/iocoder/yudao/framework/common/util/collection/MapUtils.java
Patch:
@@ -2,6 +2,7 @@
 
 import cn.hutool.core.collection.CollUtil;
 import cn.hutool.core.collection.CollectionUtil;
+import cn.hutool.core.util.ObjUtil;
 import cn.iocoder.yudao.framework.common.core.KeyValue;
 import com.google.common.collect.Maps;
 import com.google.common.collect.Multimap;
@@ -40,14 +41,15 @@ public static <K, V> List<V> getList(Multimap<K, V> multimap, Collection<K> keys
 
     /**
      * 从哈希表查找到 key 对应的 value，然后进一步处理
+     * key 为 null 时, 不处理
      * 注意，如果查找到的 value 为 null 时，不进行处理
      *
      * @param map 哈希表
      * @param key key
      * @param consumer 进一步处理的逻辑
      */
     public static <K, V> void findAndThen(Map<K, V> map, K key, Consumer<V> consumer) {
-        if (CollUtil.isEmpty(map)) {
+        if (ObjUtil.isNull(key) || CollUtil.isEmpty(map)) {
             return;
         }
         V value = map.get(key);

File: yudao-framework/yudao-spring-boot-starter-security/src/main/java/cn/iocoder/yudao/framework/operatelog/config/YudaoOperateLogConfiguration.java
Patch:
@@ -16,7 +16,7 @@
 @EnableLogRecord(tenant = "") // 貌似用不上 tenant 这玩意给个空好啦
 @AutoConfiguration
 @Slf4j
-public class YudaoOperateLogV2Configuration {
+public class YudaoOperateLogConfiguration {
 
     @Bean
     @Primary

File: yudao-framework/yudao-spring-boot-starter-security/src/main/java/cn/iocoder/yudao/framework/operatelog/config/YudaoOperateLogRpcAutoConfiguration.java
Patch:
@@ -11,5 +11,5 @@
  */
 @AutoConfiguration
 @EnableFeignClients(clients = {OperateLogApi.class}) // 主要是引入相关的 API 服务
-public class YudaoOperateLogV2RpcAutoConfiguration {
+public class YudaoOperateLogRpcAutoConfiguration {
 }

File: yudao-module-crm/yudao-module-crm-api/src/main/java/cn/iocoder/yudao/module/crm/enums/LogRecordConstants.java
Patch:
@@ -142,11 +142,11 @@ public interface LogRecordConstants {
 
     String CRM_RECEIVABLE_TYPE = "CRM 回款";
     String CRM_RECEIVABLE_CREATE_SUB_TYPE = "创建回款";
-    String CRM_RECEIVABLE_CREATE_SUCCESS = "创建了合同【{getContractById{#receivable.contractId}}】的第【{{#receivable.period}}】期回款";
+    String CRM_RECEIVABLE_CREATE_SUCCESS = "创建了合同【{getContractById{#receivable.contractId}}】的{{#period != null ? '【第'+ #period +'期】' : '编号为【'+ #receivable.no +'】的'}}回款";
     String CRM_RECEIVABLE_UPDATE_SUB_TYPE = "更新回款";
-    String CRM_RECEIVABLE_UPDATE_SUCCESS = "更新了合同【{getContractById{#receivable.contractId}}】的第【{{#receivable.period}}】期回款: {_DIFF{#updateReqVO}}";
+    String CRM_RECEIVABLE_UPDATE_SUCCESS = "更新了合同【{getContractById{#receivable.contractId}}】的{{#period != null ? '【第'+ #period +'期】' : '编号为【'+ #receivable.no +'】的'}}回款: {_DIFF{#updateReqVO}}";
     String CRM_RECEIVABLE_DELETE_SUB_TYPE = "删除回款";
-    String CRM_RECEIVABLE_DELETE_SUCCESS = "删除了合同【{getContractById{#receivable.contractId}}】的第【{{#receivable.period}}】期回款";
+    String CRM_RECEIVABLE_DELETE_SUCCESS = "删除了合同【{getContractById{#receivable.contractId}}】的{{#period != null ? '【第'+ #period +'期】' : '编号为【'+ #receivable.no +'】的'}}回款";
     String CRM_RECEIVABLE_SUBMIT_SUB_TYPE = "提交回款审批";
     String CRM_RECEIVABLE_SUBMIT_SUCCESS = "提交编号为【{{#receivableNo}}】的回款审批成功";
 

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/business/vo/business/CrmBusinessSaveReqVO.java
Patch:
@@ -66,13 +66,13 @@ public class CrmBusinessSaveReqVO {
     private Long contactId; // 使用场景，在【联系人详情】添加商机时，如果需要关联两者，需要传递 contactId 字段
 
     @Schema(description = "产品列表")
-    private List<Product> products;
+    private List<BusinessProduct> businessProducts;
 
     @Schema(description = "产品列表")
     @Data
     @NoArgsConstructor
     @AllArgsConstructor
-    public static class Product {
+    public static class BusinessProduct {
 
         @Schema(description = "产品编号", requiredMode = Schema.RequiredMode.REQUIRED, example = "20529")
         @NotNull(message = "产品编号不能为空")

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/statistics/vo/rank/CrmStatisticsRankReqVO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.yudao.module.crm.controller.admin.statistics.vo;
+package cn.iocoder.yudao.module.crm.controller.admin.statistics.vo.rank;
 
 import io.swagger.v3.oas.annotations.media.Schema;
 import javax.validation.constraints.NotEmpty;
@@ -21,7 +21,7 @@ public class CrmStatisticsRankReqVO {
 
     /**
      * userIds 目前不用前端传递，目前是方便后端通过 deptId 读取编号后，设置回来
-     *
+     * <p>
      * 后续，可能会支持选择部分用户进行查询
      */
     @Schema(description = "负责人用户 id 集合", requiredMode = Schema.RequiredMode.NOT_REQUIRED, example = "2")

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/framework/operatelog/package-info.java
Patch:
@@ -1 +1,4 @@
+/**
+ * crm 模块的 operatelog 拓展封装
+ */
 package cn.iocoder.yudao.module.crm.framework.operatelog;
\ No newline at end of file

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/framework/permission/package-info.java
Patch:
@@ -1 +1,4 @@
+/**
+ * crm 模块的 permission 拓展封装
+ */
 package cn.iocoder.yudao.module.crm.framework.permission;
\ No newline at end of file

File: yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/controller/app/spu/AppProductSpuController.java
Patch:
@@ -101,7 +101,7 @@ public CommonResult<AppProductSpuDetailRespVO> getSpuDetail(@RequestParam("id")
             throw exception(SPU_NOT_EXISTS);
         }
         if (!ProductSpuStatusEnum.isEnable(spu.getStatus())) {
-            throw exception(SPU_NOT_ENABLE);
+            throw exception(SPU_NOT_ENABLE, spu.getName());
         }
         // 获得商品 SKU
         List<ProductSkuDO> skus = productSkuService.getSkuListBySpuId(spu.getId());

File: yudao-module-mall/yudao-module-trade-biz/src/main/java/cn/iocoder/yudao/module/trade/controller/admin/delivery/vo/pickup/DeliveryPickUpStorePageReqVO.java
Patch:
@@ -4,14 +4,11 @@
 import cn.iocoder.yudao.framework.common.validation.InEnum;
 import lombok.*;
 
-import java.time.LocalTime;
-import java.util.*;
 import io.swagger.v3.oas.annotations.media.Schema;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import org.springframework.format.annotation.DateTimeFormat;
 import java.time.LocalDateTime;
 
-import static cn.iocoder.yudao.framework.common.util.date.DateUtils.FORMAT_HOUR_MINUTE_SECOND;
 import static cn.iocoder.yudao.framework.common.util.date.DateUtils.FORMAT_YEAR_MONTH_DAY_HOUR_MINUTE_SECOND;
 
 @Schema(description = "管理后台 - 自提门店分页 Request VO")

File: yudao-module-mall/yudao-module-trade-biz/src/main/java/cn/iocoder/yudao/module/trade/controller/app/cart/vo/AppCartAddReqVO.java
Patch:
@@ -1,10 +1,10 @@
 package cn.iocoder.yudao.module.trade.controller.app.cart.vo;
 
 import io.swagger.v3.oas.annotations.media.Schema;
+import jakarta.validation.constraints.Min;
+import jakarta.validation.constraints.NotNull;
 import lombok.Data;
 
-import javax.validation.constraints.NotNull;
-
 @Schema(description = "用户 App - 购物车添加购物项 Request VO")
 @Data
 public class AppCartAddReqVO {
@@ -15,6 +15,7 @@ public class AppCartAddReqVO {
 
     @Schema(description = "新增商品数量", requiredMode = Schema.RequiredMode.REQUIRED, example = "1")
     @NotNull(message = "数量不能为空")
+    @Min(value = 1, message = "商品数量必须大于等于 1")
     private Integer count;
 
 }

File: yudao-module-mall/yudao-module-trade-biz/src/main/java/cn/iocoder/yudao/module/trade/controller/app/order/vo/AppTradeOrderDetailRespVO.java
Patch:
@@ -1,12 +1,10 @@
 package cn.iocoder.yudao.module.trade.controller.app.order.vo;
 
 import cn.iocoder.yudao.module.trade.controller.app.order.vo.item.AppTradeOrderItemRespVO;
-import cn.iocoder.yudao.module.trade.enums.order.TradeOrderRefundStatusEnum;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 
 import java.time.LocalDateTime;
-import java.util.Date;
 import java.util.List;
 
 @Schema(description = "用户 App - 订单交易的明细 Response VO")
@@ -142,6 +140,9 @@ public class AppTradeOrderDetailRespVO {
     @Schema(description = "VIP 减免金额", requiredMode = Schema.RequiredMode.REQUIRED, example = "888")
     private Integer vipPrice;
 
+    @Schema(description = "拼团记录编号", example = "100")
+    private Long combinationRecordId;
+
     /**
      * 订单项数组
      */

File: yudao-module-mall/yudao-module-trade-biz/src/main/java/cn/iocoder/yudao/module/trade/dal/mysql/brokerage/BrokerageRecordMapper.java
Patch:
@@ -88,6 +88,7 @@ Integer selectSummaryPriceByUserIdAndBizTypeAndCreateTimeBetween(@Param("userId"
                                                                      @Param("beginTime") LocalDateTime beginTime,
                                                                      @Param("endTime") LocalDateTime endTime);
 
+    // TODO @芋艿：收敛掉 @Select 注解操作，统一成 MyBatis-Plus 的方式，或者 xml
     @Select("SELECT user_id AS id, SUM(price) AS brokeragePrice FROM trade_brokerage_record " +
             "WHERE biz_type = #{bizType} AND status = #{status} AND deleted = FALSE " +
             "AND unfreeze_time BETWEEN #{beginTime} AND #{endTime} " +

File: yudao-module-mall/yudao-module-trade-biz/src/main/java/cn/iocoder/yudao/module/trade/service/order/handler/TradeBrokerageOrderHandler.java
Patch:
@@ -83,7 +83,7 @@ public void afterCancelOrderItem(TradeOrderDO order, TradeOrderItemDO orderItem)
         if (order.getBrokerageUserId() == null) {
             return;
         }
-        cancelBrokerage(order.getBrokerageUserId(), orderItem.getOrderId());
+        cancelBrokerage(order.getBrokerageUserId(), orderItem.getId());
     }
 
     /**

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/dal/mysql/permission/RoleMapper.java
Patch:
@@ -21,7 +21,7 @@ default PageResult<RoleDO> selectPage(RolePageReqVO reqVO) {
                 .likeIfPresent(RoleDO::getCode, reqVO.getCode())
                 .eqIfPresent(RoleDO::getStatus, reqVO.getStatus())
                 .betweenIfPresent(BaseDO::getCreateTime, reqVO.getCreateTime())
-                .orderByDesc(RoleDO::getId));
+                .orderByAsc(RoleDO::getSort));
     }
 
     default RoleDO selectByName(String name) {

File: yudao-framework/yudao-spring-boot-starter-biz-operatelog/src/main/java/cn/iocoder/yudao/framework/operatelog/core/package-info.java
Patch:
@@ -1 +0,0 @@
-package cn.iocoder.yudao.framework.operatelog.core;

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/business/CrmBusinessController.java
Patch:
@@ -1,13 +1,13 @@
 package cn.iocoder.yudao.module.crm.controller.admin.business;
 
 import cn.hutool.core.collection.CollUtil;
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.collection.MapUtils;
 import cn.iocoder.yudao.framework.common.util.number.NumberUtils;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.crm.controller.admin.business.vo.business.*;
 import cn.iocoder.yudao.module.crm.dal.dataobject.business.CrmBusinessDO;
 import cn.iocoder.yudao.module.crm.dal.dataobject.business.CrmBusinessProductDO;
@@ -39,11 +39,11 @@
 import java.util.Map;
 import java.util.stream.Stream;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.exception.util.ServiceExceptionUtil.exception;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.pojo.PageParam.PAGE_SIZE_NONE;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.*;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.security.core.util.SecurityFrameworkUtils.getLoginUserId;
 import static cn.iocoder.yudao.module.crm.enums.ErrorCodeConstants.CUSTOMER_NOT_EXISTS;
 
@@ -167,7 +167,7 @@ public CommonResult<PageResult<CrmBusinessRespVO>> getBusinessContactPage(@Valid
     @GetMapping("/export-excel")
     @Operation(summary = "导出商机 Excel")
     @PreAuthorize("@ss.hasPermission('crm:business:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportBusinessExcel(@Valid CrmBusinessPageReqVO exportReqVO,
                                     HttpServletResponse response) throws IOException {
         exportReqVO.setPageSize(PAGE_SIZE_NONE);

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/clue/CrmClueController.java
Patch:
@@ -1,14 +1,14 @@
 package cn.iocoder.yudao.module.crm.controller.admin.clue;
 
 import cn.hutool.core.collection.CollUtil;
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.collection.MapUtils;
 import cn.iocoder.yudao.framework.common.util.number.NumberUtils;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
 import cn.iocoder.yudao.framework.ip.core.utils.AreaUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.crm.controller.admin.clue.vo.CrmCluePageReqVO;
 import cn.iocoder.yudao.module.crm.controller.admin.clue.vo.CrmClueRespVO;
 import cn.iocoder.yudao.module.crm.controller.admin.clue.vo.CrmClueSaveReqVO;
@@ -37,11 +37,11 @@
 import java.util.Map;
 import java.util.stream.Stream;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.pojo.PageParam.PAGE_SIZE_NONE;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertListByFlatMap;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertSet;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.security.core.util.SecurityFrameworkUtils.getLoginUserId;
 import static java.util.Collections.singletonList;
 
@@ -112,7 +112,7 @@ public CommonResult<PageResult<CrmClueRespVO>> getCluePage(@Valid CrmCluePageReq
     @GetMapping("/export-excel")
     @Operation(summary = "导出线索 Excel")
     @PreAuthorize("@ss.hasPermission('crm:clue:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportClueExcel(@Valid CrmCluePageReqVO pageReqVO, HttpServletResponse response) throws IOException {
         pageReqVO.setPageSize(PAGE_SIZE_NONE);
         List<CrmClueDO> list = clueService.getCluePage(pageReqVO, getLoginUserId()).getList();

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/contract/CrmContractController.java
Patch:
@@ -2,14 +2,14 @@
 
 import cn.hutool.core.collection.CollUtil;
 import cn.hutool.core.lang.Assert;
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.collection.MapUtils;
 import cn.iocoder.yudao.framework.common.util.number.NumberUtils;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.crm.controller.admin.contract.vo.contract.CrmContractPageReqVO;
 import cn.iocoder.yudao.module.crm.controller.admin.contract.vo.contract.CrmContractRespVO;
 import cn.iocoder.yudao.module.crm.controller.admin.contract.vo.contract.CrmContractSaveReqVO;
@@ -47,10 +47,10 @@
 import java.util.Map;
 import java.util.stream.Stream;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.*;
 import static cn.iocoder.yudao.framework.common.util.collection.MapUtils.findAndThen;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.security.core.util.SecurityFrameworkUtils.getLoginUserId;
 import static java.util.Collections.singletonList;
 
@@ -154,7 +154,7 @@ public CommonResult<PageResult<CrmContractRespVO>> getContractPageByBusiness(@Va
     @GetMapping("/export-excel")
     @Operation(summary = "导出合同 Excel")
     @PreAuthorize("@ss.hasPermission('crm:contract:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportContractExcel(@Valid CrmContractPageReqVO exportReqVO,
                                     HttpServletResponse response) throws IOException {
         PageResult<CrmContractDO> pageResult = contractService.getContractPage(exportReqVO, getLoginUserId());

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/customer/CrmCustomerController.java
Patch:
@@ -2,6 +2,7 @@
 
 import cn.hutool.core.collection.CollUtil;
 import cn.hutool.core.map.MapUtil;
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.core.KeyValue;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
@@ -14,7 +15,6 @@
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
 import cn.iocoder.yudao.framework.ip.core.Area;
 import cn.iocoder.yudao.framework.ip.core.utils.AreaUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.crm.controller.admin.customer.vo.customer.*;
 import cn.iocoder.yudao.module.crm.dal.dataobject.customer.CrmCustomerDO;
 import cn.iocoder.yudao.module.crm.dal.dataobject.customer.CrmCustomerPoolConfigDO;
@@ -44,10 +44,10 @@
 import java.util.Map;
 import java.util.stream.Stream;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.pojo.PageParam.PAGE_SIZE_NONE;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.*;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.security.core.util.SecurityFrameworkUtils.getLoginUserId;
 import static cn.iocoder.yudao.module.crm.enums.DictTypeConstants.*;
 import static java.util.Collections.singletonList;
@@ -242,7 +242,7 @@ public CommonResult<List<CrmCustomerRespVO>> getCustomerSimpleList() {
     @GetMapping("/export-excel")
     @Operation(summary = "导出客户 Excel")
     @PreAuthorize("@ss.hasPermission('crm:customer:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportCustomerExcel(@Valid CrmCustomerPageReqVO pageVO,
                                     HttpServletResponse response) throws IOException {
         pageVO.setPageSize(PAGE_SIZE_NONE); // 不分页

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/operatelog/CrmOperateLogController.java
Patch:
@@ -8,7 +8,7 @@
 import cn.iocoder.yudao.module.crm.enums.LogRecordConstants;
 import cn.iocoder.yudao.module.crm.enums.common.CrmBizTypeEnum;
 import cn.iocoder.yudao.module.system.api.logger.OperateLogApi;
-import cn.iocoder.yudao.module.system.api.logger.dto.OperateLogV2PageReqDTO;
+import cn.iocoder.yudao.module.system.api.logger.dto.OperateLogPageReqDTO;
 import io.swagger.v3.oas.annotations.Operation;
 import io.swagger.v3.oas.annotations.tags.Tag;
 import javax.annotation.Resource;
@@ -55,9 +55,9 @@ public class CrmOperateLogController {
     @Operation(summary = "获得操作日志")
     @PreAuthorize("@ss.hasPermission('crm:operate-log:query')")
     public CommonResult<PageResult<CrmOperateLogRespVO>> getCustomerOperateLog(@Valid CrmOperateLogPageReqVO pageReqVO) {
-        OperateLogV2PageReqDTO reqDTO = new OperateLogV2PageReqDTO();
+        OperateLogPageReqDTO reqDTO = new OperateLogPageReqDTO();
         reqDTO.setPageSize(PAGE_SIZE_NONE); // 默认不分页，需要分页需注释
-        reqDTO.setBizType(BIZ_TYPE_MAP.get(pageReqVO.getBizType())).setBizId(pageReqVO.getBizId());
+        reqDTO.setType(BIZ_TYPE_MAP.get(pageReqVO.getBizType())).setBizId(pageReqVO.getBizId());
         return success(BeanUtils.toBean(operateLogApi.getOperateLogPage(reqDTO).getCheckedData(), CrmOperateLogRespVO.class));
     }
 

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/product/CrmProductController.java
Patch:
@@ -1,11 +1,11 @@
 package cn.iocoder.yudao.module.crm.controller.admin.product;
 
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.framework.translate.core.TranslateUtils;
 import cn.iocoder.yudao.module.crm.controller.admin.product.vo.product.CrmProductPageReqVO;
 import cn.iocoder.yudao.module.crm.controller.admin.product.vo.product.CrmProductRespVO;
@@ -27,9 +27,9 @@
 import java.io.IOException;
 import java.util.List;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertList;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - CRM 产品")
 @RestController
@@ -94,7 +94,7 @@ public CommonResult<PageResult<CrmProductRespVO>> getProductPage(@Valid CrmProdu
     @GetMapping("/export-excel")
     @Operation(summary = "导出产品 Excel")
     @PreAuthorize("@ss.hasPermission('crm:product:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportProductExcel(@Valid CrmProductPageReqVO exportReqVO,
                                    HttpServletResponse response) throws IOException {
         exportReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/receivable/CrmReceivableController.java
Patch:
@@ -2,13 +2,13 @@
 
 import cn.hutool.core.collection.CollUtil;
 import cn.hutool.core.lang.Assert;
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.collection.MapUtils;
 import cn.iocoder.yudao.framework.common.util.number.NumberUtils;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.crm.controller.admin.contract.vo.contract.CrmContractRespVO;
 import cn.iocoder.yudao.module.crm.controller.admin.receivable.vo.receivable.CrmReceivablePageReqVO;
 import cn.iocoder.yudao.module.crm.controller.admin.receivable.vo.receivable.CrmReceivableRespVO;
@@ -39,12 +39,12 @@
 import java.util.Map;
 import java.util.stream.Stream;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.pojo.PageParam.PAGE_SIZE_NONE;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertListByFlatMap;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertSet;
 import static cn.iocoder.yudao.framework.common.util.collection.MapUtils.findAndThen;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.security.core.util.SecurityFrameworkUtils.getLoginUserId;
 
 @Tag(name = "管理后台 - CRM 回款")
@@ -124,7 +124,7 @@ public CommonResult<PageResult<CrmReceivableRespVO>> getReceivablePageByCustomer
     @GetMapping("/export-excel")
     @Operation(summary = "导出回款 Excel")
     @PreAuthorize("@ss.hasPermission('crm:receivable:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportReceivableExcel(@Valid CrmReceivablePageReqVO exportReqVO,
                                       HttpServletResponse response) throws IOException {
         exportReqVO.setPageSize(PAGE_SIZE_NONE);

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/receivable/CrmReceivablePlanController.java
Patch:
@@ -2,12 +2,12 @@
 
 import cn.hutool.core.collection.CollUtil;
 import cn.hutool.core.lang.Assert;
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.number.NumberUtils;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.crm.controller.admin.receivable.vo.plan.CrmReceivablePlanPageReqVO;
 import cn.iocoder.yudao.module.crm.controller.admin.receivable.vo.plan.CrmReceivablePlanRespVO;
 import cn.iocoder.yudao.module.crm.controller.admin.receivable.vo.plan.CrmReceivablePlanSaveReqVO;
@@ -39,11 +39,11 @@
 import java.util.Map;
 import java.util.stream.Stream;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.pojo.PageParam.PAGE_SIZE_NONE;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.*;
 import static cn.iocoder.yudao.framework.common.util.collection.MapUtils.findAndThen;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.security.core.util.SecurityFrameworkUtils.getLoginUserId;
 
 @Tag(name = "管理后台 - CRM 回款计划")
@@ -123,7 +123,7 @@ public CommonResult<PageResult<CrmReceivablePlanRespVO>> getReceivablePlanPageBy
     @GetMapping("/export-excel")
     @Operation(summary = "导出回款计划 Excel")
     @PreAuthorize("@ss.hasPermission('crm:receivable-plan:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportReceivablePlanExcel(@Valid CrmReceivablePlanPageReqVO exportReqVO,
                                           HttpServletResponse response) throws IOException {
         exportReqVO.setPageSize(PAGE_SIZE_NONE);

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/finance/ErpAccountController.java
Patch:
@@ -1,12 +1,12 @@
 package cn.iocoder.yudao.module.erp.controller.admin.finance;
 
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.enums.CommonStatusEnum;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.erp.controller.admin.finance.vo.account.ErpAccountPageReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.finance.vo.account.ErpAccountRespVO;
 import cn.iocoder.yudao.module.erp.controller.admin.finance.vo.account.ErpAccountSaveReqVO;
@@ -26,9 +26,9 @@
 import java.io.IOException;
 import java.util.List;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertList;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - ERP 结算账户")
 @RestController
@@ -103,7 +103,7 @@ public CommonResult<PageResult<ErpAccountRespVO>> getAccountPage(@Valid ErpAccou
     @GetMapping("/export-excel")
     @Operation(summary = "导出结算账户 Excel")
     @PreAuthorize("@ss.hasPermission('erp:account:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportAccountExcel(@Valid ErpAccountPageReqVO pageReqVO,
               HttpServletResponse response) throws IOException {
         pageReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/finance/ErpFinancePaymentController.java
Patch:
@@ -1,14 +1,14 @@
 package cn.iocoder.yudao.module.erp.controller.admin.finance;
 
 import cn.hutool.core.collection.CollUtil;
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.collection.MapUtils;
 import cn.iocoder.yudao.framework.common.util.number.NumberUtils;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.erp.controller.admin.finance.vo.payment.ErpFinancePaymentPageReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.finance.vo.payment.ErpFinancePaymentRespVO;
 import cn.iocoder.yudao.module.erp.controller.admin.finance.vo.payment.ErpFinancePaymentSaveReqVO;
@@ -36,9 +36,9 @@
 import java.util.Map;
 import java.util.stream.Stream;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.*;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - ERP 付款单")
 @RestController
@@ -114,7 +114,7 @@ public CommonResult<PageResult<ErpFinancePaymentRespVO>> getFinancePaymentPage(@
     @GetMapping("/export-excel")
     @Operation(summary = "导出付款单 Excel")
     @PreAuthorize("@ss.hasPermission('erp:finance-payment:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportFinancePaymentExcel(@Valid ErpFinancePaymentPageReqVO pageReqVO,
                                          HttpServletResponse response) throws IOException {
         pageReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/finance/ErpFinanceReceiptController.java
Patch:
@@ -1,14 +1,14 @@
 package cn.iocoder.yudao.module.erp.controller.admin.finance;
 
 import cn.hutool.core.collection.CollUtil;
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.collection.MapUtils;
 import cn.iocoder.yudao.framework.common.util.number.NumberUtils;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.erp.controller.admin.finance.vo.receipt.ErpFinanceReceiptPageReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.finance.vo.receipt.ErpFinanceReceiptRespVO;
 import cn.iocoder.yudao.module.erp.controller.admin.finance.vo.receipt.ErpFinanceReceiptSaveReqVO;
@@ -36,9 +36,9 @@
 import java.util.Map;
 import java.util.stream.Stream;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.*;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - ERP 收款单")
 @RestController
@@ -114,7 +114,7 @@ public CommonResult<PageResult<ErpFinanceReceiptRespVO>> getFinanceReceiptPage(@
     @GetMapping("/export-excel")
     @Operation(summary = "导出收款单 Excel")
     @PreAuthorize("@ss.hasPermission('erp:finance-receipt:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportFinanceReceiptExcel(@Valid ErpFinanceReceiptPageReqVO pageReqVO,
                                          HttpServletResponse response) throws IOException {
         pageReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/product/ErpProductCategoryController.java
Patch:
@@ -1,10 +1,10 @@
 package cn.iocoder.yudao.module.erp.controller.admin.product;
 
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.enums.CommonStatusEnum;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.category.ErpProductCategoryListReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.category.ErpProductCategoryRespVO;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.category.ErpProductCategorySaveReqVO;
@@ -23,9 +23,9 @@
 import java.io.IOException;
 import java.util.List;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertList;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - ERP 产品分类")
 @RestController
@@ -89,7 +89,7 @@ public CommonResult<List<ErpProductCategoryRespVO>> getProductCategorySimpleList
     @GetMapping("/export-excel")
     @Operation(summary = "导出产品分类 Excel")
     @PreAuthorize("@ss.hasPermission('erp:product-category:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportProductCategoryExcel(@Valid ErpProductCategoryListReqVO listReqVO,
               HttpServletResponse response) throws IOException {
         List<ErpProductCategoryDO> list = productCategoryService.getProductCategoryList(listReqVO);

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/product/ErpProductController.java
Patch:
@@ -1,12 +1,12 @@
 package cn.iocoder.yudao.module.erp.controller.admin.product;
 
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.enums.CommonStatusEnum;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.product.ErpProductPageReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.product.ErpProductRespVO;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.product.ProductSaveReqVO;
@@ -25,9 +25,9 @@
 import java.io.IOException;
 import java.util.List;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertList;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - ERP 产品")
 @RestController
@@ -92,7 +92,7 @@ public CommonResult<List<ErpProductRespVO>> getProductSimpleList() {
     @GetMapping("/export-excel")
     @Operation(summary = "导出产品 Excel")
     @PreAuthorize("@ss.hasPermission('erp:product:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportProductExcel(@Valid ErpProductPageReqVO pageReqVO,
               HttpServletResponse response) throws IOException {
         pageReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/product/ErpProductUnitController.java
Patch:
@@ -1,12 +1,12 @@
 package cn.iocoder.yudao.module.erp.controller.admin.product;
 
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.enums.CommonStatusEnum;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.unit.ErpProductUnitPageReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.unit.ErpProductUnitRespVO;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.unit.ErpProductUnitSaveReqVO;
@@ -25,9 +25,9 @@
 import java.io.IOException;
 import java.util.List;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertList;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - ERP 产品单位")
 @RestController
@@ -89,7 +89,7 @@ public CommonResult<List<ErpProductUnitRespVO>> getProductUnitSimpleList() {
     @GetMapping("/export-excel")
     @Operation(summary = "导出产品单位 Excel")
     @PreAuthorize("@ss.hasPermission('erp:product-unit:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportProductUnitExcel(@Valid ErpProductUnitPageReqVO pageReqVO,
               HttpServletResponse response) throws IOException {
         pageReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/purchase/ErpPurchaseInController.java
Patch:
@@ -1,13 +1,13 @@
 package cn.iocoder.yudao.module.erp.controller.admin.purchase;
 
 import cn.hutool.core.collection.CollUtil;
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.collection.MapUtils;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.product.ErpProductRespVO;
 import cn.iocoder.yudao.module.erp.controller.admin.purchase.vo.in.ErpPurchaseInPageReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.purchase.vo.in.ErpPurchaseInRespVO;
@@ -37,10 +37,10 @@
 import java.util.List;
 import java.util.Map;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertMultiMap;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertSet;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - ERP 采购入库")
 @RestController
@@ -125,7 +125,7 @@ public CommonResult<PageResult<ErpPurchaseInRespVO>> getPurchaseInPage(@Valid Er
     @GetMapping("/export-excel")
     @Operation(summary = "导出采购入库 Excel")
     @PreAuthorize("@ss.hasPermission('erp:purchase-in:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportPurchaseInExcel(@Valid ErpPurchaseInPageReqVO pageReqVO,
                                     HttpServletResponse response) throws IOException {
         pageReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/purchase/ErpPurchaseOrderController.java
Patch:
@@ -1,13 +1,13 @@
 package cn.iocoder.yudao.module.erp.controller.admin.purchase;
 
 import cn.hutool.core.collection.CollUtil;
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.collection.MapUtils;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.product.ErpProductRespVO;
 import cn.iocoder.yudao.module.erp.controller.admin.purchase.vo.order.ErpPurchaseOrderPageReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.purchase.vo.order.ErpPurchaseOrderRespVO;
@@ -36,10 +36,10 @@
 import java.util.List;
 import java.util.Map;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertMultiMap;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertSet;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - ERP 采购订单")
 @RestController
@@ -124,7 +124,7 @@ public CommonResult<PageResult<ErpPurchaseOrderRespVO>> getPurchaseOrderPage(@Va
     @GetMapping("/export-excel")
     @Operation(summary = "导出采购订单 Excel")
     @PreAuthorize("@ss.hasPermission('erp:purchase-create:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportPurchaseOrderExcel(@Valid ErpPurchaseOrderPageReqVO pageReqVO,
                                     HttpServletResponse response) throws IOException {
         pageReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/purchase/ErpPurchaseReturnController.java
Patch:
@@ -1,13 +1,13 @@
 package cn.iocoder.yudao.module.erp.controller.admin.purchase;
 
 import cn.hutool.core.collection.CollUtil;
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.collection.MapUtils;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.product.ErpProductRespVO;
 import cn.iocoder.yudao.module.erp.controller.admin.purchase.vo.returns.ErpPurchaseReturnPageReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.purchase.vo.returns.ErpPurchaseReturnRespVO;
@@ -37,10 +37,10 @@
 import java.util.List;
 import java.util.Map;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertMultiMap;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertSet;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - ERP 采购退货")
 @RestController
@@ -125,7 +125,7 @@ public CommonResult<PageResult<ErpPurchaseReturnRespVO>> getPurchaseReturnPage(@
     @GetMapping("/export-excel")
     @Operation(summary = "导出采购退货 Excel")
     @PreAuthorize("@ss.hasPermission('erp:purchase-return:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportPurchaseReturnExcel(@Valid ErpPurchaseReturnPageReqVO pageReqVO,
                                     HttpServletResponse response) throws IOException {
         pageReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/purchase/ErpSupplierController.java
Patch:
@@ -1,12 +1,12 @@
 package cn.iocoder.yudao.module.erp.controller.admin.purchase;
 
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.enums.CommonStatusEnum;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.erp.controller.admin.purchase.vo.supplier.ErpSupplierPageReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.purchase.vo.supplier.ErpSupplierRespVO;
 import cn.iocoder.yudao.module.erp.controller.admin.purchase.vo.supplier.ErpSupplierSaveReqVO;
@@ -25,9 +25,9 @@
 import java.io.IOException;
 import java.util.List;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertList;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - ERP 供应商")
 @RestController
@@ -89,7 +89,7 @@ public CommonResult<List<ErpSupplierRespVO>> getSupplierSimpleList() {
     @GetMapping("/export-excel")
     @Operation(summary = "导出供应商 Excel")
     @PreAuthorize("@ss.hasPermission('erp:supplier:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportSupplierExcel(@Valid ErpSupplierPageReqVO pageReqVO,
               HttpServletResponse response) throws IOException {
         pageReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/sale/ErpCustomerController.java
Patch:
@@ -1,12 +1,12 @@
 package cn.iocoder.yudao.module.erp.controller.admin.sale;
 
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.enums.CommonStatusEnum;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.erp.controller.admin.sale.vo.customer.ErpCustomerPageReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.sale.vo.customer.ErpCustomerRespVO;
 import cn.iocoder.yudao.module.erp.controller.admin.sale.vo.customer.ErpCustomerSaveReqVO;
@@ -25,9 +25,9 @@
 import java.io.IOException;
 import java.util.List;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertList;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - ERP 客户")
 @RestController
@@ -89,7 +89,7 @@ public CommonResult<List<ErpCustomerRespVO>> getCustomerSimpleList() {
     @GetMapping("/export-excel")
     @Operation(summary = "导出客户 Excel")
     @PreAuthorize("@ss.hasPermission('erp:customer:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportCustomerExcel(@Valid ErpCustomerPageReqVO pageReqVO,
               HttpServletResponse response) throws IOException {
         pageReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/sale/ErpSaleOutController.java
Patch:
@@ -1,13 +1,13 @@
 package cn.iocoder.yudao.module.erp.controller.admin.sale;
 
 import cn.hutool.core.collection.CollUtil;
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.collection.MapUtils;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.product.ErpProductRespVO;
 import cn.iocoder.yudao.module.erp.controller.admin.sale.vo.out.ErpSaleOutPageReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.sale.vo.out.ErpSaleOutRespVO;
@@ -37,10 +37,10 @@
 import java.util.List;
 import java.util.Map;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertMultiMap;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertSet;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - ERP 销售出库")
 @RestController
@@ -125,7 +125,7 @@ public CommonResult<PageResult<ErpSaleOutRespVO>> getSaleOutPage(@Valid ErpSaleO
     @GetMapping("/export-excel")
     @Operation(summary = "导出销售出库 Excel")
     @PreAuthorize("@ss.hasPermission('erp:sale-out:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportSaleOutExcel(@Valid ErpSaleOutPageReqVO pageReqVO,
                                     HttpServletResponse response) throws IOException {
         pageReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/sale/ErpSaleReturnController.java
Patch:
@@ -1,13 +1,13 @@
 package cn.iocoder.yudao.module.erp.controller.admin.sale;
 
 import cn.hutool.core.collection.CollUtil;
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.collection.MapUtils;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.product.ErpProductRespVO;
 import cn.iocoder.yudao.module.erp.controller.admin.sale.vo.returns.ErpSaleReturnPageReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.sale.vo.returns.ErpSaleReturnRespVO;
@@ -37,10 +37,10 @@
 import java.util.List;
 import java.util.Map;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertMultiMap;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertSet;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - ERP 销售退货")
 @RestController
@@ -125,7 +125,7 @@ public CommonResult<PageResult<ErpSaleReturnRespVO>> getSaleReturnPage(@Valid Er
     @GetMapping("/export-excel")
     @Operation(summary = "导出销售退货 Excel")
     @PreAuthorize("@ss.hasPermission('erp:sale-return:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportSaleReturnExcel(@Valid ErpSaleReturnPageReqVO pageReqVO,
                                     HttpServletResponse response) throws IOException {
         pageReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/stock/ErpStockCheckController.java
Patch:
@@ -1,13 +1,13 @@
 package cn.iocoder.yudao.module.erp.controller.admin.stock;
 
 import cn.hutool.core.collection.CollUtil;
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.collection.MapUtils;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.product.ErpProductRespVO;
 import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.check.ErpStockCheckPageReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.check.ErpStockCheckRespVO;
@@ -32,10 +32,10 @@
 import java.util.List;
 import java.util.Map;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertMultiMap;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertSet;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - ERP 库存调拨单")
 @RestController
@@ -113,7 +113,7 @@ public CommonResult<PageResult<ErpStockCheckRespVO>> getStockCheckPage(@Valid Er
     @GetMapping("/export-excel")
     @Operation(summary = "导出库存调拨单 Excel")
     @PreAuthorize("@ss.hasPermission('erp:stock-check:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportStockCheckExcel(@Valid ErpStockCheckPageReqVO pageReqVO,
               HttpServletResponse response) throws IOException {
         pageReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/stock/ErpStockController.java
Patch:
@@ -1,13 +1,13 @@
 package cn.iocoder.yudao.module.erp.controller.admin.stock;
 
 import cn.hutool.core.collection.CollUtil;
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.collection.MapUtils;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.product.ErpProductRespVO;
 import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.stock.ErpStockPageReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.stock.ErpStockRespVO;
@@ -35,9 +35,9 @@
 import java.util.List;
 import java.util.Map;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertSet;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - ERP 产品库存")
 @RestController
@@ -85,7 +85,7 @@ public CommonResult<PageResult<ErpStockRespVO>> getStockPage(@Valid ErpStockPage
     @GetMapping("/export-excel")
     @Operation(summary = "导出产品库存 Excel")
     @PreAuthorize("@ss.hasPermission('erp:stock:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportStockExcel(@Valid ErpStockPageReqVO pageReqVO,
               HttpServletResponse response) throws IOException {
         pageReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/stock/ErpStockInController.java
Patch:
@@ -1,13 +1,13 @@
 package cn.iocoder.yudao.module.erp.controller.admin.stock;
 
 import cn.hutool.core.collection.CollUtil;
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.collection.MapUtils;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.product.ErpProductRespVO;
 import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.in.ErpStockInPageReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.in.ErpStockInRespVO;
@@ -37,10 +37,10 @@
 import java.util.List;
 import java.util.Map;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertMultiMap;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertSet;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - ERP 其它入库单")
 @RestController
@@ -125,7 +125,7 @@ public CommonResult<PageResult<ErpStockInRespVO>> getStockInPage(@Valid ErpStock
     @GetMapping("/export-excel")
     @Operation(summary = "导出其它入库单 Excel")
     @PreAuthorize("@ss.hasPermission('erp:stock-in:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportStockInExcel(@Valid ErpStockInPageReqVO pageReqVO,
               HttpServletResponse response) throws IOException {
         pageReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/stock/ErpStockMoveController.java
Patch:
@@ -1,13 +1,13 @@
 package cn.iocoder.yudao.module.erp.controller.admin.stock;
 
 import cn.hutool.core.collection.CollUtil;
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.collection.MapUtils;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.product.ErpProductRespVO;
 import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.move.ErpStockMovePageReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.move.ErpStockMoveRespVO;
@@ -35,10 +35,10 @@
 import java.util.List;
 import java.util.Map;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertMultiMap;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertSet;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - ERP 库存调拨单")
 @RestController
@@ -121,7 +121,7 @@ public CommonResult<PageResult<ErpStockMoveRespVO>> getStockMovePage(@Valid ErpS
     @GetMapping("/export-excel")
     @Operation(summary = "导出库存调拨单 Excel")
     @PreAuthorize("@ss.hasPermission('erp:stock-move:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportStockMoveExcel(@Valid ErpStockMovePageReqVO pageReqVO,
               HttpServletResponse response) throws IOException {
         pageReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/stock/ErpStockOutController.java
Patch:
@@ -1,13 +1,13 @@
 package cn.iocoder.yudao.module.erp.controller.admin.stock;
 
 import cn.hutool.core.collection.CollUtil;
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.collection.MapUtils;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.product.ErpProductRespVO;
 import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.out.ErpStockOutPageReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.out.ErpStockOutRespVO;
@@ -37,10 +37,10 @@
 import java.util.List;
 import java.util.Map;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertMultiMap;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertSet;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - ERP 其它出库单")
 @RestController
@@ -125,7 +125,7 @@ public CommonResult<PageResult<ErpStockOutRespVO>> getStockOutPage(@Valid ErpSto
     @GetMapping("/export-excel")
     @Operation(summary = "导出其它出库单 Excel")
     @PreAuthorize("@ss.hasPermission('erp:stock-out:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportStockOutExcel(@Valid ErpStockOutPageReqVO pageReqVO,
               HttpServletResponse response) throws IOException {
         pageReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/stock/ErpStockRecordController.java
Patch:
@@ -1,13 +1,13 @@
 package cn.iocoder.yudao.module.erp.controller.admin.stock;
 
 import cn.hutool.core.collection.CollUtil;
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.collection.MapUtils;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.product.ErpProductRespVO;
 import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.record.ErpStockRecordPageReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.record.ErpStockRecordRespVO;
@@ -35,9 +35,9 @@
 import java.util.List;
 import java.util.Map;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertSet;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - ERP 产品库存明细")
 @RestController
@@ -75,7 +75,7 @@ public CommonResult<PageResult<ErpStockRecordRespVO>> getStockRecordPage(@Valid
     @GetMapping("/export-excel")
     @Operation(summary = "导出产品库存明细 Excel")
     @PreAuthorize("@ss.hasPermission('erp:stock-record:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportStockRecordExcel(@Valid ErpStockRecordPageReqVO pageReqVO,
               HttpServletResponse response) throws IOException {
         pageReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/demo/demo02/Demo02CategoryController.java
Patch:
@@ -1,9 +1,9 @@
 package cn.iocoder.yudao.module.infra.controller.admin.demo.demo02;
 
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.infra.controller.admin.demo.demo02.vo.Demo02CategoryListReqVO;
 import cn.iocoder.yudao.module.infra.controller.admin.demo.demo02.vo.Demo02CategoryRespVO;
 import cn.iocoder.yudao.module.infra.controller.admin.demo.demo02.vo.Demo02CategorySaveReqVO;
@@ -22,8 +22,8 @@
 import java.io.IOException;
 import java.util.List;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - 示例分类")
 @RestController
@@ -78,7 +78,7 @@ public CommonResult<List<Demo02CategoryRespVO>> getDemo02CategoryList(@Valid Dem
     @GetMapping("/export-excel")
     @Operation(summary = "导出示例分类 Excel")
     @PreAuthorize("@ss.hasPermission('infra:demo02-category:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportDemo02CategoryExcel(@Valid Demo02CategoryListReqVO listReqVO,
               HttpServletResponse response) throws IOException {
         List<Demo02CategoryDO> list = demo02CategoryService.getDemo02CategoryList(listReqVO);

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/file/FileController.java
Patch:
@@ -7,7 +7,6 @@
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.common.util.servlet.ServletUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.infra.controller.admin.file.vo.file.*;
 import cn.iocoder.yudao.module.infra.dal.dataobject.file.FileDO;
 import cn.iocoder.yudao.module.infra.service.file.FileService;
@@ -40,7 +39,6 @@ public class FileController {
 
     @PostMapping("/upload")
     @Operation(summary = "上传文件", description = "模式一：后端上传文件")
-    @OperateLog(logArgs = false) // 上传文件，没有记录操作日志的必要
     public CommonResult<String> uploadFile(FileUploadReqVO uploadReqVO) throws Exception {
         MultipartFile file = uploadReqVO.getFile();
         String path = uploadReqVO.getPath();

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/service/codegen/inner/CodegenEngine.java
Patch:
@@ -8,6 +8,8 @@
 import cn.hutool.extra.template.TemplateEngine;
 import cn.hutool.extra.template.engine.velocity.VelocityEngine;
 import cn.hutool.system.SystemUtil;
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
+import cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum;
 import cn.iocoder.yudao.framework.common.exception.util.ServiceExceptionUtil;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
@@ -24,8 +26,6 @@
 import cn.iocoder.yudao.framework.mybatis.core.dataobject.BaseDO;
 import cn.iocoder.yudao.framework.mybatis.core.mapper.BaseMapperX;
 import cn.iocoder.yudao.framework.mybatis.core.query.LambdaQueryWrapperX;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
-import cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum;
 import cn.iocoder.yudao.module.infra.dal.dataobject.codegen.CodegenColumnDO;
 import cn.iocoder.yudao.module.infra.dal.dataobject.codegen.CodegenTableDO;
 import cn.iocoder.yudao.module.infra.enums.codegen.CodegenFrontTypeEnum;
@@ -211,7 +211,7 @@ void initGlobalBindingMap() {
         globalBindingMap.put("LocalDateTimeUtilsClassName", LocalDateTimeUtils.class.getName());
         globalBindingMap.put("ObjectUtilsClassName", ObjectUtils.class.getName());
         globalBindingMap.put("DictConvertClassName", DictConvert.class.getName());
-        globalBindingMap.put("OperateLogClassName", OperateLog.class.getName());
+        globalBindingMap.put("ApiAccessLogClassName", ApiAccessLog.class.getName());
         globalBindingMap.put("OperateTypeEnumClassName", OperateTypeEnum.class.getName());
         globalBindingMap.put("BeanUtils", BeanUtils.class.getName());
     }

File: yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/controller/admin/spu/ProductSpuController.java
Patch:
@@ -1,10 +1,10 @@
 package cn.iocoder.yudao.module.product.controller.admin.spu;
 
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.product.controller.admin.spu.vo.*;
 import cn.iocoder.yudao.module.product.convert.spu.ProductSpuConvert;
 import cn.iocoder.yudao.module.product.dal.dataobject.sku.ProductSkuDO;
@@ -28,9 +28,9 @@
 import java.util.List;
 import java.util.Map;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.pojo.PageParam.PAGE_SIZE_NONE;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - 商品 SPU")
 @RestController
@@ -127,7 +127,7 @@ public CommonResult<Map<Integer, Long>> getSpuCount() {
     @GetMapping("/export")
     @Operation(summary = "导出商品")
     @PreAuthorize("@ss.hasPermission('product:spu:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportSpuList(@Validated ProductSpuPageReqVO reqVO,
                                HttpServletResponse response) throws IOException {
         reqVO.setPageSize(PAGE_SIZE_NONE);

File: yudao-module-mall/yudao-module-trade-biz/src/main/java/cn/iocoder/yudao/module/trade/controller/admin/aftersale/AfterSaleController.java
Patch:
@@ -3,7 +3,6 @@
 import cn.hutool.core.collection.CollUtil;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.member.api.user.MemberUserApi;
 import cn.iocoder.yudao.module.member.api.user.dto.MemberUserRespDTO;
 import cn.iocoder.yudao.module.pay.api.notify.dto.PayRefundNotifyReqDTO;
@@ -135,7 +134,6 @@ public CommonResult<Boolean> refundAfterSale(@RequestParam("id") Long id) {
     @PostMapping("/update-refunded")
     @Operation(summary = "更新售后订单为已退款") // 由 pay-module 支付服务，进行回调，可见 PayNotifyJob
     @PermitAll // 无需登录，安全由 PayDemoOrderService 内部校验实现
-    @OperateLog(enable = false) // 禁用操作日志，因为没有操作人
     public CommonResult<Boolean> updateAfterRefund(@RequestBody PayRefundNotifyReqDTO notifyReqDTO) {
         // 目前业务逻辑，不需要做任何事情
         // 当然，退款会有小概率会失败的情况，可以监控失败状态，进行告警

File: yudao-module-member/yudao-module-member-biz/src/main/java/cn/iocoder/yudao/module/member/controller/app/auth/AppAuthController.java
Patch:
@@ -3,7 +3,6 @@
 import cn.hutool.core.util.StrUtil;
 import cn.iocoder.yudao.framework.common.enums.UserTypeEnum;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.framework.security.config.SecurityProperties;
 import cn.iocoder.yudao.framework.security.core.util.SecurityFrameworkUtils;
 import cn.iocoder.yudao.module.member.controller.app.auth.vo.*;
@@ -64,7 +63,6 @@ public CommonResult<Boolean> logout(HttpServletRequest request) {
     @PostMapping("/refresh-token")
     @Operation(summary = "刷新令牌")
     @Parameter(name = "refreshToken", description = "刷新令牌", required = true)
-    @OperateLog(enable = false) // 避免 Post 请求被记录操作日志
     public CommonResult<AppAuthLoginRespVO> refreshToken(@RequestParam("refreshToken") String refreshToken) {
         return success(authService.refreshToken(refreshToken));
     }

File: yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/controller/admin/open/MpOpenController.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.hutool.core.lang.Assert;
 import cn.hutool.core.util.StrUtil;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.framework.tenant.core.util.TenantUtils;
 import cn.iocoder.yudao.module.mp.controller.admin.open.vo.MpOpenCheckSignatureReqVO;
 import cn.iocoder.yudao.module.mp.controller.admin.open.vo.MpOpenHandleMessageReqVO;
@@ -63,7 +62,6 @@ public String checkSignature(@PathVariable("appId") String appId,
      */
     @Operation(summary = "处理消息")
     @PostMapping(value = "/{appId}", produces = "application/xml; charset=UTF-8")
-    @OperateLog(enable = false) // 回调地址，无需记录操作日志
     public String handleMessage(@PathVariable("appId") String appId,
                                 @RequestBody String content,
                                 MpOpenHandleMessageReqVO reqVO) {

File: yudao-module-pay/yudao-module-pay-biz/src/main/java/cn/iocoder/yudao/module/pay/controller/admin/demo/PayDemoOrderController.java
Patch:
@@ -3,7 +3,6 @@
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.pay.api.notify.dto.PayOrderNotifyReqDTO;
 import cn.iocoder.yudao.module.pay.api.notify.dto.PayRefundNotifyReqDTO;
 import cn.iocoder.yudao.module.pay.controller.admin.demo.vo.PayDemoOrderCreateReqVO;
@@ -50,7 +49,6 @@ public CommonResult<PageResult<PayDemoOrderRespVO>> getDemoOrderPage(@Valid Page
     @PostMapping("/update-paid")
     @Operation(summary = "更新示例订单为已支付") // 由 pay-module 支付服务，进行回调，可见 PayNotifyJob
     @PermitAll // 无需登录，安全由 PayDemoOrderService 内部校验实现
-    @OperateLog(enable = false) // 禁用操作日志，因为没有操作人
     public CommonResult<Boolean> updateDemoOrderPaid(@RequestBody PayOrderNotifyReqDTO notifyReqDTO) {
         payDemoOrderService.updateDemoOrderPaid(Long.valueOf(notifyReqDTO.getMerchantOrderId()),
                 notifyReqDTO.getPayOrderId());
@@ -68,7 +66,6 @@ public CommonResult<Boolean> refundDemoOrder(@RequestParam("id") Long id) {
     @PostMapping("/update-refunded")
     @Operation(summary = "更新示例订单为已退款") // 由 pay-module 支付服务，进行回调，可见 PayNotifyJob
     @PermitAll // 无需登录，安全由 PayDemoOrderService 内部校验实现
-    @OperateLog(enable = false) // 禁用操作日志，因为没有操作人
     public CommonResult<Boolean> updateDemoOrderRefunded(@RequestBody PayRefundNotifyReqDTO notifyReqDTO) {
         payDemoOrderService.updateDemoOrderRefunded(Long.valueOf(notifyReqDTO.getMerchantOrderId()),
                 notifyReqDTO.getPayRefundId());

File: yudao-module-pay/yudao-module-pay-biz/src/main/java/cn/iocoder/yudao/module/pay/controller/admin/notify/PayNotifyController.java
Patch:
@@ -3,7 +3,6 @@
 import cn.hutool.core.collection.CollUtil;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.framework.pay.core.client.PayClient;
 import cn.iocoder.yudao.framework.pay.core.client.dto.order.PayOrderRespDTO;
 import cn.iocoder.yudao.framework.pay.core.client.dto.refund.PayRefundRespDTO;
@@ -59,7 +58,6 @@ public class PayNotifyController {
     @PostMapping(value = "/order/{channelId}")
     @Operation(summary = "支付渠道的统一【支付】回调")
     @PermitAll
-    @OperateLog(enable = false) // 回调地址，无需记录操作日志
     public String notifyOrder(@PathVariable("channelId") Long channelId,
                               @RequestParam(required = false) Map<String, String> params,
                               @RequestBody(required = false) String body) {
@@ -80,7 +78,6 @@ public String notifyOrder(@PathVariable("channelId") Long channelId,
     @PostMapping(value = "/refund/{channelId}")
     @Operation(summary = "支付渠道的统一【退款】回调")
     @PermitAll
-    @OperateLog(enable = false) // 回调地址，无需记录操作日志
     public String notifyRefund(@PathVariable("channelId") Long channelId,
                                @RequestParam(required = false) Map<String, String> params,
                                @RequestBody(required = false) String body) {

File: yudao-module-pay/yudao-module-pay-biz/src/main/java/cn/iocoder/yudao/module/pay/controller/admin/wallet/PayWalletRechargeController.java
Patch:
@@ -1,7 +1,6 @@
 package cn.iocoder.yudao.module.pay.controller.admin.wallet;
 
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.pay.api.notify.dto.PayOrderNotifyReqDTO;
 import cn.iocoder.yudao.module.pay.api.notify.dto.PayRefundNotifyReqDTO;
 import cn.iocoder.yudao.module.pay.service.wallet.PayWalletRechargeService;
@@ -32,7 +31,6 @@ public class PayWalletRechargeController {
     @PostMapping("/update-paid")
     @Operation(summary = "更新钱包充值为已充值") // 由 pay-module 支付服务，进行回调，可见 PayNotifyJob
     @PermitAll // 无需登录， 内部校验实现
-    @OperateLog(enable = false) // 禁用操作日志，因为没有操作人
     public CommonResult<Boolean> updateWalletRechargerPaid(@Valid @RequestBody PayOrderNotifyReqDTO notifyReqDTO) {
         walletRechargeService.updateWalletRechargerPaid(Long.valueOf(notifyReqDTO.getMerchantOrderId()),
                 notifyReqDTO.getPayOrderId());
@@ -51,7 +49,6 @@ public CommonResult<Boolean> refundWalletRecharge(@RequestParam("id") Long id) {
     @PostMapping("/update-refunded")
     @Operation(summary = "更新钱包充值为已退款") // 由 pay-module 支付服务，进行回调，可见 PayNotifyJob
     @PermitAll // 无需登录， 内部校验实现
-    @OperateLog(enable = false) // 禁用操作日志，因为没有操作人
     public CommonResult<Boolean> updateWalletRechargeRefunded(@RequestBody PayRefundNotifyReqDTO notifyReqDTO) {
         walletRechargeService.updateWalletRechargeRefunded(
                 Long.valueOf(notifyReqDTO.getMerchantOrderId()), notifyReqDTO.getPayRefundId());

File: yudao-module-report/yudao-module-report-biz/src/main/java/cn/iocoder/yudao/module/report/controller/admin/goview/GoViewDataController.java
Patch:
@@ -3,7 +3,6 @@
 import cn.hutool.core.map.MapUtil;
 import cn.hutool.core.util.RandomUtil;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.report.controller.admin.goview.vo.data.GoViewDataGetBySqlReqVO;
 import cn.iocoder.yudao.module.report.controller.admin.goview.vo.data.GoViewDataRespVO;
 import cn.iocoder.yudao.module.report.service.goview.GoViewDataService;
@@ -35,15 +34,13 @@ public class GoViewDataController {
     @RequestMapping("/get-by-sql")
     @Operation(summary = "使用 SQL 查询数据")
     @PreAuthorize("@ss.hasPermission('report:go-view-data:get-by-sql')")
-    @OperateLog(enable = false) // 不记录操作日志，因为不需要
     public CommonResult<GoViewDataRespVO> getDataBySQL(@Valid @RequestBody GoViewDataGetBySqlReqVO reqVO) {
         return success(goViewDataService.getDataBySQL(reqVO.getSql()));
     }
 
     @RequestMapping("/get-by-http")
     @Operation(summary = "使用 HTTP 查询数据", description = "这个只是示例接口，实际应该每个查询，都要写一个接口")
     @PreAuthorize("@ss.hasPermission('report:go-view-data:get-by-http')")
-    @OperateLog(enable = false) // 不记录操作日志，因为不需要
     public CommonResult<GoViewDataRespVO> getDataByHttp(
             @RequestParam(required = false) Map<String, String> params,
             @RequestBody(required = false) String body) { // params、body 按照需要去接收，这里仅仅是示例

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/logger/dto/OperateLogPageReqDTO.java
Patch:
@@ -6,11 +6,10 @@
 
 @Schema(name = "RPC 服务 - 操作日志分页 Request DTO")
 @Data
-public class OperateLogV2PageReqDTO extends PageParam {
+public class OperateLogPageReqDTO extends PageParam {
 
-    // TODO @puhui999：应该用 type？
     @Schema(description = "模块类型", requiredMode = Schema.RequiredMode.REQUIRED, example = "订单")
-    private String bizType;
+    private String type;
 
     @Schema(description = "模块数据编号", requiredMode = Schema.RequiredMode.REQUIRED, example = "188")
     private Long bizId;

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/logger/dto/OperateLogRespDTO.java
Patch:
@@ -10,7 +10,7 @@
 
 @Schema(name = "RPC 服务 - 系统操作日志 Response DTO")
 @Data
-public class OperateLogV2RespDTO implements VO {
+public class OperateLogRespDTO implements VO {
 
     @Schema(description = "日志编号", requiredMode = Schema.RequiredMode.REQUIRED, example = "1024")
     private Long id;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/captcha/CaptchaController.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.hutool.core.util.StrUtil;
 import cn.iocoder.yudao.framework.common.util.servlet.ServletUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import com.xingyuv.captcha.model.common.ResponseModel;
 import com.xingyuv.captcha.model.vo.CaptchaVO;
 import com.xingyuv.captcha.service.CaptchaService;
@@ -28,7 +27,6 @@ public class CaptchaController {
     @PostMapping({"/get"})
     @Operation(summary = "获得验证码")
     @PermitAll
-    @OperateLog(enable = false) // 避免 Post 请求被记录操作日志
     public ResponseModel get(@RequestBody CaptchaVO data, HttpServletRequest request) {
         assert request.getRemoteHost() != null;
         data.setBrowserInfo(getRemoteId(request));
@@ -38,7 +36,6 @@ public ResponseModel get(@RequestBody CaptchaVO data, HttpServletRequest request
     @PostMapping("/check")
     @Operation(summary = "校验验证码")
     @PermitAll
-    @OperateLog(enable = false) // 避免 Post 请求被记录操作日志
     public ResponseModel check(@RequestBody CaptchaVO data, HttpServletRequest request) {
         data.setBrowserInfo(getRemoteId(request));
         return captchaService.check(data);

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/logger/OperateLogController.java
Patch:
@@ -1,11 +1,11 @@
 package cn.iocoder.yudao.module.system.controller.admin.logger;
 
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.framework.translate.core.TranslateUtils;
 import cn.iocoder.yudao.module.system.controller.admin.logger.vo.operatelog.OperateLogPageReqVO;
 import cn.iocoder.yudao.module.system.controller.admin.logger.vo.operatelog.OperateLogRespVO;
@@ -25,8 +25,8 @@
 import java.io.IOException;
 import java.util.List;
 
+import static cn.iocoder.yudao.framework.apilog.core.enums.OperateTypeEnum.EXPORT;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
-import static cn.iocoder.yudao.framework.operatelog.core.enums.OperateTypeEnum.EXPORT;
 
 @Tag(name = "管理后台 - 操作日志")
 @RestController
@@ -48,7 +48,7 @@ public CommonResult<PageResult<OperateLogRespVO>> pageOperateLog(@Valid OperateL
     @Operation(summary = "导出操作日志")
     @GetMapping("/export")
     @PreAuthorize("@ss.hasPermission('system:operate-log:export')")
-    @OperateLog(type = EXPORT)
+    @ApiAccessLog(operateType = EXPORT)
     public void exportOperateLog(HttpServletResponse response, @Valid OperateLogPageReqVO exportReqVO) throws IOException {
         exportReqVO.setPageSize(PageParam.PAGE_SIZE_NONE);
         List<OperateLogDO> list = operateLogService.getOperateLogPage(exportReqVO).getList();

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/sms/SmsCallbackController.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.util.servlet.ServletUtils;
-import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
 import cn.iocoder.yudao.module.system.framework.sms.core.enums.SmsChannelEnum;
 import cn.iocoder.yudao.module.system.service.sms.SmsSendService;
 import io.swagger.v3.oas.annotations.Operation;
@@ -28,7 +27,6 @@ public class SmsCallbackController {
     @PostMapping("/aliyun")
     @PermitAll
     @Operation(summary = "阿里云短信的回调", description = "参见 https://help.aliyun.com/document_detail/120998.html 文档")
-    @OperateLog(enable = false)
     public CommonResult<Boolean> receiveAliyunSmsStatus(HttpServletRequest request) throws Throwable {
         String text = ServletUtils.getBody(request);
         smsSendService.receiveSmsStatus(SmsChannelEnum.ALIYUN.getCode(), text);
@@ -38,7 +36,6 @@ public CommonResult<Boolean> receiveAliyunSmsStatus(HttpServletRequest request)
     @PostMapping("/tencent")
     @PermitAll
     @Operation(summary = "腾讯云短信的回调", description = "参见 https://cloud.tencent.com/document/product/382/52077 文档")
-    @OperateLog(enable = false)
     public CommonResult<Boolean> receiveTencentSmsStatus(HttpServletRequest request) throws Throwable {
         String text = ServletUtils.getBody(request);
         smsSendService.receiveSmsStatus(SmsChannelEnum.TENCENT.getCode(), text);

File: yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/package-info.java
Patch:
@@ -1 +0,0 @@
-package cn.iocoder.yudao.framework;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/notify/NotifyMessageController.java
Patch:
@@ -1,5 +1,6 @@
 package cn.iocoder.yudao.module.system.controller.admin.notify;
 
+import cn.iocoder.yudao.framework.apilog.core.annotations.ApiAccessLog;
 import cn.iocoder.yudao.framework.common.enums.UserTypeEnum;
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
@@ -88,6 +89,7 @@ public CommonResult<List<NotifyMessageRespVO>> getUnreadNotifyMessageList(
 
     @GetMapping("/get-unread-count")
     @Operation(summary = "获得当前用户的未读站内信数量")
+    @ApiAccessLog(enable = false) // 由于前端会不断轮询该接口，记录日志没有意义
     public CommonResult<Long> getUnreadNotifyMessageCount() {
         return success(notifyMessageService.getUnreadNotifyMessageCount(
                 getLoginUserId(), UserTypeEnum.ADMIN.getValue()));

File: yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/framework/security/config/SecurityConfiguration.java
Patch:
@@ -9,12 +9,12 @@
 import org.springframework.security.config.annotation.web.configurers.ExpressionUrlAuthorizationConfigurer;
 
 /**
- * Member 模块的 Security 配置
+ * Promotion 模块的 Security 配置
  */
-@Configuration("memberSecurityConfiguration")
+@Configuration("promotionSecurityConfiguration")
 public class SecurityConfiguration {
 
-    @Bean("memberAuthorizeRequestsCustomizer")
+    @Bean("promotionAuthorizeRequestsCustomizer")
     public AuthorizeRequestsCustomizer authorizeRequestsCustomizer() {
         return new AuthorizeRequestsCustomizer() {
 

File: yudao-module-mall/yudao-module-promotion-api/src/main/java/cn/iocoder/yudao/module/promotion/api/coupon/CouponApi.java
Patch:
@@ -9,6 +9,7 @@
 import io.swagger.v3.oas.annotations.Parameter;
 import io.swagger.v3.oas.annotations.tags.Tag;
 import org.springframework.cloud.openfeign.FeignClient;
+import org.springframework.cloud.openfeign.SpringQueryMap;
 import org.springframework.web.bind.annotation.GetMapping;
 import org.springframework.web.bind.annotation.PutMapping;
 import org.springframework.web.bind.annotation.RequestBody;
@@ -32,6 +33,6 @@ public interface CouponApi {
 
     @GetMapping(PREFIX + "/validate")
     @Operation(summary = "校验优惠劵")
-    CommonResult<CouponRespDTO> validateCoupon(@Valid CouponValidReqDTO validReqDTO);
+    CommonResult<CouponRespDTO> validateCoupon(@Valid @SpringQueryMap CouponValidReqDTO validReqDTO);
 
 }

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/logger/OperateLogApi.java
Patch:
@@ -29,7 +29,7 @@ public interface OperateLogApi {
 
     @PostMapping(PREFIX + "/create-v2")
     @Operation(summary = "创建操作日志")
-    CommonResult<Boolean> createOperateLogV2(@Valid OperateLogV2CreateReqDTO createReqDTO);
+    CommonResult<Boolean> createOperateLogV2(@Valid @RequestBody OperateLogV2CreateReqDTO createReqDTO);
 
     @PostMapping(PREFIX + "/page")
     @Operation(summary = "获取指定模块的指定数据的操作日志分页")

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/mail/MailSendApi.java
Patch:
@@ -9,6 +9,7 @@
 import org.springframework.web.bind.annotation.PostMapping;
 
 import jakarta.validation.Valid;
+import org.springframework.web.bind.annotation.RequestBody;
 
 @FeignClient(name = ApiConstants.NAME) // TODO 芋艿：fallbackFactory =
 @Tag(name = "RPC 服务 - 邮件发送")
@@ -18,10 +19,10 @@ public interface MailSendApi {
 
     @PostMapping(PREFIX + "/send-single-admin")
     @Operation(summary = "发送单条邮件给 Admin 用户", description = "在 mail 为空时，使用 userId 加载对应 Admin 的邮箱")
-    CommonResult<Long> sendSingleMailToAdmin(@Valid MailSendSingleToUserReqDTO reqDTO);
+    CommonResult<Long> sendSingleMailToAdmin(@Valid @RequestBody MailSendSingleToUserReqDTO reqDTO);
 
     @PostMapping(PREFIX + "/send-single-member")
     @Operation(summary = "发送单条邮件给 Member 用户", description = "在 mail 为空时，使用 userId 加载对应 Member 的邮箱")
-    CommonResult<Long> sendSingleMailToMember(@Valid MailSendSingleToUserReqDTO reqDTO);
+    CommonResult<Long> sendSingleMailToMember(@Valid @RequestBody MailSendSingleToUserReqDTO reqDTO);
 
 }

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/notify/NotifyMessageSendApi.java
Patch:
@@ -9,6 +9,7 @@
 import org.springframework.web.bind.annotation.PostMapping;
 
 import jakarta.validation.Valid;
+import org.springframework.web.bind.annotation.RequestBody;
 
 @FeignClient(name = ApiConstants.NAME) // TODO 芋艿：fallbackFactory =
 @Tag(name = "RPC 服务 - 站内信发送")
@@ -18,10 +19,10 @@ public interface NotifyMessageSendApi {
 
     @PostMapping(PREFIX + "/send-single-admin")
     @Operation(summary = "发送单条站内信给 Admin 用户")
-    CommonResult<Long> sendSingleMessageToAdmin(@Valid NotifySendSingleToUserReqDTO reqDTO);
+    CommonResult<Long> sendSingleMessageToAdmin(@Valid @RequestBody NotifySendSingleToUserReqDTO reqDTO);
 
     @PostMapping(PREFIX + "/send-single-member")
     @Operation(summary = "发送单条站内信给 Member 用户")
-    CommonResult<Long> sendSingleMessageToMember(@Valid NotifySendSingleToUserReqDTO reqDTO);
+    CommonResult<Long> sendSingleMessageToMember(@Valid @RequestBody NotifySendSingleToUserReqDTO reqDTO);
 
 }

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/enums/ErrorCodeConstants.java
Patch:
@@ -125,7 +125,7 @@ public interface ErrorCodeConstants {
 
     ErrorCode SOCIAL_CLIENT_WEIXIN_MINI_APP_PHONE_CODE_ERROR = new ErrorCode(1_002_018_200, "获得手机号失败");
     ErrorCode SOCIAL_CLIENT_NOT_EXISTS = new ErrorCode(1_002_018_201, "社交客户端不存在");
-    ErrorCode SOCIAL_CLIENT_UNIQUE = new ErrorCode(1_002_018_201, "社交客户端已存在配置");
+    ErrorCode SOCIAL_CLIENT_UNIQUE = new ErrorCode(1_002_018_202, "社交客户端已存在配置");
 
     // ========== 系统敏感词 1-002-019-000 =========
     ErrorCode SENSITIVE_WORD_NOT_EXISTS = new ErrorCode(1_002_019_000, "系统敏感词在所有标签中都不存在");

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/enums/ErrorCodeConstants.java
Patch:
@@ -125,7 +125,7 @@ public interface ErrorCodeConstants {
 
     ErrorCode SOCIAL_CLIENT_WEIXIN_MINI_APP_PHONE_CODE_ERROR = new ErrorCode(1_002_018_200, "获得手机号失败");
     ErrorCode SOCIAL_CLIENT_NOT_EXISTS = new ErrorCode(1_002_018_201, "社交客户端不存在");
-    ErrorCode SOCIAL_CLIENT_UNIQUE = new ErrorCode(1_002_018_201, "社交客户端已存在配置");
+    ErrorCode SOCIAL_CLIENT_UNIQUE = new ErrorCode(1_002_018_202, "社交客户端已存在配置");
 
     // ========== 系统敏感词 1-002-019-000 =========
     ErrorCode SENSITIVE_WORD_NOT_EXISTS = new ErrorCode(1_002_019_000, "系统敏感词在所有标签中都不存在");

File: yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/controller/app/bargain/AppBargainActivityController.java
Patch:
@@ -31,6 +31,7 @@
 
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.cache.CacheUtils.buildAsyncReloadingCache;
+import static cn.iocoder.yudao.framework.common.util.cache.CacheUtils.buildCache;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertList;
 
 @Tag(name = "用户 App - 砍价活动")
@@ -42,7 +43,7 @@ public class AppBargainActivityController {
     /**
      * {@link AppBargainActivityRespVO} 缓存，通过它异步刷新 {@link #getBargainActivityList0(Integer)} 所要的首页数据
      */
-    private final LoadingCache<Integer, List<AppBargainActivityRespVO>> bargainActivityListCache = buildAsyncReloadingCache(Duration.ofSeconds(10L),
+    private final LoadingCache<Integer, List<AppBargainActivityRespVO>> bargainActivityListCache = buildCache(Duration.ofSeconds(10L),
             new CacheLoader<Integer, List<AppBargainActivityRespVO>>() {
 
                 @Override

File: yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/controller/app/combination/AppCombinationActivityController.java
Patch:
@@ -32,6 +32,7 @@
 
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.cache.CacheUtils.buildAsyncReloadingCache;
+import static cn.iocoder.yudao.framework.common.util.cache.CacheUtils.buildCache;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertList;
 
 @Tag(name = "用户 APP - 拼团活动")
@@ -43,7 +44,7 @@ public class AppCombinationActivityController {
     /**
      * {@link AppCombinationActivityRespVO} 缓存，通过它异步刷新 {@link #getCombinationActivityList0(Integer)} 所要的首页数据
      */
-    private final LoadingCache<Integer, List<AppCombinationActivityRespVO>> combinationActivityListCache = buildAsyncReloadingCache(Duration.ofSeconds(10L),
+    private final LoadingCache<Integer, List<AppCombinationActivityRespVO>> combinationActivityListCache = buildCache(Duration.ofSeconds(10L),
             new CacheLoader<Integer, List<AppCombinationActivityRespVO>>() {
 
                 @Override

File: yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/controller/app/seckill/AppSeckillActivityController.java
Patch:
@@ -39,6 +39,7 @@
 
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.common.util.cache.CacheUtils.buildAsyncReloadingCache;
+import static cn.iocoder.yudao.framework.common.util.cache.CacheUtils.buildCache;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertList;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.findFirst;
 import static cn.iocoder.yudao.framework.common.util.date.LocalDateTimeUtils.isBetween;
@@ -52,7 +53,7 @@ public class AppSeckillActivityController {
     /**
      * {@link AppSeckillActivityNowRespVO} 缓存，通过它异步刷新 {@link #getNowSeckillActivity()} 所要的首页数据
      */
-    private final LoadingCache<String, AppSeckillActivityNowRespVO> nowSeckillActivityCache = buildAsyncReloadingCache(Duration.ofSeconds(10L),
+    private final LoadingCache<String, AppSeckillActivityNowRespVO> nowSeckillActivityCache = buildCache(Duration.ofSeconds(10L),
             new CacheLoader<String, AppSeckillActivityNowRespVO>() {
 
                 @Override

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/social/SocialClientServiceImpl.java
Patch:
@@ -46,6 +46,7 @@
 import java.util.Objects;
 
 import static cn.iocoder.yudao.framework.common.exception.util.ServiceExceptionUtil.exception;
+import static cn.iocoder.yudao.framework.common.util.cache.CacheUtils.buildAsyncReloadingCache;
 import static cn.iocoder.yudao.framework.common.util.json.JsonUtils.toJsonString;
 import static cn.iocoder.yudao.module.system.enums.ErrorCodeConstants.*;
 
@@ -75,7 +76,7 @@ public class SocialClientServiceImpl implements SocialClientService {
      *
      * 为什么要做 WxMpService 缓存？因为 WxMpService 构建成本比较大，所以尽量保证它是单例。
      */
-    private final LoadingCache<String, WxMpService> wxMpServiceCache = CacheUtils.buildAsyncReloadingCache(
+    private final LoadingCache<String, WxMpService> wxMpServiceCache = buildAsyncReloadingCache(
             Duration.ofSeconds(10L),
             new CacheLoader<String, WxMpService>() {
 
@@ -96,7 +97,7 @@ public WxMpService load(String key) {
      *
      * 说明同 {@link #wxMpServiceCache} 变量
      */
-    private final LoadingCache<String, WxMaService> wxMaServiceCache = CacheUtils.buildAsyncReloadingCache(
+    private final LoadingCache<String, WxMaService> wxMaServiceCache = buildAsyncReloadingCache(
             Duration.ofSeconds(10L),
             new CacheLoader<String, WxMaService>() {
 

File: yudao-framework/yudao-common/src/main/java/cn/iocoder/yudao/framework/common/util/collection/CollectionUtils.java
Patch:
@@ -257,11 +257,11 @@ public static <T> T getFirst(List<T> from) {
         return !CollectionUtil.isEmpty(from) ? from.get(0) : null;
     }
 
-    public static <T> T findFirst(List<T> from, Predicate<T> predicate) {
+    public static <T> T findFirst(Collection<T> from, Predicate<T> predicate) {
         return findFirst(from, predicate, Function.identity());
     }
 
-    public static <T, U> U findFirst(List<T> from, Predicate<T> predicate, Function<T, U> func) {
+    public static <T, U> U findFirst(Collection<T> from, Predicate<T> predicate, Function<T, U> func) {
         if (CollUtil.isEmpty(from)) {
             return null;
         }

File: yudao-module-bpm/yudao-module-bpm-api/src/main/java/cn/iocoder/yudao/module/bpm/event/BpmProcessInstanceResultEvent.java
Patch:
@@ -1,6 +1,5 @@
-package cn.iocoder.yudao.module.bpm.framework.bpm.core.event;
+package cn.iocoder.yudao.module.bpm.event;
 
-import cn.iocoder.yudao.module.bpm.dal.dataobject.task.BpmProcessInstanceExtDO;
 import lombok.Data;
 import org.springframework.context.ApplicationEvent;
 

File: yudao-module-bpm/yudao-module-bpm-api/src/main/java/cn/iocoder/yudao/module/bpm/event/BpmProcessInstanceResultEventListener.java
Patch:
@@ -1,8 +1,9 @@
-package cn.iocoder.yudao.module.bpm.framework.bpm.core.event;
+package cn.iocoder.yudao.module.bpm.event;
 
 import cn.hutool.core.util.StrUtil;
 import org.springframework.context.ApplicationListener;
 
+// TODO 芋艿：跨服务的情况下，该逻辑无法跑通
 /**
  * {@link BpmProcessInstanceResultEvent} 的监听器
  *

File: yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/convert/task/BpmProcessInstanceConvert.java
Patch:
@@ -7,7 +7,7 @@
 import cn.iocoder.yudao.module.bpm.controller.admin.task.vo.instance.BpmProcessInstanceRespVO;
 import cn.iocoder.yudao.module.bpm.dal.dataobject.definition.BpmProcessDefinitionExtDO;
 import cn.iocoder.yudao.module.bpm.dal.dataobject.task.BpmProcessInstanceExtDO;
-import cn.iocoder.yudao.module.bpm.framework.bpm.core.event.BpmProcessInstanceResultEvent;
+import cn.iocoder.yudao.module.bpm.event.BpmProcessInstanceResultEvent;
 import cn.iocoder.yudao.module.bpm.service.message.dto.BpmMessageSendWhenProcessInstanceApproveReqDTO;
 import cn.iocoder.yudao.module.bpm.service.message.dto.BpmMessageSendWhenProcessInstanceRejectReqDTO;
 import cn.iocoder.yudao.module.system.api.dept.dto.DeptRespDTO;

File: yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/framework/bpm/core/event/BpmProcessInstanceResultEventPublisher.java
Patch:
@@ -1,5 +1,6 @@
 package cn.iocoder.yudao.module.bpm.framework.bpm.core.event;
 
+import cn.iocoder.yudao.module.bpm.event.BpmProcessInstanceResultEvent;
 import lombok.AllArgsConstructor;
 import org.springframework.context.ApplicationEventPublisher;
 import org.springframework.validation.annotation.Validated;

File: yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/service/oa/listener/BpmOALeaveResultListener.java
Patch:
@@ -1,7 +1,7 @@
 package cn.iocoder.yudao.module.bpm.service.oa.listener;
 
-import cn.iocoder.yudao.module.bpm.framework.bpm.core.event.BpmProcessInstanceResultEvent;
-import cn.iocoder.yudao.module.bpm.framework.bpm.core.event.BpmProcessInstanceResultEventListener;
+import cn.iocoder.yudao.module.bpm.event.BpmProcessInstanceResultEvent;
+import cn.iocoder.yudao.module.bpm.event.BpmProcessInstanceResultEventListener;
 import cn.iocoder.yudao.module.bpm.service.oa.BpmOALeaveService;
 import cn.iocoder.yudao.module.bpm.service.oa.BpmOALeaveServiceImpl;
 import org.springframework.stereotype.Component;

File: yudao-module-crm/yudao-module-crm-api/src/main/java/cn/iocoder/yudao/module/crm/enums/DictTypeConstants.java
Patch:
@@ -14,5 +14,6 @@ public interface DictTypeConstants {
     String CRM_PRODUCT_UNIT = "crm_product_unit"; // CRM 产品单位
     String CRM_PRODUCT_STATUS = "crm_product_status"; // CRM 产品状态
     String CRM_FOLLOW_UP_TYPE = "crm_follow_up_type"; // CRM 跟进方式
+    String CRM_RECEIVABLE_RETURN_TYPE = "crm_receivable_return_type"; // CRM 回款方式
 
 }

File: yudao-module-crm/yudao-module-crm-api/src/main/java/cn/iocoder/yudao/module/crm/enums/common/CrmBizTypeEnum.java
Patch:
@@ -17,7 +17,7 @@
 @Getter
 public enum CrmBizTypeEnum implements IntArrayValuable {
 
-    CRM_LEADS(1, "线索"),
+    CRM_CLUE(1, "线索"),
     CRM_CUSTOMER(2, "客户"),
     CRM_CONTACT(3, "联系人"),
     CRM_BUSINESS(4, "商机"),

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/contact/vo/CrmContactBusinessReqVO.java
Patch:
@@ -7,7 +7,7 @@
 
 import java.util.List;
 
-@Schema(description = "管理后台 - CRM 联系人商机 Request VO") // 用于关联，取消关联的操作
+@Schema(description = "管理后台 - CRM 联系人商机 Request VO") // 【联系人关联商机】用于关联，取消关联的操作
 @Data
 public class CrmContactBusinessReqVO {
 

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/contact/vo/CrmContactPageReqVO.java
Patch:
@@ -39,4 +39,7 @@ public class CrmContactPageReqVO extends PageParam {
     @InEnum(CrmSceneTypeEnum.class)
     private Integer sceneType; // 场景类型，为 null 时则表示全部
 
+    @Schema(description = "商机编号", example = "10430")
+    private Long businessId;
+
 }

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/contact/vo/CrmContactTransferReqVO.java
Patch:
@@ -2,10 +2,9 @@
 
 import cn.iocoder.yudao.module.crm.enums.permission.CrmPermissionLevelEnum;
 import io.swagger.v3.oas.annotations.media.Schema;
+import jakarta.validation.constraints.NotNull;
 import lombok.Data;
 
-import javax.validation.constraints.NotNull;
-
 @Schema(description = "管理后台 - CRM 联系人转移 Request VO")
 @Data
 public class CrmContactTransferReqVO {

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/contract/vo/contract/CrmContractPageReqVO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.yudao.module.crm.controller.admin.contract.vo;
+package cn.iocoder.yudao.module.crm.controller.admin.contract.vo.contract;
 
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import cn.iocoder.yudao.framework.common.validation.InEnum;

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/contract/vo/contract/CrmContractTransferReqVO.java
Patch:
@@ -1,12 +1,11 @@
-package cn.iocoder.yudao.module.crm.controller.admin.contract.vo;
+package cn.iocoder.yudao.module.crm.controller.admin.contract.vo.contract;
 
 import cn.iocoder.yudao.framework.common.validation.InEnum;
 import cn.iocoder.yudao.module.crm.enums.permission.CrmPermissionLevelEnum;
 import io.swagger.v3.oas.annotations.media.Schema;
+import jakarta.validation.constraints.NotNull;
 import lombok.Data;
 
-import javax.validation.constraints.NotNull;
-
 @Schema(description = "管理后台 - CRM 合同转移 Request VO")
 @Data
 public class CrmContractTransferReqVO {

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/customer/vo/customer/CrmCustomerDistributeReqVO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.yudao.module.crm.controller.admin.customer.vo;
+package cn.iocoder.yudao.module.crm.controller.admin.customer.vo.customer;
 
 import io.swagger.v3.oas.annotations.media.Schema;
 import javax.validation.constraints.NotEmpty;

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/customer/vo/customer/CrmCustomerImportReqVO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.yudao.module.crm.controller.admin.customer.vo;
+package cn.iocoder.yudao.module.crm.controller.admin.customer.vo.customer;
 
 import io.swagger.v3.oas.annotations.media.Schema;
 import javax.validation.constraints.NotNull;

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/customer/vo/customer/CrmCustomerImportRespVO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.yudao.module.crm.controller.admin.customer.vo;
+package cn.iocoder.yudao.module.crm.controller.admin.customer.vo.customer;
 
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Builder;

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/customer/vo/customer/CrmCustomerLockReqVO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.yudao.module.crm.controller.admin.customer.vo;
+package cn.iocoder.yudao.module.crm.controller.admin.customer.vo.customer;
 
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/customer/vo/customer/CrmCustomerTransferReqVO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.yudao.module.crm.controller.admin.customer.vo;
+package cn.iocoder.yudao.module.crm.controller.admin.customer.vo.customer;
 
 import cn.iocoder.yudao.module.crm.enums.permission.CrmPermissionLevelEnum;
 import io.swagger.v3.oas.annotations.media.Schema;

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/operatelog/vo/CrmOperateLogRespVO.java
Patch:
@@ -6,10 +6,10 @@
 
 import java.time.LocalDateTime;
 
-@Schema(description = "管理后台 - CRM 跟进 Response VO")
+@Schema(description = "管理后台 - CRM 操作日志 Response VO")
 @Data
 @ExcelIgnoreUnannotated
-public class CrmOperateLogV2RespVO {
+public class CrmOperateLogRespVO {
 
     @Schema(description = "编号", requiredMode = Schema.RequiredMode.REQUIRED, example = "13563")
     private Long id;

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/permission/vo/CrmPermissionBaseVO.java
Patch:
@@ -4,10 +4,9 @@
 import cn.iocoder.yudao.module.crm.enums.common.CrmBizTypeEnum;
 import cn.iocoder.yudao.module.crm.enums.permission.CrmPermissionLevelEnum;
 import io.swagger.v3.oas.annotations.media.Schema;
+import jakarta.validation.constraints.NotNull;
 import lombok.Data;
 
-import javax.validation.constraints.NotNull;
-
 /**
  * 数据权限 Base VO，提供给添加、修改、详细的子 VO 使用
  * 如果子 VO 存在差异的字段，请不要添加到这里，影响 Swagger 文档生成

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/permission/vo/CrmPermissionUpdateReqVO.java
Patch:
@@ -4,9 +4,9 @@
 import cn.iocoder.yudao.module.crm.enums.common.CrmBizTypeEnum;
 import cn.iocoder.yudao.module.crm.enums.permission.CrmPermissionLevelEnum;
 import io.swagger.v3.oas.annotations.media.Schema;
+import jakarta.validation.constraints.NotNull;
 import lombok.Data;
 
-import javax.validation.constraints.NotNull;
 import java.util.List;
 
 @Schema(description = "管理后台 - CRM 数据权限更新 Request VO")

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/product/CrmProductCategoryController.java
Patch:
@@ -10,12 +10,12 @@
 import io.swagger.v3.oas.annotations.Operation;
 import io.swagger.v3.oas.annotations.Parameter;
 import io.swagger.v3.oas.annotations.tags.Tag;
+import jakarta.annotation.Resource;
+import jakarta.validation.Valid;
 import org.springframework.security.access.prepost.PreAuthorize;
 import org.springframework.validation.annotation.Validated;
 import org.springframework.web.bind.annotation.*;
 
-import javax.annotation.Resource;
-import javax.validation.Valid;
 import java.util.List;
 
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/product/vo/category/CrmProductCategoryCreateReqVO.java
Patch:
@@ -1,10 +1,9 @@
 package cn.iocoder.yudao.module.crm.controller.admin.product.vo.category;
 
 import com.mzt.logapi.starter.annotation.DiffLogField;
-import lombok.*;
 import io.swagger.v3.oas.annotations.media.Schema;
-
-import javax.validation.constraints.NotNull;
+import jakarta.validation.constraints.NotNull;
+import lombok.Data;
 
 @Schema(description = "管理后台 - CRM 产品分类创建/更新 Request VO")
 @Data

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/product/vo/category/CrmProductCategoryRespVO.java
Patch:
@@ -1,7 +1,7 @@
 package cn.iocoder.yudao.module.crm.controller.admin.product.vo.category;
 
 import io.swagger.v3.oas.annotations.media.Schema;
-import lombok.*;
+import lombok.Data;
 
 import java.time.LocalDateTime;
 

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/product/vo/product/CrmProductRespVO.java
Patch:
@@ -8,6 +8,7 @@
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 
+import java.math.BigDecimal;
 import java.time.LocalDateTime;
 
 @Schema(description = "管理后台 - CRM 产品 Response VO")
@@ -34,7 +35,7 @@ public class CrmProductRespVO {
 
     @Schema(description = "价格, 单位：分", requiredMode = Schema.RequiredMode.REQUIRED, example = "8911")
     @ExcelProperty("价格，单位：分")
-    private Long price;
+    private BigDecimal price;
 
     @Schema(description = "状态", requiredMode = Schema.RequiredMode.REQUIRED, example = "上架")
     @ExcelProperty(value = "单位", converter = DictConvert.class)

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/receivable/vo/receivable/CrmReceivablePageReqVO.java
Patch:
@@ -24,6 +24,9 @@ public class CrmReceivablePageReqVO extends PageParam {
     @Schema(description = "客户编号", example = "4963")
     private Long customerId;
 
+    @Schema(description = "合同编号", example = "4963")
+    private Long contractId;
+
     @Schema(description = "场景类型", example = "1")
     @InEnum(CrmSceneTypeEnum.class)
     private Integer sceneType; // 场景类型，为 null 时则表示全部

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/statistics/vo/CrmStatisticsRanKRespVO.java
Patch:
@@ -1,12 +1,12 @@
-package cn.iocoder.yudao.module.crm.controller.admin.bi.vo;
+package cn.iocoder.yudao.module.crm.controller.admin.statistics.vo;
 
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 
 
-@Schema(description = "管理后台 - CRM BI 排行榜 Response VO")
+@Schema(description = "管理后台 - CRM BI 排行榜统计 Response VO")
 @Data
-public class CrmBiRanKRespVO {
+public class CrmStatisticsRanKRespVO {
 
     @Schema(description = "负责人编号", requiredMode = Schema.RequiredMode.REQUIRED, example = "1")
     private Long ownerUserId;

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/statistics/vo/CrmStatisticsRankReqVO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.yudao.module.crm.controller.admin.bi.vo;
+package cn.iocoder.yudao.module.crm.controller.admin.statistics.vo;
 
 import io.swagger.v3.oas.annotations.media.Schema;
 import javax.validation.constraints.NotEmpty;
@@ -11,9 +11,9 @@
 
 import static cn.iocoder.yudao.framework.common.util.date.DateUtils.FORMAT_YEAR_MONTH_DAY_HOUR_MINUTE_SECOND;
 
-@Schema(description = "管理后台 - CRM BI 排行榜 Request VO")
+@Schema(description = "管理后台 - CRM 排行榜统计 Request VO")
 @Data
-public class CrmBiRankReqVO {
+public class CrmStatisticsRankReqVO {
 
     @Schema(description = "部门 id", requiredMode = Schema.RequiredMode.REQUIRED, example = "1")
     @NotNull(message = "部门 id 不能为空")

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/dal/dataobject/business/CrmBusinessStatusDO.java
Patch:
@@ -6,7 +6,9 @@
 import lombok.*;
 
 /**
- * 商机状态 DO
+ * CRM 商机状态 DO
+ *
+ * 注意，它是个配置表
  *
  * @author ljlleo
  */

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/framework/permission/core/aop/CrmPermissionAspect.java
Patch:
@@ -9,9 +9,9 @@
 import cn.iocoder.yudao.module.crm.enums.common.CrmBizTypeEnum;
 import cn.iocoder.yudao.module.crm.enums.permission.CrmPermissionLevelEnum;
 import cn.iocoder.yudao.module.crm.framework.permission.core.annotations.CrmPermission;
-import cn.iocoder.yudao.module.crm.framework.permission.core.util.CrmPermissionUtils;
 import cn.iocoder.yudao.module.crm.service.permission.CrmPermissionService;
-import javax.annotation.Resource;
+import cn.iocoder.yudao.module.crm.util.CrmPermissionUtils;
+import jakarta.annotation.Resource;
 import lombok.extern.slf4j.Slf4j;
 import org.aspectj.lang.JoinPoint;
 import org.aspectj.lang.annotation.Aspect;

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/customer/CrmCustomerPoolConfigService.java
Patch:
@@ -2,8 +2,7 @@
 
 import cn.iocoder.yudao.module.crm.controller.admin.customer.vo.poolconfig.CrmCustomerPoolConfigSaveReqVO;
 import cn.iocoder.yudao.module.crm.dal.dataobject.customer.CrmCustomerPoolConfigDO;
-
-import javax.validation.Valid;
+import jakarta.validation.Valid;
 
 /**
  * 客户公海配置 Service 接口

File: yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/permission/bo/CrmPermissionCreateReqBO.java
Patch:
@@ -3,10 +3,9 @@
 import cn.iocoder.yudao.framework.common.validation.InEnum;
 import cn.iocoder.yudao.module.crm.enums.common.CrmBizTypeEnum;
 import cn.iocoder.yudao.module.crm.enums.permission.CrmPermissionLevelEnum;
+import jakarta.validation.constraints.NotNull;
 import lombok.Data;
 
-import javax.validation.constraints.NotNull;
-
 /**
  * crm 数据权限 Create Req BO
  *

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/sale/vo/customer/ErpCustomerSaveReqVO.java
Patch:
@@ -1,9 +1,10 @@
 package cn.iocoder.yudao.module.erp.controller.admin.sale.vo.customer;
 
 import io.swagger.v3.oas.annotations.media.Schema;
-import lombok.*;
+import jakarta.validation.constraints.NotEmpty;
+import jakarta.validation.constraints.NotNull;
+import lombok.Data;
 
-import javax.validation.constraints.*;
 import java.math.BigDecimal;
 
 @Schema(description = "管理后台 - ERP 客户新增/修改 Request VO")

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/stock/ErpStockInController.java
Patch:
@@ -12,10 +12,10 @@
 import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.in.ErpStockInPageReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.in.ErpStockInRespVO;
 import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.in.ErpStockInSaveReqVO;
+import cn.iocoder.yudao.module.erp.dal.dataobject.purchase.ErpSupplierDO;
 import cn.iocoder.yudao.module.erp.dal.dataobject.stock.ErpStockDO;
 import cn.iocoder.yudao.module.erp.dal.dataobject.stock.ErpStockInDO;
 import cn.iocoder.yudao.module.erp.dal.dataobject.stock.ErpStockInItemDO;
-import cn.iocoder.yudao.module.erp.dal.dataobject.purchase.ErpSupplierDO;
 import cn.iocoder.yudao.module.erp.service.product.ErpProductService;
 import cn.iocoder.yudao.module.erp.service.purchase.ErpSupplierService;
 import cn.iocoder.yudao.module.erp.service.stock.ErpStockInService;

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/stock/ErpWarehouseController.java
Patch:
@@ -7,7 +7,7 @@
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.framework.excel.core.util.ExcelUtils;
 import cn.iocoder.yudao.framework.operatelog.core.annotations.OperateLog;
-import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.ErpWarehouseSaveReqVO;
+import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.warehouse.ErpWarehouseSaveReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.warehouse.ErpWarehousePageReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.warehouse.ErpWarehouseRespVO;
 import cn.iocoder.yudao.module.erp.dal.dataobject.stock.ErpWarehouseDO;

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/stock/vo/warehouse/ErpWarehouseSaveReqVO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.yudao.module.erp.controller.admin.stock.vo;
+package cn.iocoder.yudao.module.erp.controller.admin.stock.vo.warehouse;
 
 import cn.iocoder.yudao.framework.common.enums.CommonStatusEnum;
 import cn.iocoder.yudao.framework.common.validation.InEnum;

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/dal/mysql/product/ErpProductMapper.java
Patch:
@@ -1,8 +1,8 @@
 package cn.iocoder.yudao.module.erp.dal.mysql.product;
 
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
-import cn.iocoder.yudao.framework.mybatis.core.query.LambdaQueryWrapperX;
 import cn.iocoder.yudao.framework.mybatis.core.mapper.BaseMapperX;
+import cn.iocoder.yudao.framework.mybatis.core.query.LambdaQueryWrapperX;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.product.ErpProductPageReqVO;
 import cn.iocoder.yudao.module.erp.dal.dataobject.product.ErpProductDO;
 import org.apache.ibatis.annotations.Mapper;

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/dal/mysql/product/ErpProductUnitMapper.java
Patch:
@@ -1,8 +1,8 @@
 package cn.iocoder.yudao.module.erp.dal.mysql.product;
 
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
-import cn.iocoder.yudao.framework.mybatis.core.query.LambdaQueryWrapperX;
 import cn.iocoder.yudao.framework.mybatis.core.mapper.BaseMapperX;
+import cn.iocoder.yudao.framework.mybatis.core.query.LambdaQueryWrapperX;
 import cn.iocoder.yudao.module.erp.controller.admin.product.vo.unit.ErpProductUnitPageReqVO;
 import cn.iocoder.yudao.module.erp.dal.dataobject.product.ErpProductUnitDO;
 import org.apache.ibatis.annotations.Mapper;

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/dal/mysql/purchase/ErpSupplierMapper.java
Patch:
@@ -1,8 +1,8 @@
 package cn.iocoder.yudao.module.erp.dal.mysql.purchase;
 
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
-import cn.iocoder.yudao.framework.mybatis.core.query.LambdaQueryWrapperX;
 import cn.iocoder.yudao.framework.mybatis.core.mapper.BaseMapperX;
+import cn.iocoder.yudao.framework.mybatis.core.query.LambdaQueryWrapperX;
 import cn.iocoder.yudao.module.erp.controller.admin.purchase.vo.supplier.ErpSupplierPageReqVO;
 import cn.iocoder.yudao.module.erp.dal.dataobject.purchase.ErpSupplierDO;
 import org.apache.ibatis.annotations.Mapper;

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/dal/mysql/stock/ErpWarehouseMapper.java
Patch:
@@ -1,8 +1,8 @@
 package cn.iocoder.yudao.module.erp.dal.mysql.stock;
 
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
-import cn.iocoder.yudao.framework.mybatis.core.query.LambdaQueryWrapperX;
 import cn.iocoder.yudao.framework.mybatis.core.mapper.BaseMapperX;
+import cn.iocoder.yudao.framework.mybatis.core.query.LambdaQueryWrapperX;
 import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.warehouse.ErpWarehousePageReqVO;
 import cn.iocoder.yudao.module.erp.dal.dataobject.stock.ErpWarehouseDO;
 import org.apache.ibatis.annotations.Mapper;

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/dal/redis/RedisKeyConstants.java
Patch:
@@ -13,6 +13,6 @@ public interface RedisKeyConstants {
      * KEY 格式：trade_no:{prefix}
      * VALUE 数据格式：编号自增
      */
-    String NO = "seq_no:";
+    String NO = "erp:seq_no:";
 
 }

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/dal/redis/no/ErpNoRedisDAO.java
Patch:
@@ -12,7 +12,7 @@
 
 
 /**
- * 订单序号的 Redis DAO
+ * Erp 订单序号的 Redis DAO
  *
  * @author HUIHUI
  */

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/service/finance/ErpAccountServiceImpl.java
Patch:
@@ -15,7 +15,8 @@
 import java.util.List;
 
 import static cn.iocoder.yudao.framework.common.exception.util.ServiceExceptionUtil.exception;
-import static cn.iocoder.yudao.module.erp.enums.ErrorCodeConstants.*;
+import static cn.iocoder.yudao.module.erp.enums.ErrorCodeConstants.ACCOUNT_NOT_ENABLE;
+import static cn.iocoder.yudao.module.erp.enums.ErrorCodeConstants.ACCOUNT_NOT_EXISTS;
 
 /**
  * ERP 结算账户 Service 实现类

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/service/purchase/ErpPurchaseInServiceImpl.java
Patch:
@@ -164,7 +164,7 @@ public void updatePurchaseInStatus(Long id, Integer status) {
             throw exception(approve ? PURCHASE_IN_APPROVE_FAIL : PURCHASE_IN_PROCESS_FAIL);
         }
         // 1.3 校验已付款
-        if (approve && purchaseIn.getPaymentPrice().compareTo(BigDecimal.ZERO) > 0) {
+        if (!approve && purchaseIn.getPaymentPrice().compareTo(BigDecimal.ZERO) > 0) {
             throw exception(PURCHASE_IN_PROCESS_FAIL_EXISTS_PAYMENT);
         }
 

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/service/purchase/ErpPurchaseReturnServiceImpl.java
Patch:
@@ -160,7 +160,7 @@ public void updatePurchaseReturnStatus(Long id, Integer status) {
             throw exception(approve ? PURCHASE_RETURN_APPROVE_FAIL : PURCHASE_RETURN_PROCESS_FAIL);
         }
         // 1.3 校验已退款
-        if (approve && purchaseReturn.getRefundPrice().compareTo(BigDecimal.ZERO) > 0) {
+        if (!approve && purchaseReturn.getRefundPrice().compareTo(BigDecimal.ZERO) > 0) {
             throw exception(PURCHASE_RETURN_PROCESS_FAIL_EXISTS_REFUND);
         }
 

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/service/purchase/ErpSupplierServiceImpl.java
Patch:
@@ -15,7 +15,8 @@
 import java.util.List;
 
 import static cn.iocoder.yudao.framework.common.exception.util.ServiceExceptionUtil.exception;
-import static cn.iocoder.yudao.module.erp.enums.ErrorCodeConstants.*;
+import static cn.iocoder.yudao.module.erp.enums.ErrorCodeConstants.SUPPLIER_NOT_ENABLE;
+import static cn.iocoder.yudao.module.erp.enums.ErrorCodeConstants.SUPPLIER_NOT_EXISTS;
 
 /**
  * ERP 供应商 Service 实现类

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/service/sale/ErpSaleOutServiceImpl.java
Patch:
@@ -172,7 +172,7 @@ public void updateSaleOutStatus(Long id, Integer status) {
             throw exception(approve ? SALE_OUT_APPROVE_FAIL : SALE_OUT_PROCESS_FAIL);
         }
         // 1.3 校验已退款
-        if (approve && saleOut.getReceiptPrice().compareTo(BigDecimal.ZERO) > 0) {
+        if (!approve && saleOut.getReceiptPrice().compareTo(BigDecimal.ZERO) > 0) {
             throw exception(SALE_OUT_PROCESS_FAIL_EXISTS_RECEIPT);
         }
 

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/service/sale/ErpSaleReturnServiceImpl.java
Patch:
@@ -172,7 +172,7 @@ public void updateSaleReturnStatus(Long id, Integer status) {
             throw exception(approve ? SALE_RETURN_APPROVE_FAIL : SALE_RETURN_PROCESS_FAIL);
         }
         // 1.3 校验已退款
-        if (approve && saleReturn.getRefundPrice().compareTo(BigDecimal.ZERO) > 0) {
+        if (!approve && saleReturn.getRefundPrice().compareTo(BigDecimal.ZERO) > 0) {
             throw exception(SALE_RETURN_PROCESS_FAIL_EXISTS_REFUND);
         }
 

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/service/stock/ErpWarehouseService.java
Patch:
@@ -1,7 +1,7 @@
 package cn.iocoder.yudao.module.erp.service.stock;
 
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
-import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.ErpWarehouseSaveReqVO;
+import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.warehouse.ErpWarehouseSaveReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.warehouse.ErpWarehousePageReqVO;
 import cn.iocoder.yudao.module.erp.dal.dataobject.stock.ErpWarehouseDO;
 import javax.validation.Valid;

File: yudao-module-erp/yudao-module-erp-biz/src/main/java/cn/iocoder/yudao/module/erp/service/stock/ErpWarehouseServiceImpl.java
Patch:
@@ -4,7 +4,7 @@
 import cn.iocoder.yudao.framework.common.enums.CommonStatusEnum;
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
-import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.ErpWarehouseSaveReqVO;
+import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.warehouse.ErpWarehouseSaveReqVO;
 import cn.iocoder.yudao.module.erp.controller.admin.stock.vo.warehouse.ErpWarehousePageReqVO;
 import cn.iocoder.yudao.module.erp.dal.dataobject.stock.ErpWarehouseDO;
 import cn.iocoder.yudao.module.erp.dal.mysql.stock.ErpWarehouseMapper;
@@ -20,7 +20,8 @@
 
 import static cn.iocoder.yudao.framework.common.exception.util.ServiceExceptionUtil.exception;
 import static cn.iocoder.yudao.framework.common.util.collection.CollectionUtils.convertMap;
-import static cn.iocoder.yudao.module.erp.enums.ErrorCodeConstants.*;
+import static cn.iocoder.yudao.module.erp.enums.ErrorCodeConstants.WAREHOUSE_NOT_ENABLE;
+import static cn.iocoder.yudao.module.erp.enums.ErrorCodeConstants.WAREHOUSE_NOT_EXISTS;
 
 /**
  * ERP 仓库 Service 实现类

File: yudao-module-infra/yudao-module-infra-biz/src/test/java/cn/iocoder/yudao/module/infra/service/codegen/CodegenServiceImplTest.java
Patch:
@@ -24,6 +24,7 @@
 import cn.iocoder.yudao.module.system.api.user.dto.AdminUserRespDTO;
 import com.baomidou.mybatisplus.generator.config.po.TableField;
 import com.baomidou.mybatisplus.generator.config.po.TableInfo;
+import org.junit.jupiter.api.Disabled;
 import org.junit.jupiter.api.Test;
 import org.springframework.boot.test.mock.mockito.MockBean;
 import org.springframework.context.annotation.Import;
@@ -234,6 +235,7 @@ public void testUpdateCodegen_success() {
     }
 
     @Test
+    @Disabled // TODO @芋艿：这个单测会随机性失败，需要定位下；
     public void testSyncCodegenFromDB() {
         // mock 数据（CodegenTableDO）
         CodegenTableDO table = randomPojo(CodegenTableDO.class, o -> o.setTableName("t_yunai")

File: yudao-module-mall/yudao-module-statistics-biz/src/main/java/cn/iocoder/yudao/module/statistics/dal/mysql/infra/ApiAccessLogStatisticsMapper.java
Patch:
@@ -16,12 +16,10 @@
 @SuppressWarnings("rawtypes")
 public interface ApiAccessLogStatisticsMapper extends BaseMapperX {
 
-    // TODO 芋艿：已经 review
     Integer selectIpCountByUserTypeAndCreateTimeBetween(@Param("userType") Integer userType,
                                                         @Param("beginTime") LocalDateTime beginTime,
                                                         @Param("endTime") LocalDateTime endTime);
 
-    // TODO 芋艿：已经 review
     Integer selectUserCountByUserTypeAndCreateTimeBetween(@Param("userType") Integer userType,
                                                           @Param("beginTime") LocalDateTime beginTime,
                                                           @Param("endTime") LocalDateTime endTime);

File: yudao-module-mall/yudao-module-statistics-biz/src/main/java/cn/iocoder/yudao/module/statistics/dal/mysql/trade/AfterSaleStatisticsMapper.java
Patch:
@@ -16,11 +16,9 @@
 @Mapper
 public interface AfterSaleStatisticsMapper extends BaseMapperX<TradeStatisticsDO> {
 
-    // TODO 芋艿：已 review
     AfterSaleSummaryRespBO selectSummaryByRefundTimeBetween(@Param("beginTime") LocalDateTime beginTime,
                                                             @Param("endTime") LocalDateTime endTime);
 
-    // TODO 芋艿：已经 review
     Long selectCountByStatus(@Param("status") Integer status);
 
 }

File: yudao-module-mall/yudao-module-statistics-biz/src/main/java/cn/iocoder/yudao/module/statistics/dal/mysql/trade/BrokerageStatisticsMapper.java
Patch:
@@ -15,13 +15,11 @@
 @Mapper
 public interface BrokerageStatisticsMapper extends BaseMapperX<TradeStatisticsDO> {
 
-    // TODO 芋艿：已经 review
     Integer selectSummaryPriceByStatusAndUnfreezeTimeBetween(@Param("bizType") Integer bizType,
                                                              @Param("status") Integer status,
                                                              @Param("beginTime") LocalDateTime beginTime,
                                                              @Param("endTime") LocalDateTime endTime);
 
-    // TODO 芋艿：已经 review
     Long selectWithdrawCountByStatus(@Param("status") Integer status);
 
 }

File: yudao-module-mall/yudao-module-statistics-biz/src/main/java/cn/iocoder/yudao/module/statistics/dal/mysql/trade/TradeStatisticsMapper.java
Patch:
@@ -25,17 +25,14 @@ TradeSummaryRespBO selectOrderCreateCountSumAndOrderPayPriceSumByTimeBetween(@Pa
     TradeTrendSummaryRespVO selectVoByTimeBetween(@Param("beginTime") LocalDateTime beginTime,
                                                   @Param("endTime") LocalDateTime endTime);
 
-    // TODO @芋艿：已经 review
     default List<TradeStatisticsDO> selectListByTimeBetween(LocalDateTime beginTime, LocalDateTime endTime) {
         return selectList(new LambdaQueryWrapperX<TradeStatisticsDO>()
                 .between(TradeStatisticsDO::getTime, beginTime, endTime));
     }
 
-    // TODO @芋艿：已经 review
     Integer selectExpensePriceByTimeBetween(@Param("beginTime") LocalDateTime beginTime,
                                             @Param("endTime") LocalDateTime endTime);
 
-    // TODO @芋艿：已经 review
     default TradeStatisticsDO selectByTimeBetween(LocalDateTime beginTime, LocalDateTime endTime) {
         return selectOne(new LambdaQueryWrapperX<TradeStatisticsDO>()
                 .between(TradeStatisticsDO::getTime, beginTime, endTime));

File: yudao-module-mall/yudao-module-statistics-biz/src/main/java/cn/iocoder/yudao/module/statistics/service/infra/ApiAccessLogStatisticsService.java
Patch:
@@ -9,7 +9,6 @@
  */
 public interface ApiAccessLogStatisticsService {
 
-    // TODO 芋艿：已经 review
     /**
      * 获取活跃用户数量
      *
@@ -20,7 +19,6 @@ public interface ApiAccessLogStatisticsService {
      */
     Integer getUserCount(Integer userType, LocalDateTime beginTime, LocalDateTime endTime);
 
-    // TODO 芋艿：已经 review
     /**
      * 获取访问用户数量
      *

File: yudao-module-mall/yudao-module-statistics-biz/src/main/java/cn/iocoder/yudao/module/statistics/service/pay/PayWalletStatisticsService.java
Patch:
@@ -12,7 +12,6 @@
  */
 public interface PayWalletStatisticsService {
 
-    // TODO 芋艿：已经 review
     /**
      * 获取钱包统计
      *
@@ -22,7 +21,6 @@ public interface PayWalletStatisticsService {
      */
     WalletSummaryRespBO getWalletSummary(LocalDateTime beginTime, LocalDateTime endTime);
 
-    // TODO 芋艿：已经 review
     /**
      * 获取钱包充值统计
      *
@@ -32,7 +30,6 @@ public interface PayWalletStatisticsService {
      */
     RechargeSummaryRespBO getUserRechargeSummary(LocalDateTime beginTime, LocalDateTime endTime);
 
-    // TODO 芋艿：已经 review
     /**
      * 获取充值金额合计
      *

File: yudao-module-mall/yudao-module-statistics-biz/src/main/java/cn/iocoder/yudao/module/statistics/service/trade/AfterSaleStatisticsService.java
Patch:
@@ -12,7 +12,6 @@
  */
 public interface AfterSaleStatisticsService {
 
-    // TODO 芋艿：已经 review
     /**
      * 获取售后单统计
      *
@@ -22,7 +21,6 @@ public interface AfterSaleStatisticsService {
      */
     AfterSaleSummaryRespBO getAfterSaleSummary(LocalDateTime beginTime, LocalDateTime endTime);
 
-    // TODO 芋艿：已经 review
     /**
      * 获取指定状态的售后订单数量
      *

File: yudao-module-mall/yudao-module-statistics-biz/src/main/java/cn/iocoder/yudao/module/statistics/service/trade/BrokerageStatisticsService.java
Patch:
@@ -11,7 +11,6 @@
  */
 public interface BrokerageStatisticsService {
 
-    // TODO 芋艿：已经 review
     /**
      * 获取已结算的佣金金额
      *
@@ -21,7 +20,6 @@ public interface BrokerageStatisticsService {
      */
     Integer getBrokerageSettlementPriceSummary(LocalDateTime beginTime, LocalDateTime endTime);
 
-    // TODO 芋艿：已经 review
     /**
      * 获取指定状态的提现记录数量
      *

File: yudao-module-mall/yudao-module-statistics-biz/src/main/java/cn/iocoder/yudao/module/statistics/service/trade/TradeStatisticsService.java
Patch:
@@ -41,15 +41,13 @@ DataComparisonRespVO<TradeTrendSummaryRespVO> getTradeStatisticsAnalyse(
      */
     List<TradeStatisticsDO> getTradeStatisticsList(LocalDateTime beginTime, LocalDateTime endTime);
 
-    // TODO 芋艿：已经 review；
     /**
      * 统计指定天数的交易数据
      *
      * @return 统计结果
      */
     String statisticsTrade(Integer days);
 
-    // TODO 芋艿：已经 review
     /**
      * 统计指定日期的交易数据
      *
@@ -58,7 +56,6 @@ DataComparisonRespVO<TradeTrendSummaryRespVO> getTradeStatisticsAnalyse(
      */
     TradeSummaryRespBO getTradeSummaryByDays(int days);
 
-    // TODO 芋艿：已经 review
     /**
      * 统计指定月份的交易数据
      *

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/enums/permission/RoleCodeEnum.java
Patch:
@@ -13,6 +13,7 @@ public enum RoleCodeEnum {
 
     SUPER_ADMIN("super_admin", "超级管理员"),
     TENANT_ADMIN("tenant_admin", "租户管理员"),
+    CRM_ADMIN("crm_admin", "CRM 管理员"); // CRM 系统专用
     ;
 
     /**

File: yudao-framework/yudao-spring-boot-starter-web/src/main/java/cn/iocoder/yudao/framework/desensitize/package-info.java
Patch:
@@ -1,4 +1,4 @@
 /**
  * 脱敏组件：支持 JSON 返回数据时，将邮箱、手机等字段进行脱敏
  */
-package cn.iocoder.yudao.framework.desensitize.core;
+package cn.iocoder.yudao.framework.desensitize;

File: yudao-module-pay/yudao-module-pay-api/src/main/java/cn/iocoder/yudao/module/pay/api/order/PayOrderApi.java
Patch:
@@ -8,7 +8,7 @@
 import io.swagger.v3.oas.annotations.Parameter;
 import io.swagger.v3.oas.annotations.Parameters;
 import io.swagger.v3.oas.annotations.tags.Tag;
-import jakarta.annotation.security.PermitAll;
+import javax.annotation.security.PermitAll;
 import org.springframework.cloud.openfeign.FeignClient;
 import org.springframework.web.bind.annotation.*;
 

File: yudao-module-pay/yudao-module-pay-api/src/main/java/cn/iocoder/yudao/module/pay/api/order/PayOrderApi.java
Patch:
@@ -8,7 +8,7 @@
 import io.swagger.v3.oas.annotations.Parameter;
 import io.swagger.v3.oas.annotations.Parameters;
 import io.swagger.v3.oas.annotations.tags.Tag;
-import jakarta.annotation.security.PermitAll;
+import javax.annotation.security.PermitAll;
 import org.springframework.cloud.openfeign.FeignClient;
 import org.springframework.web.bind.annotation.*;
 

File: yudao-framework/yudao-spring-boot-starter-file/src/main/java/cn/iocoder/yudao/framework/file/core/client/s3/S3FileClient.java
Patch:
@@ -81,7 +81,7 @@ private String buildRegion() {
         }
         // 腾讯云必须有 region，否则会报错
         if (config.getEndpoint().contains(ENDPOINT_TENCENT)) {
-            return StrUtil.subAfter(config.getEndpoint(), ".cos.", false)
+            return StrUtil.subAfter(config.getEndpoint(), "cos.", false)
                     .replaceAll("." + ENDPOINT_TENCENT, ""); // 去除 Endpoint
         }
         return null;

File: yudao-framework/yudao-spring-boot-starter-websocket/src/main/java/cn/iocoder/yudao/framework/websocket/core/session/WebSocketSessionManagerImpl.java
Patch:
@@ -66,7 +66,7 @@ public void addSession(WebSocketSession session) {
     @Override
     public void removeSession(WebSocketSession session) {
         // 移除从 idSessions 中
-        idSessions.remove(session.getId(), session);
+        idSessions.remove(session.getId());
         // 移除从 idSessions 中
         LoginUser user = WebSocketFrameworkUtils.getLoginUser(session);
         if (user == null) {

File: yudao-framework/yudao-spring-boot-starter-websocket/src/main/java/cn/iocoder/yudao/framework/websocket/core/session/WebSocketSessionManagerImpl.java
Patch:
@@ -66,7 +66,7 @@ public void addSession(WebSocketSession session) {
     @Override
     public void removeSession(WebSocketSession session) {
         // 移除从 idSessions 中
-        idSessions.remove(session.getId(), session);
+        idSessions.remove(session.getId());
         // 移除从 idSessions 中
         LoginUser user = WebSocketFrameworkUtils.getLoginUser(session);
         if (user == null) {

File: yudao-framework/yudao-spring-boot-starter-file/src/main/java/cn/iocoder/yudao/framework/file/core/client/s3/S3FileClient.java
Patch:
@@ -81,7 +81,7 @@ private String buildRegion() {
         }
         // 腾讯云必须有 region，否则会报错
         if (config.getEndpoint().contains(ENDPOINT_TENCENT)) {
-            return StrUtil.subAfter(config.getEndpoint(), ".cos.", false)
+            return StrUtil.subAfter(config.getEndpoint(), "cos.", false)
                     .replaceAll("." + ENDPOINT_TENCENT, ""); // 去除 Endpoint
         }
         return null;

File: yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/mapper/BaseMapperX.java
Patch:
@@ -28,7 +28,7 @@ public interface BaseMapperX<T> extends MPJBaseMapper<T> {
 
     default PageResult<T> selectPage(PageParam pageParam, @Param("ew") Wrapper<T> queryWrapper) {
         // 特殊：不分页，直接查询全部
-        if (PageParam.PAGE_SIZE_NONE.equals(pageParam.getPageNo())) {
+        if (PageParam.PAGE_SIZE_NONE.equals(pageParam.getPageSize())) {
             List<T> list = selectList(queryWrapper);
             return new PageResult<>(list, (long) list.size());
         }

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/logger/vo/apierrorlog/ApiErrorLogPageReqVO.java
Patch:
@@ -36,4 +36,4 @@ public class ApiErrorLogPageReqVO extends PageParam {
     @Schema(description = "处理状态", example = "0")
     private Integer processStatus;
 
-}
\ No newline at end of file
+}

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/errorcode/vo/ErrorCodePageReqVO.java
Patch:
@@ -33,4 +33,4 @@ public class ErrorCodePageReqVO extends PageParam {
     @Schema(description = "创建时间")
     private LocalDateTime[] createTime;
 
-}
\ No newline at end of file
+}

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/api/dict/DictDataApiImpl.java
Patch:
@@ -1,8 +1,8 @@
 package cn.iocoder.yudao.module.system.api.dict;
 
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
+import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.module.system.api.dict.dto.DictDataRespDTO;
-import cn.iocoder.yudao.module.system.convert.dict.DictDataConvert;
 import cn.iocoder.yudao.module.system.dal.dataobject.dict.DictDataDO;
 import cn.iocoder.yudao.module.system.service.dict.DictDataService;
 import org.springframework.validation.annotation.Validated;
@@ -29,13 +29,13 @@ public CommonResult<Boolean> validateDictDataList(String dictType, Collection<St
     @Override
     public CommonResult<DictDataRespDTO> getDictData(String dictType, String value) {
         DictDataDO dictData = dictDataService.getDictData(dictType, value);
-        return success(DictDataConvert.INSTANCE.convert02(dictData));
+        return success(BeanUtils.toBean(dictData, DictDataRespDTO.class));
     }
 
     @Override
     public CommonResult<DictDataRespDTO> parseDictData(String dictType, String label) {
         DictDataDO dictData = dictDataService.parseDictData(dictType, label);
-        return success(DictDataConvert.INSTANCE.convert02(dictData));
+        return success(BeanUtils.toBean(dictData, DictDataRespDTO.class));
     }
 
 }

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dict/vo/type/DictTypePageReqVO.java
Patch:
@@ -30,4 +30,4 @@ public class DictTypePageReqVO extends PageParam {
     @Schema(description = "创建时间")
     private LocalDateTime[] createTime;
 
-}
\ No newline at end of file
+}

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/app/dict/AppDictDataController.java
Patch:
@@ -1,8 +1,8 @@
 package cn.iocoder.yudao.module.system.controller.app.dict;
 
 import cn.iocoder.yudao.framework.common.pojo.CommonResult;
+import cn.iocoder.yudao.framework.common.util.object.BeanUtils;
 import cn.iocoder.yudao.module.system.controller.app.dict.vo.AppDictDataRespVO;
-import cn.iocoder.yudao.module.system.convert.dict.DictDataConvert;
 import cn.iocoder.yudao.module.system.dal.dataobject.dict.DictDataDO;
 import cn.iocoder.yudao.module.system.service.dict.DictDataService;
 import io.swagger.v3.oas.annotations.Operation;
@@ -33,7 +33,7 @@ public class AppDictDataController {
     @Parameter(name = "type", description = "字典类型", required = true, example = "common_status")
     public CommonResult<List<AppDictDataRespVO>> getDictDataListByType(@RequestParam("type") String type) {
         List<DictDataDO> list = dictDataService.getEnabledDictDataListByType(type);
-        return success(DictDataConvert.INSTANCE.convertList03(list));
+        return success(BeanUtils.toBean(list, AppDictDataRespVO.class));
     }
 
 }

File: yudao-framework/yudao-spring-boot-starter-websocket/src/main/java/cn/iocoder/yudao/framework/websocket/core/session/WebSocketSessionManagerImpl.java
Patch:
@@ -66,7 +66,7 @@ public void addSession(WebSocketSession session) {
     @Override
     public void removeSession(WebSocketSession session) {
         // 移除从 idSessions 中
-        idSessions.remove(session.getId(), session);
+        idSessions.remove(session.getId());
         // 移除从 idSessions 中
         LoginUser user = WebSocketFrameworkUtils.getLoginUser(session);
         if (user == null) {

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/user/AdminUserServiceImpl.java
Patch:
@@ -117,7 +117,7 @@ private void updateUserPost(UserUpdateReqVO reqVO, AdminUserDO updateObj) {
         Long userId = reqVO.getId();
         Set<Long> dbPostIds = convertSet(userPostMapper.selectListByUserId(userId), UserPostDO::getPostId);
         // 计算新增和删除的岗位编号
-        Set<Long> postIds = updateObj.getPostIds();
+        Set<Long> postIds = CollUtil.emptyIfNull(updateObj.getPostIds());
         Collection<Long> createPostIds = CollUtil.subtract(postIds, dbPostIds);
         Collection<Long> deletePostIds = CollUtil.subtract(dbPostIds, postIds);
         // 执行新增和删除。对于已经授权的菜单，不用做任何处理

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/user/AdminUserServiceImpl.java
Patch:
@@ -117,7 +117,7 @@ private void updateUserPost(UserUpdateReqVO reqVO, AdminUserDO updateObj) {
         Long userId = reqVO.getId();
         Set<Long> dbPostIds = convertSet(userPostMapper.selectListByUserId(userId), UserPostDO::getPostId);
         // 计算新增和删除的岗位编号
-        Set<Long> postIds = updateObj.getPostIds();
+        Set<Long> postIds = CollUtil.emptyIfNull(updateObj.getPostIds());
         Collection<Long> createPostIds = CollUtil.subtract(postIds, dbPostIds);
         Collection<Long> deletePostIds = CollUtil.subtract(dbPostIds, postIds);
         // 执行新增和删除。对于已经授权的菜单，不用做任何处理

File: yudao-framework/yudao-spring-boot-starter-security/src/main/java/cn/iocoder/yudao/framework/security/config/YudaoWebSecurityConfigurerAdapter.java
Patch:
@@ -11,6 +11,7 @@
 import org.springframework.security.authentication.AuthenticationManager;
 import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;
 import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;
+import org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;
 import org.springframework.security.config.annotation.web.builders.HttpSecurity;
 import org.springframework.security.config.http.SessionCreationPolicy;
 import org.springframework.security.web.AuthenticationEntryPoint;
@@ -33,7 +34,7 @@
  * @author 芋道源码
  */
 @AutoConfiguration
-@EnableGlobalMethodSecurity(prePostEnabled = true, securedEnabled = true)
+@EnableMethodSecurity(securedEnabled = true)
 public class YudaoWebSecurityConfigurerAdapter {
 
     @Resource

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/sms/SmsTemplateServiceImpl.java
Patch:
@@ -54,8 +54,6 @@ public class SmsTemplateServiceImpl implements SmsTemplateService {
     @Resource
     private SmsChannelService smsChannelService;
 
-    @Resource
-    private SmsClientFactory smsClientFactory;
 
     @Override
     public Long createSmsTemplate(SmsTemplateCreateReqVO createReqVO) {
@@ -174,7 +172,7 @@ public void validateSmsTemplateCodeDuplicate(Long id, String code) {
     @VisibleForTesting
     void validateApiTemplate(Long channelId, String apiTemplateId) {
         // 获得短信模板
-        SmsClient smsClient = smsClientFactory.getSmsClient(channelId);
+        SmsClient smsClient = smsChannelService.getSmsClient(channelId);
         Assert.notNull(smsClient, String.format("短信客户端(%d) 不存在", channelId));
         SmsCommonResult<SmsTemplateRespDTO> templateResult = smsClient.getSmsTemplate(apiTemplateId);
         // 校验短信模板是否正确

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/sms/SmsTemplateServiceImpl.java
Patch:
@@ -54,8 +54,6 @@ public class SmsTemplateServiceImpl implements SmsTemplateService {
     @Resource
     private SmsChannelService smsChannelService;
 
-    @Resource
-    private SmsClientFactory smsClientFactory;
 
     @Override
     public Long createSmsTemplate(SmsTemplateCreateReqVO createReqVO) {
@@ -174,7 +172,7 @@ public void validateSmsTemplateCodeDuplicate(Long id, String code) {
     @VisibleForTesting
     void validateApiTemplate(Long channelId, String apiTemplateId) {
         // 获得短信模板
-        SmsClient smsClient = smsClientFactory.getSmsClient(channelId);
+        SmsClient smsClient = smsChannelService.getSmsClient(channelId);
         Assert.notNull(smsClient, String.format("短信客户端(%d) 不存在", channelId));
         SmsCommonResult<SmsTemplateRespDTO> templateResult = smsClient.getSmsTemplate(apiTemplateId);
         // 校验短信模板是否正确

File: yudao-module-infra/yudao-module-infra-api/src/main/java/cn/iocoder/yudao/module/infra/api/file/dto/FileCreateReqDTO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.infra.api.file.dto;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-infra/yudao-module-infra-api/src/main/java/cn/iocoder/yudao/module/infra/api/logger/dto/ApiAccessLogCreateReqDTO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.infra.api.logger.dto;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-infra/yudao-module-infra-api/src/main/java/cn/iocoder/yudao/module/infra/api/logger/dto/ApiErrorLogCreateReqDTO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.infra.api.logger.dto;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/codegen/vo/CodegenCreateListReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.infra.controller.admin.codegen.vo;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/codegen/vo/CodegenDetailRespVO.java
Patch:
@@ -3,7 +3,6 @@
 import cn.iocoder.yudao.module.infra.controller.admin.codegen.vo.column.CodegenColumnRespVO;
 import cn.iocoder.yudao.module.infra.controller.admin.codegen.vo.table.CodegenTableRespVO;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 
 import java.util.List;

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/codegen/vo/CodegenPreviewRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.infra.controller.admin.codegen.vo;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/codegen/vo/CodegenUpdateReqVO.java
Patch:
@@ -5,7 +5,6 @@
 import cn.iocoder.yudao.module.infra.controller.admin.codegen.vo.table.CodegenTableBaseVO;
 import cn.iocoder.yudao.module.infra.enums.codegen.CodegenSceneEnum;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;
 import lombok.ToString;

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/codegen/vo/column/CodegenColumnRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.infra.controller.admin.codegen.vo.column;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/codegen/vo/table/CodegenTableRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.infra.controller.admin.codegen.vo.table;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/codegen/vo/table/DatabaseTableRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.infra.controller.admin.codegen.vo.table;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/config/vo/ConfigCreateReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.infra.controller.admin.config.vo;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/config/vo/ConfigRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.infra.controller.admin.config.vo;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/config/vo/ConfigUpdateReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.infra.controller.admin.config.vo;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/file/vo/config/FileConfigCreateReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.infra.controller.admin.file.vo.config;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/file/vo/config/FileConfigPageReqVO.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;
 import lombok.ToString;

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/file/vo/config/FileConfigRespVO.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.framework.file.core.client.FileClientConfig;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;
 import lombok.ToString;

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/file/vo/config/FileConfigUpdateReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.infra.controller.admin.file.vo.config;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/file/vo/file/FilePageReqVO.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;
 import lombok.ToString;

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/file/vo/file/FileUploadReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.infra.controller.admin.file.vo.file;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import org.springframework.web.multipart.MultipartFile;

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/logger/vo/apierrorlog/ApiErrorLogPageReqVO.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;
 import lombok.ToString;

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/logger/vo/apierrorlog/ApiErrorLogRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.infra.controller.admin.logger.vo.apierrorlog;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/dict/dto/DictDataRespDTO.java
Patch:
@@ -1,7 +1,5 @@
 package cn.iocoder.yudao.module.system.api.dict.dto;
 
-import cn.iocoder.yudao.framework.common.enums.CommonStatusEnum;
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/logger/dto/OperateLogCreateReqDTO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.api.logger.dto;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/mail/dto/MailSendSingleToUserReqDTO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.api.mail.dto;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/notify/dto/NotifySendSingleToUserReqDTO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.api.notify.dto;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/oauth2/dto/OAuth2AccessTokenCheckRespDTO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.api.oauth2.dto;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/oauth2/dto/OAuth2AccessTokenCreateReqDTO.java
Patch:
@@ -3,7 +3,6 @@
 import cn.iocoder.yudao.framework.common.enums.UserTypeEnum;
 import cn.iocoder.yudao.framework.common.validation.InEnum;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 
 import javax.validation.constraints.NotNull;

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/oauth2/dto/OAuth2AccessTokenRespDTO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.api.oauth2.dto;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.experimental.Accessors;

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/sms/dto/code/SmsCodeSendReqDTO.java
Patch:
@@ -4,7 +4,6 @@
 import cn.iocoder.yudao.framework.common.validation.Mobile;
 import cn.iocoder.yudao.module.system.enums.sms.SmsSceneEnum;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 
 import javax.validation.constraints.NotEmpty;

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/sms/dto/code/SmsCodeUseReqDTO.java
Patch:
@@ -4,7 +4,6 @@
 import cn.iocoder.yudao.framework.common.validation.Mobile;
 import cn.iocoder.yudao.module.system.enums.sms.SmsSceneEnum;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 
 import javax.validation.constraints.NotEmpty;

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/sms/dto/code/SmsCodeValidateReqDTO.java
Patch:
@@ -4,7 +4,6 @@
 import cn.iocoder.yudao.framework.common.validation.Mobile;
 import cn.iocoder.yudao.module.system.enums.sms.SmsSceneEnum;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 
 import javax.validation.constraints.NotEmpty;

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/sms/dto/send/SmsSendSingleToUserReqDTO.java
Patch:
@@ -2,11 +2,9 @@
 
 import cn.iocoder.yudao.framework.common.validation.Mobile;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 
 import javax.validation.constraints.NotEmpty;
-import javax.validation.constraints.NotNull;
 import java.util.Map;
 
 @Schema(description = "RPC 服务 - 短信发送给 Admin 或者 Member 用户 Request DTO")

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/auth/vo/AuthLoginRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.auth.vo;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.AllArgsConstructor;
 import lombok.Builder;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/auth/vo/AuthSmsLoginReqVO.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.framework.common.validation.Mobile;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.AllArgsConstructor;
 import lombok.Builder;
 import lombok.Data;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/auth/vo/AuthSmsSendReqVO.java
Patch:
@@ -4,7 +4,6 @@
 import cn.iocoder.yudao.framework.common.validation.Mobile;
 import cn.iocoder.yudao.module.system.enums.sms.SmsSceneEnum;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.AllArgsConstructor;
 import lombok.Builder;
 import lombok.Data;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/auth/vo/AuthSocialLoginReqVO.java
Patch:
@@ -3,7 +3,6 @@
 import cn.iocoder.yudao.framework.common.validation.InEnum;
 import cn.iocoder.yudao.module.system.enums.social.SocialTypeEnum;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.AllArgsConstructor;
 import lombok.Builder;
 import lombok.Data;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dept/vo/dept/DeptListReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.dept.vo.dept;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dept/vo/dept/DeptRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.dept.vo.dept;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dept/vo/dept/DeptSimpleRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.dept.vo.dept;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.AllArgsConstructor;
 import lombok.Data;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dept/vo/dept/DeptUpdateReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.dept.vo.dept;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dept/vo/post/PostExportReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.dept.vo.post;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dept/vo/post/PostListReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.dept.vo.post;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dept/vo/post/PostPageReqVO.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dept/vo/post/PostRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.dept.vo.post;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dept/vo/post/PostSimpleRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.dept.vo.post;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.AllArgsConstructor;
 import lombok.Data;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dept/vo/post/PostUpdateReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.dept.vo.post;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dict/vo/data/DictDataExportReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.dict.vo.data;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dict/vo/data/DictDataPageReqVO.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dict/vo/data/DictDataRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.dict.vo.data;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.AllArgsConstructor;
 import lombok.Data;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dict/vo/data/DictDataUpdateReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.dict.vo.data;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dict/vo/type/DictTypeCreateReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.dict.vo.type;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dict/vo/type/DictTypeExportReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.dict.vo.type;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import org.springframework.format.annotation.DateTimeFormat;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dict/vo/type/DictTypePageReqVO.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;
 import org.springframework.format.annotation.DateTimeFormat;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dict/vo/type/DictTypeRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.dict.vo.type;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.AllArgsConstructor;
 import lombok.Data;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dict/vo/type/DictTypeSimpleRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.dict.vo.type;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.AllArgsConstructor;
 import lombok.Data;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dict/vo/type/DictTypeUpdateReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.dict.vo.type;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/errorcode/vo/ErrorCodeExportReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.errorcode.vo;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import org.springframework.format.annotation.DateTimeFormat;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/errorcode/vo/ErrorCodePageReqVO.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;
 import lombok.ToString;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/errorcode/vo/ErrorCodeRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.errorcode.vo;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/errorcode/vo/ErrorCodeUpdateReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.errorcode.vo;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/mail/vo/account/MailAccountPageReqVO.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;
 import lombok.ToString;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/mail/vo/account/MailAccountSimpleRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.mail.vo.account;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/mail/vo/account/MailAccountUpdateReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.mail.vo.account;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/mail/vo/log/MailLogRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.mail.vo.log;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/mail/vo/template/MailTemplatePageReqVO.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;
 import lombok.ToString;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/mail/vo/template/MailTemplateRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.mail.vo.template;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/mail/vo/template/MailTemplateSendReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.mail.vo.template;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/mail/vo/template/MailTemplateSimpleRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.mail.vo.template;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/mail/vo/template/MailTemplateUpdateReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.mail.vo.template;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/notice/vo/NoticePageReqVO.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/notice/vo/NoticeRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.notice.vo;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/notice/vo/NoticeUpdateReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.notice.vo;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/oauth2/vo/client/OAuth2ClientRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.oauth2.vo.client;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/oauth2/vo/client/OAuth2ClientUpdateReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.oauth2.vo.client;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/oauth2/vo/open/OAuth2OpenAccessTokenRespVO.java
Patch:
@@ -2,7 +2,6 @@
 
 import com.fasterxml.jackson.annotation.JsonProperty;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.AllArgsConstructor;
 import lombok.Data;
 import lombok.NoArgsConstructor;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/oauth2/vo/open/OAuth2OpenAuthorizeInfoRespVO.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.framework.common.core.KeyValue;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.AllArgsConstructor;
 import lombok.Data;
 import lombok.NoArgsConstructor;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/oauth2/vo/token/OAuth2AccessTokenPageReqVO.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/oauth2/vo/token/OAuth2AccessTokenRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.oauth2.vo.token;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.AllArgsConstructor;
 import lombok.Data;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/oauth2/vo/user/OAuth2UserUpdateReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.oauth2.vo.user;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.AllArgsConstructor;
 import lombok.Data;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/permission/vo/menu/MenuListReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.permission.vo.menu;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/permission/vo/menu/MenuRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.permission.vo.menu;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.AllArgsConstructor;
 import lombok.Data;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/permission/vo/menu/MenuSimpleRespVO.java
Patch:
@@ -1,13 +1,10 @@
 package cn.iocoder.yudao.module.system.controller.admin.permission.vo.menu;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.AllArgsConstructor;
 import lombok.Data;
 import lombok.NoArgsConstructor;
 
-import javax.validation.constraints.NotNull;
-
 @Schema(description = "管理后台 - 菜单精简信息 Response VO")
 @Data
 @NoArgsConstructor

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/permission/vo/menu/MenuUpdateReqVO.java
Patch:
@@ -1,8 +1,8 @@
 package cn.iocoder.yudao.module.system.controller.admin.permission.vo.menu;
 
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
-import lombok.*;
+import lombok.Data;
+import lombok.EqualsAndHashCode;
 
 import javax.validation.constraints.NotNull;
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/permission/vo/permission/PermissionAssignRoleDataScopeReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.permission.vo.permission;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/permission/vo/permission/PermissionAssignRoleMenuReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.permission.vo.permission;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/permission/vo/role/RoleExportReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.permission.vo.role;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import org.springframework.format.annotation.DateTimeFormat;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/permission/vo/role/RoleRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.permission.vo.role;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.AllArgsConstructor;
 import lombok.Data;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/permission/vo/role/RoleSimpleRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.permission.vo.role;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.AllArgsConstructor;
 import lombok.Data;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/permission/vo/role/RoleUpdateReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.permission.vo.role;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/sensitiveword/vo/SensitiveWordExportReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.sensitiveword.vo;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import org.springframework.format.annotation.DateTimeFormat;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/sensitiveword/vo/SensitiveWordPageReqVO.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;
 import lombok.ToString;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/sensitiveword/vo/SensitiveWordRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.sensitiveword.vo;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/sensitiveword/vo/SensitiveWordUpdateReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.sensitiveword.vo;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/sms/vo/channel/SmsChannelRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.sms.vo.channel;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/sms/vo/channel/SmsChannelUpdateReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.sms.vo.channel;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/sms/vo/log/SmsLogExportReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.sms.vo.log;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import org.springframework.format.annotation.DateTimeFormat;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/sms/vo/log/SmsLogRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.sms.vo.log;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/sms/vo/template/SmsTemplateExportReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.sms.vo.template;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import org.springframework.format.annotation.DateTimeFormat;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/sms/vo/template/SmsTemplatePageReqVO.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;
 import lombok.ToString;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/sms/vo/template/SmsTemplateRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.sms.vo.template;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/sms/vo/template/SmsTemplateSendReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.sms.vo.template;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/sms/vo/template/SmsTemplateUpdateReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.sms.vo.template;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/tenant/vo/packages/TenantPackagePageReqVO.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;
 import lombok.ToString;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/tenant/vo/packages/TenantPackageRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.tenant.vo.packages;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/tenant/vo/packages/TenantPackageSimpleRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.tenant.vo.packages;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/tenant/vo/tenant/TenantPageReqVO.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.framework.common.pojo.PageParam;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;
 import lombok.ToString;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/tenant/vo/tenant/TenantRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.tenant.vo.tenant;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/user/vo/profile/UserProfileRespVO.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.module.system.controller.admin.user.vo.user.UserBaseVO;
 import io.swagger.v3.oas.annotations.media.Schema;
-import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.AllArgsConstructor;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/user/vo/profile/UserProfileUpdatePasswordReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.user.vo.profile;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import org.hibernate.validator.constraints.Length;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/user/vo/user/UserCreateReqVO.java
Patch:
@@ -1,7 +1,6 @@
 package cn.iocoder.yudao.module.system.controller.admin.user.vo.user;
 
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/user/vo/user/UserImportRespVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.user.vo.user;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Builder;
 import lombok.Data;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/user/vo/user/UserUpdateReqVO.java
Patch:
@@ -1,6 +1,5 @@
 package cn.iocoder.yudao.module.system.controller.admin.user.vo.user;
 
-import io.swagger.v3.oas.annotations.media.Schema;
 import io.swagger.v3.oas.annotations.media.Schema;
 import lombok.Data;
 import lombok.EqualsAndHashCode;

File: yudao-module-report/yudao-module-report-api/src/main/java/cn/iocoder/yudao/module/report/enums/ErrorCodeConstants.java
Patch:
@@ -9,7 +9,7 @@
  */
 public interface ErrorCodeConstants {
 
-    // ========== AUTH 模块 1003000000 ==========
-    ErrorCode GO_VIEW_PROJECT_NOT_EXISTS = new ErrorCode(1003000000, "GoView 项目不存在");
+    // ========== AUTH 模块 1-003-000-000 ==========
+    ErrorCode GO_VIEW_PROJECT_NOT_EXISTS = new ErrorCode(1_003_000_000, "GoView 项目不存在");
 
 }

File: yudao-module-report/yudao-module-report-api/src/main/java/cn/iocoder/yudao/module/report/enums/ErrorCodeConstants.java
Patch:
@@ -9,7 +9,7 @@
  */
 public interface ErrorCodeConstants {
 
-    // ========== AUTH 模块 1003000000 ==========
-    ErrorCode GO_VIEW_PROJECT_NOT_EXISTS = new ErrorCode(1003000000, "GoView 项目不存在");
+    // ========== AUTH 模块 1-003-000-000 ==========
+    ErrorCode GO_VIEW_PROJECT_NOT_EXISTS = new ErrorCode(1_003_000_000, "GoView 项目不存在");
 
 }

File: yudao-framework/yudao-spring-boot-starter-biz-data-permission/src/main/java/cn/iocoder/yudao/framework/datapermission/core/db/DataPermissionDatabaseInterceptor.java
Patch:
@@ -507,6 +507,9 @@ private Expression buildDataPermissionExpression(Table table) {
             // 单条规则的条件
             String tableName = MyBatisUtils.getTableName(table);
             Expression oneExpress = rule.getExpression(tableName, table.getAlias());
+            if(oneExpress == null){
+                continue;
+            }
             // 拼接到 allExpression 中
             allExpression = allExpression == null ? oneExpress
                     : new AndExpression(allExpression, oneExpress);

File: yudao-framework/yudao-spring-boot-starter-biz-data-permission/src/main/java/cn/iocoder/yudao/framework/datapermission/core/db/DataPermissionDatabaseInterceptor.java
Patch:
@@ -507,6 +507,9 @@ private Expression buildDataPermissionExpression(Table table) {
             // 单条规则的条件
             String tableName = MyBatisUtils.getTableName(table);
             Expression oneExpress = rule.getExpression(tableName, table.getAlias());
+            if(oneExpress == null){
+                continue;
+            }
             // 拼接到 allExpression 中
             allExpression = allExpression == null ? oneExpress
                     : new AndExpression(allExpression, oneExpress);

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/permission/MenuServiceImpl.java
Patch:
@@ -47,7 +47,8 @@ public class MenuServiceImpl implements MenuService {
     private TenantService tenantService;
 
     @Override
-    @CacheEvict(value = RedisKeyConstants.PERMISSION_MENU_ID_LIST, key = "#reqVO.permission")
+    @CacheEvict(value = RedisKeyConstants.PERMISSION_MENU_ID_LIST, key = "#reqVO.permission",
+            condition = "#reqVO.permission != null")
     public Long createMenu(MenuCreateReqVO reqVO) {
         // 校验父菜单存在
         validateParentMenu(reqVO.getParentId(), null);

File: yudao-module-report/yudao-module-report-api/src/main/java/cn/iocoder/yudao/module/report/enums/ErrorCodeConstants.java
Patch:
@@ -5,7 +5,7 @@
 /**
  * Report 错误码枚举类
  *
- * system 系统，使用 1-003-000-000 段
+ * report 系统，使用 1-003-000-000 段
  */
 public interface ErrorCodeConstants {
 

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/enums/ErrorCodeConstants.java
Patch:
@@ -152,7 +152,7 @@ public interface ErrorCodeConstants {
 
     // ========== 邮件发送 1002025000 ==========
     ErrorCode MAIL_SEND_TEMPLATE_PARAM_MISS = new ErrorCode(1002025000, "模板参数({})缺失");
-    ErrorCode MAIL_SEND_MAIL_NOT_EXISTS = new ErrorCode(1002025000, "邮箱不存在");
+    ErrorCode MAIL_SEND_MAIL_NOT_EXISTS = new ErrorCode(1002025001, "邮箱不存在");
 
     // ========== 站内信模版 1002026000 ==========
     ErrorCode NOTIFY_TEMPLATE_NOT_EXISTS = new ErrorCode(1002026000, "站内信模版不存在");
@@ -161,6 +161,6 @@ public interface ErrorCodeConstants {
     // ========== 站内信模版 1002027000 ==========
 
     // ========== 站内信发送 1002028000 ==========
-    ErrorCode NOTIFY_SEND_TEMPLATE_PARAM_MISS = new ErrorCode(1002025000, "模板参数({})缺失");
+    ErrorCode NOTIFY_SEND_TEMPLATE_PARAM_MISS = new ErrorCode(1002028000, "模板参数({})缺失");
 
 }

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/sensitiveword/vo/SensitiveWordExcelVO.java
Patch:
@@ -2,6 +2,7 @@
 
 import cn.iocoder.yudao.framework.excel.core.annotations.DictFormat;
 import cn.iocoder.yudao.framework.excel.core.convert.DictConvert;
+import cn.iocoder.yudao.framework.excel.core.convert.JsonConvert;
 import cn.iocoder.yudao.module.system.enums.DictTypeConstants;
 import com.alibaba.excel.annotation.ExcelProperty;
 import lombok.Data;
@@ -23,7 +24,7 @@ public class SensitiveWordExcelVO {
     @ExcelProperty("敏感词")
     private String name;
 
-    @ExcelProperty("标签")
+    @ExcelProperty(value = "标签", converter = JsonConvert.class)
     private List<String> tags;
 
     @ExcelProperty(value = "状态", converter = DictConvert.class)

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/dal/dataobject/dict/DictDataDO.java
Patch:
@@ -2,9 +2,7 @@
 
 import cn.iocoder.yudao.framework.common.enums.CommonStatusEnum;
 import cn.iocoder.yudao.framework.mybatis.core.dataobject.BaseDO;
-import com.baomidou.mybatisplus.annotation.KeySequence;
-import com.baomidou.mybatisplus.annotation.TableId;
-import com.baomidou.mybatisplus.annotation.TableName;
+import com.baomidou.mybatisplus.annotation.*;
 import lombok.Data;
 import lombok.EqualsAndHashCode;
 
@@ -57,6 +55,7 @@ public class DictDataDO extends BaseDO {
     /**
      * css 样式
      */
+    @TableField(updateStrategy = FieldStrategy.IGNORED)
     private String cssClass;
     /**
      * 备注

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/controller/admin/config/vo/ConfigBaseVO.java
Patch:
@@ -30,11 +30,11 @@ public class ConfigBaseVO {
     @Size(max = 500, message = "参数键值长度不能超过500个字符")
     private String value;
 
-    @Schema(description = "是否敏感", required = true, example = "true")
-    @NotNull(message = "是否敏感不能为空")
+    @Schema(description = "是否可见", required = true, example = "true")
+    @NotNull(message = "是否可见不能为空")
     private Boolean visible;
 
     @Schema(description = "备注", example = "备注一下很帅气！")
     private String remark;
 
-}
\ No newline at end of file
+}

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/dal/mysql/codegen/CodegenTableMapper.java
Patch:
@@ -21,6 +21,7 @@ default PageResult<CodegenTableDO> selectPage(CodegenTablePageReqVO pageReqVO) {
         return selectPage(pageReqVO, new LambdaQueryWrapperX<CodegenTableDO>()
                 .likeIfPresent(CodegenTableDO::getTableName, pageReqVO.getTableName())
                 .likeIfPresent(CodegenTableDO::getTableComment, pageReqVO.getTableComment())
+                .likeIfPresent(CodegenTableDO::getClassName, pageReqVO.getClassName())
                 .betweenIfPresent(CodegenTableDO::getCreateTime, pageReqVO.getCreateTime()));
     }
 

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/enums/ErrorCodeConstants.java
Patch:
@@ -103,6 +103,7 @@ public interface ErrorCodeConstants {
     ErrorCode TENANT_DISABLE = new ErrorCode(1002015001, "名字为【{}】的租户已被禁用");
     ErrorCode TENANT_EXPIRE = new ErrorCode(1002015002, "名字为【{}】的租户已过期");
     ErrorCode TENANT_CAN_NOT_UPDATE_SYSTEM = new ErrorCode(1002015003, "系统租户不能进行修改、删除等操作！");
+    ErrorCode TENANT_NAME_DUPLICATE = new ErrorCode(1002015004, "已经存在该名称的租户");
 
     // ========== 租户套餐 1002016000 ==========
     ErrorCode TENANT_PACKAGE_NOT_EXISTS = new ErrorCode(1002016000, "租户套餐不存在");

File: yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/convert/task/BpmTaskConvert.java
Patch:
@@ -135,6 +135,8 @@ default List<BpmTaskRespVO> convertList3(List<HistoricTaskInstance> tasks,
     }
 
     @Mapping(source = "taskDefinitionKey", target = "definitionKey")
+    @Mapping(target = "createTime", expression = "java(bean.getCreateTime() == null ? null : LocalDateTime.ofInstant(bean.getCreateTime().toInstant(), ZoneId.systemDefault()))")
+    @Mapping(target = "endTime", expression = "java(bean.getEndTime() == null ? null : LocalDateTime.ofInstant(bean.getEndTime().toInstant(), ZoneId.systemDefault()))")
     BpmTaskRespVO convert3(HistoricTaskInstance bean);
 
     BpmTaskRespVO.User convert3(AdminUserRespDTO bean);

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/dal/dataobject/sms/SmsCodeDO.java
Patch:
@@ -26,7 +26,7 @@ public class SmsCodeDO extends BaseDO {
     /**
      * 编号
      */
-    private Integer id;
+    private Long id;
     /**
      * 手机号
      */

File: yudao-framework/yudao-spring-boot-starter-biz-ip/src/main/java/cn/iocoder/yudao/framework/ip/core/utils/IPUtils.java
Patch:
@@ -51,7 +51,7 @@ private IPUtils() {
      */
     @SneakyThrows
     public static Integer getAreaId(String ip) {
-        return Integer.parseInt(SEARCHER.search(ip));
+        return Integer.parseInt(SEARCHER.search(ip.trim()));
     }
 
     /**

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/ip/AreaController.java
Patch:
@@ -39,7 +39,7 @@ public CommonResult<List<AreaNodeRespVO>> getAreaTree() {
     @Parameter(name = "ip", description = "IP", required = true)
     public CommonResult<String> getAreaByIp(@RequestParam("ip") String ip) {
         // 获得城市
-        Area area = IPUtils.getArea(ip.trim());
+        Area area = IPUtils.getArea(ip);
         if (area == null) {
             return success("未知");
         }

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/ip/AreaController.java
Patch:
@@ -39,7 +39,7 @@ public CommonResult<List<AreaNodeRespVO>> getAreaTree() {
     @Parameter(name = "ip", description = "IP", required = true)
     public CommonResult<String> getAreaByIp(@RequestParam("ip") String ip) {
         // 获得城市
-        Area area = IPUtils.getArea(ip);
+        Area area = IPUtils.getArea(ip.trim());
         if (area == null) {
             return success("未知");
         }

File: yudao-framework/yudao-spring-boot-starter-biz-error-code/src/main/java/cn/iocoder/yudao/framework/errorcode/core/generator/ErrorCodeAutoGeneratorImpl.java
Patch:
@@ -49,7 +49,7 @@ public void execute() {
         log.info("[execute][解析到错误码数量为 ({}) 个]", autoGenerateDTOs.size());
 
         // 第二步，写入到 system 服务
-        errorCodeApi.autoGenerateErrorCodes(autoGenerateDTOs).checkError();
+        errorCodeApi.autoGenerateErrorCodeList(autoGenerateDTOs).checkError();
         log.info("[execute][写入到 system 组件完成]");
     }
 

File: yudao-framework/yudao-spring-boot-starter-biz-tenant/src/main/java/cn/iocoder/yudao/framework/tenant/core/service/TenantFrameworkServiceImpl.java
Patch:
@@ -30,7 +30,7 @@ public class TenantFrameworkServiceImpl implements TenantFrameworkService {
 
                 @Override
                 public List<Long> load(Object key) {
-                    return tenantApi.getTenantIds().getCheckedData();
+                    return tenantApi.getTenantIdList().getCheckedData();
                 }
 
             });

File: yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/service/definition/BpmTaskAssignRuleServiceImpl.java
Patch:
@@ -220,7 +220,7 @@ private void validTaskAssignRuleOptions(Integer type, Set<Long> options) {
         } else if (Objects.equals(type, BpmTaskAssignRuleTypeEnum.POST.getType())) {
             postApi.validPostList(options);
         } else if (Objects.equals(type, BpmTaskAssignRuleTypeEnum.USER.getType())) {
-            adminUserApi.validUsers(options);
+            adminUserApi.validUserList(options);
         } else if (Objects.equals(type, BpmTaskAssignRuleTypeEnum.USER_GROUP.getType())) {
             userGroupService.validUserGroups(options);
         } else if (Objects.equals(type, BpmTaskAssignRuleTypeEnum.SCRIPT.getType())) {
@@ -288,7 +288,7 @@ private Set<Long> calculateTaskCandidateUsersByRole(BpmTaskAssignRuleDO rule) {
     }
 
     private Set<Long> calculateTaskCandidateUsersByDeptMember(BpmTaskAssignRuleDO rule) {
-        List<AdminUserRespDTO> users = adminUserApi.getUsersByDeptIds(rule.getOptions()).getCheckedData();
+        List<AdminUserRespDTO> users = adminUserApi.getUserListByDeptIds(rule.getOptions()).getCheckedData();
         return convertSet(users, AdminUserRespDTO::getId);
     }
 
@@ -298,7 +298,7 @@ private Set<Long> calculateTaskCandidateUsersByDeptLeader(BpmTaskAssignRuleDO ru
     }
 
     private Set<Long> calculateTaskCandidateUsersByPost(BpmTaskAssignRuleDO rule) {
-        List<AdminUserRespDTO> users = adminUserApi.getUsersByPostIds(rule.getOptions()).getCheckedData();
+        List<AdminUserRespDTO> users = adminUserApi.getUserListByPostIds(rule.getOptions()).getCheckedData();
         return convertSet(users, AdminUserRespDTO::getId);
     }
 

File: yudao-module-bpm/yudao-module-bpm-biz/src/test/java/cn/iocoder/yudao/module/bpm/service/definition/BpmTaskAssignRuleServiceImplTest.java
Patch:
@@ -87,7 +87,7 @@ public void testCalculateTaskCandidateUsers_DeptMember() {
         // mock 方法
         List<AdminUserRespDTO> users = CollectionUtils.convertList(asSet(11L, 22L),
                 id -> new AdminUserRespDTO().setId(id));
-        when(adminUserApi.getUsersByDeptIds(eq(rule.getOptions()))).thenReturn(success(users));
+        when(adminUserApi.getUserListByDeptIds(eq(rule.getOptions()))).thenReturn(success(users));
         mockGetUserMap(asSet(11L, 22L));
 
         // 调用
@@ -121,7 +121,7 @@ public void testCalculateTaskCandidateUsers_Post() {
         // mock 方法
         List<AdminUserRespDTO> users = CollectionUtils.convertList(asSet(11L, 22L),
                 id -> new AdminUserRespDTO().setId(id));
-        when(adminUserApi.getUsersByPostIds(eq(rule.getOptions()))).thenReturn(success(users));
+        when(adminUserApi.getUserListByPostIds(eq(rule.getOptions()))).thenReturn(success(users));
         mockGetUserMap(asSet(11L, 22L));
 
         // 调用

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/service/db/DataSourceConfigServiceImpl.java
Patch:
@@ -37,7 +37,7 @@ public class DataSourceConfigServiceImpl implements DataSourceConfigService {
     @Override
     public Long createDataSourceConfig(DataSourceConfigCreateReqVO createReqVO) {
         DataSourceConfigDO dataSourceConfig = DataSourceConfigConvert.INSTANCE.convert(createReqVO);
-        checkConnectionOK(dataSourceConfig);
+        validateConnectionOK(dataSourceConfig);
 
         // 插入
         dataSourceConfigMapper.insert(dataSourceConfig);
@@ -50,7 +50,7 @@ public void updateDataSourceConfig(DataSourceConfigUpdateReqVO updateReqVO) {
         // 校验存在
         validateDataSourceConfigExists(updateReqVO.getId());
         DataSourceConfigDO updateObj = DataSourceConfigConvert.INSTANCE.convert(updateReqVO);
-        checkConnectionOK(updateObj);
+        validateConnectionOK(updateObj);
 
         // 更新
         dataSourceConfigMapper.updateById(updateObj);
@@ -88,7 +88,7 @@ public List<DataSourceConfigDO> getDataSourceConfigList() {
         return result;
     }
 
-    private void checkConnectionOK(DataSourceConfigDO config) {
+    private void validateConnectionOK(DataSourceConfigDO config) {
         boolean success = JdbcUtils.isConnectionOK(config.getUrl(), config.getUsername(), config.getPassword());
         if (!success) {
             throw exception(DATA_SOURCE_CONFIG_NOT_OK);

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/service/db/DatabaseTableServiceImpl.java
Patch:
@@ -41,7 +41,7 @@ public TableInfo getTable(Long dataSourceConfigId, String name) {
         return CollUtil.getFirst(getTableList0(dataSourceConfigId, name));
     }
 
-    public List<TableInfo> getTableList0(Long dataSourceConfigId, String name) {
+    private List<TableInfo> getTableList0(Long dataSourceConfigId, String name) {
         // 获得数据源配置
         DataSourceConfigDO config = dataSourceConfigService.getDataSourceConfig(dataSourceConfigId);
         Assert.notNull(config, "数据源({}) 不存在！", dataSourceConfigId);

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/service/file/FileServiceImpl.java
Patch:
@@ -69,7 +69,7 @@ public String createFile(String name, String path, byte[] content) {
     @Override
     public void deleteFile(Long id) throws Exception {
         // 校验存在
-        FileDO file = this.validateFileExists(id);
+        FileDO file = validateFileExists(id);
 
         // 从文件存储器中删除
         FileClient client = fileConfigService.getFileClient(file.getConfigId());

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/service/test/TestDemoServiceImpl.java
Patch:
@@ -45,7 +45,7 @@ public Long createTestDemo(TestDemoCreateReqVO createReqVO) {
     @CacheEvict(value = "test", key = "#updateReqVO.id")
     public void updateTestDemo(TestDemoUpdateReqVO updateReqVO) {
         // 校验存在
-        this.validateTestDemoExists(updateReqVO.getId());
+        validateTestDemoExists(updateReqVO.getId());
         // 更新
         TestDemoDO updateObj = TestDemoConvert.INSTANCE.convert(updateReqVO);
         testDemoMapper.updateById(updateObj);
@@ -55,7 +55,7 @@ public void updateTestDemo(TestDemoUpdateReqVO updateReqVO) {
     @CacheEvict(value = "test", key = "#id")
     public void deleteTestDemo(Long id) {
         // 校验存在
-        this.validateTestDemoExists(id);
+        validateTestDemoExists(id);
         // 删除
         testDemoMapper.deleteById(id);
     }

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/api/errorcode/ErrorCodeApiImpl.java
Patch:
@@ -24,7 +24,7 @@ public class ErrorCodeApiImpl implements ErrorCodeApi {
     private ErrorCodeService errorCodeService;
 
     @Override
-    public CommonResult<Boolean> autoGenerateErrorCodes(List<ErrorCodeAutoGenerateReqDTO> autoGenerateDTOs) {
+    public CommonResult<Boolean> autoGenerateErrorCodeList(List<ErrorCodeAutoGenerateReqDTO> autoGenerateDTOs) {
         errorCodeService.autoGenerateErrorCodes(autoGenerateDTOs);
         return success(true);
     }

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/api/tenant/TenantApiImpl.java
Patch:
@@ -21,8 +21,8 @@ public class TenantApiImpl implements TenantApi {
     private TenantService tenantService;
 
     @Override
-    public CommonResult<List<Long>> getTenantIds() {
-        return success(tenantService.getTenantIds());
+    public CommonResult<List<Long>> getTenantIdList() {
+        return success(tenantService.getTenantIdList());
     }
 
     @Override

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dict/DictDataController.java
Patch:
@@ -61,7 +61,7 @@ public CommonResult<Boolean> deleteDictData(Long id) {
     @GetMapping("/list-all-simple")
     @Operation(summary = "获得全部字典数据列表", description = "一般用于管理后台缓存字典数据在本地")
     // 无需添加权限认证，因为前端全局都需要
-    public CommonResult<List<DictDataSimpleRespVO>> getSimpleDictDatas() {
+    public CommonResult<List<DictDataSimpleRespVO>> getSimpleDictDataList() {
         List<DictDataDO> list = dictDataService.getDictDataList();
         return success(DictDataConvert.INSTANCE.convertList(list));
     }

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/dict/DictTypeController.java
Patch:
@@ -76,7 +76,7 @@ public CommonResult<DictTypeRespVO> getDictType(@RequestParam("id") Long id) {
     @GetMapping("/list-all-simple")
     @Operation(summary = "获得全部字典类型列表", description = "包括开启 + 禁用的字典类型，主要用于前端的下拉选项")
     // 无需添加权限认证，因为前端全局都需要
-    public CommonResult<List<DictTypeSimpleRespVO>> listSimpleDictTypes() {
+    public CommonResult<List<DictTypeSimpleRespVO>> getSimpleDictTypeList() {
         List<DictTypeDO> list = dictTypeService.getDictTypeList();
         return success(DictTypeConvert.INSTANCE.convertList(list));
     }

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/sensitiveword/SensitiveWordController.java
Patch:
@@ -90,8 +90,8 @@ public void exportSensitiveWordExcel(@Valid SensitiveWordExportReqVO exportReqVO
     @GetMapping("/get-tags")
     @Operation(summary = "获取所有敏感词的标签数组")
     @PreAuthorize("@ss.hasPermission('system:sensitive-word:query')")
-    public CommonResult<Set<String>> getSensitiveWordTags() throws IOException {
-        return success(sensitiveWordService.getSensitiveWordTags());
+    public CommonResult<Set<String>> getSensitiveWordTagSet() {
+        return success(sensitiveWordService.getSensitiveWordTagSet());
     }
 
     @GetMapping("/validate-text")

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/user/UserProfileController.java
Patch:
@@ -31,6 +31,7 @@
 import javax.validation.Valid;
 import java.util.List;
 
+import static cn.iocoder.yudao.framework.common.exception.util.ServiceExceptionUtil.exception;
 import static cn.iocoder.yudao.framework.common.pojo.CommonResult.success;
 import static cn.iocoder.yudao.framework.security.core.util.SecurityFrameworkUtils.getLoginUserId;
 import static cn.iocoder.yudao.module.infra.enums.ErrorCodeConstants.FILE_IS_EMPTY;
@@ -99,7 +100,7 @@ public CommonResult<Boolean> updateUserProfilePassword(@Valid @RequestBody UserP
     @Operation(summary = "上传用户个人头像")
     public CommonResult<String> updateUserAvatar(@RequestParam("avatarFile") MultipartFile file) throws Exception {
         if (file.isEmpty()) {
-            throw ServiceExceptionUtil.exception(FILE_IS_EMPTY);
+            throw exception(FILE_IS_EMPTY);
         }
         String avatar = userService.updateUserAvatar(getLoginUserId(), file.getInputStream());
         return success(avatar);

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/dal/mysql/social/SocialUserBindMapper.java
Patch:
@@ -24,9 +24,8 @@ default void deleteByUserTypeAndSocialUserId(Integer userType, Long socialUserId
     }
 
     default SocialUserBindDO selectByUserTypeAndSocialUserId(Integer userType, Long socialUserId) {
-        return selectOne(new LambdaQueryWrapperX<SocialUserBindDO>()
-                .eq(SocialUserBindDO::getUserType, userType)
-                .eq(SocialUserBindDO::getSocialUserId, socialUserId));
+        return selectOne(SocialUserBindDO::getUserType, userType,
+                SocialUserBindDO::getSocialUserId, socialUserId);
     }
 
     default List<SocialUserBindDO> selectListByUserIdAndUserType(Long userId, Integer userType) {

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/logger/OperateLogServiceImpl.java
Patch:
@@ -49,7 +49,7 @@ public PageResult<OperateLogDO> getOperateLogPage(OperateLogPageReqVO reqVO) {
         // 处理基于用户昵称的查询
         Collection<Long> userIds = null;
         if (StrUtil.isNotEmpty(reqVO.getUserNickname())) {
-            userIds = convertSet(userService.getUsersByNickname(reqVO.getUserNickname()), AdminUserDO::getId);
+            userIds = convertSet(userService.getUserListByNickname(reqVO.getUserNickname()), AdminUserDO::getId);
             if (CollUtil.isEmpty(userIds)) {
                 return PageResult.empty();
             }
@@ -63,7 +63,7 @@ public List<OperateLogDO> getOperateLogList(OperateLogExportReqVO reqVO) {
         // 处理基于用户昵称的查询
         Collection<Long> userIds = null;
         if (StrUtil.isNotEmpty(reqVO.getUserNickname())) {
-            userIds = convertSet(userService.getUsersByNickname(reqVO.getUserNickname()), AdminUserDO::getId);
+            userIds = convertSet(userService.getUserListByNickname(reqVO.getUserNickname()), AdminUserDO::getId);
             if (CollUtil.isEmpty(userIds)) {
                 return Collections.emptyList();
             }

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/notify/NotifyTemplateServiceImpl.java
Patch:
@@ -76,7 +76,7 @@ public NotifyTemplateDO getNotifyTemplateByCodeFromCache(String code) {
     @Override
     public Long createNotifyTemplate(NotifyTemplateCreateReqVO createReqVO) {
         // 校验站内信编码是否重复
-        checkNotifyTemplateCodeDuplicate(null, createReqVO.getCode());
+        validateNotifyTemplateCodeDuplicate(null, createReqVO.getCode());
 
         // 插入
         NotifyTemplateDO notifyTemplate = NotifyTemplateConvert.INSTANCE.convert(createReqVO);
@@ -93,7 +93,7 @@ public void updateNotifyTemplate(NotifyTemplateUpdateReqVO updateReqVO) {
         // 校验存在
         validateNotifyTemplateExists(updateReqVO.getId());
         // 校验站内信编码是否重复
-        checkNotifyTemplateCodeDuplicate(updateReqVO.getId(), updateReqVO.getCode());
+        validateNotifyTemplateCodeDuplicate(updateReqVO.getId(), updateReqVO.getCode());
 
         // 更新
         NotifyTemplateDO updateObj = NotifyTemplateConvert.INSTANCE.convert(updateReqVO);
@@ -136,7 +136,7 @@ public PageResult<NotifyTemplateDO> getNotifyTemplatePage(NotifyTemplatePageReqV
     }
 
     @VisibleForTesting
-    public void checkNotifyTemplateCodeDuplicate(Long id, String code) {
+    public void validateNotifyTemplateCodeDuplicate(Long id, String code) {
         NotifyTemplateDO template = notifyTemplateMapper.selectByCode(code);
         if (template == null) {
             return;

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/sensitiveword/SensitiveWordService.java
Patch:
@@ -81,7 +81,7 @@ public interface SensitiveWordService {
      *
      * @return 标签数组
      */
-    Set<String> getSensitiveWordTags();
+    Set<String> getSensitiveWordTagSet();
 
     /**
      * 获得文本所包含的不合法的敏感词数组

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/sensitiveword/SensitiveWordServiceImpl.java
Patch:
@@ -182,7 +182,7 @@ public List<SensitiveWordDO> getSensitiveWordList(SensitiveWordExportReqVO expor
     }
 
     @Override
-    public Set<String> getSensitiveWordTags() {
+    public Set<String> getSensitiveWordTagSet() {
         return sensitiveWordTagsCache;
     }
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/tenant/TenantService.java
Patch:
@@ -2,7 +2,6 @@
 
 import cn.iocoder.yudao.framework.common.pojo.PageResult;
 import cn.iocoder.yudao.framework.tenant.core.context.TenantContextHolder;
-import cn.iocoder.yudao.framework.tenant.core.service.TenantFrameworkService;
 import cn.iocoder.yudao.module.system.controller.admin.tenant.vo.tenant.TenantCreateReqVO;
 import cn.iocoder.yudao.module.system.controller.admin.tenant.vo.tenant.TenantExportReqVO;
 import cn.iocoder.yudao.module.system.controller.admin.tenant.vo.tenant.TenantPageReqVO;
@@ -121,7 +120,7 @@ public interface TenantService {
      *
      * @return 租户编号数组
      */
-    List<Long> getTenantIds();
+    List<Long> getTenantIdList();
 
     /**
      * 校验租户是否合法

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/tenant/TenantServiceImpl.java
Patch:
@@ -75,7 +75,7 @@ public class TenantServiceImpl implements TenantService {
     private PermissionService permissionService;
 
     @Override
-    public List<Long> getTenantIds() {
+    public List<Long> getTenantIdList() {
         List<TenantDO> tenants = tenantMapper.selectList();
         return CollectionUtils.convertList(tenants, TenantDO::getId);
     }

File: yudao-module-system/yudao-module-system-biz/src/test/java/cn/iocoder/yudao/module/system/service/logger/OperateLogServiceImplTest.java
Patch:
@@ -64,7 +64,7 @@ public void testGetOperateLogPage() {
             o.setNickname("wang");
             o.setStatus(CommonStatusEnum.ENABLE.getStatus());
         });
-        when(userService.getUsersByNickname("wang")).thenReturn(Collections.singletonList(user));
+        when(userService.getUserListByNickname("wang")).thenReturn(Collections.singletonList(user));
         Long userId = user.getId();
 
         // 构造操作日志
@@ -112,7 +112,7 @@ public void testGetOperateLogs() {
             o.setNickname("wang");
             o.setStatus(CommonStatusEnum.ENABLE.getStatus());
         });
-        when(userService.getUsersByNickname("wang")).thenReturn(Collections.singletonList(user));
+        when(userService.getUserListByNickname("wang")).thenReturn(Collections.singletonList(user));
         Long userId = user.getId();
 
         // 构造操作日志

File: yudao-module-system/yudao-module-system-biz/src/test/java/cn/iocoder/yudao/module/system/service/sensitiveword/SensitiveWordServiceImplTest.java
Patch:
@@ -60,7 +60,7 @@ public void testInitLocalCache() {
         // 调用
         sensitiveWordService.initLocalCache();
         // 断言 sensitiveWordTagsCache 缓存
-        assertEquals(SetUtils.asSet("论坛", "蔬菜"), sensitiveWordService.getSensitiveWordTags());
+        assertEquals(SetUtils.asSet("论坛", "蔬菜"), sensitiveWordService.getSensitiveWordTagSet());
         // 断言 tagSensitiveWordTries 缓存
         assertNotNull(sensitiveWordService.getDefaultSensitiveWordTrie());
         assertEquals(2, sensitiveWordService.getTagSensitiveWordTries().size());

File: yudao-module-system/yudao-module-system-biz/src/test/java/cn/iocoder/yudao/module/system/service/tenant/TenantServiceImplTest.java
Patch:
@@ -81,13 +81,13 @@ public void setUp() {
     }
 
     @Test
-    public void testGetTenantIds() {
+    public void testGetTenantIdList() {
         // mock 数据
         TenantDO tenant = randomPojo(TenantDO.class, o -> o.setId(1L));
         tenantMapper.insert(tenant);
 
         // 调用，并断言业务异常
-        List<Long> result = tenantService.getTenantIds();
+        List<Long> result = tenantService.getTenantIdList();
         assertEquals(Collections.singletonList(1L), result);
     }
 

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/dal/mysql/dept/UserPostMapper.java
Patch:
@@ -28,7 +28,7 @@ default List<UserPostDO> selectListByPostIds(Collection<Long> postIds) {
                 .in(UserPostDO::getPostId, postIds));
     }
 
-    default void deleteByUserId(Long userId){
+    default void deleteByUserId(Long userId) {
         delete(Wrappers.lambdaUpdate(UserPostDO.class).eq(UserPostDO::getUserId, userId));
     }
 }

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/dal/mysql/errorcode/ErrorCodeMapper.java
Patch:
@@ -8,8 +8,8 @@
 import cn.iocoder.yudao.module.system.dal.dataobject.errorcode.ErrorCodeDO;
 import org.apache.ibatis.annotations.Mapper;
 
-import java.util.Collection;
 import java.time.LocalDateTime;
+import java.util.Collection;
 import java.util.List;
 
 @Mapper
@@ -36,11 +36,11 @@ default List<ErrorCodeDO> selectList(ErrorCodeExportReqVO reqVO) {
     }
 
     default List<ErrorCodeDO> selectListByCodes(Collection<Integer> codes) {
-        return selectList(new LambdaQueryWrapperX<ErrorCodeDO>().in(ErrorCodeDO::getCode, codes));
+        return selectList(ErrorCodeDO::getCode, codes);
     }
 
     default ErrorCodeDO selectByCode(Integer code) {
-        return selectOne(new LambdaQueryWrapperX<ErrorCodeDO>().eq(ErrorCodeDO::getCode, code));
+        return selectOne(ErrorCodeDO::getCode, code);
     }
 
     default List<ErrorCodeDO> selectListByApplicationNameAndUpdateTimeGt(String applicationName, LocalDateTime minUpdateTime) {

File: yudao-framework/yudao-spring-boot-starter-web/src/main/java/cn/iocoder/yudao/framework/swagger/core/SpringFoxHandlerProviderBeanPostProcessor.java
Patch:
@@ -5,7 +5,6 @@
 import org.springframework.beans.BeansException;
 import org.springframework.beans.factory.config.BeanPostProcessor;
 import org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMapping;
-import springfox.documentation.spring.web.plugins.WebFluxRequestHandlerProvider;
 import springfox.documentation.spring.web.plugins.WebMvcRequestHandlerProvider;
 
 import java.util.List;
@@ -20,7 +19,7 @@ public class SpringFoxHandlerProviderBeanPostProcessor implements BeanPostProces
 
     @Override
     public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
-        if (bean instanceof WebMvcRequestHandlerProvider || bean instanceof WebFluxRequestHandlerProvider) {
+        if (bean instanceof WebMvcRequestHandlerProvider) {
             customizeSpringfoxHandlerMappings(getHandlerMappings(bean));
         }
         return bean;

File: yudao-framework/yudao-spring-boot-starter-web/src/main/java/cn/iocoder/yudao/framework/web/config/YudaoWebAutoConfiguration.java
Patch:
@@ -145,9 +145,10 @@ public XssCleaner xssCleaner() {
     @Bean
     @ConditionalOnMissingBean(name = "xssJacksonCustomizer")
     @ConditionalOnBean(ObjectMapper.class)
-    public Jackson2ObjectMapperBuilderCustomizer xssJacksonCustomizer(XssCleaner xssCleaner, XssProperties xssProperties) {
+    @ConditionalOnProperty(value = "yudao.xss.enable", havingValue = "true")
+    public Jackson2ObjectMapperBuilderCustomizer xssJacksonCustomizer(XssCleaner xssCleaner) {
         // 在反序列化时进行 xss 过滤，可以替换使用 XssStringJsonSerializer，在序列化时进行处理
-        return builder -> builder.deserializerByType(String.class, new XssStringJsonDeserializer(xssCleaner, xssProperties));
+        return builder -> builder.deserializerByType(String.class, new XssStringJsonDeserializer(xssCleaner));
     }
 
 

File: yudao-framework/yudao-spring-boot-starter-web/src/main/java/cn/iocoder/yudao/framework/web/core/handler/GlobalExceptionHandler.java
Patch:
@@ -13,7 +13,6 @@
 import cn.iocoder.yudao.framework.common.util.servlet.ServletUtils;
 import lombok.AllArgsConstructor;
 import lombok.extern.slf4j.Slf4j;
-import org.apache.commons.lang3.exception.ExceptionUtils;
 import org.springframework.security.access.AccessDeniedException;
 import org.springframework.util.Assert;
 import org.springframework.validation.BindException;
@@ -31,7 +30,6 @@
 import javax.validation.ConstraintViolationException;
 import javax.validation.ValidationException;
 import java.time.LocalDateTime;
-import java.time.LocalDateTime;
 import java.util.Map;
 
 import static cn.iocoder.yudao.framework.common.exception.enums.GlobalErrorCodeConstants.*;
@@ -249,7 +247,7 @@ private void initExceptionLog(ApiErrorLog errorLog, HttpServletRequest request,
         errorLog.setExceptionName(e.getClass().getName());
         errorLog.setExceptionMessage(ExceptionUtil.getMessage(e));
         errorLog.setExceptionRootCauseMessage(ExceptionUtil.getRootCauseMessage(e));
-        errorLog.setExceptionStackTrace(ExceptionUtils.getStackTrace(e));
+        errorLog.setExceptionStackTrace(ExceptionUtil.stacktraceToString(e));
         StackTraceElement[] stackTraceElements = e.getStackTrace();
         Assert.notEmpty(stackTraceElements, "异常 stackTraceElements 不能为空");
         StackTraceElement stackTraceElement = stackTraceElements[0];

File: yudao-framework/yudao-spring-boot-starter-file/src/main/java/cn/iocoder/yudao/framework/file/core/client/s3/S3FileClient.java
Patch:
@@ -9,6 +9,7 @@
 import java.io.ByteArrayInputStream;
 
 import static cn.iocoder.yudao.framework.file.core.client.s3.S3FileClientConfig.ENDPOINT_ALIYUN;
+import static cn.iocoder.yudao.framework.file.core.client.s3.S3FileClientConfig.ENDPOINT_TENCENT;
 
 /**
  * 基于 S3 协议的文件客户端，实现 MinIO、阿里云、腾讯云、七牛云、华为云等云服务

File: yudao-framework/yudao-spring-boot-starter-file/src/main/java/cn/iocoder/yudao/framework/file/core/client/s3/S3FileClient.java
Patch:
@@ -9,6 +9,7 @@
 import java.io.ByteArrayInputStream;
 
 import static cn.iocoder.yudao.framework.file.core.client.s3.S3FileClientConfig.ENDPOINT_ALIYUN;
+import static cn.iocoder.yudao.framework.file.core.client.s3.S3FileClientConfig.ENDPOINT_TENCENT;
 
 /**
  * 基于 S3 协议的文件客户端，实现 MinIO、阿里云、腾讯云、七牛云、华为云等云服务

File: yudao-framework/yudao-spring-boot-starter-file/src/main/java/cn/iocoder/yudao/framework/file/core/client/s3/S3FileClientConfig.java
Patch:
@@ -19,6 +19,7 @@ public class S3FileClientConfig implements FileClientConfig {
 
     public static final String ENDPOINT_QINIU = "qiniucs.com";
     public static final String ENDPOINT_ALIYUN = "aliyuncs.com";
+    public static final String ENDPOINT_TENCENT = "myqcloud.com";
 
     /**
      * 节点地址

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/enums/ErrorCodeConstants.java
Patch:
@@ -139,6 +139,6 @@ public interface ErrorCodeConstants {
 
     // ========== OAuth2 授权 1002022000 =========
     ErrorCode OAUTH2_CODE_NOT_EXISTS = new ErrorCode(1002022000, "code 不存在");
-    ErrorCode OAUTH2_CODE_EXPIRE = new ErrorCode(1002022000, "code 已过期");
+    ErrorCode OAUTH2_CODE_EXPIRE = new ErrorCode(1002022001, "code 已过期");
 
 }

File: yudao-framework/yudao-spring-boot-starter-biz-data-permission/src/main/java/cn/iocoder/yudao/framework/datapermission/core/rule/dept/DeptDataPermissionRule.java
Patch:
@@ -7,6 +7,7 @@
 import cn.iocoder.yudao.framework.common.util.collection.CollectionUtils;
 import cn.iocoder.yudao.framework.common.util.json.JsonUtils;
 import cn.iocoder.yudao.framework.datapermission.core.rule.DataPermissionRule;
+import cn.iocoder.yudao.framework.expression.OrExpressionX;
 import cn.iocoder.yudao.framework.mybatis.core.dataobject.BaseDO;
 import cn.iocoder.yudao.framework.mybatis.core.util.MyBatisUtils;
 import cn.iocoder.yudao.framework.security.core.LoginUser;
@@ -20,7 +21,6 @@
 import net.sf.jsqlparser.expression.Expression;
 import net.sf.jsqlparser.expression.LongValue;
 import net.sf.jsqlparser.expression.NullValue;
-import net.sf.jsqlparser.expression.operators.conditional.OrExpression;
 import net.sf.jsqlparser.expression.operators.relational.EqualsTo;
 import net.sf.jsqlparser.expression.operators.relational.ExpressionList;
 import net.sf.jsqlparser.expression.operators.relational.InExpression;
@@ -143,8 +143,8 @@ public Expression getExpression(String tableName, Alias tableAlias) {
         if (userExpression == null) {
             return deptExpression;
         }
-        // 目前，如果有指定部门 + 可查看自己，采用 OR 条件。即，WHERE dept_id IN ? OR user_id = ?
-        return new OrExpression(deptExpression, userExpression);
+        // 目前，如果有指定部门 + 可查看自己，采用 OR 条件。即，WHERE (dept_id IN ? OR user_id = ?)
+        return new OrExpressionX(deptExpression, userExpression);
     }
 
     private Expression buildDeptExpression(String tableName, Alias tableAlias, Set<Long> deptIds) {

File: yudao-framework/yudao-common/src/main/java/cn/iocoder/yudao/framework/common/util/object/ObjectUtils.java
Patch:
@@ -1,12 +1,10 @@
 package cn.iocoder.yudao.framework.common.util.object;
 
-import cn.hutool.core.util.ArrayUtil;
 import cn.hutool.core.util.ObjectUtil;
 import cn.hutool.core.util.ReflectUtil;
 
 import java.lang.reflect.Field;
 import java.util.Arrays;
-import java.util.Objects;
 import java.util.function.Consumer;
 
 /**
@@ -47,6 +45,7 @@ public static <T extends Comparable<T>> T max(T obj1, T obj2) {
         return obj1.compareTo(obj2) > 0 ? obj1 : obj2;
     }
 
+    @SafeVarargs
     public static <T> T defaultIfNull(T... array) {
         for (T item : array) {
             if (item != null) {
@@ -56,6 +55,7 @@ public static <T> T defaultIfNull(T... array) {
         return null;
     }
 
+    @SafeVarargs
     public static <T> boolean equalsAny(T obj, T... array) {
         return Arrays.asList(array).contains(obj);
     }

File: yudao-framework/yudao-spring-boot-starter-file/src/main/java/cn/iocoder/yudao/framework/file/core/client/FileClient.java
Patch:
@@ -22,7 +22,7 @@ public interface FileClient {
      * @return 完整路径，即 HTTP 访问地址
      * @throws Exception 上传文件时，抛出 Exception 异常
      */
-    String upload(byte[] content, String path) throws  Exception;
+    String upload(byte[] content, String path, String type) throws  Exception;
 
     /**
      * 删除文件

File: yudao-framework/yudao-spring-boot-starter-file/src/main/java/cn/iocoder/yudao/framework/file/core/client/db/DBFileClient.java
Patch:
@@ -21,7 +21,7 @@ protected void doInit() {
     }
 
     @Override
-    public String upload(byte[] content, String path) {
+    public String upload(byte[] content, String path, String type) {
         getDao().insert(getId(), path, content);
         // 拼接返回路径
         return super.formatFileUrl(config.getDomain(), path);

File: yudao-framework/yudao-spring-boot-starter-file/src/main/java/cn/iocoder/yudao/framework/file/core/client/ftp/FtpFileClient.java
Patch:
@@ -10,7 +10,6 @@
 
 import java.io.ByteArrayInputStream;
 import java.io.ByteArrayOutputStream;
-import java.io.File;
 
 /**
  * Ftp 文件客户端
@@ -39,7 +38,7 @@ protected void doInit() {
     }
 
     @Override
-    public String upload(byte[] content, String path) {
+    public String upload(byte[] content, String path, String type) {
         // 执行写入
         String filePath = getFilePath(path);
         String fileName = FileUtil.getName(filePath);

File: yudao-framework/yudao-spring-boot-starter-file/src/main/java/cn/iocoder/yudao/framework/file/core/client/local/LocalFileClient.java
Patch:
@@ -25,7 +25,7 @@ protected void doInit() {
     }
 
     @Override
-    public String upload(byte[] content, String path) {
+    public String upload(byte[] content, String path, String type) {
         // 执行写入
         String filePath = getFilePath(path);
         FileUtil.writeBytes(content, filePath);

File: yudao-framework/yudao-spring-boot-starter-file/src/main/java/cn/iocoder/yudao/framework/file/core/client/s3/S3FileClient.java
Patch:
@@ -82,10 +82,11 @@ private String buildRegion() {
     }
 
     @Override
-    public String upload(byte[] content, String path) throws Exception {
+    public String upload(byte[] content, String path, String type) throws Exception {
         // 执行上传
         client.putObject(PutObjectArgs.builder()
                 .bucket(config.getBucket()) // bucket 必须传递
+                .contentType(type)
                 .object(path) // 相对路径作为 key
                 .stream(new ByteArrayInputStream(content), content.length, -1) // 文件内容
                 .build());

File: yudao-framework/yudao-spring-boot-starter-file/src/main/java/cn/iocoder/yudao/framework/file/core/client/sftp/SftpFileClient.java
Patch:
@@ -31,7 +31,7 @@ protected void doInit() {
     }
 
     @Override
-    public String upload(byte[] content, String path) {
+    public String upload(byte[] content, String path, String type) {
         // 执行写入
         String filePath = getFilePath(path);
         File file = FileUtils.createTempFile(content);

File: yudao-framework/yudao-spring-boot-starter-file/src/main/java/cn/iocoder/yudao/framework/file/core/utils/FileTypeUtils.java
Patch:
@@ -16,7 +16,7 @@ public class FileTypeUtils {
     /**
      * 获得文件的 mineType，对于doc，jar等文件会有误差
      *
-     * @param data 包含文件开头几千个字节的字节数组
+     * @param data 文件内容
      * @return mineType 无法识别时会返回“application/octet-stream”
      */
     @SneakyThrows
@@ -37,7 +37,7 @@ public static String getMineType(String name) {
     /**
      * 在拥有文件和数据的情况下，最好使用此方法，最为准确
      *
-     * @param data 包含文件开头几千个字节的字节数组
+     * @param data 文件内容
      * @param name 文件名
      * @return mineType 无法识别时会返回“application/octet-stream”
      */

File: yudao-framework/yudao-spring-boot-starter-file/src/test/java/cn/iocoder/yudao/framework/file/core/client/ftp/FtpFileClientTest.java
Patch:
@@ -25,7 +25,7 @@ public void test() {
         // 上传文件
         String path = IdUtil.fastSimpleUUID() + ".jpg";
         byte[] content = ResourceUtil.readBytes("file/erweima.jpg");
-        String fullPath = client.upload(content, path);
+        String fullPath = client.upload(content, path, "image/jpeg");
         System.out.println("访问地址：" + fullPath);
         if (false) {
             byte[] bytes = client.getContent(path);

File: yudao-framework/yudao-spring-boot-starter-file/src/test/java/cn/iocoder/yudao/framework/file/core/client/local/LocalFileClientTest.java
Patch:
@@ -19,7 +19,7 @@ public void test() {
         // 上传文件
         String path = IdUtil.fastSimpleUUID() + ".jpg";
         byte[] content = ResourceUtil.readBytes("file/erweima.jpg");
-        String fullPath = client.upload(content, path);
+        String fullPath = client.upload(content, path, "image/jpeg");
         System.out.println("访问地址：" + fullPath);
         client.delete(path);
     }

File: yudao-framework/yudao-spring-boot-starter-file/src/test/java/cn/iocoder/yudao/framework/file/core/client/s3/S3FileClientTest.java
Patch:
@@ -101,7 +101,7 @@ private void testExecuteUpload(S3FileClientConfig config) throws Exception {
         // 上传文件
         String path = IdUtil.fastSimpleUUID() + ".jpg";
         byte[] content = ResourceUtil.readBytes("file/erweima.jpg");
-        String fullPath = client.upload(content, path);
+        String fullPath = client.upload(content, path, "image/jpeg");
         System.out.println("访问地址：" + fullPath);
         // 读取文件
         if (true) {

File: yudao-framework/yudao-spring-boot-starter-file/src/test/java/cn/iocoder/yudao/framework/file/core/client/sftp/SftpFileClientTest.java
Patch:
@@ -23,7 +23,7 @@ public void test() {
         // 上传文件
         String path = IdUtil.fastSimpleUUID() + ".jpg";
         byte[] content = ResourceUtil.readBytes("file/erweima.jpg");
-        String fullPath = client.upload(content, path);
+        String fullPath = client.upload(content, path, "image/jpeg");
         System.out.println("访问地址：" + fullPath);
         if (false) {
             byte[] bytes = client.getContent(path);

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/service/file/FileConfigServiceImpl.java
Patch:
@@ -31,8 +31,8 @@
 import javax.annotation.PostConstruct;
 import javax.annotation.Resource;
 import javax.validation.Validator;
-import java.util.Collection;
 import java.time.LocalDateTime;
+import java.util.Collection;
 import java.util.List;
 import java.util.Map;
 
@@ -193,7 +193,7 @@ public void deleteFileConfig(Long id) {
         // 校验存在
         FileConfigDO config = this.validateFileConfigExists(id);
         if (Boolean.TRUE.equals(config.getMaster())) {
-             throw exception(FILE_CONFIG_DELETE_FAIL_MASTER);
+            throw exception(FILE_CONFIG_DELETE_FAIL_MASTER);
         }
         // 删除
         fileConfigMapper.deleteById(id);
@@ -230,7 +230,7 @@ public String testFileConfig(Long id) throws Exception {
         this.validateFileConfigExists(id);
         // 上传文件
         byte[] content = ResourceUtil.readBytes("file/erweima.jpg");
-        return fileClientFactory.getFileClient(id).upload(content, IdUtil.fastSimpleUUID() + ".jpg");
+        return fileClientFactory.getFileClient(id).upload(content, IdUtil.fastSimpleUUID() + ".jpg", "image/jpeg");
     }
 
     @Override

File: yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/service/file/FileServiceImpl.java
Patch:
@@ -52,7 +52,7 @@ public String createFile(String name, String path, byte[] content) {
         // 上传到文件存储器
         FileClient client = fileConfigService.getMasterFileClient();
         Assert.notNull(client, "客户端(master) 不能为空");
-        String url = client.upload(content, path);
+        String url = client.upload(content, path, type);
 
         // 保存到数据库
         FileDO file = new FileDO();

File: yudao-framework/yudao-spring-boot-starter-biz-pay/src/main/java/cn/iocoder/yudao/framework/pay/core/client/impl/wx/WXLitePayClient.java
Patch:
@@ -49,7 +49,7 @@ public WXLitePayClient(Long channelId, WXPayClientConfig config) {
     @Override
     protected void doInit() {
         WxPayConfig payConfig = new WxPayConfig();
-        BeanUtil.copyProperties(config, payConfig, "keyContent");
+        BeanUtil.copyProperties(config, payConfig, "privateKeyContent", "privateCertContent");
         payConfig.setTradeType(WxPayConstants.TradeType.JSAPI); // 设置使用 JS API 支付方式
 //        if (StrUtil.isNotEmpty(config.getKeyContent())) {
 //            payConfig.setKeyContent(config.getKeyContent().getBytes(StandardCharsets.UTF_8));

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/sms/SmsSendServiceImpl.java
Patch:
@@ -180,7 +180,7 @@ public void receiveSmsStatus(String channelCode, String text) throws Throwable {
         }
         // 更新短信日志的接收结果. 因为量一般不大，所以先使用 for 循环更新
         receiveResults.forEach(result -> smsLogService.updateSmsReceiveResult(result.getLogId(),
-                result.getSuccess(), result.getReceiveTime(), result.getErrorCode(), result.getErrorCode()));
+                result.getSuccess(), result.getReceiveTime(), result.getErrorCode(), result.getErrorMsg()));
     }
 
 }

File: yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/auth/AdminAuthServiceImpl.java
Patch:
@@ -123,7 +123,7 @@ public AuthLoginRespVO smsLogin(AuthSmsLoginReqVO reqVO) {
             throw exception(USER_NOT_EXISTS);
         }
 
-        // 缓存登陆用户到 Redis 中，返回 sessionId 编号
+        // 创建 Token 令牌，记录登录日志
         return createTokenAfterLoginSuccess(user.getId(), reqVO.getMobile(), LoginLogTypeEnum.LOGIN_MOBILE);
     }
 

File: yudao-module-infra/yudao-module-infra-biz/src/test/java/cn/iocoder/yudao/module/infra/service/file/FileServiceTest.java
Patch:
@@ -40,15 +40,15 @@ public void testGetFilePage() {
         // mock 数据
         FileDO dbFile = randomPojo(FileDO.class, o -> { // 等会查询到
             o.setPath("yunai");
-            o.setType("jpg");
+            o.setType("image/jpg");
             o.setCreateTime(buildTime(2021, 1, 15));
         });
         fileMapper.insert(dbFile);
         // 测试 path 不匹配
         fileMapper.insert(ObjectUtils.cloneIgnoreId(dbFile, o -> o.setPath("tudou")));
         // 测试 type 不匹配
         fileMapper.insert(ObjectUtils.cloneIgnoreId(dbFile, o -> {
-            o.setType("png");
+            o.setType("image/png");
         }));
         // 测试 createTime 不匹配
         fileMapper.insert(ObjectUtils.cloneIgnoreId(dbFile, o -> {
@@ -90,7 +90,7 @@ public void testCreateFile_success() throws Exception {
         assertEquals(10L, file.getConfigId());
         assertEquals(path, file.getPath());
         assertEquals(url, file.getUrl());
-        assertEquals("jpg", file.getType());
+        assertEquals("image/jpg", file.getType());
         assertEquals(content.length, file.getSize());
     }
 

File: yudao-framework/yudao-spring-boot-starter-biz-error-code/src/main/java/cn/iocoder/yudao/framework/errorcode/config/YudaoErrorCodeAutoConfiguration.java
Patch:
@@ -6,6 +6,7 @@
 import cn.iocoder.yudao.framework.errorcode.core.loader.ErrorCodeLoaderImpl;
 import cn.iocoder.yudao.module.system.api.errorcode.ErrorCodeApi;
 import org.springframework.beans.factory.annotation.Value;
+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
 import org.springframework.boot.context.properties.EnableConfigurationProperties;
 import org.springframework.context.annotation.Bean;
 import org.springframework.context.annotation.Configuration;
@@ -17,6 +18,7 @@
  * @author 芋道源码
  */
 @Configuration
+@ConditionalOnProperty(prefix = "yudao.error-code", value = "enable", matchIfMissing = true) // 允许使用 yudao.error-code.enable=false 禁用访问日志
 @EnableConfigurationProperties(ErrorCodeProperties.class)
 @EnableScheduling // 开启调度任务的功能，因为 ErrorCodeRemoteLoader 通过定时刷新错误码
 public class YudaoErrorCodeAutoConfiguration {

File: yudao-framework/yudao-spring-boot-starter-biz-error-code/src/main/java/cn/iocoder/yudao/framework/errorcode/config/ErrorCodeProperties.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.yudao.module.system.framework.errorcode.config;
+package cn.iocoder.yudao.framework.errorcode.config;
 
 import lombok.Data;
 import org.springframework.boot.context.properties.ConfigurationProperties;

File: yudao-framework/yudao-spring-boot-starter-biz-error-code/src/main/java/cn/iocoder/yudao/framework/errorcode/core/generator/ErrorCodeAutoGenerator.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.yudao.module.system.framework.errorcode.core.generator;
+package cn.iocoder.yudao.framework.errorcode.core.generator;
 
 /**
  * 错误码的自动生成器

File: yudao-framework/yudao-spring-boot-starter-biz-error-code/src/main/java/cn/iocoder/yudao/framework/errorcode/core/loader/ErrorCodeLoader.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.yudao.module.system.framework.errorcode.core.loader;
+package cn.iocoder.yudao.framework.errorcode.core.loader;
 
 import cn.iocoder.yudao.framework.common.exception.util.ServiceExceptionUtil;
 

File: yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/errorcode/ErrorCodeApi.java
Patch:
@@ -22,7 +22,7 @@
 @Api(tags = "RPC 服务 - 错误码")
 public interface ErrorCodeApi {
 
-    String PREFIX = ApiConstants.PREFIX + "/oauth2/token";
+    String PREFIX = ApiConstants.PREFIX + "/error-code";
 
     @PostMapping(PREFIX + "/auto-generate")
     @ApiOperation("自动创建错误码")

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponCardAvailableRespDTO.java
Patch:
@@ -10,7 +10,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class CouponCardAvailableRespDTO extends CouponCardBO {
+public class CouponCardAvailableRespDTO extends CouponCardReqDTO {
 
     /**
      * 是否可用

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponCardPageRespDTO.java
Patch:
@@ -11,12 +11,12 @@
  */
 @Data
 @Accessors(chain = true)
-public class CouponCardPageBO implements Serializable {
+public class CouponCardPageRespDTO implements Serializable {
 
     /**
      * 优惠劵数组
      */
-    private List<CouponCardBO> list;
+    private List<CouponCardReqDTO> list;
     /**
      * 总量
      */

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponTemplatePageRespDTO.java
Patch:
@@ -11,12 +11,12 @@
  */
 @Data
 @Accessors(chain = true)
-public class CouponTemplatePageBO implements Serializable {
+public class CouponTemplatePageRespDTO implements Serializable {
 
     /**
      * 优惠劵（码）数组
      */
-    private List<CouponTemplateBO> list;
+    private List<CouponTemplateReqDTO> list;
     /**
      * 总量
      */

File: promotion-service-project/promotion-service-app/src/main/java/cn/iocoder/mall/promotionservice/service/coupon/bo/CouponCardBO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
+package cn.iocoder.mall.promotionservice.service.coupon.bo;
 
 import lombok.Data;
 import lombok.experimental.Accessors;

File: promotion-service-project/promotion-service-app/src/main/java/cn/iocoder/mall/promotionservice/service/coupon/bo/CouponCardDetailBO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
+package cn.iocoder.mall.promotionservice.service.coupon.bo;
 
 import lombok.Data;
 import lombok.experimental.Accessors;

File: promotion-service-project/promotion-service-app/src/main/java/cn/iocoder/mall/promotionservice/service/coupon/bo/CouponTemplateBO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
+package cn.iocoder.mall.promotionservice.service.coupon.bo;
 
 import lombok.Data;
 import lombok.experimental.Accessors;

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/activity/PromotionActivityRpc.java
Patch:
@@ -3,7 +3,7 @@
 import java.util.Collection;
 import java.util.List;
 
-public interface PromotionActivityService {
+public interface PromotionActivityRpc {
 
     List<PromotionActivityRespDTO> getPromotionActivityListBySpuId(Integer spuId,
                                                                    Collection<Integer> activityStatuses);

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/banner/BannerRpc.java
Patch:
@@ -10,7 +10,7 @@
 
 import java.util.List;
 
-public interface BannerService {
+public interface BannerRpc {
 
     List<BannerRespDTO> getBannerListByStatus(Integer status);
 

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/CouponRpc.java
Patch:
@@ -7,7 +7,7 @@
 import javax.validation.constraints.NotNull;
 import java.util.List;
 
-public interface CouponService {
+public interface CouponRpc {
 
     // ========== 优惠劵（码）模板 ==========
 

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponCardSpuRespDTO.java
Patch:
@@ -1,6 +1,6 @@
 package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
-import cn.iocoder.mall.promotion.api.rpc.coupon.CouponService;
+import cn.iocoder.mall.promotion.api.rpc.coupon.CouponRpc;
 import lombok.Data;
 import lombok.experimental.Accessors;
 
@@ -10,7 +10,7 @@
 /**
  * 优惠劵商品 DTO
  *
- * 主要用于 {@link CouponService#getCouponCardList(Integer, List)}
+ * 主要用于 {@link CouponRpc#getCouponCardList(Integer, List)}
  */
 @Data
 @Accessors(chain = true)

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/recommend/ProductRecommendRpc.java
Patch:
@@ -6,7 +6,7 @@
 
 import java.util.List;
 
-public interface ProductRecommendService {
+public interface ProductRecommendRpc {
 
     List<ProductRecommendRespDTO> getProductRecommendList(Integer type, Integer status);
 

File: order/order-service-impl/src/main/java/cn/iocoder/mall/order/biz/service/CartServiceImpl.java
Patch:
@@ -19,7 +19,7 @@
 import cn.iocoder.mall.promotion.api.PromotionActivityService;
 import cn.iocoder.mall.promotion.api.bo.CouponCardDetailBO;
 import cn.iocoder.mall.promotion.api.bo.PromotionActivityBO;
-import cn.iocoder.mall.promotion.api.constant.*;
+import cn.iocoder.mall.promotion.api.enums.*;
 import org.apache.dubbo.config.annotation.Reference;
 import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.stereotype.Service;

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/CouponCardStatusEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 import cn.iocoder.common.framework.core.IntArrayValuable;
 

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/CouponCardTakeTypeEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 import cn.iocoder.common.framework.core.IntArrayValuable;
 

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/CouponTemplateDateTypeEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 import cn.iocoder.common.framework.core.IntArrayValuable;
 

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/CouponTemplateStatusEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 import cn.iocoder.common.framework.core.IntArrayValuable;
 

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/CouponTemplateTypeEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 import java.util.Arrays;
 

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/MeetTypeEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 /**
  * 匹配类型枚举

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/PreferentialTypeEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 import cn.iocoder.common.framework.core.IntArrayValuable;
 

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/ProductRecommendTypeEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 import cn.iocoder.common.framework.core.IntArrayValuable;
 

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/PromotionActivityStatusEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 /**
  * 促销活动状态枚举

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/PromotionActivityTypeEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 /**
  * 推广活动类型枚举

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/PromotionErrorCodeEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 /**
  * 错误码枚举类

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/RangeTypeEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 import cn.iocoder.common.framework.core.IntArrayValuable;
 

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/activity/dto/PromotionActivityPageReqDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.activity.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -10,12 +10,12 @@
  */
 @Data
 @Accessors(chain = true)
-public class PromotionActivityPageBO {
+public class PromotionActivityPageReqDTO {
 
     /**
      * PromotionActivityBO 数组
      */
-    private List<PromotionActivityBO> list;
+    private List<PromotionActivityRespDTO> list;
     /**
      * 总量
      */

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/activity/dto/PromotionActivityPageRespDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.activity.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -12,7 +12,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class PromotionActivityPageDTO implements Serializable {
+public class PromotionActivityPageRespDTO implements Serializable {
 
     /**
      * 标题

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/banner/dto/BannerAddReqDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.banner.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -14,7 +14,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class BannerAddDTO implements Serializable {
+public class BannerAddReqDTO implements Serializable {
 
     @NotEmpty(message = "标题不能为空")
     @Length(min = 2, max = 32, message = "标题长度为 2-32 位")

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/banner/dto/BannerPageDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.banner.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/banner/dto/BannerPageRespDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.banner.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -11,12 +11,12 @@
  */
 @Data
 @Accessors(chain = true)
-public class BannerPageBO implements Serializable {
+public class BannerPageRespDTO implements Serializable {
 
     /**
      * Banner 数组
      */
-    private List<BannerBO> list;
+    private List<BannerRespDTO> list;
     /**
      * 总量
      */

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/banner/dto/BannerRespDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.banner.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -11,7 +11,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class BannerBO implements Serializable {
+public class BannerRespDTO implements Serializable {
 
     /**
      * 编号

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/banner/dto/BannerUpdateReqDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.banner.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -14,7 +14,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class BannerUpdateDTO implements Serializable {
+public class BannerUpdateReqDTO implements Serializable {
 
     @NotNull(message = "编号不能为空")
     private Integer id;

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponCardAvailableRespDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -10,7 +10,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class CouponCardAvailableBO extends CouponCardBO {
+public class CouponCardAvailableRespDTO extends CouponCardBO {
 
     /**
      * 是否可用

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponCardBO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponCardDetailBO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponCardPageBO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponCardPageReqDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -11,7 +11,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class CouponCardPageDTO implements Serializable {
+public class CouponCardPageReqDTO implements Serializable {
 
     /**
      * 用户编号

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponCodeTemplateAddReqDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -10,5 +10,5 @@
  */
 @Data
 @Accessors(chain = true)
-public class CouponCodeTemplateAddDTO implements Serializable {
+public class CouponCodeTemplateAddReqDTO implements Serializable {
 }

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponCodeTemplateUpdateReqDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -10,5 +10,5 @@
  */
 @Data
 @Accessors(chain = true)
-public class CouponCodeTemplateUpdateDTO implements Serializable {
+public class CouponCodeTemplateUpdateReqDTO implements Serializable {
 }

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponTemplateBO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponTemplatePageBO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponTemplatePageReqDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -11,7 +11,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class CouponTemplatePageDTO implements Serializable {
+public class CouponTemplatePageReqDTO implements Serializable {
 
     /**
      * 类型

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/recommend/dto/ProductRecommendAddReqDTO.java
Patch:
@@ -1,7 +1,7 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.recommend.dto;
 
 import cn.iocoder.common.framework.validator.InEnum;
-import cn.iocoder.mall.promotion.api.constant.ProductRecommendTypeEnum;
+import cn.iocoder.mall.promotion.api.enums.ProductRecommendTypeEnum;
 import lombok.Data;
 import lombok.experimental.Accessors;
 import org.hibernate.validator.constraints.Length;
@@ -14,7 +14,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class ProductRecommendAddDTO implements Serializable {
+public class ProductRecommendAddReqDTO implements Serializable {
 
     @InEnum(value = ProductRecommendTypeEnum.class, message = "修改推荐类型必须是 {value}")
     @NotNull(message = "推荐类型不能为空")

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/recommend/dto/ProductRecommendPageReqDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.recommend.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -11,7 +11,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class ProductRecommendPageDTO implements Serializable {
+public class ProductRecommendPageReqDTO implements Serializable {
 
     /**
      * 推荐类型

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/recommend/dto/ProductRecommendPageRespDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.recommend.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -11,12 +11,12 @@
  */
 @Data
 @Accessors(chain = true)
-public class ProductRecommendPageBO implements Serializable {
+public class ProductRecommendPageRespDTO implements Serializable {
 
     /**
      * ProductRecommend 数组
      */
-    private List<ProductRecommendBO> list;
+    private List<ProductRecommendRespDTO> list;
     /**
      * 总量
      */

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/recommend/dto/ProductRecommendRespDTO.java
Patch:
@@ -1,6 +1,6 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.recommend.dto;
 
-import cn.iocoder.mall.promotion.api.constant.ProductRecommendTypeEnum;
+import cn.iocoder.mall.promotion.api.enums.ProductRecommendTypeEnum;
 import lombok.Data;
 import lombok.experimental.Accessors;
 
@@ -12,7 +12,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class ProductRecommendBO implements Serializable {
+public class ProductRecommendRespDTO implements Serializable {
 
     /**
      * 编号

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/recommend/dto/ProductRecommendUpdateReqDTO.java
Patch:
@@ -1,7 +1,7 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.recommend.dto;
 
 import cn.iocoder.common.framework.validator.InEnum;
-import cn.iocoder.mall.promotion.api.constant.ProductRecommendTypeEnum;
+import cn.iocoder.mall.promotion.api.enums.ProductRecommendTypeEnum;
 import lombok.Data;
 import lombok.experimental.Accessors;
 import org.hibernate.validator.constraints.Length;
@@ -14,7 +14,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class ProductRecommendUpdateDTO implements Serializable {
+public class ProductRecommendUpdateReqDTO implements Serializable {
 
     @NotNull(message = "编号不能为空")
     private Integer id;

File: promotion/promotion-service-impl/src/main/java/cn/iocoder/mall/promotion/biz/config/ServiceExceptionConfiguration.java
Patch:
@@ -1,7 +1,7 @@
 package cn.iocoder.mall.promotion.biz.config;
 
 import cn.iocoder.common.framework.util.ServiceExceptionUtil;
-import cn.iocoder.mall.promotion.api.constant.PromotionErrorCodeEnum;
+import cn.iocoder.mall.promotion.api.enums.PromotionErrorCodeEnum;
 import org.springframework.boot.context.event.ApplicationReadyEvent;
 import org.springframework.context.annotation.Configuration;
 import org.springframework.context.event.EventListener;

File: promotion/promotion-service-impl/src/main/java/cn/iocoder/mall/promotion/biz/dataobject/CouponTemplateDO.java
Patch:
@@ -38,7 +38,7 @@ public class CouponTemplateDO extends BaseDO {
     /**
      * 优惠码状态
      *
-     * {@link cn.iocoder.mall.promotion.api.constant.CouponTemplateStatusEnum}
+     * {@link cn.iocoder.mall.promotion.api.enums.CouponTemplateStatusEnum}
      *
      * 当优惠劵（码）开启中，可以手动操作，设置禁用中。
      */

File: promotion/promotion-service-impl/src/main/java/cn/iocoder/mall/promotion/biz/dataobject/ProductRecommendDO.java
Patch:
@@ -2,7 +2,7 @@
 
 
 import cn.iocoder.mall.mybatis.core.dataobject.DeletableDO;
-import cn.iocoder.mall.promotion.api.constant.ProductRecommendTypeEnum;
+import cn.iocoder.mall.promotion.api.enums.ProductRecommendTypeEnum;
 import lombok.Data;
 import lombok.experimental.Accessors;
 

File: promotion/promotion-service-impl/src/main/java/cn/iocoder/mall/promotion/biz/dataobject/PromotionActivityDO.java
Patch:
@@ -25,7 +25,7 @@ public class PromotionActivityDO extends BaseDO {
     /**
      * 活动类型
      *
-     * 参见 {@link cn.iocoder.mall.promotion.api.constant.PromotionActivityTypeEnum} 枚举
+     * 参见 {@link cn.iocoder.mall.promotion.api.enums.PromotionActivityTypeEnum} 枚举
      */
     private Integer activityType;
 //    /**
@@ -36,7 +36,7 @@ public class PromotionActivityDO extends BaseDO {
     /**
      * 活动状态
      *
-     * 参见 {@link cn.iocoder.mall.promotion.api.constant.PromotionActivityStatusEnum} 枚举
+     * 参见 {@link cn.iocoder.mall.promotion.api.enums.PromotionActivityStatusEnum} 枚举
      */
     private Integer status;
     /**
@@ -165,7 +165,7 @@ public static class Privilege {
         /**
          * 可用范围的类型
          *
-         * 参见 {@link cn.iocoder.mall.promotion.api.constant.RangeTypeEnum} 枚举
+         * 参见 {@link cn.iocoder.mall.promotion.api.enums.RangeTypeEnum} 枚举
          * 暂时只用 “所有可用” + “PRODUCT_INCLUDE_PRT”
          */
         private Integer rangeType;

File: promotion/promotion-service-impl/src/main/java/cn/iocoder/mall/promotion/biz/service/BannerServiceImpl.java
Patch:
@@ -6,7 +6,7 @@
 import cn.iocoder.mall.promotion.api.BannerService;
 import cn.iocoder.mall.promotion.api.bo.BannerBO;
 import cn.iocoder.mall.promotion.api.bo.BannerPageBO;
-import cn.iocoder.mall.promotion.api.constant.PromotionErrorCodeEnum;
+import cn.iocoder.mall.promotion.api.enums.PromotionErrorCodeEnum;
 import cn.iocoder.mall.promotion.api.dto.BannerAddDTO;
 import cn.iocoder.mall.promotion.api.dto.BannerPageDTO;
 import cn.iocoder.mall.promotion.api.dto.BannerUpdateDTO;

File: promotion/promotion-service-impl/src/main/java/cn/iocoder/mall/promotion/biz/service/CouponServiceImpl.java
Patch:
@@ -6,7 +6,7 @@
 import cn.iocoder.common.framework.util.StringUtil;
 import cn.iocoder.mall.promotion.api.CouponService;
 import cn.iocoder.mall.promotion.api.bo.*;
-import cn.iocoder.mall.promotion.api.constant.*;
+import cn.iocoder.mall.promotion.api.enums.*;
 import cn.iocoder.mall.promotion.api.dto.*;
 import cn.iocoder.mall.promotion.biz.convert.CouponCardConvert;
 import cn.iocoder.mall.promotion.biz.convert.CouponTemplateConvert;

File: promotion/promotion-service-impl/src/main/java/cn/iocoder/mall/promotion/biz/service/ProductRecommendServiceImpl.java
Patch:
@@ -7,7 +7,7 @@
 import cn.iocoder.mall.promotion.api.ProductRecommendService;
 import cn.iocoder.mall.promotion.api.bo.ProductRecommendBO;
 import cn.iocoder.mall.promotion.api.bo.ProductRecommendPageBO;
-import cn.iocoder.mall.promotion.api.constant.PromotionErrorCodeEnum;
+import cn.iocoder.mall.promotion.api.enums.PromotionErrorCodeEnum;
 import cn.iocoder.mall.promotion.api.dto.ProductRecommendAddDTO;
 import cn.iocoder.mall.promotion.api.dto.ProductRecommendPageDTO;
 import cn.iocoder.mall.promotion.api.dto.ProductRecommendUpdateDTO;

File: promotion/promotion-service-impl/src/main/java/cn/iocoder/mall/promotion/biz/service/PromotionActivityServiceImpl.java
Patch:
@@ -3,8 +3,8 @@
 import cn.iocoder.mall.promotion.api.PromotionActivityService;
 import cn.iocoder.mall.promotion.api.bo.PromotionActivityBO;
 import cn.iocoder.mall.promotion.api.bo.PromotionActivityPageBO;
-import cn.iocoder.mall.promotion.api.constant.PromotionActivityTypeEnum;
-import cn.iocoder.mall.promotion.api.constant.RangeTypeEnum;
+import cn.iocoder.mall.promotion.api.enums.PromotionActivityTypeEnum;
+import cn.iocoder.mall.promotion.api.enums.RangeTypeEnum;
 import cn.iocoder.mall.promotion.api.dto.PromotionActivityPageDTO;
 import cn.iocoder.mall.promotion.biz.convert.PromotionActivityConvert;
 import cn.iocoder.mall.promotion.biz.dao.PromotionActivityMapper;

File: promotion/promotion-start/src/main/java/cn/iocoder/mall/promotion/application/controller/admins/AdminsPromotionActivityController.java
Patch:
@@ -3,7 +3,7 @@
 import cn.iocoder.common.framework.vo.CommonResult;
 import cn.iocoder.mall.promotion.api.PromotionActivityService;
 import cn.iocoder.mall.promotion.api.bo.PromotionActivityPageBO;
-import cn.iocoder.mall.promotion.api.constant.PromotionActivityStatusEnum;
+import cn.iocoder.mall.promotion.api.enums.PromotionActivityStatusEnum;
 import cn.iocoder.mall.promotion.api.dto.PromotionActivityPageDTO;
 import io.swagger.annotations.Api;
 import org.apache.dubbo.config.annotation.Reference;

File: order/order-service-impl/src/main/java/cn/iocoder/mall/order/biz/service/CartServiceImpl.java
Patch:
@@ -19,7 +19,7 @@
 import cn.iocoder.mall.promotion.api.PromotionActivityService;
 import cn.iocoder.mall.promotion.api.bo.CouponCardDetailBO;
 import cn.iocoder.mall.promotion.api.bo.PromotionActivityBO;
-import cn.iocoder.mall.promotion.api.constant.*;
+import cn.iocoder.mall.promotion.api.enums.*;
 import org.apache.dubbo.config.annotation.Reference;
 import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.stereotype.Service;

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/CouponCardStatusEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 import cn.iocoder.common.framework.core.IntArrayValuable;
 

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/CouponCardTakeTypeEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 import cn.iocoder.common.framework.core.IntArrayValuable;
 

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/CouponTemplateDateTypeEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 import cn.iocoder.common.framework.core.IntArrayValuable;
 

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/CouponTemplateStatusEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 import cn.iocoder.common.framework.core.IntArrayValuable;
 

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/CouponTemplateTypeEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 import java.util.Arrays;
 

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/MeetTypeEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 /**
  * 匹配类型枚举

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/PreferentialTypeEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 import cn.iocoder.common.framework.core.IntArrayValuable;
 

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/ProductRecommendTypeEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 import cn.iocoder.common.framework.core.IntArrayValuable;
 

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/PromotionActivityStatusEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 /**
  * 促销活动状态枚举

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/PromotionActivityTypeEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 /**
  * 推广活动类型枚举

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/PromotionErrorCodeEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 /**
  * 错误码枚举类

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/enums/RangeTypeEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.constant;
+package cn.iocoder.mall.promotion.api.enums;
 
 import cn.iocoder.common.framework.core.IntArrayValuable;
 

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/activity/dto/PromotionActivityPageReqDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.activity.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -10,12 +10,12 @@
  */
 @Data
 @Accessors(chain = true)
-public class PromotionActivityPageBO {
+public class PromotionActivityPageReqDTO {
 
     /**
      * PromotionActivityBO 数组
      */
-    private List<PromotionActivityBO> list;
+    private List<PromotionActivityRespDTO> list;
     /**
      * 总量
      */

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/activity/dto/PromotionActivityPageRespDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.activity.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -12,7 +12,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class PromotionActivityPageDTO implements Serializable {
+public class PromotionActivityPageRespDTO implements Serializable {
 
     /**
      * 标题

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/banner/dto/BannerAddReqDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.banner.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -14,7 +14,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class BannerAddDTO implements Serializable {
+public class BannerAddReqDTO implements Serializable {
 
     @NotEmpty(message = "标题不能为空")
     @Length(min = 2, max = 32, message = "标题长度为 2-32 位")

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/banner/dto/BannerPageDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.banner.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/banner/dto/BannerPageRespDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.banner.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -11,12 +11,12 @@
  */
 @Data
 @Accessors(chain = true)
-public class BannerPageBO implements Serializable {
+public class BannerPageRespDTO implements Serializable {
 
     /**
      * Banner 数组
      */
-    private List<BannerBO> list;
+    private List<BannerRespDTO> list;
     /**
      * 总量
      */

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/banner/dto/BannerRespDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.banner.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -11,7 +11,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class BannerBO implements Serializable {
+public class BannerRespDTO implements Serializable {
 
     /**
      * 编号

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/banner/dto/BannerUpdateReqDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.banner.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -14,7 +14,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class BannerUpdateDTO implements Serializable {
+public class BannerUpdateReqDTO implements Serializable {
 
     @NotNull(message = "编号不能为空")
     private Integer id;

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponCardAvailableRespDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -10,7 +10,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class CouponCardAvailableBO extends CouponCardBO {
+public class CouponCardAvailableRespDTO extends CouponCardBO {
 
     /**
      * 是否可用

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponCardBO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponCardDetailBO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponCardPageBO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponCardPageReqDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -11,7 +11,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class CouponCardPageDTO implements Serializable {
+public class CouponCardPageReqDTO implements Serializable {
 
     /**
      * 用户编号

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponCodeTemplateAddReqDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -10,5 +10,5 @@
  */
 @Data
 @Accessors(chain = true)
-public class CouponCodeTemplateAddDTO implements Serializable {
+public class CouponCodeTemplateAddReqDTO implements Serializable {
 }

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponCodeTemplateUpdateReqDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -10,5 +10,5 @@
  */
 @Data
 @Accessors(chain = true)
-public class CouponCodeTemplateUpdateDTO implements Serializable {
+public class CouponCodeTemplateUpdateReqDTO implements Serializable {
 }

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponTemplateBO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponTemplatePageBO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/coupon/dto/CouponTemplatePageReqDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.coupon.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -11,7 +11,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class CouponTemplatePageDTO implements Serializable {
+public class CouponTemplatePageReqDTO implements Serializable {
 
     /**
      * 类型

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/recommend/dto/ProductRecommendAddReqDTO.java
Patch:
@@ -1,7 +1,7 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.recommend.dto;
 
 import cn.iocoder.common.framework.validator.InEnum;
-import cn.iocoder.mall.promotion.api.constant.ProductRecommendTypeEnum;
+import cn.iocoder.mall.promotion.api.enums.ProductRecommendTypeEnum;
 import lombok.Data;
 import lombok.experimental.Accessors;
 import org.hibernate.validator.constraints.Length;
@@ -14,7 +14,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class ProductRecommendAddDTO implements Serializable {
+public class ProductRecommendAddReqDTO implements Serializable {
 
     @InEnum(value = ProductRecommendTypeEnum.class, message = "修改推荐类型必须是 {value}")
     @NotNull(message = "推荐类型不能为空")

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/recommend/dto/ProductRecommendPageReqDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.recommend.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -11,7 +11,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class ProductRecommendPageDTO implements Serializable {
+public class ProductRecommendPageReqDTO implements Serializable {
 
     /**
      * 推荐类型

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/recommend/dto/ProductRecommendPageRespDTO.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.recommend.dto;
 
 import lombok.Data;
 import lombok.experimental.Accessors;
@@ -11,12 +11,12 @@
  */
 @Data
 @Accessors(chain = true)
-public class ProductRecommendPageBO implements Serializable {
+public class ProductRecommendPageRespDTO implements Serializable {
 
     /**
      * ProductRecommend 数组
      */
-    private List<ProductRecommendBO> list;
+    private List<ProductRecommendRespDTO> list;
     /**
      * 总量
      */

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/recommend/dto/ProductRecommendRespDTO.java
Patch:
@@ -1,6 +1,6 @@
-package cn.iocoder.mall.promotion.api.bo;
+package cn.iocoder.mall.promotion.api.rpc.recommend.dto;
 
-import cn.iocoder.mall.promotion.api.constant.ProductRecommendTypeEnum;
+import cn.iocoder.mall.promotion.api.enums.ProductRecommendTypeEnum;
 import lombok.Data;
 import lombok.experimental.Accessors;
 
@@ -12,7 +12,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class ProductRecommendBO implements Serializable {
+public class ProductRecommendRespDTO implements Serializable {
 
     /**
      * 编号

File: promotion-service-project/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/rpc/recommend/dto/ProductRecommendUpdateReqDTO.java
Patch:
@@ -1,7 +1,7 @@
-package cn.iocoder.mall.promotion.api.dto;
+package cn.iocoder.mall.promotion.api.rpc.recommend.dto;
 
 import cn.iocoder.common.framework.validator.InEnum;
-import cn.iocoder.mall.promotion.api.constant.ProductRecommendTypeEnum;
+import cn.iocoder.mall.promotion.api.enums.ProductRecommendTypeEnum;
 import lombok.Data;
 import lombok.experimental.Accessors;
 import org.hibernate.validator.constraints.Length;
@@ -14,7 +14,7 @@
  */
 @Data
 @Accessors(chain = true)
-public class ProductRecommendUpdateDTO implements Serializable {
+public class ProductRecommendUpdateReqDTO implements Serializable {
 
     @NotNull(message = "编号不能为空")
     private Integer id;

File: promotion/promotion-service-impl/src/main/java/cn/iocoder/mall/promotion/biz/config/ServiceExceptionConfiguration.java
Patch:
@@ -1,7 +1,7 @@
 package cn.iocoder.mall.promotion.biz.config;
 
 import cn.iocoder.common.framework.util.ServiceExceptionUtil;
-import cn.iocoder.mall.promotion.api.constant.PromotionErrorCodeEnum;
+import cn.iocoder.mall.promotion.api.enums.PromotionErrorCodeEnum;
 import org.springframework.boot.context.event.ApplicationReadyEvent;
 import org.springframework.context.annotation.Configuration;
 import org.springframework.context.event.EventListener;

File: promotion/promotion-service-impl/src/main/java/cn/iocoder/mall/promotion/biz/dataobject/CouponTemplateDO.java
Patch:
@@ -38,7 +38,7 @@ public class CouponTemplateDO extends BaseDO {
     /**
      * 优惠码状态
      *
-     * {@link cn.iocoder.mall.promotion.api.constant.CouponTemplateStatusEnum}
+     * {@link cn.iocoder.mall.promotion.api.enums.CouponTemplateStatusEnum}
      *
      * 当优惠劵（码）开启中，可以手动操作，设置禁用中。
      */

File: promotion/promotion-service-impl/src/main/java/cn/iocoder/mall/promotion/biz/dataobject/ProductRecommendDO.java
Patch:
@@ -2,7 +2,7 @@
 
 
 import cn.iocoder.mall.mybatis.core.dataobject.DeletableDO;
-import cn.iocoder.mall.promotion.api.constant.ProductRecommendTypeEnum;
+import cn.iocoder.mall.promotion.api.enums.ProductRecommendTypeEnum;
 import lombok.Data;
 import lombok.experimental.Accessors;
 

File: promotion/promotion-service-impl/src/main/java/cn/iocoder/mall/promotion/biz/dataobject/PromotionActivityDO.java
Patch:
@@ -25,7 +25,7 @@ public class PromotionActivityDO extends BaseDO {
     /**
      * 活动类型
      *
-     * 参见 {@link cn.iocoder.mall.promotion.api.constant.PromotionActivityTypeEnum} 枚举
+     * 参见 {@link cn.iocoder.mall.promotion.api.enums.PromotionActivityTypeEnum} 枚举
      */
     private Integer activityType;
 //    /**
@@ -36,7 +36,7 @@ public class PromotionActivityDO extends BaseDO {
     /**
      * 活动状态
      *
-     * 参见 {@link cn.iocoder.mall.promotion.api.constant.PromotionActivityStatusEnum} 枚举
+     * 参见 {@link cn.iocoder.mall.promotion.api.enums.PromotionActivityStatusEnum} 枚举
      */
     private Integer status;
     /**
@@ -165,7 +165,7 @@ public static class Privilege {
         /**
          * 可用范围的类型
          *
-         * 参见 {@link cn.iocoder.mall.promotion.api.constant.RangeTypeEnum} 枚举
+         * 参见 {@link cn.iocoder.mall.promotion.api.enums.RangeTypeEnum} 枚举
          * 暂时只用 “所有可用” + “PRODUCT_INCLUDE_PRT”
          */
         private Integer rangeType;

File: promotion/promotion-service-impl/src/main/java/cn/iocoder/mall/promotion/biz/service/BannerServiceImpl.java
Patch:
@@ -6,7 +6,7 @@
 import cn.iocoder.mall.promotion.api.BannerService;
 import cn.iocoder.mall.promotion.api.bo.BannerBO;
 import cn.iocoder.mall.promotion.api.bo.BannerPageBO;
-import cn.iocoder.mall.promotion.api.constant.PromotionErrorCodeEnum;
+import cn.iocoder.mall.promotion.api.enums.PromotionErrorCodeEnum;
 import cn.iocoder.mall.promotion.api.dto.BannerAddDTO;
 import cn.iocoder.mall.promotion.api.dto.BannerPageDTO;
 import cn.iocoder.mall.promotion.api.dto.BannerUpdateDTO;

File: promotion/promotion-service-impl/src/main/java/cn/iocoder/mall/promotion/biz/service/CouponServiceImpl.java
Patch:
@@ -6,7 +6,7 @@
 import cn.iocoder.common.framework.util.StringUtil;
 import cn.iocoder.mall.promotion.api.CouponService;
 import cn.iocoder.mall.promotion.api.bo.*;
-import cn.iocoder.mall.promotion.api.constant.*;
+import cn.iocoder.mall.promotion.api.enums.*;
 import cn.iocoder.mall.promotion.api.dto.*;
 import cn.iocoder.mall.promotion.biz.convert.CouponCardConvert;
 import cn.iocoder.mall.promotion.biz.convert.CouponTemplateConvert;

File: promotion/promotion-service-impl/src/main/java/cn/iocoder/mall/promotion/biz/service/ProductRecommendServiceImpl.java
Patch:
@@ -7,7 +7,7 @@
 import cn.iocoder.mall.promotion.api.ProductRecommendService;
 import cn.iocoder.mall.promotion.api.bo.ProductRecommendBO;
 import cn.iocoder.mall.promotion.api.bo.ProductRecommendPageBO;
-import cn.iocoder.mall.promotion.api.constant.PromotionErrorCodeEnum;
+import cn.iocoder.mall.promotion.api.enums.PromotionErrorCodeEnum;
 import cn.iocoder.mall.promotion.api.dto.ProductRecommendAddDTO;
 import cn.iocoder.mall.promotion.api.dto.ProductRecommendPageDTO;
 import cn.iocoder.mall.promotion.api.dto.ProductRecommendUpdateDTO;

File: promotion/promotion-service-impl/src/main/java/cn/iocoder/mall/promotion/biz/service/PromotionActivityServiceImpl.java
Patch:
@@ -3,8 +3,8 @@
 import cn.iocoder.mall.promotion.api.PromotionActivityService;
 import cn.iocoder.mall.promotion.api.bo.PromotionActivityBO;
 import cn.iocoder.mall.promotion.api.bo.PromotionActivityPageBO;
-import cn.iocoder.mall.promotion.api.constant.PromotionActivityTypeEnum;
-import cn.iocoder.mall.promotion.api.constant.RangeTypeEnum;
+import cn.iocoder.mall.promotion.api.enums.PromotionActivityTypeEnum;
+import cn.iocoder.mall.promotion.api.enums.RangeTypeEnum;
 import cn.iocoder.mall.promotion.api.dto.PromotionActivityPageDTO;
 import cn.iocoder.mall.promotion.biz.convert.PromotionActivityConvert;
 import cn.iocoder.mall.promotion.biz.dao.PromotionActivityMapper;

File: promotion/promotion-start/src/main/java/cn/iocoder/mall/promotion/application/controller/admins/AdminsPromotionActivityController.java
Patch:
@@ -3,7 +3,7 @@
 import cn.iocoder.common.framework.vo.CommonResult;
 import cn.iocoder.mall.promotion.api.PromotionActivityService;
 import cn.iocoder.mall.promotion.api.bo.PromotionActivityPageBO;
-import cn.iocoder.mall.promotion.api.constant.PromotionActivityStatusEnum;
+import cn.iocoder.mall.promotion.api.enums.PromotionActivityStatusEnum;
 import cn.iocoder.mall.promotion.api.dto.PromotionActivityPageDTO;
 import io.swagger.annotations.Api;
 import org.apache.dubbo.config.annotation.Reference;

File: management-web-app/src/main/java/cn/iocoder/mall/managementweb/controller/admin/AdminController.java
Patch:
@@ -56,7 +56,7 @@ public CommonResult<Boolean> updateAdmin(AdminUpdateInfoDTO updateInfoDTO) {
     @PostMapping("/update-status")
     @ApiOperation(value = "更新管理员状态")
     @RequiresPermissions("system:admin:update-status")
-    public CommonResult<Boolean> updateUserStatus(AdminUpdateStatusDTO updateStatusDTO) {
+    public CommonResult<Boolean> updateAdminStatus(AdminUpdateStatusDTO updateStatusDTO) {
         adminManager.updateAdminStatus(updateStatusDTO);
         return success(true);
     }

File: management-web-app/src/main/java/cn/iocoder/mall/managementweb/controller/admin/dto/AdminUpdateStatusDTO.java
Patch:
@@ -16,7 +16,7 @@ public class AdminUpdateStatusDTO {
 
     @ApiModelProperty(value = "管理员编号", required = true, example = "1")
     @NotNull(message = "管理员编号不能为空")
-    private Integer id;
+    private Integer adminId;
 
     @ApiModelProperty(value = "状态", required = true, example = "1", notes = "见 CommonStatusEnum 枚举")
     @NotNull(message = "状态不能为空")

File: management-web-app/src/main/java/cn/iocoder/mall/managementweb/convert/admin/AdminConvert.java
Patch:
@@ -11,6 +11,7 @@
 import cn.iocoder.mall.systemservice.rpc.admin.vo.DepartmentVO;
 import cn.iocoder.mall.systemservice.rpc.permission.vo.RoleVO;
 import org.mapstruct.Mapper;
+import org.mapstruct.Mapping;
 import org.mapstruct.factory.Mappers;
 
 import java.util.List;
@@ -24,6 +25,7 @@ public interface AdminConvert {
 
     AdminUpdateDTO convert(AdminUpdateInfoDTO bean);
 
+    @Mapping(source = "adminId", target = "id")
     AdminUpdateDTO convert(AdminUpdateStatusDTO bean);
 
     AdminPageDTO convert(cn.iocoder.mall.managementweb.controller.admin.dto.AdminPageDTO bean);

File: system/system-biz/src/main/java/cn/iocoder/mall/system/biz/enums/userAddress/UserAddressHasDefaultEnum.java
Patch:
@@ -1,4 +1,4 @@
-package cn.iocoder.mall.system.biz.enums;
+package cn.iocoder.mall.system.biz.enums.userAddress;
 
 /**
  * 用户地址 - 用户默认地址

File: system/system-biz/src/main/java/cn/iocoder/mall/system/biz/service/sms/SmsClientOfYunPian.java
Patch:
@@ -1,7 +1,7 @@
 package cn.iocoder.mall.system.biz.service.sms;
 
 import cn.iocoder.common.framework.exception.ServiceException;
-import cn.iocoder.mall.system.biz.enums.AdminErrorCodeEnum;
+import cn.iocoder.mall.system.biz.enums.SystemErrorCodeEnum;
 import com.alibaba.fastjson.JSON;
 import com.alibaba.fastjson.JSONObject;
 import org.apache.http.HttpEntity;
@@ -111,7 +111,7 @@ public SendResult singleSend(String mobile, String sign, String templateCode, St
         JSONObject jsonObject = JSON.parseObject(result);
         if (jsonObject.containsKey("code")
                 && !(jsonObject.getInteger("code") == SUCCESS_CODE)) {
-            throw new ServiceException(AdminErrorCodeEnum.SMS_PLATFORM_FAIL.getCode(),
+            throw new ServiceException(SystemErrorCodeEnum.SMS_PLATFORM_FAIL.getCode(),
                     jsonObject.getString("detail"));
         }
 
@@ -156,7 +156,7 @@ public SendResult batchSend(List<String> mobileList, String sign,
             JSONObject jsonObject = JSON.parseObject(result);
             if (jsonObject.containsKey("code")
                     && !(jsonObject.getInteger("code") == SUCCESS_CODE)) {
-                throw new ServiceException(AdminErrorCodeEnum.SMS_PLATFORM_FAIL.getCode(),
+                throw new ServiceException(SystemErrorCodeEnum.SMS_PLATFORM_FAIL.getCode(),
                         jsonObject.getString("detail"));
             }
 

File: common/common-framework/src/main/java/cn/iocoder/common/framework/util/ServiceExceptionUtil.java
Patch:
@@ -39,7 +39,7 @@ public static void put(Integer code, String message) {
         ServiceExceptionUtil.messages.put(code, message);
     }
 
-    // TODO 芋艿，可能不是目前最优解，目前暂时这样
+    // TODO 芋艿，可能不是目前最优解，目前暂时这样 枚举实现接口
     public static <T> CommonResult<T> error(Integer code) {
         return CommonResult.error(code, messages.get(code));
     }

File: system/system-service-impl/src/main/java/cn/iocoder/mall/admin/client/SmsAliYunClient.java
Patch:
@@ -25,9 +25,9 @@
 @Component
 public class SmsAliYunClient implements SmsClient {
 
-    @Value("${sms.aliYun.accessKeyId}")
+    @Value("${sms.aliYun.accessKeyId?:'default_value'}")
     private String accessKeyId;
-    @Value("${sms.aliYun.accessSecret}")
+    @Value("${sms.aliYun.accessSecret?:'default_value'}")
     private String accessSecret;
 
     private static final String DOMAIN = "dysmsapi.aliyuncs.com";

File: system/system-service-impl/src/main/java/cn/iocoder/mall/admin/client/SmsYunPianClient.java
Patch:
@@ -91,7 +91,7 @@ public class SmsYunPianClient implements SmsClient {
     //编码格式。发送编码格式统一用UTF-8
     private static String ENCODING = "UTF-8";
 
-    @Value("${sms.yunPian.apiKey}")
+    @Value("${sms.yunPian.apiKey?:'default_value'}")
     private String apiKey;
 
     @Override

File: system/system-service-api/src/main/java/cn/iocoder/mall/admin/api/dto/AdminAddDTO.java
Patch:
@@ -6,13 +6,14 @@
 
 import javax.validation.constraints.NotEmpty;
 import javax.validation.constraints.Pattern;
+import java.io.Serializable;
 
 /**
  * 管理员添加 DTO
  */
 @Data
 @Accessors(chain = true)
-public class AdminAddDTO {
+public class AdminAddDTO implements Serializable {
 
     /**
      * 登陆账号

File: system/system-service-api/src/main/java/cn/iocoder/mall/admin/api/dto/AdminPageDTO.java
Patch:
@@ -4,13 +4,14 @@
 import lombok.experimental.Accessors;
 
 import javax.validation.constraints.NotNull;
+import java.io.Serializable;
 
 /**
  * 管理员分页 DTO
  */
 @Data
 @Accessors(chain = true)
-public class AdminPageDTO {
+public class AdminPageDTO implements Serializable {
 
     /**
      * 昵称，模糊匹配

File: system/system-service-api/src/main/java/cn/iocoder/mall/admin/api/dto/AdminUpdateDTO.java
Patch:
@@ -7,13 +7,14 @@
 import javax.validation.constraints.NotEmpty;
 import javax.validation.constraints.NotNull;
 import javax.validation.constraints.Pattern;
+import java.io.Serializable;
 
 /**
  * 管理员更新 DTO
  */
 @Data
 @Accessors(chain = true)
-public class AdminUpdateDTO {
+public class AdminUpdateDTO implements Serializable {
 
     /**
      * 管理员编号

File: system/system-service-api/src/main/java/cn/iocoder/mall/admin/api/dto/DataDictAddDTO.java
Patch:
@@ -5,13 +5,14 @@
 
 import javax.validation.constraints.NotEmpty;
 import javax.validation.constraints.NotNull;
+import java.io.Serializable;
 
 /**
  * 数据字典添加 DTO
  */
 @Data
 @Accessors(chain = true)
-public class DataDictAddDTO {
+public class DataDictAddDTO implements Serializable {
 
     /**
      * 大类枚举值

File: system/system-service-api/src/main/java/cn/iocoder/mall/admin/api/dto/DataDictUpdateDTO.java
Patch:
@@ -5,13 +5,14 @@
 
 import javax.validation.constraints.NotEmpty;
 import javax.validation.constraints.NotNull;
+import java.io.Serializable;
 
 /**
  * 数据字典更新 DTO
  */
 @Data
 @Accessors(chain = true)
-public class DataDictUpdateDTO {
+public class DataDictUpdateDTO implements Serializable {
 
     /**
      * 编号

File: system/system-service-api/src/main/java/cn/iocoder/mall/admin/api/dto/ExceptionLogAddDTO.java
Patch:
@@ -4,14 +4,15 @@
 import lombok.experimental.Accessors;
 
 import javax.validation.constraints.NotNull;
+import java.io.Serializable;
 import java.util.Date;
 
 /**
  * 异常日志添加 DTO
  */
 @Data
 @Accessors(chain = true)
-public class ExceptionLogAddDTO {
+public class ExceptionLogAddDTO implements Serializable {
 
     /**
      * 用户编号 - 空

File: system/system-service-api/src/main/java/cn/iocoder/mall/admin/api/dto/ResourceAddDTO.java
Patch:
@@ -5,13 +5,14 @@
 
 import javax.validation.constraints.NotEmpty;
 import javax.validation.constraints.NotNull;
+import java.io.Serializable;
 
 /**
  * 资源添加 DTO
  */
 @Data
 @Accessors(chain = true)
-public class ResourceAddDTO {
+public class ResourceAddDTO implements Serializable {
 
     /**
      * 资源名字（标识）

File: system/system-service-api/src/main/java/cn/iocoder/mall/admin/api/dto/ResourceUpdateDTO.java
Patch:
@@ -5,13 +5,14 @@
 
 import javax.validation.constraints.NotEmpty;
 import javax.validation.constraints.NotNull;
+import java.io.Serializable;
 
 /**
  * 资源更新 DTO
  */
 @Data
 @Accessors(chain = true)
-public class ResourceUpdateDTO {
+public class ResourceUpdateDTO implements Serializable {
 
     /**
      * 资源编号

File: system/system-service-api/src/main/java/cn/iocoder/mall/admin/api/dto/RoleAddDTO.java
Patch:
@@ -4,13 +4,14 @@
 import lombok.experimental.Accessors;
 
 import javax.validation.constraints.NotEmpty;
+import java.io.Serializable;
 
 /**
  * 角色添加 DTO
  */
 @Data
 @Accessors(chain = true)
-public class RoleAddDTO {
+public class RoleAddDTO implements Serializable {
 
     /**
      * 角色名字（标识）

File: system/system-service-api/src/main/java/cn/iocoder/mall/admin/api/dto/RolePageDTO.java
Patch:
@@ -3,12 +3,14 @@
 import lombok.Data;
 import lombok.experimental.Accessors;
 
+import java.io.Serializable;
+
 /**
  * 角色分页 DTO
  */
 @Data
 @Accessors(chain = true)
-public class RolePageDTO {
+public class RolePageDTO implements Serializable {
 
     private Integer pageNo;
     private Integer pageSize;

File: system/system-service-api/src/main/java/cn/iocoder/mall/admin/api/dto/RoleUpdateDTO.java
Patch:
@@ -5,13 +5,14 @@
 
 import javax.validation.constraints.NotEmpty;
 import javax.validation.constraints.NotNull;
+import java.io.Serializable;
 
 /**
  * 角色添加 DTO
  */
 @Data
 @Accessors(chain = true)
-public class RoleUpdateDTO {
+public class RoleUpdateDTO implements Serializable {
 
     /**
      * 角色编号

File: product/product-application/src/main/java/cn/iocoder/mall/product/application/controller/admins/AdminsProductSpuController.java
Patch:
@@ -84,7 +84,7 @@ public CommonResult<Boolean> update(@RequestParam("id") Integer id,
                                         @RequestParam("sellPoint") String sellPoint,
                                         @RequestParam("description") String description,
                                         @RequestParam("cid") Integer cid,
-                                        @RequestParam("picURLs") List<String> picUrls,
+                                        @RequestParam("picUrls") List<String> picUrls,
                                         @RequestParam("visible") Boolean visible,
                                         @RequestParam("skuStr") String skuStr) { // TODO 芋艿，因为考虑不使用 json 接受参数，所以这里手动转。
         // 创建 ProductSpuUpdateDTO 对象

File: admin/admin-application/src/main/java/cn/iocoder/mall/admin/application/controller/admins/DataDictController.java
Patch:
@@ -16,6 +16,7 @@
 import io.swagger.annotations.ApiImplicitParam;
 import io.swagger.annotations.ApiImplicitParams;
 import io.swagger.annotations.ApiOperation;
+import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.web.bind.annotation.*;
 
 import java.util.ArrayList;
@@ -26,7 +27,8 @@
 @Api("数据字典模块")
 public class DataDictController {
 
-    @Reference(validation = "true", lazy = true)
+    @Reference(validation = "true")
+    @Autowired // TODO Dubbo 2.7.2 移除 bug
     private DataDictService dataDictService;
 
     @GetMapping("/list")

File: admin/admin-application/src/main/java/cn/iocoder/mall/admin/application/controller/admins/PassportController.java
Patch:
@@ -10,6 +10,7 @@
 import io.swagger.annotations.ApiImplicitParams;
 import io.swagger.annotations.ApiOperation;
 import org.apache.dubbo.config.annotation.Reference;
+import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.web.bind.annotation.PostMapping;
 import org.springframework.web.bind.annotation.RequestMapping;
 import org.springframework.web.bind.annotation.RequestParam;
@@ -20,7 +21,8 @@
 @Api("Admin Passport 模块")
 public class PassportController {
 
-    @Reference(validation = "true", lazy = true)
+    @Reference(validation = "true")
+    @Autowired // TODO Dubbo 2.7.2 移除 bug
     private OAuth2Service oauth2Service;
 
     @PostMapping("/login")

File: admin/admin-application/src/main/java/cn/iocoder/mall/admin/application/controller/admins/ResourceController.java
Patch:
@@ -15,6 +15,7 @@
 import io.swagger.annotations.ApiImplicitParam;
 import io.swagger.annotations.ApiImplicitParams;
 import io.swagger.annotations.ApiOperation;
+import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.web.bind.annotation.*;
 
 import java.util.ArrayList;
@@ -28,7 +29,8 @@
 @Api("资源模块")
 public class ResourceController {
 
-    @Reference(validation = "true", lazy = true)
+    @Reference(validation = "true")
+    @Autowired // TODO Dubbo 2.7.2 移除 bug
     private ResourceService resourceService;
 
     @SuppressWarnings("Duplicates")

File: admin/admin-sdk/src/main/java/cn/iocoder/mall/admin/sdk/interceptor/AdminAccessLogInterceptor.java
Patch:
@@ -8,6 +8,7 @@
 import org.apache.dubbo.config.annotation.Reference;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
+import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.stereotype.Component;
 import org.springframework.web.servlet.handler.HandlerInterceptorAdapter;
 
@@ -32,7 +33,8 @@ public class AdminAccessLogInterceptor extends HandlerInterceptorAdapter {
      */
     private static final ThreadLocal<Integer> ADMIN_ID = new ThreadLocal<>();
 
-    @Reference(lazy = true) // TODO 芋艿，初始化时，会存在 spring boot 启动时，服务无法引用的情况，先暂时这么解决。
+    @Reference(lazy = true)
+    @Autowired(required = false) // TODO 芋艿，初始化时，会存在 spring boot 启动时，服务无法引用的情况，先暂时这么解决。
     private AdminAccessLogService adminAccessLogService;
 
     @Override

File: admin/admin-sdk/src/main/java/cn/iocoder/mall/admin/sdk/interceptor/AdminSecurityInterceptor.java
Patch:
@@ -9,6 +9,7 @@
 import cn.iocoder.mall.admin.sdk.context.AdminSecurityContext;
 import cn.iocoder.mall.admin.sdk.context.AdminSecurityContextHolder;
 import org.apache.dubbo.config.annotation.Reference;
+import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.stereotype.Component;
 import org.springframework.web.servlet.handler.HandlerInterceptorAdapter;
 
@@ -22,7 +23,8 @@
 @Component
 public class AdminSecurityInterceptor extends HandlerInterceptorAdapter {
 
-    @Reference(lazy = true) // TODO 芋艿，初始化时，会存在 spring boot 启动时，服务无法引用的情况，先暂时这么解决。
+    @Reference(validation = "true")
+    @Autowired(required = false) // TODO 芋艿，初始化时，会存在 spring boot 启动时，服务无法引用的情况，先暂时这么解决。
     private OAuth2Service oauth2Service;
 
     @Override

File: product/product-application/src/main/java/cn/iocoder/mall/product/application/controller/admins/AdminsProductAttrController.java
Patch:
@@ -18,6 +18,7 @@
 import io.swagger.annotations.ApiImplicitParam;
 import io.swagger.annotations.ApiImplicitParams;
 import io.swagger.annotations.ApiOperation;
+import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.web.bind.annotation.*;
 
 import java.util.List;
@@ -28,6 +29,7 @@
 public class AdminsProductAttrController {
 
     @Reference(validation = "true")
+    @Autowired
     private ProductAttrService productAttrService;
 
     @GetMapping("/attr/page")

File: product/product-application/src/main/java/cn/iocoder/mall/product/application/controller/admins/AdminsProductCategoryController.java
Patch:
@@ -15,6 +15,7 @@
 import io.swagger.annotations.ApiImplicitParam;
 import io.swagger.annotations.ApiImplicitParams;
 import io.swagger.annotations.ApiOperation;
+import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.web.bind.annotation.*;
 
 import java.util.ArrayList;
@@ -29,6 +30,7 @@
 public class AdminsProductCategoryController {
 
     @Reference(validation = "true")
+    @Autowired
     private ProductCategoryService productCategoryService;
 
     @GetMapping("/tree")

File: product/product-application/src/main/java/cn/iocoder/mall/product/application/controller/admins/AdminsProductSpuController.java
Patch:
@@ -31,6 +31,7 @@
 public class AdminsProductSpuController {
 
     @Reference(validation = "true")
+    @Autowired
     private ProductSpuService productSpuService;
 
     @Autowired

File: product/product-application/src/main/java/cn/iocoder/mall/product/application/controller/users/UsersProductCategoryController.java
Patch:
@@ -10,6 +10,7 @@
 import io.swagger.annotations.Api;
 import io.swagger.annotations.ApiImplicitParam;
 import io.swagger.annotations.ApiOperation;
+import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.web.bind.annotation.GetMapping;
 import org.springframework.web.bind.annotation.RequestMapping;
 import org.springframework.web.bind.annotation.RequestParam;
@@ -23,6 +24,7 @@
 public class UsersProductCategoryController {
 
     @Reference(validation = "true")
+    @Autowired
     private ProductCategoryService productCategoryService;
 
     @GetMapping("/list")

File: product/product-application/src/main/java/cn/iocoder/mall/product/application/controller/users/UsersProductSpuController.java
Patch:
@@ -13,6 +13,7 @@
 import io.swagger.annotations.ApiImplicitParam;
 import io.swagger.annotations.ApiImplicitParams;
 import io.swagger.annotations.ApiOperation;
+import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.web.bind.annotation.GetMapping;
 import org.springframework.web.bind.annotation.RequestMapping;
 import org.springframework.web.bind.annotation.RequestParam;
@@ -24,6 +25,7 @@
 public class UsersProductSpuController {
 
     @Reference(validation = "true")
+    @Autowired
     private ProductSpuService productSpuService;
 
     @GetMapping("/info")

File: admin/admin-application/src/main/java/cn/iocoder/mall/admin/application/controller/admins/DataDictController.java
Patch:
@@ -9,7 +9,7 @@
 import cn.iocoder.mall.admin.application.vo.DataDictEnumVO;
 import cn.iocoder.mall.admin.application.vo.DataDictVO;
 import cn.iocoder.mall.admin.sdk.context.AdminSecurityContextHolder;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import com.google.common.collect.ImmutableListMultimap;
 import com.google.common.collect.Multimaps;
 import io.swagger.annotations.Api;
@@ -26,7 +26,7 @@
 @Api("数据字典模块")
 public class DataDictController {
 
-    @Reference(validation = "true")
+    @Reference(validation = "true", lazy = true)
     private DataDictService dataDictService;
 
     @GetMapping("/list")
@@ -107,4 +107,4 @@ public CommonResult<Boolean> delete(@RequestParam("id") Integer id) {
         return dataDictService.deleteDataDict(AdminSecurityContextHolder.getContext().getAdminId(), id);
     }
 
-}
\ No newline at end of file
+}

File: admin/admin-application/src/main/java/cn/iocoder/mall/admin/application/controller/admins/PassportController.java
Patch:
@@ -5,11 +5,11 @@
 import cn.iocoder.mall.admin.api.bo.OAuth2AccessTokenBO;
 import cn.iocoder.mall.admin.application.convert.PassportConvert;
 import cn.iocoder.mall.admin.application.vo.PassportLoginVO;
-import com.alibaba.dubbo.config.annotation.Reference;
 import io.swagger.annotations.Api;
 import io.swagger.annotations.ApiImplicitParam;
 import io.swagger.annotations.ApiImplicitParams;
 import io.swagger.annotations.ApiOperation;
+import org.apache.dubbo.config.annotation.Reference;
 import org.springframework.web.bind.annotation.PostMapping;
 import org.springframework.web.bind.annotation.RequestMapping;
 import org.springframework.web.bind.annotation.RequestParam;
@@ -20,7 +20,7 @@
 @Api("Admin Passport 模块")
 public class PassportController {
 
-    @Reference
+    @Reference(validation = "true", lazy = true)
     private OAuth2Service oauth2Service;
 
     @PostMapping("/login")
@@ -39,4 +39,4 @@ public CommonResult<PassportLoginVO> login(@RequestParam("username") String user
 
     // TODO 功能 refresh_token
 
-}
\ No newline at end of file
+}

File: admin/admin-application/src/main/java/cn/iocoder/mall/admin/application/controller/admins/ResourceController.java
Patch:
@@ -10,7 +10,7 @@
 import cn.iocoder.mall.admin.application.vo.ResourceTreeNodeVO;
 import cn.iocoder.mall.admin.application.vo.ResourceVO;
 import cn.iocoder.mall.admin.sdk.context.AdminSecurityContextHolder;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import io.swagger.annotations.Api;
 import io.swagger.annotations.ApiImplicitParam;
 import io.swagger.annotations.ApiImplicitParams;
@@ -28,7 +28,7 @@
 @Api("资源模块")
 public class ResourceController {
 
-    @Reference(validation = "true")
+    @Reference(validation = "true", lazy = true)
     private ResourceService resourceService;
 
     @SuppressWarnings("Duplicates")
@@ -106,4 +106,4 @@ public CommonResult<Boolean> delete(@RequestParam("id") Integer id) {
         return resourceService.deleteResource(AdminSecurityContextHolder.getContext().getAdminId(), id);
     }
 
-}
\ No newline at end of file
+}

File: admin/admin-sdk/src/main/java/cn/iocoder/mall/admin/sdk/interceptor/AdminSecurityInterceptor.java
Patch:
@@ -8,7 +8,7 @@
 import cn.iocoder.mall.admin.api.constant.AdminErrorCodeEnum;
 import cn.iocoder.mall.admin.sdk.context.AdminSecurityContext;
 import cn.iocoder.mall.admin.sdk.context.AdminSecurityContextHolder;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import org.springframework.stereotype.Component;
 import org.springframework.web.servlet.handler.HandlerInterceptorAdapter;
 
@@ -22,7 +22,7 @@
 @Component
 public class AdminSecurityInterceptor extends HandlerInterceptorAdapter {
 
-    @Reference
+    @Reference(lazy = true) // TODO 芋艿，初始化时，会存在 spring boot 启动时，服务无法引用的情况，先暂时这么解决。
     private OAuth2Service oauth2Service;
 
     @Override
@@ -74,4 +74,4 @@ private void checkPermission(HttpServletRequest request, OAuth2AuthenticationBO
         }
     }
 
-}
\ No newline at end of file
+}

File: admin/admin-service-api/src/main/java/cn/iocoder/mall/admin/api/bo/AdminBO.java
Patch:
@@ -3,14 +3,15 @@
 import lombok.Data;
 import lombok.experimental.Accessors;
 
+import java.io.Serializable;
 import java.util.Date;
 
 /**
  * 管理员 BO
  */
 @Data
 @Accessors(chain = true)
-public class AdminBO {
+public class AdminBO implements Serializable {
 
     /**
      * 管理员编号

File: admin/admin-service-api/src/main/java/cn/iocoder/mall/admin/api/bo/AdminPageBO.java
Patch:
@@ -3,14 +3,15 @@
 import lombok.Data;
 import lombok.experimental.Accessors;
 
+import java.io.Serializable;
 import java.util.List;
 
 /**
  * 管理员分页 BO
  */
 @Data
 @Accessors(chain = true)
-public class AdminPageBO {
+public class AdminPageBO implements Serializable {
 
     /**
      * 管理员数组

File: admin/admin-service-api/src/main/java/cn/iocoder/mall/admin/api/bo/ResourceBO.java
Patch:
@@ -3,14 +3,15 @@
 import lombok.Data;
 import lombok.experimental.Accessors;
 
+import java.io.Serializable;
 import java.util.Date;
 
 /**
  * 资源 BO
  */
 @Data
 @Accessors(chain = true)
-public class ResourceBO {
+public class ResourceBO implements Serializable {
 
     /**
      * 资源编号

File: admin/admin-service-api/src/main/java/cn/iocoder/mall/admin/api/bo/RoleBO.java
Patch:
@@ -3,14 +3,15 @@
 import lombok.Data;
 import lombok.experimental.Accessors;
 
+import java.io.Serializable;
 import java.util.Date;
 
 /**
  * 角色 BO
  */
 @Data
 @Accessors(chain = true)
-public class RoleBO {
+public class RoleBO implements Serializable {
 
     /**
      * 角色编号

File: admin/admin-service-api/src/main/java/cn/iocoder/mall/admin/api/bo/RolePageBO.java
Patch:
@@ -3,14 +3,15 @@
 import lombok.Data;
 import lombok.experimental.Accessors;
 
+import java.io.Serializable;
 import java.util.List;
 
 /**
  * 角色分页 BO
  */
 @Data
 @Accessors(chain = true)
-public class RolePageBO {
+public class RolePageBO implements Serializable {
 
     /**
      * 角色数组

File: admin/admin-service-api/src/main/java/cn/iocoder/mall/admin/api/dto/AdminAccessLogAddDTO.java
Patch:
@@ -5,14 +5,15 @@
 import lombok.experimental.Accessors;
 
 import javax.validation.constraints.NotNull;
+import java.io.Serializable;
 import java.util.Date;
 
 /**
  * 管理员访问日志添加 DTO
  */
 @Data
 @Accessors(chain = true)
-public class AdminAccessLogAddDTO {
+public class AdminAccessLogAddDTO implements Serializable {
 
     /**
      * 管理员编号 - 空

File: admin/admin-service-impl/src/main/java/cn/iocoder/mall/admin/service/AdminAccessLogServiceImpl.java
Patch:
@@ -13,7 +13,7 @@
 import java.util.Date;
 
 @Service
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class AdminAccessLogServiceImpl implements AdminAccessLogService {
 
     /**
@@ -53,4 +53,4 @@ public CommonResult<Boolean> addAdminAccessLog(AdminAccessLogAddDTO adminAccessL
         return CommonResult.success(true);
     }
 
-}
\ No newline at end of file
+}

File: admin/admin-service-impl/src/main/java/cn/iocoder/mall/admin/service/AdminServiceImpl.java
Patch:
@@ -29,7 +29,7 @@
 import java.util.stream.Collectors;
 
 @Service
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class AdminServiceImpl implements AdminService {
 
     @Autowired

File: admin/admin-service-impl/src/main/java/cn/iocoder/mall/admin/service/DataDictServiceImpl.java
Patch:
@@ -24,7 +24,7 @@
  * 数据字典 Service
  */
 @Service
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class DataDictServiceImpl implements DataDictService {
 
     @Autowired
@@ -111,4 +111,4 @@ public CommonResult<List<DataDictBO>> getDataDictList(String dictKey, Collection
         List<DataDictBO> dataDictBOList = DataDictConvert.INSTANCE.convert(dataDictDOList);
         return CommonResult.success(dataDictBOList);
     }
-}
\ No newline at end of file
+}

File: admin/admin-service-impl/src/main/java/cn/iocoder/mall/admin/service/OAuth2ServiceImpl.java
Patch:
@@ -21,7 +21,7 @@
 import java.util.UUID;
 
 @Service
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class OAuth2ServiceImpl implements OAuth2Service {
 
     /**
@@ -142,4 +142,4 @@ private String generateRefreshToken() {
         return UUID.randomUUID().toString().replaceAll("-", "");
     }
 
-}
\ No newline at end of file
+}

File: admin/admin-service-impl/src/main/java/cn/iocoder/mall/admin/service/ResourceServiceImpl.java
Patch:
@@ -24,7 +24,7 @@
 import java.util.Set;
 
 @Service
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class ResourceServiceImpl implements ResourceService {
 
     @Autowired
@@ -156,4 +156,4 @@ private boolean checkParentExists(Integer pid) {
         return false;
     }
 
-}
\ No newline at end of file
+}

File: admin/admin-service-impl/src/main/java/cn/iocoder/mall/admin/service/RoleServiceImpl.java
Patch:
@@ -30,7 +30,7 @@
 import java.util.stream.Collectors;
 
 @Service
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class RoleServiceImpl implements RoleService {
 
     @Autowired
@@ -160,4 +160,4 @@ public List<RoleDO> getRoles(Set<Integer> roleIds) {
         return roleMapper.selectListByIds(roleIds);
     }
 
-}
\ No newline at end of file
+}

File: order/order-application/src/main/java/cn/iocoder/mall/order/application/controller/users/OrderController.java
Patch:
@@ -21,7 +21,7 @@
 import cn.iocoder.mall.order.application.po.user.OrderReturnApplyPO;
 import cn.iocoder.mall.order.application.vo.UsersOrderConfirmCreateVO;
 import cn.iocoder.mall.user.sdk.context.UserSecurityContextHolder;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import io.swagger.annotations.Api;
 import io.swagger.annotations.ApiOperation;
 import org.springframework.validation.annotation.Validated;

File: order/order-application/src/main/java/cn/iocoder/mall/order/application/controller/users/OrderLogisticsController.java
Patch:
@@ -10,7 +10,7 @@
 import cn.iocoder.mall.order.api.constant.DictKeyConstants;
 import cn.iocoder.mall.order.api.constant.OrderErrorCodeEnum;
 import cn.iocoder.mall.user.sdk.context.UserSecurityContextHolder;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import io.swagger.annotations.Api;
 import io.swagger.annotations.ApiOperation;
 import org.springframework.util.CollectionUtils;

File: order/order-application/src/main/java/cn/iocoder/mall/order/application/controller/users/OrderReturnController.java
Patch:
@@ -9,7 +9,7 @@
 import cn.iocoder.mall.order.api.dto.OrderReturnApplyDTO;
 import cn.iocoder.mall.order.application.convert.OrderReturnConvert;
 import cn.iocoder.mall.order.application.po.user.OrderReturnApplyPO;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import io.swagger.annotations.ApiOperation;
 import org.springframework.web.bind.annotation.*;
 

File: order/order-application/src/main/java/cn/iocoder/mall/order/application/controller/users/UsersCartController.java
Patch:
@@ -15,7 +15,7 @@
 import cn.iocoder.mall.promotion.api.bo.CouponCardAvailableBO;
 import cn.iocoder.mall.user.sdk.annotation.PermitAll;
 import cn.iocoder.mall.user.sdk.context.UserSecurityContextHolder;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import org.springframework.web.bind.annotation.*;
 
 import java.util.ArrayList;

File: order/order-service-impl/src/main/java/cn/iocoder/mall/order/biz/service/CartServiceImpl.java
Patch:
@@ -21,7 +21,7 @@
 import cn.iocoder.mall.promotion.api.bo.CouponCardDetailBO;
 import cn.iocoder.mall.promotion.api.bo.PromotionActivityBO;
 import cn.iocoder.mall.promotion.api.constant.*;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.stereotype.Service;
 import org.springframework.util.Assert;
@@ -33,7 +33,7 @@
  * 购物车服务 Service 实现类
  */
 @Service
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class CartServiceImpl implements CartService {
 
     @Reference(validation = "true")

File: order/order-service-impl/src/main/java/cn/iocoder/mall/order/biz/service/OrderLogisticsServiceImpl.java
Patch:
@@ -34,7 +34,7 @@
  * @time 2019-04-12 21:32
  */
 @Service
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class OrderLogisticsServiceImpl implements OrderLogisticsService {
 
     @Autowired

File: order/order-service-impl/src/main/java/cn/iocoder/mall/order/biz/service/OrderServiceImpl.java
Patch:
@@ -21,7 +21,7 @@
 import cn.iocoder.mall.promotion.api.CouponService;
 import cn.iocoder.mall.user.api.UserAddressService;
 import cn.iocoder.mall.user.api.bo.UserAddressBO;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import com.google.common.collect.Lists;
 import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.stereotype.Service;
@@ -39,7 +39,7 @@
  * @time 2019-03-16 15:08
  */
 @Service
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class OrderServiceImpl implements OrderService {
 
     /**

File: pay/pay-application/src/main/java/cn/iocoder/mall/pay/application/controller/users/PayTransactionController.java
Patch:
@@ -8,7 +8,7 @@
 import cn.iocoder.mall.pay.api.constant.PayChannelEnum;
 import cn.iocoder.mall.pay.api.dto.PayTransactionSubmitDTO;
 import cn.iocoder.mall.user.sdk.context.UserSecurityContextHolder;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 import org.springframework.http.MediaType;

File: pay/pay-service-impl/src/main/java/cn/iocoder/mall/pay/biz/client/PingxxPaySDK.java
Patch:
@@ -4,8 +4,8 @@
 import cn.iocoder.mall.pay.biz.dataobject.PayRefundDO;
 import cn.iocoder.mall.pay.biz.dataobject.PayTransactionDO;
 import cn.iocoder.mall.pay.biz.dataobject.PayTransactionExtensionDO;
-import com.alibaba.fastjson.JSON;
-import com.alibaba.fastjson.JSONObject;
+import org.apache.fastjson.JSON;
+import org.apache.fastjson.JSONObject;
 import com.google.common.collect.ImmutableMap;
 import com.pingplusplus.Pingpp;
 import com.pingplusplus.exception.*;

File: pay/pay-service-impl/src/main/java/cn/iocoder/mall/pay/biz/mq/AbstractPayNotifySuccessConsumer.java
Patch:
@@ -9,7 +9,7 @@
 import cn.iocoder.mall.pay.biz.dao.PayNotifyTaskMapper;
 import cn.iocoder.mall.pay.biz.dataobject.PayNotifyLogDO;
 import cn.iocoder.mall.pay.biz.dataobject.PayNotifyTaskDO;
-import com.alibaba.fastjson.JSON;
+import org.apache.fastjson.JSON;
 import org.apache.rocketmq.spring.core.RocketMQListener;
 import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.transaction.annotation.Transactional;

File: pay/pay-service-impl/src/main/java/cn/iocoder/mall/pay/biz/mq/PayRefundSuccessConsumer.java
Patch:
@@ -4,7 +4,7 @@
 import cn.iocoder.mall.pay.biz.component.DubboReferencePool;
 import cn.iocoder.mall.pay.biz.dao.PayRefundMapper;
 import cn.iocoder.mall.pay.biz.dataobject.PayRefundDO;
-import com.alibaba.dubbo.rpc.service.GenericService;
+import org.apache.dubbo.rpc.service.GenericService;
 import org.apache.rocketmq.spring.annotation.RocketMQMessageListener;
 import org.apache.rocketmq.spring.core.RocketMQListener;
 import org.springframework.beans.factory.annotation.Autowired;

File: pay/pay-service-impl/src/main/java/cn/iocoder/mall/pay/biz/mq/PayTransactionSuccessConsumer.java
Patch:
@@ -4,7 +4,7 @@
 import cn.iocoder.mall.pay.biz.component.DubboReferencePool;
 import cn.iocoder.mall.pay.biz.dao.PayTransactionMapper;
 import cn.iocoder.mall.pay.biz.dataobject.PayTransactionDO;
-import com.alibaba.dubbo.rpc.service.GenericService;
+import org.apache.dubbo.rpc.service.GenericService;
 import org.apache.rocketmq.spring.annotation.RocketMQMessageListener;
 import org.apache.rocketmq.spring.core.RocketMQListener;
 import org.springframework.beans.factory.annotation.Autowired;

File: pay/pay-service-impl/src/main/java/cn/iocoder/mall/pay/biz/service/PayRefundServiceImpl.java
Patch:
@@ -30,7 +30,7 @@
 import java.util.Date;
 
 @Service
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class PayRefundServiceImpl implements PayRefundService {
 
     private Logger logger = LoggerFactory.getLogger(getClass());

File: pay/pay-service-impl/src/main/java/cn/iocoder/mall/pay/biz/service/PayTransactionServiceImpl.java
Patch:
@@ -30,7 +30,7 @@
 import java.util.Date;
 
 @Service
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class PayTransactionServiceImpl implements PayTransactionService {
 
     private Logger logger = LoggerFactory.getLogger(getClass());

File: product/product-application/src/main/java/cn/iocoder/mall/product/application/controller/admins/AdminsProductAttrController.java
Patch:
@@ -13,7 +13,7 @@
 import cn.iocoder.mall.product.application.vo.admins.AdminsProductAttrSimpleVO;
 import cn.iocoder.mall.product.application.vo.admins.AdminsProductAttrVO;
 import cn.iocoder.mall.product.application.vo.admins.AdminsProductAttrValueVO;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import io.swagger.annotations.Api;
 import io.swagger.annotations.ApiImplicitParam;
 import io.swagger.annotations.ApiImplicitParams;
@@ -135,4 +135,4 @@ public CommonResult<Boolean> updateAttrValueStatus(@RequestParam("id") Integer i
 
     // TODO 芋艿 暂时不考虑 delete Attr Value 。因为关联逻辑比较多
 
-}
\ No newline at end of file
+}

File: product/product-application/src/main/java/cn/iocoder/mall/product/application/controller/admins/AdminsProductCategoryController.java
Patch:
@@ -10,7 +10,7 @@
 import cn.iocoder.mall.product.application.convert.ProductCategoryConvert;
 import cn.iocoder.mall.product.application.vo.admins.AdminsProductCategoryTreeNodeVO;
 import cn.iocoder.mall.product.application.vo.admins.AdminsProductCategoryVO;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import io.swagger.annotations.Api;
 import io.swagger.annotations.ApiImplicitParam;
 import io.swagger.annotations.ApiImplicitParams;

File: product/product-application/src/main/java/cn/iocoder/mall/product/application/controller/admins/AdminsProductSpuController.java
Patch:
@@ -12,7 +12,7 @@
 import cn.iocoder.mall.product.application.convert.ProductSpuConvert;
 import cn.iocoder.mall.product.application.vo.admins.AdminsProductSpuDetailVO;
 import cn.iocoder.mall.product.application.vo.admins.AdminsProductSpuPageVO;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import com.fasterxml.jackson.databind.JavaType;
 import com.fasterxml.jackson.databind.ObjectMapper;
 import io.swagger.annotations.Api;

File: product/product-application/src/main/java/cn/iocoder/mall/product/application/controller/users/UsersProductCategoryController.java
Patch:
@@ -6,7 +6,7 @@
 import cn.iocoder.mall.product.application.convert.ProductCategoryConvert;
 import cn.iocoder.mall.product.application.vo.users.UsersProductCategoryVO;
 import cn.iocoder.mall.user.sdk.annotation.PermitAll;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import io.swagger.annotations.Api;
 import io.swagger.annotations.ApiImplicitParam;
 import io.swagger.annotations.ApiOperation;

File: product/product-application/src/main/java/cn/iocoder/mall/product/application/controller/users/UsersProductSpuController.java
Patch:
@@ -8,7 +8,7 @@
 import cn.iocoder.mall.product.application.vo.users.UsersProductSpuDetailVO;
 import cn.iocoder.mall.product.application.vo.users.UsersProductSpuPageVO;
 import cn.iocoder.mall.user.sdk.annotation.PermitAll;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import io.swagger.annotations.Api;
 import io.swagger.annotations.ApiImplicitParam;
 import io.swagger.annotations.ApiImplicitParams;

File: product/product-service-impl/src/main/java/cn/iocoder/mall/product/service/ProductAttrServiceImpl.java
Patch:
@@ -29,7 +29,7 @@
  * @see cn.iocoder.mall.product.dataobject.ProductAttrValueDO
  */
 @Service
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class ProductAttrServiceImpl implements ProductAttrService {
 
     @Autowired
@@ -233,4 +233,4 @@ private boolean isValidAttrValueStatus(Integer status) {
                 || ProductAttrConstants.ATTR_VALUE_STATUS_DISABLE.equals(status);
     }
 
-}
\ No newline at end of file
+}

File: product/product-service-impl/src/main/java/cn/iocoder/mall/product/service/ProductCategoryServiceImpl.java
Patch:
@@ -21,7 +21,7 @@
 import java.util.List;
 
 @Service // 实际上不用添加。添加的原因是，必须 Spring 报错提示
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class ProductCategoryServiceImpl implements ProductCategoryService {
 
     @Autowired

File: product/product-service-impl/src/main/java/cn/iocoder/mall/product/service/ProductSpuServiceImpl.java
Patch:
@@ -31,7 +31,7 @@
 import java.util.stream.Collectors;
 
 @Service // 实际上不用添加。添加的原因是，必须 Spring 报错提示
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class ProductSpuServiceImpl implements ProductSpuService {
 
     @Autowired

File: promotion/promotion-application/src/main/java/cn/iocoder/mall/promotion/application/controller/admins/AdminsBannerController.java
Patch:
@@ -10,7 +10,7 @@
 import cn.iocoder.mall.promotion.application.convert.BannerConvert;
 import cn.iocoder.mall.promotion.application.vo.admins.AdminsBannerPageVO;
 import cn.iocoder.mall.promotion.application.vo.admins.AdminsBannerVO;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import io.swagger.annotations.Api;
 import io.swagger.annotations.ApiImplicitParam;
 import io.swagger.annotations.ApiImplicitParams;
@@ -96,4 +96,4 @@ public CommonResult<Boolean> delete(@RequestParam("id") Integer id) {
         return bannerService.deleteBanner(AdminSecurityContextHolder.getContext().getAdminId(), id);
     }
 
-}
\ No newline at end of file
+}

File: promotion/promotion-application/src/main/java/cn/iocoder/mall/promotion/application/controller/admins/AdminsCouponController.java
Patch:
@@ -12,7 +12,7 @@
 import cn.iocoder.mall.promotion.application.convert.CouponTemplateConvert;
 import cn.iocoder.mall.promotion.application.vo.admins.AdminsCouponTemplatePageVO;
 import cn.iocoder.mall.promotion.application.vo.admins.AdminsCouponTemplateVO;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import io.swagger.annotations.Api;
 import io.swagger.annotations.ApiImplicitParam;
 import io.swagger.annotations.ApiImplicitParams;

File: promotion/promotion-application/src/main/java/cn/iocoder/mall/promotion/application/controller/admins/AdminsProductRecommendController.java
Patch:
@@ -10,7 +10,7 @@
 import cn.iocoder.mall.promotion.application.convert.ProductRecommendConvert;
 import cn.iocoder.mall.promotion.application.vo.admins.AdminsProductRecommendPageVO;
 import cn.iocoder.mall.promotion.application.vo.admins.AdminsProductRecommendVO;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import io.swagger.annotations.Api;
 import io.swagger.annotations.ApiImplicitParam;
 import io.swagger.annotations.ApiImplicitParams;
@@ -93,4 +93,4 @@ public CommonResult<Boolean> delete(@RequestParam("id") Integer id) {
         return productRecommendService.deleteProductRecommend(AdminSecurityContextHolder.getContext().getAdminId(), id);
     }
 
-}
\ No newline at end of file
+}

File: promotion/promotion-application/src/main/java/cn/iocoder/mall/promotion/application/controller/users/UsersBannerController.java
Patch:
@@ -7,7 +7,7 @@
 import cn.iocoder.mall.promotion.application.convert.BannerConvert;
 import cn.iocoder.mall.promotion.application.vo.users.UsersBannerVO;
 import cn.iocoder.mall.user.sdk.annotation.PermitAll;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import io.swagger.annotations.Api;
 import io.swagger.annotations.ApiOperation;
 import org.springframework.web.bind.annotation.GetMapping;

File: promotion/promotion-application/src/main/java/cn/iocoder/mall/promotion/application/controller/users/UsersCouponController.java
Patch:
@@ -13,7 +13,7 @@
 import cn.iocoder.mall.promotion.application.vo.users.UsersCouponTemplateVO;
 import cn.iocoder.mall.user.sdk.annotation.PermitAll;
 import cn.iocoder.mall.user.sdk.context.UserSecurityContextHolder;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import io.swagger.annotations.Api;
 import io.swagger.annotations.ApiImplicitParam;
 import io.swagger.annotations.ApiImplicitParams;

File: promotion/promotion-application/src/main/java/cn/iocoder/mall/promotion/application/controller/users/UsersProductRecommendController.java
Patch:
@@ -9,7 +9,7 @@
 import cn.iocoder.mall.promotion.application.convert.ProductRecommendConvert;
 import cn.iocoder.mall.promotion.application.vo.users.UsersProductRecommendVO;
 import cn.iocoder.mall.user.sdk.annotation.PermitAll;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import com.google.common.collect.HashMultimap;
 import com.google.common.collect.Multimap;
 import io.swagger.annotations.Api;

File: promotion/promotion-service-impl/src/main/java/cn/iocoder/mall/promotion/biz/service/BannerServiceImpl.java
Patch:
@@ -22,7 +22,7 @@
 import java.util.List;
 
 @Service // 实际上不用添加。添加的原因是，必须 Spring 报错提示
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class BannerServiceImpl implements BannerService {
 
     @Autowired
@@ -100,4 +100,4 @@ public CommonResult<Boolean> deleteBanner(Integer adminId, Integer bannerId) {
         return CommonResult.success(true);
     }
 
-}
\ No newline at end of file
+}

File: promotion/promotion-service-impl/src/main/java/cn/iocoder/mall/promotion/biz/service/CouponServiceImpl.java
Patch:
@@ -24,7 +24,7 @@
 import java.util.stream.Collectors;
 
 @Service // 实际上不用添加。添加的原因是，必须 Spring 报错提示
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class CouponServiceImpl implements CouponService {
 
     @Autowired

File: promotion/promotion-service-impl/src/main/java/cn/iocoder/mall/promotion/biz/service/ProductRecommendServiceImpl.java
Patch:
@@ -16,15 +16,15 @@
 import cn.iocoder.mall.promotion.biz.convert.ProductRecommendConvert;
 import cn.iocoder.mall.promotion.biz.dao.ProductRecommendMapper;
 import cn.iocoder.mall.promotion.biz.dataobject.ProductRecommendDO;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.stereotype.Service;
 
 import java.util.Date;
 import java.util.List;
 
 @Service // 实际上不用添加。添加的原因是，必须 Spring 报错提示
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class ProductRecommendServiceImpl implements ProductRecommendService {
 
     @Reference(validation = "true")

File: promotion/promotion-service-impl/src/main/java/cn/iocoder/mall/promotion/biz/service/PromotionActivityServiceImpl.java
Patch:
@@ -18,7 +18,7 @@
 import java.util.List;
 
 @Service // 实际上不用添加。添加的原因是，必须 Spring 报错提示
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class PromotionActivityServiceImpl implements PromotionActivityService {
 
     @Autowired

File: search/search-application/src/main/java/cn/iocoder/mall/search/application/controller/users/UsersProductSearchController.java
Patch:
@@ -8,7 +8,7 @@
 import cn.iocoder.mall.search.api.bo.ProductPageBO;
 import cn.iocoder.mall.search.api.dto.ProductConditionDTO;
 import cn.iocoder.mall.search.api.dto.ProductSearchPageDTO;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import io.swagger.annotations.Api;
 import org.springframework.web.bind.annotation.GetMapping;
 import org.springframework.web.bind.annotation.RequestMapping;

File: search/search-service-impl/src/main/java/cn/iocoder/mall/search/biz/service/ProductSearchServiceImpl.java
Patch:
@@ -18,7 +18,7 @@
 import cn.iocoder.mall.search.biz.convert.ProductSearchConvert;
 import cn.iocoder.mall.search.biz.dao.ProductRepository;
 import cn.iocoder.mall.search.biz.dataobject.ESProductDO;
-import com.alibaba.dubbo.config.annotation.Reference;
+import org.apache.dubbo.config.annotation.Reference;
 import org.elasticsearch.index.query.QueryBuilders;
 import org.elasticsearch.search.aggregations.Aggregation;
 import org.elasticsearch.search.aggregations.AggregationBuilders;
@@ -37,7 +37,7 @@
 import java.util.stream.Collectors;
 
 @Service
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class ProductSearchServiceImpl implements ProductSearchService {
 
     private static final Integer REBUILD_FETCH_PER_SIZE = 100;

File: user/user-sdk/src/main/java/cn/iocoder/mall/user/sdk/interceptor/UserAccessLogInterceptor.java
Patch:
@@ -3,11 +3,12 @@
 import cn.iocoder.common.framework.util.HttpUtil;
 import cn.iocoder.mall.user.api.UserAccessLogService;
 import cn.iocoder.mall.user.api.dto.UserAccessLogAddDTO;
-import com.alibaba.dubbo.config.annotation.Reference;
 import com.alibaba.fastjson.JSON;
 import org.apache.commons.lang3.exception.ExceptionUtils;
+import org.apache.dubbo.config.annotation.Reference;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
+import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.http.HttpMethod;
 import org.springframework.stereotype.Component;
 import org.springframework.web.servlet.handler.HandlerInterceptorAdapter;
@@ -34,6 +35,7 @@ public class UserAccessLogInterceptor extends HandlerInterceptorAdapter {
     private static final ThreadLocal<Integer> USER_ID = new ThreadLocal<>();
 
     @Reference
+    @Autowired(required = false)
     private UserAccessLogService userAccessLogService;
 
     @Override

File: user/user-service-impl/src/main/java/cn/iocoder/mall/user/biz/service/MobileCodeServiceImpl.java
Patch:
@@ -18,7 +18,7 @@
  * MobileCodeService ，实现用户登陆时需要的验证码
  */
 @Service
-@com.alibaba.dubbo.config.annotation.Service
+@org.apache.dubbo.config.annotation.Service
 public class MobileCodeServiceImpl implements MobileCodeService {
 
     /**
@@ -107,4 +107,4 @@ public CommonResult<Void> send(String mobile) {
         return CommonResult.success(null);
     }
 
-}
\ No newline at end of file
+}

File: user/user-service-impl/src/main/java/cn/iocoder/mall/user/biz/service/OAuth2ServiceImpl.java
Patch:
@@ -27,7 +27,7 @@
  * OAuth2Service ，实现用户授权相关的逻辑
  */
 @Service
-@com.alibaba.dubbo.config.annotation.Service
+@org.apache.dubbo.config.annotation.Service
 public class OAuth2ServiceImpl implements OAuth2Service {
 
     /**

File: user/user-service-impl/src/main/java/cn/iocoder/mall/user/biz/service/UserAccessLogServiceImpl.java
Patch:
@@ -13,7 +13,7 @@
 import java.util.Date;
 
 @Service
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class UserAccessLogServiceImpl implements UserAccessLogService {
 
     /**
@@ -53,4 +53,4 @@ public CommonResult<Boolean> addUserAccessLog(UserAccessLogAddDTO userAccessLogA
         return CommonResult.success(true);
     }
 
-}
\ No newline at end of file
+}

File: user/user-service-impl/src/main/java/cn/iocoder/mall/user/biz/service/UserAddressServiceImpl.java
Patch:
@@ -26,7 +26,7 @@
  * @time 2019-04-06 13:26
  */
 @Service
-@com.alibaba.dubbo.config.annotation.Service(validation = "true")
+@org.apache.dubbo.config.annotation.Service(validation = "true")
 public class UserAddressServiceImpl implements UserAddressService {
 
     @Autowired

File: product/product-service-impl/src/main/java/cn/iocoder/mall/product/service/ProductSpuServiceImpl.java
Patch:
@@ -103,7 +103,8 @@ public CommonResult<ProductSpuDetailBO> addProductSpu(Integer adminId, ProductSp
         // 校验 Sku 规格
         CommonResult<Boolean> validProductSkuResult = validProductSku(productSpuAddDTO.getSkus(), validAttrResult.getData());
         if (validProductSkuResult.isError()) {
-            return CommonResult.error(validProductSkuResult);
+//            return CommonResult.error(validProductSkuResult);
+            throw ServiceExceptionUtil.exception(validProductSkuResult.getCode());
         }
         productSkuMapper.insertList(skus);
         // 返回成功

File: promotion/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/bo/BannerBO.java
Patch:
@@ -3,14 +3,15 @@
 import lombok.Data;
 import lombok.experimental.Accessors;
 
+import java.io.Serializable;
 import java.util.Date;
 
 /**
  * Banner BO
  */
 @Data
 @Accessors(chain = true)
-public class BannerBO {
+public class BannerBO implements Serializable {
 
     /**
      * 编号

File: promotion/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/bo/BannerPageBO.java
Patch:
@@ -3,14 +3,15 @@
 import lombok.Data;
 import lombok.experimental.Accessors;
 
+import java.io.Serializable;
 import java.util.List;
 
 /**
  * Banner 分页 BO
  */
 @Data
 @Accessors(chain = true)
-public class BannerPageBO {
+public class BannerPageBO implements Serializable {
 
     /**
      * Banner 数组

File: promotion/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/bo/CouponCardBO.java
Patch:
@@ -3,14 +3,15 @@
 import lombok.Data;
 import lombok.experimental.Accessors;
 
+import java.io.Serializable;
 import java.util.Date;
 
 /**
  * 优惠劵 BO
  */
 @Data
 @Accessors(chain = true)
-public class CouponCardBO {
+public class CouponCardBO implements Serializable {
 
     // ========== 基本信息 BEGIN ==========
     /**

File: promotion/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/bo/CouponCardPageBO.java
Patch:
@@ -3,14 +3,15 @@
 import lombok.Data;
 import lombok.experimental.Accessors;
 
+import java.io.Serializable;
 import java.util.List;
 
 /**
  * 优惠劵分页 BO
  */
 @Data
 @Accessors(chain = true)
-public class CouponCardPageBO {
+public class CouponCardPageBO implements Serializable {
 
     /**
      * 优惠劵数组

File: promotion/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/bo/CouponTemplateBO.java
Patch:
@@ -3,14 +3,15 @@
 import lombok.Data;
 import lombok.experimental.Accessors;
 
+import java.io.Serializable;
 import java.util.Date;
 
 /**
  * 优惠劵（码）模板 BO
  */
 @Data
 @Accessors(chain = true)
-public class CouponTemplateBO {
+public class CouponTemplateBO implements Serializable {
 
     // ========== 基本信息 BEGIN ==========
     /**

File: promotion/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/bo/CouponTemplatePageBO.java
Patch:
@@ -3,14 +3,15 @@
 import lombok.Data;
 import lombok.experimental.Accessors;
 
+import java.io.Serializable;
 import java.util.List;
 
 /**
  * 优惠劵（码）模板分页 BO
  */
 @Data
 @Accessors(chain = true)
-public class CouponTemplatePageBO {
+public class CouponTemplatePageBO implements Serializable {
 
     /**
      * 优惠劵（码）数组

File: promotion/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/bo/ProductRecommendBO.java
Patch:
@@ -4,14 +4,15 @@
 import lombok.Data;
 import lombok.experimental.Accessors;
 
+import java.io.Serializable;
 import java.util.Date;
 
 /**
  * 商品推荐 BO
  */
 @Data
 @Accessors(chain = true)
-public class ProductRecommendBO {
+public class ProductRecommendBO implements Serializable {
 
     /**
      * 编号

File: promotion/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/bo/ProductRecommendPageBO.java
Patch:
@@ -3,14 +3,15 @@
 import lombok.Data;
 import lombok.experimental.Accessors;
 
+import java.io.Serializable;
 import java.util.List;
 
 /**
  * 商品推荐分页 BO
  */
 @Data
 @Accessors(chain = true)
-public class ProductRecommendPageBO {
+public class ProductRecommendPageBO implements Serializable {
 
     /**
      * ProductRecommend 数组

File: promotion/promotion-service-api/src/main/java/cn/iocoder/mall/promotion/api/constant/PreferentialTypeEnum.java
Patch:
@@ -9,8 +9,8 @@
  */
 public enum PreferentialTypeEnum implements IntArrayValuable {
 
-    PRICE(1, "代金卷"),
-    DISCOUNT(2, "折扣卷"),
+    PRICE(1, "减价"),
+    DISCOUNT(2, "打折"),
     ;
 
     public static final int[] ARRAYS = Arrays.stream(values()).mapToInt(PreferentialTypeEnum::getValue).toArray();

File: promotion/promotion-service-impl/src/test/java/cn/iocoder/mall/promotion/biz/package-info.java
Patch:
@@ -0,0 +1 @@
+package cn.iocoder.mall.promotion.biz;

File: order/order-application/src/main/java/cn/iocoder/mall/order/application/controller/users/UsersOrderController.java
Patch:
@@ -8,7 +8,7 @@
 import cn.iocoder.mall.order.api.CartService;
 import cn.iocoder.mall.order.api.OrderService;
 import cn.iocoder.mall.order.api.bo.*;
-import cn.iocoder.mall.order.api.constant.DictKeysConstants;
+import cn.iocoder.mall.order.api.constant.DictKeyConstants;
 import cn.iocoder.mall.order.api.constant.OrderErrorCodeEnum;
 import cn.iocoder.mall.order.api.dto.CalcOrderPriceDTO;
 import cn.iocoder.mall.order.api.dto.OrderCreateDTO;
@@ -120,7 +120,7 @@ public CommonResult<OrderInfoBO> orderInfo(@RequestParam("orderId") Integer orde
 
         OrderInfoBO orderInfoBO = commonResult.getData();
         CommonResult<DataDictBO> dictResult = dataDictService
-                .getDataDict(DictKeysConstants.ORDER_STATUS_KEY, orderInfoBO.getStatus());
+                .getDataDict(DictKeyConstants.ORDER_STATUS, orderInfoBO.getStatus());
         orderInfoBO.setStatusText(dictResult.getData().getDisplayName());
         return commonResult;
     }

File: order/order-service-api/src/main/java/cn/iocoder/mall/order/api/constant/OrderErrorCodeEnum.java
Patch:
@@ -31,11 +31,14 @@ public enum OrderErrorCodeEnum {
     ORDER_ITEM_SOME_NOT_EXISTS(1008000201, "有不存在的商品!"),
 
 
+
     // ========== 购物车 ==========
     CARD_ITEM_NOT_FOUND(1008003000, "购物车项不存在"),
     CARD_ITEM_SKU_NOT_FOUND(1008003001, "商品不存在"),
     CARD_ITEM_SKU_QUANTITY_NOT_ENOUGH(1008003002, "商品库存不足"),
 
+    // 工具类服务  1008004000
+    DICT_SERVER_INVOKING_FAIL(1008004000, "字典服务调用失败!"),
     ;
 
     private final int code;

File: user/user-service-impl/src/main/java/cn/iocoder/mall/user/biz/service/UserAddressServiceImpl.java
Patch:
@@ -58,6 +58,7 @@ public CommonResult addAddress(UserAddressAddDTO userAddressAddDTO) {
     }
 
     @Override
+    @Transactional
     public CommonResult updateAddress(UserAddressUpdateDTO userAddressAddDTO) {
         UserAddressDO userAddress = userAddressMapper
                 .selectByUserIdAndId(userAddressAddDTO.getUserId(), userAddressAddDTO.getId());

File: order/order-service-api/src/main/java/cn/iocoder/mall/order/api/constant/OrderErrorCodeEnum.java
Patch:
@@ -21,11 +21,11 @@ public enum OrderErrorCodeEnum {
     ORDER_GOODS_AMOUNT_INCORRECT(1008000007, "商品金额非法!"),
     ORDER_GET_GOODS_INFO_INCORRECT(1008000008, "获取额商品信息不正确!"),
     ORDER_GET_USER_ADDRESS_FAIL(1008000009, "获取用户地址失败!"),
-    ORDER_GET_PAY_FAIL(1008000009, "调用pay失败!"),
+    ORDER_GET_PAY_FAIL(1008000010, "调用pay失败!"),
 
     // order item
-    ORDER_ITEM_ONLY_ONE(1008000004, "订单Item只有一个!"),
-    ORDER_ITEM_SOME_NOT_EXISTS(-1, "有不存在的商品"), // TODO 芋艿 后面改下错误码
+    ORDER_ITEM_ONLY_ONE(1008000200, "订单Item只有一个!"),
+    ORDER_ITEM_SOME_NOT_EXISTS(1008000201, "有不存在的商品!"),
 
 
     // ========== 购物车 ==========

File: product/product-application/src/main/java/cn/iocoder/mall/product/application/controller/admins/AdminsProductCategoryController.java
Patch:
@@ -77,7 +77,7 @@ public CommonResult<AdminsProductCategoryVO> add(@RequestParam("pid") Integer pi
         // 创建商品分类
         CommonResult<ProductCategoryBO> result = productCategoryService.addProductCategory(AdminSecurityContextHolder.getContext().getAdminId(), productCategoryAddDTO);
         // 返回结果
-        return ProductCategoryConvert.INSTANCE.convert(result);
+        return ProductCategoryConvert.INSTANCE.convert2(result);
     }
 
     @PostMapping("/update")

File: product/product-application/src/main/java/cn/iocoder/mall/product/application/convert/ProductCategoryConvert.java
Patch:
@@ -26,6 +26,6 @@ public interface ProductCategoryConvert {
     AdminsProductCategoryTreeNodeVO convert(ProductCategoryBO category);
 
     @Mappings({})
-    CommonResult<AdminsProductCategoryVO> convert(CommonResult<ProductCategoryBO> result);
+    CommonResult<AdminsProductCategoryVO> convert2(CommonResult<ProductCategoryBO> result);
 
 }
\ No newline at end of file

File: product/product-application/src/main/java/cn/iocoder/mall/product/application/convert/ProductCategoryConvert.java
Patch:
@@ -19,10 +19,13 @@ public interface ProductCategoryConvert {
     @Mappings({})
     UsersProductCategoryVO convertToVO(ProductCategoryBO category);
 
+    @Mappings({})
     List<UsersProductCategoryVO> convertToVO(List<ProductCategoryBO> categoryList);
 
+    @Mappings({})
     AdminsProductCategoryTreeNodeVO convert(ProductCategoryBO category);
 
+    @Mappings({})
     CommonResult<AdminsProductCategoryVO> convert(CommonResult<ProductCategoryBO> result);
 
 }
\ No newline at end of file

File: product/product-service-impl/src/main/java/cn/iocoder/mall/product/convert/ProductAttrConvert.java
Patch:
@@ -30,9 +30,9 @@ public interface ProductAttrConvert {
     @Mappings({})
     List<ProductAttrSimpleBO> convert3(List<ProductAttrDO> attrs);
 
-//    @Mappings({})
-//    ProductAttrValueSimpleBO convert3(ProductAttrValueDO value);
-//
+    @Mappings({})
+    ProductAttrValueSimpleBO convert3(ProductAttrValueDO value); // 保证 convert4 能够映射到这个方法
+
     @Mappings({})
     List<ProductAttrValueSimpleBO> convert4(List<ProductAttrValueDO> values);
 

