File: src/main/java/com/fangxuele/tool/push/logic/msgsender/WxMpTemplateMsgSender.java
Patch:
@@ -62,8 +62,6 @@ public SendResult send(String[] msgData) {
             WxMpTemplateMessage wxMessageTemplate = wxMpTemplateMsgMaker.makeMsg(msgData);
             wxMessageTemplate.setToUser(openId);
 
-            // TODO 上线前删除
-            Thread.sleep(10);
             if (dryRun == 1) {
                 sendResult.setSuccess(true);
                 return sendResult;

File: src/main/java/com/fangxuele/tool/push/ui/dialog/NewTaskDialog.java
Patch:
@@ -618,6 +618,7 @@ private void onOK() {
                     task.setCreateTime(nowDateForSqlite);
                     taskMapper.insert(task);
                 } else {
+                    task.setCreateTime(beforeTTask.getCreateTime());
                     task.setId(beforeTTask.getId());
                     taskMapper.updateByPrimaryKey(task);
                 }

File: src/main/java/com/fangxuele/tool/push/logic/msgmaker/WxMpSubscribeMsgMaker.java
Patch:
@@ -77,7 +77,7 @@ public WxMpSubscribeMessage makeMsg(String[] msgData) {
 
         VelocityContext velocityContext = getVelocityContext(msgData);
         String templateUrlEvaluated = TemplateUtil.evaluate(templateUrl, velocityContext);
-        wxMessageTemplate.setUrl(templateUrlEvaluated);
+        wxMessageTemplate.setPage(templateUrlEvaluated);
         String miniAppPagePathEvaluated = TemplateUtil.evaluate(miniAppPagePath, velocityContext);
         WxMpSubscribeMessage.MiniProgram miniProgram = new WxMpSubscribeMessage.MiniProgram(miniAppId, miniAppPagePathEvaluated, false);
         wxMessageTemplate.setMiniProgram(miniProgram);

File: src/main/java/com/fangxuele/tool/push/ui/form/MessageTypeForm.java
Patch:
@@ -140,6 +140,8 @@ public static void init() {
         MessageEditForm.getInstance().getMsgTypeName().setText(MessageTypeEnum.getName(msgType));
         MessageManageForm.init();
         MessageEditForm.getInstance().getMsgNameField().setText("");
+        PeopleManageForm.init();
+        PeopleEditForm.init(null);
         MemberForm.init();
         PushHisForm.init();
         ScheduleForm.init();

File: src/main/java/com/fangxuele/tool/push/ui/form/PeopleManageForm.java
Patch:
@@ -64,6 +64,7 @@ public static void init() {
 
     private static void initAccountComboBox() {
         accountMap = Maps.newHashMap();
+        peopleManageForm.getAccountComboBox().removeAllItems();
         int msgType = MessageTypeEnum.getMsgTypeForAccount();
         List<TAccount> tAccountList = accountMapper.selectByMsgType(msgType);
         for (TAccount tAccount : tAccountList) {
@@ -97,6 +98,8 @@ public static void initPeopleList() {
         }
         // 隐藏id列
         JTableUtil.hideColumn(peopleManageForm.getPeopleListTable(), 1);
+
+        PeopleEditForm.clearAll();
     }
 
     {

File: src/main/java/com/fangxuele/tool/push/ui/listener/AccountManageListener.java
Patch:
@@ -68,6 +68,7 @@ public void mousePressed(MouseEvent e) {
                             tableModel.removeRow(selectedRow);
                         }
                         AccountEditForm.init(null);
+                        PeopleManageForm.init();
                     }
                 }
             } catch (Exception e1) {

File: src/main/java/com/fangxuele/tool/push/ui/dialog/importway/ImportByWxMp.java
Patch:
@@ -252,7 +252,7 @@ public static void getMpUserList() throws WxErrorException {
 
         TPeopleImportConfig tPeopleImportConfig = new TPeopleImportConfig();
         tPeopleImportConfig.setPeopleId(PeopleManageListener.selectedPeopleId);
-        tPeopleImportConfig.setLastWay(String.valueOf(PeopleImportWayEnum.BY_NUM_CODE));
+        tPeopleImportConfig.setLastWay(String.valueOf(PeopleImportWayEnum.BY_WX_MP_CODE));
         tPeopleImportConfig.setAppVersion(UiConsts.APP_VERSION);
         tPeopleImportConfig.setModifiedTime(now);
 
@@ -420,7 +420,7 @@ public static void getMpUserListByTag(Long tagId, boolean retain) throws WxError
 
         TPeopleImportConfig tPeopleImportConfig = new TPeopleImportConfig();
         tPeopleImportConfig.setPeopleId(PeopleManageListener.selectedPeopleId);
-        tPeopleImportConfig.setLastWay(String.valueOf(PeopleImportWayEnum.BY_NUM_CODE));
+        tPeopleImportConfig.setLastWay(String.valueOf(PeopleImportWayEnum.BY_WX_MP_CODE));
         tPeopleImportConfig.setAppVersion(UiConsts.APP_VERSION);
         tPeopleImportConfig.setModifiedTime(now);
 

File: src/main/java/com/fangxuele/tool/push/ui/dialog/importway/ImportByWxCp.java
Patch:
@@ -127,7 +127,7 @@ public ImportByWxCp() {
 
                     TPeopleImportConfig tPeopleImportConfig = new TPeopleImportConfig();
                     tPeopleImportConfig.setPeopleId(PeopleManageListener.selectedPeopleId);
-                    tPeopleImportConfig.setLastWay(String.valueOf(PeopleImportWayEnum.BY_DING_CODE));
+                    tPeopleImportConfig.setLastWay(String.valueOf(PeopleImportWayEnum.BY_WX_CP_CODE));
                     tPeopleImportConfig.setAppVersion(UiConsts.APP_VERSION);
                     tPeopleImportConfig.setModifiedTime(now);
 
@@ -230,7 +230,7 @@ public ImportByWxCp() {
 
                     TPeopleImportConfig tPeopleImportConfig = new TPeopleImportConfig();
                     tPeopleImportConfig.setPeopleId(PeopleManageListener.selectedPeopleId);
-                    tPeopleImportConfig.setLastWay(String.valueOf(PeopleImportWayEnum.BY_DING_CODE));
+                    tPeopleImportConfig.setLastWay(String.valueOf(PeopleImportWayEnum.BY_WX_CP_CODE));
                     tPeopleImportConfig.setAppVersion(UiConsts.APP_VERSION);
                     tPeopleImportConfig.setModifiedTime(now);
 
@@ -356,7 +356,7 @@ public static void importWxCpAll() {
 
             TPeopleImportConfig tPeopleImportConfig = new TPeopleImportConfig();
             tPeopleImportConfig.setPeopleId(PeopleManageListener.selectedPeopleId);
-            tPeopleImportConfig.setLastWay(String.valueOf(PeopleImportWayEnum.BY_DING_CODE));
+            tPeopleImportConfig.setLastWay(String.valueOf(PeopleImportWayEnum.BY_WX_CP_CODE));
             tPeopleImportConfig.setAppVersion(UiConsts.APP_VERSION);
             tPeopleImportConfig.setModifiedTime(now);
 

File: src/main/java/com/fangxuele/tool/push/dao/TAccountMapper.java
Patch:
@@ -1,7 +1,6 @@
 package com.fangxuele.tool.push.dao;
 
 import com.fangxuele.tool.push.domain.TAccount;
-import com.fangxuele.tool.push.domain.TMsgKefu;
 import org.apache.ibatis.annotations.Param;
 
 import java.util.List;
@@ -21,9 +20,9 @@ public interface TAccountMapper {
 
     List<TAccount> selectByMsgType(int msgType);
 
-    int deleteByMsgTypeAndName(@Param("msgType") int msgType, @Param("accountName") String accountName);
+    int deleteByMsgTypeAndAccountName(@Param("msgType") int msgType, @Param("accountName") String accountName);
 
-    TAccount selectByAccountName(String accountName);
+    TAccount selectByMsgTypeAndAccountName(@Param("msgType") int msgType, @Param("accountName") String accountName);
 
     int updateByMsgTypeAndAccountName(TAccount tAccount1);
 }
\ No newline at end of file

File: src/main/java/com/fangxuele/tool/push/ui/form/account/AliYunAccountForm.java
Patch:
@@ -29,7 +29,7 @@ public class AliYunAccountForm implements IAccountForm {
     @Override
     public void init(String accountName) {
         if (StringUtils.isNotEmpty(accountName)) {
-            TAccount tAccount = accountMapper.selectByAccountName(accountName);
+            TAccount tAccount = accountMapper.selectByMsgTypeAndAccountName(App.config.getMsgType(), accountName);
 
             AliYunAccountForm instance = getInstance();
             AliYunAccountConfig aliYunAccountConfig = JSONUtil.toBean(tAccount.getAccountConfig(), AliYunAccountConfig.class);
@@ -42,7 +42,7 @@ public void init(String accountName) {
     @Override
     public void save(String accountName) {
         if (StringUtils.isNotEmpty(accountName)) {
-            TAccount tAccount = accountMapper.selectByAccountName(accountName);
+            TAccount tAccount = accountMapper.selectByMsgTypeAndAccountName(App.config.getMsgType(), accountName);
             AliYunAccountForm instance = getInstance();
             int msgType = App.config.getMsgType();
 

File: src/main/java/com/fangxuele/tool/push/ui/form/account/BdYunAccountForm.java
Patch:
@@ -30,7 +30,7 @@ public class BdYunAccountForm implements IAccountForm {
     @Override
     public void init(String accountName) {
         if (StringUtils.isNotEmpty(accountName)) {
-            TAccount tAccount = accountMapper.selectByAccountName(accountName);
+            TAccount tAccount = accountMapper.selectByMsgTypeAndAccountName(App.config.getMsgType(), accountName);
 
             BdYunAccountForm instance = getInstance();
             BdYunAccountConfig bdYunAccountConfig = JSONUtil.toBean(tAccount.getAccountConfig(), BdYunAccountConfig.class);
@@ -44,7 +44,7 @@ public void init(String accountName) {
     @Override
     public void save(String accountName) {
         if (StringUtils.isNotEmpty(accountName)) {
-            TAccount tAccount = accountMapper.selectByAccountName(accountName);
+            TAccount tAccount = accountMapper.selectByMsgTypeAndAccountName(App.config.getMsgType(), accountName);
             BdYunAccountForm instance = getInstance();
             int msgType = App.config.getMsgType();
 

File: src/main/java/com/fangxuele/tool/push/ui/form/account/DingAccountForm.java
Patch:
@@ -30,7 +30,7 @@ public class DingAccountForm implements IAccountForm {
     @Override
     public void init(String accountName) {
         if (StringUtils.isNotEmpty(accountName)) {
-            TAccount tAccount = accountMapper.selectByAccountName(accountName);
+            TAccount tAccount = accountMapper.selectByMsgTypeAndAccountName(App.config.getMsgType(), accountName);
 
             DingAccountForm instance = getInstance();
             DingAccountConfig dingAccountConfig = JSONUtil.toBean(tAccount.getAccountConfig(), DingAccountConfig.class);
@@ -44,7 +44,7 @@ public void init(String accountName) {
     @Override
     public void save(String accountName) {
         if (StringUtils.isNotEmpty(accountName)) {
-            TAccount tAccount = accountMapper.selectByAccountName(accountName);
+            TAccount tAccount = accountMapper.selectByMsgTypeAndAccountName(App.config.getMsgType(), accountName);
             DingAccountForm instance = getInstance();
             int msgType = App.config.getMsgType();
 

File: src/main/java/com/fangxuele/tool/push/ui/form/account/EmailAccountForm.java
Patch:
@@ -34,7 +34,7 @@ public class EmailAccountForm implements IAccountForm {
     @Override
     public void init(String accountName) {
         if (StringUtils.isNotEmpty(accountName)) {
-            TAccount tAccount = accountMapper.selectByAccountName(accountName);
+            TAccount tAccount = accountMapper.selectByMsgTypeAndAccountName(App.config.getMsgType(), accountName);
 
             EmailAccountForm instance = getInstance();
             EmailAccountConfig emailAccountConfig = JSONUtil.toBean(tAccount.getAccountConfig(), EmailAccountConfig.class);
@@ -52,7 +52,7 @@ public void init(String accountName) {
     @Override
     public void save(String accountName) {
         if (StringUtils.isNotEmpty(accountName)) {
-            TAccount tAccount = accountMapper.selectByAccountName(accountName);
+            TAccount tAccount = accountMapper.selectByMsgTypeAndAccountName(App.config.getMsgType(), accountName);
             EmailAccountForm instance = getInstance();
             int msgType = App.config.getMsgType();
 

File: src/main/java/com/fangxuele/tool/push/ui/form/account/HwYunAccountForm.java
Patch:
@@ -31,7 +31,7 @@ public class HwYunAccountForm implements IAccountForm {
     @Override
     public void init(String accountName) {
         if (StringUtils.isNotEmpty(accountName)) {
-            TAccount tAccount = accountMapper.selectByAccountName(accountName);
+            TAccount tAccount = accountMapper.selectByMsgTypeAndAccountName(App.config.getMsgType(), accountName);
 
             HwYunAccountForm instance = getInstance();
             HwYunAccountConfig hwYunAccountConfig = JSONUtil.toBean(tAccount.getAccountConfig(), HwYunAccountConfig.class);
@@ -46,7 +46,7 @@ public void init(String accountName) {
     @Override
     public void save(String accountName) {
         if (StringUtils.isNotEmpty(accountName)) {
-            TAccount tAccount = accountMapper.selectByAccountName(accountName);
+            TAccount tAccount = accountMapper.selectByMsgTypeAndAccountName(App.config.getMsgType(), accountName);
             HwYunAccountForm instance = getInstance();
             int msgType = App.config.getMsgType();
 

File: src/main/java/com/fangxuele/tool/push/ui/form/account/QiniuYunAccountForm.java
Patch:
@@ -28,7 +28,7 @@ public class QiniuYunAccountForm implements IAccountForm {
     @Override
     public void init(String accountName) {
         if (StringUtils.isNotEmpty(accountName)) {
-            TAccount tAccount = accountMapper.selectByAccountName(accountName);
+            TAccount tAccount = accountMapper.selectByMsgTypeAndAccountName(App.config.getMsgType(), accountName);
 
             QiniuYunAccountForm instance = getInstance();
             QiniuYunAccountConfig qiniuYunAccountConfig = JSONUtil.toBean(tAccount.getAccountConfig(), QiniuYunAccountConfig.class);
@@ -40,7 +40,7 @@ public void init(String accountName) {
     @Override
     public void save(String accountName) {
         if (StringUtils.isNotEmpty(accountName)) {
-            TAccount tAccount = accountMapper.selectByAccountName(accountName);
+            TAccount tAccount = accountMapper.selectByMsgTypeAndAccountName(App.config.getMsgType(), accountName);
             QiniuYunAccountForm instance = getInstance();
             int msgType = App.config.getMsgType();
 

File: src/main/java/com/fangxuele/tool/push/ui/form/account/TxYunAccountForm.java
Patch:
@@ -29,7 +29,7 @@ public class TxYunAccountForm implements IAccountForm {
     @Override
     public void init(String accountName) {
         if (StringUtils.isNotEmpty(accountName)) {
-            TAccount tAccount = accountMapper.selectByAccountName(accountName);
+            TAccount tAccount = accountMapper.selectByMsgTypeAndAccountName(App.config.getMsgType(), accountName);
 
             TxYunAccountForm instance = getInstance();
             TxYunAccountConfig txYunAccountConfig = JSONUtil.toBean(tAccount.getAccountConfig(), TxYunAccountConfig.class);
@@ -42,7 +42,7 @@ public void init(String accountName) {
     @Override
     public void save(String accountName) {
         if (StringUtils.isNotEmpty(accountName)) {
-            TAccount tAccount = accountMapper.selectByAccountName(accountName);
+            TAccount tAccount = accountMapper.selectByMsgTypeAndAccountName(App.config.getMsgType(), accountName);
             TxYunAccountForm instance = getInstance();
             int msgType = App.config.getMsgType();
 

File: src/main/java/com/fangxuele/tool/push/ui/form/account/UpYunAccountForm.java
Patch:
@@ -27,7 +27,7 @@ public class UpYunAccountForm implements IAccountForm {
     @Override
     public void init(String accountName) {
         if (StringUtils.isNotEmpty(accountName)) {
-            TAccount tAccount = accountMapper.selectByAccountName(accountName);
+            TAccount tAccount = accountMapper.selectByMsgTypeAndAccountName(App.config.getMsgType(), accountName);
 
             UpYunAccountForm instance = getInstance();
             UpYunAccountConfig upYunAccountConfig = JSONUtil.toBean(tAccount.getAccountConfig(), UpYunAccountConfig.class);
@@ -38,7 +38,7 @@ public void init(String accountName) {
     @Override
     public void save(String accountName) {
         if (StringUtils.isNotEmpty(accountName)) {
-            TAccount tAccount = accountMapper.selectByAccountName(accountName);
+            TAccount tAccount = accountMapper.selectByMsgTypeAndAccountName(App.config.getMsgType(), accountName);
             UpYunAccountForm instance = getInstance();
             int msgType = App.config.getMsgType();
 

File: src/main/java/com/fangxuele/tool/push/ui/form/account/WxCpAccountForm.java
Patch:
@@ -30,7 +30,7 @@ public class WxCpAccountForm implements IAccountForm {
     @Override
     public void init(String accountName) {
         if (StringUtils.isNotEmpty(accountName)) {
-            TAccount tAccount = accountMapper.selectByAccountName(accountName);
+            TAccount tAccount = accountMapper.selectByMsgTypeAndAccountName(App.config.getMsgType(), accountName);
 
             WxCpAccountForm instance = getInstance();
             WxCpAccountConfig wxCpAccountConfig = JSONUtil.toBean(tAccount.getAccountConfig(), WxCpAccountConfig.class);
@@ -44,7 +44,7 @@ public void init(String accountName) {
     @Override
     public void save(String accountName) {
         if (StringUtils.isNotEmpty(accountName)) {
-            TAccount tAccount = accountMapper.selectByAccountName(accountName);
+            TAccount tAccount = accountMapper.selectByMsgTypeAndAccountName(App.config.getMsgType(), accountName);
             WxCpAccountForm instance = getInstance();
             int msgType = App.config.getMsgType();
 

File: src/main/java/com/fangxuele/tool/push/ui/form/account/YunPianAccountForm.java
Patch:
@@ -27,7 +27,7 @@ public class YunPianAccountForm implements IAccountForm {
     @Override
     public void init(String accountName) {
         if (StringUtils.isNotEmpty(accountName)) {
-            TAccount tAccount = accountMapper.selectByAccountName(accountName);
+            TAccount tAccount = accountMapper.selectByMsgTypeAndAccountName(App.config.getMsgType(), accountName);
 
             YunPianAccountForm instance = getInstance();
             YunPianAccountConfig yunPianAccountConfig = JSONUtil.toBean(tAccount.getAccountConfig(), YunPianAccountConfig.class);
@@ -38,7 +38,7 @@ public void init(String accountName) {
     @Override
     public void save(String accountName) {
         if (StringUtils.isNotEmpty(accountName)) {
-            TAccount tAccount = accountMapper.selectByAccountName(accountName);
+            TAccount tAccount = accountMapper.selectByMsgTypeAndAccountName(App.config.getMsgType(), accountName);
             YunPianAccountForm instance = getInstance();
             int msgType = App.config.getMsgType();
 

File: src/main/java/com/fangxuele/tool/push/ui/listener/AccountManageListener.java
Patch:
@@ -64,7 +64,7 @@ public void mousePressed(MouseEvent e) {
                         for (int i = selectedRows.length; i > 0; i--) {
                             int selectedRow = accountListTable.getSelectedRow();
                             String accountName = (String) tableModel.getValueAt(selectedRow, 0);
-                            accountMapper.deleteByMsgTypeAndName(msgType, accountName);
+                            accountMapper.deleteByMsgTypeAndAccountName(msgType, accountName);
                             tableModel.removeRow(selectedRow);
                         }
                         MessageEditForm.init(null);

File: src/main/java/com/fangxuele/tool/push/ui/form/MessageManageForm.java
Patch:
@@ -218,19 +218,21 @@ public static void initSwitchMultiAccount() {
                 for (TWxAccount tWxAccount : wxAccountList) {
                     messageManageForm.getAccountSwitchComboBox().addItem(tWxAccount.getAccountName());
                 }
-                accountSwitchComboBoxListenIgnore = false;
                 messageManageForm.getAccountSwitchComboBox().setSelectedItem(App.config.getWechatMpName());
+                accountSwitchComboBoxListenIgnore = false;
                 break;
 
             case MessageTypeEnum.MA_SUBSCRIBE_CODE:
             case MessageTypeEnum.MA_TEMPLATE_CODE:
             case MessageTypeEnum.WX_UNIFORM_MESSAGE_CODE:
                 // 多账号切换-小程序
                 wxAccountList = wxAccountMapper.selectByAccountType(UiConsts.WX_ACCOUNT_TYPE_MA);
+                accountSwitchComboBoxListenIgnore = true;
                 for (TWxAccount tWxAccount : wxAccountList) {
                     messageManageForm.getAccountSwitchComboBox().addItem(tWxAccount.getAccountName());
                 }
                 messageManageForm.getAccountSwitchComboBox().setSelectedItem(App.config.getMiniAppName());
+                accountSwitchComboBoxListenIgnore = false;
                 break;
             default:
                 break;

File: src/main/java/com/fangxuele/tool/push/ui/dialog/SwitchWxAccountDialog.java
Patch:
@@ -117,6 +117,7 @@ public void windowClosing(WindowEvent e) {
             renderTable();
             SettingForm.initSwitchMultiAccount();
             MessageManageForm.initSwitchMultiAccount();
+            MessageManageForm.init();
             JOptionPane.showMessageDialog(this, "保存成功！", "成功",
                     JOptionPane.INFORMATION_MESSAGE);
         });

File: src/main/java/com/fangxuele/tool/push/ui/listener/MessageTypeListener.java
Patch:
@@ -131,6 +131,7 @@ public void mouseExited(MouseEvent e) {
      * 保存消息类型
      */
     private static void saveType() {
+        App.config.save();
         MessageTypeForm.init();
     }
 }

File: src/main/java/com/fangxuele/tool/push/ui/form/MessageManageForm.java
Patch:
@@ -90,8 +90,6 @@ public static MessageManageForm getInstance() {
     public static void init() {
         messageManageForm = getInstance();
 
-        MessageEditForm.getInstance().getMsgNameField().setText("");
-
         initSwitchMultiAccount();
 
         initMessageList();

File: src/main/java/com/fangxuele/tool/push/ui/form/MessageTypeForm.java
Patch:
@@ -132,6 +132,7 @@ public static void init() {
         MessageEditForm.switchMsgType(msgType);
         MessageEditForm.getInstance().getMsgTypeName().setText(MessageTypeEnum.getName(msgType));
         MessageManageForm.init();
+        MessageEditForm.getInstance().getMsgNameField().setText("");
         MemberForm.init();
         PushHisForm.init();
         ScheduleForm.init();

File: src/main/java/com/fangxuele/tool/push/dao/TMsgDingMapper.java
Patch:
@@ -23,4 +23,6 @@ public interface TMsgDingMapper {
     int updateByMsgTypeAndMsgName(TMsgDing tMsgDing);
 
     List<TMsgDing> selectByMsgType(int msgType);
+
+    int deleteByMsgTypeAndName(@Param("msgType") int msgType, @Param("msgName") String msgName);
 }
\ No newline at end of file

File: src/main/java/com/fangxuele/tool/push/dao/TMsgHttpMapper.java
Patch:
@@ -23,4 +23,6 @@ public interface TMsgHttpMapper {
     int updateByMsgTypeAndMsgName(TMsgHttp tMsgHttp);
 
     List<TMsgHttp> selectByMsgType(int msgType);
+
+    int deleteByMsgTypeAndName(@Param("msgType") int msgType, @Param("msgName") String msgName);
 }
\ No newline at end of file

File: src/main/java/com/fangxuele/tool/push/logic/msgsender/AliYunMsgSender.java
Patch:
@@ -40,6 +40,7 @@ public SendResult send(String[] msgData) {
         try {
             //初始化acsClient,暂不支持region化
             SendSmsRequest sendSmsRequest = aliyunMsgMaker.makeMsg(msgData);
+            sendSmsRequest.setPhoneNumbers(msgData[0]);
             if (PushControl.dryRun) {
                 sendResult.setSuccess(true);
                 return sendResult;

File: src/main/java/com/fangxuele/tool/push/ui/listener/MsgEditListener.java
Patch:
@@ -86,7 +86,7 @@ public static void addListeners() {
 
                 if (App.config.getMsgType() == MessageTypeEnum.WX_CP_CODE
                         && WxCpMsgForm.getInstance().getAppNameComboBox().getSelectedItem() == null) {
-                    JOptionPane.showMessageDialog(MainWindow.getInstance().getMessagePanel(), "请选择应用！", "成功",
+                    JOptionPane.showMessageDialog(MainWindow.getInstance().getMessagePanel(), "请选择应用！", "失败",
                             JOptionPane.ERROR_MESSAGE);
                     return;
                 }

File: src/main/java/com/fangxuele/tool/push/util/WeWxMpServiceImpl.java
Patch:
@@ -2,6 +2,7 @@
 
 import cn.hutool.cache.CacheUtil;
 import cn.hutool.cache.impl.TimedCache;
+import cn.hutool.json.JSONUtil;
 import com.fangxuele.tool.push.App;
 import me.chanjar.weixin.common.WxType;
 import me.chanjar.weixin.common.bean.WxAccessToken;
@@ -82,7 +83,7 @@ public String getAccessToken(boolean forceRefresh) throws WxErrorException {
                                 throw new WxErrorException(error);
                             }
                         }
-                        accessToken = WxAccessToken.fromJson(resultContent);
+                        accessToken = JSONUtil.toBean(resultContent, WxAccessToken.class);
                     } finally {
                         httpGet.releaseConnection();
                     }

File: src/main/java/com/fangxuele/tool/push/ui/form/msg/MsgFormFactory.java
Patch:
@@ -54,6 +54,7 @@ public static IMsgForm getMsgForm() {
                 iMsgForm = HttpMsgForm.getInstance();
                 break;
             default:
+                iMsgForm = HttpMsgForm.getInstance();
         }
         if (iMsgForm != null) {
             UndoUtil.register(iMsgForm);

File: src/main/java/com/fangxuele/tool/push/logic/msgmaker/WxMaTemplateMsgMaker.java
Patch:
@@ -3,7 +3,6 @@
 import cn.binarywang.wx.miniapp.bean.WxMaTemplateData;
 import cn.binarywang.wx.miniapp.bean.WxMaTemplateMessage;
 import com.fangxuele.tool.push.bean.TemplateData;
-import com.fangxuele.tool.push.logic.msgsender.WxMaTemplateMsgSender;
 import com.fangxuele.tool.push.ui.form.msg.MaTemplateMsgForm;
 import com.fangxuele.tool.push.util.TemplateUtil;
 import org.apache.commons.compress.utils.Lists;
@@ -54,8 +53,6 @@ public void prepare() {
             templateData.setColor(color);
             templateDataList.add(templateData);
         }
-        WxMaTemplateMsgSender.wxMaConfigStorage = null;
-        WxMaTemplateMsgSender.wxMaService = null;
     }
 
     /**

File: src/main/java/com/fangxuele/tool/push/logic/msgmaker/WxKefuMsgMaker.java
Patch:
@@ -1,6 +1,5 @@
 package com.fangxuele.tool.push.logic.msgmaker;
 
-import com.fangxuele.tool.push.logic.msgsender.WxMpTemplateMsgSender;
 import com.fangxuele.tool.push.ui.form.msg.KefuMsgForm;
 import com.fangxuele.tool.push.util.TemplateUtil;
 import me.chanjar.weixin.mp.bean.kefu.WxMpKefuMessage;
@@ -39,8 +38,6 @@ public void prepare() {
         msgKefuDesc = KefuMsgForm.getInstance().getMsgKefuDescTextField().getText();
         msgKefuUrl = KefuMsgForm.getInstance().getMsgKefuUrlTextField().getText();
         msgKefuMsgContent = KefuMsgForm.getInstance().getContentTextArea().getText();
-        WxMpTemplateMsgSender.wxMpConfigStorage = null;
-        WxMpTemplateMsgSender.wxMpService = null;
     }
 
     /**

File: src/main/java/com/fangxuele/tool/push/logic/msgmaker/WxMpTemplateMsgMaker.java
Patch:
@@ -1,7 +1,6 @@
 package com.fangxuele.tool.push.logic.msgmaker;
 
 import com.fangxuele.tool.push.bean.TemplateData;
-import com.fangxuele.tool.push.logic.msgsender.WxMpTemplateMsgSender;
 import com.fangxuele.tool.push.ui.form.msg.MpTemplateMsgForm;
 import com.fangxuele.tool.push.util.TemplateUtil;
 import me.chanjar.weixin.mp.bean.template.WxMpTemplateData;
@@ -61,8 +60,6 @@ public void prepare() {
             templateDataList.add(templateData);
         }
 
-        WxMpTemplateMsgSender.wxMpConfigStorage = null;
-        WxMpTemplateMsgSender.wxMpService = null;
     }
 
     /**

File: src/main/java/com/fangxuele/tool/push/ui/form/MessageTypeForm.java
Patch:
@@ -148,10 +148,10 @@ private static void initMemberFormLayOut(int msgType) {
         }
 
         if (msgType == MessageTypeEnum.HTTP_CODE) {
-            MainWindow.getInstance().getTabbedPane().setTitleAt(3, "准备消息变量");
+            MainWindow.getInstance().getTabbedPane().setTitleAt(3, "③准备消息变量");
             MemberForm.getInstance().getImportFromNumPanel().setVisible(true);
         } else {
-            MainWindow.getInstance().getTabbedPane().setTitleAt(3, "准备目标用户");
+            MainWindow.getInstance().getTabbedPane().setTitleAt(3, "③准备目标用户");
         }
     }
 

File: src/main/java/com/fangxuele/tool/push/logic/msgsender/HttpMsgSender.java
Patch:
@@ -165,14 +165,14 @@ public HttpSendResult sendUseOkHttp(String[] msgData) {
 
             Request.Builder requestBuilder = new Request.Builder();
 
-            RequestBody requestBody = null;
+            RequestBody requestBody = RequestBody.create("", MediaType.get("text/plain"));
             if (!"GET".equals(HttpMsgMaker.method) && httpMsg.getParamMap() != null && !httpMsg.getParamMap().isEmpty()) {
                 FormBody.Builder formBodyBuilder = new FormBody.Builder();
                 for (Map.Entry<String, Object> paramEntry : httpMsg.getParamMap().entrySet()) {
                     formBodyBuilder.add(paramEntry.getKey(), (String) paramEntry.getValue());
                 }
                 requestBody = formBodyBuilder.build();
-            } else if (StringUtils.isNotEmpty(httpMsg.getBody())) {
+            } else if (!"GET".equals(HttpMsgMaker.method) && StringUtils.isNotEmpty(httpMsg.getBody())) {
                 String bodyType = HttpMsgMaker.bodyType;
                 MediaType mediaType = MediaType.get(bodyType + "; charset=utf-8");
                 requestBody = RequestBody.create(httpMsg.getBody(), mediaType);

File: src/main/java/com/fangxuele/tool/push/logic/msgsender/HttpMsgSender.java
Patch:
@@ -165,14 +165,14 @@ public HttpSendResult sendUseOkHttp(String[] msgData) {
 
             Request.Builder requestBuilder = new Request.Builder();
 
-            RequestBody requestBody = null;
+            RequestBody requestBody = RequestBody.create("", MediaType.get("text/plain"));
             if (!"GET".equals(HttpMsgMaker.method) && httpMsg.getParamMap() != null && !httpMsg.getParamMap().isEmpty()) {
                 FormBody.Builder formBodyBuilder = new FormBody.Builder();
                 for (Map.Entry<String, Object> paramEntry : httpMsg.getParamMap().entrySet()) {
                     formBodyBuilder.add(paramEntry.getKey(), (String) paramEntry.getValue());
                 }
                 requestBody = formBodyBuilder.build();
-            } else if (StringUtils.isNotEmpty(httpMsg.getBody())) {
+            } else if (!"GET".equals(HttpMsgMaker.method) && StringUtils.isNotEmpty(httpMsg.getBody())) {
                 String bodyType = HttpMsgMaker.bodyType;
                 MediaType mediaType = MediaType.get(bodyType + "; charset=utf-8");
                 requestBody = RequestBody.create(httpMsg.getBody(), mediaType);

File: src/main/java/com/fangxuele/tool/push/logic/msgsender/HttpMsgSender.java
Patch:
@@ -172,7 +172,8 @@ public HttpSendResult sendUseOkHttp(String[] msgData) {
                 }
                 requestBody = formBodyBuilder.build();
             } else if (StringUtils.isNotEmpty(httpMsg.getBody())) {
-                MediaType mediaType = MediaType.get("application/json; charset=utf-8");
+                String bodyType = HttpMsgMaker.bodyType;
+                MediaType mediaType = MediaType.get(bodyType + "; charset=utf-8");
                 requestBody = RequestBody.create(httpMsg.getBody(), mediaType);
             }
 

File: src/main/java/com/fangxuele/tool/push/logic/msgmaker/HttpMsgMaker.java
Patch:
@@ -29,6 +29,7 @@ public class HttpMsgMaker extends BaseMsgMaker implements IMsgMaker {
     public static String method;
     public static String url;
     public static String body;
+    public static String bodyType;
     public static List<HttpMsgForm.NameValueObject> paramList;
     public static List<HttpMsgForm.NameValueObject> headerList;
     public static List<HttpMsgForm.CookieObject> cookieList;
@@ -38,6 +39,7 @@ public void prepare() {
         method = (String) HttpMsgForm.getInstance().getMethodComboBox().getSelectedItem();
         url = HttpMsgForm.getInstance().getUrlTextField().getText().trim();
         body = HttpMsgForm.getInstance().getBodyTextArea().getText();
+        bodyType = (String) HttpMsgForm.getInstance().getBodyTypeComboBox().getSelectedItem();
 
         // Params=========================
         if (HttpMsgForm.getInstance().getParamTable().getModel().getRowCount() == 0) {

File: src/main/java/com/fangxuele/tool/push/logic/BoostPushRunThread.java
Patch:
@@ -135,13 +135,13 @@ private void timeMonitor() {
 
                 // 保存停止前的数据
                 try {
-                    ConsoleUtil.boostConsoleWithLog("正在保存结果数据……");
-                    BoostForm.boostForm.getCompletedProgressBar().setIndeterminate(true);
                     // 空跑控制
                     if (!BoostForm.boostForm.getDryRunCheckBox().isSelected()) {
+                        ConsoleUtil.boostConsoleWithLog("正在保存结果数据……");
+                        BoostForm.boostForm.getCompletedProgressBar().setIndeterminate(true);
                         PushControl.savePushData();
+                        ConsoleUtil.boostConsoleWithLog("结果数据保存完毕！");
                     }
-                    ConsoleUtil.boostConsoleWithLog("结果数据保存完毕！");
                 } catch (IOException e) {
                     logger.error(e);
                 } finally {

File: src/main/java/com/fangxuele/tool/push/logic/PushRunThread.java
Patch:
@@ -186,13 +186,13 @@ private void timeMonitor() {
 
                 // 保存停止前的数据
                 try {
-                    ConsoleUtil.consoleWithLog("正在保存结果数据……");
-                    PushForm.pushForm.getPushTotalProgressBar().setIndeterminate(true);
                     // 空跑控制
                     if (!PushForm.pushForm.getDryRunCheckBox().isSelected()) {
+                        ConsoleUtil.consoleWithLog("正在保存结果数据……");
+                        PushForm.pushForm.getPushTotalProgressBar().setIndeterminate(true);
                         PushControl.savePushData();
+                        ConsoleUtil.consoleWithLog("结果数据保存完毕！");
                     }
-                    ConsoleUtil.consoleWithLog("结果数据保存完毕！");
                 } catch (IOException e) {
                     logger.error(e);
                 } finally {

File: src/main/java/com/fangxuele/tool/push/ui/listener/BoostListener.java
Patch:
@@ -96,6 +96,7 @@ public void mouseExited(MouseEvent e) {
 
         // 开始按钮事件
         BoostForm.boostForm.getStartButton().addActionListener((e) -> ThreadUtil.execute(() -> {
+            PushData.boostMode = true;
             if (App.config.getMsgType() != MessageTypeEnum.MP_TEMPLATE_CODE) {
                 JOptionPane.showMessageDialog(MainWindow.mainWindow.getMainPanel(), "性能模式目前仅支持微信模板消息，后续逐步增加对其他消息类型的支持！", "提示",
                         JOptionPane.INFORMATION_MESSAGE);
@@ -117,6 +118,7 @@ public void mouseExited(MouseEvent e) {
 
         // 按计划执行按钮事件
         BoostForm.boostForm.getScheduledRunButton().addActionListener((e -> ThreadUtil.execute(() -> {
+            PushData.boostMode = true;
             if (App.config.getMsgType() != MessageTypeEnum.MP_TEMPLATE_CODE) {
                 JOptionPane.showMessageDialog(MainWindow.mainWindow.getMainPanel(), "性能模式目前仅支持微信模板消息，后续逐步增加对其他消息类型的支持！", "提示",
                         JOptionPane.INFORMATION_MESSAGE);

File: src/main/java/com/fangxuele/tool/push/logic/PushRunThread.java
Patch:
@@ -42,16 +42,14 @@ public class PushRunThread extends Thread {
     public void run() {
         if (PushControl.pushCheck()) {
             PushForm.pushForm.getPushTotalProgressBar().setIndeterminate(true);
-
             // 准备推送
             preparePushRun();
+            PushForm.pushForm.getPushTotalProgressBar().setIndeterminate(false);
             ConsoleUtil.consoleWithLog("推送开始……");
             // 消息数据分片以及线程纷发
             shardingAndMsgThread();
             // 时间监控
             timeMonitor();
-
-            PushForm.pushForm.getPushTotalProgressBar().setIndeterminate(false);
         }
     }
 

File: src/main/java/com/fangxuele/tool/push/logic/msgmaker/BaseMsgMaker.java
Patch:
@@ -20,7 +20,7 @@ public class BaseMsgMaker {
      */
     VelocityContext getVelocityContext(String[] msgData) {
         VelocityContext velocityContext = new VelocityContext();
-        for (int i = 1; i < msgData.length; i++) {
+        for (int i = 0; i < msgData.length; i++) {
             velocityContext.put(PushControl.TEMPLATE_VAR_PREFIX + i, msgData[i]);
         }
         return velocityContext;

File: src/main/java/com/fangxuele/tool/push/logic/PushRunThread.java
Patch:
@@ -73,6 +73,7 @@ private void preparePushRun() {
 
         // 重置推送数据
         PushData.reset();
+        PushData.startTime = System.currentTimeMillis();
 
         // 拷贝准备的目标用户
         PushData.toSendList.addAll(PushData.allUser);
@@ -178,6 +179,8 @@ private void timeMonitor() {
                     PushForm.pushForm.getPushStopButton().setText("停止计划任务");
                 }
 
+                PushData.endTime = System.currentTimeMillis();
+
                 // 保存停止前的数据
                 try {
                     ConsoleUtil.consoleWithLog("正在保存结果数据……");

File: src/main/java/com/fangxuele/tool/push/util/ConfigUtil.java
Patch:
@@ -467,15 +467,15 @@ public void setAliSign(String aliSign) {
     }
 
     public String getMailHost() {
-        return setting.getStr("mailHost", "setting.mail", "");
+        return setting.getStr("mailHost", "setting.mail", "smtp.163.com");
     }
 
     public void setMailHost(String mailHost) {
         setting.put("setting.mail", "mailHost", mailHost);
     }
 
     public String getMailPort() {
-        return setting.getStr("mailPort", "setting.mail", "");
+        return setting.getStr("mailPort", "setting.mail", "25");
     }
 
     public void setMailPort(String mailPort) {

File: src/main/java/com/fangxuele/tool/push/ui/UiConsts.java
Patch:
@@ -16,7 +16,7 @@ public class UiConsts {
      * 软件名称,版本
      */
     public final static String APP_NAME = "WePush";
-    public final static String APP_VERSION = "v_3.1.0_190524";
+    public final static String APP_VERSION = "v_3.2.1_190603";
 
     /**
      * 主窗口图标-大

File: src/main/java/com/fangxuele/tool/push/util/UpgradeUtil.java
Patch:
@@ -37,7 +37,7 @@ public static void smoothUpgrade() {
         // 取得升级前版本
         String beforeVersion = App.config.getBeforeVersion();
 
-        if (currentVersion.equals(beforeVersion)) {
+        if (currentVersion.compareTo(beforeVersion) <= 0) {
             // 如果两者一致则不执行任何升级操作
             return;
         } else {

File: src/main/java/com/fangxuele/tool/push/util/UpgradeUtil.java
Patch:
@@ -37,7 +37,7 @@ public static void smoothUpgrade() {
         // 取得升级前版本
         String beforeVersion = App.config.getBeforeVersion();
 
-        if (currentVersion.equals(beforeVersion)) {
+        if (currentVersion.compareTo(beforeVersion) <= 0) {
             // 如果两者一致则不执行任何升级操作
             return;
         } else {

File: src/main/java/com/fangxuele/tool/push/ui/form/MemberForm.java
Patch:
@@ -208,14 +208,13 @@ public static void clearMember() {
         importFromSqlButton.setIcon(new ImageIcon(getClass().getResource("/icon/import_dark.png")));
         importFromSqlButton.setText("导入");
         memberTabCenterPanel.add(importFromSqlButton, new GridConstraints(2, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_HORIZONTAL, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));
-        final JScrollPane scrollPane3 = new JScrollPane();
-        memberTabCenterPanel.add(scrollPane3, new GridConstraints(0, 0, 2, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, null, null, null, 0, false));
         importFromSqlTextArea = new JTextArea();
         importFromSqlTextArea.setMinimumSize(new Dimension(1, 100));
         importFromSqlTextArea.setPreferredSize(new Dimension(1, 100));
         importFromSqlTextArea.setText("");
         importFromSqlTextArea.setToolTipText("只要查询出的结果集只有一列openid（短信时对应的是手机号）就可以，列名不重要；例如：SELECT openid FROM t_user");
-        scrollPane3.setViewportView(importFromSqlTextArea);
+        importFromSqlTextArea.setWrapStyleWord(true);
+        memberTabCenterPanel.add(importFromSqlTextArea, new GridConstraints(0, 0, 2, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, null, null, null, 0, false));
         importFromWeixinPanel = new JPanel();
         importFromWeixinPanel.setLayout(new GridLayoutManager(4, 6, new Insets(0, 15, 5, 0), -1, -1));
         memberPanelRight.add(importFromWeixinPanel, new GridConstraints(3, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, null, null, 0, false));

File: src/main/java/com/fangxuele/tool/push/ui/form/MemberForm.java
Patch:
@@ -101,7 +101,7 @@ public static void clearMember() {
     private void $$$setupUI$$$() {
         memberPanel = new JPanel();
         memberPanel.setLayout(new GridLayoutManager(1, 1, new Insets(0, 0, 0, 0), -1, -1));
-        memberPanel.setMinimumSize(new Dimension(1280, 738));
+        memberPanel.setMinimumSize(new Dimension(-1, -1));
         memberPanel.setOpaque(true);
         memberPanel.setPreferredSize(new Dimension(1280, 738));
         final JSplitPane splitPane1 = new JSplitPane();

File: src/main/java/com/fangxuele/tool/push/ui/form/SettingForm.java
Patch:
@@ -440,7 +440,6 @@ public static void initSwitchMultiAccount() {
         defaultComboBoxModel1.addElement("Darcula(推荐)");
         defaultComboBoxModel1.addElement("BeautyEye");
         defaultComboBoxModel1.addElement("系统默认");
-        defaultComboBoxModel1.addElement("weblaf");
         settingThemeComboBox.setModel(defaultComboBoxModel1);
         panel19.add(settingThemeComboBox, new GridConstraints(0, 1, 1, 2, GridConstraints.ANCHOR_WEST, GridConstraints.FILL_HORIZONTAL, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_FIXED, new Dimension(300, -1), new Dimension(300, -1), null, 0, false));
         final JLabel label27 = new JLabel();

File: src/main/java/com/fangxuele/tool/push/logic/RunPushThread.java
Patch:
@@ -118,15 +118,15 @@ public void run() {
                 thread = new TemplateMsgMpServiceThread(startIndex, endIndex);
 
                 WxMpService wxMpService = PushManage.getWxMpService();
-                if (wxMpService.getWxMpConfigStorage() == null) {
+                if (wxMpService == null || wxMpService.getWxMpConfigStorage() == null) {
                     return;
                 }
                 thread.setWxMpService(wxMpService);
             } else if (MessageTypeEnum.MA_TEMPLATE_CODE == msgType) {
                 thread = new TemplateMsgMaServiceThread(startIndex, endIndex);
 
                 WxMaService wxMaService = PushManage.getWxMaService();
-                if (wxMaService.getWxMaConfig() == null) {
+                if (wxMaService == null || wxMaService.getWxMaConfig() == null) {
                     return;
                 }
                 ((TemplateMsgMaServiceThread) thread).setWxMaService(wxMaService);

File: src/main/java/com/fangxuele/tool/push/logic/BaseMsgServiceThread.java
Patch:
@@ -85,8 +85,8 @@ public void run() {
      * 初始化当前线程
      */
     void initCurrentThread() {
-        PushManage.console("线程" + this.getName() + "负责处理:" + startIndex + "-" +
-                endIndex + "的分片数据");
+        PushManage.console("线程" + this.getName() + "负责处理第:" + startIndex + "-" +
+                endIndex + "条的数据");
 
         list = PushData.toSendList.subList(startIndex, endIndex);
 
@@ -105,7 +105,7 @@ void initCurrentThread() {
      */
     void currentThreadFinish() {
         PushManage.console(this.getName() + "已处理完第" + startIndex + "-" +
-                endIndex + "页的数据");
+                endIndex + "条的数据");
 
         PushData.increaseStopedThread();
     }

File: src/main/java/com/fangxuele/tool/push/ui/form/MemberForm.java
Patch:
@@ -119,7 +119,7 @@ public static void clearMember() {
         panel1.add(scrollPane1, new GridConstraints(1, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, null, null, null, 0, false));
         memberListTable = new JTable();
         memberListTable.setGridColor(new Color(-12236470));
-        memberListTable.setRowHeight(35);
+        memberListTable.setRowHeight(36);
         scrollPane1.setViewportView(memberListTable);
         final JPanel panel2 = new JPanel();
         panel2.setLayout(new GridLayoutManager(1, 5, new Insets(0, 5, 0, 0), -1, -1));

File: src/main/java/com/fangxuele/tool/push/ui/form/MessageManageForm.java
Patch:
@@ -128,7 +128,7 @@ public static void init() {
         messageManagePanel.add(scrollPane1, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, null, null, null, 0, false));
         msgHistable = new JTable();
         msgHistable.setGridColor(new Color(-12236470));
-        msgHistable.setRowHeight(35);
+        msgHistable.setRowHeight(36);
         msgHistable.setShowVerticalLines(false);
         scrollPane1.setViewportView(msgHistable);
         final JPanel panel2 = new JPanel();

File: src/main/java/com/fangxuele/tool/push/ui/form/PushForm.java
Patch:
@@ -230,7 +230,7 @@ public static void init() {
         pushCenterPanel.add(scrollPane2, new GridConstraints(1, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, null, null, null, 0, false));
         pushThreadTable = new JTable();
         pushThreadTable.setGridColor(new Color(-12236470));
-        pushThreadTable.setRowHeight(35);
+        pushThreadTable.setRowHeight(36);
         pushThreadTable.setShowVerticalLines(false);
         scrollPane2.setViewportView(pushThreadTable);
     }

File: src/main/java/com/fangxuele/tool/push/ui/form/PushHisForm.java
Patch:
@@ -124,7 +124,7 @@ public static void init() {
         pushHisLeftTable.setDoubleBuffered(true);
         pushHisLeftTable.setGridColor(new Color(-12236470));
         pushHisLeftTable.setIntercellSpacing(new Dimension(1, 1));
-        pushHisLeftTable.setRowHeight(35);
+        pushHisLeftTable.setRowHeight(36);
         pushHisLeftTable.setShowVerticalLines(false);
         scrollPane1.setViewportView(pushHisLeftTable);
         final JPanel panel4 = new JPanel();

File: src/main/java/com/fangxuele/tool/push/ui/form/PushForm.java
Patch:
@@ -230,7 +230,7 @@ public static void init() {
         pushCenterPanel.add(scrollPane2, new GridConstraints(1, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, null, null, null, 0, false));
         pushThreadTable = new JTable();
         pushThreadTable.setGridColor(new Color(-12236470));
-        pushThreadTable.setRowHeight(40);
+        pushThreadTable.setRowHeight(35);
         pushThreadTable.setShowVerticalLines(false);
         scrollPane2.setViewportView(pushThreadTable);
     }

File: src/main/java/com/fangxuele/tool/push/ui/form/MemberForm.java
Patch:
@@ -119,7 +119,7 @@ public static void clearMember() {
         panel1.add(scrollPane1, new GridConstraints(1, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, null, null, null, 0, false));
         memberListTable = new JTable();
         memberListTable.setGridColor(new Color(-12236470));
-        memberListTable.setRowHeight(46);
+        memberListTable.setRowHeight(35);
         scrollPane1.setViewportView(memberListTable);
         final JPanel panel2 = new JPanel();
         panel2.setLayout(new GridLayoutManager(1, 5, new Insets(0, 5, 0, 0), -1, -1));

File: src/main/java/com/fangxuele/tool/push/ui/form/MessageManageForm.java
Patch:
@@ -128,7 +128,7 @@ public static void init() {
         messageManagePanel.add(scrollPane1, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, null, null, null, 0, false));
         msgHistable = new JTable();
         msgHistable.setGridColor(new Color(-12236470));
-        msgHistable.setRowHeight(46);
+        msgHistable.setRowHeight(35);
         msgHistable.setShowVerticalLines(false);
         scrollPane1.setViewportView(msgHistable);
         final JPanel panel2 = new JPanel();

File: src/main/java/com/fangxuele/tool/push/ui/form/PushHisForm.java
Patch:
@@ -124,7 +124,7 @@ public static void init() {
         pushHisLeftTable.setDoubleBuffered(true);
         pushHisLeftTable.setGridColor(new Color(-12236470));
         pushHisLeftTable.setIntercellSpacing(new Dimension(1, 1));
-        pushHisLeftTable.setRowHeight(46);
+        pushHisLeftTable.setRowHeight(35);
         pushHisLeftTable.setShowVerticalLines(false);
         scrollPane1.setViewportView(pushHisLeftTable);
         final JPanel panel4 = new JPanel();

File: src/main/java/com/fangxuele/tool/push/ui/listener/MemberListener.java
Patch:
@@ -714,7 +714,7 @@ private static void renderMemberListTable() {
         if (isWeixinTypeMsg && MemberForm.memberForm.getImportOptionAvatarCheckBox().isSelected()) {
             memberListTable.setRowHeight(66);
         } else {
-            memberListTable.setRowHeight(46);
+            memberListTable.setRowHeight(36);
         }
 
         List<Object> rowDataList;
@@ -786,6 +786,5 @@ private static void renderMemberListTable() {
             }
             progressBar.setValue(i + 1);
         }
-        memberListTable.updateUI();
     }
 }

File: src/main/java/com/fangxuele/tool/push/util/ConfigUtil.java
Patch:
@@ -381,7 +381,7 @@ public void setFont(String font) {
     }
 
     public int getFontSize() {
-        return setting.getInt("fontSize", "setting.appearance", 18);
+        return setting.getInt("fontSize", "setting.appearance", 13);
     }
 
     public void setFontSize(int fontSize) {

File: src/main/java/com/fangxuele/tool/push/ui/form/MessageTypeForm.java
Patch:
@@ -38,6 +38,8 @@ public class MessageTypeForm {
     private JRadioButton luosimao短信RadioButton;
     private JRadioButton 极光短信RadioButton;
     private JRadioButton 极光推送RadioButton;
+    private JRadioButton 企业号企业微信RadioButton;
+    private JRadioButton 钉钉RadioButton;
 
     public static MessageTypeForm messageTypeForm = new MessageTypeForm();
 

File: src/main/java/com/fangxuele/tool/push/ui/listener/PushListener.java
Patch:
@@ -313,8 +313,9 @@ private static boolean checkBeforePush() {
             return false;
         }
         if (StringUtils.isEmpty(MessageEditForm.messageEditForm.getMsgNameField().getText())) {
-            JOptionPane.showMessageDialog(PushForm.pushForm.getPushPanel(), "请先编辑消息！", "提示",
+            JOptionPane.showMessageDialog(PushForm.pushForm.getPushPanel(), "请先选择一条消息！", "提示",
                     JOptionPane.INFORMATION_MESSAGE);
+            MainWindow.mainWindow.getTabbedPane().setSelectedIndex(2);
 
             return false;
         }

File: src/main/java/com/fangxuele/tool/push/logic/PushManage.java
Patch:
@@ -20,6 +20,7 @@
 import com.fangxuele.tool.push.ui.form.PushForm;
 import com.fangxuele.tool.push.ui.form.PushHisForm;
 import com.fangxuele.tool.push.ui.form.SettingForm;
+import com.fangxuele.tool.push.ui.listener.MemberListener;
 import com.fangxuele.tool.push.util.MybatisUtil;
 import com.fangxuele.tool.push.util.SqliteUtil;
 import com.fangxuele.tool.push.util.SystemUtil;
@@ -84,7 +85,7 @@ public static boolean preview() throws Exception {
         List<String[]> msgDataList = new ArrayList<>();
 
         for (String data : MessageEditForm.messageEditForm.getPreviewUserField().getText().split(";")) {
-            msgDataList.add(data.split(","));
+            msgDataList.add(data.split(MemberListener.TXT_FILE_DATA_SEPERATOR_REGEX));
         }
 
         switch (Init.config.getMsgType()) {

File: src/main/java/com/fangxuele/tool/push/ui/UiConsts.java
Patch:
@@ -16,7 +16,7 @@ public class UiConsts {
      * 软件名称,版本
      */
     public final static String APP_NAME = "WePush";
-    public final static String APP_VERSION = "v_2.3.3_190107";
+    public final static String APP_VERSION = "v_3.0.0_190516";
 
     /**
      * 主窗口图标

File: src/main/java/com/fangxuele/tool/push/ui/listener/MemberListener.java
Patch:
@@ -76,7 +76,7 @@ public class MemberListener {
      */
     public static Set<String> tagUserSet;
 
-    private static final String TXT_FILE_DATA_SEPERATOR_REGEX = "\\|";
+    public static final String TXT_FILE_DATA_SEPERATOR_REGEX = "\\|";
 
     private static List<String> toSearchRowsList;
 
@@ -297,7 +297,7 @@ public static void addListeners() {
                         currentImported++;
                         MemberForm.memberForm.getMemberTabCountLabel().setText(String.valueOf(currentImported));
                     }
-                    getMpUserList();
+                    renderMemberListTable();
                     JOptionPane.showMessageDialog(MemberForm.memberForm.getMemberPanel(), "导入完成！", "完成",
                             JOptionPane.INFORMATION_MESSAGE);
 

File: src/main/java/com/fangxuele/tool/push/ui/listener/PushHisListener.java
Patch:
@@ -147,7 +147,7 @@ public void mouseClicked(MouseEvent e) {
                     }
 
                     for (int row : selectedRows) {
-                        Integer selectedId = (Integer) PushHisForm.pushHisForm.getPushHisLeftTable().getValueAt(row, 4);
+                        Integer selectedId = (Integer) PushHisForm.pushHisForm.getPushHisLeftTable().getValueAt(row, 3);
                         TPushHistory tPushHistory = pushHistoryMapper.selectByPrimaryKey(selectedId);
                         File msgTemplateDataFile = new File(tPushHistory.getCsvFile());
                         if (msgTemplateDataFile.exists()) {

File: src/main/java/com/fangxuele/tool/push/util/MybatisUtil.java
Patch:
@@ -69,7 +69,7 @@ private static void initDbFile() throws SQLException {
         if (!dbFile.exists()) {
             File configHomeDir = new File(SystemUtil.configHome);
             if (!configHomeDir.exists()) {
-                FileUtil.touch(configHomeDir);
+                configHomeDir.mkdirs();
             }
             // 不存在db文件时会自动创建一个
             Connection connection = DriverManager.getConnection("jdbc:sqlite:" + dbFile.getAbsolutePath());

File: src/main/java/com/fangxuele/tool/push/ui/form/MainWindow.java
Patch:
@@ -78,7 +78,7 @@ public void init() {
         tabbedPane.addTab("①选择消息类型", messageTypePanel);
         messagePanel = new JSplitPane();
         messagePanel.setContinuousLayout(true);
-        messagePanel.setDividerLocation(300);
+        messagePanel.setDividerLocation(440);
         messagePanel.setDividerSize(4);
         messagePanel.setDoubleBuffered(true);
         tabbedPane.addTab("②编辑消息", messagePanel);

File: src/main/java/com/fangxuele/tool/push/ui/form/MemberForm.java
Patch:
@@ -106,10 +106,10 @@ public static void clearMember() {
         memberPanel.setPreferredSize(new Dimension(1280, 738));
         final JSplitPane splitPane1 = new JSplitPane();
         splitPane1.setContinuousLayout(true);
-        splitPane1.setDividerLocation(800);
+        splitPane1.setDividerLocation(900);
         splitPane1.setDividerSize(4);
         splitPane1.setDoubleBuffered(true);
-        splitPane1.setLastDividerLocation(720);
+        splitPane1.setLastDividerLocation(800);
         memberPanel.add(splitPane1, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, new Dimension(200, 200), null, 0, false));
         final JPanel panel1 = new JPanel();
         panel1.setLayout(new GridLayoutManager(3, 1, new Insets(0, 0, 0, 0), -1, -1));

File: src/main/java/com/fangxuele/tool/push/App.java
Patch:
@@ -29,6 +29,7 @@ public static void main(String[] args) {
         JPanel loadingPanel = new LoadingForm().getLoadingPanel();
         mainFrame.add(loadingPanel);
         mainFrame.pack();
+        mainFrame.setExtendedState(JFrame.MAXIMIZED_BOTH);
         mainFrame.setVisible(true);
 
         SwingUtilities.invokeLater(() -> {

File: src/main/java/com/fangxuele/tool/push/ui/frame/MainFrame.java
Patch:
@@ -39,11 +39,11 @@ public void init() {
 
         //得到屏幕的尺寸
         Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();
-        this.setBounds((int) (screenSize.width * 0.1), (int) (screenSize.height * 0.08), (int) (screenSize.width * 0.8),
-                (int) (screenSize.height * 0.8));
+        this.setBounds((int) (screenSize.width * 0.1), (int) (screenSize.height * 0.06), (int) (screenSize.width * 0.8),
+                (int) (screenSize.height * 0.83));
 
         Dimension preferSize = new Dimension((int) (screenSize.width * 0.8),
-                (int) (screenSize.height * 0.8));
+                (int) (screenSize.height * 0.83));
         this.setPreferredSize(preferSize);
     }
 

File: src/main/java/com/fangxuele/tool/push/ui/form/MemberForm.java
Patch:
@@ -3,7 +3,6 @@
 import com.fangxuele.tool.push.logic.PushData;
 import com.fangxuele.tool.push.ui.Init;
 import com.fangxuele.tool.push.ui.listener.MemberListener;
-import com.fangxuele.tool.push.util.JTableUtil;
 import com.intellij.uiDesigner.core.GridConstraints;
 import com.intellij.uiDesigner.core.GridLayoutManager;
 import com.intellij.uiDesigner.core.Spacer;
@@ -82,8 +81,6 @@ public static void clearMember() {
         DefaultTableModel model = new DefaultTableModel(null, headerNames);
         memberForm.getMemberListTable().setModel(model);
 
-        // 隐藏表头
-        JTableUtil.hideTableHeader(memberForm.getMemberListTable());
         MemberListener.tagUserSet = null;
     }
 

File: src/main/java/com/fangxuele/tool/push/ui/form/MemberForm.java
Patch:
@@ -250,7 +250,7 @@ public static void clearMember() {
         importOptionPanel = new JPanel();
         importOptionPanel.setLayout(new GridLayoutManager(1, 4, new Insets(0, 0, 0, 0), -1, -1));
         memberPanelRight.add(importOptionPanel, new GridConstraints(6, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, null, null, 0, false));
-        importOptionPanel.setBorder(BorderFactory.createTitledBorder(BorderFactory.createLineBorder(new Color(-276358)), "导入选项", TitledBorder.DEFAULT_JUSTIFICATION, TitledBorder.DEFAULT_POSITION, this.$$$getFont$$$(null, Font.BOLD, -1, importOptionPanel.getFont())));
+        importOptionPanel.setBorder(BorderFactory.createTitledBorder(BorderFactory.createLineBorder(new Color(-276358)), "导入选项", TitledBorder.DEFAULT_JUSTIFICATION, TitledBorder.DEFAULT_POSITION, this.$$$getFont$$$(null, Font.BOLD, -1, importOptionPanel.getFont()), new Color(-276358)));
         importOptionOpenIdCheckBox = new JCheckBox();
         importOptionOpenIdCheckBox.setEnabled(false);
         importOptionOpenIdCheckBox.setSelected(true);

File: src/main/java/com/fangxuele/tool/push/ui/form/MessageTypeForm.java
Patch:
@@ -93,6 +93,8 @@ public static void init() {
         MessageEditForm.switchMsgType(msgType);
         MessageManageForm.init();
         MessageEditForm.clearAllField();
+        MemberForm.init();
+        PushHisForm.init();
     }
 
     /**

File: src/main/java/com/fangxuele/tool/push/ui/form/MainWindow.java
Patch:
@@ -45,7 +45,7 @@ public void init() {
         mainWindow.getMessageManagePanel().add(MessageManageForm.messageManageForm.getMessageManagePanel(), new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, new Dimension(200, 200), null, 0, false));
         mainWindow.getMemberPanel().add(MemberForm.memberForm.getMemberPanel(), new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, new Dimension(200, 200), null, 0, false));
         mainWindow.getPushPanel().add(PushForm.pushForm.getPushPanel(), new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, new Dimension(200, 200), null, 0, false));
-        mainWindow.getMessageTypePanel().add(MessageTypeForm.messageTypeForm.getPanel2(), new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, new Dimension(200, 200), null, 0, false));
+        mainWindow.getMessageTypePanel().add(MessageTypeForm.messageTypeForm.getMessageTypePanel(), new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, new Dimension(200, 200), null, 0, false));
     }
 
     {

File: src/main/java/com/fangxuele/tool/push/logic/RunPushThread.java
Patch:
@@ -89,7 +89,7 @@ public void run() {
 
         DefaultTableCellRenderer hr = (DefaultTableCellRenderer) PushForm.pushForm.getPushThreadTable().getTableHeader()
                 .getDefaultRenderer();
-        // 表头列名居中
+        // 表头列名居左
         hr.setHorizontalAlignment(DefaultTableCellRenderer.LEFT);
         PushForm.pushForm.getPushThreadTable().updateUI();
 

File: src/main/java/com/fangxuele/tool/push/ui/Init.java
Patch:
@@ -11,6 +11,7 @@
 import com.fangxuele.tool.push.ui.form.MessageManageForm;
 import com.fangxuele.tool.push.ui.form.MessageTypeForm;
 import com.fangxuele.tool.push.ui.form.PushForm;
+import com.fangxuele.tool.push.ui.form.PushHisForm;
 import com.fangxuele.tool.push.ui.form.ScheduleForm;
 import com.fangxuele.tool.push.ui.form.SettingForm;
 import com.fangxuele.tool.push.ui.form.UserCaseForm;
@@ -131,6 +132,7 @@ public static void initAllTab() {
         PushForm.init();
         ScheduleForm.init();
         SettingForm.init();
+        PushHisForm.init();
 
         // 检查新版版
         if (config.isAutoCheckUpdate()) {

File: src/main/java/com/fangxuele/tool/push/ui/listener/PushHisListener.java
Patch:
@@ -124,8 +124,10 @@ public void mouseClicked(MouseEvent e) {
 
                                 File msgTemplateDataFile = new File(tPushHistory.getCsvFile());
                                 if (msgTemplateDataFile.exists()) {
-                                    msgTemplateDataFile.delete();
+                                   msgTemplateDataFile.delete();
                                 }
+
+                                pushHistoryMapper.deleteByPrimaryKey(selectedId);
                                 tableModel.removeRow(i);
                                 PushHisForm.pushHisForm.getPushHisLeftTable().updateUI();
                                 i = 0;

File: src/main/java/com/fangxuele/tool/push/logic/RunPushThread.java
Patch:
@@ -109,7 +109,7 @@ public void run() {
             }
             int endIndex = i * perThread + perThread;
             if (endIndex > totalCount - 1) {
-                endIndex = (int) (totalCount - 1);
+                endIndex = (int) (totalCount);
             }
             if (MessageTypeEnum.MP_TEMPLATE_CODE == msgType) {
                 thread = new TemplateMsgMpServiceThread(startIndex, endIndex);

File: src/main/java/com/fangxuele/tool/push/ui/form/MessageEditForm.java
Patch:
@@ -148,7 +148,7 @@ public static void init(String selectedMsgName) {
                 }
                 messageEditForm.getMsgKefuPicUrlTextField().setText(tMsgKefuPriority.getImgUrl());
                 messageEditForm.getMsgKefuDescTextField().setText(tMsgKefuPriority.getDescribe());
-                messageEditForm.getMsgKefuUrlTextField().setText(tMsgKefuPriority.getUrl());
+                messageEditForm.getMsgKefuUrlTextField().setText(tMsgKefuPriority.getKefuUrl());
 
                 switchKefuMsgType(kefuMsgType);
             }
@@ -512,8 +512,8 @@ public static void initTemplateDataTable() {
         kefuMsgPanel.add(spacer1, new GridConstraints(5, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_VERTICAL, 1, GridConstraints.SIZEPOLICY_WANT_GROW, null, null, null, 0, false));
         msgKefuMsgTypeComboBox = new JComboBox();
         final DefaultComboBoxModel defaultComboBoxModel1 = new DefaultComboBoxModel();
-        defaultComboBoxModel1.addElement("文本消息");
         defaultComboBoxModel1.addElement("图文消息");
+        defaultComboBoxModel1.addElement("文本消息");
         msgKefuMsgTypeComboBox.setModel(defaultComboBoxModel1);
         kefuMsgPanel.add(msgKefuMsgTypeComboBox, new GridConstraints(0, 1, 1, 1, GridConstraints.ANCHOR_WEST, GridConstraints.FILL_HORIZONTAL, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));
         kefuMsgTitleLabel = new JLabel();

File: src/main/java/com/fangxuele/tool/push/dao/TTemplateDataMapper.java
Patch:
@@ -1,6 +1,7 @@
 package com.fangxuele.tool.push.dao;
 
 import com.fangxuele.tool.push.domain.TTemplateData;
+import org.apache.ibatis.annotations.Param;
 
 import java.util.List;
 
@@ -17,7 +18,7 @@ public interface TTemplateDataMapper {
 
     int updateByPrimaryKey(TTemplateData record);
 
-    List<TTemplateData> selectByMsgId(int msgId);
+    List<TTemplateData> selectByMsgTypeAndMsgId(@Param("msgType") int msgType, @Param("msgId") int msgId);
 
-    int deleteByMsgId(int msgId);
+    int deleteByMsgTypeAndMsgId(@Param("msgType") int msgType, @Param("msgId") int msgId);
 }
\ No newline at end of file

File: src/main/java/com/fangxuele/tool/push/ui/form/MessageEditForm.java
Patch:
@@ -185,7 +185,7 @@ public static void init(String selectedMsgName) {
         }
         if (msgType != MessageTypeEnum.KEFU_CODE) {
             // 模板消息Data表
-            List<TTemplateData> templateDataList = templateDataMapper.selectByMsgId(msgId);
+            List<TTemplateData> templateDataList = templateDataMapper.selectByMsgTypeAndMsgId(msgType, msgId);
             String[] headerNames = {"Name", "Value", "Color", "操作"};
             Object[][] cellData = new String[templateDataList.size()][headerNames.length];
             for (int i = 0; i < templateDataList.size(); i++) {
@@ -230,10 +230,10 @@ public static void clearAllField() {
         messageEditForm.getMsgTemplateMiniPagePathTextField().setText("");
         messageEditForm.getMsgTemplateKeyWordTextField().setText("");
         messageEditForm.getMsgYunpianMsgContentTextField().setText("");
-        messageEditForm.getPreviewUserField().setText("");
         messageEditForm.getTemplateDataNameTextField().setText("");
         messageEditForm.getTemplateDataValueTextField().setText("");
         messageEditForm.getTemplateDataColorTextField().setText("");
+        messageEditForm.getPreviewUserField().setText("");
         initTemplateDataTable();
     }
 

File: src/main/java/com/fangxuele/tool/push/ui/listener/MsgListener.java
Patch:
@@ -348,7 +348,7 @@ public void mouseClicked(MouseEvent e) {
 
                         // 如果是覆盖保存，则先清空之前的模板数据
                         if (existSameMsg) {
-                            templateDataMapper.deleteByMsgId(msgId);
+                            templateDataMapper.deleteByMsgTypeAndMsgId(msgType, msgId);
                         }
 
                         // 如果table为空，则初始化
@@ -366,6 +366,7 @@ public void mouseClicked(MouseEvent e) {
                             String color = ((String) tableModel.getValueAt(i, 2)).trim();
 
                             TTemplateData tTemplateData = new TTemplateData();
+                            tTemplateData.setMsgType(msgType);
                             tTemplateData.setMsgId(msgId);
                             tTemplateData.setName(name);
                             tTemplateData.setValue(value);

File: src/main/java/com/fangxuele/tool/push/ui/form/MessageTypeForm.java
Patch:
@@ -124,10 +124,10 @@ public static void clearAllSelected() {
         messageTypePanel.setAutoscrolls(false);
         final JScrollPane scrollPane1 = new JScrollPane();
         scrollPane1.setAutoscrolls(false);
-        messageTypePanel.add(scrollPane1, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_NORTHWEST, GridConstraints.FILL_NONE, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, null, null, null, 0, false));
+        messageTypePanel.add(scrollPane1, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, null, null, null, 0, false));
         panel2 = new JPanel();
         panel2.setLayout(new GridLayoutManager(16, 2, new Insets(20, 20, 0, 0), -1, -1));
-        panel2.setAutoscrolls(true);
+        panel2.setAutoscrolls(false);
         scrollPane1.setViewportView(panel2);
         mpTemplateRadioButton = new JRadioButton();
         mpTemplateRadioButton.setEnabled(true);

File: src/main/java/com/fangxuele/tool/push/ui/frame/MainFrame.java
Patch:
@@ -6,6 +6,7 @@
 import com.fangxuele.tool.push.ui.listener.FramListener;
 import com.fangxuele.tool.push.ui.listener.HelpListener;
 import com.fangxuele.tool.push.ui.listener.MemberListener;
+import com.fangxuele.tool.push.ui.listener.MessageTypeListener;
 import com.fangxuele.tool.push.ui.listener.MsgListener;
 import com.fangxuele.tool.push.ui.listener.PushHisListener;
 import com.fangxuele.tool.push.ui.listener.PushListener;
@@ -50,6 +51,7 @@ public void init() {
      * 添加事件监听
      */
     public void addListeners() {
+        MessageTypeListener.addListeners();
         AboutListener.addListeners();
         HelpListener.addListeners();
         PushHisListener.addListeners();

File: src/main/java/com/fangxuele/tool/push/ui/listener/HelpListener.java
Patch:
@@ -1,7 +1,5 @@
 package com.fangxuele.tool.push.ui.listener;
 
-import cn.hutool.log.Log;
-import cn.hutool.log.LogFactory;
 import com.fangxuele.tool.push.ui.form.HelpForm;
 
 import java.awt.*;
@@ -20,7 +18,6 @@
  * @since 2018/2/9.
  */
 public class HelpListener {
-    private static final Log logger = LogFactory.get();
 
     public static void addListeners() {
         HelpForm.helpForm.getLabelOnlineHelp().addMouseListener(new MouseAdapter() {

File: src/main/java/com/fangxuele/tool/push/util/ConfigUtil.java
Patch:
@@ -132,7 +132,7 @@ public int getMsgType() {
     }
 
     public void setMsgType(int msgType) {
-        setting.put("msg", "msgType", msgName);
+        setting.put("msg", "msgType", String.valueOf(msgType));
     }
 
 

File: src/main/java/com/fangxuele/tool/push/ui/form/PushForm.java
Patch:
@@ -64,7 +64,7 @@ public class PushForm {
         final JPanel panel1 = new JPanel();
         panel1.setLayout(new GridLayoutManager(1, 1, new Insets(0, 0, 0, 0), -1, -1));
         pushPanel = new JPanel();
-        pushPanel.setLayout(new GridLayoutManager(3, 1, new Insets(10, 10, 10, 10), -1, -1));
+        pushPanel.setLayout(new GridLayoutManager(3, 1, new Insets(0, 10, 0, 10), -1, -1));
         panel1.add(pushPanel, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, null, null, 0, false));
         pushUpPanel = new JPanel();
         pushUpPanel.setLayout(new GridLayoutManager(8, 13, new Insets(0, 0, 0, 0), -1, -1));

File: src/main/java/com/fangxuele/tool/push/ui/form/MainWindow.java
Patch:
@@ -45,7 +45,7 @@ public void init() {
         mainWindow.getMessageManagePanel().add(MessageManageForm.messageManageForm.getMessageManagePanel(), new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, new Dimension(200, 200), null, 0, false));
         mainWindow.getMemberPanel().add(MemberForm.memberForm.getMemberPanel(), new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, new Dimension(200, 200), null, 0, false));
         mainWindow.getPushPanel().add(PushForm.pushForm.getPushPanel(), new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, new Dimension(200, 200), null, 0, false));
-        mainWindow.getMessageTypePanel().add(MessageTypeForm.messageTypeForm.getMessageTypePanel(), new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, new Dimension(200, 200), null, 0, false));
+        mainWindow.getMessageTypePanel().add(MessageTypeForm.messageTypeForm.getPanel2(), new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, new Dimension(200, 200), null, 0, false));
     }
 
     {

File: src/main/java/com/fangxuele/tool/push/ui/Init.java
Patch:
@@ -556,7 +556,7 @@ public static void initSettingTab() {
         // 外观
         SettingForm.settingForm.getSettingThemeComboBox().setSelectedItem(configer.getTheme());
         SettingForm.settingForm.getSettingFontNameComboBox().setSelectedItem(configer.getFont());
-        SettingForm.settingForm.getSettingFontSizeComboBox().setSelectedItem(configer.getFontSize());
+        SettingForm.settingForm.getSettingFontSizeComboBox().setSelectedItem(String.valueOf(configer.getFontSize()));
 
         // 历史消息管理
         String[] headerNames = {"选择", "消息名称"};

File: src/main/java/com/fangxuele/tool/push/logic/PushData.java
Patch:
@@ -34,7 +34,6 @@ public class PushData {
      * 发送失败数
      */
     public static LongAdder failRecords = new LongAdder();
-    ;
 
     /**
      * 准备发送的列表

File: src/main/java/com/fangxuele/tool/push/ui/listener/TabListener.java
Patch:
@@ -26,7 +26,6 @@ public class TabListener {
     private static boolean warnFlag = true;
 
     public static void addListeners() {
-        // 暂时停止使用，仅留作demo，日后需要时再使用
         MainWindow.mainWindow.getTabbedPane().addMouseListener(new MouseAdapter() {
             @Override
             public void mouseClicked(MouseEvent e) {

File: src/main/java/com/fangxuele/tool/push/ui/listener/PushListener.java
Patch:
@@ -298,7 +298,6 @@ static void refreshPushInfo() {
         // 总记录数
         long totalCount = PushData.allUser.size();
         PushForm.pushForm.getPushTotalCountLabel().setText("消息总数：" + totalCount);
-        PushForm.pushForm.getPushTotalProgressBar().setMaximum((int) totalCount);
         // 每个线程平均分配
         int threadCount = Integer.parseInt(PushForm.pushForm.getThreadCountTextField().getText());
         int perThread = (int) (totalCount / threadCount) + 1;

File: src/main/java/com/fangxuele/tool/push/logic/PushData.java
Patch:
@@ -1,5 +1,7 @@
 package com.fangxuele.tool.push.logic;
 
+import java.util.ArrayList;
+import java.util.Collections;
 import java.util.List;
 import java.util.concurrent.atomic.LongAdder;
 
@@ -16,7 +18,7 @@ public class PushData {
     /**
      * 导入的用户
      */
-    public static List<String[]> allUser;
+    public static List<String[]> allUser = Collections.synchronizedList(new ArrayList<>());
 
     /**
      * 总记录数

File: src/main/java/com/fangxuele/tool/push/ui/form/ScheduleForm.java
Patch:
@@ -49,7 +49,7 @@ public class ScheduleForm {
         panel1.setLayout(new GridLayoutManager(1, 1, new Insets(0, 0, 0, 0), -1, -1));
         schedulePanel = new JPanel();
         schedulePanel.setLayout(new GridLayoutManager(5, 7, new Insets(10, 10, 10, 10), -1, -1));
-        panel1.add(schedulePanel, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_NONE, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, null, null, 0, false));
+        panel1.add(schedulePanel, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, null, null, 0, false));
         runAtThisTimeRadioButton = new JRadioButton();
         runAtThisTimeRadioButton.setText("在此时间开始推送：");
         schedulePanel.add(runAtThisTimeRadioButton, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_WEST, GridConstraints.FILL_NONE, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));

File: src/main/java/com/fangxuele/tool/push/ui/form/SettingForm.java
Patch:
@@ -81,7 +81,7 @@ public class SettingForm {
         settingPanel.setLayout(new GridLayoutManager(1, 1, new Insets(0, 0, 0, 0), -1, -1));
         Font settingPanelFont = this.$$$getFont$$$("Microsoft YaHei UI", -1, -1, settingPanel.getFont());
         if (settingPanelFont != null) settingPanel.setFont(settingPanelFont);
-        panel1.add(settingPanel, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_NONE, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, null, null, 0, false));
+        panel1.add(settingPanel, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, null, null, 0, false));
         settingScrollPane = new JScrollPane();
         settingPanel.add(settingScrollPane, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_WANT_GROW, null, null, null, 0, false));
         final JPanel panel2 = new JPanel();
@@ -417,4 +417,5 @@ public class SettingForm {
         }
         return new Font(resultName, style >= 0 ? style : currentFont.getStyle(), size >= 0 ? size : currentFont.getSize());
     }
+
 }

File: src/main/java/com/fangxuele/tool/push/ui/frame/MainFrame.java
Patch:
@@ -30,6 +30,7 @@
 public class MainFrame extends JFrame {
     public void init() {
         this.setName(UiConsts.APP_NAME);
+        this.setTitle(UiConsts.APP_NAME);
         this.setIconImage(UiConsts.IMAGE_ICON);
         // Mac系统Dock图标
         if (SystemUtil.isMacOs()) {

File: src/main/java/com/fangxuele/tool/push/ui/frame/MainFrame.java
Patch:
@@ -30,6 +30,7 @@
 public class MainFrame extends JFrame {
     public void init() {
         this.setName(UiConsts.APP_NAME);
+        this.setTitle(UiConsts.APP_NAME);
         this.setIconImage(UiConsts.IMAGE_ICON);
         // Mac系统Dock图标
         if (SystemUtil.isMacOs()) {

File: src/main/java/com/fangxuele/tool/push/ui/Init.java
Patch:
@@ -255,10 +255,10 @@ public static void initMsgTab(String selectedMsgName) {
                 MainWindow.mainWindow.setMsgKefuPicUrlTextField(msgDataArray[6]);
                 MainWindow.mainWindow.setMsgKefuDescTextField(msgDataArray[7]);
                 MainWindow.mainWindow.setMsgKefuUrlTextField(msgDataArray[8]);
-                if (msgDataArray.length > 11) {
+                if (msgDataArray.length > 12) {
                     MainWindow.mainWindow.setMsgYunpianMsgContentTextField(msgDataArray[12]);
                 }
-                if (msgDataArray.length > 10) {
+                if (msgDataArray.length > 11) {
                     MainWindow.mainWindow.setMsgTemplateKeyWordTextField(msgDataArray[11]);
                 }
                 if (msgDataArray.length > 9) {

File: src/main/java/com/fangxuele/tool/wechat/push/ui/listener/MsgListener.java
Patch:
@@ -117,7 +117,7 @@ public void run() {
                     record[8] = MainWindow.mainWindow.getMsgKefuUrlTextField().getText();
                     record[9] = MainWindow.mainWindow.getMsgTemplateMiniAppidTextField().getText();
                     record[10] = MainWindow.mainWindow.getMsgTemplateMiniPagePathTextField().getText();
-                    record[13] = MainWindow.mainWindow.getMsgTemplateKeyWordTextField().getText();
+                    record[11] = MainWindow.mainWindow.getMsgTemplateKeyWordTextField().getText();
 
                     msgMap.put(msgName, record);
 

File: src/main/java/com/fangxuele/tool/wechat/push/ui/listener/MsgListener.java
Patch:
@@ -168,6 +168,8 @@ public void run() {
             MainWindow.mainWindow.getMsgKefuPicUrlTextField().setText("");
             MainWindow.mainWindow.getMsgKefuDescTextField().setText("");
             MainWindow.mainWindow.getMsgKefuUrlTextField().setText("");
+            MainWindow.mainWindow.setMsgTemplateMiniAppidTextField("");
+            MainWindow.mainWindow.setMsgTemplateMiniPagePathTextField("");
 
             if (MainWindow.mainWindow.getTemplateMsgDataTable().getModel().getRowCount() == 0) {
                 Init.initTemplateDataTable();

File: src/main/java/com/fangxuele/tool/wechat/push/ui/listener/TabListener.java
Patch:
@@ -27,6 +27,8 @@ public void mouseClicked(MouseEvent e) {
                     case 6:
                         Init.initPushHisTab();
                         break;
+                    case 4:
+                        MainWindow.mainWindow.setPushMsgName(MainWindow.mainWindow.getMsgNameField().getText());
                     default:
                         break;
                 }

File: src/main/java/com/fangxuele/tool/wechat/push/util/Config.java
Patch:
@@ -170,7 +170,7 @@ private void originInit() {
         props.setProperty("schedule.radioPerWeek", "false");
         props.setProperty("schedule.textPerWeek.week", "一");
         props.setProperty("schedule.textPerWeek.time", "");
-        props.setProperty("setting.normal.autoCheckUpdate", "");
+        props.setProperty("setting.normal.autoCheckUpdate", "true");
         props.setProperty("setting.wechat.appId", "");
         props.setProperty("setting.wechat.AppSecret", "");
         props.setProperty("setting.wechat.token", "");

File: src/main/java/com/fangxuele/tool/wechat/push/ui/listener/PushListener.java
Patch:
@@ -209,13 +209,13 @@ public void run() {
 
                                 long currentTimeMillis = System.currentTimeMillis();
                                 long lastTimeMillis = currentTimeMillis - startTimeMillis;
-                                long leftTimeMillis = (long) ((double) lastTimeMillis / (PushData.sendSuccessList.size() + PushData.sendFailList.size()) * (PushData.allUser.size() - PushData.sendSuccessList.size()));
+                                long leftTimeMillis = (long) ((double) lastTimeMillis / (PushData.sendSuccessList.size() + PushData.sendFailList.size()) * (PushData.allUser.size() - PushData.sendSuccessList.size() - PushData.sendFailList.size()));
 
                                 String formatBetweenLast = DateUtil.formatBetween(lastTimeMillis, BetweenFormater.Level.SECOND);
-                                MainWindow.mainWindow.getPushLastTimeLabel().setText(formatBetweenLast);
+                                MainWindow.mainWindow.getPushLastTimeLabel().setText("".equals(formatBetweenLast) ? "0s" : formatBetweenLast);
 
                                 String formatBetweenLeft = DateUtil.formatBetween(leftTimeMillis, BetweenFormater.Level.SECOND);
-                                MainWindow.mainWindow.getPushLeftTimeLabel().setText(formatBetweenLeft);
+                                MainWindow.mainWindow.getPushLeftTimeLabel().setText("".equals(formatBetweenLeft) ? "0s" : formatBetweenLeft);
 
                                 try {
                                     Thread.sleep(100);

File: src/main/java/com/fangxuele/tool/wechat/push/ui/listener/PushListener.java
Patch:
@@ -209,13 +209,13 @@ public void run() {
 
                                 long currentTimeMillis = System.currentTimeMillis();
                                 long lastTimeMillis = currentTimeMillis - startTimeMillis;
-                                long leftTimeMillis = (long) ((double) lastTimeMillis / (PushData.sendSuccessList.size() + PushData.sendFailList.size()) * (PushData.allUser.size() - PushData.sendSuccessList.size()));
+                                long leftTimeMillis = (long) ((double) lastTimeMillis / (PushData.sendSuccessList.size() + PushData.sendFailList.size()) * (PushData.allUser.size() - PushData.sendSuccessList.size() - PushData.sendFailList.size()));
 
                                 String formatBetweenLast = DateUtil.formatBetween(lastTimeMillis, BetweenFormater.Level.SECOND);
-                                MainWindow.mainWindow.getPushLastTimeLabel().setText(formatBetweenLast);
+                                MainWindow.mainWindow.getPushLastTimeLabel().setText("".equals(formatBetweenLast) ? "0s" : formatBetweenLast);
 
                                 String formatBetweenLeft = DateUtil.formatBetween(leftTimeMillis, BetweenFormater.Level.SECOND);
-                                MainWindow.mainWindow.getPushLeftTimeLabel().setText(formatBetweenLeft);
+                                MainWindow.mainWindow.getPushLeftTimeLabel().setText("".equals(formatBetweenLeft) ? "0s" : formatBetweenLeft);
 
                                 try {
                                     Thread.sleep(100);

