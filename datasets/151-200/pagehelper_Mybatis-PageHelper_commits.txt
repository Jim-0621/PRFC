File: src/main/java/com/github/pagehelper/util/PageObjectUtil.java
Patch:
@@ -47,7 +47,7 @@ public abstract class PageObjectUtil {
 
     static {
         try {
-            requestClass = Class.forName("javax.servlet.ServletRequest");
+            requestClass = ClassUtil.getServletRequestClass();
             getParameterMap = requestClass.getMethod("getParameterMap", new Class[]{});
             hasRequest = true;
         } catch (Throwable e) {

File: src/main/java/com/github/pagehelper/util/PageObjectUtil.java
Patch:
@@ -47,7 +47,7 @@ public abstract class PageObjectUtil {
 
     static {
         try {
-            requestClass = Class.forName("javax.servlet.ServletRequest");
+            requestClass = ClassUtil.getServletRequestClass();
             getParameterMap = requestClass.getMethod("getParameterMap", new Class[]{});
             hasRequest = true;
         } catch (Throwable e) {

File: src/main/java/com/github/pagehelper/PageInfo.java
Patch:
@@ -42,7 +42,7 @@
 @SuppressWarnings({"rawtypes", "unchecked"})
 public class PageInfo<T> extends PageSerializable<T> {
     public static final int DEFAULT_NAVIGATE_PAGES = 8;
-    public static final PageInfo EMPTY = new PageInfo(Collections.emptyList(), 0);
+    //private PageInfo EMPTY = new PageInfo(Collections.emptyList(), 0);
     /**
      * 当前页
      */
@@ -177,7 +177,7 @@ public static <T> PageInfo<T> of(List<? extends T> list, int navigatePages) {
      * @return
      */
     public static <T> PageInfo<T> emptyPageInfo() {
-        return EMPTY;
+        return new PageInfo(Collections.emptyList(), 0);
     }
 
     public void calcByNavigatePages(int navigatePages) {

File: src/main/java/com/github/pagehelper/PageInfo.java
Patch:
@@ -41,7 +41,7 @@
 @SuppressWarnings({"rawtypes", "unchecked"})
 public class PageInfo<T> extends PageSerializable<T> {
     public static final int DEFAULT_NAVIGATE_PAGES = 8;
-    public static final PageInfo EMPTY = new PageInfo(Collections.emptyList(), 0);
+    //private PageInfo EMPTY = new PageInfo(Collections.emptyList(), 0);
     /**
      * 当前页
      */
@@ -176,7 +176,7 @@ public static <T> PageInfo<T> of(List<? extends T> list, int navigatePages) {
      * @return
      */
     public static <T> PageInfo<T> emptyPageInfo() {
-        return EMPTY;
+        return new PageInfo(Collections.emptyList(), 0);
     }
 
     public void calcByNavigatePages(int navigatePages) {

File: src/main/java/com/github/pagehelper/page/PageMethod.java
Patch:
@@ -185,6 +185,9 @@ public static void orderBy(String orderBy) {
         Page<?> page = getLocalPage();
         if (page != null) {
             page.setOrderBy(orderBy);
+            if (page.getPageSizeZero() != null && page.getPageSizeZero() && page.getPageSize() == 0) {
+                page.setOrderByOnly(true);
+            }
         } else {
             page = new Page();
             page.setOrderBy(orderBy);

File: src/main/java/com/github/pagehelper/parser/SqlServerParser.java
Patch:
@@ -223,9 +223,9 @@ protected SelectBody wrapSetOperationList(SetOperationList setOperationList) {
         fromItem.setAlias(new Alias(WRAP_TABLE));
         selectBody.setFromItem(fromItem);
         //order by
-        if (isNotEmptyList(plainSelect.getOrderByElements())) {
-            selectBody.setOrderByElements(plainSelect.getOrderByElements());
-            plainSelect.setOrderByElements(null);
+        if (isNotEmptyList(setOperationList.getOrderByElements())) {
+            selectBody.setOrderByElements(setOperationList.getOrderByElements());
+            setOperationList.setOrderByElements(null);
         }
         return selectBody;
     }

File: src/main/java/com/github/pagehelper/dialect/helper/CirroDataDialect.java
Patch:
@@ -14,11 +14,11 @@
 public class CirroDataDialect extends AbstractHelperDialect {
     @Override
     public Object processPageParameter(MappedStatement ms, Map<String, Object> paramMap, Page page, BoundSql boundSql, CacheKey pageKey) {
-        paramMap.put(PAGEPARAMETER_FIRST, page.getEndRow());
-        paramMap.put(PAGEPARAMETER_SECOND, page.getStartRow());
+        paramMap.put(PAGEPARAMETER_FIRST, page.getStartRow() + 1);
+        paramMap.put(PAGEPARAMETER_SECOND, page.getEndRow());
         //处理pageKey
+        pageKey.update(page.getStartRow() + 1);
         pageKey.update(page.getEndRow());
-        pageKey.update(page.getStartRow());
         //处理参数配置
         handleParameter(boundSql, ms, long.class, long.class);
         return paramMap;

File: src/main/java/com/github/pagehelper/dialect/helper/CirroDataDialect.java
Patch:
@@ -14,11 +14,11 @@
 public class CirroDataDialect extends AbstractHelperDialect {
     @Override
     public Object processPageParameter(MappedStatement ms, Map<String, Object> paramMap, Page page, BoundSql boundSql, CacheKey pageKey) {
-        paramMap.put(PAGEPARAMETER_FIRST, page.getEndRow());
-        paramMap.put(PAGEPARAMETER_SECOND, page.getStartRow());
+        paramMap.put(PAGEPARAMETER_FIRST, page.getStartRow() + 1);
+        paramMap.put(PAGEPARAMETER_SECOND, page.getEndRow());
         //处理pageKey
+        pageKey.update(page.getStartRow() + 1);
         pageKey.update(page.getEndRow());
-        pageKey.update(page.getStartRow());
         //处理参数配置
         handleParameter(boundSql, ms, long.class, long.class);
         return paramMap;

File: src/main/java/com/github/pagehelper/dialect/auto/DataSourceNegotiationAutoDialect.java
Patch:
@@ -94,7 +94,7 @@ public String extractDialectKey(MappedStatement ms, DataSource dataSource, Prope
 
     @Override
     public AbstractHelperDialect extractDialect(String dialectKey, MappedStatement ms, DataSource dataSource, Properties properties) {
-        if (urlMap.containsKey(dialectKey)) {
+        if (dialectKey != null && urlMap.containsKey(dialectKey)) {
             return urlMap.get(dialectKey).extractDialect(dialectKey, ms, dataSource, properties);
         }
         //都不匹配的时候使用默认方式

File: src/main/java/com/github/pagehelper/parser/SqlServerParser.java
Patch:
@@ -101,7 +101,7 @@ public String convertToPageSql(String sql, Integer offset, Integer limit) {
         //解析SQL
         Statement stmt;
         try {
-            stmt = CCJSqlParserUtil.parse(sql);
+            stmt = CCJSqlParserUtil.parse(sql, parser -> parser.withSquareBracketQuotation(true));
         } catch (Throwable e) {
             throw new PageException("不支持该SQL转换为分页查询!", e);
         }

File: src/main/java/com/github/pagehelper/PageHelper.java
Patch:
@@ -66,7 +66,7 @@ public boolean skip(MappedStatement ms, Object parameterObject, RowBounds rowBou
             if (StringUtil.isEmpty(page.getCountColumn())) {
                 page.setCountColumn(pageParams.getCountColumn());
             }
-            autoDialect.initDelegateDialect(ms);
+            autoDialect.initDelegateDialect(ms, page.getDialectClass());
             return false;
         }
     }

File: src/main/java/com/github/pagehelper/Page.java
Patch:
@@ -127,6 +127,7 @@ public Page(int[] rowBounds, boolean count) {
         if (rowBounds[0] == 0 && rowBounds[1] == Integer.MAX_VALUE) {
             pageSizeZero = true;
             this.pageSize = 0;
+            this.pageNum = 1;
         } else {
             this.pageSize = rowBounds[1];
             this.pageNum = rowBounds[1] != 0 ? (int) (Math.ceil(((double) rowBounds[0] + rowBounds[1]) / rowBounds[1])) : 0;

File: src/main/java/com/github/pagehelper/PageHelper.java
Patch:
@@ -144,8 +144,6 @@ public BoundSql doBoundSql(BoundSqlInterceptor.Type type, BoundSql boundSql, Cac
             if (localPage != null) {
                 localPage.setChain(chain);
             }
-        } else if (chain instanceof BoundSqlInterceptorChain) {
-            ((BoundSqlInterceptorChain) chain).reset();
         }
         return chain.doBoundSql(type, boundSql, cacheKey);
     }

File: src/main/java/com/github/pagehelper/dialect/helper/Db2Dialect.java
Patch:
@@ -52,9 +52,9 @@ public Object processPageParameter(MappedStatement ms, Map<String, Object> param
     @Override
     public String getPageSql(String sql, Page page, CacheKey pageKey) {
         StringBuilder sqlBuilder = new StringBuilder(sql.length() + 140);
-        sqlBuilder.append("SELECT * FROM (SELECT TMP_PAGE.*,ROWNUMBER() OVER() AS ROW_ID FROM ( \n");
+        sqlBuilder.append("SELECT * FROM (SELECT TMP_PAGE.*,ROWNUMBER() OVER() AS PAGEHELPER_ROW_ID FROM ( \n");
         sqlBuilder.append(sql);
-        sqlBuilder.append("\n ) AS TMP_PAGE) TMP_PAGE WHERE ROW_ID BETWEEN ? AND ?");
+        sqlBuilder.append("\n ) AS TMP_PAGE) TMP_PAGE WHERE PAGEHELPER_ROW_ID BETWEEN ? AND ?");
         return sqlBuilder.toString();
     }
 

File: src/main/java/com/github/pagehelper/dialect/helper/Oracle9iDialect.java
Patch:
@@ -58,10 +58,10 @@ public Object processPageParameter(MappedStatement ms, Map<String, Object> param
     public String getPageSql(String sql, Page page, CacheKey pageKey) {
         StringBuilder sqlBuilder = new StringBuilder(sql.length() + 120);
         sqlBuilder.append("SELECT * FROM ( ");
-        sqlBuilder.append(" SELECT TMP_PAGE.*, ROWNUM ROW_ID FROM ( \n");
+        sqlBuilder.append(" SELECT TMP_PAGE.*, ROWNUM PAGEHELPER_ROW_ID FROM ( \n");
         sqlBuilder.append(sql);
         sqlBuilder.append("\n ) TMP_PAGE WHERE ROWNUM <= ? ");
-        sqlBuilder.append(" ) WHERE ROW_ID > ? ");
+        sqlBuilder.append(" ) WHERE PAGEHELPER_ROW_ID > ? ");
         return sqlBuilder.toString();
     }
 

File: src/main/java/com/github/pagehelper/dialect/helper/OracleDialect.java
Patch:
@@ -53,10 +53,10 @@ public Object processPageParameter(MappedStatement ms, Map<String, Object> param
     public String getPageSql(String sql, Page page, CacheKey pageKey) {
         StringBuilder sqlBuilder = new StringBuilder(sql.length() + 120);
         sqlBuilder.append("SELECT * FROM ( ");
-        sqlBuilder.append(" SELECT TMP_PAGE.*, ROWNUM ROW_ID FROM ( \n");
+        sqlBuilder.append(" SELECT TMP_PAGE.*, ROWNUM PAGEHELPER_ROW_ID FROM ( \n");
         sqlBuilder.append(sql);
         sqlBuilder.append("\n ) TMP_PAGE)");
-        sqlBuilder.append(" WHERE ROW_ID <= ? AND ROW_ID > ?");
+        sqlBuilder.append(" WHERE PAGEHELPER_ROW_ID <= ? AND PAGEHELPER_ROW_ID > ?");
         return sqlBuilder.toString();
     }
 

File: src/main/java/com/github/pagehelper/dialect/rowbounds/Db2RowBoundsDialect.java
Patch:
@@ -40,9 +40,9 @@ public String getPageSql(String sql, RowBounds rowBounds, CacheKey pageKey) {
         int startRow = rowBounds.getOffset() + 1;
         int endRow = rowBounds.getOffset() + rowBounds.getLimit();
         StringBuilder sqlBuilder = new StringBuilder(sql.length() + 120);
-        sqlBuilder.append("SELECT * FROM (SELECT TMP_PAGE.*,ROWNUMBER() OVER() AS ROW_ID FROM ( \n");
+        sqlBuilder.append("SELECT * FROM (SELECT TMP_PAGE.*,ROWNUMBER() OVER() AS PAGEHELPER_ROW_ID FROM ( \n");
         sqlBuilder.append(sql);
-        sqlBuilder.append("\n ) AS TMP_PAGE) TMP_PAGE WHERE ROW_ID BETWEEN ");
+        sqlBuilder.append("\n ) AS TMP_PAGE) TMP_PAGE WHERE PAGEHELPER_ROW_ID BETWEEN ");
         sqlBuilder.append(startRow);
         sqlBuilder.append(" AND ");
         sqlBuilder.append(endRow);

File: src/main/java/com/github/pagehelper/dialect/rowbounds/OracleRowBoundsDialect.java
Patch:
@@ -44,7 +44,7 @@ public String getPageSql(String sql, RowBounds rowBounds, CacheKey pageKey) {
             sqlBuilder.append("SELECT * FROM ( ");
         }
         if (endRow > 0) {
-            sqlBuilder.append(" SELECT TMP_PAGE.*, ROWNUM ROW_ID FROM ( ");
+            sqlBuilder.append(" SELECT TMP_PAGE.*, ROWNUM PAGEHELPER_ROW_ID FROM ( ");
         }
         sqlBuilder.append("\n");
         sqlBuilder.append(sql);
@@ -55,7 +55,7 @@ public String getPageSql(String sql, RowBounds rowBounds, CacheKey pageKey) {
             pageKey.update(endRow);
         }
         if (startRow > 0) {
-            sqlBuilder.append(" ) WHERE ROW_ID > ");
+            sqlBuilder.append(" ) WHERE PAGEHELPER_ROW_ID > ");
             sqlBuilder.append(startRow);
             pageKey.update(startRow);
         }

File: src/main/java/com/github/pagehelper/dialect/helper/Db2Dialect.java
Patch:
@@ -52,9 +52,9 @@ public Object processPageParameter(MappedStatement ms, Map<String, Object> param
     @Override
     public String getPageSql(String sql, Page page, CacheKey pageKey) {
         StringBuilder sqlBuilder = new StringBuilder(sql.length() + 140);
-        sqlBuilder.append("SELECT * FROM (SELECT TMP_PAGE.*,ROWNUMBER() OVER() AS ROW_ID FROM ( ");
+        sqlBuilder.append("SELECT * FROM (SELECT TMP_PAGE.*,ROWNUMBER() OVER() AS ROW_ID FROM ( \n");
         sqlBuilder.append(sql);
-        sqlBuilder.append(" ) AS TMP_PAGE) TMP_PAGE WHERE ROW_ID BETWEEN ? AND ?");
+        sqlBuilder.append("\n ) AS TMP_PAGE) TMP_PAGE WHERE ROW_ID BETWEEN ? AND ?");
         return sqlBuilder.toString();
     }
 

File: src/main/java/com/github/pagehelper/dialect/helper/HerdDBDialect.java
Patch:
@@ -68,9 +68,9 @@ public String getPageSql(String sql, Page page, CacheKey pageKey) {
         StringBuilder sqlBuilder = new StringBuilder(sql.length() + 14);
         sqlBuilder.append(sql);
         if (page.getStartRow() == 0) {
-            sqlBuilder.append(" LIMIT ? ");
+            sqlBuilder.append("\n LIMIT ? ");
         } else {
-            sqlBuilder.append(" LIMIT ?, ? ");
+            sqlBuilder.append("\n LIMIT ?, ? ");
         }
         return sqlBuilder.toString();
     }

File: src/main/java/com/github/pagehelper/dialect/helper/HsqldbDialect.java
Patch:
@@ -69,10 +69,10 @@ public String getPageSql(String sql, Page page, CacheKey pageKey) {
         StringBuilder sqlBuilder = new StringBuilder(sql.length() + 20);
         sqlBuilder.append(sql);
         if (page.getPageSize() > 0) {
-            sqlBuilder.append(" LIMIT ? ");
+            sqlBuilder.append("\n LIMIT ? ");
         }
         if (page.getStartRow() > 0) {
-            sqlBuilder.append(" OFFSET ? ");
+            sqlBuilder.append("\n OFFSET ? ");
         }
         return sqlBuilder.toString();
     }

File: src/main/java/com/github/pagehelper/dialect/helper/InformixDialect.java
Patch:
@@ -75,9 +75,9 @@ public String getPageSql(String sql, Page page, CacheKey pageKey) {
         if (page.getPageSize() > 0) {
             sqlBuilder.append(" FIRST ? ");
         }
-        sqlBuilder.append(" * FROM ( ");
+        sqlBuilder.append(" * FROM ( \n");
         sqlBuilder.append(sql);
-        sqlBuilder.append(" ) TEMP_T ");
+        sqlBuilder.append("\n ) TEMP_T ");
         return sqlBuilder.toString();
     }
 

File: src/main/java/com/github/pagehelper/dialect/helper/MySqlDialect.java
Patch:
@@ -69,9 +69,9 @@ public String getPageSql(String sql, Page page, CacheKey pageKey) {
         StringBuilder sqlBuilder = new StringBuilder(sql.length() + 14);
         sqlBuilder.append(sql);
         if (page.getStartRow() == 0) {
-            sqlBuilder.append(" LIMIT ? ");
+            sqlBuilder.append("\n LIMIT ? ");
         } else {
-            sqlBuilder.append(" LIMIT ?, ? ");
+            sqlBuilder.append("\n LIMIT ?, ? ");
         }
         return sqlBuilder.toString();
     }

File: src/main/java/com/github/pagehelper/dialect/helper/Oracle9iDialect.java
Patch:
@@ -58,9 +58,9 @@ public Object processPageParameter(MappedStatement ms, Map<String, Object> param
     public String getPageSql(String sql, Page page, CacheKey pageKey) {
         StringBuilder sqlBuilder = new StringBuilder(sql.length() + 120);
         sqlBuilder.append("SELECT * FROM ( ");
-        sqlBuilder.append(" SELECT TMP_PAGE.*, ROWNUM ROW_ID FROM ( ");
+        sqlBuilder.append(" SELECT TMP_PAGE.*, ROWNUM ROW_ID FROM ( \n");
         sqlBuilder.append(sql);
-        sqlBuilder.append(" ) TMP_PAGE WHERE ROWNUM <= ? ");
+        sqlBuilder.append("\n ) TMP_PAGE WHERE ROWNUM <= ? ");
         sqlBuilder.append(" ) WHERE ROW_ID > ? ");
         return sqlBuilder.toString();
     }

File: src/main/java/com/github/pagehelper/dialect/helper/OracleDialect.java
Patch:
@@ -53,9 +53,9 @@ public Object processPageParameter(MappedStatement ms, Map<String, Object> param
     public String getPageSql(String sql, Page page, CacheKey pageKey) {
         StringBuilder sqlBuilder = new StringBuilder(sql.length() + 120);
         sqlBuilder.append("SELECT * FROM ( ");
-        sqlBuilder.append(" SELECT TMP_PAGE.*, ROWNUM ROW_ID FROM ( ");
+        sqlBuilder.append(" SELECT TMP_PAGE.*, ROWNUM ROW_ID FROM ( \n");
         sqlBuilder.append(sql);
-        sqlBuilder.append(" ) TMP_PAGE)");
+        sqlBuilder.append("\n ) TMP_PAGE)");
         sqlBuilder.append(" WHERE ROW_ID <= ? AND ROW_ID > ?");
         return sqlBuilder.toString();
     }

File: src/main/java/com/github/pagehelper/dialect/helper/SqlServer2012Dialect.java
Patch:
@@ -52,7 +52,7 @@ public Object processPageParameter(MappedStatement ms, Map<String, Object> param
     public String getPageSql(String sql, Page page, CacheKey pageKey) {
         StringBuilder sqlBuilder = new StringBuilder(sql.length() + 64);
         sqlBuilder.append(sql);
-        sqlBuilder.append(" OFFSET ? ROWS FETCH NEXT ? ROWS ONLY ");
+        sqlBuilder.append("\n OFFSET ? ROWS FETCH NEXT ? ROWS ONLY ");
         pageKey.update(page.getPageSize());
         return sqlBuilder.toString();
     }

File: src/main/java/com/github/pagehelper/dialect/rowbounds/Db2RowBoundsDialect.java
Patch:
@@ -40,9 +40,9 @@ public String getPageSql(String sql, RowBounds rowBounds, CacheKey pageKey) {
         int startRow = rowBounds.getOffset() + 1;
         int endRow = rowBounds.getOffset() + rowBounds.getLimit();
         StringBuilder sqlBuilder = new StringBuilder(sql.length() + 120);
-        sqlBuilder.append("SELECT * FROM (SELECT TMP_PAGE.*,ROWNUMBER() OVER() AS ROW_ID FROM ( ");
+        sqlBuilder.append("SELECT * FROM (SELECT TMP_PAGE.*,ROWNUMBER() OVER() AS ROW_ID FROM ( \n");
         sqlBuilder.append(sql);
-        sqlBuilder.append(" ) AS TMP_PAGE) TMP_PAGE WHERE ROW_ID BETWEEN ");
+        sqlBuilder.append("\n ) AS TMP_PAGE) TMP_PAGE WHERE ROW_ID BETWEEN ");
         sqlBuilder.append(startRow);
         sqlBuilder.append(" AND ");
         sqlBuilder.append(endRow);

File: src/main/java/com/github/pagehelper/dialect/rowbounds/HerdDBRowBoundsDialect.java
Patch:
@@ -40,10 +40,10 @@ public String getPageSql(String sql, RowBounds rowBounds, CacheKey pageKey) {
         StringBuilder sqlBuilder = new StringBuilder(sql.length() + 14);
         sqlBuilder.append(sql);
         if (rowBounds.getOffset() == 0) {
-            sqlBuilder.append(" LIMIT ");
+            sqlBuilder.append("\n LIMIT ");
             sqlBuilder.append(rowBounds.getLimit());
         } else {
-            sqlBuilder.append(" LIMIT ");
+            sqlBuilder.append("\n LIMIT ");
             sqlBuilder.append(rowBounds.getOffset());
             sqlBuilder.append(",");
             sqlBuilder.append(rowBounds.getLimit());

File: src/main/java/com/github/pagehelper/dialect/rowbounds/HsqldbRowBoundsDialect.java
Patch:
@@ -40,12 +40,12 @@ public String getPageSql(String sql, RowBounds rowBounds, CacheKey pageKey) {
         StringBuilder sqlBuilder = new StringBuilder(sql.length() + 20);
         sqlBuilder.append(sql);
         if (rowBounds.getLimit() > 0) {
-            sqlBuilder.append(" LIMIT ");
+            sqlBuilder.append("\n LIMIT ");
             sqlBuilder.append(rowBounds.getLimit());
             pageKey.update(rowBounds.getLimit());
         }
         if (rowBounds.getOffset() > 0) {
-            sqlBuilder.append(" OFFSET ");
+            sqlBuilder.append("\n OFFSET ");
             sqlBuilder.append(rowBounds.getOffset());
             pageKey.update(rowBounds.getOffset());
         }

File: src/main/java/com/github/pagehelper/dialect/rowbounds/InformixRowBoundsDialect.java
Patch:
@@ -49,9 +49,9 @@ public String getPageSql(String sql, RowBounds rowBounds, CacheKey pageKey) {
             sqlBuilder.append(rowBounds.getLimit());
             pageKey.update(rowBounds.getLimit());
         }
-        sqlBuilder.append(" * FROM ( ");
+        sqlBuilder.append(" * FROM ( \n");
         sqlBuilder.append(sql);
-        sqlBuilder.append(" ) TEMP_T");
+        sqlBuilder.append("\n ) TEMP_T");
         return sqlBuilder.toString();
     }
 

File: src/main/java/com/github/pagehelper/dialect/rowbounds/MySqlRowBoundsDialect.java
Patch:
@@ -40,10 +40,10 @@ public String getPageSql(String sql, RowBounds rowBounds, CacheKey pageKey) {
         StringBuilder sqlBuilder = new StringBuilder(sql.length() + 14);
         sqlBuilder.append(sql);
         if (rowBounds.getOffset() == 0) {
-            sqlBuilder.append(" LIMIT ");
+            sqlBuilder.append("\n LIMIT ");
             sqlBuilder.append(rowBounds.getLimit());
         } else {
-            sqlBuilder.append(" LIMIT ");
+            sqlBuilder.append("\n LIMIT ");
             sqlBuilder.append(rowBounds.getOffset());
             sqlBuilder.append(",");
             sqlBuilder.append(rowBounds.getLimit());

File: src/main/java/com/github/pagehelper/dialect/rowbounds/OracleRowBoundsDialect.java
Patch:
@@ -46,7 +46,9 @@ public String getPageSql(String sql, RowBounds rowBounds, CacheKey pageKey) {
         if (endRow > 0) {
             sqlBuilder.append(" SELECT TMP_PAGE.*, ROWNUM ROW_ID FROM ( ");
         }
+        sqlBuilder.append("\n");
         sqlBuilder.append(sql);
+        sqlBuilder.append("\n");
         if (endRow > 0) {
             sqlBuilder.append(" ) TMP_PAGE WHERE ROWNUM <= ");
             sqlBuilder.append(endRow);

File: src/main/java/com/github/pagehelper/dialect/rowbounds/SqlServer2012RowBoundsDialect.java
Patch:
@@ -38,7 +38,7 @@ public class SqlServer2012RowBoundsDialect extends SqlServerRowBoundsDialect {
     public String getPageSql(String sql, RowBounds rowBounds, CacheKey pageKey) {
         StringBuilder sqlBuilder = new StringBuilder(sql.length() + 14);
         sqlBuilder.append(sql);
-        sqlBuilder.append(" OFFSET ");
+        sqlBuilder.append("\n OFFSET ");
         sqlBuilder.append(rowBounds.getOffset());
         sqlBuilder.append(" ROWS ");
         pageKey.update(rowBounds.getOffset());

File: src/main/java/com/github/pagehelper/parser/CountSqlParser.java
Patch:
@@ -219,9 +219,9 @@ public String getSimpleCountSql(final String sql, String name) {
         StringBuilder stringBuilder = new StringBuilder(sql.length() + 40);
         stringBuilder.append("select count(");
         stringBuilder.append(name);
-        stringBuilder.append(") from (");
+        stringBuilder.append(") from ( \n");
         stringBuilder.append(sql);
-        stringBuilder.append(") tmp_count");
+        stringBuilder.append("\n ) tmp_count");
         return stringBuilder.toString();
     }
 

File: src/main/java/com/github/pagehelper/dialect/AbstractHelperDialect.java
Patch:
@@ -99,7 +99,8 @@ else if (page.getPageSizeZero() && page.getPageSize() < 0) {
                 return false;
             }
         }
-        return page.getPageNum() > 0 && (count > ((page.getPageNum() - 1) * page.getPageSize()));
+        //页码>0 && 开始行数<总行数即可，不需要考虑 pageSize（上面的 if 已经处理不符合要求的值了）
+        return page.getPageNum() > 0 && count > page.getStartRow();
     }
 
     @Override

File: src/main/java/com/github/pagehelper/Page.java
Patch:
@@ -227,7 +227,7 @@ public Boolean getPageSizeZero() {
     }
 
     public Page<E> setPageSizeZero(Boolean pageSizeZero) {
-        if (pageSizeZero != null) {
+        if (this.pageSizeZero == null && pageSizeZero != null) {
             this.pageSizeZero = pageSizeZero;
         }
         return this;

File: src/test/java/com/github/pagehelper/test/pagesize/PageSizeLessThenOrEqualZeroTest.java
Patch:
@@ -51,7 +51,7 @@ public void testWithStartPage() {
             PageHelper.startPage(1, 0);
             List<User> list = userMapper.selectAll();
             PageInfo<User> page = new PageInfo<User>(list);
-            assertEquals(183, list.size());
+            assertEquals(0, list.size());
             assertEquals(183, page.getTotal());
 
             //limit<0的时候同上

File: src/main/java/com/github/pagehelper/PageInterceptor.java
Patch:
@@ -94,7 +94,7 @@ public Object intercept(Invocation invocation) throws Throwable {
                 //判断是否需要进行 count 查询
                 if (dialect.beforeCount(ms, parameter, rowBounds)) {
                     //查询总数
-                    Long count = count(executor, ms, parameter, rowBounds, resultHandler, boundSql);
+                    Long count = count(executor, ms, parameter, rowBounds, null, boundSql);
                     //处理查询总数，返回 true 时继续分页查询，false 时直接返回
                     if (!dialect.afterCount(count, parameter, rowBounds)) {
                         //当查询总数为 0 时，直接返回空的结果
@@ -138,7 +138,7 @@ private Long count(Executor executor, MappedStatement ms, Object parameter,
         //先判断是否存在手写的 count 查询
         MappedStatement countMs = ExecutorUtil.getExistedMappedStatement(ms.getConfiguration(), countMsId);
         if (countMs != null) {
-            count = ExecutorUtil.executeManualCount(executor, countMs, parameter, boundSql, null);
+            count = ExecutorUtil.executeManualCount(executor, countMs, parameter, boundSql, resultHandler);
         } else {
             countMs = msCountMap.get(countMsId);
             //自动创建

File: src/main/java/com/github/pagehelper/dialect/AbstractHelperDialect.java
Patch:
@@ -92,7 +92,7 @@ public boolean afterCount(long count, Object parameterObject, RowBounds rowBound
         if (page.getPageSize() < 0) {
             return false;
         }
-        return count > ((page.getPageNum() - 1) * page.getPageSize());
+        return page.getPageNum() > 0 && (count > ((page.getPageNum() - 1) * page.getPageSize()));
     }
 
     @Override

File: src/main/java/com/github/pagehelper/PageInterceptor.java
Patch:
@@ -138,7 +138,7 @@ private Long count(Executor executor, MappedStatement ms, Object parameter,
         //先判断是否存在手写的 count 查询
         MappedStatement countMs = ExecutorUtil.getExistedMappedStatement(ms.getConfiguration(), countMsId);
         if (countMs != null) {
-            count = ExecutorUtil.executeManualCount(executor, countMs, parameter, boundSql, resultHandler);
+            count = ExecutorUtil.executeManualCount(executor, countMs, parameter, boundSql, null);
         } else {
             countMs = msCountMap.get(countMsId);
             //自动创建

File: src/main/java/com/github/pagehelper/dialect/helper/Db2Dialect.java
Patch:
@@ -45,7 +45,7 @@ public Object processPageParameter(MappedStatement ms, Map<String, Object> param
         pageKey.update(page.getStartRow() + 1);
         pageKey.update(page.getEndRow());
         //处理参数配置
-        handleParameter(boundSql, ms);
+        handleParameter(boundSql, ms, long.class, long.class);
         return paramMap;
     }
 

File: src/main/java/com/github/pagehelper/dialect/helper/HerdDBDialect.java
Patch:
@@ -52,10 +52,10 @@ public Object processPageParameter(MappedStatement ms, Map<String, Object> param
         if (boundSql.getParameterMappings() != null) {
             List<ParameterMapping> newParameterMappings = new ArrayList<ParameterMapping>(boundSql.getParameterMappings());
             if (page.getStartRow() == 0) {
-                newParameterMappings.add(new ParameterMapping.Builder(ms.getConfiguration(), PAGEPARAMETER_SECOND, Integer.class).build());
+                newParameterMappings.add(new ParameterMapping.Builder(ms.getConfiguration(), PAGEPARAMETER_SECOND, long.class).build());
             } else {
-                newParameterMappings.add(new ParameterMapping.Builder(ms.getConfiguration(), PAGEPARAMETER_FIRST, Integer.class).build());
-                newParameterMappings.add(new ParameterMapping.Builder(ms.getConfiguration(), PAGEPARAMETER_SECOND, Integer.class).build());
+                newParameterMappings.add(new ParameterMapping.Builder(ms.getConfiguration(), PAGEPARAMETER_FIRST, long.class).build());
+                newParameterMappings.add(new ParameterMapping.Builder(ms.getConfiguration(), PAGEPARAMETER_SECOND, int.class).build());
             }
             MetaObject metaObject = MetaObjectUtil.forObject(boundSql);
             metaObject.setValue("parameterMappings", newParameterMappings);

File: src/main/java/com/github/pagehelper/dialect/helper/HsqldbDialect.java
Patch:
@@ -53,10 +53,10 @@ public Object processPageParameter(MappedStatement ms, Map<String, Object> param
         if (boundSql.getParameterMappings() != null) {
             List<ParameterMapping> newParameterMappings = new ArrayList<ParameterMapping>(boundSql.getParameterMappings());
             if (page.getPageSize() > 0) {
-                newParameterMappings.add(new ParameterMapping.Builder(ms.getConfiguration(), PAGEPARAMETER_FIRST, Integer.class).build());
+                newParameterMappings.add(new ParameterMapping.Builder(ms.getConfiguration(), PAGEPARAMETER_FIRST, int.class).build());
             }
             if (page.getStartRow() > 0) {
-                newParameterMappings.add(new ParameterMapping.Builder(ms.getConfiguration(), PAGEPARAMETER_SECOND, Integer.class).build());
+                newParameterMappings.add(new ParameterMapping.Builder(ms.getConfiguration(), PAGEPARAMETER_SECOND, long.class).build());
             }
             MetaObject metaObject = MetaObjectUtil.forObject(boundSql);
             metaObject.setValue("parameterMappings", newParameterMappings);

File: src/main/java/com/github/pagehelper/dialect/helper/InformixDialect.java
Patch:
@@ -53,10 +53,10 @@ public Object processPageParameter(MappedStatement ms, Map<String, Object> param
         if (boundSql.getParameterMappings() != null) {
             List<ParameterMapping> newParameterMappings = new ArrayList<ParameterMapping>();
             if (page.getStartRow() > 0) {
-                newParameterMappings.add(new ParameterMapping.Builder(ms.getConfiguration(), PAGEPARAMETER_FIRST, Integer.class).build());
+                newParameterMappings.add(new ParameterMapping.Builder(ms.getConfiguration(), PAGEPARAMETER_FIRST, long.class).build());
             }
             if (page.getPageSize() > 0) {
-                newParameterMappings.add(new ParameterMapping.Builder(ms.getConfiguration(), PAGEPARAMETER_SECOND, Integer.class).build());
+                newParameterMappings.add(new ParameterMapping.Builder(ms.getConfiguration(), PAGEPARAMETER_SECOND, int.class).build());
             }
             newParameterMappings.addAll(boundSql.getParameterMappings());
             MetaObject metaObject = MetaObjectUtil.forObject(boundSql);

File: src/main/java/com/github/pagehelper/dialect/helper/MySqlDialect.java
Patch:
@@ -53,10 +53,10 @@ public Object processPageParameter(MappedStatement ms, Map<String, Object> param
         if (boundSql.getParameterMappings() != null) {
             List<ParameterMapping> newParameterMappings = new ArrayList<ParameterMapping>(boundSql.getParameterMappings());
             if (page.getStartRow() == 0) {
-                newParameterMappings.add(new ParameterMapping.Builder(ms.getConfiguration(), PAGEPARAMETER_SECOND, Integer.class).build());
+                newParameterMappings.add(new ParameterMapping.Builder(ms.getConfiguration(), PAGEPARAMETER_SECOND, long.class).build());
             } else {
-                newParameterMappings.add(new ParameterMapping.Builder(ms.getConfiguration(), PAGEPARAMETER_FIRST, Integer.class).build());
-                newParameterMappings.add(new ParameterMapping.Builder(ms.getConfiguration(), PAGEPARAMETER_SECOND, Integer.class).build());
+                newParameterMappings.add(new ParameterMapping.Builder(ms.getConfiguration(), PAGEPARAMETER_FIRST, long.class).build());
+                newParameterMappings.add(new ParameterMapping.Builder(ms.getConfiguration(), PAGEPARAMETER_SECOND, int.class).build());
             }
             MetaObject metaObject = MetaObjectUtil.forObject(boundSql);
             metaObject.setValue("parameterMappings", newParameterMappings);

File: src/main/java/com/github/pagehelper/dialect/helper/Oracle9iDialect.java
Patch:
@@ -50,7 +50,7 @@ public Object processPageParameter(MappedStatement ms, Map<String, Object> param
         pageKey.update(page.getEndRow());
         pageKey.update(page.getStartRow());
         //处理参数配置
-        handleParameter(boundSql, ms);
+        handleParameter(boundSql, ms, long.class, long.class);
         return paramMap;
     }
 

File: src/main/java/com/github/pagehelper/dialect/helper/OracleDialect.java
Patch:
@@ -45,7 +45,7 @@ public Object processPageParameter(MappedStatement ms, Map<String, Object> param
         pageKey.update(page.getEndRow());
         pageKey.update(page.getStartRow());
         //处理参数配置
-        handleParameter(boundSql, ms);
+        handleParameter(boundSql, ms, long.class, long.class);
         return paramMap;
     }
 

File: src/main/java/com/github/pagehelper/dialect/helper/SqlServer2012Dialect.java
Patch:
@@ -44,7 +44,7 @@ public Object processPageParameter(MappedStatement ms, Map<String, Object> param
         pageKey.update(page.getStartRow());
         pageKey.update(page.getPageSize());
         //处理参数配置
-        handleParameter(boundSql, ms);
+        handleParameter(boundSql, ms, long.class, int.class);
         return paramMap;
     }
 

File: src/main/java/com/github/pagehelper/page/PageAutoDialect.java
Patch:
@@ -121,8 +121,9 @@ public void clearDelegate() {
     }
 
     private String fromJdbcUrl(String jdbcUrl) {
+        final String url = jdbcUrl.toLowerCase();
         for (String dialect : dialectAliasMap.keySet()) {
-            if (jdbcUrl.indexOf(":" + dialect + ":") != -1) {
+            if (url.contains(":" + dialect.toLowerCase() + ":")) {
                 return dialect;
             }
         }

File: src/main/java/com/github/pagehelper/parser/CountSqlParser.java
Patch:
@@ -174,13 +174,13 @@ public String getSmartCountSql(String sql, String name) {
         Statement stmt = null;
         //特殊sql不需要去掉order by时，使用注释前缀
         if(sql.indexOf(KEEP_ORDERBY) >= 0){
-            return getSimpleCountSql(sql);
+            return getSimpleCountSql(sql, name);
         }
         try {
             stmt = CCJSqlParserUtil.parse(sql);
         } catch (Throwable e) {
             //无法解析的用一般方法返回count语句
-            return getSimpleCountSql(sql);
+            return getSimpleCountSql(sql, name);
         }
         Select select = (Select) stmt;
         SelectBody selectBody = select.getSelectBody();
@@ -189,7 +189,7 @@ public String getSmartCountSql(String sql, String name) {
             processSelectBody(selectBody);
         } catch (Exception e) {
             //当 sql 包含 group by 时，不去除 order by
-            return getSimpleCountSql(sql);
+            return getSimpleCountSql(sql, name);
         }
         //处理with-去order by
         processWithItemsList(select.getWithItemsList());

File: src/main/java/com/github/pagehelper/parser/CountSqlParser.java
Patch:
@@ -55,7 +55,7 @@ public class CountSqlParser {
             ("APPROX_COUNT_DISTINCT," +
             "ARRAY_AGG," +
             "AVG," +
-            "BIT_" +
+            "BIT_," +
             //"BIT_AND," +
             //"BIT_OR," +
             //"BIT_XOR," +

File: src/main/java/com/github/pagehelper/PageInterceptor.java
Patch:
@@ -109,7 +109,9 @@ public Object intercept(Invocation invocation) throws Throwable {
             }
             return dialect.afterPage(resultList, parameter, rowBounds);
         } finally {
-            dialect.afterAll();
+            if(dialect != null){
+                dialect.afterAll();
+            }
         }
     }
 

File: src/main/java/com/github/pagehelper/dialect/AbstractHelperDialect.java
Patch:
@@ -92,7 +92,7 @@ public boolean afterCount(long count, Object parameterObject, RowBounds rowBound
         if (page.getPageSize() < 0) {
             return false;
         }
-        return count > 0;
+        return count > ((page.getPageNum() - 1) * page.getPageSize());
     }
 
     @Override

File: src/main/java/com/github/pagehelper/page/PageAutoDialect.java
Patch:
@@ -76,6 +76,8 @@ public static void registerDialectAlias(String alias, Class<? extends Dialect> d
         registerDialectAlias("derby", SqlServer2012Dialect.class);
         //达梦数据库,https://github.com/mybatis-book/book/issues/43
         registerDialectAlias("dm", OracleDialect.class);
+        //阿里云PPAS数据库,https://github.com/pagehelper/Mybatis-PageHelper/issues/281
+        registerDialectAlias("edb", OracleDialect.class);
     }
 
     //自动获取dialect,如果没有setProperties或setSqlUtilConfig，也可以正常进行

File: src/main/java/com/github/pagehelper/page/PageParams.java
Patch:
@@ -24,6 +24,7 @@
 
 package com.github.pagehelper.page;
 
+import com.github.pagehelper.IPage;
 import com.github.pagehelper.Page;
 import com.github.pagehelper.PageHelper;
 import com.github.pagehelper.PageRowBounds;
@@ -74,7 +75,7 @@ public Page getPage(Object parameterObject, RowBounds rowBounds) {
                     PageRowBounds pageRowBounds = (PageRowBounds)rowBounds;
                     page.setCount(pageRowBounds.getCount() == null || pageRowBounds.getCount());
                 }
-            } else if(supportMethodsArguments){
+            } else if(parameterObject instanceof IPage || supportMethodsArguments){
                 try {
                     page = PageObjectUtil.getPageFromObject(parameterObject, false);
                 } catch (Exception e) {

File: src/main/java/com/github/pagehelper/parser/CountSqlParser.java
Patch:
@@ -45,8 +45,8 @@ public class CountSqlParser {
     private static final Alias TABLE_ALIAS;
 
     //<editor-fold desc="聚合函数">
-    private final Set<String> skipFunctions = new HashSet<String>();
-    private final Set<String> falseFunctions = new HashSet<String>();
+    private final Set<String> skipFunctions = Collections.synchronizedSet(new HashSet<String>());
+    private final Set<String> falseFunctions = Collections.synchronizedSet(new HashSet<String>());
 
     /**
      * 聚合函数，以下列函数开头的都认为是聚合函数

File: src/main/java/com/github/pagehelper/dialect/helper/SqlServerDialect.java
Patch:
@@ -102,7 +102,7 @@ public void setProperties(Properties properties) {
                 this.replaceSql = (ReplaceSql) Class.forName(replaceSql).newInstance();
             } catch (Exception e) {
                 throw new RuntimeException("replaceSql 参数配置的值不符合要求，可选值为 simple 和 regex，或者是实现了 "
-                        + ReplaceSql.class.getCanonicalName() + " 接口的全限定类名");
+                        + ReplaceSql.class.getCanonicalName() + " 接口的全限定类名", e);
             }
         }
         String sqlCacheClass = properties.getProperty("sqlCacheClass");

File: src/main/java/com/github/pagehelper/dialect/rowbounds/SqlServerRowBoundsDialect.java
Patch:
@@ -81,7 +81,7 @@ public void setProperties(Properties properties) {
                 this.replaceSql = (ReplaceSql) Class.forName(replaceSql).newInstance();
             } catch (Exception e) {
                 throw new RuntimeException("replaceSql 参数配置的值不符合要求，可选值为 simple 和 regex，或者是实现了 "
-                        + ReplaceSql.class.getCanonicalName() + " 接口的全限定类名");
+                        + ReplaceSql.class.getCanonicalName() + " 接口的全限定类名", e);
             }
         }
     }

File: src/main/java/com/github/pagehelper/parser/SqlServerParser.java
Patch:
@@ -102,7 +102,7 @@ public String convertToPageSql(String sql, Integer offset, Integer limit) {
         try {
             stmt = CCJSqlParserUtil.parse(sql);
         } catch (Throwable e) {
-            throw new PageException("不支持该SQL转换为分页查询!");
+            throw new PageException("不支持该SQL转换为分页查询!", e);
         }
         if (!(stmt instanceof Select)) {
             throw new PageException("分页语句必须是Select查询!");

File: src/main/java/com/github/pagehelper/util/PageObjectUtil.java
Patch:
@@ -105,7 +105,7 @@ public static <T> Page<T> getPageFromObject(Object params, boolean required) {
             pageNum = Integer.parseInt(String.valueOf(_pageNum));
             pageSize = Integer.parseInt(String.valueOf(_pageSize));
         } catch (NumberFormatException e) {
-            throw new PageException("分页参数不是合法的数字类型!");
+            throw new PageException("分页参数不是合法的数字类型!", e);
         }
         Page page = new Page(pageNum, pageSize);
         //count查询

File: src/main/java/com/github/pagehelper/Page.java
Patch:
@@ -198,7 +198,9 @@ public void setTotal(long total) {
         }
         //分页合理化，针对不合理的页码自动处理
         if ((reasonable != null && reasonable) && pageNum > pages) {
-            pageNum = pages;
+            if(pages!=0){
+                pageNum = pages;
+            }
             calculateStartAndEndRow();
         }
     }

File: src/main/java/com/github/pagehelper/parser/OrderByParser.java
Patch:
@@ -24,6 +24,7 @@
 
 package com.github.pagehelper.parser;
 
+import com.github.pagehelper.PageException;
 import net.sf.jsqlparser.parser.CCJSqlParserUtil;
 import net.sf.jsqlparser.statement.Statement;
 import net.sf.jsqlparser.statement.select.*;
@@ -55,12 +56,12 @@ public static String converToOrderBySql(String sql, String orderBy) {
             List<OrderByElement> orderByElements = extraOrderBy(selectBody);
             String defaultOrderBy = PlainSelect.orderByToString(orderByElements);
             if (defaultOrderBy.indexOf('?') != -1) {
-                throw new RuntimeException("原SQL[" + sql + "]中的order by包含参数，因此不能使用OrderBy插件进行修改!");
+                throw new PageException("原SQL[" + sql + "]中的order by包含参数，因此不能使用OrderBy插件进行修改!");
             }
             //新的sql
             sql = select.toString();
         } catch (Throwable e) {
-            e.printStackTrace();
+            throw new PageException("处理排序失败: " + e, e);
         }
         return sql + " order by " + orderBy;
     }

File: src/main/java/com/github/pagehelper/PageHelper.java
Patch:
@@ -124,6 +124,7 @@ public void afterAll() {
 
     @Override
     public void setProperties(Properties properties) {
+        setStaticProperties(properties);
         pageParams = new PageParams();
         autoDialect = new PageAutoDialect();
         pageParams.setProperties(properties);

File: src/test/java/com/github/pagehelper/test/basic/TestLike.java
Patch:
@@ -79,7 +79,7 @@ public void testMapperWithStartPage_OrderBy() {
             Country country = new Country();
             country.setCountryname("c");
             List<Country> list = countryMapper.selectLike(country);
-            assertEquals(30, list.get(0).getId());
+            assertEquals(174, list.get(0).getId());
             assertEquals(39, list.size());
             assertEquals(39, ((Page<?>) list).getTotal());
         } finally {

File: src/main/java/com/github/pagehelper/PageInfo.java
Patch:
@@ -389,8 +389,8 @@ public String toString() {
         sb.append(", hasPreviousPage=").append(hasPreviousPage);
         sb.append(", hasNextPage=").append(hasNextPage);
         sb.append(", navigatePages=").append(navigatePages);
-        sb.append(", navigateFirstPage").append(navigateFirstPage);
-        sb.append(", navigateLastPage").append(navigateLastPage);
+        sb.append(", navigateFirstPage=").append(navigateFirstPage);
+        sb.append(", navigateLastPage=").append(navigateLastPage);
         sb.append(", navigatepageNums=");
         if (navigatepageNums == null) sb.append("null");
         else {

File: src/main/java/com/github/pagehelper/cache/SimpleCache.java
Patch:
@@ -78,7 +78,7 @@ public SimpleCache(Properties properties, String prefix) {
     public V get(K key) {
         Object value = CACHE.getObject(key);
         if(value != null){
-            return (V)value.toString();
+            return (V)value;
         }
         return null;
     }

File: src/main/java/com/github/pagehelper/parser/SqlParser.java
Patch:
@@ -80,7 +80,7 @@ public String getSmartCountSql(String sql) {
         Statement stmt = null;
         try {
             stmt = CCJSqlParserUtil.parse(sql);
-        } catch (JSQLParserException e) {
+        } catch (Throwable e) {
             //无法解析的用一般方法返回count语句
             String countSql = getSimpleCountSql(sql);
             CACHE.put(sql, countSql);

File: src/main/java/com/github/pagehelper/parser/SqlServer.java
Patch:
@@ -95,7 +95,7 @@ public String convertToPageSql(String sql, int offset, int limit) {
             Statement stmt;
             try {
                 stmt = CCJSqlParserUtil.parse(sql);
-            } catch (JSQLParserException e) {
+            } catch (Throwable e) {
                 throw new RuntimeException("不支持该SQL转换为分页查询!");
             }
             if (!(stmt instanceof Select)) {

File: src/main/java/com/github/pagehelper/SqlUtil.java
Patch:
@@ -503,7 +503,9 @@ public String getCountSql(final String sql) {
 
         public List<ParameterMapping> getPageParameterMapping(Configuration configuration, BoundSql boundSql) {
             List<ParameterMapping> newParameterMappings = new ArrayList<ParameterMapping>();
-            newParameterMappings.addAll(boundSql.getParameterMappings());
+            if (boundSql.getParameterMappings() != null) {
+                newParameterMappings.addAll(boundSql.getParameterMappings());
+            }
             newParameterMappings.add(new ParameterMapping.Builder(configuration, PAGEPARAMETER_FIRST, Integer.class).build());
             newParameterMappings.add(new ParameterMapping.Builder(configuration, PAGEPARAMETER_SECOND, Integer.class).build());
             return newParameterMappings;

File: src/main/java/com/github/pagehelper/SqlParser.java
Patch:
@@ -124,7 +124,8 @@ public void sqlToCount(Select select) {
         // select中包含group by时在else中处理
         if (selectBody instanceof PlainSelect
                 && !selectItemsHashParameters(((PlainSelect) selectBody).getSelectItems())
-                && ((PlainSelect) selectBody).getGroupByColumnReferences() == null) {
+                && ((PlainSelect) selectBody).getGroupByColumnReferences() == null
+                && ((PlainSelect) selectBody).getDistinct() == null) {
             ((PlainSelect) selectBody).setSelectItems(COUNT_ITEM);
         } else {
             PlainSelect plainSelect = new PlainSelect();

File: src/test/java/com/github/pagehelper/mapper/CountryMapper.java
Patch:
@@ -104,4 +104,6 @@ public interface CountryMapper {
 
     //Example
     List<Country> selectByExample(CountryExample example);
+
+    List<Country> selectDistinct();
 }

File: src/main/java/com/github/pagehelper/SqlUtil.java
Patch:
@@ -252,8 +252,7 @@ public Map setPageParameter(MappedStatement ms, Object parameterObject, BoundSql
                             if (hasTypeHandler
                                     || parameterMapping.getJavaType().equals(parameterObject.getClass())) {
                                 paramMap.put(name, parameterObject);
-                            } else {
-                                paramMap.put(name, metaObject.getValue(name));
+                                break;
                             }
                         }
                     }

File: src/test/java/com/github/pagehelper/mapper/CountryMapper.java
Patch:
@@ -53,4 +53,7 @@ public interface CountryMapper {
     List<Country> selectColumns(@Param("columns") String... columns);
 
     List<Country> selectMULId(int mul);
+
+    //group by时
+    List<Country> selectGroupBy();
 }

File: src/test/java/com/github/pagehelper/test/basic/count/TestSelectItems.java
Patch:
@@ -22,7 +22,7 @@
  * THE SOFTWARE.
  */
 
-package com.github.pagehelper.test.basic.selectitems;
+package com.github.pagehelper.test.basic.count;
 
 import com.github.pagehelper.Page;
 import com.github.pagehelper.PageHelper;

File: src/test/java/com/github/pagehelper/mapper/CountryMapper.java
Patch:
@@ -53,4 +53,7 @@ public interface CountryMapper {
     List<Country> selectColumns(@Param("columns") String... columns);
 
     List<Country> selectMULId(int mul);
+
+    //group by时
+    List<Country> selectGroupBy();
 }

File: src/test/java/com/github/pagehelper/test/basic/count/TestSelectItems.java
Patch:
@@ -22,7 +22,7 @@
  * THE SOFTWARE.
  */
 
-package com.github.pagehelper.test.basic.selectitems;
+package com.github.pagehelper.test.basic.count;
 
 import com.github.pagehelper.Page;
 import com.github.pagehelper.PageHelper;

File: src/test/java/com/github/pagehelper/test/basic/cache/CacheTest.java
Patch:
@@ -106,7 +106,6 @@ private class CacheThread implements Runnable {
         private CacheThread() {
         }
 
-        @Override
         public void run() {
             SqlSession sqlSession = MybatisHelper.getSqlSession();
             System.out.println(Thread.currentThread().getId() + "开始运行...");

File: src/test/java/com/github/pagehelper/test/basic/dynamic/CacheTest.java
Patch:
@@ -75,7 +75,6 @@ private class CacheThread implements Runnable {
         private CacheThread() {
         }
 
-        @Override
         public void run() {
             SqlSession sqlSession = MybatisHelper.getSqlSession();
             System.out.println(Thread.currentThread().getId() + "开始运行...");

File: src/main/java/com/github/pagehelper/Page.java
Patch:
@@ -37,6 +37,8 @@ of this software and associated documentation files (the "Software"), to deal
  *          项目地址 : http://git.oschina.net/free/Mybatis_PageHelper
  */
 public class Page<E> extends ArrayList<E> {
+    private static final long serialVersionUID = 1L;
+
     /**
      * 不进行count查询
      */

File: src/main/java/com/github/pagehelper/PageInfo.java
Patch:
@@ -12,6 +12,7 @@
  * @since 3.2.2
  * 项目地址 : http://git.oschina.net/free/Mybatis_PageHelper
  */
+@SuppressWarnings({ "rawtypes", "unchecked" })
 public class PageInfo<T> {
     //当前页
     private int pageNum;

File: src/main/java/com/github/pagehelper/SqlUtil.java
Patch:
@@ -49,6 +49,7 @@
  * @since 3.3.0
  * 项目地址 : http://git.oschina.net/free/Mybatis_PageHelper
  */
+@SuppressWarnings({ "rawtypes", "unchecked" })
 public class SqlUtil {
     private static final List<ResultMapping> EMPTY_RESULTMAPPING = new ArrayList<ResultMapping>(0);
 
@@ -224,7 +225,6 @@ public String getCountSql(final String sql) {
          */
         public abstract String getPageSql(String sql);
 
-        @Override
         public Map setPageParameter(Object parameterObject, BoundSql boundSql, Page page) {
             Map paramMap = null;
             if (parameterObject == null) {

File: src/test/java/com/github/pagehelper/mapper/CountryMapper.java
Patch:
@@ -29,6 +29,7 @@ public interface CountryMapper {
 
     //测试动态sql,where/if
     List<Country> selectIf(@Param("id") Integer id);
+    List<Country> selectIf3(Country country);
     List<Country> selectIf2(@Param("id1") Integer id1,@Param("id2") Integer id2);
     List<Country> selectIf2List(@Param("id1") List<Integer> id1,@Param("id2") List<Integer> id2);
     List<Country> selectIf2ListAndOrder(@Param("id1") List<Integer> id1,@Param("id2") List<Integer> id2, @Param("order") String order);

