File: app/src/main/java/ceui/lisa/fragments/FragmentWebView.java
Patch:
@@ -478,7 +478,7 @@ public URLConnection recursiveRequest(String path, Map<String, String> headers,
             url = new URL(path);
             conn = (HttpURLConnection) url.openConnection();
             // 异步接口获取IP
-            String ip = "210.140.131.188";
+            String ip = "210.140.139.157";
             if (ip != null) {
                 // 通过HTTPDNS获取IP成功，进行URL替换和HOST头设置
                 Log.d(TAG, "Get IP: " + ip + " for host: " + url.getHost() + " from HTTPDNS successfully!");

File: app/src/main/java/ceui/lisa/fragments/FragmentWebView.java
Patch:
@@ -478,7 +478,7 @@ public URLConnection recursiveRequest(String path, Map<String, String> headers,
             url = new URL(path);
             conn = (HttpURLConnection) url.openConnection();
             // 异步接口获取IP
-            String ip = "210.140.131.188";
+            String ip = "210.140.139.157";
             if (ip != null) {
                 // 通过HTTPDNS获取IP成功，进行URL替换和HOST头设置
                 Log.d(TAG, "Get IP: " + ip + " for host: " + url.getHost() + " from HTTPDNS successfully!");

File: app/src/main/java/ceui/lisa/adapters/IAdapter.java
Patch:
@@ -64,7 +64,7 @@ public void bindData(IllustsBean target, ViewHolder<RecyIllustStaggerBinding> bi
         float ratio = (float) target.getHeight() / (float) target.getWidth();
         ViewGroup.LayoutParams params = bindView.baseBind.illustImage.getLayoutParams();
         int itemWidth =
-                (ScreenUtils.getDisplayMetrics().widthPixels - ScreenUtils.dpToPx(24)) / 2;
+                ScreenUtils.getDisplayMetrics().widthPixels / Shaft.sSettings.getLineCount();
         params.width = itemWidth;
         if (ratio > MAX_HEIGHT_RATIO) {
             // 如果图片很窄，但是高度很高，则限制最大高度，是宽的 1.8 倍

File: app/src/main/java/ceui/lisa/activities/MainActivity.java
Patch:
@@ -225,7 +225,7 @@ protected void initData() {
             if (!SessionManager.INSTANCE.isLoggedIn()) {
                 SessionManager.INSTANCE.updateSession(sUserModel);
             }
-            if (Dev.isDev) {
+            if (Dev.isDev && false) {
                 startActivity(new Intent(this, HomeActivity.class));
             } else {
                 if (Common.isAndroidQ()) {

File: app/src/main/java/ceui/lisa/activities/MainActivity.java
Patch:
@@ -225,7 +225,7 @@ protected void initData() {
             if (!SessionManager.INSTANCE.isLoggedIn()) {
                 SessionManager.INSTANCE.updateSession(sUserModel);
             }
-            if (Dev.isDev && false) {
+            if (Dev.isDev) {
                 startActivity(new Intent(this, HomeActivity.class));
             } else {
                 if (Common.isAndroidQ()) {

File: app/src/main/java/ceui/lisa/utils/Common.java
Patch:
@@ -125,7 +125,7 @@ public static void logOut(Context context, boolean deleteUser) {
     }
 
     public static <T> void showLog(T t) {
-        Log.d("==SHAFT== log ==> ", String.valueOf(t));
+        Log.d("==SHAFT==>", String.valueOf(t));
     }
 
     public static <T> void showToast(T t) {

File: app/src/main/java/ceui/lisa/activities/MainActivity.java
Patch:
@@ -222,6 +222,9 @@ public int getCount() {
     @Override
     protected void initData() {
         if (SessionManager.INSTANCE.isLoggedIn() || (sUserModel != null && sUserModel.getUser() != null && sUserModel.getUser().isIs_login())) {
+            if (!SessionManager.INSTANCE.isLoggedIn()) {
+                SessionManager.INSTANCE.updateSession(sUserModel);
+            }
             if (Dev.isDev && false) {
                 startActivity(new Intent(this, HomeActivity.class));
             } else {

File: app/src/main/java/ceui/lisa/http/TokenInterceptor.java
Patch:
@@ -61,6 +61,7 @@ private boolean isTokenExpired(Response response) {
             } else if(body.contains(TOKEN_ERROR_2)){
                 Shaft.sUserModel.getUser().setIs_login(false);
                 Local.saveUser(Shaft.sUserModel);
+                SessionManager.INSTANCE.postUpdateSession(null);
                 Common.showToast(R.string.string_340);
                 Common.restart();
                 Common.showLog("isTokenExpired 111");
@@ -100,6 +101,7 @@ private synchronized String getNewToken(String tokenForThisRequest) throws IOExc
                 newUser.getUser().setIs_login(true);
             }
             Local.saveUser(newUser);
+            SessionManager.INSTANCE.postUpdateSession(newUser);
             Common.showLog("getNewToken 获取到了最新的 token:" + newUser.getAccess_token());
             return newUser.getAccess_token();
         } else {

File: app/src/main/java/ceui/lisa/activities/MainActivity.java
Patch:
@@ -44,6 +44,7 @@
 import ceui.lisa.utils.Common;
 import ceui.lisa.utils.Dev;
 import ceui.lisa.utils.GlideUtil;
+import ceui.lisa.utils.Local;
 import ceui.lisa.utils.Params;
 import ceui.lisa.utils.ReverseImage;
 import ceui.lisa.utils.ReverseWebviewCallback;
@@ -220,7 +221,7 @@ public int getCount() {
 
     @Override
     protected void initData() {
-        if (SessionManager.INSTANCE.isLoggedIn()) {
+        if (SessionManager.INSTANCE.isLoggedIn() || (sUserModel != null && sUserModel.getUser() != null && sUserModel.getUser().isIs_login())) {
             if (Dev.isDev && false) {
                 startActivity(new Intent(this, HomeActivity.class));
             } else {

File: app/src/main/java/ceui/lisa/http/TokenInterceptor.java
Patch:
@@ -10,6 +10,7 @@
 import ceui.lisa.models.UserModel;
 import ceui.lisa.utils.Common;
 import ceui.lisa.utils.Local;
+import ceui.pixiv.session.SessionManager;
 import okhttp3.Interceptor;
 import okhttp3.Request;
 import okhttp3.Response;

File: app/src/main/java/ceui/lisa/http/TokenInterceptor.java
Patch:
@@ -61,7 +61,6 @@ private boolean isTokenExpired(Response response) {
             } else if(body.contains(TOKEN_ERROR_2)){
                 Shaft.sUserModel.getUser().setIs_login(false);
                 Local.saveUser(Shaft.sUserModel);
-                SessionManager.INSTANCE.updateSession(null);
                 Common.showToast(R.string.string_340);
                 Common.restart();
                 Common.showLog("isTokenExpired 111");
@@ -101,7 +100,6 @@ private synchronized String getNewToken(String tokenForThisRequest) throws IOExc
                 newUser.getUser().setIs_login(true);
             }
             Local.saveUser(newUser);
-            SessionManager.INSTANCE.updateSession(newUser);
             Common.showLog("getNewToken 获取到了最新的 token:" + newUser.getAccess_token());
             return newUser.getAccess_token();
         } else {

File: app/src/main/java/ceui/lisa/activities/MainActivity.java
Patch:
@@ -44,6 +44,7 @@
 import ceui.lisa.utils.Common;
 import ceui.lisa.utils.Dev;
 import ceui.lisa.utils.GlideUtil;
+import ceui.lisa.utils.Local;
 import ceui.lisa.utils.Params;
 import ceui.lisa.utils.ReverseImage;
 import ceui.lisa.utils.ReverseWebviewCallback;
@@ -220,7 +221,7 @@ public int getCount() {
 
     @Override
     protected void initData() {
-        if (SessionManager.INSTANCE.isLoggedIn()) {
+        if (SessionManager.INSTANCE.isLoggedIn() || (sUserModel != null && sUserModel.getUser() != null && sUserModel.getUser().isIs_login())) {
             if (Dev.isDev && false) {
                 startActivity(new Intent(this, HomeActivity.class));
             } else {

File: app/src/main/java/ceui/lisa/http/TokenInterceptor.java
Patch:
@@ -10,6 +10,7 @@
 import ceui.lisa.models.UserModel;
 import ceui.lisa.utils.Common;
 import ceui.lisa.utils.Local;
+import ceui.pixiv.session.SessionManager;
 import okhttp3.Interceptor;
 import okhttp3.Request;
 import okhttp3.Response;
@@ -60,6 +61,7 @@ private boolean isTokenExpired(Response response) {
             } else if(body.contains(TOKEN_ERROR_2)){
                 Shaft.sUserModel.getUser().setIs_login(false);
                 Local.saveUser(Shaft.sUserModel);
+                SessionManager.INSTANCE.updateSession(null);
                 Common.showToast(R.string.string_340);
                 Common.restart();
                 Common.showLog("isTokenExpired 111");
@@ -99,6 +101,7 @@ private synchronized String getNewToken(String tokenForThisRequest) throws IOExc
                 newUser.getUser().setIs_login(true);
             }
             Local.saveUser(newUser);
+            SessionManager.INSTANCE.updateSession(newUser);
             Common.showLog("getNewToken 获取到了最新的 token:" + newUser.getAccess_token());
             return newUser.getAccess_token();
         } else {

File: app/src/main/java/ceui/lisa/activities/SearchActivity.java
Patch:
@@ -233,7 +233,7 @@ else if(Common.isNumeric(trimmedKeyword)){
                             .create();
                     tipDialog.show();
                     //先假定为作品id
-                    PixivOperate.getIllustByID(sUserModel, Integer.parseInt(trimmedKeyword), mContext, new Callback<Void>() {
+                    PixivOperate.getIllustByID(sUserModel, tryParseId(trimmedKeyword), mContext, new Callback<Void>() {
                         @Override
                         public void doSomething(Void t) {
                             PixivOperate.insertSearchHistory(trimmedKeyword, SearchTypeUtil.SEARCH_TYPE_DB_ILLUSTSID);

File: app/src/main/java/ceui/lisa/http/AppApi.java
Patch:
@@ -316,7 +316,7 @@ Observable<NullResponse> postDislikeNovel(@Header("Authorization") String token,
 
     @GET("v1/illust/detail?filter=for_android")
     Observable<IllustSearchResponse> getIllustByID(@Header("Authorization") String token,
-                                                   @Query("illust_id") int illust_id);
+                                                   @Query("illust_id") long illust_id);
 
 
     @GET("v1/search/user?filter=for_android")
@@ -441,7 +441,7 @@ Observable<ListNovelOfSeries> getNovelSeries(@Header("Authorization") String tok
 
     @GET("v2/novel/detail")
     Observable<NovelSearchResponse> getNovelByID(@Header("Authorization") String token,
-                                                 @Query("novel_id") int novel_id);
+                                                 @Query("novel_id") long novel_id);
 
     @GET("v1/illust/series?filter=for_android")
     Observable<ListMangaOfSeries> getMangaSeriesById(@Header("Authorization") String token,

File: app/src/main/java/ceui/lisa/utils/PixivOperate.java
Patch:
@@ -262,7 +262,7 @@ public void next(NullResponse nullResponse) {
         }
     }
 
-    public static void getIllustByID(UserModel userModel, int illustID, Context context) {
+    public static void getIllustByID(UserModel userModel, long illustID, Context context) {
         QMUITipDialog tipDialog = new QMUITipDialog.Builder(context)
                 .setIconType(QMUITipDialog.Builder.ICON_TYPE_LOADING)
                 .setTipWord(getString(R.string.string_429))
@@ -313,7 +313,7 @@ public void must() {
                 });
     }
 
-    public static void getIllustByID(UserModel userModel, int illustID, Context context,
+    public static void getIllustByID(UserModel userModel, long illustID, Context context,
                                      ceui.lisa.interfaces.Callback<Void> success,ceui.lisa.interfaces.Callback<Void> fail) {
         Retro.getAppApi().getIllustByID(userModel.getAccess_token(), illustID)
                 .subscribeOn(Schedulers.newThread())
@@ -355,7 +355,7 @@ public void must() {
                 });
     }
 
-    public static void getNovelByID(UserModel userModel, int novel, Context context,
+    public static void getNovelByID(UserModel userModel, long novel, Context context,
                                      ceui.lisa.interfaces.Callback<Void> callback) {
         Retro.getAppApi().getNovelByID(userModel.getAccess_token(), novel)
                 .subscribeOn(Schedulers.newThread())

File: app/src/main/java/ceui/lisa/activities/TemplateActivity.java
Patch:
@@ -77,8 +77,8 @@
 import ceui.lisa.utils.Local;
 import ceui.lisa.utils.Params;
 import ceui.lisa.utils.ReverseResult;
-import ceui.loxia.FlagDescFragment;
-import ceui.loxia.FlagReasonFragment;
+import ceui.loxia.flag.FlagDescFragment;
+import ceui.loxia.flag.FlagReasonFragment;
 
 public class TemplateActivity extends BaseActivity<ActivityFragmentBinding> implements ColorPickerDialogListener {
 

File: app/src/main/java/ceui/lisa/http/AppApi.java
Patch:
@@ -70,8 +70,8 @@ Observable<ListNovel> getRankNovel(@Header("Authorization") String token,
      * @param token
      * @return
      */
-    @GET("v1/illust/recommended?include_privacy_policy=true&filter=for_android&include_ranking_illusts=true")
-    Observable<RecmdIllust> getRecmdIllust(@Header("Authorization") String token);
+    @GET("v1/illust/recommended?include_privacy_policy=true&filter=for_android")
+    Observable<RecmdIllust> getRecmdIllust(@Header("Authorization") String token, @Query("include_ranking_illusts") boolean include_ranking_illusts);
 
 
     @GET("v1/manga/recommended?include_privacy_policy=true&filter=for_android&include_ranking_illusts=true")

File: app/src/main/java/ceui/lisa/fragments/FragmentViewPager.java
Patch:
@@ -113,10 +113,11 @@ public void onPageScrollStateChanged(int state) {
                     Shaft.getContext().getString(R.string.r_eighteen_female_rank),
             };
             mFragments = new ListFragment[]{
-                    FragmentRankIllust.newInstance(7, "", false),
+//                    FragmentRankIllust.newInstance(7, "", false),
                     FragmentRankIllust.newInstance(8, "", false),
                     FragmentRankIllust.newInstance(9, "", false),
-                    FragmentRankIllust.newInstance(10, "", false)
+                    FragmentRankIllust.newInstance(10, "", false),
+                    FragmentRankIllust.newInstance(11, "", false)
             };
             baseBind.toolbarTitle.setText(R.string.string_r);
             baseBind.viewPager.setAdapter(new FragmentPagerAdapter(getChildFragmentManager()) {

File: app/src/main/java/ceui/lisa/core/Manager.java
Patch:
@@ -15,6 +15,7 @@
 import java.util.Optional;
 import java.util.stream.Collectors;
 
+import ceui.lisa.R;
 import ceui.lisa.activities.Shaft;
 import ceui.lisa.database.AppDatabase;
 import ceui.lisa.database.DownloadEntity;
@@ -114,7 +115,7 @@ private void complete(DownloadItem item, boolean isDownloadSuccess) {
             entity.setUuid(item.getUuid());
             entity.setTaskGson(Shaft.sGson.toJson(item));
             AppDatabase.getAppDatabase(mContext).downloadDao().deleteDownloading(entity);
-            Common.showToast(item.getName() + "已下载完成");
+            Common.showToast(item.getName() + mContext.getString(R.string.has_been_downloaded));
         } else {
             item.setNonius(0);
             item.setState(DownloadItem.DownloadState.FAILED);

File: app/src/main/java/ceui/lisa/fragments/FragmentSingleUgora.java
Patch:
@@ -360,7 +360,7 @@ public void onPrepare() {
                 }
             } else {
                 IllustDownload.downloadGif(illust);
-                Common.showToast("已经加入下载队列");
+                Common.showToast(requireContext().getString(R.string.one_item_added));
             }
         });
         baseBind.userName.setOnLongClickListener(new View.OnLongClickListener() {

File: app/src/main/java/ceui/lisa/core/Manager.java
Patch:
@@ -15,6 +15,7 @@
 import java.util.Optional;
 import java.util.stream.Collectors;
 
+import ceui.lisa.R;
 import ceui.lisa.activities.Shaft;
 import ceui.lisa.database.AppDatabase;
 import ceui.lisa.database.DownloadEntity;
@@ -114,7 +115,7 @@ private void complete(DownloadItem item, boolean isDownloadSuccess) {
             entity.setUuid(item.getUuid());
             entity.setTaskGson(Shaft.sGson.toJson(item));
             AppDatabase.getAppDatabase(mContext).downloadDao().deleteDownloading(entity);
-            Common.showToast(item.getName() + "已下载完成");
+            Common.showToast(item.getName() + mContext.getString(R.string.has_been_downloaded));
         } else {
             item.setNonius(0);
             item.setState(DownloadItem.DownloadState.FAILED);

File: app/src/main/java/ceui/lisa/fragments/FragmentSingleUgora.java
Patch:
@@ -360,7 +360,7 @@ public void onPrepare() {
                 }
             } else {
                 IllustDownload.downloadGif(illust);
-                Common.showToast("已经加入下载队列");
+                Common.showToast(requireContext().getString(R.string.one_item_added));
             }
         });
         baseBind.userName.setOnLongClickListener(new View.OnLongClickListener() {

File: app/src/main/java/ceui/lisa/fragments/FragmentViewPager.java
Patch:
@@ -113,10 +113,11 @@ public void onPageScrollStateChanged(int state) {
                     Shaft.getContext().getString(R.string.r_eighteen_female_rank),
             };
             mFragments = new ListFragment[]{
-                    FragmentRankIllust.newInstance(7, "", false),
+//                    FragmentRankIllust.newInstance(7, "", false),
                     FragmentRankIllust.newInstance(8, "", false),
                     FragmentRankIllust.newInstance(9, "", false),
-                    FragmentRankIllust.newInstance(10, "", false)
+                    FragmentRankIllust.newInstance(10, "", false),
+                    FragmentRankIllust.newInstance(11, "", false)
             };
             baseBind.toolbarTitle.setText(R.string.string_r);
             baseBind.viewPager.setAdapter(new FragmentPagerAdapter(getChildFragmentManager()) {

File: app/src/main/java/ceui/lisa/core/Mapper.java
Patch:
@@ -28,6 +28,7 @@ public T apply(T t) {
                 if (isTagBanned || isIdBanned || isUserBanned || isR18FilterBanned) {
                     dash.add(o);
                 }
+                ObjectPool.INSTANCE.updateIllust((IllustsBean) o);
             }
             if (o instanceof NovelBean) {
                 boolean isTagBanned = IllustNovelFilter.judgeTag((NovelBean) o);

File: app/src/main/java/ceui/lisa/fragments/FragmentHistory.java
Patch:
@@ -130,6 +130,7 @@ public void onFirstLoaded(List<IllustHistoryEntity> illustHistoryEntities) {
             if (illustHistoryEntities.get(i).getType() == 0) {
                 IllustsBean illustsBean = Shaft.sGson.fromJson(
                         illustHistoryEntities.get(i).getIllustJson(), IllustsBean.class);
+                ObjectPool.INSTANCE.updateIllust(illustsBean);
                 ((HistoryModel)mModel).getAll().add(illustsBean);
             }
         }
@@ -141,6 +142,7 @@ public void onNextLoaded(List<IllustHistoryEntity> illustHistoryEntities) {
             if (illustHistoryEntities.get(i).getType() == 0) {
                 IllustsBean illustsBean = Shaft.sGson.fromJson(
                         illustHistoryEntities.get(i).getIllustJson(), IllustsBean.class);
+                ObjectPool.INSTANCE.updateIllust(illustsBean);
                 ((HistoryModel)mModel).getAll().add(illustsBean);
             }
         }

File: app/src/main/java/ceui/lisa/core/Mapper.java
Patch:
@@ -28,6 +28,7 @@ public T apply(T t) {
                 if (isTagBanned || isIdBanned || isUserBanned || isR18FilterBanned) {
                     dash.add(o);
                 }
+                ObjectPool.INSTANCE.updateIllust((IllustsBean) o);
             }
             if (o instanceof NovelBean) {
                 boolean isTagBanned = IllustNovelFilter.judgeTag((NovelBean) o);

File: app/src/main/java/ceui/lisa/fragments/FragmentHistory.java
Patch:
@@ -130,6 +130,7 @@ public void onFirstLoaded(List<IllustHistoryEntity> illustHistoryEntities) {
             if (illustHistoryEntities.get(i).getType() == 0) {
                 IllustsBean illustsBean = Shaft.sGson.fromJson(
                         illustHistoryEntities.get(i).getIllustJson(), IllustsBean.class);
+                ObjectPool.INSTANCE.updateIllust(illustsBean);
                 ((HistoryModel)mModel).getAll().add(illustsBean);
             }
         }
@@ -141,6 +142,7 @@ public void onNextLoaded(List<IllustHistoryEntity> illustHistoryEntities) {
             if (illustHistoryEntities.get(i).getType() == 0) {
                 IllustsBean illustsBean = Shaft.sGson.fromJson(
                         illustHistoryEntities.get(i).getIllustJson(), IllustsBean.class);
+                ObjectPool.INSTANCE.updateIllust(illustsBean);
                 ((HistoryModel)mModel).getAll().add(illustsBean);
             }
         }

File: app/src/main/java/ceui/lisa/activities/MainActivity.java
Patch:
@@ -49,7 +49,6 @@
 import ceui.lisa.utils.ReverseImage;
 import ceui.lisa.utils.ReverseWebviewCallback;
 import ceui.lisa.view.DrawerLayoutViewPager;
-import ceui.loxia.test.ListActivity;
 
 import static ceui.lisa.activities.Shaft.sUserModel;
 

File: app/src/main/java/ceui/lisa/activities/UserActivity.java
Patch:
@@ -33,6 +33,7 @@
 import ceui.lisa.utils.Params;
 import ceui.lisa.utils.PixivOperate;
 import ceui.lisa.viewmodel.UserViewModel;
+import ceui.loxia.ObjectPool;
 import io.reactivex.android.schedulers.AndroidSchedulers;
 import io.reactivex.schedulers.Schedulers;
 
@@ -79,8 +80,8 @@ public void onChanged(UserDetailResponse userDetailResponse) {
                 .observeOn(AndroidSchedulers.mainThread())
                 .subscribe(new ErrorCtrl<UserDetailResponse>() {
                     @Override
-                    public void next(UserDetailResponse user) {
-                        mUserViewModel.getUser().setValue(user);
+                    public void next(UserDetailResponse userResponse) {
+                        mUserViewModel.getUser().setValue(userResponse);
                     }
                 });
         baseBind.turnGray.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {

File: app/src/main/java/ceui/lisa/activities/MainActivity.java
Patch:
@@ -49,7 +49,6 @@
 import ceui.lisa.utils.ReverseImage;
 import ceui.lisa.utils.ReverseWebviewCallback;
 import ceui.lisa.view.DrawerLayoutViewPager;
-import ceui.loxia.test.ListActivity;
 
 import static ceui.lisa.activities.Shaft.sUserModel;
 

File: app/src/main/java/ceui/lisa/activities/UserActivity.java
Patch:
@@ -33,6 +33,7 @@
 import ceui.lisa.utils.Params;
 import ceui.lisa.utils.PixivOperate;
 import ceui.lisa.viewmodel.UserViewModel;
+import ceui.loxia.ObjectPool;
 import io.reactivex.android.schedulers.AndroidSchedulers;
 import io.reactivex.schedulers.Schedulers;
 
@@ -79,8 +80,8 @@ public void onChanged(UserDetailResponse userDetailResponse) {
                 .observeOn(AndroidSchedulers.mainThread())
                 .subscribe(new ErrorCtrl<UserDetailResponse>() {
                     @Override
-                    public void next(UserDetailResponse user) {
-                        mUserViewModel.getUser().setValue(user);
+                    public void next(UserDetailResponse userResponse) {
+                        mUserViewModel.getUser().setValue(userResponse);
                     }
                 });
         baseBind.turnGray.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {

File: app/src/main/java/ceui/lisa/activities/VActivity.java
Patch:
@@ -29,6 +29,7 @@
 import ceui.lisa.utils.Common;
 import ceui.lisa.utils.Params;
 import ceui.lisa.utils.PixivOperate;
+import ceui.loxia.ObjectPool;
 import io.reactivex.android.schedulers.AndroidSchedulers;
 import io.reactivex.disposables.Disposable;
 import io.reactivex.schedulers.Schedulers;
@@ -64,6 +65,7 @@ public Fragment getItem(int position) {
                         return FragmentSingleUgora.newInstance(illustsBean);
                     } else {
                         if (Shaft.sSettings.isUseFragmentIllust()) {
+                            ObjectPool.INSTANCE.updateIllust(illustsBean);
                             return FragmentIllust.newInstance(illustsBean.getId());
                         } else {
                             return FragmentSingleIllust.newInstance(illustsBean);

File: app/src/main/java/ceui/lisa/core/Mapper.java
Patch:
@@ -28,7 +28,6 @@ public T apply(T t) {
                 if (isTagBanned || isIdBanned || isUserBanned || isR18FilterBanned) {
                     dash.add(o);
                 }
-                ObjectPool.INSTANCE.updateIllust((IllustsBean) o);
             }
             if (o instanceof NovelBean) {
                 boolean isTagBanned = IllustNovelFilter.judgeTag((NovelBean) o);

File: app/src/main/java/ceui/lisa/fragments/FragmentHistory.java
Patch:
@@ -32,6 +32,7 @@
 import ceui.lisa.utils.Params;
 import ceui.lisa.viewmodel.BaseModel;
 import ceui.lisa.viewmodel.HistoryModel;
+import ceui.loxia.ObjectPool;
 
 
 public class FragmentHistory extends LocalListFragment<FragmentBaseListBinding,

File: app/src/main/java/ceui/lisa/utils/PixivOperate.java
Patch:
@@ -277,6 +277,8 @@ public void success(IllustSearchResponse illustSearchResponse) {
                             return;
                         }
 
+                        ObjectPool.INSTANCE.updateIllust(illust);
+
                         if (illust.getId() == 0 || !illust.isVisible()) {
                             Common.showToast(R.string.string_206);
                             return;

File: app/src/main/java/ceui/lisa/activities/VActivity.java
Patch:
@@ -29,6 +29,7 @@
 import ceui.lisa.utils.Common;
 import ceui.lisa.utils.Params;
 import ceui.lisa.utils.PixivOperate;
+import ceui.loxia.ObjectPool;
 import io.reactivex.android.schedulers.AndroidSchedulers;
 import io.reactivex.disposables.Disposable;
 import io.reactivex.schedulers.Schedulers;
@@ -64,6 +65,7 @@ public Fragment getItem(int position) {
                         return FragmentSingleUgora.newInstance(illustsBean);
                     } else {
                         if (Shaft.sSettings.isUseFragmentIllust()) {
+                            ObjectPool.INSTANCE.updateIllust(illustsBean);
                             return FragmentIllust.newInstance(illustsBean.getId());
                         } else {
                             return FragmentSingleIllust.newInstance(illustsBean);

File: app/src/main/java/ceui/lisa/fragments/FragmentHistory.java
Patch:
@@ -130,7 +130,6 @@ public void onFirstLoaded(List<IllustHistoryEntity> illustHistoryEntities) {
             if (illustHistoryEntities.get(i).getType() == 0) {
                 IllustsBean illustsBean = Shaft.sGson.fromJson(
                         illustHistoryEntities.get(i).getIllustJson(), IllustsBean.class);
-                ObjectPool.INSTANCE.updateIllust(illustsBean);
                 ((HistoryModel)mModel).getAll().add(illustsBean);
             }
         }
@@ -142,7 +141,6 @@ public void onNextLoaded(List<IllustHistoryEntity> illustHistoryEntities) {
             if (illustHistoryEntities.get(i).getType() == 0) {
                 IllustsBean illustsBean = Shaft.sGson.fromJson(
                         illustHistoryEntities.get(i).getIllustJson(), IllustsBean.class);
-                ObjectPool.INSTANCE.updateIllust(illustsBean);
                 ((HistoryModel)mModel).getAll().add(illustsBean);
             }
         }

File: app/src/main/java/ceui/lisa/core/Mapper.java
Patch:
@@ -5,6 +5,7 @@
 
 import ceui.lisa.helper.IllustNovelFilter;
 import ceui.lisa.interfaces.ListShow;
+import ceui.lisa.model.ListTrendingtag;
 import ceui.lisa.models.IllustsBean;
 import ceui.lisa.models.NovelBean;
 import ceui.loxia.ObjectPool;
@@ -28,6 +29,7 @@ public T apply(T t) {
                 if (isTagBanned || isIdBanned || isUserBanned || isR18FilterBanned) {
                     dash.add(o);
                 }
+                ObjectPool.INSTANCE.updateIllust((IllustsBean) o);
             }
             if (o instanceof NovelBean) {
                 boolean isTagBanned = IllustNovelFilter.judgeTag((NovelBean) o);

File: app/src/main/java/ceui/lisa/core/Mapper.java
Patch:
@@ -28,7 +28,6 @@ public T apply(T t) {
                 if (isTagBanned || isIdBanned || isUserBanned || isR18FilterBanned) {
                     dash.add(o);
                 }
-                ObjectPool.INSTANCE.updateIllust((IllustsBean) o);
             }
             if (o instanceof NovelBean) {
                 boolean isTagBanned = IllustNovelFilter.judgeTag((NovelBean) o);

File: app/src/main/java/ceui/lisa/fragments/FragmentHistory.java
Patch:
@@ -32,6 +32,7 @@
 import ceui.lisa.utils.Params;
 import ceui.lisa.viewmodel.BaseModel;
 import ceui.lisa.viewmodel.HistoryModel;
+import ceui.loxia.ObjectPool;
 
 
 public class FragmentHistory extends LocalListFragment<FragmentBaseListBinding,
@@ -129,6 +130,7 @@ public void onFirstLoaded(List<IllustHistoryEntity> illustHistoryEntities) {
             if (illustHistoryEntities.get(i).getType() == 0) {
                 IllustsBean illustsBean = Shaft.sGson.fromJson(
                         illustHistoryEntities.get(i).getIllustJson(), IllustsBean.class);
+                ObjectPool.INSTANCE.updateIllust(illustsBean);
                 ((HistoryModel)mModel).getAll().add(illustsBean);
             }
         }
@@ -140,6 +142,7 @@ public void onNextLoaded(List<IllustHistoryEntity> illustHistoryEntities) {
             if (illustHistoryEntities.get(i).getType() == 0) {
                 IllustsBean illustsBean = Shaft.sGson.fromJson(
                         illustHistoryEntities.get(i).getIllustJson(), IllustsBean.class);
+                ObjectPool.INSTANCE.updateIllust(illustsBean);
                 ((HistoryModel)mModel).getAll().add(illustsBean);
             }
         }

File: app/src/main/java/ceui/lisa/utils/PixivOperate.java
Patch:
@@ -277,6 +277,8 @@ public void success(IllustSearchResponse illustSearchResponse) {
                             return;
                         }
 
+                        ObjectPool.INSTANCE.updateIllust(illust);
+
                         if (illust.getId() == 0 || !illust.isVisible()) {
                             Common.showToast(R.string.string_206);
                             return;

File: app/src/main/java/ceui/lisa/fragments/FragmentSettings.java
Patch:
@@ -50,6 +50,7 @@
 import ceui.lisa.utils.PixivSearchParamUtil;
 import ceui.lisa.utils.Settings;
 import ceui.lisa.utils.UserFolderNameUtil;
+import ceui.loxia.Client;
 
 import static android.app.Activity.RESULT_OK;
 import static android.provider.DocumentsContract.EXTRA_INITIAL_URI;
@@ -170,6 +171,7 @@ public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
                     Local.setSettings(Shaft.sSettings);
                     if (changed) {
                         Retro.refreshAppApi();
+                        Client.INSTANCE.reset();
                     }
                 }
             });

File: app/src/main/java/ceui/lisa/activities/TemplateActivity.java
Patch:
@@ -145,8 +145,9 @@ protected Fragment createNewFragment() {
                 }
                 case "按标签收藏": {
                     int id = intent.getIntExtra(Params.ILLUST_ID, 0);
+                    String type = intent.getStringExtra(Params.DATA_TYPE);
                     String[] tagNames = intent.getStringArrayExtra(Params.TAG_NAMES);
-                    return FragmentSB.newInstance(id, tagNames);
+                    return FragmentSB.newInstance(id, type, tagNames);
                 }
                 case "关于软件":
                     return new FragmentAboutApp();

File: app/src/main/java/ceui/lisa/adapters/IAdapter.java
Patch:
@@ -99,6 +99,7 @@ public void onClick(View v) {
             public boolean onLongClick(View v) {
                 Intent intent = new Intent(mContext, TemplateActivity.class);
                 intent.putExtra(Params.ILLUST_ID, target.getId());
+                intent.putExtra(Params.DATA_TYPE, Params.TYPE_ILLUST);
                 intent.putExtra(Params.TAG_NAMES, target.getTagNames());
                 intent.putExtra(TemplateActivity.EXTRA_FRAGMENT, "按标签收藏");
                 mContext.startActivity(intent);

File: app/src/main/java/ceui/lisa/feature/worker/BatchStarTask.java
Patch:
@@ -32,7 +32,7 @@ public BatchStarTask(String name, int illustID, int starType) {
     @Override
     public void run(IEnd end) {
         if (starType == 0) {
-            Retro.getAppApi().postLike(Shaft.sUserModel.getAccess_token(), illustID, Params.TYPE_PUBLIC)
+            Retro.getAppApi().postLikeIllust(Shaft.sUserModel.getAccess_token(), illustID, Params.TYPE_PUBLIC)
                     .subscribeOn(Schedulers.newThread())
                     .observeOn(AndroidSchedulers.mainThread())
                     .subscribe(new ErrorCtrl<NullResponse>() {
@@ -50,7 +50,7 @@ public void must() {
                         }
                     });
         } else {
-            Retro.getAppApi().postDislike(sUserModel.getAccess_token(), illustID)
+            Retro.getAppApi().postDislikeIllust(sUserModel.getAccess_token(), illustID)
                     .subscribeOn(Schedulers.newThread())
                     .observeOn(AndroidSchedulers.mainThread())
                     .subscribe(new ErrorCtrl<NullResponse>() {

File: app/src/main/java/ceui/lisa/fragments/FragmentSingleIllust.java
Patch:
@@ -311,6 +311,7 @@ public void onClick(View v) {
             public boolean onLongClick(View v) {
                 Intent intent = new Intent(mContext, TemplateActivity.class);
                 intent.putExtra(Params.ILLUST_ID, illust.getId());
+                intent.putExtra(Params.DATA_TYPE, Params.TYPE_ILLUST);
                 intent.putExtra(Params.TAG_NAMES, illust.getTagNames());
                 intent.putExtra(Params.LAST_CLASS, getClass().getSimpleName());
                 intent.putExtra(TemplateActivity.EXTRA_FRAGMENT, "按标签收藏");

File: app/src/main/java/ceui/lisa/fragments/FragmentSingleUgora.java
Patch:
@@ -420,6 +420,7 @@ public void onClick(View v) {
             public boolean onLongClick(View v) {
                 Intent intent = new Intent(mContext, TemplateActivity.class);
                 intent.putExtra(Params.ILLUST_ID, illust.getId());
+                intent.putExtra(Params.DATA_TYPE, Params.TYPE_ILLUST);
                 intent.putExtra(Params.TAG_NAMES, illust.getTagNames());
                 intent.putExtra(Params.LAST_CLASS, getClass().getSimpleName());
                 intent.putExtra(TemplateActivity.EXTRA_FRAGMENT, "按标签收藏");

File: app/src/main/java/ceui/lisa/utils/PixivOperate.java
Patch:
@@ -153,7 +153,7 @@ public static void postLike(IllustsBean illustsBean, String starType, boolean sh
 
         if (illustsBean.isIs_bookmarked()) { //已收藏
             illustsBean.setIs_bookmarked(false);
-            Retro.getAppApi().postDislike(sUserModel.getAccess_token(), illustsBean.getId())
+            Retro.getAppApi().postDislikeIllust(sUserModel.getAccess_token(), illustsBean.getId())
                     .subscribeOn(Schedulers.newThread())
                     .observeOn(AndroidSchedulers.mainThread())
                     .subscribe(new ErrorCtrl<NullResponse>() {
@@ -169,7 +169,7 @@ public void next(NullResponse nullResponse) {
                     });
         } else { //没有收藏
             illustsBean.setIs_bookmarked(true);
-            Retro.getAppApi().postLike(sUserModel.getAccess_token(), illustsBean.getId(), starType)
+            Retro.getAppApi().postLikeIllust(sUserModel.getAccess_token(), illustsBean.getId(), starType)
                     .subscribeOn(Schedulers.newThread())
                     .observeOn(AndroidSchedulers.mainThread())
                     .subscribe(new ErrorCtrl<NullResponse>() {

File: app/src/main/java/ceui/lisa/adapters/IAdapter.java
Patch:
@@ -13,6 +13,7 @@
 
 import com.bumptech.glide.Glide;
 import com.bumptech.glide.RequestBuilder;
+import com.bumptech.glide.load.model.GlideUrl;
 import com.bumptech.glide.load.resource.drawable.DrawableTransitionOptions;
 import com.bumptech.glide.request.target.Target;
 import com.qmuiteam.qmui.util.QMUIDisplayHelper;
@@ -105,8 +106,9 @@ public boolean onLongClick(View v) {
             }
         });
 
+        GlideUrl imgUrl = Shaft.sSettings.isShowLargeThumbnailImage() ? GlideUtil.getLargeImage(target) : GlideUtil.getMediumImg(target);
         RequestBuilder<Drawable> requestBuilder = Glide.with(mContext)
-                .load(GlideUtil.getMediumImg(target));
+                .load(imgUrl);
         if (ratio == MIN_HEIGHT_RATIO || ratio == MAX_HEIGHT_RATIO) {
             requestBuilder
                     .override(Target.SIZE_ORIGINAL, Target.SIZE_ORIGINAL)

File: app/src/main/java/ceui/lisa/adapters/NAdapter.java
Patch:
@@ -161,7 +161,7 @@ public void onItemClick(View v, int position, int viewType) {
                             Params.TYPE_PUBLIC, v);
                 } else if (viewType == 2) {
                     Intent intent = new Intent(mContext, TemplateActivity.class);
-                    intent.putExtra(Params.URL, allItems.get(position).getImage_urls().getMaxImage());
+                    intent.putExtra(Params.URL, GlideUtil.getUrl(allItems.get(position).getImage_urls().getMaxImage()).toStringUrl());
                     intent.putExtra(TemplateActivity.EXTRA_FRAGMENT, "图片详情");
                     mContext.startActivity(intent);
                 } else if (viewType == 3) {

File: app/src/main/java/ceui/lisa/dialogs/MuteDialog.java
Patch:
@@ -16,7 +16,7 @@
 import ceui.lisa.R;
 import ceui.lisa.activities.TemplateActivity;
 import ceui.lisa.databinding.DialogMuteTagBinding;
-import ceui.lisa.helper.IllustFilter;
+import ceui.lisa.helper.IllustNovelFilter;
 import ceui.lisa.models.IllustsBean;
 import ceui.lisa.models.TagsBean;
 import ceui.lisa.utils.Common;
@@ -45,7 +45,7 @@ void initLayout() {
     @Override
     void initView(View v) {
         // 计算 tag 状态
-        List<TagsBean> muted = IllustFilter.getMutedTags();
+        List<TagsBean> muted = IllustNovelFilter.getMutedTags();
         List<TagsBean> illustTags = mIllust.getTags();
         Set<Integer> selectedIndex = new HashSet<>();
         for (int i = 0; i < illustTags.size(); i++) {

File: app/src/main/java/ceui/lisa/download/FileCreator.java
Patch:
@@ -21,9 +21,8 @@ public class FileCreator {
 
     public static boolean isExist(IllustsBean illust, int index) {
         String fileName = illust.isGif() ? new FileName().gifName(illust) : customFileName(illust, index);
-        File file = new File(FileStorageHelper.getIllustAbsolutePath(illust, false), fileName);
-        File fileR18 = new File(FileStorageHelper.getIllustAbsolutePath(illust, true), fileName);
-        return file.exists() || fileR18.exists();
+        File file = new File(FileStorageHelper.getIllustAbsolutePath(illust), fileName);
+        return file.exists();
     }
 
     public static String deleteSpecialWords(String before) {

File: app/src/main/java/ceui/lisa/fragments/FragmentComment.java
Patch:
@@ -94,7 +94,7 @@ public void onStart() {
         super.onStart();
         if (mHelper == null) {
             mHelper = new PanelSwitchHelper.Builder(this)
-                    .contentCanScrollOutside(false)    //可选模式，默认true，当面板实现时内容区域是否往上滑动
+                    .contentScrollOutsideEnable(false)    //可选模式，默认true，当面板实现时内容区域是否往上滑动
                     .logTrack(true)
                     //可选，默认false，是否开启log信息输出
                     .build(false);              //可选，默认false，是否默认打开输入法

File: app/src/main/java/ceui/lisa/fragments/FragmentMutedObjects.java
Patch:
@@ -19,7 +19,7 @@
 import ceui.lisa.database.MuteEntity;
 import ceui.lisa.databinding.FragmentBaseListBinding;
 import ceui.lisa.databinding.RecyViewHistoryBinding;
-import ceui.lisa.helper.IllustFilter;
+import ceui.lisa.helper.IllustNovelFilter;
 import ceui.lisa.interfaces.OnItemClickListener;
 import ceui.lisa.utils.Common;
 
@@ -31,7 +31,7 @@ public LocalRepo<List<MuteEntity>> repository() {
         return new LocalRepo<List<MuteEntity>>() {
             @Override
             public List<MuteEntity> first() {
-                return IllustFilter.getMutedWorks();
+                return IllustNovelFilter.getMutedWorks();
             }
 
             @Override

File: app/src/main/java/ceui/lisa/fragments/FragmentMutedTags.java
Patch:
@@ -21,7 +21,7 @@
 import ceui.lisa.core.LocalRepo;
 import ceui.lisa.database.AppDatabase;
 import ceui.lisa.databinding.FragmentBaseListBinding;
-import ceui.lisa.helper.IllustFilter;
+import ceui.lisa.helper.IllustNovelFilter;
 import ceui.lisa.interfaces.OnItemClickListener;
 import ceui.lisa.models.TagsBean;
 import ceui.lisa.utils.Common;
@@ -35,7 +35,7 @@ public LocalRepo<List<TagsBean>> repository() {
         return new LocalRepo<List<TagsBean>>() {
             @Override
             public List<TagsBean> first() {
-                return IllustFilter.getMutedTags();
+                return IllustNovelFilter.getMutedTags();
             }
 
             @Override

File: app/src/main/java/ceui/lisa/fragments/FragmentNovelSeriesDetail.java
Patch:
@@ -86,7 +86,7 @@ public void success(NovelDetail novelDetail) {
                     String lineSeparator = System.lineSeparator();
                     for (NovelBean novelBean : allItems) {
                         if (novelBean.isLocalSaved()) {
-                            String sb = lineSeparator + novelBean.getId() + "-" + novelBean.getTitle() + lineSeparator +
+                            String sb = lineSeparator + novelBean.getTitle() + " - " + novelBean.getId() + lineSeparator +
                                     Cache.get().getModel(Params.NOVEL_KEY + novelBean.getId(), NovelDetail.class).getNovel_text();
                             taskContainer.put(novelBean.getId(), sb);
                             if (taskContainer.size() == allItems.size()) {
@@ -101,7 +101,7 @@ public void success(NovelDetail novelDetail) {
 
                                         @Override
                                         public void success(NovelDetail novelDetail) {
-                                            String sb = lineSeparator + novelBean.getId() + "-" + novelBean.getTitle() + lineSeparator +
+                                            String sb = lineSeparator + novelBean.getTitle() + " - " + novelBean.getId() + lineSeparator +
                                                     novelDetail.getNovel_text();
                                             taskContainer.put(novelBean.getId(), sb);
                                             if (taskContainer.size() == allItems.size()) {

File: app/src/main/java/ceui/lisa/fragments/FragmentRecmdIllust.java
Patch:
@@ -26,7 +26,7 @@
 import ceui.lisa.database.IllustRecmdEntity;
 import ceui.lisa.databinding.FragmentBaseListBinding;
 import ceui.lisa.databinding.RecyIllustStaggerBinding;
-import ceui.lisa.helper.IllustFilter;
+import ceui.lisa.helper.IllustNovelFilter;
 import ceui.lisa.helper.StaggeredManager;
 import ceui.lisa.http.NullCtrl;
 import ceui.lisa.model.ListIllust;
@@ -204,7 +204,7 @@ public List<IllustsBean> execute() throws Exception {
                 for (int i = 0; i < localData.size(); i++) {
                     IllustsBean illustsBean = Shaft.sGson.fromJson(
                             localData.get(i).getIllustJson(), IllustsBean.class);
-                    if (!IllustFilter.judge(illustsBean)) {
+                    if (!IllustNovelFilter.judge(illustsBean)) {
                         temp.add(illustsBean);
                     }
                 }

File: app/src/main/java/ceui/lisa/http/Ascii2DApi.java
Patch:
@@ -4,12 +4,14 @@
 import okhttp3.MultipartBody;
 import okhttp3.ResponseBody;
 import retrofit2.Response;
+import retrofit2.http.Headers;
 import retrofit2.http.Multipart;
 import retrofit2.http.POST;
 import retrofit2.http.Part;
 
 public interface Ascii2DApi {
     @Multipart
     @POST("/search/file")
+    @Headers("User-Agent: RetrofitClient")
     Observable<Response<ResponseBody>> query(@Part MultipartBody.Part part);
 }

File: app/src/main/java/ceui/lisa/adapters/IllustAdapter.java
Patch:
@@ -131,7 +131,8 @@ public void onClick(View v) {
             }
         });
         final String imageUrl;
-        if (Shaft.sSettings.isShowOriginalPreviewImage() || isForceOriginal) {
+        boolean isLoadOriginalImage = Shaft.sSettings.isShowOriginalPreviewImage() || isForceOriginal;
+        if (isLoadOriginalImage) {
             imageUrl = IllustDownload.getUrl(allIllust, position, Params.IMAGE_RESOLUTION_ORIGINAL);
         } else {
             imageUrl = IllustDownload.getUrl(allIllust, position, Params.IMAGE_RESOLUTION_LARGE);
@@ -170,7 +171,7 @@ public boolean onLoadFailed(@Nullable GlideException e, Object model, Target<Bit
                     public boolean onResourceReady(Bitmap resource, Object model, Target<Bitmap> target, DataSource dataSource, boolean isFirstResource) {
                         holder.baseBind.reload.setVisibility(View.GONE);
                         holder.baseBind.progressLayout.donutProgress.setVisibility(View.INVISIBLE);
-                        if (isForceOriginal) {
+                        if (isLoadOriginalImage) {
                             Shaft.getMMKV().encode(imageUrl, true);
                         }
                         return false;

File: app/src/main/java/ceui/lisa/fragments/FragmentHotTag.java
Patch:
@@ -68,7 +68,7 @@ public BaseAdapter<ListTrendingtag.TrendTagsBean, RecyTagGridBinding> adapter()
             public void onItemClick(View v, int position, int viewType) {
                 Intent intent = new Intent(mContext, SearchActivity.class);
                 intent.putExtra(Params.KEY_WORD, allItems.get(position).getTag());
-                intent.putExtra(Params.INDEX, Params.TYPE_ILLUST.equals(contentType) ? 0 : 2);
+                intent.putExtra(Params.INDEX, Params.TYPE_ILLUST.equals(contentType) ? 0 : 1);
                 startActivity(intent);
             }
         });

File: app/src/main/java/ceui/lisa/fragments/FragmentSingleUgora.java
Patch:
@@ -319,6 +319,7 @@ public void onClick(View view) {
         });
 
         baseBind.toolbar.inflateMenu(R.menu.share);
+        baseBind.toolbar.getMenu().findItem(R.id.action_show_original).setVisible(false);
         baseBind.toolbar.setOnMenuItemClickListener(new Toolbar.OnMenuItemClickListener() {
             @Override
             public boolean onMenuItemClick(MenuItem menuItem) {

File: app/src/main/java/ceui/lisa/adapters/DownloadingAdapter.java
Patch:
@@ -77,7 +77,7 @@ public void doSomething(Progress t) {
             @Override
             public void onClick(View v) {
                 if (target.isPaused()) {
-                    manager.startOne(mContext, target.getUuid());
+                    manager.startOne(target.getUuid());
                     bindView.baseBind.state.setText("未开始");
                 } else {
                     manager.stopOne(target.getUuid());

File: app/src/main/java/ceui/lisa/adapters/CommentAdapter.java
Patch:
@@ -48,7 +48,7 @@ public void bindData(ReplyCommentBean target, ViewHolder<RecyCommentListBinding>
 
         if (allItems.get(position).getParent_comment() != null &&
                 allItems.get(position).getParent_comment().getUser() != null) {
-            bindView.baseBind.replyComment.setVisibility(View.VISIBLE);
+            bindView.baseBind.replyContent.setVisibility(View.VISIBLE);
 
             ClickableSpan clickableSpan = new ClickableSpan() {
                 @Override
@@ -82,7 +82,7 @@ public void updateDrawState(TextPaint ds) {
             bindView.baseBind.replyContent.setMovementMethod(LinkMovementMethod.getInstance());
             bindView.baseBind.replyContent.setText(spannableString);
         } else {
-            bindView.baseBind.replyComment.setVisibility(View.GONE);
+            bindView.baseBind.replyContent.setVisibility(View.GONE);
         }
 
 

File: app/src/main/java/ceui/lisa/feature/HostManager.java
Patch:
@@ -16,7 +16,7 @@ public class HostManager {
 
     public static final String HOST_OLD = "i.pximg.net";
 //    public static final String HOST_OLD = "app-api.pixiv.net";
-    public static final String HOST_NEW = "i.pixiv.cat";
+    public static final String HOST_NEW = "i.pixiv.re";
     private static final String HTTP_HEAD = "http://";
     private PKCEItem pkceItem;
 

File: app/src/main/java/ceui/lisa/adapters/NAdapter.java
Patch:
@@ -90,7 +90,7 @@ public View getView(FlowLayout parent, int position, TagsBean s) {
             public boolean onTagClick(View view, int position, FlowLayout parent) {
                 Intent intent = new Intent(mContext, SearchActivity.class);
                 intent.putExtra(Params.KEY_WORD, target.getTags().get(position).getName());
-                intent.putExtra(Params.INDEX, 2);
+                intent.putExtra(Params.INDEX, 1);
                 mContext.startActivity(intent);
                 return true;
             }

File: app/src/main/java/ceui/lisa/file/FileName.java
Patch:
@@ -1,5 +1,6 @@
 package ceui.lisa.file;
 
+import ceui.lisa.download.FileCreator;
 import ceui.lisa.models.IllustsBean;
 import ceui.lisa.utils.Common;
 
@@ -19,6 +20,6 @@ public String unzipName(IllustsBean illust) {
 
     @Override
     public String gifName(IllustsBean illust) {
-        return Common.removeFSReservedChars(illust.getTitle()) + DASH + illust.getId() + ".gif";
+        return FileCreator.customGifFileName(illust);
     }
 }

File: app/src/main/java/ceui/lisa/fragments/FragmentNovelHolder.java
Patch:
@@ -189,7 +189,7 @@ public View getView(FlowLayout parent, int position, TagsBean trendTagsBean) {
                 public boolean onTagClick(View view, int position, FlowLayout parent) {
                     Intent intent = new Intent(mContext, SearchActivity.class);
                     intent.putExtra(Params.KEY_WORD, mNovelBean.getTags().get(position).getName());
-                    intent.putExtra(Params.INDEX, 2);
+                    intent.putExtra(Params.INDEX, 1);
                     startActivity(intent);
                     return false;
                 }

File: app/src/main/java/ceui/lisa/fragments/FragmentNovelSeriesDetail.java
Patch:
@@ -143,6 +143,7 @@ public void onResponse(ListNovelOfSeries listNovelOfSeries) {
         try {
             baseBind.cardPixiv.setVisibility(View.VISIBLE);
             baseBind.seriesTitle.setText(String.format("系列名称：%s", listNovelOfSeries.getNovel_series_detail().getTitle()));
+            baseBind.seriesDescription.setHtml(listNovelOfSeries.getNovel_series_detail().getDisplay_text());
             //每分钟五百字
             float minute = listNovelOfSeries.getNovel_series_detail().getTotal_character_count() / 500.0f;
             baseBind.seriesDetail.setText(String.format(getString(R.string.how_many_novels),

File: app/src/main/java/ceui/lisa/fragments/FragmentSingleUgora.java
Patch:
@@ -353,7 +353,8 @@ public void onPrepare() {
                     PixivOperate.postLikeDefaultStarType(illust);
                 }
             } else {
-                Common.showToast("请先播放后下载");
+                IllustDownload.downloadGif(illust);
+                Common.showToast("已经加入下载队列");
             }
         });
         baseBind.userName.setOnLongClickListener(new View.OnLongClickListener() {

File: app/src/main/java/ceui/lisa/adapters/NAdapter.java
Patch:
@@ -97,6 +97,7 @@ public boolean onTagClick(View view, int position, FlowLayout parent) {
         });
         bindView.baseBind.author.setText(target.getUser().getName());
         bindView.baseBind.howManyWord.setText(String.format(Locale.getDefault(), "%d字", target.getText_length()));
+        bindView.baseBind.bookmarkCount.setText(String.valueOf(target.getTotal_bookmarks()));
         Glide.with(mContext).load(GlideUtil.getUrl(target.getImage_urls().getMaxImage())).into(bindView.baseBind.cover);
         Glide.with(mContext).load(GlideUtil.getHead(target.getUser())).into(bindView.baseBind.userHead);
         if (target.isIs_bookmarked()) {

File: app/src/main/java/ceui/lisa/fragments/FragmentIllust.java
Patch:
@@ -356,7 +356,7 @@ public void onClick(View v) {
                 IllustDownload.downloadIllustAllPages(illust, (BaseActivity<?>) mContext);
             }
             checkDownload();
-            if(Shaft.sSettings.isAutoPostLikeWhenDownload() && !illust.isIs_bookmarked()){
+            if (Shaft.sSettings.isAutoPostLikeWhenDownload() && !illust.isIs_bookmarked()) {
                 PixivOperate.postLikeDefaultStarType(illust);
             }
         });

File: app/src/main/java/ceui/lisa/fragments/FragmentSingleIllust.java
Patch:
@@ -104,8 +104,7 @@ private void loadImage() {
                 break;
         }
 
-
-        mDetailAdapter = new IllustDetailAdapter(illust, mContext);
+        mDetailAdapter = new IllustDetailAdapter(FragmentSingleIllust.this, illust);
         baseBind.recyclerView.setAdapter(mDetailAdapter);
     }
 

File: app/src/main/java/ceui/lisa/helper/CommentFilter.java
Patch:
@@ -13,7 +13,7 @@
 import ceui.lisa.activities.Shaft;
 import ceui.lisa.http.NullCtrl;
 import ceui.lisa.http.Retro;
-import ceui.lisa.models.CommentsBean;
+import ceui.lisa.models.ReplyCommentBean;
 import io.reactivex.android.schedulers.AndroidSchedulers;
 import io.reactivex.schedulers.Schedulers;
 import okhttp3.ResponseBody;
@@ -26,7 +26,7 @@ public class CommentFilter {
         updateRules();
     }
 
-    public static boolean judge(CommentsBean commentsBean) {
+    public static boolean judge(ReplyCommentBean commentsBean) {
         return rules.stream()
                 .anyMatch(rule -> rule.judge(commentsBean.getComment()) ||
                         ((commentsBean.getParent_comment().getId() > 0) && rule.judge(commentsBean.getParent_comment().getComment()))

File: app/src/main/java/ceui/lisa/standard/test/CommentRepository.java
Patch:
@@ -1,14 +1,14 @@
 package ceui.lisa.standard.test;
 
 import ceui.lisa.interfaces.ListShow;
-import ceui.lisa.models.CommentsBean;
+import ceui.lisa.models.ReplyCommentBean;
 import ceui.lisa.standard.Repository;
 import io.reactivex.Observable;
 
-public class CommentRepository extends Repository<CommentsBean> {
+public class CommentRepository extends Repository<ReplyCommentBean> {
 
     @Override
-    public Observable<ListShow<CommentsBean>> initApi() {
+    public Observable<ListShow<ReplyCommentBean>> initApi() {
         return null;
     }
 }

File: app/src/main/java/ceui/lisa/standard/test/CommentViewModel.java
Patch:
@@ -1,13 +1,13 @@
 package ceui.lisa.standard.test;
 
-import ceui.lisa.models.CommentsBean;
+import ceui.lisa.models.ReplyCommentBean;
 import ceui.lisa.standard.ListViewModel;
 import ceui.lisa.standard.Repository;
 
-public class CommentViewModel extends ListViewModel<CommentsBean> {
+public class CommentViewModel extends ListViewModel<ReplyCommentBean> {
 
     @Override
-    public Repository<CommentsBean> initRepository() {
+    public Repository<ReplyCommentBean> initRepository() {
         return null;
     }
 }

File: models/src/main/java/ceui/lisa/models/CommentHolder.java
Patch:
@@ -2,13 +2,13 @@
 
 public class CommentHolder {
 
-    private CommentsBean comment;
+    private ReplyCommentBean comment;
 
-    public CommentsBean getComment() {
+    public ReplyCommentBean getComment() {
         return comment;
     }
 
-    public void setComment(CommentsBean comment) {
+    public void setComment(ReplyCommentBean comment) {
         this.comment = comment;
     }
 }

File: app/src/main/java/ceui/lisa/notification/RecommendAppWidgetProvider.java
Patch:
@@ -24,6 +24,7 @@
 import java.util.Collections;
 import java.util.List;
 import java.util.Random;
+import java.util.stream.Collectors;
 
 import androidx.annotation.Nullable;
 import androidx.core.app.NotificationCompat;
@@ -134,7 +135,7 @@ public int onStartCommand(Intent intent, int flags, int startId) {
                         @Override
                         public void success(ListIllust listIllust) {
                             items.clear();
-                            items.addAll(listIllust.getList());
+                            items.addAll(listIllust.getList().stream().filter(it -> !it.isR18File()).collect(Collectors.toList()));
                             Collections.shuffle(items);
 
                             AppWidgetManager manager = AppWidgetManager.getInstance(RecommendAppWidgetService.this);

File: app/src/main/java/ceui/lisa/core/Manager.java
Patch:
@@ -130,7 +130,9 @@ public void startAll() {
         if (!Common.isEmpty(content)) {
             for (DownloadItem item : content) {
                 //item.setProcessed(false);
-                item.setState(DownloadItem.DownloadState.INIT);
+                if (item.getState() != DownloadItem.DownloadState.PAUSED) {
+                    item.setState(DownloadItem.DownloadState.INIT);
+                }
                 item.setPaused(false);
             }
         }

File: app/src/main/java/ceui/lisa/http/ResourceApi.java
Patch:
@@ -7,10 +7,11 @@
 
 public interface ResourceApi {
     String JSDELIVR_BASE_URL = "https://cdn.jsdelivr.net/";
+    String JSDELIVR_PROJECT_MASTER_PATH = "gh/CeuiLiSA/Pixiv-Shaft@master/";
 
     @GET("gh/CeuiLiSA/Pixiv-Shaft@master/app/src/main/assets/comment.filter.rule.txt")
     Observable<ResponseBody> getCommentFilterRule();
 
-    @GET("gh/CeuiLiSA/Pixiv-Shaft@master/{path}")
+    @GET(JSDELIVR_PROJECT_MASTER_PATH + "{path}")
     Observable<ResponseBody> getByPath(@Path("path") String path);
 }

File: app/src/main/java/ceui/lisa/fragments/FragmentSearchNovel.java
Patch:
@@ -93,7 +93,8 @@ public BaseRepo repository() {
                 searchModel.getStarSize().getValue(),
                 searchModel.getIsPremium().getValue(),
                 searchModel.getStartDate().getValue(),
-                searchModel.getEndDate().getValue()
+                searchModel.getEndDate().getValue(),
+                searchModel.getR18Restriction().getValue()
         );
     }
 

File: app/src/main/java/ceui/lisa/fragments/NetListFragment.java
Patch:
@@ -24,6 +24,7 @@
 import ceui.lisa.adapters.NAdapter;
 import ceui.lisa.adapters.SimpleUserAdapter;
 import ceui.lisa.adapters.UAdapter;
+import ceui.lisa.adapters.UserHAdapter;
 import ceui.lisa.core.Container;
 import ceui.lisa.core.PageData;
 import ceui.lisa.core.RemoteRepo;
@@ -207,7 +208,7 @@ public void onAdapterPrepared() {
                 addPageLoadReceiver();
                 addPageScrollReceiver();
             }
-        } else if (mAdapter instanceof UAdapter || mAdapter instanceof SimpleUserAdapter) {
+        } else if (mAdapter instanceof UAdapter || mAdapter instanceof UserHAdapter || mAdapter instanceof SimpleUserAdapter) {
             IntentFilter intentFilter = new IntentFilter();
             mReceiver = new CommonReceiver((BaseAdapter<Starable, ?>) mAdapter);
             intentFilter.addAction(Params.LIKED_USER);

File: app/src/main/java/ceui/lisa/activities/RankActivity.java
Patch:
@@ -156,14 +156,14 @@ public boolean onOptionsItemSelected(MenuItem item) {
                         RankActivity.this,
                         Integer.parseInt(t[0]), // Initial year selection
                         Integer.parseInt(t[1]) - 1, // Initial month selection
-                        Integer.parseInt(t[2]) // Inital day selection
+                        Integer.parseInt(t[2]) // Initial day selection
                 );
             } else {
                 dpd = DatePickerDialog.newInstance(
                         RankActivity.this,
                         now.get(Calendar.YEAR), // Initial year selection
                         now.get(Calendar.MONTH), // Initial month selection
-                        now.get(Calendar.DAY_OF_MONTH) // Inital day selection
+                        now.get(Calendar.DAY_OF_MONTH) // Initial day selection
                 );
             }
             Calendar start = Calendar.getInstance();

File: app/src/main/java/ceui/lisa/activities/UActivity.java
Patch:
@@ -157,7 +157,7 @@ public void onClick(View v) {
                         PixivOperate.postUnFollowUser(data.getUser().getId());
                         data.getUser().setIs_followed(false);
                     } else {
-                        PixivOperate.postFollowUser(data.getUser().getId(), Params.TYPE_PUBLUC);
+                        PixivOperate.postFollowUser(data.getUser().getId(), Params.TYPE_PUBLIC);
                         data.getUser().setIs_followed(true);
                     }
                 }

File: app/src/main/java/ceui/lisa/activities/UserActivity.java
Patch:
@@ -190,7 +190,7 @@ public void onClick(View v) {
                         baseBind.send.setImageResource(R.drawable.ic_favorite_accent_24dp);
                         currentUser.getUser().setIs_followed(true);
                         PixivOperate.postFollowUser(currentUser.getUser().getId(),
-                                Params.TYPE_PUBLUC);
+                                Params.TYPE_PUBLIC);
                     }
                 }
             });

File: app/src/main/java/ceui/lisa/adapters/IAdapter.java
Patch:
@@ -89,7 +89,7 @@ public void onClick(View v) {
                 if (Shaft.sSettings.isPrivateStar()) {
                     PixivOperate.postLike(target, Params.TYPE_PRIVATE, showRelated, (position + 2));
                 } else {
-                    PixivOperate.postLike(target, Params.TYPE_PUBLUC, showRelated, (position + 2));
+                    PixivOperate.postLike(target, Params.TYPE_PUBLIC, showRelated, (position + 2));
                 }
             }
         });

File: app/src/main/java/ceui/lisa/adapters/MultiDownloadAdapter.java
Patch:
@@ -21,12 +21,12 @@
 import ceui.lisa.utils.GlideUtil;
 import ceui.lisa.utils.Params;
 
-public class MultiDownldAdapter extends BaseAdapter<IllustsBean, RecyMultiDownloadBinding> implements MultiDownload {
+public class MultiDownloadAdapter extends BaseAdapter<IllustsBean, RecyMultiDownloadBinding> implements MultiDownload {
 
     private int imageSize = 0;
     private Callback mCallback;
 
-    public MultiDownldAdapter(List<IllustsBean> targetList, Context context) {
+    public MultiDownloadAdapter(List<IllustsBean> targetList, Context context) {
         super(targetList, context);
         imageSize = (mContext.getResources().getDisplayMetrics().widthPixels -
                 mContext.getResources().getDimensionPixelSize(R.dimen.two_dp)) / 3;

File: app/src/main/java/ceui/lisa/adapters/NAdapter.java
Patch:
@@ -157,7 +157,7 @@ public void onItemClick(View v, int position, int viewType) {
                     mContext.startActivity(intent);
                 } else if (viewType == 1) {
                     PixivOperate.postLikeNovel(allItems.get(position), Shaft.sUserModel,
-                            Params.TYPE_PUBLUC, v);
+                            Params.TYPE_PUBLIC, v);
                 } else if (viewType == 2) {
                     Intent intent = new Intent(mContext, TemplateActivity.class);
                     intent.putExtra(Params.URL, allItems.get(position).getImage_urls().getMaxImage());

File: app/src/main/java/ceui/lisa/adapters/SimpleUserAdapter.java
Patch:
@@ -93,7 +93,7 @@ public void onItemClick(View v, int position, int viewType) {
                         postFollow.setText(mContext.getString(R.string.post_follow));
                     } else {
                         PixivOperate.postFollowUser(allItems.get(position).getId(),
-                                Params.TYPE_PUBLUC);
+                                Params.TYPE_PUBLIC);
                         allItems.get(position).setIs_followed(true);
                         Button postFollow = ((Button) v);
                         postFollow.setText(mContext.getString(R.string.post_unfollow));

File: app/src/main/java/ceui/lisa/adapters/UAdapter.java
Patch:
@@ -112,7 +112,7 @@ public void onItemClick(View v, int position, int viewType) {
                         allItems.get(position).getUser().setIs_followed(false);
                         postFollow.setText(mContext.getString(R.string.post_follow));
                     } else {
-                        PixivOperate.postFollowUser(allItems.get(position).getUser().getId(), Params.TYPE_PUBLUC);
+                        PixivOperate.postFollowUser(allItems.get(position).getUser().getId(), Params.TYPE_PUBLIC);
                         allItems.get(position).getUser().setIs_followed(true);
                         Button postFollow = ((Button) v);
                         postFollow.setText(mContext.getString(R.string.post_unfollow));

File: app/src/main/java/ceui/lisa/core/Manager.java
Patch:
@@ -283,7 +283,7 @@ public void run() throws Throwable {
 
                     if(downloadItem.getIllust().isGif()){
                         Shaft.getMMKV().encode(Params.ILLUST_ID + "_" + downloadItem.getIllust().getId(), true);
-                        PixivOperate.unzipAndePlay(context, downloadItem.getIllust(), downloadItem.isAutoSave());
+                        PixivOperate.unzipAndPlay(context, downloadItem.getIllust(), downloadItem.isAutoSave());
                     }
 
                     //通知 DOWNLOAD_ING 下载完成

File: app/src/main/java/ceui/lisa/download/FileSizeUtil.java
Patch:
@@ -31,7 +31,7 @@ public static double getFileOrFilesSize(String filePath, int sizeType) {
         } catch (Exception e) {
             e.printStackTrace();
         }
-        return FormetFileSize(blockSize, sizeType);
+        return FormatFileSize(blockSize, sizeType);
     }
 
     public static double getFileOrFilesSize(File file, int sizeType) {
@@ -45,7 +45,7 @@ public static double getFileOrFilesSize(File file, int sizeType) {
         } catch (Exception e) {
             e.printStackTrace();
         }
-        return FormetFileSize(blockSize, sizeType);
+        return FormatFileSize(blockSize, sizeType);
     }
 
     /**
@@ -126,7 +126,7 @@ public static String formatFileSize(long fileS) {
     /**
      * 转换文件大小,指定转换的类型
      */
-    private static double FormetFileSize(long fileS, int sizeType) {
+    private static double FormatFileSize(long fileS, int sizeType) {
         DecimalFormat df = new DecimalFormat("#.00");
         double fileSizeLong = 0;
         switch (sizeType) {

File: app/src/main/java/ceui/lisa/feature/HostManager.java
Patch:
@@ -126,7 +126,7 @@ public PKCEItem getPkce() {
         if (pkceItem == null) {
             try {
                 final String verify = PkceUtil.generateCodeVerifier();
-                final String challenge = PkceUtil.generateCodeChallange(verify);
+                final String challenge = PkceUtil.generateCodeChallenge(verify);
                 pkceItem = new PKCEItem(verify, challenge);
             } catch (Exception e) {
                 e.printStackTrace();

File: app/src/main/java/ceui/lisa/feature/PkceUtil.java
Patch:
@@ -17,7 +17,7 @@ public static String generateCodeVerifier() throws UnsupportedEncodingException
         return Base64.encodeToString(codeVerifier, Base64.URL_SAFE | Base64.NO_WRAP | Base64.NO_PADDING);
     }
 
-    public static String generateCodeChallange(String codeVerifier) throws UnsupportedEncodingException, NoSuchAlgorithmException {
+    public static String generateCodeChallenge(String codeVerifier) throws UnsupportedEncodingException, NoSuchAlgorithmException {
         byte[] bytes = codeVerifier.getBytes(StandardCharsets.US_ASCII);
         MessageDigest messageDigest = MessageDigest.getInstance("SHA-256");
         messageDigest.update(bytes, 0, bytes.length);

File: app/src/main/java/ceui/lisa/feature/worker/BatchFollowTask.java
Patch:
@@ -33,7 +33,7 @@ public BatchFollowTask(String name, int userID, int starType) {
     public void run(IEnd end) {
         if (starType == 0) {
             Retro.getAppApi().postFollow(
-                    sUserModel.getAccess_token(), userID, Params.TYPE_PUBLUC)
+                    sUserModel.getAccess_token(), userID, Params.TYPE_PUBLIC)
                     .subscribeOn(Schedulers.newThread())
                     .observeOn(AndroidSchedulers.mainThread())
                     .subscribe(new ErrorCtrl<NullResponse>() {

File: app/src/main/java/ceui/lisa/feature/worker/BatchStarTask.java
Patch:
@@ -32,7 +32,7 @@ public BatchStarTask(String name, int illustID, int starType) {
     @Override
     public void run(IEnd end) {
         if (starType == 0) {
-            Retro.getAppApi().postLike(Shaft.sUserModel.getAccess_token(), illustID, Params.TYPE_PUBLUC)
+            Retro.getAppApi().postLike(Shaft.sUserModel.getAccess_token(), illustID, Params.TYPE_PUBLIC)
                     .subscribeOn(Schedulers.newThread())
                     .observeOn(AndroidSchedulers.mainThread())
                     .subscribe(new ErrorCtrl<NullResponse>() {

File: app/src/main/java/ceui/lisa/fragments/FragmentEditFile.java
Patch:
@@ -327,14 +327,14 @@ public void onClick(View v) {
                                             FragmentEditFile.this,
                                             Integer.parseInt(t[0]), // Initial year selection
                                             Integer.parseInt(t[1]) - 1, // Initial month selection
-                                            Integer.parseInt(t[2]) // Inital day selection
+                                            Integer.parseInt(t[2]) // Initial day selection
                                     );
                                 } else {
                                     dpd = DatePickerDialog.newInstance(
                                             FragmentEditFile.this,
                                             now.get(Calendar.YEAR) - 18, // Initial year selection
                                             0, // Initial month selection
-                                            1 // Inital day selection
+                                            1 // Initial day selection
                                     );
                                 }
                                 start.set(now.get(Calendar.YEAR) - 100, 0, 1);

File: app/src/main/java/ceui/lisa/fragments/FragmentFilter.java
Patch:
@@ -204,14 +204,14 @@ public void onDateSet(DatePickerDialog view, int year, int monthOfYear, int dayO
                     listener,
                     Integer.parseInt(t[0]), // Initial year selection
                     Integer.parseInt(t[1]) - 1, // Initial month selection
-                    Integer.parseInt(t[2]) // Inital day selection
+                    Integer.parseInt(t[2]) // Initial day selection
             );
         } else {
             dpd = DatePickerDialog.newInstance(
                     listener,
                     now.get(Calendar.YEAR), // Initial year selection
                     now.get(Calendar.MONTH), // Initial month selection
-                    now.get(Calendar.DAY_OF_MONTH) // Inital day selection
+                    now.get(Calendar.DAY_OF_MONTH) // Initial day selection
             );
         }
         start.set(1970, 0, 1);

File: app/src/main/java/ceui/lisa/fragments/FragmentIllust.java
Patch:
@@ -327,7 +327,7 @@ public void onClick(View v) {
                     PixivOperate.postUnFollowUser(illust.getUser().getId());
                     illust.getUser().setIs_followed(false);
                 } else {
-                    PixivOperate.postFollowUser(illust.getUser().getId(), Params.TYPE_PUBLUC);
+                    PixivOperate.postFollowUser(illust.getUser().getId(), Params.TYPE_PUBLIC);
                     illust.getUser().setIs_followed(true);
                 }
             }

File: app/src/main/java/ceui/lisa/fragments/FragmentLikeIllustHorizontal.java
Patch:
@@ -134,7 +134,7 @@ protected void initData() {
         Observable<ListIllust> api = null;
         if (type == 1) {
             api = Retro.getAppApi().getUserLikeIllust(sUserModel.getAccess_token(),
-                    mUserDetailResponse.getUser().getId(), Params.TYPE_PUBLUC);
+                    mUserDetailResponse.getUser().getId(), Params.TYPE_PUBLIC);
         } else if (type == 2) {
             api = Retro.getAppApi().getUserSubmitIllust(sUserModel.getAccess_token(),
                     mUserDetailResponse.getUser().getId(), Params.TYPE_ILLUST);

File: app/src/main/java/ceui/lisa/fragments/FragmentLikeNovelHorizontal.java
Patch:
@@ -124,7 +124,7 @@ protected void initData() {
         Observable<ListNovel> mApi;
         if (type == 0) {
             mApi = Retro.getAppApi().getUserLikeNovel(sUserModel.getAccess_token(),
-                    userID, Params.TYPE_PUBLUC);
+                    userID, Params.TYPE_PUBLIC);
         } else {
             mApi = Retro.getAppApi().getUserSubmitNovel(sUserModel.getAccess_token(),
                     userID);

File: app/src/main/java/ceui/lisa/fragments/FragmentMultiDownload.java
Patch:
@@ -18,7 +18,7 @@
 import ceui.lisa.R;
 import ceui.lisa.activities.BaseActivity;
 import ceui.lisa.adapters.BaseAdapter;
-import ceui.lisa.adapters.MultiDownldAdapter;
+import ceui.lisa.adapters.MultiDownloadAdapter;
 import ceui.lisa.core.BaseRepo;
 import ceui.lisa.core.LocalRepo;
 import ceui.lisa.databinding.FragmentMultiDownloadBinding;
@@ -36,7 +36,7 @@
 import gdut.bsx.share2.Share2;
 import gdut.bsx.share2.ShareContentType;
 
-public class FragmentMultiDownld extends LocalListFragment<FragmentMultiDownloadBinding,
+public class FragmentMultiDownload extends LocalListFragment<FragmentMultiDownloadBinding,
         IllustsBean> {
 
     private DragSelectTouchListener dragSelectTouchListener;
@@ -177,7 +177,7 @@ public void setSelected(int i, boolean b) {
 
     @Override
     public BaseAdapter<IllustsBean, RecyMultiDownloadBinding> adapter() {
-        MultiDownldAdapter adapter = new MultiDownldAdapter(allItems, mContext);
+        MultiDownloadAdapter adapter = new MultiDownloadAdapter(allItems, mContext);
         adapter.setCallback(new Callback() {
             @Override
             public void doSomething(Object t) {

File: app/src/main/java/ceui/lisa/fragments/FragmentNovelHolder.java
Patch:
@@ -130,7 +130,7 @@ private void getNovel(NovelBean novelBean) {
             public void onClick(View v) {
                 Common.showLog(className + "getNovel 111");
                 PixivOperate.postLikeNovel(mNovelBean, Shaft.sUserModel,
-                        Params.TYPE_PUBLUC, baseBind.like);
+                        Params.TYPE_PUBLIC, baseBind.like);
             }
         });
 

File: app/src/main/java/ceui/lisa/fragments/FragmentNovelSeriesDetail.java
Patch:
@@ -189,7 +189,7 @@ public void onClick(View v) {
                     baseBind.postLikeUser.setText("取消关注");
                     userBean.setIs_followed(true);
                     PixivOperate.postFollowUser(userBean.getId(),
-                            Params.TYPE_PUBLUC);
+                            Params.TYPE_PUBLIC);
                 }
             }
         });

File: app/src/main/java/ceui/lisa/fragments/FragmentPivisionHorizontal.java
Patch:
@@ -65,7 +65,7 @@ public void initRecyclerView() {
         layoutParams.width = MATCH_PARENT;
         layoutParams.height =
                 mContext.getResources().getDimensionPixelSize(R.dimen.article_horizontal_height) +
-                mContext.getResources().getDimensionPixelSize(R.dimen.tweenty_four_dp);
+                mContext.getResources().getDimensionPixelSize(R.dimen.twenty_four_dp);
         baseBind.recyclerView.setLayoutParams(layoutParams);
     }
 

File: app/src/main/java/ceui/lisa/fragments/FragmentRight.java
Patch:
@@ -91,7 +91,7 @@ public boolean onMenuItemClick(MenuItem item) {
             startActivity(intent);
         });
         baseBind.glareLayout.setListener(new OnCheckChangeListener() {
-            final String[] types = {Params.TYPE_ALL, Params.TYPE_PUBLUC, Params.TYPE_PRIVATE};
+            final String[] types = {Params.TYPE_ALL, Params.TYPE_PUBLIC, Params.TYPE_PRIVATE};
             @Override
             public void onSelect(int index, View view) {
                 Common.showLog("glareLayout onSelect " + index);

File: app/src/main/java/ceui/lisa/fragments/FragmentSB.java
Patch:
@@ -96,7 +96,7 @@ private void submitStar() {
             boolean isPrivate = baseBind.isPrivate.isChecked();
             String toastMsg = isPrivate ? getString(R.string.like_novel_success_private) : getString(R.string.like_novel_success_public);
             Retro.getAppApi().postLike(Shaft.sUserModel.getAccess_token(), illustID,
-                    isPrivate ? Params.TYPE_PRIVATE : Params.TYPE_PUBLUC)
+                    isPrivate ? Params.TYPE_PRIVATE : Params.TYPE_PUBLIC)
                     .subscribeOn(Schedulers.newThread())
                     .observeOn(AndroidSchedulers.mainThread())
                     .subscribe(new ErrorCtrl<NullResponse>() {
@@ -113,7 +113,7 @@ public void next(NullResponse nullResponse) {
             tempList.toArray(strings);
 
             Retro.getAppApi().postLike(Shaft.sUserModel.getAccess_token(), illustID,
-                    isPrivate ? Params.TYPE_PRIVATE : Params.TYPE_PUBLUC, strings)
+                    isPrivate ? Params.TYPE_PRIVATE : Params.TYPE_PUBLIC, strings)
                     .subscribeOn(Schedulers.newThread())
                     .observeOn(AndroidSchedulers.mainThread())
                     .subscribe(new ErrorCtrl<NullResponse>() {

File: app/src/main/java/ceui/lisa/fragments/FragmentSingleIllust.java
Patch:
@@ -330,7 +330,7 @@ public void onClick(View v) {
                     PixivOperate.postUnFollowUser(illust.getUser().getId());
                     illust.getUser().setIs_followed(false);
                 } else {
-                    PixivOperate.postFollowUser(illust.getUser().getId(), Params.TYPE_PUBLUC);
+                    PixivOperate.postFollowUser(illust.getUser().getId(), Params.TYPE_PUBLIC);
                     illust.getUser().setIs_followed(true);
                 }
             }

File: app/src/main/java/ceui/lisa/fragments/FragmentSingleUgora.java
Patch:
@@ -232,7 +232,7 @@ public void invoke(float progress) {
             if (hasDownload && zipFile.exists() && zipFile.length() > 1024) {
                 baseBind.playGif.setVisibility(View.INVISIBLE);
                 baseBind.progressLayout.donutProgress.setVisibility(View.VISIBLE);
-                PixivOperate.unzipAndePlay(mContext, illust);
+                PixivOperate.unzipAndPlay(mContext, illust);
             } else {
                 Common.showToast("获取GIF信息");
                 baseBind.progress.setVisibility(View.VISIBLE);
@@ -445,7 +445,7 @@ public void onClick(View v) {
                     PixivOperate.postUnFollowUser(illust.getUser().getId());
                     illust.getUser().setIs_followed(false);
                 } else {
-                    PixivOperate.postFollowUser(illust.getUser().getId(), Params.TYPE_PUBLUC);
+                    PixivOperate.postFollowUser(illust.getUser().getId(), Params.TYPE_PUBLIC);
                     illust.getUser().setIs_followed(true);
                 }
             }

File: app/src/main/java/ceui/lisa/http/AppApi.java
Patch:
@@ -474,7 +474,7 @@ Observable<ListNovelOfSeries> getNextSeriesNovel(@Header("Authorization") String
                                                      @Url String next_url);
 
     @GET
-    Observable<ListArticle> getNextArticals(@Header("Authorization") String token,
+    Observable<ListArticle> getNextArticles(@Header("Authorization") String token,
                                             @Url String next_url);
 
 

File: app/src/main/java/ceui/lisa/http/SignApi.java
Patch:
@@ -48,7 +48,7 @@ Observable<AccountEditResponse> changePassword(@Header("Authorization") String t
                                                    @Field("new_password") String new_password);
 
     /**
-     * 改密码还改pixivid
+     * 改密码还改pixiv id
      *
      * @param token
      * @param new_user_account

File: app/src/main/java/ceui/lisa/utils/Params.java
Patch:
@@ -97,7 +97,7 @@ public class Params {
     public static final String URL_R18_SETTING  = "https://www.pixiv.net/settings.php?mode=age-check";
     public static final String URL_PREMIUM_SETTING  = "https://www.pixiv.net/premium.php#premium-payment";
 
-    public static final String TYPE_PUBLUC = "public";
+    public static final String TYPE_PUBLIC = "public";
     public static final String TYPE_PRIVATE = "private";
     public static final String TYPE_ALL = "all";
 

File: app/src/main/java/ceui/lisa/utils/Settings.java
Patch:
@@ -174,7 +174,7 @@ public void setCurrentProgress(long currentProgress) {
 
     private boolean r18FilterDefaultEnable = false; // 默认开启R18内容过滤
 
-    private transient boolean r18FilterTempEnableInited = false;
+    private transient boolean r18FilterTempEnableInitialed = false;
     private transient boolean r18FilterTempEnable = false; // 临时开启R18内容过滤
 
     private String searchDefaultSortType = ""; // 搜索结果默认排序方式
@@ -576,9 +576,9 @@ public void setR18FilterDefaultEnable(boolean r18FilterDefaultEnable) {
     }
 
     public boolean isR18FilterTempEnable() {
-        if (!r18FilterTempEnableInited) {
+        if (!r18FilterTempEnableInitialed) {
             r18FilterTempEnable = r18FilterDefaultEnable;
-            r18FilterTempEnableInited = true;
+            r18FilterTempEnableInitialed = true;
         }
         return r18FilterTempEnable;
     }

File: app/src/main/java/ceui/lisa/activities/RankActivity.java
Patch:
@@ -156,14 +156,14 @@ public boolean onOptionsItemSelected(MenuItem item) {
                         RankActivity.this,
                         Integer.parseInt(t[0]), // Initial year selection
                         Integer.parseInt(t[1]) - 1, // Initial month selection
-                        Integer.parseInt(t[2]) // Inital day selection
+                        Integer.parseInt(t[2]) // Initial day selection
                 );
             } else {
                 dpd = DatePickerDialog.newInstance(
                         RankActivity.this,
                         now.get(Calendar.YEAR), // Initial year selection
                         now.get(Calendar.MONTH), // Initial month selection
-                        now.get(Calendar.DAY_OF_MONTH) // Inital day selection
+                        now.get(Calendar.DAY_OF_MONTH) // Initial day selection
                 );
             }
             Calendar start = Calendar.getInstance();

File: app/src/main/java/ceui/lisa/activities/UActivity.java
Patch:
@@ -157,7 +157,7 @@ public void onClick(View v) {
                         PixivOperate.postUnFollowUser(data.getUser().getId());
                         data.getUser().setIs_followed(false);
                     } else {
-                        PixivOperate.postFollowUser(data.getUser().getId(), Params.TYPE_PUBLUC);
+                        PixivOperate.postFollowUser(data.getUser().getId(), Params.TYPE_PUBLIC);
                         data.getUser().setIs_followed(true);
                     }
                 }

File: app/src/main/java/ceui/lisa/activities/UserActivity.java
Patch:
@@ -190,7 +190,7 @@ public void onClick(View v) {
                         baseBind.send.setImageResource(R.drawable.ic_favorite_accent_24dp);
                         currentUser.getUser().setIs_followed(true);
                         PixivOperate.postFollowUser(currentUser.getUser().getId(),
-                                Params.TYPE_PUBLUC);
+                                Params.TYPE_PUBLIC);
                     }
                 }
             });

File: app/src/main/java/ceui/lisa/adapters/IAdapter.java
Patch:
@@ -89,7 +89,7 @@ public void onClick(View v) {
                 if (Shaft.sSettings.isPrivateStar()) {
                     PixivOperate.postLike(target, Params.TYPE_PRIVATE, showRelated, (position + 2));
                 } else {
-                    PixivOperate.postLike(target, Params.TYPE_PUBLUC, showRelated, (position + 2));
+                    PixivOperate.postLike(target, Params.TYPE_PUBLIC, showRelated, (position + 2));
                 }
             }
         });

File: app/src/main/java/ceui/lisa/adapters/MultiDownloadAdapter.java
Patch:
@@ -21,12 +21,12 @@
 import ceui.lisa.utils.GlideUtil;
 import ceui.lisa.utils.Params;
 
-public class MultiDownldAdapter extends BaseAdapter<IllustsBean, RecyMultiDownloadBinding> implements MultiDownload {
+public class MultiDownloadAdapter extends BaseAdapter<IllustsBean, RecyMultiDownloadBinding> implements MultiDownload {
 
     private int imageSize = 0;
     private Callback mCallback;
 
-    public MultiDownldAdapter(List<IllustsBean> targetList, Context context) {
+    public MultiDownloadAdapter(List<IllustsBean> targetList, Context context) {
         super(targetList, context);
         imageSize = (mContext.getResources().getDisplayMetrics().widthPixels -
                 mContext.getResources().getDimensionPixelSize(R.dimen.two_dp)) / 3;

File: app/src/main/java/ceui/lisa/adapters/NAdapter.java
Patch:
@@ -157,7 +157,7 @@ public void onItemClick(View v, int position, int viewType) {
                     mContext.startActivity(intent);
                 } else if (viewType == 1) {
                     PixivOperate.postLikeNovel(allItems.get(position), Shaft.sUserModel,
-                            Params.TYPE_PUBLUC, v);
+                            Params.TYPE_PUBLIC, v);
                 } else if (viewType == 2) {
                     Intent intent = new Intent(mContext, TemplateActivity.class);
                     intent.putExtra(Params.URL, allItems.get(position).getImage_urls().getMaxImage());

File: app/src/main/java/ceui/lisa/adapters/SimpleUserAdapter.java
Patch:
@@ -93,7 +93,7 @@ public void onItemClick(View v, int position, int viewType) {
                         postFollow.setText(mContext.getString(R.string.post_follow));
                     } else {
                         PixivOperate.postFollowUser(allItems.get(position).getId(),
-                                Params.TYPE_PUBLUC);
+                                Params.TYPE_PUBLIC);
                         allItems.get(position).setIs_followed(true);
                         Button postFollow = ((Button) v);
                         postFollow.setText(mContext.getString(R.string.post_unfollow));

File: app/src/main/java/ceui/lisa/adapters/UAdapter.java
Patch:
@@ -112,7 +112,7 @@ public void onItemClick(View v, int position, int viewType) {
                         allItems.get(position).getUser().setIs_followed(false);
                         postFollow.setText(mContext.getString(R.string.post_follow));
                     } else {
-                        PixivOperate.postFollowUser(allItems.get(position).getUser().getId(), Params.TYPE_PUBLUC);
+                        PixivOperate.postFollowUser(allItems.get(position).getUser().getId(), Params.TYPE_PUBLIC);
                         allItems.get(position).getUser().setIs_followed(true);
                         Button postFollow = ((Button) v);
                         postFollow.setText(mContext.getString(R.string.post_unfollow));

File: app/src/main/java/ceui/lisa/core/Manager.java
Patch:
@@ -283,7 +283,7 @@ public void run() throws Throwable {
 
                     if(downloadItem.getIllust().isGif()){
                         Shaft.getMMKV().encode(Params.ILLUST_ID + "_" + downloadItem.getIllust().getId(), true);
-                        PixivOperate.unzipAndePlay(context, downloadItem.getIllust(), downloadItem.isAutoSave());
+                        PixivOperate.unzipAndPlay(context, downloadItem.getIllust(), downloadItem.isAutoSave());
                     }
 
                     //通知 DOWNLOAD_ING 下载完成

File: app/src/main/java/ceui/lisa/download/FileSizeUtil.java
Patch:
@@ -31,7 +31,7 @@ public static double getFileOrFilesSize(String filePath, int sizeType) {
         } catch (Exception e) {
             e.printStackTrace();
         }
-        return FormetFileSize(blockSize, sizeType);
+        return FormatFileSize(blockSize, sizeType);
     }
 
     public static double getFileOrFilesSize(File file, int sizeType) {
@@ -45,7 +45,7 @@ public static double getFileOrFilesSize(File file, int sizeType) {
         } catch (Exception e) {
             e.printStackTrace();
         }
-        return FormetFileSize(blockSize, sizeType);
+        return FormatFileSize(blockSize, sizeType);
     }
 
     /**
@@ -126,7 +126,7 @@ public static String formatFileSize(long fileS) {
     /**
      * 转换文件大小,指定转换的类型
      */
-    private static double FormetFileSize(long fileS, int sizeType) {
+    private static double FormatFileSize(long fileS, int sizeType) {
         DecimalFormat df = new DecimalFormat("#.00");
         double fileSizeLong = 0;
         switch (sizeType) {

File: app/src/main/java/ceui/lisa/feature/HostManager.java
Patch:
@@ -126,7 +126,7 @@ public PKCEItem getPkce() {
         if (pkceItem == null) {
             try {
                 final String verify = PkceUtil.generateCodeVerifier();
-                final String challenge = PkceUtil.generateCodeChallange(verify);
+                final String challenge = PkceUtil.generateCodeChallenge(verify);
                 pkceItem = new PKCEItem(verify, challenge);
             } catch (Exception e) {
                 e.printStackTrace();

File: app/src/main/java/ceui/lisa/feature/PkceUtil.java
Patch:
@@ -17,7 +17,7 @@ public static String generateCodeVerifier() throws UnsupportedEncodingException
         return Base64.encodeToString(codeVerifier, Base64.URL_SAFE | Base64.NO_WRAP | Base64.NO_PADDING);
     }
 
-    public static String generateCodeChallange(String codeVerifier) throws UnsupportedEncodingException, NoSuchAlgorithmException {
+    public static String generateCodeChallenge(String codeVerifier) throws UnsupportedEncodingException, NoSuchAlgorithmException {
         byte[] bytes = codeVerifier.getBytes(StandardCharsets.US_ASCII);
         MessageDigest messageDigest = MessageDigest.getInstance("SHA-256");
         messageDigest.update(bytes, 0, bytes.length);

File: app/src/main/java/ceui/lisa/feature/worker/BatchFollowTask.java
Patch:
@@ -33,7 +33,7 @@ public BatchFollowTask(String name, int userID, int starType) {
     public void run(IEnd end) {
         if (starType == 0) {
             Retro.getAppApi().postFollow(
-                    sUserModel.getAccess_token(), userID, Params.TYPE_PUBLUC)
+                    sUserModel.getAccess_token(), userID, Params.TYPE_PUBLIC)
                     .subscribeOn(Schedulers.newThread())
                     .observeOn(AndroidSchedulers.mainThread())
                     .subscribe(new ErrorCtrl<NullResponse>() {

File: app/src/main/java/ceui/lisa/feature/worker/BatchStarTask.java
Patch:
@@ -32,7 +32,7 @@ public BatchStarTask(String name, int illustID, int starType) {
     @Override
     public void run(IEnd end) {
         if (starType == 0) {
-            Retro.getAppApi().postLike(Shaft.sUserModel.getAccess_token(), illustID, Params.TYPE_PUBLUC)
+            Retro.getAppApi().postLike(Shaft.sUserModel.getAccess_token(), illustID, Params.TYPE_PUBLIC)
                     .subscribeOn(Schedulers.newThread())
                     .observeOn(AndroidSchedulers.mainThread())
                     .subscribe(new ErrorCtrl<NullResponse>() {

File: app/src/main/java/ceui/lisa/fragments/FragmentEditFile.java
Patch:
@@ -327,14 +327,14 @@ public void onClick(View v) {
                                             FragmentEditFile.this,
                                             Integer.parseInt(t[0]), // Initial year selection
                                             Integer.parseInt(t[1]) - 1, // Initial month selection
-                                            Integer.parseInt(t[2]) // Inital day selection
+                                            Integer.parseInt(t[2]) // Initial day selection
                                     );
                                 } else {
                                     dpd = DatePickerDialog.newInstance(
                                             FragmentEditFile.this,
                                             now.get(Calendar.YEAR) - 18, // Initial year selection
                                             0, // Initial month selection
-                                            1 // Inital day selection
+                                            1 // Initial day selection
                                     );
                                 }
                                 start.set(now.get(Calendar.YEAR) - 100, 0, 1);

File: app/src/main/java/ceui/lisa/fragments/FragmentFilter.java
Patch:
@@ -204,14 +204,14 @@ public void onDateSet(DatePickerDialog view, int year, int monthOfYear, int dayO
                     listener,
                     Integer.parseInt(t[0]), // Initial year selection
                     Integer.parseInt(t[1]) - 1, // Initial month selection
-                    Integer.parseInt(t[2]) // Inital day selection
+                    Integer.parseInt(t[2]) // Initial day selection
             );
         } else {
             dpd = DatePickerDialog.newInstance(
                     listener,
                     now.get(Calendar.YEAR), // Initial year selection
                     now.get(Calendar.MONTH), // Initial month selection
-                    now.get(Calendar.DAY_OF_MONTH) // Inital day selection
+                    now.get(Calendar.DAY_OF_MONTH) // Initial day selection
             );
         }
         start.set(1970, 0, 1);

File: app/src/main/java/ceui/lisa/fragments/FragmentIllust.java
Patch:
@@ -327,7 +327,7 @@ public void onClick(View v) {
                     PixivOperate.postUnFollowUser(illust.getUser().getId());
                     illust.getUser().setIs_followed(false);
                 } else {
-                    PixivOperate.postFollowUser(illust.getUser().getId(), Params.TYPE_PUBLUC);
+                    PixivOperate.postFollowUser(illust.getUser().getId(), Params.TYPE_PUBLIC);
                     illust.getUser().setIs_followed(true);
                 }
             }

File: app/src/main/java/ceui/lisa/fragments/FragmentLikeIllustHorizontal.java
Patch:
@@ -134,7 +134,7 @@ protected void initData() {
         Observable<ListIllust> api = null;
         if (type == 1) {
             api = Retro.getAppApi().getUserLikeIllust(sUserModel.getAccess_token(),
-                    mUserDetailResponse.getUser().getId(), Params.TYPE_PUBLUC);
+                    mUserDetailResponse.getUser().getId(), Params.TYPE_PUBLIC);
         } else if (type == 2) {
             api = Retro.getAppApi().getUserSubmitIllust(sUserModel.getAccess_token(),
                     mUserDetailResponse.getUser().getId(), Params.TYPE_ILLUST);

File: app/src/main/java/ceui/lisa/fragments/FragmentLikeNovelHorizontal.java
Patch:
@@ -124,7 +124,7 @@ protected void initData() {
         Observable<ListNovel> mApi;
         if (type == 0) {
             mApi = Retro.getAppApi().getUserLikeNovel(sUserModel.getAccess_token(),
-                    userID, Params.TYPE_PUBLUC);
+                    userID, Params.TYPE_PUBLIC);
         } else {
             mApi = Retro.getAppApi().getUserSubmitNovel(sUserModel.getAccess_token(),
                     userID);

File: app/src/main/java/ceui/lisa/fragments/FragmentMultiDownload.java
Patch:
@@ -18,7 +18,7 @@
 import ceui.lisa.R;
 import ceui.lisa.activities.BaseActivity;
 import ceui.lisa.adapters.BaseAdapter;
-import ceui.lisa.adapters.MultiDownldAdapter;
+import ceui.lisa.adapters.MultiDownloadAdapter;
 import ceui.lisa.core.BaseRepo;
 import ceui.lisa.core.LocalRepo;
 import ceui.lisa.databinding.FragmentMultiDownloadBinding;
@@ -36,7 +36,7 @@
 import gdut.bsx.share2.Share2;
 import gdut.bsx.share2.ShareContentType;
 
-public class FragmentMultiDownld extends LocalListFragment<FragmentMultiDownloadBinding,
+public class FragmentMultiDownload extends LocalListFragment<FragmentMultiDownloadBinding,
         IllustsBean> {
 
     private DragSelectTouchListener dragSelectTouchListener;
@@ -177,7 +177,7 @@ public void setSelected(int i, boolean b) {
 
     @Override
     public BaseAdapter<IllustsBean, RecyMultiDownloadBinding> adapter() {
-        MultiDownldAdapter adapter = new MultiDownldAdapter(allItems, mContext);
+        MultiDownloadAdapter adapter = new MultiDownloadAdapter(allItems, mContext);
         adapter.setCallback(new Callback() {
             @Override
             public void doSomething(Object t) {

File: app/src/main/java/ceui/lisa/fragments/FragmentNovelHolder.java
Patch:
@@ -130,7 +130,7 @@ private void getNovel(NovelBean novelBean) {
             public void onClick(View v) {
                 Common.showLog(className + "getNovel 111");
                 PixivOperate.postLikeNovel(mNovelBean, Shaft.sUserModel,
-                        Params.TYPE_PUBLUC, baseBind.like);
+                        Params.TYPE_PUBLIC, baseBind.like);
             }
         });
 

File: app/src/main/java/ceui/lisa/fragments/FragmentNovelSeriesDetail.java
Patch:
@@ -189,7 +189,7 @@ public void onClick(View v) {
                     baseBind.postLikeUser.setText("取消关注");
                     userBean.setIs_followed(true);
                     PixivOperate.postFollowUser(userBean.getId(),
-                            Params.TYPE_PUBLUC);
+                            Params.TYPE_PUBLIC);
                 }
             }
         });

File: app/src/main/java/ceui/lisa/fragments/FragmentRight.java
Patch:
@@ -91,7 +91,7 @@ public boolean onMenuItemClick(MenuItem item) {
             startActivity(intent);
         });
         baseBind.glareLayout.setListener(new OnCheckChangeListener() {
-            final String[] types = {Params.TYPE_ALL, Params.TYPE_PUBLUC, Params.TYPE_PRIVATE};
+            final String[] types = {Params.TYPE_ALL, Params.TYPE_PUBLIC, Params.TYPE_PRIVATE};
             @Override
             public void onSelect(int index, View view) {
                 Common.showLog("glareLayout onSelect " + index);

File: app/src/main/java/ceui/lisa/fragments/FragmentSB.java
Patch:
@@ -96,7 +96,7 @@ private void submitStar() {
             boolean isPrivate = baseBind.isPrivate.isChecked();
             String toastMsg = isPrivate ? getString(R.string.like_novel_success_private) : getString(R.string.like_novel_success_public);
             Retro.getAppApi().postLike(Shaft.sUserModel.getAccess_token(), illustID,
-                    isPrivate ? Params.TYPE_PRIVATE : Params.TYPE_PUBLUC)
+                    isPrivate ? Params.TYPE_PRIVATE : Params.TYPE_PUBLIC)
                     .subscribeOn(Schedulers.newThread())
                     .observeOn(AndroidSchedulers.mainThread())
                     .subscribe(new ErrorCtrl<NullResponse>() {
@@ -113,7 +113,7 @@ public void next(NullResponse nullResponse) {
             tempList.toArray(strings);
 
             Retro.getAppApi().postLike(Shaft.sUserModel.getAccess_token(), illustID,
-                    isPrivate ? Params.TYPE_PRIVATE : Params.TYPE_PUBLUC, strings)
+                    isPrivate ? Params.TYPE_PRIVATE : Params.TYPE_PUBLIC, strings)
                     .subscribeOn(Schedulers.newThread())
                     .observeOn(AndroidSchedulers.mainThread())
                     .subscribe(new ErrorCtrl<NullResponse>() {

File: app/src/main/java/ceui/lisa/fragments/FragmentSingleIllust.java
Patch:
@@ -330,7 +330,7 @@ public void onClick(View v) {
                     PixivOperate.postUnFollowUser(illust.getUser().getId());
                     illust.getUser().setIs_followed(false);
                 } else {
-                    PixivOperate.postFollowUser(illust.getUser().getId(), Params.TYPE_PUBLUC);
+                    PixivOperate.postFollowUser(illust.getUser().getId(), Params.TYPE_PUBLIC);
                     illust.getUser().setIs_followed(true);
                 }
             }

File: app/src/main/java/ceui/lisa/fragments/FragmentSingleUgora.java
Patch:
@@ -232,7 +232,7 @@ public void invoke(float progress) {
             if (hasDownload && zipFile.exists() && zipFile.length() > 1024) {
                 baseBind.playGif.setVisibility(View.INVISIBLE);
                 baseBind.progressLayout.donutProgress.setVisibility(View.VISIBLE);
-                PixivOperate.unzipAndePlay(mContext, illust);
+                PixivOperate.unzipAndPlay(mContext, illust);
             } else {
                 Common.showToast("获取GIF信息");
                 baseBind.progress.setVisibility(View.VISIBLE);
@@ -445,7 +445,7 @@ public void onClick(View v) {
                     PixivOperate.postUnFollowUser(illust.getUser().getId());
                     illust.getUser().setIs_followed(false);
                 } else {
-                    PixivOperate.postFollowUser(illust.getUser().getId(), Params.TYPE_PUBLUC);
+                    PixivOperate.postFollowUser(illust.getUser().getId(), Params.TYPE_PUBLIC);
                     illust.getUser().setIs_followed(true);
                 }
             }

File: app/src/main/java/ceui/lisa/http/AppApi.java
Patch:
@@ -474,7 +474,7 @@ Observable<ListNovelOfSeries> getNextSeriesNovel(@Header("Authorization") String
                                                      @Url String next_url);
 
     @GET
-    Observable<ListArticle> getNextArticals(@Header("Authorization") String token,
+    Observable<ListArticle> getNextArticles(@Header("Authorization") String token,
                                             @Url String next_url);
 
 

File: app/src/main/java/ceui/lisa/http/SignApi.java
Patch:
@@ -48,7 +48,7 @@ Observable<AccountEditResponse> changePassword(@Header("Authorization") String t
                                                    @Field("new_password") String new_password);
 
     /**
-     * 改密码还改pixivid
+     * 改密码还改pixiv id
      *
      * @param token
      * @param new_user_account

File: app/src/main/java/ceui/lisa/utils/Params.java
Patch:
@@ -97,7 +97,7 @@ public class Params {
     public static final String URL_R18_SETTING  = "https://www.pixiv.net/settings.php?mode=age-check";
     public static final String URL_PREMIUM_SETTING  = "https://www.pixiv.net/premium.php#premium-payment";
 
-    public static final String TYPE_PUBLUC = "public";
+    public static final String TYPE_PUBLIC = "public";
     public static final String TYPE_PRIVATE = "private";
     public static final String TYPE_ALL = "all";
 

File: app/src/main/java/ceui/lisa/utils/Settings.java
Patch:
@@ -174,7 +174,7 @@ public void setCurrentProgress(long currentProgress) {
 
     private boolean r18FilterDefaultEnable = false; // 默认开启R18内容过滤
 
-    private transient boolean r18FilterTempEnableInited = false;
+    private transient boolean r18FilterTempEnableInitialed = false;
     private transient boolean r18FilterTempEnable = false; // 临时开启R18内容过滤
 
     private String searchDefaultSortType = ""; // 搜索结果默认排序方式
@@ -576,9 +576,9 @@ public void setR18FilterDefaultEnable(boolean r18FilterDefaultEnable) {
     }
 
     public boolean isR18FilterTempEnable() {
-        if (!r18FilterTempEnableInited) {
+        if (!r18FilterTempEnableInitialed) {
             r18FilterTempEnable = r18FilterDefaultEnable;
-            r18FilterTempEnableInited = true;
+            r18FilterTempEnableInitialed = true;
         }
         return r18FilterTempEnable;
     }

File: app/src/main/java/ceui/lisa/activities/NovelActivity.java
Patch:
@@ -5,7 +5,6 @@
 import android.view.View;
 
 import ceui.lisa.R;
-import ceui.lisa.cache.Cache;
 import ceui.lisa.databinding.ActivityNovelBinding;
 import ceui.lisa.models.NovelDetail;
 import ceui.lisa.page.PageLoader;

File: app/src/main/java/ceui/lisa/adapters/DownloadedAdapter.java
Patch:
@@ -77,6 +77,7 @@ public void bindData(DownloadEntity target,
                     intent.putExtra("hideStatusBar", true);
                     mContext.startActivity(intent);
                 });
+                bindView.baseBind.deleteItem.setOnClickListener(v -> mOnItemClickListener.onItemClick(v, position, 2));
             }
         } else {
             ViewGroup.LayoutParams params = bindView.baseBind.illustImage.getLayoutParams();
@@ -125,6 +126,7 @@ public void bindData(DownloadEntity target,
                     bindView.baseBind.author.setTag(currentIllust.getUser().getId());
                     mOnItemClickListener.onItemClick(bindView.baseBind.author, position, 1);
                 });
+                bindView.baseBind.deleteItem.setOnClickListener(v -> mOnItemClickListener.onItemClick(v, position, 2));
             }
         }
         //从-400 丝滑滑动到0

File: app/src/main/java/ceui/lisa/adapters/DownloadedHolder.java
Patch:
@@ -6,7 +6,6 @@
 import com.facebook.rebound.SpringSystem;
 
 import ceui.lisa.databinding.RecyDownloadedBinding;
-import ceui.lisa.databinding.RecyViewHistoryBinding;
 
 class DownloadedHolder extends ViewHolder<RecyDownloadedBinding> {
 

File: app/src/main/java/ceui/lisa/adapters/MultiDownldAdapter.java
Patch:
@@ -46,7 +46,7 @@ public void bindData(IllustsBean target, ViewHolder<RecyMultiDownloadBinding> bi
         bindView.baseBind.illustImage.setLayoutParams(params);
         final IllustsBean illustsBean = allItems.get(position);
         Object tag = bindView.itemView.getTag(R.id.tag_image_url);
-        if ((tag == null) || !(tag instanceof String) || !tag.equals(illustsBean.getImage_urls().getMedium())) {
+        if (!(tag instanceof String) || !tag.equals(illustsBean.getImage_urls().getMedium())) {
             Glide.with(mContext)
                     .load(GlideUtil.getMediumImg(illustsBean))
                     .placeholder(R.color.light_bg)

File: app/src/main/java/ceui/lisa/cache/FileOperator.java
Patch:
@@ -2,9 +2,7 @@
 
 import android.util.Log;
 
-import com.blankj.utilcode.util.FileUtils;
 import com.blankj.utilcode.util.PathUtils;
-import com.blankj.utilcode.util.ToastUtils;
 
 import java.io.File;
 import java.io.FileInputStream;

File: app/src/main/java/ceui/lisa/core/Mapper.java
Patch:
@@ -6,7 +6,6 @@
 import ceui.lisa.helper.IllustFilter;
 import ceui.lisa.interfaces.ListShow;
 import ceui.lisa.models.IllustsBean;
-import ceui.lisa.utils.Common;
 import io.reactivex.functions.Function;
 
 /**

File: app/src/main/java/ceui/lisa/database/MuteEntity.java
Patch:
@@ -1,7 +1,6 @@
 package ceui.lisa.database;
 
 import androidx.room.Entity;
-import androidx.room.PrimaryKey;
 
 @Entity(tableName = "tag_mute_table", primaryKeys = {"id", "type"})
 public final class MuteEntity {

File: app/src/main/java/ceui/lisa/download/ImageSaver.java
Patch:
@@ -32,9 +32,7 @@ public void execute() {
             mime[0] = "image/png";
         }
         MediaScannerConnection.scanFile(
-                Shaft.getContext(), path, mime, (path1, uri) -> {
-                    Common.showLog("ImageSaver path1 " + path1 + " uri " + uri);
-                }
+                Shaft.getContext(), path, mime, (path1, uri) -> Common.showLog("ImageSaver path1 " + path1 + " uri " + uri)
         );
 
         // MediaStore.Images.Media.insertImage(context.getContentResolver(), BitmapFactory.decodeFile(file.getAbsolutePath()), file.getName(), null);

File: app/src/main/java/ceui/lisa/feature/PkceUtil.java
Patch:
@@ -1,10 +1,7 @@
 package ceui.lisa.feature;
 
-import android.os.Build;
 import android.util.Base64;
 
-import androidx.annotation.RequiresApi;
-
 import java.io.UnsupportedEncodingException;
 import java.nio.charset.StandardCharsets;
 import java.security.MessageDigest;

File: app/src/main/java/ceui/lisa/feature/ToastStyle.java
Patch:
@@ -2,9 +2,7 @@
 
 import android.content.Context;
 
-import com.hjq.toast.style.BaseToastStyle;
 import com.hjq.toast.style.ToastAliPayStyle;
-import com.hjq.toast.style.ToastQQStyle;
 
 public class ToastStyle extends ToastAliPayStyle {
 

File: app/src/main/java/ceui/lisa/feature/worker/BatchStarTask.java
Patch:
@@ -10,7 +10,6 @@
 import ceui.lisa.models.NullResponse;
 import ceui.lisa.utils.Params;
 import io.reactivex.android.schedulers.AndroidSchedulers;
-import io.reactivex.functions.Consumer;
 import io.reactivex.schedulers.Schedulers;
 
 import static ceui.lisa.activities.Shaft.sUserModel;

File: app/src/main/java/ceui/lisa/fragments/FragmentCollection.java
Patch:
@@ -12,7 +12,6 @@
 import androidx.viewpager.widget.ViewPager;
 
 import com.ToxicBakery.viewpager.transforms.DrawerTransformer;
-import com.blankj.utilcode.util.BarUtils;
 
 import java.util.Arrays;
 import java.util.HashSet;

File: app/src/main/java/ceui/lisa/fragments/FragmentHotTag.java
Patch:
@@ -7,7 +7,6 @@
 import androidx.recyclerview.widget.GridLayoutManager;
 
 import ceui.lisa.activities.SearchActivity;
-import ceui.lisa.activities.TemplateActivity;
 import ceui.lisa.adapters.BaseAdapter;
 import ceui.lisa.adapters.TagAdapter;
 import ceui.lisa.core.RemoteRepo;
@@ -17,7 +16,6 @@
 import ceui.lisa.model.ListTrendingtag;
 import ceui.lisa.repo.HotTagRepo;
 import ceui.lisa.utils.DensityUtil;
-import ceui.lisa.utils.Dev;
 import ceui.lisa.utils.Params;
 import ceui.lisa.view.TagItemDecoration;
 

File: app/src/main/java/ceui/lisa/fragments/FragmentImageDetail.java
Patch:
@@ -9,7 +9,6 @@
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 
-import com.blankj.utilcode.util.BarUtils;
 import com.bumptech.glide.load.DataSource;
 import com.bumptech.glide.load.engine.GlideException;
 import com.bumptech.glide.request.RequestListener;
@@ -24,7 +23,6 @@
 import ceui.lisa.core.GlideApp;
 import ceui.lisa.databinding.FragmentImageDetailBinding;
 import ceui.lisa.download.IllustDownload;
-import ceui.lisa.feature.HostManager;
 import ceui.lisa.models.IllustsBean;
 import ceui.lisa.utils.Common;
 import ceui.lisa.utils.GlideUrlChild;

File: app/src/main/java/ceui/lisa/fragments/FragmentLikeIllust.java
Patch:
@@ -13,7 +13,6 @@
 import ceui.lisa.R;
 import ceui.lisa.activities.Shaft;
 import ceui.lisa.adapters.BaseAdapter;
-import ceui.lisa.adapters.IAdapter;
 import ceui.lisa.adapters.IAdapterWithStar;
 import ceui.lisa.core.RemoteRepo;
 import ceui.lisa.database.AppDatabase;

File: app/src/main/java/ceui/lisa/fragments/FragmentNew.java
Patch:
@@ -4,9 +4,6 @@
 import androidx.annotation.Nullable;
 import androidx.fragment.app.Fragment;
 import androidx.fragment.app.FragmentPagerAdapter;
-
-import com.blankj.utilcode.util.BarUtils;
-
 import ceui.lisa.R;
 import ceui.lisa.activities.Shaft;
 import ceui.lisa.databinding.ViewpagerWithTablayoutBinding;

File: app/src/main/java/ceui/lisa/fragments/FragmentNovelHolder.java
Patch:
@@ -11,8 +11,6 @@
 import android.view.View;
 import android.widget.TextView;
 
-import androidx.appcompat.widget.Toolbar;
-
 import com.blankj.utilcode.util.BarUtils;
 import com.blankj.utilcode.util.PathUtils;
 import com.bumptech.glide.Glide;
@@ -25,6 +23,7 @@
 import java.util.Arrays;
 import java.util.Collections;
 
+import androidx.appcompat.widget.Toolbar;
 import androidx.core.content.ContextCompat;
 import ceui.lisa.R;
 import ceui.lisa.activities.BaseActivity;
@@ -38,7 +37,6 @@
 import ceui.lisa.database.AppDatabase;
 import ceui.lisa.database.DownloadEntity;
 import ceui.lisa.databinding.FragmentNovelHolderBinding;
-import ceui.lisa.download.FileCreator;
 import ceui.lisa.download.IllustDownload;
 import ceui.lisa.helper.NovelParseHelper;
 import ceui.lisa.http.NullCtrl;

File: app/src/main/java/ceui/lisa/fragments/FragmentPv.java
Patch:
@@ -3,9 +3,6 @@
 import androidx.annotation.NonNull;
 import androidx.fragment.app.Fragment;
 import androidx.fragment.app.FragmentPagerAdapter;
-
-import com.blankj.utilcode.util.BarUtils;
-
 import ceui.lisa.R;
 import ceui.lisa.activities.Shaft;
 import ceui.lisa.databinding.ViewpagerWithTablayoutBinding;

File: app/src/main/java/ceui/lisa/fragments/FragmentSearchIllust.java
Patch:
@@ -11,17 +11,14 @@
 import androidx.databinding.ViewDataBinding;
 import androidx.lifecycle.Observer;
 import androidx.lifecycle.ViewModelProvider;
-
 import ceui.lisa.R;
-import ceui.lisa.activities.Shaft;
 import ceui.lisa.adapters.BaseAdapter;
 import ceui.lisa.adapters.IAdapter;
 import ceui.lisa.core.BaseRepo;
 import ceui.lisa.databinding.FragmentBaseListBinding;
 import ceui.lisa.model.ListIllust;
 import ceui.lisa.models.IllustsBean;
 import ceui.lisa.repo.SearchIllustRepo;
-import ceui.lisa.utils.Params;
 import ceui.lisa.utils.PixivSearchParamUtil;
 import ceui.lisa.viewmodel.SearchModel;
 

File: app/src/main/java/ceui/lisa/http/AccountApi.java
Patch:
@@ -2,11 +2,9 @@
 
 import ceui.lisa.models.UserModel;
 import io.reactivex.Observable;
-import retrofit2.Call;
 import retrofit2.http.Field;
 import retrofit2.http.FormUrlEncoded;
 import retrofit2.http.GET;
-import retrofit2.http.Header;
 import retrofit2.http.POST;
 import retrofit2.http.Query;
 

File: app/src/main/java/ceui/lisa/ui/behavior/FragmentRightContentBehavior.java
Patch:
@@ -8,9 +8,7 @@
 import androidx.annotation.NonNull;
 import androidx.coordinatorlayout.widget.CoordinatorLayout;
 import androidx.core.view.ViewCompat;
-
 import ceui.lisa.R;
-import ceui.lisa.utils.Common;
 
 public class FragmentRightContentBehavior extends CoordinatorLayout.Behavior<View> {
 

File: app/src/main/java/ceui/lisa/view/EditTextWithSelection.java
Patch:
@@ -2,7 +2,6 @@
 
 import android.content.Context;
 import android.util.AttributeSet;
-import android.widget.EditText;
 
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;

File: app/src/main/java/ceui/lisa/view/MultiImageView.java
Patch:
@@ -1,7 +1,6 @@
 package ceui.lisa.view;
 
 import android.content.Context;
-import android.text.TextUtils;
 import android.util.AttributeSet;
 import android.view.View;
 import android.widget.ImageView;

File: app/src/main/java/ceui/lisa/view/PressFrameLayout.java
Patch:
@@ -15,11 +15,9 @@
 import android.util.AttributeSet;
 import android.view.MotionEvent;
 import android.view.animation.DecelerateInterpolator;
-import android.widget.FrameLayout;
 import android.widget.RelativeLayout;
 
 import androidx.annotation.Nullable;
-
 import ceui.lisa.utils.DensityUtil;
 
 public class PressFrameLayout extends RelativeLayout {

File: app/src/main/java/ceui/lisa/viewmodel/UserViewModel.java
Patch:
@@ -3,9 +3,7 @@
 
 import androidx.lifecycle.MutableLiveData;
 import androidx.lifecycle.ViewModel;
-
 import ceui.lisa.models.UserDetailResponse;
-import ceui.lisa.models.UserFollowDetail;
 
 public class UserViewModel extends ViewModel {
 

File: app/src/main/java/ceui/lisa/adapters/IAdapter.java
Patch:
@@ -188,7 +188,6 @@ private void handleLongClick() {
             public void onItemLongClick(View v, int position, int viewType) {
                 IllustsBean illust = allItems.get(position);
                 View popView = View.inflate(mContext, R.layout.pop_window_2, null);
-                popView.findViewById(R.id.download_this_one).setVisibility(illust.isGif() ? View.GONE : View.VISIBLE);
 
                 QMUIPopup mNormalPopup = QMUIPopups.popup(mContext)
                         .preferredDirection(QMUIPopup.DIRECTION_BOTTOM)
@@ -208,7 +207,7 @@ public void onDismiss() {
                         })
                         .show(v);
 
-                popView.findViewById(R.id.not_interested).setOnClickListener(new View.OnClickListener() {
+                popView.findViewById(R.id.mute_setting).setOnClickListener(new View.OnClickListener() {
                     @Override
                     public void onClick(View v) {
                         MuteDialog muteDialog = MuteDialog.newInstance(illust);
@@ -226,7 +225,7 @@ public void onClick(View v) {
                 popView.findViewById(R.id.download_this_one).setOnClickListener(new View.OnClickListener() {
                     @Override
                     public void onClick(View v) {
-                        IllustDownload.downloadAllIllust(illust, mContext);
+                        IllustDownload.downloadIllustAllPages(illust);
                         if(Shaft.sSettings.isAutoPostLikeWhenDownload() && !illust.isIs_bookmarked()){
                             PixivOperate.postLikeDefaultStarType(illust);
                         }

File: app/src/main/java/ceui/lisa/fragments/FragmentDownload.java
Patch:
@@ -98,7 +98,7 @@ public void onClick(QMUIDialog dialog, int index) {
                                 .addAction(0, "清空", QMUIDialogAction.ACTION_PROP_NEGATIVE, new QMUIDialogAction.ActionListener() {
                                     @Override
                                     public void onClick(QMUIDialog dialog, int index) {
-                                        Manager.get().clear();
+                                        Manager.get().clearAll();
                                         ((FragmentDownloading) allPages[0]).clearAndRefresh();
                                         Common.showToast("下载任务清除成功");
                                         dialog.dismiss();

File: app/src/main/java/ceui/lisa/fragments/FragmentDownloading.java
Patch:
@@ -57,9 +57,7 @@ public void onAdapterPrepared() {
         mReceiver = new DownloadReceiver<>((Callback<Holder>) holder -> {
             if (holder.getCode() == Params.DOWNLOAD_FAILED) {
                 final DownloadItem item = holder.getDownloadItem();
-//                allItems.remove(item);
-                item.setProcessed(true);
-//                allItems.add(item);
+                item.setState(DownloadItem.DownloadState.FAILED);
                 mAdapter.notifyItemChanged(holder.getIndex());
                 Common.showLog("收到了失败提醒");
             } else if(holder.getCode() == Params.DOWNLOAD_SUCCESS) {

File: app/src/main/java/ceui/lisa/fragments/FragmentMultiDownld.java
Patch:
@@ -32,7 +32,6 @@
 import ceui.lisa.utils.Common;
 import ceui.lisa.utils.DataChannel;
 import ceui.lisa.utils.DensityUtil;
-import ceui.lisa.utils.Params;
 import ceui.lisa.view.DownloadItemDecoration;
 import gdut.bsx.share2.Share2;
 import gdut.bsx.share2.ShareContentType;
@@ -134,7 +133,7 @@ public void doSomething(Uri t) {
         baseBind.startDownload.setOnClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View v) {
-                IllustDownload.downloadAllIllust(allItems, (BaseActivity<?>) mContext);
+                IllustDownload.downloadCheckedIllustAllPages(allItems, (BaseActivity<?>) mContext);
             }
         });
 

File: app/src/main/java/ceui/lisa/fragments/FragmentSingleIllust.java
Patch:
@@ -233,9 +233,9 @@ public void onPrepare() {
 
         baseBind.download.setOnClickListener(v -> {
             if (illust.getPage_count() == 1) {
-                IllustDownload.downloadIllust(illust, (BaseActivity<?>) mContext);
+                IllustDownload.downloadIllustFirstPage(illust, (BaseActivity<?>) mContext);
             } else {
-                IllustDownload.downloadAllIllust(illust, (BaseActivity<?>) mContext);
+                IllustDownload.downloadIllustAllPages(illust, (BaseActivity<?>) mContext);
             }
             if(Shaft.sSettings.isAutoPostLikeWhenDownload() && !illust.isIs_bookmarked()){
                 PixivOperate.postLikeDefaultStarType(illust);

File: app/src/main/java/ceui/lisa/fragments/FragmentSingleUgora.java
Patch:
@@ -35,7 +35,6 @@
 import java.io.File;
 
 import ceui.lisa.R;
-import ceui.lisa.activities.BaseActivity;
 import ceui.lisa.activities.SearchActivity;
 import ceui.lisa.activities.Shaft;
 import ceui.lisa.activities.TemplateActivity;
@@ -243,7 +242,7 @@ public void next(GifResponse gifResponse) {
                         baseBind.progress.setVisibility(View.INVISIBLE);
                         Cache.get().saveModel(Params.ILLUST_ID + "_" + illust.getId(), gifResponse);
                         Common.showToast("下载GIF文件");
-                        DownloadItem downloadItem = IllustDownload.downloadGif(gifResponse, illust, (BaseActivity<?>) mContext);
+                        DownloadItem downloadItem = IllustDownload.downloadGif(gifResponse, illust);
                         Manager.get().setCallback(downloadItem.getUuid(), new Callback<Progress>() {
                             @Override
                             public void doSomething(Progress t) {

File: app/src/main/java/ceui/lisa/helper/SAFactory.java
Patch:
@@ -23,7 +23,7 @@ public class SAFactory extends UriFactory {
     public SAFactory(@NotNull Context context, DownloadItem item) {
         super(context);
         this.mItem = item;
-        DocumentFile file = SAFile.getDocument(getContext(), mItem.getIllust(), mItem.getIndex(), mItem.getNonius()==0);
+        DocumentFile file = SAFile.getDocument(getContext(), mItem.getIllust(), mItem.getIndex(), mItem.shouldStartNewDownload());
         mUri = file.getUri();
     }
 

File: app/src/main/java/ceui/lisa/activities/BaseActivity.java
Patch:
@@ -122,9 +122,8 @@ protected void onActivityResult(int requestCode, int resultCode, @Nullable Inten
             if (treeUri != null) {
                 Common.showLog(className + "onActivityResult " + treeUri.toString());
                 Shaft.sSettings.setRootPathUri(treeUri.toString());
-                final int takeFlags = data.getFlags()
-                        & (Intent.FLAG_GRANT_READ_URI_PERMISSION
-                        | Intent.FLAG_GRANT_WRITE_URI_PERMISSION);
+                final int takeFlags = Intent.FLAG_GRANT_READ_URI_PERMISSION
+                        | Intent.FLAG_GRANT_WRITE_URI_PERMISSION;
                 mContext.getContentResolver().takePersistableUriPermission(treeUri,takeFlags);
                 Common.showToast("授权成功！");
                 Local.setSettings(Shaft.sSettings);

File: app/src/main/java/ceui/lisa/activities/ImageDetailActivity.java
Patch:
@@ -15,6 +15,7 @@
 import java.net.URLDecoder;
 import java.util.ArrayList;
 import java.util.List;
+import java.util.Locale;
 
 import ceui.lisa.R;
 import ceui.lisa.databinding.ActivityImageDetailBinding;
@@ -82,7 +83,7 @@ public void onPageScrolled(int i, float v, int i1) {
                 @Override
                 public void onPageSelected(int i) {
                     checkDownload(i);
-                    currentPage.setText(String.format("第 %d/%d P", i + 1, mIllustsBean.getPage_count()));
+                    currentPage.setText(String.format(Locale.getDefault(), "第 %d/%d P", i + 1, mIllustsBean.getPage_count()));
                 }
 
                 @Override
@@ -93,7 +94,7 @@ public void onPageScrollStateChanged(int i) {
             if(mIllustsBean.getPage_count() == 1){
                 currentPage.setVisibility(View.INVISIBLE);
             }else{
-                currentPage.setText(String.format("第 %d/%d P", index + 1, mIllustsBean.getPage_count()));
+                currentPage.setText(String.format(Locale.getDefault(), "第 %d/%d P", index + 1, mIllustsBean.getPage_count()));
             }
 
         } else if ("下载详情".equals(dataType)) {

File: app/src/main/java/ceui/lisa/activities/OutReversActivity.java
Patch:
@@ -4,8 +4,6 @@
 import android.net.Uri;
 import android.os.Bundle;
 
-import com.blankj.utilcode.util.UriUtils;
-
 import java.io.File;
 
 import ceui.lisa.R;
@@ -24,7 +22,7 @@ protected void initData() {
                     Bundle bundle = getIntent().getExtras();
                     if (bundle != null) {
                         Uri imageUri = getIntent().getParcelableExtra(Intent.EXTRA_STREAM);
-                        File innerImageFile = UriUtils.uri2File(imageUri);
+                        File innerImageFile = Common.copyUriToImageCacheFolder(imageUri);
                         Uri innerImageFileUri = Uri.fromFile(innerImageFile);
                         if (!ReverseImage.isFileSizeOkToSearch(imageUri, ReverseImage.DEFAULT_ENGINE)) {
                             Common.showToast(getString(R.string.string_410));

File: app/src/main/java/ceui/lisa/activities/SearchActivity.java
Patch:
@@ -237,7 +237,7 @@ else if(Common.isNumeric(trimmedKeyword)){
                             .create();
                     tipDialog.show();
                     //先假定为作品id
-                    PixivOperate.getIllustByID(sUserModel, Integer.valueOf(trimmedKeyword), mContext, new Callback<Void>() {
+                    PixivOperate.getIllustByID(sUserModel, Integer.parseInt(trimmedKeyword), mContext, new Callback<Void>() {
                         @Override
                         public void doSomething(Void t) {
                             PixivOperate.insertSearchHistory(trimmedKeyword, SearchTypeUtil.SEARCH_TYPE_DB_ILLUSTSID);

File: app/src/main/java/ceui/lisa/adapters/ArticleAdapter.java
Patch:
@@ -15,7 +15,7 @@
 //特辑
 public class ArticleAdapter extends BaseAdapter<SpotlightArticlesBean, RecyArticalBinding> {
 
-    private int imageSize;
+    private final int imageSize;
 
     public ArticleAdapter(List<SpotlightArticlesBean> targetList, Context context) {
         super(targetList, context);

File: app/src/main/java/ceui/lisa/adapters/BookedTagAdapter.java
Patch:
@@ -13,7 +13,7 @@
 //自己收藏的Tag
 public class BookedTagAdapter extends BaseAdapter<TagsBean, RecyBookTagBinding> {
 
-    private boolean isMuted;
+    private final boolean isMuted;
 
     public BookedTagAdapter(List<TagsBean> targetList, Context context, boolean muted) {
         super(targetList, context);

File: app/src/main/java/ceui/lisa/adapters/EventAdapter.java
Patch:
@@ -17,7 +17,7 @@
 //你所关注用户的动态
 public class EventAdapter extends BaseAdapter<IllustsBean, RecyUserEventBinding> {
 
-    private int imageSize;
+    private final int imageSize;
 
     public EventAdapter(List<IllustsBean> targetList, Context context) {
         super(targetList, context);

File: app/src/main/java/ceui/lisa/adapters/IAdapter.java
Patch:
@@ -20,6 +20,7 @@
 import com.qmuiteam.qmui.widget.popup.QMUIPopups;
 
 import java.util.List;
+import java.util.Locale;
 
 import ceui.lisa.R;
 import ceui.lisa.activities.Shaft;
@@ -127,7 +128,7 @@ public boolean onLongClick(View v) {
             bindView.baseBind.pSize.setVisibility(View.GONE);
         } else {
             bindView.baseBind.pSize.setVisibility(View.VISIBLE);
-            bindView.baseBind.pSize.setText(String.format("%dP", target.getPage_count()));
+            bindView.baseBind.pSize.setText(String.format(Locale.getDefault(), "%dP", target.getPage_count()));
         }
         bindView.baseBind.pGif.setVisibility(target.isGif() ? View.VISIBLE : View.GONE);
         bindView.itemView.setOnClickListener(view -> {

File: app/src/main/java/ceui/lisa/adapters/LAdapter.java
Patch:
@@ -14,7 +14,7 @@
 
 public class LAdapter extends BaseAdapter<IllustsBean, RecyCardIllustBinding> {
 
-    private int imageSize;
+    private final int imageSize;
 
     public LAdapter(List<IllustsBean> targetList, Context context) {
         super(targetList, context);

File: app/src/main/java/ceui/lisa/adapters/LiveAdapter.java
Patch:
@@ -20,7 +20,7 @@
 
 public class LiveAdapter extends BaseAdapter<Live, RecyItemLiveBinding> {
 
-    private int imageSize;
+    private final int imageSize;
 
     public LiveAdapter(@Nullable List<Live> targetList, Context context) {
         super(targetList, context);

File: app/src/main/java/ceui/lisa/adapters/NAdapter.java
Patch:
@@ -13,6 +13,7 @@
 import com.zhy.view.flowlayout.TagFlowLayout;
 
 import java.util.List;
+import java.util.Locale;
 
 import ceui.lisa.R;
 import ceui.lisa.activities.SearchActivity;
@@ -70,7 +71,7 @@ public void onClick(View view) {
             bindView.baseBind.series.setVisibility(View.GONE);
         }
         if (showShop) {
-            bindView.baseBind.title.setText(String.format("#%d %s", position + 1, target.getTitle()));
+            bindView.baseBind.title.setText(String.format(Locale.getDefault(), "#%d %s", position + 1, target.getTitle()));
         } else {
             bindView.baseBind.title.setText(target.getTitle());
         }
@@ -95,7 +96,7 @@ public boolean onTagClick(View view, int position, FlowLayout parent) {
             }
         });
         bindView.baseBind.author.setText(target.getUser().getName());
-        bindView.baseBind.howManyWord.setText(String.format("%d字", target.getText_length()));
+        bindView.baseBind.howManyWord.setText(String.format(Locale.getDefault(), "%d字", target.getText_length()));
         Glide.with(mContext).load(GlideUtil.getUrl(target.getImage_urls().getMaxImage())).into(bindView.baseBind.cover);
         Glide.with(mContext).load(GlideUtil.getHead(target.getUser())).into(bindView.baseBind.userHead);
         if (target.isIs_bookmarked()) {

File: app/src/main/java/ceui/lisa/adapters/NHAdapter.java
Patch:
@@ -5,6 +5,7 @@
 import com.bumptech.glide.Glide;
 
 import java.util.List;
+import java.util.Locale;
 
 import ceui.lisa.R;
 import ceui.lisa.databinding.RecyRankNovelHorizontalBinding;
@@ -24,7 +25,7 @@ public void initLayout() {
 
     @Override
     public void bindData(NovelBean target, ViewHolder<RecyRankNovelHorizontalBinding> bindView, int position) {
-        bindView.baseBind.novelLength.setText(String.format("%d字", allItems.get(position).getText_length()));
+        bindView.baseBind.novelLength.setText(String.format(Locale.getDefault(), "%d字", allItems.get(position).getText_length()));
         bindView.baseBind.title.setText(allItems.get(position).getTitle());
         bindView.baseBind.author.setText(allItems.get(position).getUser().getName());
         Glide.with(mContext).load(GlideUtil.getUrl(allItems.get(position)

File: app/src/main/java/ceui/lisa/adapters/NineAdapter.java
Patch:
@@ -19,7 +19,7 @@
 
 public class NineAdapter extends BaseAdapter<GlideUrl, RecyNineBinding> {
 
-    private IllustsBean illust;
+    private final IllustsBean illust;
 
     public NineAdapter(@Nullable List<GlideUrl> targetList,
                        Context context, IllustsBean illust) {

File: app/src/main/java/ceui/lisa/adapters/SimpleUserAdapter.java
Patch:
@@ -22,7 +22,7 @@
 public class SimpleUserAdapter extends BaseAdapter<UserBean, RecySimpleUserBinding> {
 
     private FullClickListener mFullClickListener;
-    private boolean isMuteUser;
+    private final boolean isMuteUser;
 
     public SimpleUserAdapter(@Nullable List<UserBean> targetList, Context context) {
         this(targetList, context, false);

File: app/src/main/java/ceui/lisa/adapters/UAdapter.java
Patch:
@@ -26,7 +26,7 @@
 
 public class UAdapter extends BaseAdapter<UserPreviewsBean, RecyUserPreviewBinding> {
 
-    private int imageSize;
+    private final int imageSize;
     private FullClickListener mFullClickListener;
 
     public UAdapter(List<UserPreviewsBean> targetList, Context context) {

File: app/src/main/java/ceui/lisa/adapters/VAdapter.java
Patch:
@@ -4,6 +4,7 @@
 import android.view.View;
 
 import java.util.List;
+import java.util.Locale;
 
 import ceui.lisa.R;
 import ceui.lisa.databinding.FragmentSingleNovelBinding;
@@ -48,7 +49,7 @@ public void bindData(String target, ViewHolder<FragmentSingleNovelBinding> bindV
             bindView.baseBind.partIndex.setVisibility(View.GONE);
         } else {
             bindView.baseBind.partIndex.setVisibility(View.VISIBLE);
-            bindView.baseBind.partIndex.setText(String.format(" --- Part %d --- ", position + 1));
+            bindView.baseBind.partIndex.setText(String.format(Locale.getDefault(), " --- Part %d --- ", position + 1));
         }
         bindView.baseBind.novelDetail.setText(target);
     }

File: app/src/main/java/ceui/lisa/cache/Cache.java
Patch:
@@ -2,7 +2,7 @@
 
 public class Cache implements IOperate, Proxy<IOperate>{
 
-    private IOperate mOperate;
+    private final IOperate mOperate;
 
     private Cache() {
         mOperate = create();

File: app/src/main/java/ceui/lisa/core/ImgGetter.java
Patch:
@@ -15,7 +15,7 @@
 
 public class ImgGetter extends HtmlAssetsImageGetter {
 
-    private Context mContext;
+    private final Context mContext;
     public static final int BOUND = 54;
 
     public ImgGetter(Context context) {

File: app/src/main/java/ceui/lisa/core/ObjectLocal.java
Patch:
@@ -5,5 +5,5 @@
 
 public class ObjectLocal<T> {
 
-    private Map<T, Object> map = new HashMap<>();
+    private final Map<T, Object> map = new HashMap<>();
 }

File: app/src/main/java/ceui/lisa/core/PageData.java
Patch:
@@ -8,7 +8,7 @@
 
 public class PageData implements IDWithList<IllustsBean>{
 
-    private String uuid;
+    private final String uuid;
     private String nextUrl;
     private final List<IllustsBean> illustList;
 

File: app/src/main/java/ceui/lisa/core/RemoteRepo.java
Patch:
@@ -10,7 +10,7 @@
 public abstract class RemoteRepo<Response extends ListShow<?>> extends BaseRepo {
 
     private Observable<? extends Response> mApi;
-    private Function<? super Response, Response> mFunction;
+    private final Function<? super Response, Response> mFunction;
     protected String nextUrl = "";
 
     public RemoteRepo() {

File: app/src/main/java/ceui/lisa/dialogs/MuteDialog.java
Patch:
@@ -26,8 +26,8 @@
 public class MuteDialog extends BaseDialog<DialogMuteTagBinding> {
 
     private IllustsBean mIllust;
-    private List<TagsBean> selected = new ArrayList<>();
-    private List<Boolean> muteNotEffect = new ArrayList<>();
+    private final List<TagsBean> selected = new ArrayList<>();
+    private final List<Boolean> muteNotEffect = new ArrayList<>();
 
     public static MuteDialog newInstance(IllustsBean illustsBean) {
         Bundle args = new Bundle();

File: app/src/main/java/ceui/lisa/download/FileCreator.java
Patch:
@@ -35,8 +35,7 @@ public static String deleteSpecialWords(String before) {
             String temp2 = temp1.replace("/", DASH);
             String temp3 = temp2.replace(",", DASH);
             String temp4 = temp3.replace(":", DASH);
-            String temp5 = temp4.replace("*", DASH);
-            return temp5;
+            return temp4.replace("*", DASH);
         } else {
             return "untitle_" + System.currentTimeMillis() + ".png";
         }

File: app/src/main/java/ceui/lisa/feature/PkceUtil.java
Patch:
@@ -6,6 +6,7 @@
 import androidx.annotation.RequiresApi;
 
 import java.io.UnsupportedEncodingException;
+import java.nio.charset.StandardCharsets;
 import java.security.MessageDigest;
 import java.security.NoSuchAlgorithmException;
 import java.security.SecureRandom;
@@ -20,7 +21,7 @@ public static String generateCodeVerifier() throws UnsupportedEncodingException
     }
 
     public static String generateCodeChallange(String codeVerifier) throws UnsupportedEncodingException, NoSuchAlgorithmException {
-        byte[] bytes = codeVerifier.getBytes("US-ASCII");
+        byte[] bytes = codeVerifier.getBytes(StandardCharsets.US_ASCII);
         MessageDigest messageDigest = MessageDigest.getInstance("SHA-256");
         messageDigest.update(bytes, 0, bytes.length);
         byte[] digest = messageDigest.digest();

File: app/src/main/java/ceui/lisa/fragments/FragmentDownload.java
Patch:
@@ -28,7 +28,7 @@
  */
 public class FragmentDownload extends BaseFragment<ViewpagerWithTablayoutBinding> {
 
-    private Fragment[] allPages = new Fragment[]{new FragmentDownloading(), new FragmentDownloadFinish()};
+    private final Fragment[] allPages = new Fragment[]{new FragmentDownloading(), new FragmentDownloadFinish()};
 
     @Override
     public void initLayout() {

File: app/src/main/java/ceui/lisa/fragments/FragmentDownloadFinish.java
Patch:
@@ -32,8 +32,8 @@
 public class FragmentDownloadFinish extends LocalListFragment<FragmentBaseListBinding,
         DownloadEntity> {
 
-    private List<IllustsBean> all = new ArrayList<>();
-    private List<String> filePaths = new ArrayList<>();
+    private final List<IllustsBean> all = new ArrayList<>();
+    private final List<String> filePaths = new ArrayList<>();
     private DownloadReceiver<?> mReceiver;
 
     @Override

File: app/src/main/java/ceui/lisa/fragments/FragmentEditFile.java
Patch:
@@ -350,7 +350,8 @@ public void onClick(View v) {
     }
 
     private String sex = "", address = "", job = "", country = "", birthday = "";
-    private boolean isGlobal = false, isDeleteProfileImage = false;
+    private boolean isGlobal = false;
+    private final boolean isDeleteProfileImage = false;
 
     @Override
     public SmartRefreshLayout getSmartRefreshLayout() {

File: app/src/main/java/ceui/lisa/fragments/FragmentFileName.java
Patch:
@@ -32,7 +32,7 @@
 public class FragmentFileName extends SwipeFragment<FragmentFileNameBinding> {
 
     private IllustsBean illust;
-    private List<CustomFileNameCell> allItems = new ArrayList<>();
+    private final List<CustomFileNameCell> allItems = new ArrayList<>();
     private FileNameAdapter mAdapter;
 
     public static FragmentFileName newInstance() {

File: app/src/main/java/ceui/lisa/fragments/FragmentLikeIllustHorizontal.java
Patch:
@@ -40,7 +40,7 @@
 
 public class FragmentLikeIllustHorizontal extends BaseFragment<FragmentLikeIllustHorizontalBinding> {
 
-    private List<IllustsBean> allItems = new ArrayList<>();
+    private final List<IllustsBean> allItems = new ArrayList<>();
     private UserDetailResponse mUserDetailResponse;
     private LAdapter mAdapter;
     private int type; // 1插画收藏    2插画作品     3漫画作品

File: app/src/main/java/ceui/lisa/fragments/FragmentLikeNovelHorizontal.java
Patch:
@@ -34,7 +34,7 @@
 
 public class FragmentLikeNovelHorizontal extends BaseFragment<FragmentLikeIllustHorizontalBinding> {
 
-    private List<NovelBean> allItems = new ArrayList<>();
+    private final List<NovelBean> allItems = new ArrayList<>();
     private NHAdapter mAdapter;
     private int type; // 0某人收藏的小说，1某人创作的小说
     private int userID;

File: app/src/main/java/ceui/lisa/fragments/FragmentLogin.java
Patch:
@@ -58,7 +58,7 @@ public class FragmentLogin extends BaseFragment<ActivityLoginBinding> {
     private static final String SIGN_HEAD = "https://app-api.pixiv.net/web/v1/provisional-accounts/create?code_challenge=";
     private static final String SIGN_END = "&code_challenge_method=S256&client=pixiv-android";
     private static final int TAPS_TO_BE_A_DEVELOPER = 7;
-    private SpringSystem springSystem = SpringSystem.create();
+    private final SpringSystem springSystem = SpringSystem.create();
     private Spring rotate;
     private int mHitCountDown;//
     private Toast mHitToast;

File: app/src/main/java/ceui/lisa/fragments/FragmentRecmdIllust.java
Patch:
@@ -178,9 +178,9 @@ public Void execute() {
                 return null;
             }
         }, new TryCatchObserverImpl<>());
-        ((RecmdModel) mModel).getRankList().addAll(((RecmdIllust) mResponse).getRanking_illusts());
+        ((RecmdModel) mModel).getRankList().addAll(mResponse.getRanking_illusts());
         ((IAdapterWithHeadView) mAdapter).setHeadData(((RecmdModel) mModel).getRankList());
-        ((RecmdModel) mModel).tidyAppViewModel(((RecmdModel) mModel).getRankList());
+        mModel.tidyAppViewModel(((RecmdModel) mModel).getRankList());
     }
 
     private void insertViewHistory(IllustsBean illustsBean) {
@@ -215,7 +215,7 @@ public List<IllustsBean> execute() throws Exception {
             public void success(List<IllustsBean> illustsBeans) {
                 allItems.addAll(illustsBeans);
                 ((RecmdModel) mModel).getRankList().addAll(illustsBeans);
-                ((RecmdModel) mModel).tidyAppViewModel(illustsBeans);
+                mModel.tidyAppViewModel(illustsBeans);
                 ((IAdapterWithHeadView) mAdapter).setHeadData(((RecmdModel) mModel).getRankList());
                 mAdapter.notifyItemRangeInserted(mAdapter.headerSize(), allItems.size());
             }

File: app/src/main/java/ceui/lisa/fragments/FragmentSearch.java
Patch:
@@ -198,7 +198,7 @@ private void dispatchClick(String keyWord, int searchType) {
         } else if (searchType == 1) {
             if (Common.isNumeric(trimmedKeyword)) {
                 PixivOperate.insertSearchHistory(trimmedKeyword, SearchTypeUtil.SEARCH_TYPE_DB_ILLUSTSID);
-                PixivOperate.getIllustByID(sUserModel, Integer.valueOf(trimmedKeyword), mContext);
+                PixivOperate.getIllustByID(sUserModel, Integer.parseInt(trimmedKeyword), mContext);
             } else {
                 Common.showToast(getString(R.string.string_154));
             }
@@ -214,7 +214,7 @@ private void dispatchClick(String keyWord, int searchType) {
         } else if (searchType == 3) {
             if (Common.isNumeric(trimmedKeyword)) {
                 PixivOperate.insertSearchHistory(trimmedKeyword, SearchTypeUtil.SEARCH_TYPE_DB_NOVELID);
-                PixivOperate.getNovelByID(sUserModel, Integer.valueOf(trimmedKeyword), mContext, null);
+                PixivOperate.getNovelByID(sUserModel, Integer.parseInt(trimmedKeyword), mContext, null);
             } else {
                 Common.showToast(getString(R.string.string_154));
             }
@@ -251,7 +251,7 @@ else if(Common.isNumeric(trimmedKeyword)){
                         .create();
                 tipDialog.show();
                 //先假定为作品id
-                PixivOperate.getIllustByID(sUserModel, Integer.valueOf(trimmedKeyword), mContext, new Callback<Void>() {
+                PixivOperate.getIllustByID(sUserModel, Integer.parseInt(trimmedKeyword), mContext, new Callback<Void>() {
                     @Override
                     public void doSomething(Void t) {
                         PixivOperate.insertSearchHistory(trimmedKeyword, SearchTypeUtil.SEARCH_TYPE_DB_ILLUSTSID);

File: app/src/main/java/ceui/lisa/fragments/FragmentSearchIllust.java
Patch:
@@ -29,7 +29,7 @@ public class FragmentSearchIllust extends NetListFragment<FragmentBaseListBindin
         IllustsBean> {
 
     private SearchModel searchModel;
-    private boolean isPopular = false;
+    private final boolean isPopular = false;
 
     public static FragmentSearchIllust newInstance(boolean popular) {
         Bundle args = new Bundle();
@@ -40,8 +40,7 @@ public static FragmentSearchIllust newInstance(boolean popular) {
     }
 
     public static FragmentSearchIllust newInstance() {
-        FragmentSearchIllust fragment = new FragmentSearchIllust();
-        return fragment;
+        return new FragmentSearchIllust();
     }
 
     @Override

File: app/src/main/java/ceui/lisa/fragments/FragmentSingleIllust.java
Patch:
@@ -29,6 +29,8 @@
 import com.zhy.view.flowlayout.TagAdapter;
 import com.zhy.view.flowlayout.TagFlowLayout;
 
+import java.util.Locale;
+
 import ceui.lisa.R;
 import ceui.lisa.activities.BaseActivity;
 import ceui.lisa.activities.SearchActivity;
@@ -428,7 +430,7 @@ public void onClick(View v) {
             baseBind.illustList.open();
         } else {
             baseBind.pSize.setVisibility(View.VISIBLE);
-            baseBind.pSize.setText(String.format("%dP", illust.getPage_count()));
+            baseBind.pSize.setText(String.format(Locale.getDefault(), "%dP", illust.getPage_count()));
             baseBind.darkBlank.setVisibility(View.VISIBLE);
             baseBind.seeAll.setVisibility(View.VISIBLE);
             baseBind.illustList.close();

File: app/src/main/java/ceui/lisa/fragments/FragmentSingleUgora.java
Patch:
@@ -209,7 +209,7 @@ public void onDestroy() {
     }
 
     public void nowPlayGif() {
-        File gifFile = new LegacyFile().gifResultFile(mContext, illust);
+        File gifFile = LegacyFile.gifResultFile(mContext, illust);
         PixivOperate.setBack(illust.getId(), new Back() {
             @Override
             public void invoke(float progress) {
@@ -228,7 +228,7 @@ public void invoke(float progress) {
                     .into(baseBind.illustImage);
         } else {
             boolean hasDownload = Shaft.getMMKV().decodeBool(Params.ILLUST_ID + "_" + illust.getId());
-            File zipFile = new LegacyFile().gifZipFile(mContext, illust);
+            File zipFile = LegacyFile.gifZipFile(mContext, illust);
             if (hasDownload && zipFile.exists() && zipFile.length() > 1024) {
                 baseBind.playGif.setVisibility(View.INVISIBLE);
                 baseBind.progressLayout.donutProgress.setVisibility(View.VISIBLE);
@@ -348,7 +348,7 @@ public void onPrepare() {
         });
 
         baseBind.download.setOnClickListener(v -> {
-            File gifFile = new LegacyFile().gifResultFile(mContext, illust);
+            File gifFile = LegacyFile.gifResultFile(mContext, illust);
             if (gifFile.exists() && gifFile.length() > 1024) {
                 OutPut.outPutGif(mContext, gifFile, illust);
                 if(Shaft.sSettings.isAutoPostLikeWhenDownload() && !illust.isIs_bookmarked()){

File: app/src/main/java/ceui/lisa/fragments/FragmentViewPager.java
Patch:
@@ -72,7 +72,7 @@ public void initView() {
                 @NonNull
                 @Override
                 public Fragment getItem(int position) {
-                    return (Fragment) mFragments[position];
+                    return mFragments[position];
                 }
 
                 @Override

File: app/src/main/java/ceui/lisa/helper/CommentFilter.java
Patch:
@@ -84,8 +84,8 @@ private static class CommentFilterRule {
         private static final int REGEX_MATCH = 1; // 根据正则过滤
         private static final int LIST_ALL_REGEX_MATCH = 2; // 列表正则全匹配过滤
 
-        private int ruleType;
-        private String ruleValue;
+        private final int ruleType;
+        private final String ruleValue;
         private List<Pattern> mPatterns;
 
         public CommentFilterRule(int ruleType, String ruleValue) {

File: app/src/main/java/ceui/lisa/helper/DeduplicateArrayList.java
Patch:
@@ -20,16 +20,16 @@ public class DeduplicateArrayList<E extends Deduplicatable> extends ArrayList<E>
 
     public DeduplicateArrayList(int initialCapacity) {
         super(initialCapacity);
-        innerSet = new HashSet<Object>();
+        innerSet = new HashSet<>();
     }
 
     public DeduplicateArrayList() {
-        innerSet = new HashSet<Object>();
+        innerSet = new HashSet<>();
     }
 
     public DeduplicateArrayList(@NonNull Collection<? extends E> c) {
         super(c);
-        innerSet = new HashSet<Object>();
+        innerSet = new HashSet<>();
         List<E> removeList = new ArrayList<>();
         for (int i = 0; i < size(); i++) {
             E e = get(i);

File: app/src/main/java/ceui/lisa/helper/NovelParseHelper.java
Patch:
@@ -12,8 +12,8 @@
 
 public class NovelParseHelper {
 
-    private static final Pattern PAGE_PATTERN = Pattern.compile("\\[newpage\\]");
-    private static final Pattern CHAPTER_PATTERN = Pattern.compile("\\[chapter:(.+)\\]");
+    private static final Pattern PAGE_PATTERN = Pattern.compile("\\[newpage]");
+    private static final Pattern CHAPTER_PATTERN = Pattern.compile("\\[chapter:(.+)]");
 
     public static List<NovelDetail.NovelChapterBean> tryParseChapters(String content) {
         if (TextUtils.isEmpty(content)) {

File: app/src/main/java/ceui/lisa/helper/PageTransformerHelper.java
Patch:
@@ -80,9 +80,9 @@ public static void setCurrentTransformer(int index) {
 
     private static class TransformerType {
 
-        private int typeId;
+        private final int typeId;
         private int nameResId;
-        private Class<? extends ABaseTransformer> pageTransformer;
+        private final Class<? extends ABaseTransformer> pageTransformer;
 
         public TransformerType(int typeId, Class<? extends ABaseTransformer> pageTransformer) {
             this.typeId = typeId;

File: app/src/main/java/ceui/lisa/helper/SAFactory.java
Patch:
@@ -17,7 +17,7 @@
 
 public class SAFactory extends UriFactory {
 
-    private DownloadItem mItem;
+    private final DownloadItem mItem;
     private Uri mUri;
 
     public SAFactory(@NotNull Context context, DownloadItem item) {

File: app/src/main/java/ceui/lisa/helper/ThemeHelper.java
Patch:
@@ -17,7 +17,7 @@ public enum ThemeType {
         DARK_MODE(2, R.string.string_300);
 
         public int themeTypeIndex;
-        private int themeTypeNameResId;
+        private final int themeTypeNameResId;
 
         ThemeType(int themeTypeIndex, int themeTypeNameResId) {
             this.themeTypeIndex = themeTypeIndex;

File: app/src/main/java/ceui/lisa/http/Retro.java
Patch:
@@ -1,5 +1,6 @@
 package ceui.lisa.http;
 
+import android.annotation.SuppressLint;
 import android.util.Log;
 
 import com.blankj.utilcode.util.DeviceUtils;
@@ -125,6 +126,7 @@ public static <T> T create(String baseUrl, final Class<T> service) {
         return retrofit.create(service);
     }
 
+    @SuppressLint("CustomX509TrustManager")
     static class pixivOkHttpClient implements X509TrustManager {
         public void checkClientTrusted(X509Certificate[] param1ArrayOfX509Certificate, String param1String) {
         }

File: app/src/main/java/ceui/lisa/http/RubySSLSocketFactory.java
Patch:
@@ -23,7 +23,7 @@
 
 public final class RubySSLSocketFactory extends SSLSocketFactory {
 
-    private HostnameVerifier hostnameVerifier = HttpsURLConnection.getDefaultHostnameVerifier();
+    private final HostnameVerifier hostnameVerifier = HttpsURLConnection.getDefaultHostnameVerifier();
 
     @Nullable
     public Socket createSocket(@Nullable String paramString, int paramInt) {

File: app/src/main/java/ceui/lisa/notification/CallBackReceiver.java
Patch:
@@ -6,7 +6,7 @@
 
 public class CallBackReceiver extends BroadcastReceiver {
 
-    private BaseReceiver.CallBack mCallBack;
+    private final BaseReceiver.CallBack mCallBack;
 
     public CallBackReceiver(BaseReceiver.CallBack callBack) {
         mCallBack = callBack;

File: app/src/main/java/ceui/lisa/notification/DownloadReceiver.java
Patch:
@@ -12,8 +12,8 @@
 
 public class DownloadReceiver<T> extends BroadcastReceiver {
 
-    private Callback<T> mCallback;
-    private int type; // 0是通知FragmentDownloading, 1是通知FragmentDownloadFinish
+    private final Callback<T> mCallback;
+    private final int type; // 0是通知FragmentDownloading, 1是通知FragmentDownloadFinish
     public static final int NOTIFY_FRAGMENT_DOWNLOADING = 0;
     public static final int NOTIFY_FRAGMENT_DOWNLOAD_FINISH = 1;
 

File: app/src/main/java/ceui/lisa/notification/FilterReceiver.java
Patch:
@@ -6,7 +6,7 @@
 
 public class FilterReceiver extends BroadcastReceiver {
 
-    private BaseReceiver.CallBack mCallBack;
+    private final BaseReceiver.CallBack mCallBack;
 
     public FilterReceiver(BaseReceiver.CallBack callBack) {
         mCallBack = callBack;

File: app/src/main/java/ceui/lisa/page/ScreenUtils.java
Patch:
@@ -119,9 +119,8 @@ private static boolean hasNavigationBar() {
     }
 
     public static DisplayMetrics getDisplayMetrics() {
-        DisplayMetrics metrics = Shaft.getContext()
+        return Shaft.getContext()
                 .getResources()
                 .getDisplayMetrics();
-        return metrics;
     }
 }

File: app/src/main/java/ceui/lisa/transformer/UniformScaleTransformation.java
Patch:
@@ -13,8 +13,8 @@
 
 public class UniformScaleTransformation extends ImageViewTarget<Bitmap> {
 
-    private ImageView target;
-    private boolean changeSize;
+    private final ImageView target;
+    private final boolean changeSize;
 
     public UniformScaleTransformation(ImageView target, boolean c) {
         super(target);

File: app/src/main/java/ceui/lisa/ui/behavior/FragmentRightContentBehavior.java
Patch:
@@ -17,7 +17,7 @@ public class FragmentRightContentBehavior extends CoordinatorLayout.Behavior<Vie
     private float headerHeight;
     private View contentView;
     private OverScroller scroller;
-    private Runnable scrollRunnable = new Runnable() {
+    private final Runnable scrollRunnable = new Runnable() {
         @Override
         public void run() {
             if (scroller != null) {

File: app/src/main/java/ceui/lisa/ui/behavior/UserContentBehavior.java
Patch:
@@ -18,7 +18,7 @@ public class UserContentBehavior extends CoordinatorLayout.Behavior<View> {
     private View centerView, toolbarTitleView;
     private OverScroller scroller;
     private int toolbarHeight;
-    private Runnable scrollRunnable = new Runnable() {
+    private final Runnable scrollRunnable = new Runnable() {
         @Override
         public void run() {
             if (scroller != null) {

File: app/src/main/java/ceui/lisa/utils/Emoji.java
Patch:
@@ -102,7 +102,7 @@ public static String replace(String origin, String emoji) {
         return origin.replace(emoji, "");
     }
 
-    private static Map<String, String> map = new HashMap<>();
+    private static final Map<String, String> map = new HashMap<>();
     private static final String HEAD = "<img class=\"_2sgsdWB\" width=\"24\" height=\"24\" src=\"";
     private static final String OFF = "\">";
 

File: app/src/main/java/ceui/lisa/utils/PixivSearchParamUtil.java
Patch:
@@ -9,7 +9,7 @@
 
 public class PixivSearchParamUtil {
 
-    private static Resources resources = Shaft.getContext().getResources();
+    private static final Resources resources = Shaft.getContext().getResources();
 
     public static final String POPULAR_SORT_VALUE = "popular_desc";
     public static final String[] TAG_MATCH_VALUE = new String[]{"partial_match_for_tags",

File: app/src/main/java/ceui/lisa/utils/ReverseImage.java
Patch:
@@ -52,15 +52,15 @@ public static void reverse(Uri imageUri, ReverseProvider reverseProvider, Callba
                 break;
             case "SauceNao":
                 formData = MultipartBody.Part.createFormData("file", "pixiv_image.png", requestBody);
-                observable = ((SauceNaoApi) o).query(formData).timeout(60, TimeUnit.SECONDS);
+                observable = ((SauceNaoApi) o).query(formData).timeout(30, TimeUnit.SECONDS);
                 break;
             case "TinEye":
                 formData = MultipartBody.Part.createFormData("image", "pixiv_image.png", requestBody);
                 observable = ((TinEyeApi) o).query(formData);
                 break;
             case "Ascii2D":
                 formData = MultipartBody.Part.createFormData("file", "pixiv_image.png", requestBody);
-                observable = ((Ascii2DApi) o).query(formData);
+                observable = ((Ascii2DApi) o).query(formData).timeout(30, TimeUnit.SECONDS);
                 break;
             default:
                 throw new IllegalStateException("Unexpected value: " + reverseProvider.name());

File: app/src/main/java/ceui/lisa/utils/SearchTypeUtil.java
Patch:
@@ -12,7 +12,7 @@
 
 public class SearchTypeUtil {
 
-    private static Resources resources = Shaft.getContext().getResources();
+    private static final Resources resources = Shaft.getContext().getResources();
     public static final int defaultSearchType = 5;
 
     private static final Pattern WEB_URL_PATTERN = Patterns.WEB_URL;

File: app/src/main/java/ceui/lisa/utils/ShareIllust.java
Patch:
@@ -13,8 +13,8 @@
 public abstract class ShareIllust implements IExecutor {
 
     public static final String URL_Head = "https://www.pixiv.net/artworks/";
-    private IllustsBean mIllustsBean;
-    private Context mContext;
+    private final IllustsBean mIllustsBean;
+    private final Context mContext;
 
     public ShareIllust(Context context, IllustsBean illustsBean) {
         mContext = context;

File: app/src/main/java/ceui/lisa/view/BottomSlideLayout.java
Patch:
@@ -103,7 +103,7 @@ public boolean onTouchEvent(MotionEvent event) {
                 break;
             case MotionEvent.ACTION_MOVE:
                 int endY = (int) event.getY();
-                int dy = (int) (endY - downY);
+                int dy = endY - downY;
                 int toScroll = getScrollY() - dy;
                 if(toScroll < 0){
                     toScroll = 0;

File: app/src/main/java/ceui/lisa/view/DownloadItemDecoration.java
Patch:
@@ -7,8 +7,8 @@
 
 public class DownloadItemDecoration extends RecyclerView.ItemDecoration {
 
-    private int spanCount;
-    private int spacing;
+    private final int spanCount;
+    private final int spacing;
 
     public DownloadItemDecoration(int spanCount, int spacing) {
         this.spanCount = spanCount;

File: app/src/main/java/ceui/lisa/view/LinearItemDecoration.java
Patch:
@@ -6,7 +6,7 @@
 import androidx.recyclerview.widget.RecyclerView;
 
 public class LinearItemDecoration extends RecyclerView.ItemDecoration {
-    private int space;
+    private final int space;
 
     public LinearItemDecoration(int space) {
         this.space = space;

File: app/src/main/java/ceui/lisa/view/LinearItemDecorationNoLRTB.java
Patch:
@@ -6,7 +6,7 @@
 import androidx.recyclerview.widget.RecyclerView;
 
 public class LinearItemDecorationNoLRTB extends RecyclerView.ItemDecoration {
-    private int space;
+    private final int space;
 
     public LinearItemDecorationNoLRTB(int space) {
         this.space = space;

File: app/src/main/java/ceui/lisa/view/LinearItemHorizontalDecoration.java
Patch:
@@ -6,7 +6,7 @@
 import androidx.recyclerview.widget.RecyclerView;
 
 public class LinearItemHorizontalDecoration extends RecyclerView.ItemDecoration {
-    private int space;
+    private final int space;
 
     public LinearItemHorizontalDecoration(int space) {
         this.space = space;

File: app/src/main/java/ceui/lisa/view/LinearItemWithHeadDecoration.java
Patch:
@@ -6,7 +6,7 @@
 import androidx.recyclerview.widget.RecyclerView;
 
 public class LinearItemWithHeadDecoration extends RecyclerView.ItemDecoration {
-    private int space;
+    private final int space;
 
     public LinearItemWithHeadDecoration(int space) {
         this.space = space;

File: app/src/main/java/ceui/lisa/view/MultiImageView.java
Patch:
@@ -33,7 +33,7 @@ public class MultiImageView extends LinearLayout {
      */
     private int pxOneMaxWandH;  // 单张图最大允许宽高
     private int pxMoreWandH = 0;// 多张图的宽高
-    private int pxImagePadding = new DensityUtil().dip2px(3.0f);// 图片间的间距
+    private final int pxImagePadding = new DensityUtil().dip2px(3.0f);// 图片间的间距
 
     private int MAX_PER_ROW_COUNT = 3;// 每行显示最大数
 

File: app/src/main/java/ceui/lisa/view/SilverLinkView.java
Patch:
@@ -22,8 +22,8 @@ public class SilverLinkView extends View implements GestureDetector.OnGestureLis
     private Context mContext;
     private Canvas mCanvas;
     private float centerX, centerY;
-    private Handler mHandler = new Handler();
-    private HashMap<Integer, Integer> mHashMap = new HashMap<>();
+    private final Handler mHandler = new Handler();
+    private final HashMap<Integer, Integer> mHashMap = new HashMap<>();
     private GestureDetector mGestureDetector;
     private Paint mPaint;
     private final int[] colors = new int[]{
@@ -198,7 +198,7 @@ private void end() {
     }
 
 
-    private Runnable mRunnable = new Runnable() {
+    private final Runnable mRunnable = new Runnable() {
         @Override
         public void run() {
             Common.showLog("SilverLinkView Runnable");

File: app/src/main/java/ceui/lisa/view/SpacesItemDecoration.java
Patch:
@@ -10,7 +10,7 @@
 
 public class SpacesItemDecoration extends RecyclerView.ItemDecoration {
 
-    private int space;
+    private final int space;
 
     public SpacesItemDecoration(int space) {
         this.space = space;

File: app/src/main/java/ceui/lisa/view/SpacesItemWithHeadDecoration.java
Patch:
@@ -10,7 +10,7 @@
 
 public class SpacesItemWithHeadDecoration extends RecyclerView.ItemDecoration {
 
-    private int space;
+    private final int space;
 
     public SpacesItemWithHeadDecoration(int space) {
         this.space = space;

File: app/src/main/java/ceui/lisa/view/TagItemDecoration.java
Patch:
@@ -7,9 +7,9 @@
 
 public class TagItemDecoration extends RecyclerView.ItemDecoration {
 
-    private int spanCount;
-    private int spacing;
-    private boolean includeEdge;
+    private final int spanCount;
+    private final int spacing;
+    private final boolean includeEdge;
 
     public TagItemDecoration(int spanCount, int spacing, boolean includeEdge) {
         this.spanCount = spanCount;

File: app/src/main/java/ceui/lisa/view/TagItemDecoration2.java
Patch:
@@ -7,7 +7,7 @@
 
 public class TagItemDecoration2 extends RecyclerView.ItemDecoration {
 
-    private int spacing;
+    private final int spacing;
 
     public TagItemDecoration2(int spacing) {
         this.spacing = spacing;

File: app/src/main/java/ceui/lisa/viewmodel/RecmdModel.java
Patch:
@@ -7,7 +7,7 @@
 
 public class RecmdModel extends BaseModel<IllustsBean> {
 
-    private List<IllustsBean> rankList = new ArrayList<>();
+    private final List<IllustsBean> rankList = new ArrayList<>();
 
     public List<IllustsBean> getRankList() {
         return rankList;

File: app/src/main/java/ceui/lisa/activities/MainActivity.java
Patch:
@@ -366,12 +366,12 @@ protected void onActivityResult(int requestCode, int resultCode, Intent data) {
         if (requestCode == Params.REQUEST_CODE_CHOOSE && resultCode == RESULT_OK) {
             try {
                 Uri imageUri = data.getData();
-                if (!Common.isFileSizeOkToReverseSearch(imageUri)) {
+                if (!ReverseImage.isFileSizeOkToSearch(imageUri, ReverseImage.DEFAULT_ENGINE)) {
                     Common.showToast(getString(R.string.string_410));
                     return;
                 }
-                ReverseImage.reverse(UriUtils.uri2Bytes(imageUri),
-                        ReverseImage.ReverseProvider.SauceNao, new ReverseWebviewCallback(this));
+                ReverseImage.reverse(imageUri,
+                        ReverseImage.DEFAULT_ENGINE, new ReverseWebviewCallback(this, imageUri));
             } catch (Exception e) {
                 e.printStackTrace();
             }

File: app/src/main/java/ceui/lisa/fragments/FragmentIllust.java
Patch:
@@ -96,7 +96,7 @@ protected void initView() {
                 public void onClick(View widget) {
                     Intent intent = new Intent(mContext, TemplateActivity.class);
                     intent.putExtra(TemplateActivity.EXTRA_FRAGMENT, "漫画系列详情");
-                    intent.putExtra(Params.ID, illust.getSeries().getId());
+                    intent.putExtra(Params.MANGA_SERIES_ID, illust.getSeries().getId());
                     startActivity(intent);
                 }
 

File: app/src/main/java/ceui/lisa/fragments/FragmentSAF.java
Patch:
@@ -46,8 +46,7 @@ public void onClick(View v) {
             @Override
             public void onClick(View v) {
                 IllustsBean illustsBean = Shaft.sGson.fromJson(Params.EXAMPLE_ILLUST, IllustsBean.class);
-                DocumentFile childFile = SAFile.getDocument(mContext, illustsBean, 0);
-
+                DocumentFile childFile = SAFile.getDocument(mContext, illustsBean, 0, true);
             }
         });
     }

File: app/src/main/java/ceui/lisa/fragments/FragmentSingleIllust.java
Patch:
@@ -172,7 +172,7 @@ public void initView() {
                 public void onClick(View widget) {
                     Intent intent = new Intent(mContext, TemplateActivity.class);
                     intent.putExtra(TemplateActivity.EXTRA_FRAGMENT, "漫画系列详情");
-                    intent.putExtra(Params.ID, illust.getSeries().getId());
+                    intent.putExtra(Params.MANGA_SERIES_ID, illust.getSeries().getId());
                     startActivity(intent);
                 }
 

File: app/src/main/java/ceui/lisa/helper/SAFactory.java
Patch:
@@ -23,6 +23,8 @@ public class SAFactory extends UriFactory {
     public SAFactory(@NotNull Context context, DownloadItem item) {
         super(context);
         this.mItem = item;
+        DocumentFile file = SAFile.getDocument(getContext(), mItem.getIllust(), mItem.getIndex(), mItem.getTransferredBytes()==0);
+        mUri = file.getUri();
     }
 
     @Nullable
@@ -34,8 +36,6 @@ public Uri query() {
     @NotNull
     @Override
     public Uri insert(@NotNull Response response) {
-        DocumentFile file = SAFile.getDocument(getContext(), mItem.getIllust(), mItem.getIndex());
-        mUri = file.getUri();
         return mUri;
     }
 

File: app/src/main/java/ceui/lisa/http/RubySSLSocketFactory.java
Patch:
@@ -53,6 +53,7 @@ public Socket createSocket(@Nullable Socket paramSocket, @Nullable String paramS
         InetAddress inetAddress = paramSocket.getInetAddress();
         Intrinsics.checkExpressionValueIsNotNull(inetAddress, "address");
         Log.d("createSocket address1", inetAddress.getHostAddress());
+        // okhttp3 4.5.0 版本引入修改，okhttp3.internal.connection.RealConnection->isHealthy中，检查了rawSocket.isClosed状态，如果需要更新到高版本依然可用，注释下方2行
         if (paramBoolean)
             paramSocket.close();
         SocketFactory socketFactory = SSLCertificateSocketFactory.getDefault(0);

File: app/src/main/java/ceui/lisa/utils/Common.java
Patch:
@@ -423,14 +423,14 @@ public static int getNovelTextColor(){
      * @param uri 文件地址
      * @return 大小是否可搜索
      */
-    public static boolean isFileSizeOkToReverseSearch(Uri uri) {
+    public static boolean isFileSizeOkToReverseSearch(Uri uri, long maxImageSize) {
         Cursor cursor = Shaft.getContext().getContentResolver().query(uri, null, null, null, null);
         if (cursor == null) {
             return false;
         }
         int sizeIndex = cursor.getColumnIndex(OpenableColumns.SIZE);
         cursor.moveToFirst();
-        boolean ret = cursor.getLong(sizeIndex) <= ReverseImage.IMAGE_MAX_SIZE;
+        boolean ret = cursor.getLong(sizeIndex) <= maxImageSize;
         cursor.close();
         return ret;
     }

File: app/src/main/java/ceui/lisa/utils/Params.java
Patch:
@@ -45,6 +45,9 @@ public class Params {
     public static final String TAG_NAMES  = "tag names";
     public static final String MAIN_ACTIVITY_NAVIGATION_POSITION  = "main activity navigation position";
     public static final String FRAGMENT_SEARCH_CLIPBOARD_VALUE  = "fragment search clipboard value";
+    public static final String MANGA_SERIES_ID  = "manga series id";
+    public static final String REVERSE_SEARCH_RESULT = "reverse result";
+    public static final String REVERSE_SEARCH_IMAGE_URI = "reverse image uri";
 
 
     public static final String VIEW_PAGER_MUTED  = "muted history viewpager";

File: app/src/main/java/ceui/lisa/fragments/FragmentMultiDownld.java
Patch:
@@ -89,7 +89,7 @@ public boolean onMenuItemClick(MenuItem item) {
                         Common.showToast("没有选择任何作品");
                     } else {
                         //不需要下载txt文件
-                        IllustDownload.downloadNovel((BaseActivity<?>) mContext,
+                        IllustDownload.downloadFile((BaseActivity<?>) mContext,
                                 System.currentTimeMillis() + "_download_tasks.txt", result,
                                 new Callback<Uri>() {
                                     @Override

File: app/src/main/java/ceui/lisa/fragments/FragmentSearchIllust.java
Patch:
@@ -117,7 +117,8 @@ public BaseRepo repository() {
                 //isPopular,
                 searchModel.getIsPremium().getValue(),
                 searchModel.getStartDate().getValue(),
-                searchModel.getEndDate().getValue()
+                searchModel.getEndDate().getValue(),
+                searchModel.getR18Restriction().getValue()
         );
     }
 

File: app/src/main/java/ceui/lisa/utils/ReverseImage.java
Patch:
@@ -2,6 +2,7 @@
 
 
 import java.io.File;
+import java.util.concurrent.TimeUnit;
 
 import ceui.lisa.http.IqdbApi;
 import ceui.lisa.http.Retro;
@@ -44,7 +45,7 @@ public static void reverse(byte[] file, ReverseProvider reverseProvider, Callbac
                 break;
             case "SauceNao":
                 formData = MultipartBody.Part.createFormData("file", "pixiv_image.png", requestBody);
-                observable = ((SauceNaoApi) o).query(formData);
+                observable = ((SauceNaoApi) o).query(formData).timeout(60, TimeUnit.SECONDS);
                 break;
             case "TinEye":
                 formData = MultipartBody.Part.createFormData("image", "pixiv_image.png", requestBody);

File: app/src/main/java/ceui/lisa/activities/TemplateActivity.java
Patch:
@@ -49,6 +49,7 @@
 import ceui.lisa.fragments.FragmentRecmdIllust;
 import ceui.lisa.fragments.FragmentRecmdUser;
 import ceui.lisa.fragments.FragmentRelatedIllust;
+import ceui.lisa.fragments.FragmentRelatedUser;
 import ceui.lisa.fragments.FragmentSAF;
 import ceui.lisa.fragments.FragmentSB;
 import ceui.lisa.fragments.FragmentSearch;
@@ -218,6 +219,8 @@ protected Fragment createNewFragment() {
                     return new FragmentColors();
                 case "测试测试":
                     return new FragmentSAF();
+                case "相关用户":
+                    return FragmentRelatedUser.newInstance(intent.getIntExtra(Params.USER_ID, 0));
                 default:
                     return new Fragment();
             }

File: app/src/main/java/ceui/lisa/fragments/FragmentSearch.java
Patch:
@@ -513,8 +513,8 @@ public void onClick(DialogInterface dialog, int which) {
                         if (fromClipboard) {
                             Shaft.getMMKV().putString(Params.FRAGMENT_SEARCH_CLIPBOARD_VALUE, clipboardContent);
                         }
-                        // 对非标签搜索的，进行填充
-                        if (fromClipboard && searchType != SearchTypeUtil.SEARCH_TYPE_DB_KEYWORD) {
+                        // 对非标签搜索且非综合搜索的，进行填充
+                        if (fromClipboard && (searchType != SearchTypeUtil.SEARCH_TYPE_DB_KEYWORD && searchType != SearchTypeUtil.defaultSearchType)) {
                             baseBind.inputBox.setText(clipboardContent);
                         }
                         dialog.dismiss();

File: app/src/main/java/ceui/lisa/http/AppApi.java
Patch:
@@ -307,7 +307,7 @@ Observable<ListIllust> popularPreview(@Header("Authorization") String token,
                                           @Query("end_date") String endDate,
                                           @Query("search_target") String search_target);
 
-    @GET("v1/search/popular-preview/novel?filter=for_android&include_translated_tag_results=true&merge_plain_keyword_results=true&search_target=exact_match_for_tags")
+    @GET("v1/search/popular-preview/novel?filter=for_android&include_translated_tag_results=true&merge_plain_keyword_results=true")
     Observable<ListNovel> popularNovelPreview(@Header("Authorization") String token,
                                           @Query("word") String word,
                                           @Query("start_date") String startDate,

File: app/src/main/java/ceui/lisa/fragments/FragmentSearchNovel.java
Patch:
@@ -85,6 +85,7 @@ public BaseRepo repository() {
                 searchModel.getSortType().getValue(),
                 searchModel.getSearchType().getValue(),
                 searchModel.getStarSize().getValue(),
+                searchModel.getIsPremium().getValue(),
                 searchModel.getStartDate().getValue(),
                 searchModel.getEndDate().getValue()
         );

File: app/src/main/java/ceui/lisa/utils/PixivSearchParamUtil.java
Patch:
@@ -17,7 +17,7 @@ public class PixivSearchParamUtil {
             "exact_match_for_tags", "text", "keyword"};
     public static final String[] ALL_SIZE_VALUE = new String[]{"", "500users入り", "1000users入り", "2000users入り",
             "5000users入り", "7500users入り", "10000users入り", "20000users入り", "50000users入り", "100000users入り"};
-    public static final String[] DATE_SORT_VALUE = new String[]{"date_desc", "date_asc"};
+    public static final String[] DATE_SORT_VALUE = new String[]{"date_desc", "date_asc","popular_desc"};
 
     public static String[] TAG_MATCH_NAME = new String[]{
             resources.getString(R.string.string_284),
@@ -46,7 +46,8 @@ public class PixivSearchParamUtil {
 
     public static String[] DATE_SORT_NAME = new String[]{
             resources.getString(R.string.string_287),
-            resources.getString(R.string.string_288)
+            resources.getString(R.string.string_288),
+            resources.getString(R.string.string_64_1)
     };
 
     public static final String POPULAR_SORT_VALUE = "popular_desc";

File: app/src/main/java/ceui/lisa/core/Manager.java
Patch:
@@ -258,7 +258,7 @@ public File whichFile() {
                             }
                             return new File(uri.getPath());
                         }
-                    }.execute(context);
+                    }.execute();
 
                     safeDelete(bean);
                 }, throwable -> {

File: app/src/main/java/ceui/lisa/utils/Common.java
Patch:
@@ -6,7 +6,6 @@
 import android.content.Intent;
 import android.content.pm.PackageInfo;
 import android.content.pm.PackageManager;
-import android.content.res.Configuration;
 import android.database.Cursor;
 import android.net.Uri;
 import android.os.Build;

File: app/src/main/java/ceui/lisa/core/Manager.java
Patch:
@@ -258,7 +258,7 @@ public File whichFile() {
                             }
                             return new File(uri.getPath());
                         }
-                    }.execute(context);
+                    }.execute();
 
                     safeDelete(bean);
                 }, throwable -> {

File: app/src/main/java/ceui/lisa/fragments/FragmentLocalUsers.java
Patch:
@@ -131,9 +131,7 @@ public void onClick(View v) {
                 Local.saveUser(userModel);
                 Dev.refreshUser = true;
                 Shaft.sUserModel = userModel;
-                Intent intent = new Intent(mContext, MainActivity.class);
-                intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_CLEAR_TASK);
-                MainActivity.newInstance(intent, mContext);
+                Common.restart();
                 mActivity.finish();
             }
         });

File: app/src/main/java/ceui/lisa/utils/Common.java
Patch:
@@ -6,7 +6,6 @@
 import android.content.Intent;
 import android.content.pm.PackageInfo;
 import android.content.pm.PackageManager;
-import android.content.res.Configuration;
 import android.database.Cursor;
 import android.net.Uri;
 import android.os.Build;

File: app/src/main/java/ceui/lisa/activities/OutWakeActivity.java
Patch:
@@ -120,7 +120,7 @@ public void doSomething(Void t) {
                     if (scheme.contains("http")) {
                         try {
                             String uriString = uri.toString();
-                            if (uriString.contains(HostManager.HOST_OLD)) {
+                            if (uriString.toLowerCase().contains(HostManager.HOST_OLD)) {
                                 int index = uriString.lastIndexOf("/");
                                 String end = uriString.substring(index + 1);
                                 String idString = end.split("_")[0];
@@ -133,15 +133,15 @@ public void doSomething(Void t) {
                                     }
                                 },null);
                                 return;
-                            } else if (uriString.contains(HOST_ME)) {
+                            } else if (uriString.toLowerCase().contains(HOST_ME)) {
                                 Intent i = new Intent(mContext, TemplateActivity.class);
                                 i.putExtra(Params.URL, uriString);
                                 i.putExtra(Params.TITLE, HOST_ME);
                                 i.putExtra(TemplateActivity.EXTRA_FRAGMENT, "网页链接");
                                 startActivity(i);
                                 finish();
                                 return;
-                            } else if (uriString.contains(HOST_PIXIVISION)) {
+                            } else if (uriString.toLowerCase().contains(HOST_PIXIVISION)) {
                                 Intent i = new Intent(mContext, TemplateActivity.class);
                                 i.putExtra(Params.URL, uriString);
                                 i.putExtra(Params.TITLE, getString(R.string.pixiv_special));

File: app/src/main/java/ceui/lisa/adapters/SimpleUserAdapter.java
Patch:
@@ -108,7 +108,7 @@ public void onItemLongClick(View v, int position, int viewType) {
                     PixivOperate.unMuteUser(allIllust.get(position));
                     allIllust.remove(position);
                     notifyDataSetChanged();
-                } else if (viewType == 1 && !allIllust.get(position).isIs_followed()) {
+                } else if (viewType == 1) {
                     PixivOperate.postFollowUser(allIllust.get(position).getId(),
                             Params.TYPE_PRIVATE);
                     Button postFollow = ((Button) v);

File: app/src/main/java/ceui/lisa/fragments/FragmentSingleUgora.java
Patch:
@@ -506,7 +506,7 @@ public boolean onTagLongClick(View view, int position, FlowLayout parent) {
         } else {
             baseBind.description.setVisibility(View.GONE);
         }
-        baseBind.illustDate.setText(illust.getCreate_date().substring(0, 16));
+        baseBind.illustDate.setText(Common.getLocalYYYYMMDDHHMMString(illust.getCreate_date()));
         baseBind.illustView.setText(String.valueOf(illust.getTotal_view()));
         baseBind.illustLike.setText(String.valueOf(illust.getTotal_bookmarks()));
 

File: app/src/main/java/ceui/lisa/adapters/ColorAdapter.java
Patch:
@@ -22,6 +22,8 @@
 import ceui.lisa.utils.Dev;
 import ceui.lisa.utils.Local;
 
+import static com.blankj.utilcode.util.StringUtils.getString;
+
 public class ColorAdapter extends BaseAdapter<ColorItem, RecyColorBinding> {
 
     public ColorAdapter(@Nullable List<ColorItem> targetList, Context context) {
@@ -62,7 +64,7 @@ public void onItemClick(View v, int position, int viewType) {
                 Shaft.sSettings.setThemeIndex(position);
                 Local.setSettings(Shaft.sSettings);
                 Common.restart();
-                Common.showToast("设置成功", 2);
+                Common.showToast(getString(R.string.string_428), 2);
             }
         });
     }

File: app/src/main/java/ceui/lisa/adapters/UAdapter.java
Patch:
@@ -15,7 +15,6 @@
 
 import ceui.lisa.R;
 import ceui.lisa.databinding.RecyUserPreviewBinding;
-import ceui.lisa.fragments.FragmentLikeIllust;
 import ceui.lisa.interfaces.FullClickListener;
 import ceui.lisa.models.IllustsBean;
 import ceui.lisa.models.NovelBean;

File: app/src/main/java/ceui/lisa/fragments/FragmentFileName.java
Patch:
@@ -74,7 +74,7 @@ public void onClick(View v) {
             @Override
             public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
                 Shaft.sSettings.setHasP0(isChecked);
-                Common.showToast("设置成功");
+                Common.showToast(getString(R.string.string_428));
                 Local.setSettings(Shaft.sSettings);
             }
         });

File: app/src/main/java/ceui/lisa/fragments/FragmentRecmdIllust.java
Patch:
@@ -180,6 +180,7 @@ public Void execute() {
         }, new TryCatchObserverImpl<>());
         ((RecmdModel) mModel).getRankList().addAll(((RecmdIllust) mResponse).getRanking_illusts());
         ((IAdapterWithHeadView) mAdapter).setHeadData(((RecmdModel) mModel).getRankList());
+        ((RecmdModel) mModel).tidyAppViewModel(((RecmdModel) mModel).getRankList());
     }
 
     private void insertViewHistory(IllustsBean illustsBean) {
@@ -214,6 +215,7 @@ public List<IllustsBean> execute() throws Exception {
             public void success(List<IllustsBean> illustsBeans) {
                 allItems.addAll(illustsBeans);
                 ((RecmdModel) mModel).getRankList().addAll(illustsBeans);
+                ((RecmdModel) mModel).tidyAppViewModel(illustsBeans);
                 ((IAdapterWithHeadView) mAdapter).setHeadData(((RecmdModel) mModel).getRankList());
                 mAdapter.notifyItemRangeInserted(mAdapter.headerSize(), allItems.size());
             }

File: app/src/main/java/ceui/lisa/fragments/NetListFragment.java
Patch:
@@ -74,6 +74,7 @@ public void success(Response response) {
                         beforeFirstLoad(mResponseList);
                         int beforeLoadSize = getStartSize();
                         mModel.load(mResponseList, true);
+                        mModel.tidyAppViewModel();
                         allItems = mModel.getContent();
                         int afterLoadSize = getStartSize();
                         onFirstLoaded(mResponseList);
@@ -141,6 +142,7 @@ public void success(Response response) {
                         beforeNextLoad(mResponseList);
                         int beforeLoadSize = getStartSize();
                         mModel.load(mResponseList, false);
+                        mModel.tidyAppViewModel(mResponseList);
                         allItems = mModel.getContent();
                         int afterLoadSize = getStartSize();
                         onNextLoaded(mResponseList);
@@ -254,6 +256,7 @@ public void onReceive(Context context, Intent intent) {
                                 beforeNextLoad(mResponse.getList());
                                 int beforeLoadSize = getStartSize();
                                 mModel.load(mResponse.getList(), false);
+                                mModel.tidyAppViewModel(mResponse.getList());
                                 allItems = mModel.getContent();
                                 int afterLoadSize = getStartSize();
                                 onNextLoaded(mResponse.getList());

File: app/src/main/java/ceui/lisa/utils/Params.java
Patch:
@@ -43,6 +43,8 @@ public class Params {
     public static final String NOVEL_DETAIL  = "novel detail";
     public static final String PREFER_PRESERVE  = "prefer preserve";
     public static final String TAG_NAMES  = "tag names";
+    public static final String MAIN_ACTIVITY_NAVIGATION_POSITION  = "main activity navigation position";
+    public static final String FRAGMENT_SEARCH_CLIPBOARD_VALUE  = "fragment search clipboard value";
 
 
     public static final String VIEW_PAGER_MUTED  = "muted history viewpager";

File: app/src/main/java/ceui/lisa/fragments/FragmentSearchIllust.java
Patch:
@@ -59,11 +59,11 @@ public void onChanged(String s) {
                     return;
                 }
                 ((SearchIllustRepo) mRemoteRepo).update(searchModel, isPopular);
-                if(isPopular){
-                    if(TextUtils.isEmpty(searchModel.getKeyword().getValue())){
+                if (isPopular) {
+                    if (TextUtils.isEmpty(searchModel.getKeyword().getValue())) {
                         mRefreshLayout.setEnableRefresh(false);
                         return;
-                    }else{
+                    } else {
                         mRefreshLayout.setEnableRefresh(true);
                     }
                 }

File: app/src/main/java/ceui/lisa/activities/RankActivity.java
Patch:
@@ -167,7 +167,7 @@ public boolean onOptionsItemSelected(MenuItem item) {
                 );
             }
             Calendar start = Calendar.getInstance();
-            start.set(2008, 1, 1);
+            start.set(2008, 0, 1);
             dpd.setMinDate(start);
             dpd.setMaxDate(now);
             dpd.setAccentColor(Common.resolveThemeAttribute(mContext, R.attr.colorPrimary));

File: app/src/main/java/ceui/lisa/core/Mapper.java
Patch:
@@ -23,7 +23,8 @@ public T apply(T t) {
                 boolean isTagBanned = IllustFilter.judgeTag((IllustsBean) o);
                 boolean isIdBanned = IllustFilter.judgeID((IllustsBean) o);
                 boolean isUserBanned = IllustFilter.judgeUserID((IllustsBean) o);
-                if (isTagBanned || isIdBanned || isUserBanned) {
+                boolean isR18FilterBanned = IllustFilter.judgeR18Filter((IllustsBean) o);
+                if (isTagBanned || isIdBanned || isUserBanned || isR18FilterBanned) {
                     dash.add((IllustsBean) o);
                 }
             }

File: app/src/main/java/ceui/lisa/database/DownloadDao.java
Patch:
@@ -138,4 +138,7 @@ public interface DownloadDao {
 
     @Query("DELETE FROM feature_table")
     void deleteAllFeature();
+
+    @Query("SELECT * FROM feature_table")
+    List<FeatureEntity> getAllFeatureEntities();
 }

File: app/src/main/java/ceui/lisa/fragments/FragmentIllust.java
Patch:
@@ -432,9 +432,9 @@ public void onResume() {
     private int recyHeight = 0;
 
     private void checkDownload() {
-        if(Common.isIllustDownloaded(illust)){
+        if (Common.isIllustDownloaded(illust)) {
             baseBind.download.setText(R.string.string_337);
-        }else{
+        } else {
             baseBind.download.setText(R.string.string_72);
         }
     }

File: app/src/main/java/ceui/lisa/fragments/FragmentSearchNovel.java
Patch:
@@ -84,7 +84,9 @@ public BaseRepo repository() {
                 searchModel.getKeyword().getValue(),
                 searchModel.getSortType().getValue(),
                 searchModel.getSearchType().getValue(),
-                searchModel.getStarSize().getValue()
+                searchModel.getStarSize().getValue(),
+                searchModel.getStartDate().getValue(),
+                searchModel.getEndDate().getValue()
         );
     }
 

File: app/src/main/java/ceui/lisa/fragments/ListFragment.java
Patch:
@@ -26,7 +26,7 @@
 import ceui.lisa.activities.Shaft;
 import ceui.lisa.adapters.BaseAdapter;
 import ceui.lisa.core.BaseRepo;
-import ceui.lisa.helper.StaggeredtManager;
+import ceui.lisa.helper.StaggeredManager;
 import ceui.lisa.interfaces.FeedBack;
 import ceui.lisa.utils.DensityUtil;
 import ceui.lisa.view.LinearItemDecoration;
@@ -218,7 +218,7 @@ public void verticalRecyclerView() {
     }
 
     protected void staggerRecyclerView() {
-        StaggeredtManager manager = new StaggeredtManager(
+        StaggeredManager manager = new StaggeredManager(
                 Shaft.sSettings.getLineCount(), StaggeredGridLayoutManager.VERTICAL);
         mRecyclerView.setLayoutManager(manager);
         mRecyclerView.addItemDecoration(new SpacesItemDecoration(

File: app/src/main/java/ceui/lisa/helper/FileStorageHelper.java
Patch:
@@ -60,13 +60,15 @@ public static String getShaftIllustDirWithInnerR18Folder(boolean isR18) {
         return "ShaftImages" + getShaftIllustPathPartWithInnerR18Folder(isR18);
     }
 
+    /*
     public static String getShaftIllustDir(IllustsBean illustsBean) {
         return getShaftIllustDir(isSaveToR18Dir(illustsBean));
     }
 
     private static String getShaftIllustDir(boolean isR18) {
         return isR18 ? "ShaftImages-R18" : "ShaftImages";
     }
+     */
 
     private static boolean isSaveToR18Dir(IllustsBean illustsBean){
         return illustsBean.isR18File() && Shaft.sSettings.isR18DivideSave();

File: app/src/main/java/ceui/lisa/viewmodel/BaseModel.java
Patch:
@@ -16,7 +16,7 @@
 
 public class BaseModel<T> extends ViewModel{
 
-    private List<T> content = null;
+    List<T> content = null;
     private boolean isLoaded = false;
     private BaseRepo mBaseRepo;
 

File: app/src/main/java/ceui/lisa/http/AccountTokenApi.java
Patch:
@@ -8,9 +8,6 @@
 
 public interface AccountTokenApi {
 
-    //用作登录，刷新token
-    String ACCOUNT_BASE_URL = "https://oauth.secure.pixiv.net/";
-
     @FormUrlEncoded
     @POST("/auth/token")
     Call<UserModel> newRefreshToken(@Field("client_id") String client_id,

File: app/src/main/java/ceui/lisa/http/TokenInterceptor.java
Patch:
@@ -89,7 +89,7 @@ private synchronized String getNewToken(String tokenForThisRequest) throws IOExc
                 Shaft.sUserModel.getAccess_token().length() != TOKEN_LENGTH) {
             Common.showLog("getNewToken 主动获取最新的token old:" + tokenForThisRequest + " new:" + Shaft.sUserModel.getAccess_token());
             UserModel userModel = Local.getUser();
-            Call<UserModel> call = Retro.getAccountApi().newRefreshToken(
+            Call<UserModel> call = Retro.getAccountTokenApi().newRefreshToken(
                     FragmentLogin.CLIENT_ID,
                     FragmentLogin.CLIENT_SECRET,
                     FragmentLogin.REFRESH_TOKEN,

File: app/src/main/java/ceui/lisa/utils/PixivOperate.java
Patch:
@@ -80,7 +80,7 @@ public class PixivOperate {
     private static final long reEncodeTimeThresholdMillis = 60 * 1000;
 
     public static void refreshUserData(UserModel userModel, Callback<UserModel> callback) {
-        Call<UserModel> call = Retro.getAccountApi().newRefreshToken(
+        Call<UserModel> call = Retro.getAccountTokenApi().newRefreshToken(
                 FragmentLogin.CLIENT_ID,
                 FragmentLogin.CLIENT_SECRET,
                 FragmentLogin.REFRESH_TOKEN,

File: app/src/main/java/ceui/lisa/activities/OutWakeActivity.java
Patch:
@@ -60,7 +60,7 @@ protected void initData() {
                 if (!TextUtils.isEmpty(scheme)) {
 
                     if (uri.getPath() != null) {
-                        if (uri.getPath().contains("artworks")) {
+                        if (uri.getPathSegments().contains("artworks") || uri.getPathSegments().contains("i")) {
                             if (isNetWorking) {
                                 return;
                             }
@@ -74,12 +74,12 @@ public void doSomething(Void t) {
                                         finish();
                                     }
                                 });
-                                finish();
+                                // finish(); // wait for callback
                                 return;
                             }
                         }
 
-                        if (uri.getPath().contains("users")) {
+                        if (uri.getPathSegments().contains("users")) {
                             List<String> pathArray = uri.getPathSegments();
                             String userID = pathArray.get(pathArray.size() - 1);
                             if (!TextUtils.isEmpty(userID)) {

File: app/src/main/java/ceui/lisa/activities/RankActivity.java
Patch:
@@ -172,7 +172,7 @@ public boolean onOptionsItemSelected(MenuItem item) {
             dpd.setMaxDate(now);
             dpd.setAccentColor(Common.resolveThemeAttribute(mContext, R.attr.colorPrimary));
             dpd.setThemeDark(mContext.getResources().getBoolean(R.bool.is_night_mode));
-            dpd.show(getFragmentManager(), "DatePickerDialog");
+            dpd.show(getSupportFragmentManager(), "DatePickerDialog");
             return true;
         }
         return super.onOptionsItemSelected(item);

File: app/src/main/java/ceui/lisa/download/FileSizeUtil.java
Patch:
@@ -108,7 +108,7 @@ public static String formatFileSize(long fileS) {
         DecimalFormat df = new DecimalFormat("#.00");
         String fileSizeString = "";
         String wrongSize = "0B";
-        if (fileS == 0) {
+        if (fileS <= 0) {
             return wrongSize;
         }
         if (fileS < 1024) {

File: app/src/main/java/ceui/lisa/download/ImageSaver.java
Patch:
@@ -41,7 +41,7 @@ public void execute(Context context) {
         );
 
 
-        MediaStore.Images.Media.insertImage(context.getContentResolver(), BitmapFactory.decodeFile(file.getAbsolutePath()), file.getName(), null);
+        // MediaStore.Images.Media.insertImage(context.getContentResolver(), BitmapFactory.decodeFile(file.getAbsolutePath()), file.getName(), null);
         Intent intent = new Intent(Intent.ACTION_MEDIA_SCANNER_SCAN_FILE);
         Uri uri = Uri.fromFile(file);
         intent.setData(uri);

File: app/src/main/java/ceui/lisa/fragments/FragmentImageDetail.java
Patch:
@@ -74,8 +74,6 @@ public void initLayout() {
 
     @Override
     protected void initView() {
-        BarUtils.setNavBarVisibility(mActivity, false);
-
         baseBind.realIllustImage.setOnBitmapLoadListener(new OnBitmapLoadListener() {
             @Override
             public void onBitmapLoadReady() {

File: app/src/main/java/ceui/lisa/fragments/FragmentMutedUser.java
Patch:
@@ -71,7 +71,7 @@ public boolean hasNext() {
 
     @Override
     public BaseAdapter<UserBean, RecySimpleUserBinding> adapter() {
-        return new SimpleUserAdapter(allItems, mContext);
+        return new SimpleUserAdapter(allItems, mContext, true);
     }
 
     @Override

File: app/src/main/java/ceui/lisa/fragments/FragmentViewPager.java
Patch:
@@ -57,13 +57,13 @@ public void initView() {
         if (TextUtils.equals(title, Params.VIEW_PAGER_MUTED)) {
             String[] CHINESE_TITLES = new String[]{
                     Shaft.getContext().getString(R.string.string_353),
-                    Shaft.getContext().getString(R.string.string_354),
                     Shaft.getContext().getString(R.string.string_381),
+                    Shaft.getContext().getString(R.string.string_354),
             };
             mFragments = new ListFragment[]{
                     new FragmentMutedTags(),
-                    new FragmentMutedObjects(),
                     new FragmentMutedUser(),
+                    new FragmentMutedObjects(),
             };
             baseBind.toolbar.inflateMenu(R.menu.delete_and_add);
             baseBind.toolbar.setOnMenuItemClickListener((Toolbar.OnMenuItemClickListener) mFragments[0]);

File: app/src/main/java/ceui/lisa/http/Retro.java
Patch:
@@ -12,6 +12,7 @@
 import javax.net.ssl.X509TrustManager;
 
 import ceui.lisa.activities.Shaft;
+import ceui.lisa.helper.LanguageHelper;
 import okhttp3.OkHttpClient;
 import okhttp3.Protocol;
 import okhttp3.Request;
@@ -48,7 +49,7 @@ private static Request.Builder addHeader(Request.Builder before) {
         String osVersion = DeviceUtils.getSDKVersionName();
         String phoneName = DeviceUtils.getModel();
         before.addHeader("User-Agent", "PixivAndroidApp/5.0.234 (Android " + osVersion + "; " + phoneName + ")")
-                .addHeader("accept-language", "zh-cn")
+                .addHeader("accept-language", LanguageHelper.getRequestHeaderAcceptLanguageFromAppLanguage())
                 .addHeader("x-client-time", pixivHeaders.getXClientTime())
                 .addHeader("x-client-hash", pixivHeaders.getXClientHash());
         return before;

File: app/src/main/java/ceui/lisa/utils/ReverseImage.java
Patch:
@@ -25,6 +25,7 @@ public class ReverseImage {
     private static final String IQDB_BASE_URL = "https://iqdb.org/";
     private static final String SAUCENAO_BASE_URL = "https://saucenao.com/";
     private static final String TINEYE_BASE_URL = "https://www.tineye.com/";
+    public static final long IMAGE_MAX_SIZE = 15 * 1024 * 1024; // SauceNao limit: 15MB
 
     public static void reverse(byte[] file, ReverseProvider reverseProvider, Callback callback) {
 

File: models/src/main/java/ceui/lisa/models/MangaSeriesItem.java
Patch:
@@ -1,6 +1,8 @@
 package ceui.lisa.models;
 
-public class MangaSeriesItem {
+import java.io.Serializable;
+
+public class MangaSeriesItem implements Serializable {
 
     /**
      * id : 79357

File: app/src/main/java/ceui/lisa/fragments/FragmentImageDetail.java
Patch:
@@ -179,7 +179,7 @@ public void onSaveInstanceState(@NonNull Bundle outState) {
     }
 
     public void adjustAutoScale() {
-        if (imageWidth <=0 || imageHeight <= 0){
+        if (imageWidth <= 0 || imageHeight <= 0) {
             return;
         }
 

File: app/src/main/java/ceui/lisa/fragments/FragmentRecmdIllust.java
Patch:
@@ -98,7 +98,7 @@ public boolean localData() {
 
     @Override
     public BaseAdapter<IllustsBean, RecyIllustStaggerBinding> adapter() {
-        return new IAdapterWithHeadView(allItems, mContext, dataType).setShowRelated(true);
+        return new IAdapterWithHeadView(allItems, mContext, dataType).setShowRelated(Shaft.sSettings.isShowRelatedWhenStar());
     }
 
     @Override
@@ -130,7 +130,7 @@ public void onReceive(Context context, Intent intent) {
                             if (!Common.isEmpty(temp)) {
                                 if (index < allItems.size()) {
                                     mModel.load(temp, index);
-                                    Common.showToast(index);
+//                                    Common.showToast(index);
                                     mAdapter.notifyItemRangeInserted(index + 1, temp.size());
                                     mAdapter.notifyItemRangeChanged(index + 1, allItems.size() - index - 1);
                                 }

File: app/src/main/java/ceui/lisa/utils/Params.java
Patch:
@@ -89,6 +89,8 @@ public class Params {
 
     public static final String IMAGE_UNKNOWN = "https://s.pximg.net/common/images/limit_unknown_360.png";
     public static final String HEAD_UNKNOWN  = "https://s.pximg.net/common/images/no_profile.png";
+    public static final String URL_R18_SETTING  = "https://www.pixiv.net/settings.php?mode=age-check";
+    public static final String URL_PREMIUM_SETTING  = "https://www.pixiv.net/premium.php#premium-payment";
 
     public static final String TYPE_PUBLUC = "public";
     public static final String TYPE_PRIVATE = "private";

File: app/src/main/java/ceui/lisa/activities/TemplateActivity.java
Patch:
@@ -123,7 +123,7 @@ protected Fragment createNewFragment() {
                 case "账号管理":
                     return new FragmentLocalUsers();
                 case "按标签筛选": {
-                    return FragmentBookedTag.newInstance(intent.getStringExtra(EXTRA_KEYWORD));
+                    return FragmentBookedTag.newInstance(intent.getIntExtra(Params.DATA_TYPE, 0), intent.getStringExtra(EXTRA_KEYWORD));
                 }
                 case "按标签收藏": {
                     int id = intent.getIntExtra(Params.ILLUST_ID, 0);

File: app/src/main/java/ceui/lisa/fragments/FragmentNovelHolder.java
Patch:
@@ -191,7 +191,7 @@ public View getView(FlowLayout parent, int position, TagsBean trendTagsBean) {
                 public boolean onTagClick(View view, int position, FlowLayout parent) {
                     Intent intent = new Intent(mContext, SearchActivity.class);
                     intent.putExtra(Params.KEY_WORD, mNovelBean.getTags().get(position).getName());
-                    intent.putExtra(Params.INDEX, 1);
+                    intent.putExtra(Params.INDEX, 2);
                     startActivity(intent);
                     return false;
                 }

File: app/src/main/java/ceui/lisa/fragments/FragmentSettings.java
Patch:
@@ -436,6 +436,7 @@ public void onClick(DialogInterface dialog, int which) {
                         .show();
             }
         });
+
         baseBind.appLanguage.setText(Shaft.sSettings.getAppLanguage());
         baseBind.appLanguageRela.setOnClickListener(new View.OnClickListener() {
             @Override

File: app/src/main/java/ceui/lisa/utils/Params.java
Patch:
@@ -49,6 +49,7 @@ public class Params {
     public static final String VIEW_PAGER_R18  = "r18 viewpager";
 
     public static final String FILTER_ILLUST        = "ceui.lisa.fragments.NetListFragment FILTER_ILLUST";
+    public static final String FILTER_NOVEL        = "ceui.lisa.fragments.NetListFragment FILTER_NOVEL";
     public static final String LIKED_ILLUST        = "ceui.lisa.fragments.NetListFragment LIKED_ILLUST";
     public static final String PLAY_GIF        = "ceui.lisa.fragments.FragmentSingleUgora PLAY_GIF";
     public static final String LIKED_USER          = "ceui.lisa.fragments.NetListFragment LIKED_USER";

File: app/src/main/java/ceui/lisa/activities/VActivity.java
Patch:
@@ -162,7 +162,7 @@ protected void initData() {
 
     @Override
     protected void onDestroy() {
-        PixivOperate.setBack(null);
+        PixivOperate.clearBack();
         super.onDestroy();
     }
 

File: app/src/main/java/ceui/lisa/interfaces/MultiDownload.java
Patch:
@@ -18,9 +18,9 @@ public interface MultiDownload {
     default void startDownload() {
         DataChannel dataChannel = DataChannel.get();
         List<IllustsBean> list = getIllustList();
-        for (IllustsBean illustsBean : list) {
-            illustsBean.setChecked(true);
-        }
+//        for (IllustsBean illustsBean : list) {
+//            illustsBean.setChecked(true);
+//        }
         dataChannel.setDownloadList(list);
         Intent intent = new Intent(getContext(), TemplateActivity.class);
         intent.putExtra(TemplateActivity.EXTRA_FRAGMENT, "批量下载");

File: app/src/main/java/ceui/lisa/utils/Settings.java
Patch:
@@ -80,7 +80,7 @@ public void setCurrentProgress(long currentProgress) {
     private boolean deleteStarIllust = false;
 
     //是否自动添加DNS，true开启直连  false自行代理
-    private boolean autoFuckChina = true;
+    private boolean autoFuckChina = false;
 
     private boolean relatedIllustNoLimit = true;
 

File: app/src/main/java/ceui/lisa/fragments/FragmentCollection.java
Patch:
@@ -18,6 +18,7 @@
 import ceui.lisa.activities.Shaft;
 import ceui.lisa.activities.TemplateActivity;
 import ceui.lisa.databinding.ViewpagerWithTablayoutBinding;
+import ceui.lisa.utils.MyOnTabSelectedListener;
 import ceui.lisa.utils.Params;
 
 import static ceui.lisa.activities.Shaft.sUserModel;
@@ -133,6 +134,8 @@ public CharSequence getPageTitle(int position) {
             }
         });
         baseBind.tabLayout.setupWithViewPager(baseBind.viewPager);
+        MyOnTabSelectedListener listener = new MyOnTabSelectedListener(allPages);
+        baseBind.tabLayout.addOnTabSelectedListener(listener);
         baseBind.toolbar.inflateMenu(R.menu.illust_filter);
         baseBind.viewPager.addOnPageChangeListener(new ViewPager.OnPageChangeListener() {
             @Override

File: app/src/main/java/ceui/lisa/fragments/FragmentDownload.java
Patch:
@@ -21,6 +21,7 @@
 import ceui.lisa.database.AppDatabase;
 import ceui.lisa.databinding.ViewpagerWithTablayoutBinding;
 import ceui.lisa.utils.Common;
+import ceui.lisa.utils.MyOnTabSelectedListener;
 
 /**
  * 下载管理
@@ -128,6 +129,8 @@ public CharSequence getPageTitle(int position) {
 
         });
         baseBind.tabLayout.setupWithViewPager(baseBind.viewPager);
+        MyOnTabSelectedListener listener = new MyOnTabSelectedListener(allPages);
+        baseBind.tabLayout.addOnTabSelectedListener(listener);
         baseBind.viewPager.addOnPageChangeListener(new ViewPager.OnPageChangeListener() {
             @Override
             public void onPageScrolled(int i, float v, int i1) {

File: app/src/main/java/ceui/lisa/fragments/FragmentLeft.java
Patch:
@@ -15,6 +15,7 @@
 import ceui.lisa.activities.Shaft;
 import ceui.lisa.activities.TemplateActivity;
 import ceui.lisa.databinding.FragmentLeftBinding;
+import ceui.lisa.utils.MyOnTabSelectedListener;
 import ceui.lisa.utils.Dev;
 import ceui.lisa.utils.Params;
 
@@ -85,6 +86,8 @@ public CharSequence getPageTitle(int position) {
             }
         });
         baseBind.tabLayout.setupWithViewPager(baseBind.viewPager);
+        MyOnTabSelectedListener listener = new MyOnTabSelectedListener(mFragments);
+        baseBind.tabLayout.addOnTabSelectedListener(listener);
     }
 
     public void forceRefresh() {

File: app/src/main/java/ceui/lisa/fragments/FragmentMutedUser.java
Patch:
@@ -83,11 +83,11 @@ public boolean showToolbar() {
     public boolean onMenuItemClick(MenuItem item) {
         if (item.getItemId() == R.id.action_delete) {
             if (allItems.size() == 0) {
-                Common.showToast(getString(R.string.string_215));
+                Common.showToast(getString(R.string.string_388));
             } else {
                 new QMUIDialog.MessageDialogBuilder(mActivity)
                         .setTitle(getString(R.string.string_216))
-                        .setMessage(getString(R.string.string_217))
+                        .setMessage(getString(R.string.string_389))
                         .setSkinManager(QMUISkinManager.defaultInstance(mContext))
                         .addAction(getString(R.string.string_218), new QMUIDialogAction.ActionListener() {
                             @Override

File: app/src/main/java/ceui/lisa/fragments/FragmentSB.java
Patch:
@@ -170,7 +170,9 @@ public void beforeFirstLoad(List<TagsBean> tagsBeans) {
         super.beforeFirstLoad(tagsBeans);
         if (Shaft.sSettings.isStarWithTagSelectAll()) {
             for (TagsBean tagsBean : tagsBeans) {
-                tagsBean.setSelected(true);
+                if (tagNames.isEmpty() || tagNames.contains(tagsBean.getName())) {
+                    tagsBean.setSelected(true);
+                }
             }
         }
     }

File: app/src/main/java/ceui/lisa/utils/Common.java
Patch:
@@ -325,8 +325,7 @@ public static boolean isIllustDownloaded(IllustsBean illust) {
         try {
             if (illust.getPage_count() == 1) {
                 if (Shaft.sSettings.getDownloadWay() == 1) {
-                    String displayName = FileCreator.customFileName(illust, 0);
-                    return SAFile.isFileExists(Shaft.getContext(), displayName);
+                    return SAFile.isFileExists(Shaft.getContext(), illust);
                 } else {
                     return FileCreator.isExist(illust, 0);
                 }

File: app/src/main/java/ceui/lisa/adapters/CommentAdapter.java
Patch:
@@ -42,7 +42,7 @@ public void bindData(CommentsBean target, ViewHolder<RecyCommentListBinding> bin
         Glide.with(mContext).load(GlideUtil.getHead(allIllust.get(position).getUser()))
                 .into(bindView.baseBind.userHead);
         bindView.baseBind.userName.setText(allIllust.get(position).getUser().getName());
-        bindView.baseBind.time.setText(allIllust.get(position).getDate());
+        bindView.baseBind.time.setText(Common.getLocalYYYYMMDDHHMMSSString(allIllust.get(position).getDate()));
         bindView.baseBind.content.setHtml(allIllust.get(position).getComment(),
                 new ImgGetter(bindView.baseBind.content));
 

File: app/src/main/java/ceui/lisa/adapters/RAdapter.java
Patch:
@@ -31,7 +31,7 @@ public void bindData(IllustsBean target, ViewHolder<RecyRankIllustHorizontalBind
                 .placeholder(R.color.light_bg).into(bindView.baseBind.illustImage);
         Glide.with(mContext).load(GlideUtil.getUrl(allIllust.get(position)
                 .getUser().getProfile_image_urls().getMedium()))
-                .placeholder(R.color.light_bg).into(bindView.baseBind.userHead);
+                .placeholder(R.color.light_bg).error(R.drawable.no_profile).into(bindView.baseBind.userHead);
         if (mOnItemClickListener != null) {
             bindView.itemView.setOnClickListener(v -> mOnItemClickListener.onItemClick(v, position, 0));
         }

File: app/src/main/java/ceui/lisa/adapters/UAdapter.java
Patch:
@@ -77,7 +77,7 @@ public void bindData(UserPreviewsBean target, ViewHolder<RecyUserPreviewBinding>
         }
 
         Glide.with(mContext).load(GlideUtil.getUrl(allIllust.get(position)
-                .getUser().getProfile_image_urls().getMedium())).into(bindView.baseBind.userHead);
+                .getUser().getProfile_image_urls().getMedium())).error(R.drawable.no_profile).into(bindView.baseBind.userHead);
         bindView.baseBind.postLikeUser.setText(allIllust.get(position).getUser().isIs_followed() ?
                 mContext.getString(R.string.post_unfollow) : mContext.getString(R.string.post_follow));
 

File: app/src/main/java/ceui/lisa/fragments/FragmentSB.java
Patch:
@@ -200,6 +200,7 @@ public void onClick(QMUIDialog dialog, int index) {
     @Override
     public void initView() {
         super.initView();
+        baseBind.isPrivate.setChecked(!Shaft.sSettings.isPrivateStar());
         baseBind.submitArea.setOnClickListener(v -> submitStar());
     }
 

File: app/src/main/java/ceui/lisa/utils/PixivOperate.java
Patch:
@@ -11,7 +11,6 @@
 import android.widget.Button;
 import android.widget.ImageView;
 
-import androidx.core.widget.ImageViewCompat;
 import androidx.localbroadcastmanager.content.LocalBroadcastManager;
 
 import com.blankj.utilcode.util.FileUtils;
@@ -746,7 +745,7 @@ public static void postNovelMarker(NovelDetail.NovelMarkerBean novelMarkerBean,
                         @Override
                         public void next(NullResponse nullResponse) {
                             if(view instanceof ImageView){
-                                ImageViewCompat.setImageTintList(((ImageView) view), ColorStateList.valueOf(getColor(R.color.novel_marker_add)));
+                                ((ImageView)view).setImageTintList(ColorStateList.valueOf(getColor(R.color.novel_marker_add)));
                             }
                             Common.showToast(getString(R.string.string_368, page));
                         }
@@ -761,7 +760,7 @@ public void next(NullResponse nullResponse) {
                         @Override
                         public void next(NullResponse nullResponse) {
                             if(view instanceof ImageView){
-                                ImageViewCompat.setImageTintList(((ImageView) view), ColorStateList.valueOf(getColor(R.color.novel_marker_none)));
+                                ((ImageView)view).setImageTintList(ColorStateList.valueOf(getColor(R.color.novel_marker_none)));
                             }
                             Common.showToast(getString(R.string.string_369));
                         }

File: app/src/main/java/ceui/lisa/activities/SearchActivity.java
Patch:
@@ -92,6 +92,7 @@ public CharSequence getPageTitle(int position) {
                 return TITLES[position];
             }
         });
+        baseBind.viewPager.setOffscreenPageLimit(2);
         baseBind.tabLayout.setupWithViewPager(baseBind.viewPager);
         if (index != 0) {
             baseBind.viewPager.setCurrentItem(index);
@@ -141,7 +142,7 @@ public void afterTextChanged(Editable editable) {
         baseBind.searchBox.setOnEditorActionListener(new TextView.OnEditorActionListener() {
             @Override
             public boolean onEditorAction(TextView v, int actionId, KeyEvent event) {
-                if (TextUtils.isEmpty(baseBind.searchBox.getText().toString())) {
+                if (TextUtils.isEmpty(baseBind.searchBox.getText().toString()) && TextUtils.isEmpty(searchModel.getStarSize().getValue())) {
                     Common.showToast(getString(R.string.string_139));
                     return false;
                 }

File: app/src/main/java/ceui/lisa/fragments/FragmentSearchNovel.java
Patch:
@@ -58,7 +58,8 @@ public BaseRepo repository() {
         return new SearchNovelRepo(
                 searchModel.getKeyword().getValue(),
                 searchModel.getSortType().getValue(),
-                searchModel.getSearchType().getValue()
+                searchModel.getSearchType().getValue(),
+                searchModel.getStarSize().getValue()
         );
     }
 

File: app/src/main/java/ceui/lisa/utils/PixivSearchParamUtil.java
Patch:
@@ -14,7 +14,7 @@ public class PixivSearchParamUtil {
     public static final String[] TAG_MATCH_VALUE = new String[]{"partial_match_for_tags",
             "exact_match_for_tags", "title_and_caption"};
     public static final String[] ALL_SIZE_VALUE = new String[]{"", "500users入り", "1000users入り", "2000users入り",
-            "5000users入り", "7500users入り", "10000users入り", "20000users入り", "50000users入り"};
+            "5000users入り", "7500users入り", "10000users入り", "20000users入り", "50000users入り", "100000users入り"};
     public static final String[] DATE_SORT_VALUE = new String[]{"date_desc", "date_asc"};
 
     public static String[] TAG_MATCH_NAME = new String[]{
@@ -32,7 +32,8 @@ public class PixivSearchParamUtil {
             resources.getString(R.string.string_294),
             resources.getString(R.string.string_295),
             resources.getString(R.string.string_296),
-            resources.getString(R.string.string_297)
+            resources.getString(R.string.string_297),
+            resources.getString(R.string.string_375)
     };
 
     public static String[] DATE_SORT_NAME = new String[]{

File: app/src/main/java/ceui/lisa/utils/SearchTypeUtil.java
Patch:
@@ -16,7 +16,7 @@ public class SearchTypeUtil {
     public static final int defaultSearchType = 0;
 
     private static final Pattern WEB_URL_PATTERN = Patterns.WEB_URL;
-    private static final Pattern NUMBERIC_PATTERN = Pattern.compile("^\\D*(\\d{4,10})\\D*$");
+    private static final Pattern NUMBERIC_PATTERN = Pattern.compile("(?:\\b|\\D)([1-9]\\d{3,9})(?:\\b|\\D)");
 
     public static String[] SEARCH_TYPE_NAME = new String[]{
             resources.getString(R.string.string_149),
@@ -38,7 +38,7 @@ public static int getSuggestSearchType(String content){
         }
 
         Matcher matcher = NUMBERIC_PATTERN.matcher(content);
-        if(matcher.matches()){
+        if(matcher.find()){
             int number = Integer.parseInt(matcher.group(1));
             if(number > 10000000){
                 return 1;

File: app/src/main/java/ceui/lisa/utils/SearchTypeUtil.java
Patch:
@@ -16,7 +16,7 @@ public class SearchTypeUtil {
     public static final int defaultSearchType = 0;
 
     private static final Pattern WEB_URL_PATTERN = Patterns.WEB_URL;
-    private static final Pattern NUMBERIC_PATTERN = Pattern.compile("^\\D*(\\d{4,10})\\D*$");
+    private static final Pattern NUMBERIC_PATTERN = Pattern.compile("(?:\\b|\\D)([1-9]\\d{3,9})(?:\\b|\\D)");
 
     public static String[] SEARCH_TYPE_NAME = new String[]{
             resources.getString(R.string.string_149),
@@ -38,7 +38,7 @@ public static int getSuggestSearchType(String content){
         }
 
         Matcher matcher = NUMBERIC_PATTERN.matcher(content);
-        if(matcher.matches()){
+        if(matcher.find()){
             int number = Integer.parseInt(matcher.group(1));
             if(number > 10000000){
                 return 1;

File: app/src/main/java/ceui/lisa/fragments/FragmentRecmdIllust.java
Patch:
@@ -167,6 +167,7 @@ public boolean showToolbar() {
 
     @Override
     public void onFirstLoaded(List<IllustsBean> illustsBeans) {
+        ((RecmdModel) mModel).getRankList().clear();
         Observable.create((ObservableOnSubscribe<String>) emitter -> {
             emitter.onNext("开始写入数据库");
             if (allItems != null) {

File: app/src/main/java/ceui/lisa/fragments/FragmentRecmdNovel.java
Patch:
@@ -38,6 +38,7 @@ public boolean showToolbar() {
 
     @Override
     public void onFirstLoaded(List<NovelBean> novelBeans) {
+        ranking.clear();
         ranking.addAll(mResponse.getRanking_novels());
         ((NAdapterWithHeadView) mAdapter).setHeadData(ranking);
     }

File: app/src/main/java/ceui/lisa/utils/Settings.java
Patch:
@@ -217,7 +217,7 @@ public void setSaveViewHistory(boolean saveViewHistory) {
     }
 
     public String getSearchFilter() {
-        return TextUtils.isEmpty(searchFilter) ? " 无限制" : searchFilter;
+        return TextUtils.isEmpty(searchFilter) ? "" : searchFilter;
     }
 
     public boolean isUsePixivCat() {

File: app/src/main/java/ceui/lisa/fragments/FragmentLocalImageDetail.java
Patch:
@@ -2,12 +2,10 @@
 
 import android.os.Bundle;
 import android.text.TextUtils;
-import android.view.View;
 
 import ceui.lisa.R;
 import ceui.lisa.databinding.FragmentImageDetailLocalBinding;
 import ceui.lisa.utils.Params;
-import xyz.zpayh.hdimage.OnBitmapLoadListener;
 import xyz.zpayh.hdimage.state.ScaleType;
 
 public class FragmentLocalImageDetail extends BaseFragment<FragmentImageDetailLocalBinding> {

File: app/src/main/java/ceui/lisa/activities/OutWakeActivity.java
Patch:
@@ -170,12 +170,12 @@ public void success(UserModel userModel) {
 
                                         Common.showLog(userModel.toString());
 
-                                        userModel.getResponse().getUser().setIs_login(true);
+                                        userModel.getUser().setIs_login(true);
                                         Local.saveUser(userModel);
 
                                         UserEntity userEntity = new UserEntity();
                                         userEntity.setLoginTime(System.currentTimeMillis());
-                                        userEntity.setUserID(userModel.getResponse().getUser().getId());
+                                        userEntity.setUserID(userModel.getUser().getId());
                                         userEntity.setUserGson(Shaft.sGson.toJson(Local.getUser()));
 
 
@@ -220,7 +220,7 @@ public void must() {
             }
         }
 
-        if (sUserModel != null && sUserModel.getResponse().getUser().isIs_login()) {
+        if (sUserModel != null && sUserModel.getUser().isIs_login()) {
             Intent i = new Intent(mContext, MainActivity.class);
             mActivity.startActivity(i);
             mActivity.finish();

File: app/src/main/java/ceui/lisa/activities/UActivity.java
Patch:
@@ -89,7 +89,7 @@ public void onChanged(UserDetailResponse userDetailResponse) {
     @Override
     protected void initData() {
         baseBind.progress.setVisibility(View.VISIBLE);
-        Retro.getAppApi().getUserDetail(Shaft.sUserModel.getResponse().getAccess_token(), userID)
+        Retro.getAppApi().getUserDetail(Shaft.sUserModel.getAccess_token(), userID)
                 .subscribeOn(Schedulers.newThread())
                 .observeOn(AndroidSchedulers.mainThread())
                 .subscribe(new NullCtrl<UserDetailResponse>() {

File: app/src/main/java/ceui/lisa/activities/UserActivity.java
Patch:
@@ -74,7 +74,7 @@ public void onChanged(UserDetailResponse userDetailResponse) {
                 invoke(userDetailResponse);
             }
         });
-        Retro.getAppApi().getUserDetail(sUserModel.getResponse().getAccess_token(), userID)
+        Retro.getAppApi().getUserDetail(sUserModel.getAccess_token(), userID)
                 .subscribeOn(Schedulers.newThread())
                 .observeOn(AndroidSchedulers.mainThread())
                 .subscribe(new ErrorCtrl<UserDetailResponse>() {
@@ -155,7 +155,7 @@ public boolean onTagClick(View view, int position, FlowLayout parent) {
         FragmentManager fragmentManager = getSupportFragmentManager();
         FragmentTransaction transaction = fragmentManager.beginTransaction();
 
-        if (currentUser.getUser().getId() != sUserModel.getResponse().getUser().getId()) {
+        if (currentUser.getUser().getId() != sUserModel.getUser().getId()) {
             //如果看的是自己的主页，先展示收藏
             //如果看的是别人的主页，先展示作品
             if (currentUser.getProfile().getTotal_illusts() > 0) {

File: app/src/main/java/ceui/lisa/adapters/IllustAdapter.java
Patch:
@@ -24,6 +24,7 @@
 import ceui.lisa.download.IllustDownload;
 import ceui.lisa.feature.HostManager;
 import ceui.lisa.models.IllustsBean;
+import ceui.lisa.transformer.LargeBitmapScaleTransformer;
 import ceui.lisa.transformer.UniformScaleTransformation;
 import ceui.lisa.utils.Common;
 import ceui.lisa.utils.GlideUrlChild;
@@ -130,6 +131,7 @@ public void onError(long id, Exception e) {
         Glide.with(mContext)
                 .asBitmap()
                 .load(new GlideUrlChild(imageUrl))
+                .transform(new LargeBitmapScaleTransformer())
                 .transition(BitmapTransitionOptions.withCrossFade())
                 .listener(new RequestListener<Bitmap>() {
                     @Override

File: app/src/main/java/ceui/lisa/core/BaseRepo.java
Patch:
@@ -45,7 +45,7 @@ public boolean showNoDataHint() {
     public String token() {
         try {
             if (Shaft.sUserModel != null) {
-                return Shaft.sUserModel.getResponse().getAccess_token();
+                return Shaft.sUserModel.getAccess_token();
             }
         } catch (Exception e) {
             e.printStackTrace();
@@ -56,7 +56,7 @@ public String token() {
     public int currentUserID() {
         try {
             if (Shaft.sUserModel != null) {
-                return Shaft.sUserModel.getResponse().getUser().getId();
+                return Shaft.sUserModel.getUser().getId();
             }
         } catch (Exception e) {
             e.printStackTrace();

File: app/src/main/java/ceui/lisa/feature/worker/BatchFollowTask.java
Patch:
@@ -33,7 +33,7 @@ public BatchFollowTask(String name, int userID, int starType) {
     public void run(IEnd end) {
         if (starType == 0) {
             Retro.getAppApi().postFollow(
-                    sUserModel.getResponse().getAccess_token(), userID, Params.TYPE_PUBLUC)
+                    sUserModel.getAccess_token(), userID, Params.TYPE_PUBLUC)
                     .subscribeOn(Schedulers.newThread())
                     .observeOn(AndroidSchedulers.mainThread())
                     .subscribe(new ErrorCtrl<NullResponse>() {
@@ -52,7 +52,7 @@ public void must() {
                     });
         } else {
             Retro.getAppApi().postUnFollow(
-                    sUserModel.getResponse().getAccess_token(), userID)
+                    sUserModel.getAccess_token(), userID)
                     .subscribeOn(Schedulers.newThread())
                     .observeOn(AndroidSchedulers.mainThread())
                     .subscribe(new ErrorCtrl<NullResponse>() {

File: app/src/main/java/ceui/lisa/feature/worker/BatchStarTask.java
Patch:
@@ -33,7 +33,7 @@ public BatchStarTask(String name, int illustID, int starType) {
     @Override
     public void run(IEnd end) {
         if (starType == 0) {
-            Retro.getAppApi().postLike(Shaft.sUserModel.getResponse().getAccess_token(), illustID, Params.TYPE_PUBLUC)
+            Retro.getAppApi().postLike(Shaft.sUserModel.getAccess_token(), illustID, Params.TYPE_PUBLUC)
                     .subscribeOn(Schedulers.newThread())
                     .observeOn(AndroidSchedulers.mainThread())
                     .subscribe(new ErrorCtrl<NullResponse>() {
@@ -51,7 +51,7 @@ public void must() {
                         }
                     });
         } else {
-            Retro.getAppApi().postDislike(sUserModel.getResponse().getAccess_token(), illustID)
+            Retro.getAppApi().postDislike(sUserModel.getAccess_token(), illustID)
                     .subscribeOn(Schedulers.newThread())
                     .observeOn(AndroidSchedulers.mainThread())
                     .subscribe(new ErrorCtrl<NullResponse>() {

File: app/src/main/java/ceui/lisa/fragments/FragmentComment.java
Patch:
@@ -208,7 +208,7 @@ public void initView() {
                 getString(R.string.string_174)
         };
         baseBind.post.setOnClickListener(v -> {
-            if (!sUserModel.getResponse().getUser().isIs_mail_authorized()) {
+            if (!sUserModel.getUser().isIs_mail_authorized()) {
                 AlertDialog.Builder builder = new AlertDialog.Builder(mContext);
                 builder.setMessage(R.string.string_158);
                 builder.setPositiveButton(R.string.string_159, (dialog, which) -> {
@@ -267,13 +267,13 @@ public void must(boolean isSuccess) {
                 }
             };
             if (parentCommentID != 0) {
-                Retro.getAppApi().postComment(sUserModel.getResponse().getAccess_token(), illustID,
+                Retro.getAppApi().postComment(sUserModel.getAccess_token(), illustID,
                         baseBind.inputBox.getText().toString(), parentCommentID)
                         .subscribeOn(Schedulers.newThread())
                         .observeOn(AndroidSchedulers.mainThread())
                         .subscribe(nullCtrl);
             } else {
-                Retro.getAppApi().postComment(sUserModel.getResponse().getAccess_token(), illustID,
+                Retro.getAppApi().postComment(sUserModel.getAccess_token(), illustID,
                         baseBind.inputBox.getText().toString())
                         .subscribeOn(Schedulers.newThread())
                         .observeOn(AndroidSchedulers.mainThread())

File: app/src/main/java/ceui/lisa/fragments/FragmentFilter.java
Patch:
@@ -120,7 +120,7 @@ public void onNothingSelected(AdapterView<?> parent) {
         });
 
 
-        if (Shaft.sUserModel.getResponse().getUser().isIs_premium()) {
+        if (Shaft.sUserModel.getUser().isIs_premium()) {
             baseBind.popSwitch.setEnabled(true);
         } else {
             baseBind.popSwitch.setEnabled(false);

File: app/src/main/java/ceui/lisa/fragments/FragmentLikeIllust.java
Patch:
@@ -93,7 +93,7 @@ public RemoteRepo<ListIllust> repository() {
 
     @Override
     public BaseAdapter<IllustsBean, RecyIllustStaggerBinding> adapter() {
-        boolean isOwnPage = Shaft.sUserModel.getResponse().getUser().getUserId() == userID;
+        boolean isOwnPage = Shaft.sUserModel.getUser().getUserId() == userID;
         return new IAdapterWithStar(allItems, mContext).setHideStarIcon(isOwnPage);
     }
 

File: app/src/main/java/ceui/lisa/fragments/FragmentLikeIllustHorizontal.java
Patch:
@@ -133,13 +133,13 @@ public void onClick(View view) {
     protected void initData() {
         Observable<ListIllust> api = null;
         if (type == 1) {
-            api = Retro.getAppApi().getUserLikeIllust(sUserModel.getResponse().getAccess_token(),
+            api = Retro.getAppApi().getUserLikeIllust(sUserModel.getAccess_token(),
                     mUserDetailResponse.getUser().getId(), Params.TYPE_PUBLUC);
         } else if (type == 2) {
-            api = Retro.getAppApi().getUserSubmitIllust(sUserModel.getResponse().getAccess_token(),
+            api = Retro.getAppApi().getUserSubmitIllust(sUserModel.getAccess_token(),
                     mUserDetailResponse.getUser().getId(), Params.TYPE_ILLUST);
         } else if (type == 3) {
-            api = Retro.getAppApi().getUserSubmitIllust(sUserModel.getResponse().getAccess_token(),
+            api = Retro.getAppApi().getUserSubmitIllust(sUserModel.getAccess_token(),
                     mUserDetailResponse.getUser().getId(), Params.TYPE_MANGA);
         }
 

File: app/src/main/java/ceui/lisa/fragments/FragmentLikeNovelHorizontal.java
Patch:
@@ -123,10 +123,10 @@ public void onItemClick(View v, int position, int viewType) {
     protected void initData() {
         Observable<ListNovel> mApi;
         if (type == 0) {
-            mApi = Retro.getAppApi().getUserLikeNovel(sUserModel.getResponse().getAccess_token(),
+            mApi = Retro.getAppApi().getUserLikeNovel(sUserModel.getAccess_token(),
                     userID, Params.TYPE_PUBLUC);
         } else {
-            mApi = Retro.getAppApi().getUserSubmitNovel(sUserModel.getResponse().getAccess_token(),
+            mApi = Retro.getAppApi().getUserSubmitNovel(sUserModel.getAccess_token(),
                     userID);
         }
         mApi.subscribeOn(Schedulers.newThread())

File: app/src/main/java/ceui/lisa/fragments/FragmentNovelHolder.java
Patch:
@@ -197,7 +197,7 @@ public boolean onTagClick(View view, int position, FlowLayout parent) {
             refreshDetail(mNovelDetail);
         } else {
             baseBind.progressRela.setVisibility(View.VISIBLE);
-            Retro.getAppApi().getNovelDetail(Shaft.sUserModel.getResponse().getAccess_token(), novelBean.getId())
+            Retro.getAppApi().getNovelDetail(Shaft.sUserModel.getAccess_token(), novelBean.getId())
                     .subscribeOn(Schedulers.newThread())
                     .observeOn(AndroidSchedulers.mainThread())
                     .subscribe(new NullCtrl<NovelDetail>() {

File: app/src/main/java/ceui/lisa/fragments/FragmentRecmdIllust.java
Patch:
@@ -90,7 +90,7 @@ public void run() {
                         FragmentLogin.CLIENT_ID,
                         FragmentLogin.CLIENT_SECRET,
                         FragmentLogin.REFRESH_TOKEN,
-                        userModel.getResponse().getRefresh_token(),
+                        userModel.getRefresh_token(),
                         Boolean.TRUE);
                 try {
                     UserModel newUser = call.execute().body();

File: app/src/main/java/ceui/lisa/fragments/FragmentSB.java
Patch:
@@ -82,7 +82,7 @@ private void submitStar() {
         }
 
         if (tempList.size() == 0) {
-            Retro.getAppApi().postLike(Shaft.sUserModel.getResponse().getAccess_token(), illustID,
+            Retro.getAppApi().postLike(Shaft.sUserModel.getAccess_token(), illustID,
                     baseBind.isPrivate.isChecked() ? Params.TYPE_PRIVATE : Params.TYPE_PUBLUC)
                     .subscribeOn(Schedulers.newThread())
                     .observeOn(AndroidSchedulers.mainThread())
@@ -98,7 +98,7 @@ public void next(NullResponse nullResponse) {
             String[] strings = new String[tempList.size()];
             tempList.toArray(strings);
 
-            Retro.getAppApi().postLike(Shaft.sUserModel.getResponse().getAccess_token(), illustID,
+            Retro.getAppApi().postLike(Shaft.sUserModel.getAccess_token(), illustID,
                     baseBind.isPrivate.isChecked() ? Params.TYPE_PRIVATE : Params.TYPE_PUBLUC, strings)
                     .subscribeOn(Schedulers.newThread())
                     .observeOn(AndroidSchedulers.mainThread())

File: app/src/main/java/ceui/lisa/fragments/FragmentSearch.java
Patch:
@@ -245,7 +245,7 @@ private void dispatchClick(String keyWord, int searchType) {
     }
 
     private void completeWord(String key) {
-        Retro.getAppApi().searchCompleteWord(sUserModel.getResponse().getAccess_token(), key)
+        Retro.getAppApi().searchCompleteWord(sUserModel.getAccess_token(), key)
                 .subscribeOn(Schedulers.newThread())
                 .observeOn(AndroidSchedulers.mainThread())
                 .subscribe(new NullCtrl<ListTrendingtag>() {
@@ -271,7 +271,7 @@ public void onItemClick(View v, int position, int viewType) {
     }
 
     private void getHotTags() {
-        Retro.getAppApi().getHotTags(sUserModel.getResponse().getAccess_token(), Params.TYPE_ILLUST)
+        Retro.getAppApi().getHotTags(sUserModel.getAccess_token(), Params.TYPE_ILLUST)
                 .subscribeOn(Schedulers.newThread())
                 .observeOn(AndroidSchedulers.mainThread())
                 .subscribe(new NullCtrl<ListTrendingtag>() {

File: app/src/main/java/ceui/lisa/utils/Common.java
Patch:
@@ -77,7 +77,7 @@ public static void hideKeyboard(Activity activity) {
 
     public static void logOut(Context context) {
         if (Shaft.sUserModel != null) {
-            Shaft.sUserModel.getResponse().getUser().setIs_login(false);
+            Shaft.sUserModel.getUser().setIs_login(false);
             Local.saveUser(Shaft.sUserModel);
             Intent intent = new Intent(context, TemplateActivity.class);
             intent.putExtra(TemplateActivity.EXTRA_FRAGMENT, "登录注册");

File: app/src/main/java/ceui/lisa/adapters/IllustAdapter.java
Patch:
@@ -24,6 +24,7 @@
 import ceui.lisa.download.IllustDownload;
 import ceui.lisa.feature.HostManager;
 import ceui.lisa.models.IllustsBean;
+import ceui.lisa.transformer.LargeBitmapScaleTransformer;
 import ceui.lisa.transformer.UniformScaleTransformation;
 import ceui.lisa.utils.Common;
 import ceui.lisa.utils.GlideUrlChild;
@@ -130,6 +131,7 @@ public void onError(long id, Exception e) {
         Glide.with(mContext)
                 .asBitmap()
                 .load(new GlideUrlChild(imageUrl))
+                .transform(new LargeBitmapScaleTransformer())
                 .transition(BitmapTransitionOptions.withCrossFade())
                 .listener(new RequestListener<Bitmap>() {
                     @Override

File: app/src/main/java/ceui/lisa/activities/OutWakeActivity.java
Patch:
@@ -180,8 +180,7 @@ public void success(UserModel userModel) {
 
 
                                         AppDatabase.getAppDatabase(mContext).downloadDao().insertUser(userEntity);
-                                        Intent intent = new Intent(mContext, MainActivity.class);
-                                        mActivity.startActivity(intent);
+                                        Common.restart();
                                     }
 
                                     @Override

File: app/src/main/java/ceui/lisa/fragments/FragmentNovelHolder.java
Patch:
@@ -267,7 +267,7 @@ public void onClick(View view) {
             baseBind.showNext.setVisibility(View.INVISIBLE);
         }
         baseBind.toolbar.getMenu().clear();
-        baseBind.toolbar.inflateMenu(R.menu.change_color);
+        baseBind.toolbar.inflateMenu(R.menu.novel_read_menu);
         baseBind.saveNovelTxt.setOnClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View view) {
@@ -284,7 +284,7 @@ public void doSomething(Uri t) {
         baseBind.toolbar.setOnMenuItemClickListener(new Toolbar.OnMenuItemClickListener() {
             @Override
             public boolean onMenuItemClick(MenuItem item) {
-                if (item.getItemId() == R.id.action_add) {
+                if (item.getItemId() == R.id.action_change_color) {
                     if (Shaft.sSettings.getNovelHolderColor() != 0) {
                         ColorPickerDialog.newBuilder()
                                 .setColor(Shaft.sSettings.getNovelHolderColor())

File: app/src/main/java/ceui/lisa/activities/RankActivity.java
Patch:
@@ -154,7 +154,8 @@ public boolean onOptionsItemSelected(MenuItem item) {
             start.set(2008, 1, 1);
             dpd.setMinDate(start);
             dpd.setMaxDate(now);
-            dpd.setAccentColor(R.attr.colorPrimary);
+            dpd.setAccentColor(Common.resolveThemeAttribute(mContext, R.attr.colorPrimary));
+            dpd.setThemeDark(Common.isUIModeNight(mContext));
             dpd.show(getFragmentManager(), "DatePickerDialog");
             return true;
         }

File: app/src/main/java/ceui/lisa/fragments/FragmentLocalUsers.java
Patch:
@@ -88,7 +88,7 @@ public List<UserModel> apply(List<UserEntity> userEntities) throws Exception {
                     public void success(List<UserModel> userModels) {
                         if (userModels.size() != 0) {
                             for (int i = 0; i < userModels.size(); i++) {
-                                View v = LayoutInflater.from(mContext).inflate(R.layout.recy_loal_user, null);
+                                View v = LayoutInflater.from(mContext).inflate(R.layout.recy_local_user, null);
                                 bindData(v, userModels.get(i));
                                 baseBind.userList.addView(v);
                             }

File: app/src/main/java/ceui/lisa/fragments/FragmentWebView.java
Patch:
@@ -156,7 +156,7 @@ public void onResume() {
     public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMenuInfo menuInfo) {
         WebView.HitTestResult result = mWebView.getHitTestResult();
         mIntentUrl = result.getExtra();
-        menu.setHeaderView(new ContextMenuTitleView(mContext, mIntentUrl));
+        menu.setHeaderView(new ContextMenuTitleView(mContext, mIntentUrl, Common.resolveThemeAttribute(mContext, R.attr.colorPrimary)));
 
         if (result.getType() == WebView.HitTestResult.SRC_ANCHOR_TYPE) {
             mIntentUrl = result.getExtra();

File: app/src/main/java/ceui/lisa/activities/MainActivity.java
Patch:
@@ -350,7 +350,8 @@ public boolean onNavigationItemSelected(MenuItem item) {
 
     @Override
     protected void onSaveInstanceState(@NonNull Bundle outState) {
-        //super.onSaveInstanceState(outState);
+        super.onSaveInstanceState(outState);
+        outState.clear();
     }
 
     public static final String[] ALL_SELECT_WAY = new String[]{"图库选图", "文件管理器选图"};

File: app/src/main/java/ceui/lisa/view/EditTextWithSelection.java
Patch:
@@ -7,7 +7,7 @@
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 
-public class EditTextWithSelection extends EditText {
+public class EditTextWithSelection extends androidx.appcompat.widget.AppCompatEditText {
 
     private OnSelectionChange mOnSelectionChange;
 

File: app/src/main/java/ceui/lisa/adapters/SearchHintAdapter.java
Patch:
@@ -16,6 +16,7 @@
 import ceui.lisa.R;
 import ceui.lisa.databinding.RecySearchHintBinding;
 import ceui.lisa.model.ListTrendingtag;
+import ceui.lisa.utils.Common;
 
 public class SearchHintAdapter extends BaseAdapter<ListTrendingtag.TrendTagsBean, RecySearchHintBinding> {
 
@@ -33,9 +34,7 @@ public void initLayout() {
 
     @Override
     public void bindData(ListTrendingtag.TrendTagsBean target, ViewHolder<RecySearchHintBinding> bindView, int position) {
-        TypedValue colorValue = new TypedValue();
-        mContext.getTheme().resolveAttribute(R.attr.colorPrimary, colorValue, true);
-        SpannableString string = matcherSearchText(colorValue.data,
+        SpannableString string = matcherSearchText(Common.resolveThemeAttribute(mContext, R.attr.colorPrimary),
                 target.getName(), mKeyword);
         bindView.baseBind.titleText.setText(string);
         if (!TextUtils.isEmpty(target.getTranslated_name()) && !target.getTranslated_name().equals(target.getName())) {

File: app/src/main/java/ceui/lisa/fragments/ListFragment.java
Patch:
@@ -87,7 +87,9 @@ public void initView() {
         mRecyclerView.setItemAnimator(animation());
 
         mRefreshLayout = rootView.findViewById(R.id.refreshLayout);
-        mRefreshLayout.setPrimaryColorsId(R.color.white);
+        mRefreshLayout.setDragRate(0.8f); // 阻尼效果太小，会导致滑动距离增大，动画不跟手
+        mRefreshLayout.setHeaderTriggerRate(1.0f); // 触发刷新位置，默认为 1.0*header高度
+        mRefreshLayout.setHeaderMaxDragRate(1.5f); // 最大下拉位置
         noData = rootView.findViewById(R.id.no_data);
         emptyRela = rootView.findViewById(R.id.no_data_rela);
         emptyRela.setOnClickListener(v -> {

File: app/src/main/java/ceui/lisa/adapters/IAdapter.java
Patch:
@@ -174,15 +174,16 @@ public void onItemClick(View v, int position, int viewType) {
 
     private void handleLongClick(View v, IllustsBean illust) {
         View popView = LayoutInflater.from(mContext).inflate(R.layout.pop_window_2, null);
-        QMUIPopup mNormalPopup = QMUIPopups.popup(mContext, QMUIDisplayHelper.dp2px(mContext, 250))
+        QMUIPopup mNormalPopup = QMUIPopups.popup(mContext)
                 .preferredDirection(QMUIPopup.DIRECTION_BOTTOM)
                 .view(popView)
                 .dimAmount(0.5f)
                 .edgeProtection(QMUIDisplayHelper.dp2px(mContext, 20))
-                .offsetX(QMUIDisplayHelper.dp2px(mContext, 80))
+                .offsetX(QMUIDisplayHelper.dp2px(mContext, 20))
                 .offsetYIfBottom(QMUIDisplayHelper.dp2px(mContext, 5))
                 .shadow(true)
                 .arrow(true)
+                .bgColor(mContext.getResources().getColor(R.color.fragment_center))
                 .animStyle(QMUIPopup.ANIM_GROW_FROM_RIGHT)
                 .onDismiss(new PopupWindow.OnDismissListener() {
                     @Override

File: app/src/main/java/ceui/lisa/core/LocalRepo.java
Patch:
@@ -26,6 +26,7 @@ public boolean enableRefresh() {
     public RefreshHeader getHeader(Context context) {
         DeliveryHeader header = new DeliveryHeader(context);
 //        header.setPrimaryColors(context.getResources().getColor(R.color.black));
+        header.setBackgroundColor(context.getResources().getColor(R.color.fragment_center));
         return header;
     }
 }

File: app/src/main/java/ceui/lisa/activities/RankActivity.java
Patch:
@@ -140,7 +140,7 @@ public boolean onOptionsItemSelected(MenuItem item) {
                         RankActivity.this,
                         Integer.parseInt(t[0]), // Initial year selection
                         Integer.parseInt(t[1]) - 1, // Initial month selection
-                        Integer.parseInt(t[2]) - 1 // Inital day selection
+                        Integer.parseInt(t[2]) // Inital day selection
                 );
             } else {
                 dpd = DatePickerDialog.newInstance(

File: app/src/main/java/ceui/lisa/fragments/FragmentRankIllust.java
Patch:
@@ -20,7 +20,7 @@ public class FragmentRankIllust extends NetListFragment<FragmentBaseListBinding,
 
     private static final String[] API_TITLES = new String[]{"day", "week",
             "month", "day_male", "day_female", "week_original", "week_rookie",
-            "day_r18"};
+            "day_r18", "week_r18", "day_male_r18", "day_female_r18"};
     private static final String[] API_TITLES_MANGA = new String[]{"day_manga",
             "week_manga", "month_manga", "week_rookie_manga", "day_r18_manga"};
 

File: app/src/main/java/ceui/lisa/fragments/FragmentSettings.java
Patch:
@@ -59,9 +59,6 @@ public void initLayout() {
         mLayoutID = R.layout.fragment_settings;
     }
 
-    private FragmentSettings() {
-    }
-
     public static FragmentSettings newInstance() {
         return new FragmentSettings();
     }

File: app/src/main/java/ceui/lisa/fragments/FragmentSearchResult.java
Patch:
@@ -106,7 +106,7 @@ public BaseAdapter<IllustsBean, RecyIllustStaggerBinding> adapter() {
 
     @Override
     public void initData() {
-        ((TemplateActivity) getActivity()).setSupportActionBar(baseBind.toolbar);
+        ((TemplateActivity) mActivity).setSupportActionBar(baseBind.toolbar);
         baseBind.toolbar.setTitle(getToolbarTitle());
         baseBind.toolbar.setNavigationOnClickListener(new View.OnClickListener() {
             @Override
@@ -129,7 +129,8 @@ public boolean onEditorAction(TextView v, int actionId, KeyEvent event) {
 
         baseBind.drawerlayout.setTouchMode(ElasticDrawer.TOUCH_MODE_BEZEL);
         token = sUserModel.getResponse().getAccess_token();
-        FragmentFilter fragmentFilter = FragmentFilter.newInstance(new FragmentFilter.SearchFilter() {
+        FragmentFilter fragmentFilter = FragmentFilter.newInstance();
+        fragmentFilter.setSearchFilter(new FragmentFilter.SearchFilter() {
             @Override
             public void onTagMatchChanged(String tagMatch) {
                 searchTarget = tagMatch;

File: app/src/main/java/ceui/lisa/fragments/FragmentTest.java
Patch:
@@ -56,7 +56,7 @@ public void onActivityCreated(@Nullable Bundle savedInstanceState) {
         mModel.getContent().observe(getViewLifecycleOwner(), new Observer<List<UserPreviewsBean>>() {
             @Override
             public void onChanged(List<UserPreviewsBean> list) {
-                mAdapter.notifyItemRangeInserted(mModel.getLastSize(), list.size());
+                mAdapter.notifyItemRangeInserted(mModel.getContent().getValue().size(), list.size());
             }
         });
         mAdapter = new UAdapter(mModel.getContent().getValue(), mContext);

File: app/src/main/java/ceui/lisa/http/Retro.java
Patch:
@@ -12,12 +12,10 @@
 import javax.net.ssl.X509TrustManager;
 
 import ceui.lisa.activities.Shaft;
-import ceui.lisa.cache.Cache;
 import ceui.lisa.utils.Common;
 import okhttp3.OkHttpClient;
 import okhttp3.Protocol;
 import okhttp3.Request;
-import okhttp3.logging.HttpLoggingInterceptor;
 import retrofit2.Retrofit;
 import retrofit2.adapter.rxjava2.RxJava2CallAdapterFactory;
 import retrofit2.converter.gson.GsonConverterFactory;

File: app/src/main/java/ceui/lisa/activities/MainActivity.java
Patch:
@@ -37,7 +37,7 @@
 import ceui.lisa.R;
 import ceui.lisa.databinding.ActivityCoverBinding;
 import ceui.lisa.download.TaskQueue;
-import ceui.lisa.fragments.BaseFragment;
+import ceui.lisa.fragments.BaseBindFragment;
 import ceui.lisa.fragments.FragmentCenter;
 import ceui.lisa.fragments.FragmentLeft;
 import ceui.lisa.fragments.FragmentRight;
@@ -59,7 +59,7 @@ public class MainActivity extends BaseActivity<ActivityCoverBinding>
     private TextView username;
     private TextView user_email;
     private long mExitTime;
-    private BaseFragment[] baseFragments = null;
+    private BaseBindFragment[] baseFragments = null;
 
     @Override
     protected int initLayout() {
@@ -137,7 +137,7 @@ public void onPageScrollStateChanged(int i) {
     }
 
     private void initFragment() {
-        baseFragments = new BaseFragment[]{
+        baseFragments = new BaseBindFragment[]{
                 new FragmentLeft(),
                 new FragmentCenter(),
                 new FragmentRight()

File: app/src/main/java/ceui/lisa/fragments/BaseBindFragment.java
Patch:
@@ -90,7 +90,9 @@ public void initView(View view) {
 
     abstract void initLayout();
 
-    abstract void initData();
+    void initData(){
+
+    }
 
 
     public void getFirstData() {

File: app/src/main/java/ceui/lisa/fragments/BaseFragment.java
Patch:
@@ -30,7 +30,9 @@ public BaseFragment() {
 
     abstract View initView(View v);
 
-    abstract void initData();
+    void initData(){
+
+    }
 
     @Override
     public void onCreate(Bundle savedInstanceState) {

File: app/src/main/java/ceui/lisa/fragments/NetListFragment.java
Patch:
@@ -52,7 +52,7 @@ public abstract class NetListFragment<Layout extends ViewDataBinding,
     @Override
     public void initView(View view) {
         super.initView(view);
-        mNetControl = ((NetControl<Response>) mBaseCtrl);
+        mNetControl = (NetControl<Response>) mBaseCtrl;
         mRefreshLayout.setOnRefreshListener(new OnRefreshListener() {
             @Override
             public void onRefresh(@NonNull RefreshLayout refreshLayout) {

File: app/src/main/java/ceui/lisa/utils/Params.java
Patch:
@@ -16,6 +16,7 @@ public class Params {
     public static final String SHOW_DIALOG              = "show dialog";
     public static final String USER_MODEL              = "user model";
     public static final String USE_DEBUG              = "use debug mode";
+    public static final String FILE_PATH              = "file path";
 
     public static final String IMAGE_UNKNOWN = "https://s.pximg.net/common/images/limit_unknown_360.png";
     public static final String HEAD_UNKNOWN = "https://s.pximg.net/common/images/no_profile.png";

File: app/src/main/java/ceui/lisa/activities/TemplateActivity.java
Patch:
@@ -33,7 +33,6 @@
 import ceui.lisa.fragments.FragmentNew;
 import ceui.lisa.fragments.FragmentNiceFriend;
 import ceui.lisa.fragments.FragmentNovelHolder;
-import ceui.lisa.fragments.FragmentPivision;
 import ceui.lisa.fragments.FragmentPv;
 import ceui.lisa.fragments.FragmentRecmdManga;
 import ceui.lisa.fragments.FragmentRecmdNovel;

File: app/src/main/java/ceui/lisa/fragments/FragmentH.java
Patch:
@@ -25,13 +25,13 @@ void initLayout() {
     @Override
     void initData() {
         BarUtils.setNavBarColor(mActivity, getResources().getColor(R.color.hito_bg));
-        freshData();
         baseBind.next.setOnClickListener(v -> freshData());
         baseBind.hitoText.setOnLongClickListener(v -> {
             ClipBoardUtils.putTextIntoClipboard(mContext, baseBind.hitoText.getText().toString());
             return true;
         });
         baseBind.like.setOnClickListener(v -> Common.showToast("下版本更新再做吧？"));
+        freshData();
     }
 
     private void freshData() {

File: app/src/main/java/ceui/lisa/fragments/FragmentSettings.java
Patch:
@@ -69,7 +69,6 @@ public void onClick(View v) {
                 Intent intent = new Intent(mContext, TemplateActivity.class);
                 intent.putExtra(TemplateActivity.EXTRA_FRAGMENT, "账号管理");
                 startActivity(intent);
-                mActivity.finish();
             }
         });
 

File: app/src/main/java/ceui/lisa/http/RubySSLSocketFactory.java
Patch:
@@ -59,7 +59,6 @@ public Socket createSocket(@Nullable Socket paramSocket, @Nullable String paramS
         if (socketFactory != null) {
             Socket socket = socketFactory.createSocket(inetAddress, paramInt);
             if (socket != null) {
-                socket = socket;
                 ((SSLSocket) socket).setEnabledProtocols(((SSLSocket) socket).getSupportedProtocols());
                 Log.i("X", "Setting SNI hostname");
                 SSLSession sSLSession = ((SSLSocket) socket).getSession();

File: app/src/main/java/ceui/lisa/utils/Dev.java
Patch:
@@ -3,7 +3,7 @@
 public class Dev {
 
     //是否是开发状态
-    public static boolean isDev = true;
+    public static boolean isDev = false;
     public static boolean refreshUser = false;
 
     /**

File: app/src/main/java/ceui/lisa/adapters/IllustDetailAdapter.java
Patch:
@@ -168,7 +168,7 @@ public int compare(File o1, File o2) {
                     while (true) {
                         if (playGif) {
                             emitter.onNext(allFiles.get(xyz % count));
-                            Thread.sleep(75);
+                            Thread.sleep(85);
                             xyz++;
                         } else {
                             break;

File: app/src/main/java/ceui/lisa/download/GifDownload.java
Patch:
@@ -26,7 +26,7 @@ public static void downloadGif(GifResponse response, IllustsBean illustsBean){
                 file.getParentFile())
                 .setFilename(file.getName())
                 .setMinIntervalMillisCallbackProcess(30)
-                .setPassIfAlreadyCompleted(false);
+                .setPassIfAlreadyCompleted(true);
         builder.addHeader(MAP_KEY, IMAGE_REFERER);
         DownloadTask task = builder.build();
         IllustTask illustTask = new IllustTask();

File: app/src/main/java/ceui/lisa/download/GifCreate.java
Patch:
@@ -17,7 +17,9 @@
 import io.reactivex.Observable;
 import io.reactivex.ObservableEmitter;
 import io.reactivex.ObservableOnSubscribe;
+import io.reactivex.Observer;
 import io.reactivex.android.schedulers.AndroidSchedulers;
+import io.reactivex.disposables.Disposable;
 import io.reactivex.schedulers.Schedulers;
 
 public class GifCreate {

File: app/src/main/java/ceui/lisa/fragments/FragmentViewHistory.java
Patch:
@@ -226,7 +226,7 @@ public boolean onOptionsItemSelected(MenuItem item) {
             } else {
 
                 AlertDialog.Builder builder = new AlertDialog.Builder(mContext);
-                builder.setTitle("Shaft提示");
+                builder.setTitle("Shaft 提示");
                 builder.setMessage("这将会删除所有的本地浏览历史");
                 builder.setPositiveButton("确定", new DialogInterface.OnClickListener() {
                     @Override

File: app/src/main/java/ceui/lisa/http/Retro.java
Patch:
@@ -168,9 +168,9 @@ public boolean verify(String hostname, SSLSession session) {
                     }
                 })
                 .build();
-        if(Shaft.sSettings.isAutoFuckChina()){
-            builder.dns(new FuckChinaDns());
-        }
+//        if(Shaft.sSettings.isAutoFuckChina()){
+//            builder.dns(new FuckChinaDns());
+//        }
         OkHttpClient client = builder.build();
         Gson gson = new GsonBuilder().setLenient().create();
         Retrofit retrofit = new Retrofit.Builder()

File: app/src/main/java/ceui/lisa/activities/UserDetailActivity.java
Patch:
@@ -236,7 +236,7 @@ public void onComplete() {
 
 
     private void setData(UserDetailResponse userDetailResponse) {
-//      when(exception) Glide.with(Shaft.getContext())
+//      when(exception.message){ "You can not start a load for a destroyed activity" -> Glide.with(Shaft.getContext())}
         if(mContext != null && !isDestroyed()) {
             Glide.with(mContext)
                     .load(GlideUtil.getMediumImg(

File: app/src/main/java/ceui/lisa/activities/UserDetailActivity.java
Patch:
@@ -236,7 +236,7 @@ public void onComplete() {
 
 
     private void setData(UserDetailResponse userDetailResponse) {
-//      when(exception) Glide.with(Shaft.getContext())
+//      when(exception.message){ "You can not start a load for a destroyed activity" -> Glide.with(Shaft.getContext())}
         if(mContext != null && !isDestroyed()) {
             Glide.with(mContext)
                     .load(GlideUtil.getMediumImg(

File: app/src/main/java/ceui/lisa/utils/Common.java
Patch:
@@ -74,7 +74,8 @@ public static <T> void showToast(T t) {
         if (toast == null) {
             toast = Toast.makeText(Shaft.getContext(), String.valueOf(t), Toast.LENGTH_SHORT);
         } else {
-            toast.setText(String.valueOf(t));
+            toast.cancel();
+            toast = Toast.makeText(Shaft.getContext(), String.valueOf(t), Toast.LENGTH_SHORT);
         }
         toast.show();
     }

