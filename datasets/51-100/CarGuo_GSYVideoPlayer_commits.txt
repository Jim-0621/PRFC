File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYVideoView.java
Patch:
@@ -387,7 +387,8 @@ public void run() {
                 if (GSYVideoView.this.mReleaseWhenLossAudio) {
                     GSYVideoView.this.releaseVideos();
                 } else {
-                    getGSYVideoManager().listener().onVideoPause();
+                    if(getGSYVideoManager().listener() != null)
+                        getGSYVideoManager().listener().onVideoPause();
                 }
 
             }

File: app/src/main/java/com/example/gsyvideoplayer/simple/SimplePlayer.java
Patch:
@@ -30,7 +30,7 @@ protected void onCreate(Bundle savedInstanceState) {
     private void init() {
         videoPlayer =  (StandardGSYVideoPlayer)findViewById(R.id.video_player);
 
-        String source1 = "http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4";
+        String source1 = "http://devimages.apple.com.edgekey.net/streaming/examples/bipbop_4x3/gear3/prog_index.m3u8";
         videoPlayer.setUp(source1, true, "测试视频");
 
         //增加封面
@@ -50,8 +50,8 @@ private void init() {
             public void onClick(View v) {
                 // ------- ！！！如果不需要旋转屏幕，可以不调用！！！-------
                 // 不需要屏幕旋转，还需要设置 setNeedOrientationUtils(false)
-                //orientationUtils.resolveByClick();
-                finish();
+                orientationUtils.resolveByClick();
+                //finish();
             }
         });
         //是否可以滑动调整

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYBaseVideoPlayer.java
Patch:
@@ -270,7 +270,7 @@ protected void cloneParams(GSYBaseVideoPlayer from, GSYBaseVideoPlayer to) {
         }
         to.setLooping(from.isLooping());
         to.setIsTouchWigetFull(from.mIsTouchWigetFull);
-        to.setSpeed(from.getSpeed(), from.mSoundTouch);
+        to.setSpeed(from.getSpeed(), from.mSoundTouch, false);
         to.setStateAndUi(from.mCurrentState);
     }
 

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYBaseVideoPlayer.java
Patch:
@@ -231,6 +231,7 @@ protected void cloneParams(GSYBaseVideoPlayer from, GSYBaseVideoPlayer to) {
         to.mPlayTag = from.mPlayTag;
         to.mPlayPosition = from.mPlayPosition;
         to.mEffectFilter = from.mEffectFilter;
+        to.mCurrentPosition = from.mCurrentPosition;
         to.mFullPauseBitmap = from.mFullPauseBitmap;
         to.mNeedShowWifiTip = from.mNeedShowWifiTip;
         to.mShrinkImageRes = from.mShrinkImageRes;

File: app/src/main/java/com/example/gsyvideoplayer/DetailPlayer.java
Patch:
@@ -561,7 +561,7 @@ private String getUrl() {
         //String url = "https://res.exexm.com/cw_145225549855002";
         //String url = "http://storage.gzstv.net/uploads/media/huangmeiyan/jr05-09.mp4";//mepg
         //String url = "https://zh-files.oss-cn-qingdao.aliyuncs.com/20170808223928mJ1P3n57.mp4";//90度
-        String url = "http://dbiptv.sn.chinamobile.com/PLTV/88888888/224/3221226395/1.m3u8";//90度
+        String url = "http://7xjmzj.com1.z0.glb.clouddn.com/20171026175005_JObCxCE2.mp4";//90度
         //String url = " String source1 = "http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4";
         //String url = "http://video.cdn.aizys.com/zzx3.9g.mkv";//long
         //String url = "rtsp://admin:wh123456@112.44.163.248:554/h264/ch01/main/av_stream";//long

File: app/src/main/java/com/example/gsyvideoplayer/AudioDetailPlayer.java
Patch:
@@ -6,9 +6,9 @@
 
 import androidx.annotation.NonNull;
 import androidx.appcompat.app.AppCompatActivity;
+import androidx.media3.exoplayer.SeekParameters;
 
 import com.example.gsyvideoplayer.databinding.ActivityDetailAudioPlayerBinding;
-import com.google.android.exoplayer2.SeekParameters;
 import com.shuyu.gsyvideoplayer.GSYVideoManager;
 import com.shuyu.gsyvideoplayer.builder.GSYVideoOptionBuilder;
 import com.shuyu.gsyvideoplayer.listener.GSYSampleCallBack;

File: app/src/main/java/com/example/gsyvideoplayer/DetailDownloadPlayer.java
Patch:
@@ -8,11 +8,11 @@
 
 import androidx.annotation.NonNull;
 import androidx.appcompat.app.AppCompatActivity;
+import androidx.media3.exoplayer.SeekParameters;
 
 import com.danikula.videocache.HttpProxyCacheServer;
 import com.example.gsyvideoplayer.databinding.ActivityDetailDownloadPlayerBinding;
 import com.example.gsyvideoplayer.utils.MemoryCallBack;
-import com.google.android.exoplayer2.SeekParameters;
 import com.shuyu.gsyvideoplayer.GSYVideoManager;
 import com.shuyu.gsyvideoplayer.builder.GSYVideoOptionBuilder;
 import com.shuyu.gsyvideoplayer.cache.ProxyCacheManager;

File: app/src/main/java/com/example/gsyvideoplayer/DetailNormalActivityPlayer.java
Patch:
@@ -6,8 +6,9 @@
 import android.view.View;
 import android.widget.ImageView;
 
+import androidx.media3.exoplayer.SeekParameters;
+
 import com.example.gsyvideoplayer.databinding.ActivityDetailPlayerBinding;
-import com.google.android.exoplayer2.SeekParameters;
 import com.shuyu.gsyvideoplayer.GSYVideoManager;
 import com.shuyu.gsyvideoplayer.builder.GSYVideoOptionBuilder;
 import com.shuyu.gsyvideoplayer.listener.GSYSampleCallBack;

File: app/src/main/java/com/example/gsyvideoplayer/exo/GSYExoPlayerManager.java
Patch:
@@ -5,7 +5,8 @@
 import android.os.Message;
 import android.view.Surface;
 
-import com.google.android.exoplayer2.video.PlaceholderSurface;
+import androidx.media3.exoplayer.video.PlaceholderSurface;
+
 import com.shuyu.gsyvideoplayer.cache.ICacheManager;
 import com.shuyu.gsyvideoplayer.model.VideoOptionModel;
 import com.shuyu.gsyvideoplayer.player.BasePlayerManager;

File: app/src/main/java/com/example/gsyvideoplayer/exosubtitle/GSYExoSubTitleDetailPlayer.java
Patch:
@@ -9,10 +9,10 @@
 import androidx.annotation.NonNull;
 import androidx.appcompat.app.AppCompatActivity;
 import androidx.core.widget.NestedScrollView;
+import androidx.media3.exoplayer.SeekParameters;
 
 import com.example.gsyvideoplayer.R;
 import com.example.gsyvideoplayer.databinding.ActivityDetailExoSubtitlePlayerBinding;
-import com.google.android.exoplayer2.SeekParameters;
 import com.shuyu.gsyvideoplayer.builder.GSYVideoOptionBuilder;
 import com.shuyu.gsyvideoplayer.listener.GSYSampleCallBack;
 import com.shuyu.gsyvideoplayer.listener.GSYVideoProgressListener;

File: app/src/main/java/com/example/gsyvideoplayer/exosubtitle/GSYExoSubTitlePlayerManager.java
Patch:
@@ -8,10 +8,10 @@
 import android.view.Surface;
 
 import androidx.annotation.Nullable;
+import androidx.media3.common.Player;
+import androidx.media3.exoplayer.SeekParameters;
+import androidx.media3.exoplayer.video.PlaceholderSurface;
 
-import com.google.android.exoplayer2.Player;
-import com.google.android.exoplayer2.SeekParameters;
-import com.google.android.exoplayer2.video.PlaceholderSurface;
 import com.shuyu.gsyvideoplayer.cache.ICacheManager;
 import com.shuyu.gsyvideoplayer.model.VideoOptionModel;
 import com.shuyu.gsyvideoplayer.player.BasePlayerManager;

File: app/src/main/java/com/example/gsyvideoplayer/exosubtitle/GSYExoSubTitleVideoManager.java
Patch:
@@ -8,8 +8,6 @@
 import android.view.ViewGroup;
 import android.view.Window;
 
-import com.google.android.exoplayer2.Player;
-import com.google.android.exoplayer2.text.TextOutput;
 import com.shuyu.gsyvideoplayer.GSYVideoBaseManager;
 import com.shuyu.gsyvideoplayer.player.IPlayerManager;
 import com.shuyu.gsyvideoplayer.utils.CommonUtil;
@@ -20,6 +18,8 @@
 
 import static com.shuyu.gsyvideoplayer.utils.CommonUtil.hideNavKey;
 
+import androidx.media3.common.Player;
+
 public class GSYExoSubTitleVideoManager extends GSYVideoBaseManager {
 
     public static final int SMALL_ID = com.shuyu.gsyvideoplayer.R.id.small_id;

File: app/src/main/java/com/example/gsyvideoplayer/utils/FileDataSink.java
Patch:
@@ -1,8 +1,9 @@
 package com.example.gsyvideoplayer.utils;
 
 
-import com.google.android.exoplayer2.upstream.DataSink;
-import com.google.android.exoplayer2.upstream.DataSpec;
+
+import androidx.media3.datasource.DataSink;
+import androidx.media3.datasource.DataSpec;
 
 import java.io.File;
 import java.io.FileOutputStream;

File: gsyVideoPlayer-exo_player2/src/main/java/tv/danmaku/ijk/media/exo2/Exo2PlayerManager.java
Patch:
@@ -8,9 +8,9 @@
 import android.view.Surface;
 
 import androidx.annotation.Nullable;
+import androidx.media3.exoplayer.SeekParameters;
+import androidx.media3.exoplayer.video.PlaceholderSurface;
 
-import com.google.android.exoplayer2.SeekParameters;
-import com.google.android.exoplayer2.video.PlaceholderSurface;
 import com.shuyu.gsyvideoplayer.cache.ICacheManager;
 import com.shuyu.gsyvideoplayer.model.GSYModel;
 import com.shuyu.gsyvideoplayer.model.VideoOptionModel;

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYVideoView.java
Patch:
@@ -387,7 +387,7 @@ public void run() {
                 if (GSYVideoView.this.mReleaseWhenLossAudio) {
                     GSYVideoView.this.releaseVideos();
                 } else {
-                    GSYVideoView.this.onVideoPause();
+                    getGSYVideoManager().listener().onVideoPause();
                 }
 
             }
@@ -399,11 +399,10 @@ public void run() {
      */
     protected void onLossTransientAudio() {
         try {
-            this.onVideoPause();
+            getGSYVideoManager().listener().onVideoPause();
         } catch (Exception var2) {
             var2.printStackTrace();
         }
-
     }
 
     /**

File: gsyVideoPlayer-proxy_cache/src/main/java/com/danikula/videocache/HttpUrlSource.java
Patch:
@@ -116,7 +116,7 @@ public void close() throws ProxyCacheException {
             } catch (NullPointerException | IllegalArgumentException e) {
                 String message = "Wait... but why? WTF!? " +
                     "Really shouldn't happen any more after fixing https://github.com/danikula/AndroidVideoCache/issues/43. " +
-                    "If you read it on your device log, please, notify me danikula@gmail.com or create issue here " +
+                    "If you read it on your device log, please, notify me https://github.com/danikula or create issue here " +
                     "https://github.com/danikula/AndroidVideoCache/issues.";
                 throw new RuntimeException(message, e);
             } catch (ArrayIndexOutOfBoundsException e) {

File: app/src/main/java/com/example/gsyvideoplayer/adapter/ListNormalAdapter.java
Patch:
@@ -99,13 +99,13 @@ public View getView(final int position, View convertView, ViewGroup parent) {
 
         //默认缓存路径
         //使用lazy的set可以避免滑动卡的情况存在
-        holder.gsyVideoPlayer.setUpLazy(url, true, null, null, "这是title");
+        //holder.gsyVideoPlayer.setUpLazy(url, true, null, null, "这是title");
 
         //holder.gsyVideoPlayer.setNeedShowWifiTip(false);
 
         /************************下方为其他路径************************************/
         //如果一个列表的缓存路劲都一一致
-        //holder.gsyVideoPlayer.setUp(url, true, new File(FileUtils.getTestPath()), "这是title");
+        holder.gsyVideoPlayer.setUp(url, true, new File(FileUtils.getTestPath()), "这是title");
 
         /************************下方为其他路径************************************/
         //如果一个列表里的缓存路劲不一致

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/utils/FileUtils.java
Patch:
@@ -11,7 +11,7 @@
 
 public class FileUtils {
 
-    private static final String SD_PATH = Environment.getExternalStorageDirectory().getPath();
+    //private static final String SD_PATH = Environment.getExternalStorageDirectory().getPath();
 
     public static final String NAME = "GSYVideo";
 
@@ -20,7 +20,7 @@ public class FileUtils {
 
     public static String getAppPath(String name) {
         StringBuilder sb = new StringBuilder();
-        sb.append(SD_PATH);
+        sb.append(Environment.getExternalStoragePublicDirectory("Download").getAbsolutePath());
         sb.append(File.separator);
         sb.append(name);
         sb.append(File.separator);
@@ -73,4 +73,4 @@ public static void saveBitmap(Bitmap bitmap, File file) {
         }
     }
 
-}
\ No newline at end of file
+}

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/GSYVideoBaseManager.java
Patch:
@@ -665,7 +665,7 @@ protected void cancelTimeOutBuffer() {
     private Runnable mTimeOutRunnable = new Runnable() {
         @Override
         public void run() {
-            if (listener != null) {
+            if (listener() != null) {
                 Debuger.printfError("time out for error listener");
                 listener().onError(BUFFER_TIME_OUT_ERROR, BUFFER_TIME_OUT_ERROR);
             }

File: app/src/main/java/com/example/gsyvideoplayer/utils/SmallVideoHelper.java
Patch:
@@ -121,7 +121,7 @@ public SmallVideoHelper(Context context, StandardGSYVideoPlayer player) {
      * 处理全屏逻辑
      */
     private void resolveToFull() {
-        systemUiVisibility = ((Activity) context).getWindow().getDecorView().getSystemUiVisibility();
+        systemUiVisibility = CommonUtil.getAppCompActivity(context).getWindow().getDecorView().getSystemUiVisibility();
         CommonUtil.hideSupportActionBar(context, gsyVideoOptionBuilder.isHideActionBar(), gsyVideoOptionBuilder.isHideStatusBar());
         if (gsyVideoOptionBuilder.isHideKey()) {
             hideNavKey(context);
@@ -341,7 +341,7 @@ public void run() {
     private void saveLocationStatus(Context context, boolean statusBar, boolean actionBar) {
         listParent.getLocationOnScreen(listItemRect);
         int statusBarH = getStatusBarHeight(context);
-        int actionBerH = getActionBarHeight((Activity) context);
+        int actionBerH = getActionBarHeight(CommonUtil.getAppCompActivity(context));
         if (statusBar) {
             listItemRect[1] = listItemRect[1] - statusBarH;
         }

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/utils/GSYVideoHelper.java
Patch:
@@ -346,7 +346,7 @@ public void run() {
     private void saveLocationStatus(Context context, boolean statusBar, boolean actionBar) {
         mParent.getLocationOnScreen(mNormalItemRect);
         int statusBarH = getStatusBarHeight(context);
-        int actionBerH = getActionBarHeight((Activity) context);
+        int actionBerH = getActionBarHeight(CommonUtil.getAppCompActivity(context));
         if (statusBar) {
             mNormalItemRect[1] = mNormalItemRect[1] - statusBarH;
         }

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/utils/ListVideoUtil.java
Patch:
@@ -183,7 +183,7 @@ public void resolveFullBtn() {
      * 处理全屏逻辑
      */
     private void resolveToFull() {
-        systemUiVisibility = ((Activity) context).getWindow().getDecorView().getSystemUiVisibility();
+        systemUiVisibility = CommonUtil.getAppCompActivity(context).getWindow().getDecorView().getSystemUiVisibility();
         CommonUtil.hideSupportActionBar(context, hideActionBar, hideStatusBar);
         if (hideKey) {
             hideNavKey(context);
@@ -365,7 +365,7 @@ public void run() {
     private void saveLocationStatus(Context context, boolean statusBar, boolean actionBar) {
         listParent.getLocationOnScreen(listItemRect);
         int statusBarH = getStatusBarHeight(context);
-        int actionBerH = getActionBarHeight((Activity) context);
+        int actionBerH = getActionBarHeight(CommonUtil.getAppCompActivity(context));
         if (statusBar) {
             listItemRect[1] = listItemRect[1] - statusBarH;
         }

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYBaseVideoPlayer.java
Patch:
@@ -205,8 +205,8 @@ private void saveLocationStatus(Context context, boolean statusBar, boolean acti
         getLocationOnScreen(mListItemRect);
         if (context instanceof Activity) {
             int statusBarH = getStatusBarHeight(context);
-            int actionBerH = getActionBarHeight((Activity) context);
-            boolean isTranslucent = ((WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS & ((Activity) context).getWindow().getAttributes().flags)
+            int actionBerH = getActionBarHeight(CommonUtil.getAppCompActivity(context));
+            boolean isTranslucent = ((WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS & CommonUtil.getAppCompActivity(context).getWindow().getAttributes().flags)
                 == WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);
             Debuger.printfLog("*************isTranslucent*************** " + isTranslucent);
             if (statusBar && !isTranslucent) {
@@ -631,7 +631,7 @@ public OrientationOption getOrientationOption() {
     public GSYBaseVideoPlayer startWindowFullscreen(final Context context, final boolean actionBar, final boolean statusBar) {
 
 
-        mSystemUiVisibility = ((Activity) context).getWindow().getDecorView().getSystemUiVisibility();
+        mSystemUiVisibility = CommonUtil.getAppCompActivity(context).getWindow().getDecorView().getSystemUiVisibility();
 
         hideSupportActionBar(context, actionBar, statusBar);
 

File: app/src/main/java/com/example/gsyvideoplayer/DetailPlayer.java
Patch:
@@ -362,6 +362,8 @@ private String getUrl() {
         //String url = "https://res.exexm.com/cw_145225549855002";
         //String url = "http://storage.gzstv.net/uploads/media/huangmeiyan/jr05-09.mp4";//mepg
         //String url = "https://zh-files.oss-cn-qingdao.aliyuncs.com/20170808223928mJ1P3n57.mp4";//90度
+        //String url = " String source1 = "http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4";
+        //String source1 = "http://video.cdn.aizys.com/zzx3.9g.mkv";//long
         return url;
     }
 

File: gsyVideoPlayer-proxy_cache/src/main/java/com/danikula/videocache/HttpProxyCache.java
Patch:
@@ -86,7 +86,7 @@ private void responseWithCache(OutputStream out, long offset) throws ProxyCacheE
     private void responseWithoutCache(OutputStream out, long offset) throws ProxyCacheException, IOException {
         HttpUrlSource newSourceNoCache = new HttpUrlSource(this.source);
         try {
-            newSourceNoCache.open((int) offset);
+            newSourceNoCache.open(offset);
             byte[] buffer = new byte[DEFAULT_BUFFER_SIZE];
             int readBytes;
             while ((readBytes = newSourceNoCache.read(buffer)) != -1) {

File: app/src/main/java/com/example/gsyvideoplayer/DetailPlayer.java
Patch:
@@ -137,6 +137,7 @@ protected void onCreate(Bundle savedInstanceState) {
                 .setUrl(url)
                 .setMapHeadData(header)
                 .setCacheWithPlay(false)
+                .setSurfaceErrorPlay(false)
                 .setVideoTitle("测试视频")
                 .setVideoAllCallBack(new GSYSampleCallBack() {
                     @Override

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYBaseVideoPlayer.java
Patch:
@@ -249,6 +249,7 @@ protected void cloneParams(GSYBaseVideoPlayer from, GSYBaseVideoPlayer to) {
         to.mBackFromFullScreenListener = from.mBackFromFullScreenListener;
         to.mGSYVideoProgressListener = from.mGSYVideoProgressListener;
         to.mHadPrepared = from.mHadPrepared;
+        to.mSurfaceErrorPlay = from.mSurfaceErrorPlay;
         to.mStartAfterPrepared = from.mStartAfterPrepared;
         to.mPauseBeforePrepared = from.mPauseBeforePrepared;
         to.mReleaseWhenLossAudio = from.mReleaseWhenLossAudio;

File: app/src/main/java/com/example/gsyvideoplayer/DetailPlayer.java
Patch:
@@ -308,7 +308,7 @@ private String getUrl() {
         //断网自动重新链接，url前接上ijkhttphook:
         //String url = "ijkhttphook:https://res.exexm.com/cw_145225549855002";
 
-        String url = "https://user-images.githubusercontent.com/10767119/147806204-ed38b392-14d0-4917-a95c-53d8a52f8662.mp4";
+        String url = "http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4";
         //String url = "http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4";
         //String url = "http://7xjmzj.com1.z0.glb.clouddn.com/20171026175005_JObCxCE2.mp4";
         //String url = "http://hjq-1257036536.cos.ap-shanghai.myqcloud.com/m3u8/m1/out2.m3u8";

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYBaseVideoPlayer.java
Patch:
@@ -606,7 +606,7 @@ public void onConfigurationChanged(Activity activity, Configuration newConfig, O
                 backFromFull(activity);
             }
             if (orientationUtils != null) {
-                orientationUtils.setEnable(true);
+                orientationUtils.setEnable(isRotateWithSystem());
             }
         }
 

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/StandardGSYVideoPlayer.java
Patch:
@@ -786,7 +786,7 @@ private void initFullUI(StandardGSYVideoPlayer standardGSYVideoPlayer) {
             standardGSYVideoPlayer.setDialogProgressBar(mDialogProgressBarDrawable);
         }
 
-        if (mDialogProgressHighLightColor >= 0 && mDialogProgressNormalColor >= 0) {
+        if (mDialogProgressHighLightColor != -11 && mDialogProgressNormalColor != -11) {
             standardGSYVideoPlayer.setDialogProgressColor(mDialogProgressHighLightColor, mDialogProgressNormalColor);
         }
     }

File: gsyVideoPlayer-proxy_cache/src/main/java/com/danikula/videocache/HttpProxyCacheServer.java
Patch:
@@ -440,13 +440,13 @@ public Builder headerInjector(HeaderInjector headerInjector) {
 
 
         public Builder hostnameVerifier(HostnameVerifier v) {
-            this.v = checkNotNull(v);
+            this.v = v;
             return this;
         }
 
 
         public Builder trustAllCerts(TrustManager[] trustAllCerts) {
-            this.trustAllCerts = checkNotNull(trustAllCerts);
+            this.trustAllCerts = trustAllCerts;
             return this;
         }
 

File: app/src/main/java/com/example/gsyvideoplayer/DetailPlayer.java
Patch:
@@ -326,7 +326,7 @@ private String getUrl() {
         //String url = "http://yongtaizx.xyz/20191230/t2Axgh3k/index.m3u8";
         //String url = "http://123.56.109.212:8035/users/bfe52074fba74247853caa764b522731/films/orig/aa4c3451-0468-452a-a189-bd064a1963e5-鹿鼎记下.mp4";
         //String url = "http://static.hnyequ.cn/yequ_iOS/4940735da1227890e6a261937223e0d2_828x1472.mp4";
-        String url = "https://tx.hls.huya.com/src/78941969-2579769454-11080025436149776384-3144993630-10057-A-0-1-imgplus_2000.m3u8?wsSecret=3e6b5903368d02d0c591a57a07940cca&wsTime=5f4ca52f&u=0&seqid=15987721445850596&ctype=tars_mobile&fs=bgct&sphdcdn=al_7-tx_3-js_3-ws_7-bd_2-hw_2&sphdDC=huya&sphd=264_*&t=103";
+        String url = "http://39.104.119.42/elevator-1.0/api/downFile?path=demo.ogv";
         //String url = "http://pointshow.oss-cn-hangzhou.aliyuncs.com/transcode/ORIGINAL/Mnbc61586842828593.mp4";
         //ssl error
         //String url =  "https://file.shftz.cn:8443/filesystem/download/10/2019/3/26/ce2c7c66-e9eb-42be-adf6-f9008385ea8c.mov/play";

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/utils/CommonUtil.java
Patch:
@@ -51,10 +51,10 @@ public static String stringForTime(int timeMs) {
     public static boolean isWifiConnected(Context context) {
         ConnectivityManager connectivityManager = (ConnectivityManager) context.getSystemService(Context.CONNECTIVITY_SERVICE);
         NetworkInfo wifiNetworkInfo = connectivityManager.getNetworkInfo(ConnectivityManager.TYPE_WIFI);
-        if (wifiNetworkInfo.isConnected()) {
-            return true;
+        if (wifiNetworkInfo == null) {
+            return false;
         }
-        return false;
+        return wifiNetworkInfo.isConnected();
     }
 
     /**

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/cache/ProxyCacheManager.java
Patch:
@@ -180,6 +180,7 @@ public void setProxy(HttpProxyCacheServer proxy) {
      */
     public HttpProxyCacheServer newProxy(Context context) {
         return new HttpProxyCacheServer.Builder(context.getApplicationContext())
+                .maxCacheSize(DEFAULT_MAX_SIZE)
                 .headerInjector(userAgentHeadersInjector).build();
     }
 

File: app/src/main/java/com/example/gsyvideoplayer/adapter/ListNormalAdapter.java
Patch:
@@ -152,7 +152,7 @@ public void onClick(View v) {
         holder.gsyVideoPlayer.setRotateViewAuto(!getListNeedAutoLand());
         holder.gsyVideoPlayer.setLockLand(!getListNeedAutoLand());
         holder.gsyVideoPlayer.setPlayTag(TAG);
-        //holder.gsyVideoPlayer.setAutoFullWithSize(true);
+        //holder.gsyVideoPlayer.c(true);
         holder.gsyVideoPlayer.setReleaseWhenLossAudio(false);
         holder.gsyVideoPlayer.setShowFullAnimation(!getListNeedAutoLand());
         holder.gsyVideoPlayer.setIsTouchWiget(false);

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/ListGSYVideoPlayer.java
Patch:
@@ -100,7 +100,7 @@ protected boolean setUp(List<GSYVideoModel> url, boolean cacheWithPlay, int posi
         mMapHeadData = mapHeadData;
         GSYVideoModel gsyVideoModel = url.get(position);
         boolean set = setUp(gsyVideoModel.getUrl(), cacheWithPlay, cachePath, gsyVideoModel.getTitle(), changeState);
-        if (!TextUtils.isEmpty(gsyVideoModel.getTitle()) ) {
+        if (!TextUtils.isEmpty(gsyVideoModel.getTitle()) && mTitleTextView != null ) {
             mTitleTextView.setText(gsyVideoModel.getTitle());
         }
         return set;
@@ -134,7 +134,7 @@ protected void resolveNormalVideoShow(View oldF, ViewGroup vp, GSYVideoPlayer gs
         if (gsyVideoPlayer != null) {
             ListGSYVideoPlayer listGSYVideoPlayer = (ListGSYVideoPlayer) gsyVideoPlayer;
             GSYVideoModel gsyVideoModel = mUriList.get(mPlayPosition);
-            if (!TextUtils.isEmpty(gsyVideoModel.getTitle())) {
+            if (!TextUtils.isEmpty(gsyVideoModel.getTitle()) && mTitleTextView != null) {
                 mTitleTextView.setText(gsyVideoModel.getTitle());
             }
         }
@@ -207,7 +207,7 @@ public boolean playNext() {
             GSYVideoModel gsyVideoModel = mUriList.get(mPlayPosition);
             mSaveChangeViewTIme = 0;
             setUp(mUriList, mCache, mPlayPosition, null, mMapHeadData, false);
-            if (!TextUtils.isEmpty(gsyVideoModel.getTitle())) {
+            if (!TextUtils.isEmpty(gsyVideoModel.getTitle()) && mTitleTextView != null) {
                 mTitleTextView.setText(gsyVideoModel.getTitle());
             }
             startPlayLogic();

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYBaseVideoPlayer.java
Patch:
@@ -518,7 +518,7 @@ protected boolean isVerticalVideo() {
     protected boolean isLockLandByAutoFullSize() {
         boolean isLockLand = mLockLand;
         if (isAutoFullWithSize()) {
-            isLockLand = true;
+            isLockLand = isVerticalVideo();
         }
         return isLockLand;
     }

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/cache/ProxyCacheManager.java
Patch:
@@ -24,6 +24,8 @@
 
 public class ProxyCacheManager implements ICacheManager, CacheListener {
 
+    public static int DEFAULT_MAX_SIZE = 512 * 1024 * 1024;
+
     //视频代理
     protected HttpProxyCacheServer proxy;
 
@@ -154,6 +156,7 @@ public HttpProxyCacheServer newProxy(Context context, File file) {
         }
         HttpProxyCacheServer.Builder builder = new HttpProxyCacheServer.Builder(context);
         builder.cacheDirectory(file);
+        builder.maxCacheSize(DEFAULT_MAX_SIZE);
         builder.headerInjector(userAgentHeadersInjector);
         mCacheDir = file;
         return builder.build();

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYBaseVideoPlayer.java
Patch:
@@ -251,6 +251,7 @@ protected void cloneParams(GSYBaseVideoPlayer from, GSYBaseVideoPlayer to) {
         to.mActionBar = from.mActionBar;
         to.mStatusBar = from.mStatusBar;
         to.mAutoFullWithSize = from.mAutoFullWithSize;
+        to.mOverrideExtension = from.mOverrideExtension;
         if (from.mSetUpLazy) {
             to.setUpLazy(from.mOriginUrl, from.mCache, from.mCachePath, from.mMapHeadData, from.mTitle);
             to.mUrl = from.mUrl;

File: app/src/main/java/com/example/gsyvideoplayer/DetailPlayer.java
Patch:
@@ -254,7 +254,7 @@ private GSYVideoPlayer getCurPlay() {
 
     private String getUrl() {
 
-        //String url = "android.resource://" + getPackageName() + "/" + R.raw.test1;
+        //String url = "android.resource://" + getPackageName() + "/" + R.raw.test;
         //注意，用ijk模式播放raw视频，这个必须打开
         //GSYVideoManager.instance().enableRawPlay(getApplicationContext());
 

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYVideoControlView.java
Patch:
@@ -902,7 +902,6 @@ protected void setTextAndProgress(int secProgress) {
         int duration = getDuration();
         int progress = position * 100 / (duration == 0 ? 1 : duration);
         setProgressAndTime(progress, secProgress, position, duration);
-        setProgressAndTime(progress, secProgress, position, duration);
     }
 
     protected void setProgressAndTime(int progress, int secProgress, int currentTime, int totalTime) {

File: app/src/main/java/com/example/gsyvideoplayer/exo/DetailExoListPlayer.java
Patch:
@@ -44,13 +44,14 @@ protected void onCreate(Bundle savedInstanceState) {
         initVideo();
 
         List<GSYVideoModel> urls = new ArrayList<>();
-        urls.add(new GSYVideoModel("http://7xjmzj.com1.z0.glb.clouddn.com/20171026175005_JObCxCE2.mp4", "标题1"));
+        urls.add(new GSYVideoModel("https://a1.test.eceibs.com.cn/index.php/mobile/file/media?hash=video%2Flesson%2Fceibs%2F744a6931501642f3a41998624e280137.mp4&sso_token=3789824fe1386eabf866610e50265ef1&user_id=10547&company_id=145&sys_id=0&client_version=1.5.2&resolution=sd", "标题1"));
         urls.add(new GSYVideoModel("https://media6.smartstudy.com/ae/07/3997/2/dest.m3u8", "标题3"));
         urls.add(new GSYVideoModel("http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4", "标题2"));
         detailPlayer.setUp(urls, 0);
 
         //使用 exo 的 CacheDataSourceFactory 实现
-        detailPlayer.setExoCache(true);
+        detailPlayer.setExoCache(false);
+        detailPlayer.setOverrideExtension("m3u8");
 
         //增加封面
         ImageView imageView = new ImageView(this);

File: app/src/main/java/com/example/gsyvideoplayer/exo/GSYExo2MediaPlayer.java
Patch:
@@ -70,7 +70,7 @@ public void setDataSource(List<String> uris, Map<String, String> headers, boolea
         }
         ConcatenatingMediaSource concatenatedSource = new ConcatenatingMediaSource();
         for (String uri : uris) {
-            MediaSource mediaSource = mExoHelper.getMediaSource(uri, isPreview, cache, false, mCacheDir, null);
+            MediaSource mediaSource = mExoHelper.getMediaSource(uri, isPreview, cache, false, mCacheDir,  getOverrideExtension());
             concatenatedSource.addMediaSource(mediaSource);
         }
         mMediaSource = concatenatedSource;

File: app/src/main/java/com/example/gsyvideoplayer/exo/GSYExo2PlayerView.java
Patch:
@@ -180,7 +180,7 @@ protected void startPrepare() {
             Debuger.printfError("********************** urls isEmpty . Do you know why ? **********************");
         }
 
-        ((GSYExoVideoManager) getGSYVideoManager()).prepare(urls, (mMapHeadData == null) ? new HashMap<String, String>() : mMapHeadData, mLooping, mSpeed, mExoCache, mCachePath);
+        ((GSYExoVideoManager) getGSYVideoManager()).prepare(urls, (mMapHeadData == null) ? new HashMap<String, String>() : mMapHeadData, mLooping, mSpeed, mExoCache, mCachePath, mOverrideExtension);
 
         setStateAndUi(CURRENT_STATE_PREPAREING);
     }

File: app/src/main/java/com/example/gsyvideoplayer/exo/GSYExoModel.java
Patch:
@@ -16,8 +16,8 @@ public class GSYExoModel extends GSYModel {
 
     List<String> urls = new ArrayList<>();
 
-    public GSYExoModel(List<String> urls, Map<String, String> mapHeadData, boolean loop, float speed, boolean cache, File cachePath) {
-        super("", mapHeadData, loop, speed, cache, cachePath, "");
+    public GSYExoModel(List<String> urls, Map<String, String> mapHeadData, boolean loop, float speed, boolean cache, File cachePath, String overrideExtension) {
+        super("", mapHeadData, loop, speed, cache, cachePath, overrideExtension);
         this.urls = urls;
     }
 

File: app/src/main/java/com/example/gsyvideoplayer/exo/GSYExoPlayerManager.java
Patch:
@@ -9,6 +9,7 @@
 import com.shuyu.gsyvideoplayer.cache.ICacheManager;
 import com.shuyu.gsyvideoplayer.model.VideoOptionModel;
 import com.shuyu.gsyvideoplayer.player.BasePlayerManager;
+import com.shuyu.gsyvideoplayer.utils.Debuger;
 
 import java.util.List;
 
@@ -40,6 +41,8 @@ public void initVideoPlayer(Context context, Message msg, List<VideoOptionModel>
         }
         try {
             mediaPlayer.setLooping(((GSYExoModel) msg.obj).isLooping());
+            Debuger.printfError("###### " + ((GSYExoModel) msg.obj).getOverrideExtension());
+            mediaPlayer.setOverrideExtension(((GSYExoModel) msg.obj).getOverrideExtension());
             mediaPlayer.setDataSource(((GSYExoModel) msg.obj).getUrls(), ((GSYExoModel) msg.obj).getMapHeadData(), ((GSYExoModel) msg.obj).isCache());
             //很遗憾，EXO2的setSpeed只能在播放前生效
             if (((GSYExoModel) msg.obj).getSpeed() != 1 && ((GSYExoModel) msg.obj).getSpeed() > 0) {

File: app/src/main/java/com/example/gsyvideoplayer/exo/GSYExoVideoManager.java
Patch:
@@ -53,11 +53,11 @@ protected IPlayerManager getPlayManager() {
         return new GSYExoPlayerManager();
     }
 
-    public void prepare(List<String> urls, Map<String, String> mapHeadData, boolean loop, float speed, boolean cache, File cachePath) {
+    public void prepare(List<String> urls, Map<String, String> mapHeadData, boolean loop, float speed, boolean cache, File cachePath, String overrideExtension) {
         if (urls.size() == 0) return;
         Message msg = new Message();
         msg.what = HANDLER_PREPARE;
-        msg.obj = new GSYExoModel(urls, mapHeadData, loop, speed, cache, cachePath);
+        msg.obj = new GSYExoModel(urls, mapHeadData, loop, speed, cache, cachePath, overrideExtension);
         sendMessage(msg);
         if (needTimeOutOther) {
             startTimeOutBuffer();

File: gsyVideoPlayer-exo_player2/src/main/java/tv/danmaku/ijk/media/exo2/IjkExo2MediaPlayer.java
Patch:
@@ -353,7 +353,7 @@ public void run() {
                                 ? (preferExtensionDecoders ? DefaultRenderersFactory.EXTENSION_RENDERER_MODE_PREFER
                                 : DefaultRenderersFactory.EXTENSION_RENDERER_MODE_ON)
                                 : DefaultRenderersFactory.EXTENSION_RENDERER_MODE_OFF;
-                        if (mRendererFactory != null) {
+                        if (mRendererFactory == null) {
                             mRendererFactory = new DefaultRenderersFactory(mAppContext);
                             mRendererFactory.setExtensionRendererMode(extensionRendererMode);
                         }

File: app/src/main/java/com/example/gsyvideoplayer/adapter/ListNormalAdapter.java
Patch:
@@ -251,7 +251,7 @@ public boolean isFull() {
      * @return 返回true为支持列表重力全屏
      */
     public boolean getListNeedAutoLand() {
-        return false;
+        return true;
     }
 
     private void initOrientationUtils(StandardGSYVideoPlayer standardGSYVideoPlayer, boolean full) {
@@ -295,7 +295,7 @@ public void onPrepared() {
     public void onConfigurationChanged(Activity activity, Configuration newConfig) {
         //如果旋转了就全屏
         if (isPlay && curPlayer != null && orientationUtils != null) {
-            curPlayer.onConfigurationChanged(activity, newConfig, orientationUtils, false, true);
+            curPlayer.getCurrentPlayer().onConfigurationChanged(activity, newConfig, orientationUtils, false, true);
         }
     }
 

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYBaseVideoPlayer.java
Patch:
@@ -363,7 +363,9 @@ protected void resolveNormalVideoShow(View oldF, ViewGroup vp, GSYVideoPlayer gs
             showNavKey(mContext, mSystemUiVisibility);
         }
         showSupportActionBar(mContext, mActionBar, mStatusBar);
-        getFullscreenButton().setImageResource(getEnlargeImageRes());
+        if(getFullscreenButton() != null) {
+            getFullscreenButton().setImageResource(getEnlargeImageRes());
+        }
     }
 
 

File: app/src/main/java/com/example/gsyvideoplayer/holder/RecyclerItemViewHolder.java
Patch:
@@ -51,9 +51,9 @@ public void onBind(final int position, VideoModel videoModel) {
         listItemBtn.setOnClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View v) {
+                smallVideoHelper.setPlayPositionAndTag(position, TAG);
                 getRecyclerBaseAdapter().notifyDataSetChanged();
                 //listVideoUtil.setLoop(true);
-                smallVideoHelper.setPlayPositionAndTag(position, TAG);
                 String url;
                 if (position % 2 == 0) {
                     url = "https://res.exexm.com/cw_145225549855002";

File: gsyVideoPlayer-exo_player2/src/main/java/tv/danmaku/ijk/media/exo2/ExoSourceManager.java
Patch:
@@ -177,7 +177,7 @@ public void release() {
             try {
                 mCache.release();
                 mCache = null;
-            } catch (Cache.CacheException e) {
+            } catch (Exception e) {
                 e.printStackTrace();
             }
         }

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/GSYVideoBaseManager.java
Patch:
@@ -145,9 +145,7 @@ public void clearDefaultCache(Context context, @Nullable File cacheDir, @Nullabl
     }
 
     protected void init() {
-        HandlerThread mediaHandlerThread = new HandlerThread(TAG);
-        mediaHandlerThread.start();
-        mMediaHandler = new MediaHandler((mediaHandlerThread.getLooper()));
+        mMediaHandler = new MediaHandler((Looper.getMainLooper()));
         mainThreadHandler = new Handler();
     }
 

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYVideoView.java
Patch:
@@ -582,6 +582,7 @@ public void onPrepared() {
 
         if (!mStartAfterPrepared) {
             setStateAndUi(CURRENT_STATE_PAUSE);
+            onVideoPause();//todo 加上这个
             return;
         }
 

File: app/src/main/java/com/example/gsyvideoplayer/GSYApplication.java
Patch:
@@ -39,7 +39,7 @@ public void onCreate() {
         //GSYVideoType.enableMediaCodec();
         //GSYVideoType.enableMediaCodecTexture();
 
-        PlayerFactory.setPlayManager(Exo2PlayerManager.class);//EXO模式
+        //PlayerFactory.setPlayManager(Exo2PlayerManager.class);//EXO模式
         //PlayerFactory.setPlayManager(SystemPlayerManager.class);//系统模式
         //PlayerFactory.setPlayManager(IjkPlayerManager.class);//ijk模式
 

File: app/src/main/java/com/example/gsyvideoplayer/DetailListPlayer.java
Patch:
@@ -50,7 +50,7 @@ protected void onCreate(Bundle savedInstanceState) {
 
         //String url = "http://baobab.wd jcdn.com/14564977406580.mp4";
         List<GSYVideoModel> urls = new ArrayList<>();
-        urls.add(new GSYVideoModel("http://7xse1z.com1.z0.glb.clouddn.com/1491813192", "标题1"));
+        urls.add(new GSYVideoModel("http://wdquan-space.b0.upaiyun.com/VIDEO/2018/11/22/ae0645396048_hls_time10.m3u8", "标题1"));
         urls.add(new GSYVideoModel("http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4", "标题2"));
         urls.add(new GSYVideoModel("https://res.exexm.com/cw_145225549855002", "标题3"));
         urls.add(new GSYVideoModel("http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4", "标题4"));

File: app/src/main/java/com/example/gsyvideoplayer/DetailPlayer.java
Patch:
@@ -97,6 +97,7 @@ protected void onCreate(Bundle savedInstanceState) {
                 .setShowFullAnimation(false)
                 .setNeedLockFull(true)
                 .setUrl(url)
+                .setLooping(true)
                 .setMapHeadData(header)
                 .setCacheWithPlay(false)
                 .setVideoTitle("测试视频")
@@ -257,7 +258,8 @@ private String getUrl() {
         //String url =  "http://ipsimg-huabei2.speiyou.cn/010/video/other/20180424/40288b156290270d0162a3db8cdd033e/40288b156290270d0162a3e8207f074f/e787a64c-f2d0-48fe-896d-246af05f111a.mp4";
 
         //String url =  "http://video.7k.cn/app_video/20171202/6c8cf3ea/v.m3u8.mp4";
-        String url =  "http://devimages.apple.com.edgekey.net/streaming/examples/bipbop_4x3/bipbop_4x3_variant.m3u8";
+        //String url =  "http://devimages.apple.com.edgekey.net/streaming/examples/bipbop_4x3/bipbop_4x3_variant.m3u8";
+        String url =  "http://wdquan-space.b0.upaiyun.com/VIDEO/2018/11/22/ae0645396048_hls_time10.m3u8";
         //String url =  "https://cdn61.ytbbs.tv/cn/tv/55550/55550-1/play.m3u8?md5=v4sI4lWlo4XojzeAjgBGaQ&expires=1521204012&token=55550";
         //String url =  "http://1253492636.vod2.myqcloud.com/2e5fc148vodgzp1253492636/d08af82d4564972819086152830/plHZZoSkje0A.mp4";
 

File: app/src/main/java/com/example/gsyvideoplayer/GSYApplication.java
Patch:
@@ -39,7 +39,7 @@ public void onCreate() {
         //GSYVideoType.enableMediaCodec();
         //GSYVideoType.enableMediaCodecTexture();
 
-        //PlayerFactory.setPlayManager(Exo2PlayerManager.class);//EXO模式
+        PlayerFactory.setPlayManager(Exo2PlayerManager.class);//EXO模式
         //PlayerFactory.setPlayManager(SystemPlayerManager.class);//系统模式
         //PlayerFactory.setPlayManager(IjkPlayerManager.class);//ijk模式
 

File: app/src/main/java/com/example/gsyvideoplayer/adapter/ListNormalAdapter.java
Patch:
@@ -82,7 +82,7 @@ public View getView(final int position, View convertView, ViewGroup parent) {
 
         //final String url = "https://res.exexm.com/cw_145225549855002";
         final String urlH = "http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4";
-        final String urlV = "http://7xse1z.com1.z0.glb.clouddn.com/1491813192";
+        final String urlV = "http://wdquan-space.b0.upaiyun.com/VIDEO/2018/11/22/ae0645396048_hls_time10.m3u8";
         final String url = (position % 2 == 0) ? urlH : urlV;
         //final String url = "http://111.198.24.133:83/yyy_login_server/pic/YB059284/97778276040859/1.mp4";
 

File: app/src/main/java/com/example/gsyvideoplayer/exo/DetailExoListPlayer.java
Patch:
@@ -45,7 +45,7 @@ protected void onCreate(Bundle savedInstanceState) {
 
         List<GSYVideoModel> urls = new ArrayList<>();
         urls.add(new GSYVideoModel("https://media6.smartstudy.com/ae/07/3997/2/dest.m3u8", "标题3"));
-        urls.add(new GSYVideoModel("http://7xse1z.com1.z0.glb.clouddn.com/1491813192", "标题1"));
+        urls.add(new GSYVideoModel("http://wdquan-space.b0.upaiyun.com/VIDEO/2018/11/22/ae0645396048_hls_time10.m3u8", "标题1"));
         urls.add(new GSYVideoModel("http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4", "标题2"));
         detailPlayer.setUp(urls, 0);
 

File: app/src/main/java/com/example/gsyvideoplayer/holder/RecyclerItemViewHolder.java
Patch:
@@ -58,7 +58,7 @@ public void onClick(View v) {
                 if (position % 2 == 0) {
                     url = "https://res.exexm.com/cw_145225549855002";
                 } else {
-                    url = "http://7xse1z.com1.z0.glb.clouddn.com/1491813192";
+                    url = "http://wdquan-space.b0.upaiyun.com/VIDEO/2018/11/22/ae0645396048_hls_time10.m3u8";
                 }
                 //listVideoUtil.setCachePath(new File(FileUtils.getPath()));
 

File: app/src/main/java/com/example/gsyvideoplayer/simple/SimpleDetailActivityMode2.java
Patch:
@@ -34,7 +34,7 @@ protected void onCreate(Bundle savedInstanceState) {
 
         detailPlayer = (StandardGSYVideoPlayer) findViewById(R.id.detail_player);
 
-        String url = "http://7xse1z.com1.z0.glb.clouddn.com/1491813192";
+        String url = "http://wdquan-space.b0.upaiyun.com/VIDEO/2018/11/22/ae0645396048_hls_time10.m3u8";
 
         //增加封面
         ImageView imageView = new ImageView(this);

File: app/src/main/java/com/example/gsyvideoplayer/simple/adapter/SimpleListVideoModeAdapter.java
Patch:
@@ -69,7 +69,7 @@ public View getView(final int position, View convertView, ViewGroup parent) {
         }
 
         final String urlH = "http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4";
-        final String urlV = "http://7xse1z.com1.z0.glb.clouddn.com/1491813192";
+        final String urlV = "http://wdquan-space.b0.upaiyun.com/VIDEO/2018/11/22/ae0645396048_hls_time10.m3u8";
         final String url = (position % 2 == 0) ? urlH : urlV;
 
         if (position % 2 == 0) {

File: app/src/main/java/com/example/gsyvideoplayer/switchplay/SwitchListVideoAdapter.java
Patch:
@@ -70,7 +70,7 @@ public View getView(final int position, View convertView, ViewGroup parent) {
             holder = (ViewHolder) convertView.getTag();
         }
         final String urlH = "http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4";
-        final String urlV = "http://7xse1z.com1.z0.glb.clouddn.com/1491813192";
+        final String urlV = "http://wdquan-space.b0.upaiyun.com/VIDEO/2018/11/22/ae0645396048_hls_time10.m3u8";
         final String url = (position % 2 == 0) ? urlH : urlV;
         final int coverId = (position % 2 == 0) ? R.mipmap.xxx1 : R.mipmap.xxx2;
 

File: app/src/main/java/com/example/gsyvideoplayer/video/RequestListADVideoPlayer.java
Patch:
@@ -33,8 +33,8 @@ public void run() {
                 Random random = new Random();
                 int i = random.nextInt(max) % (max - min + 1) + min;
                 if (i % 3 == 0) {
-                    mOriginUrl = "http://7xse1z.com1.z0.glb.clouddn.com/1491813192";
-                    mUrl = "http://7xse1z.com1.z0.glb.clouddn.com/1491813192";
+                    mOriginUrl = "http://wdquan-space.b0.upaiyun.com/VIDEO/2018/11/22/ae0645396048_hls_time10.m3u8";
+                    mUrl = "http://wdquan-space.b0.upaiyun.com/VIDEO/2018/11/22/ae0645396048_hls_time10.m3u8";
                     mTitle = "ggg2";
                 } else if (i % 4 == 0) {
                     //模拟请求失败

File: gsyVideoPlayer-exo_player2/src/main/java/tv/danmaku/ijk/media/exo2/IjkExo2MediaPlayer.java
Patch:
@@ -546,7 +546,7 @@ public void onPlaybackParametersChanged(PlaybackParameters playbackParameters) {
 
     @Override
     public void onSeekProcessed() {
-
+        notifyOnSeekComplete();
     }
 
     /////////////////////////////////////AudioRendererEventListener/////////////////////////////////////////////

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYVideoView.java
Patch:
@@ -640,7 +640,7 @@ public void onCompletion() {
 
     @Override
     public void onSeekComplete() {
-
+        Debuger.printfLog("onSeekComplete");
     }
 
     @Override

File: app/src/main/java/com/example/gsyvideoplayer/DetailPlayer.java
Patch:
@@ -244,7 +244,7 @@ private String getUrl() {
         //String url = "ijkhttphook:https://res.exexm.com/cw_145225549855002";
 
         //String url = "http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4";
-        String url = "http://hjq-1257036536.cos.ap-shanghai.myqcloud.com/m3u8/m1/video.m3u8";
+        String url = "http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4";
         //String url = "http://7xjmzj.com1.z0.glb.clouddn.com/20171026175005_JObCxCE2.mp4";
         //String url = "http://hjq-1257036536.cos.ap-shanghai.myqcloud.com/m3u8/m1/out2.m3u8";
         //String url = "http://223.110.243.138/PLTV/2510088/224/3221227177/index.m3u8";

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYVideoView.java
Patch:
@@ -7,6 +7,8 @@
 import android.graphics.RectF;
 import android.media.AudioManager;
 import android.media.MediaPlayer;
+import android.os.Handler;
+import android.os.Looper;
 import android.support.annotation.AttrRes;
 import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
@@ -27,7 +29,6 @@
 import java.io.File;
 import java.util.HashMap;
 import java.util.Map;
-
 import static com.shuyu.gsyvideoplayer.utils.CommonUtil.getTextSpeed;
 
 /**
@@ -364,7 +365,7 @@ protected void onGankAudio() {
      * 失去了Audio Focus，并将会持续很长的时间
      */
     protected void onLossAudio() {
-        this.post(new Runnable() {
+        new Handler(Looper.getMainLooper()).post(new Runnable() {
             public void run() {
                 if (GSYVideoView.this.mReleaseWhenLossAudio) {
                     GSYVideoView.this.releaseVideos();

File: gsyVideoPlayer-exo_player2/src/main/java/tv/danmaku/ijk/media/exo2/IjkExo2MediaPlayer.java
Patch:
@@ -4,6 +4,7 @@
 import android.content.Context;
 import android.net.NetworkInfo;
 import android.net.Uri;
+import android.os.Looper;
 import android.support.annotation.Nullable;
 import android.support.annotation.Size;
 import android.view.Surface;
@@ -179,7 +180,7 @@ public void prepareAsync() throws IllegalStateException {
 
         rendererFactory = new DefaultRenderersFactory(mAppContext, extensionRendererMode);
         DefaultLoadControl loadControl = new DefaultLoadControl();
-        mInternalPlayer = ExoPlayerFactory.newSimpleInstance(mAppContext, rendererFactory, mTrackSelector, loadControl, null);
+        mInternalPlayer = ExoPlayerFactory.newSimpleInstance(mAppContext, rendererFactory, mTrackSelector, loadControl, null, Looper.getMainLooper());
         mInternalPlayer.addListener(this);
         mInternalPlayer.addAnalyticsListener(this);
         mInternalPlayer.addListener(mEventLogger);

File: app/src/main/java/com/example/gsyvideoplayer/GSYApplication.java
Patch:
@@ -39,7 +39,7 @@ public void onCreate() {
         //GSYVideoType.enableMediaCodec();
         //GSYVideoType.enableMediaCodecTexture();
 
-        PlayerFactory.setPlayManager(Exo2PlayerManager.class);//EXO模式
+        //PlayerFactory.setPlayManager(Exo2PlayerManager.class);//EXO模式
         //PlayerFactory.setPlayManager(SystemPlayerManager.class);//系统模式
         //PlayerFactory.setPlayManager(IjkPlayerManager.class);//ijk模式
 

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/builder/GSYVideoOptionBuilder.java
Patch:
@@ -529,7 +529,9 @@ public GSYVideoOptionBuilder setEffectFilter(GSYVideoGLView.ShaderInterface effe
 
     /**
      * 在播放前才真正执行setup
+     * 目前弃用，请使用正常setup
      */
+    @Deprecated
     public GSYVideoOptionBuilder setSetUpLazy(boolean setUpLazy) {
         this.mSetUpLazy = setUpLazy;
         return this;

File: app/src/main/java/com/example/gsyvideoplayer/DetailPlayer.java
Patch:
@@ -98,7 +98,7 @@ protected void onCreate(Bundle savedInstanceState) {
                 .setNeedLockFull(true)
                 .setUrl(url)
                 .setMapHeadData(header)
-                .setCacheWithPlay(true)
+                .setCacheWithPlay(false)
                 .setVideoTitle("测试视频")
                 .setVideoAllCallBack(new GSYSampleCallBack() {
                     @Override
@@ -243,7 +243,8 @@ private String getUrl() {
         //断网自动重新链接，url前接上ijkhttphook:
         //String url = "ijkhttphook:https://res.exexm.com/cw_145225549855002";
 
-        String url = "http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4";
+        //String url = "http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4";
+        String url = "http://hjq-1257036536.cos.ap-shanghai.myqcloud.com/m3u8/m1/video.m3u8";
         //String url = "http://7xjmzj.com1.z0.glb.clouddn.com/20171026175005_JObCxCE2.mp4";
         //String url = "http://hjq-1257036536.cos.ap-shanghai.myqcloud.com/m3u8/m1/out2.m3u8";
         //String url = "http://223.110.243.138/PLTV/2510088/224/3221227177/index.m3u8";

File: gsyVideoPlayer-proxy_cache/src/main/java/com/danikula/videocache/HttpUrlSource.java
Patch:
@@ -180,6 +180,7 @@ private void injectCustomHeaders(HttpURLConnection connection, String url) {
         if (extraHeaders == null) {
             return;
         }
+        HttpProxyCacheDebuger.printfError("****** injectCustomHeaders ****** :" + extraHeaders.size());
         for (Map.Entry<String, String> header : extraHeaders.entrySet()) {
             connection.setRequestProperty(header.getKey(), header.getValue());
         }

File: app/src/main/java/com/example/gsyvideoplayer/DetailPlayer.java
Patch:
@@ -238,8 +238,8 @@ private String getUrl() {
         //断网自动重新链接，url前接上ijkhttphook:
         //String url = "ijkhttphook:https://res.exexm.com/cw_145225549855002";
 
-        //
-        String url = "http://7xjmzj.com1.z0.glb.clouddn.com/20171026175005_JObCxCE2.mp4";
+        String url = "http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4";
+        //String url = "http://7xjmzj.com1.z0.glb.clouddn.com/20171026175005_JObCxCE2.mp4";
         //String url = "http://hjq-1257036536.cos.ap-shanghai.myqcloud.com/m3u8/m1/out2.m3u8";
         //String url = "http://223.110.243.138/PLTV/2510088/224/3221227177/index.m3u8";
         //String url = "http://qiniu.carmmi.com/image/132451525666042.mp4";

File: app/src/main/java/com/example/gsyvideoplayer/switchplay/SwitchVideo.java
Patch:
@@ -35,6 +35,9 @@ public void onClick(View v) {
                 if (isInPlayingState()) {
                     SwitchUtil.savePlayState(SwitchVideo.this);
                     getGSYVideoManager().setLastListener(SwitchVideo.this);
+                    //fixme 页面跳转是，元素共享，效果会有一个中间中间控件的存在
+                    //fixme 这时候中间控件 CURRENT_STATE_PLAYING，会触发 startProgressTimer
+                    //FIXME 但是没有cancel
                     SwitchDetailActivity.startTActivity((Activity) getContext(), SwitchVideo.this);
                 }
             }

File: app/src/main/java/com/example/gsyvideoplayer/GSYApplication.java
Patch:
@@ -35,11 +35,11 @@ public void onCreate() {
         //GSYVideoType.enableMediaCodec();
         //GSYVideoType.enableMediaCodecTexture();
 
-        PlayerFactory.setPlayManager(new Exo2PlayerManager());//EXO模式
+        //PlayerFactory.setPlayManager(new Exo2PlayerManager());//EXO模式
         //PlayerFactory.setPlayManager(new SystemPlayerManager());//系统模式
         //PlayerFactory.setPlayManager(new IjkPlayerManager());//ijk模式
 
-        CacheFactory.setCacheManager(new ExoPlayerCacheManager());//exo缓存模式，支持m3u8，只支持exo
+        //CacheFactory.setCacheManager(new ExoPlayerCacheManager());//exo缓存模式，支持m3u8，只支持exo
         //CacheFactory.setCacheManager(new ProxyCacheManager());//代理缓存模式，支持所有模式，不支持m3u8等
 
         //GSYVideoType.setShowType(GSYVideoType.SCREEN_MATCH_FULL);

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/utils/OrientationUtils.java
Patch:
@@ -39,7 +39,7 @@ public OrientationUtils(Activity activity, GSYBaseVideoPlayer gsyVideoPlayer) {
     }
 
     private void init() {
-        orientationEventListener = new OrientationEventListener(activity) {
+        orientationEventListener = new OrientationEventListener(activity.getApplicationContext()) {
             @Override
             public void onOrientationChanged(int rotation) {
                 boolean autoRotateOn = (Settings.System.getInt(activity.getContentResolver(), Settings.System.ACCELEROMETER_ROTATION, 0) == 1);

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYBaseVideoPlayer.java
Patch:
@@ -553,7 +553,7 @@ public void onConfigurationChanged(Activity activity, Configuration newConfig, O
             }
         } else {
             //新版本isIfCurrentIsFullscreen的标志位内部提前设置了，所以不会和手动点击冲突
-            if (isIfCurrentIsFullscreen() && isVerticalFullByVideoSize()) {
+            if (isIfCurrentIsFullscreen() && !isVerticalFullByVideoSize()) {
                 backFromFull(activity);
             }
             if (orientationUtils != null) {

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYBaseVideoPlayer.java
Patch:
@@ -141,7 +141,7 @@ public void onClick(View v) {
     @Override
     protected void lockTouchLogic() {
         super.lockTouchLogic();
-        if (mLockCurScreen) {
+        if (!mLockCurScreen) {
             if (mOrientationUtils != null)
                 mOrientationUtils.setEnable(isRotateViewAuto());
         } else {

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/ListGSYVideoPlayer.java
Patch:
@@ -106,6 +106,7 @@ protected boolean setUp(List<GSYVideoModel> url, boolean cacheWithPlay, int posi
         return set;
     }
 
+
     @Override
     protected void cloneParams(GSYBaseVideoPlayer from, GSYBaseVideoPlayer to) {
         super.cloneParams(from, to);
@@ -142,6 +143,7 @@ protected void resolveNormalVideoShow(View oldF, ViewGroup vp, GSYVideoPlayer gs
 
     @Override
     public void onCompletion() {
+        releaseNetWorkState();
         if (mPlayPosition < (mUriList.size())) {
             return;
         }

File: app/src/main/java/com/example/gsyvideoplayer/DetailControlActivity.java
Patch:
@@ -45,7 +45,6 @@
 import permissions.dispatcher.OnShowRationale;
 import permissions.dispatcher.PermissionRequest;
 import permissions.dispatcher.RuntimePermissions;
-import tv.danmaku.ijk.media.player.IjkMediaPlayer;
 
 /**
  * sampleVideo支持全屏与非全屏切换的清晰度，旋转，镜像等功能.

File: app/src/main/java/com/example/gsyvideoplayer/DetailPlayer.java
Patch:
@@ -28,7 +28,6 @@
 
 import butterknife.BindView;
 import butterknife.ButterKnife;
-import tv.danmaku.ijk.media.player.IjkMediaPlayer;
 
 
 public class DetailPlayer extends AppCompatActivity {

File: app/src/main/java/com/example/gsyvideoplayer/GSYApplication.java
Patch:
@@ -5,8 +5,6 @@
 import com.shuyu.gsyvideoplayer.GSYVideoManager;
 import com.shuyu.gsyvideoplayer.utils.GSYVideoType;
 
-import tv.danmaku.ijk.media.player.IjkMediaPlayer;
-
 //import com.squareup.leakcanary.LeakCanary;
 
 /**

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/cache/ProxyCacheManager.java
Patch:
@@ -20,6 +20,7 @@
 import tv.danmaku.ijk.media.player.IMediaPlayer;
 
 /**
+ * 代理缓存管理器
  * Created by guoshuyu on 2018/5/18.
  */
 

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/player/IJKPlayerManager.java
Patch:
@@ -31,7 +31,9 @@
 
 public class IJKPlayerManager implements IPlayerManager {
 
-    //log level
+    /**
+     * log level
+     */
     private static int logLevel = IjkMediaPlayer.IJK_LOG_DEFAULT;
 
     private static IjkLibLoader ijkLibLoader;

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/player/SystemPlayerManager.java
Patch:
@@ -44,7 +44,7 @@ public void initVideoPlayer(Context context, Message msg, List<VideoOptionModel>
             if (gsyModel.isCache() && cacheManager != null) {
                 cacheManager.doCacheLogic(context, mediaPlayer, gsyModel.getUrl(), gsyModel.getMapHeadData(), gsyModel.getCachePath());
             } else {
-                mediaPlayer.setDataSource(context, Uri.parse(gsyModel.getUrl()), ((GSYModel) msg.obj).getMapHeadData());
+                mediaPlayer.setDataSource(context, Uri.parse(gsyModel.getUrl()), gsyModel.getMapHeadData());
             }
             mediaPlayer.setLooping(gsyModel.isLooping());
             if (gsyModel.getSpeed() != 1 && gsyModel.getSpeed() > 0) {

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYVideoView.java
Patch:
@@ -582,6 +582,7 @@ public void onAutoCompletion() {
         setStateAndUi(CURRENT_STATE_AUTO_COMPLETE);
 
         mSaveChangeViewTIme = 0;
+        mCurrentPosition = 0;
 
         if (mTextureViewContainer.getChildCount() > 0) {
             mTextureViewContainer.removeAllViews();
@@ -606,6 +607,7 @@ public void onCompletion() {
         setStateAndUi(CURRENT_STATE_NORMAL);
 
         mSaveChangeViewTIme = 0;
+        mCurrentPosition = 0;
 
         if (mTextureViewContainer.getChildCount() > 0) {
             mTextureViewContainer.removeAllViews();

File: app/src/main/java/com/example/gsyvideoplayer/ScrollingActivity.java
Patch:
@@ -39,6 +39,7 @@ public class ScrollingActivity extends AppCompatActivity {
     private AppBarLayout appBar;
     private FloatingActionButton fab;
     private CoordinatorLayout root;
+
     private CollapsingToolbarLayout toolBarLayout;
 
     private AppBarStateChangeListener.State curState;
@@ -143,6 +144,7 @@ public void onClick(View v) {
             }
         });
 
+        detailPlayer.setLinkScroll(true);
     }
 
     @Override

File: app/src/main/java/com/example/gsyvideoplayer/DetailPlayer.java
Patch:
@@ -49,6 +49,7 @@ protected void onCreate(Bundle savedInstanceState) {
         ButterKnife.bind(this);
 
         //String url = "android.resource://" + getPackageName() + "/" + R.raw.test;
+        //注意，用ijk模式播放raw视频，这个必须打开
         //GSYVideoManager.instance().enableRawPlay(getApplicationContext());
 
         //断网自动重新链接，url前接上ijkhttphook:

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYVideoControlView.java
Patch:
@@ -795,7 +795,7 @@ protected void clickStartIcon() {
             return;
         }
         if (mCurrentState == CURRENT_STATE_NORMAL || mCurrentState == CURRENT_STATE_ERROR) {
-            if (!mUrl.startsWith("file") && !CommonUtil.isWifiConnected(getContext())
+            if (!mUrl.startsWith("file") && !mUrl.startsWith("android.resource") && !CommonUtil.isWifiConnected(getContext())
                     && mNeedShowWifiTip) {
                 showWifiDialog();
                 return;

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/player/IJKPlayerManager.java
Patch:
@@ -71,8 +71,9 @@ public boolean onNativeInvoke(int i, Bundle bundle) {
                 if(uri.getScheme().equals(ContentResolver.SCHEME_ANDROID_RESOURCE)){
                     RawDataSourceProvider rawDataSourceProvider = RawDataSourceProvider.create(context, uri);
                     mediaPlayer.setDataSource(rawDataSourceProvider);
+                } else {
+                    mediaPlayer.setDataSource(url, ((GSYModel) msg.obj).getMapHeadData());
                 }
-
             } else {
                 mediaPlayer.setDataSource(url, ((GSYModel) msg.obj).getMapHeadData());
             }

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/render/view/GSYTextureView.java
Patch:
@@ -75,7 +75,7 @@ public void onSurfaceTextureSizeChanged(SurfaceTexture surface, int width, int h
     public boolean onSurfaceTextureDestroyed(SurfaceTexture surface) {
         //清空释放
         if (mIGSYSurfaceListener != null) {
-            mIGSYSurfaceListener.onSurfaceAvailable(mSurface);
+            mIGSYSurfaceListener.onSurfaceDestroyed(mSurface);
         }
         return true;
     }

File: app/src/main/java/com/example/gsyvideoplayer/ListVideoActivity.java
Patch:
@@ -57,6 +57,9 @@ public void onScroll(AbsListView view, int firstVisibleItem, int visibleItemCoun
                     //对应的播放列表TAG
                     if (GSYVideoManager.instance().getPlayTag().equals(ListNormalAdapter.TAG)
                             && (position < firstVisibleItem || position > lastVisibleItem)) {
+                        if(listNormalAdapter.isFull()) {
+                            return;
+                        }
                         //如果滑出去了上面和下面就是否，和今日头条一样
                         GSYVideoManager.releaseAllVideos();
                         listNormalAdapter.notifyDataSetChanged();

File: app/src/main/java/com/example/gsyvideoplayer/DetailPlayer.java
Patch:
@@ -54,8 +54,9 @@ protected void onCreate(Bundle savedInstanceState) {
         //String url = "http://7xjmzj.com1.z0.glb.clouddn.com/20171026175005_JObCxCE2.mp4";
 
         //String url =  "http://video.7k.cn/app_video/20171202/6c8cf3ea/v.m3u8.mp4";
-        //String url =  "http://devimages.apple.com.edgekey.net/streaming/examples/bipbop_4x3/bipbop_4x3_variant.m3u8";
-        String url =  " http://1253492636.vod2.myqcloud.com/2e5fc148vodgzp1253492636/d08af82d4564972819086152830/plHZZoSkje0A.mp4";
+        String url =  "http://devimages.apple.com.edgekey.net/streaming/examples/bipbop_4x3/bipbop_4x3_variant.m3u8";
+        //String url =  "https://cdn61.ytbbs.tv/cn/tv/55550/55550-1/play.m3u8?md5=v4sI4lWlo4XojzeAjgBGaQ&expires=1521204012&token=55550";
+        //String url =  " http://1253492636.vod2.myqcloud.com/2e5fc148vodgzp1253492636/d08af82d4564972819086152830/plHZZoSkje0A.mp4";
 
         //String url = "rtsp://ajj:12345678@218.21.217.122:65523/h264/ch40/sub/av_stream";
         //String url = "rtsp://ajj:ajj12345678@218.21.217.122:65522/h264/ch15/sub/av_stream";//String url =  "rtsp://cloud.easydarwin.org:554/stream0.sdp";

File: app/src/main/java/com/example/gsyvideoplayer/DetailControlActivity.java
Patch:
@@ -76,6 +76,7 @@ public class DetailControlActivity extends GSYBaseActivityDetail<StandardGSYVide
     View loadingView;
 
     private String url = "http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4";
+    //private String url = "http://livecdn1.news.cn/Live_MajorEvent01Phone/manifest.m3u8";
     //private String url = "https://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/8908d124aa839d0d3fa9593855ef5957.m3u8";
     //private String url2 = "http://ruigongkao.oss-cn-shenzhen.aliyuncs.com/transcode/video/source/video/3aca1a0db8db9418dcbc765848c8903e.m3u8";
 
@@ -279,6 +280,7 @@ private void stopGif() {
 
     /**
      * 视频截图
+     * 这里没有做读写本地sd卡的权限处理，记得实际使用要加上
      */
     private void shotImage(final View v) {
         //获取截图

File: app/src/main/java/com/example/gsyvideoplayer/GSYApplication.java
Patch:
@@ -40,5 +40,7 @@ public void onCreate() {
         //GSYVideoType.setRenderType(GSYVideoType.GLSURFACE);
 
         //GSYVideoManager.instance().setLogLevel(IjkMediaPlayer.IJK_LOG_SILENT);
+
+        //GSYVideoType.setShowType(GSYVideoType.SCREEN_MATCH_FULL);
     }
 }

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/render/view/GSYSurfaceView.java
Patch:
@@ -91,12 +91,12 @@ public void setIGSYSurfaceListener(IGSYSurfaceListener surfaceListener) {
 
     @Override
     public int getSizeH() {
-        return measureHelper.getMeasuredHeight();
+        return getHeight();
     }
 
     @Override
     public int getSizeW() {
-        return measureHelper.getMeasuredWidth();
+        return getWidth();
     }
 
     @Override

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/render/view/GSYTextureView.java
Patch:
@@ -101,12 +101,12 @@ public void setIGSYSurfaceListener(IGSYSurfaceListener surfaceListener) {
 
     @Override
     public int getSizeH() {
-        return measureHelper.getMeasuredHeight();
+        return getHeight();
     }
 
     @Override
     public int getSizeW() {
-        return measureHelper.getMeasuredWidth();
+        return getWidth();
     }
 
     /**

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/render/view/GSYVideoGLView.java
Patch:
@@ -124,12 +124,12 @@ public void onSurfaceAvailable(Surface surface) {
 
     @Override
     public int getSizeH() {
-        return measureHelper.getMeasuredHeight();
+        return getHeight();
     }
 
     @Override
     public int getSizeW() {
-        return measureHelper.getMeasuredWidth();
+        return getWidth();
     }
 
     @Override

File: app/src/main/java/com/example/gsyvideoplayer/DanmkuVideoActivity.java
Patch:
@@ -54,7 +54,8 @@ protected void onCreate(Bundle savedInstanceState) {
         danmakuVideoPlayer.setShrinkImageRes(R.drawable.custom_shrink);
         danmakuVideoPlayer.setEnlargeImageRes(R.drawable.custom_enlarge);
 
-        String url = "https://res.exexm.com/cw_145225549855002";
+        //String url = "https://res.exexm.com/cw_145225549855002";
+        String url = "http://9890.vod.myqcloud.com/9890_4e292f9a3dd011e6b4078980237cc3d3.f20.mp4";
         //String url = "https://res.exexm.com/cw_145225549855002";
         danmakuVideoPlayer.setUp(url, true, null, "测试视频");
 

File: app/src/main/java/com/example/gsyvideoplayer/DanmkuVideoActivity.java
Patch:
@@ -175,7 +175,7 @@ public void onConfigurationChanged(Configuration newConfig) {
         super.onConfigurationChanged(newConfig);
         //如果旋转了就全屏
         if (isPlay && !isPause) {
-            danmakuVideoPlayer.onConfigurationChanged(this, newConfig, orientationUtils);
+            danmakuVideoPlayer.onConfigurationChanged(this, newConfig, orientationUtils, true, true);
         }
     }
 

File: app/src/main/java/com/example/gsyvideoplayer/DetailMoreTypeActivity.java
Patch:
@@ -205,7 +205,7 @@ public void onConfigurationChanged(Configuration newConfig) {
         super.onConfigurationChanged(newConfig);
         //如果旋转了就全屏
         if (isPlay && !isPause) {
-            detailPlayer.onConfigurationChanged(this, newConfig, orientationUtils);
+            detailPlayer.onConfigurationChanged(this, newConfig, orientationUtils, true, true);
         }
         //竖屏全屏
         orientationUtils.setEnable(false);

File: app/src/main/java/com/example/gsyvideoplayer/DetailPlayer.java
Patch:
@@ -226,7 +226,7 @@ public void onConfigurationChanged(Configuration newConfig) {
         super.onConfigurationChanged(newConfig);
         //如果旋转了就全屏
         if (isPlay && !isPause) {
-            detailPlayer.onConfigurationChanged(this, newConfig, orientationUtils);
+            detailPlayer.onConfigurationChanged(this, newConfig, orientationUtils, true, true);
         }
     }
 

File: app/src/main/java/com/example/gsyvideoplayer/InputUrlDetailActivity.java
Patch:
@@ -173,7 +173,7 @@ public void onConfigurationChanged(Configuration newConfig) {
         super.onConfigurationChanged(newConfig);
         //如果旋转了就全屏
         if (isPlay && !isPause) {
-            detailPlayer.onConfigurationChanged(this, newConfig, orientationUtils);
+            detailPlayer.onConfigurationChanged(this, newConfig, orientationUtils, true, true);
         }
     }
 

File: app/src/main/java/com/example/gsyvideoplayer/ScrollingActivity.java
Patch:
@@ -190,7 +190,7 @@ public void onConfigurationChanged(Configuration newConfig) {
         super.onConfigurationChanged(newConfig);
         //如果旋转了就全屏
         if (isPlay && !isPause) {
-            detailPlayer.onConfigurationChanged(this, newConfig, orientationUtils);
+            detailPlayer.onConfigurationChanged(this, newConfig, orientationUtils, true, true);
         }
     }
 

File: app/src/main/java/com/example/gsyvideoplayer/adapter/ListNormalAdapter.java
Patch:
@@ -283,7 +283,7 @@ public void onPrepared() {
     public void onConfigurationChanged(Activity activity, Configuration newConfig) {
         //如果旋转了就全屏
         if (isPlay && curPlayer != null && orientationUtils != null) {
-            curPlayer.onConfigurationChanged(activity, newConfig, orientationUtils);
+            curPlayer.onConfigurationChanged(activity, newConfig, orientationUtils, false, true);
         }
     }
 

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/GSYBaseADActivityDetail.java
Patch:
@@ -142,7 +142,7 @@ public void onConfigurationChanged(Configuration newConfig) {
         if (!isPause && getGSYADVideoPlayer().getVisibility() == View.VISIBLE) {
             if (isADStarted()) {
                 isPlay = false;
-                getGSYADVideoPlayer().getCurrentPlayer().onConfigurationChanged(this, newConfig, mADOrientationUtils);
+                getGSYADVideoPlayer().getCurrentPlayer().onConfigurationChanged(this, newConfig, mADOrientationUtils, hideActionBarWhenFull(), hideStatusBarWhenFull());
             }
         }
         super.onConfigurationChanged(newConfig);

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/GSYBaseActivityDetail.java
Patch:
@@ -108,7 +108,7 @@ public void onConfigurationChanged(Configuration newConfig) {
         super.onConfigurationChanged(newConfig);
         //如果旋转了就全屏
         if (isPlay && !isPause) {
-            getGSYVideoPlayer().onConfigurationChanged(this, newConfig, orientationUtils);
+            getGSYVideoPlayer().onConfigurationChanged(this, newConfig, orientationUtils, hideActionBarWhenFull(), hideStatusBarWhenFull());
         }
     }
 

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/GSYBaseADActivityDetail.java
Patch:
@@ -63,7 +63,7 @@ public void onStartPrepared(String url, Object... objects) {
                     @Override
                     public void onAutoComplete(String url, Object... objects) {
                         //广告结束，释放
-                        getGSYADVideoPlayer().release();
+                        getGSYADVideoPlayer().getCurrentPlayer().release();
                         getGSYADVideoPlayer().onVideoReset();
                         getGSYADVideoPlayer().setVisibility(View.GONE);
                         //开始播放原视频，根据是否处于全屏状态判断

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYBaseVideoPlayer.java
Patch:
@@ -358,6 +358,9 @@ protected void clearFullscreenLayout() {
             }
         }
 
+        if (!mShowFullAnimation) {
+            delay = 0;
+        }
 
         final ViewGroup vp = getViewGroup();
         final View oldF = vp.findViewById(getFullId());

File: app/src/main/java/com/example/gsyvideoplayer/DetailPlayer.java
Patch:
@@ -53,7 +53,8 @@ protected void onCreate(Bundle savedInstanceState) {
 
         //String url = "http://7xjmzj.com1.z0.glb.clouddn.com/20171026175005_JObCxCE2.mp4";
 
-        String url =  "http://video.7k.cn/app_video/20171202/6c8cf3ea/v.m3u8.mp4";
+        //String url =  "http://video.7k.cn/app_video/20171202/6c8cf3ea/v.m3u8.mp4";
+        String url =  "http://devimages.apple.com.edgekey.net/streaming/examples/bipbop_4x3/bipbop_4x3_variant.m3u8";
         //String url =  "rtsp://cloud.easydarwin.org:554/stream0.sdp";
         //String url =  "http://s.swao.cn/o_1c4gm8o1nniu1had13bk1t0l1rq64m.mov";
         //String url =  "http://api.ciguang.tv/avideo/play?num=02-041-0491&type=flv&v=1&client=android";

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/GSYADVideoPlayer.java
Patch:
@@ -237,7 +237,7 @@ protected void changeAdUIState() {
     }
 
     /**
-     * 移除没用的
+     * 移除广告播放的全屏
      */
     public void removeFullWindowViewOnly() {
         ViewGroup vp = (ViewGroup) (CommonUtil.scanForActivity(getContext())).findViewById(Window.ID_ANDROID_CONTENT);

File: app/src/main/java/com/example/gsyvideoplayer/video/manager/CustomManager.java
Patch:
@@ -6,6 +6,7 @@
 import android.view.ViewGroup;
 import android.view.Window;
 
+import com.example.gsyvideoplayer.R;
 import com.shuyu.gsyvideoplayer.GSYVideoBaseManager;
 import com.shuyu.gsyvideoplayer.utils.CommonUtil;
 
@@ -23,9 +24,9 @@
 
 public class CustomManager extends GSYVideoBaseManager {
 
-    public static final int SMALL_ID = 86598;
+    public static final int SMALL_ID = R.id.custom_small_id;
 
-    public static final int FULLSCREEN_ID = 86597;
+    public static final int FULLSCREEN_ID = R.id.custom_full_id;
 
     public static String TAG = "GSYVideoManager";
 

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/GSYVideoBaseManager.java
Patch:
@@ -8,6 +8,7 @@
 import android.os.Message;
 import android.text.TextUtils;
 import android.view.Surface;
+
 import com.danikula.videocache.CacheListener;
 import com.danikula.videocache.HttpProxyCacheServer;
 import com.danikula.videocache.file.Md5FileNameGenerator;
@@ -34,6 +35,7 @@
 
 import tv.danmaku.ijk.media.player.IMediaPlayer;
 import tv.danmaku.ijk.media.player.IjkLibLoader;
+
 /**
  * 基类管理器
  * Created by guoshuyu on 2018/1/25.

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/GSYVideoManager.java
Patch:
@@ -25,9 +25,9 @@
 
 public class GSYVideoManager extends GSYVideoBaseManager {
 
-    public static final int SMALL_ID = 85598;
+    public static final int SMALL_ID = R.id.small_id;
 
-    public static final int FULLSCREEN_ID = 85597;
+    public static final int FULLSCREEN_ID = R.id.full_id;
 
     public static String TAG = "GSYVideoManager";
 

File: app/src/main/java/com/example/gsyvideoplayer/DetailADPlayer2.java
Patch:
@@ -58,7 +58,6 @@ public void onProgress(int progress, int secProgress, int currentPosition, int d
                 if (currentSecond == 5 && currentSecond != preSecond) {
                     detailPlayer.getCurrentPlayer().onVideoPause();
                     getGSYADVideoOptionBuilder().setUrl(urlAd2).build(adPlayer);
-                    adPlayer.setVisibility(View.VISIBLE);
                     startAdPlay();
                 }
                 preSecond = currentSecond;

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/ListGSYVideoPlayer.java
Patch:
@@ -162,7 +162,7 @@ public void onAutoCompletion() {
      */
     @Override
     protected void prepareVideo() {
-        startPrepare();
+        super.prepareVideo();
         if (mHadPlay && mPlayPosition < (mUriList.size())) {
             setViewShowState(mLoadingProgressBar, VISIBLE);
             if (mLoadingProgressBar instanceof ENDownloadView) {
@@ -175,7 +175,6 @@ protected void prepareVideo() {
     @Override
     public void onPrepared() {
         super.onPrepared();
-        addTextureView();
     }
 
     @Override

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYVideoView.java
Patch:
@@ -318,7 +318,6 @@ protected void startButtonLogic() {
      */
     protected void prepareVideo() {
         startPrepare();
-        addTextureView();
     }
 
     protected void startPrepare() {
@@ -779,6 +778,8 @@ public void startAfterPrepared() {
             e.printStackTrace();
         }
 
+        addTextureView();
+
         createNetWorkState();
 
         listenerNetWorkState();

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYBaseVideoPlayer.java
Patch:
@@ -490,6 +490,7 @@ public GSYBaseVideoPlayer startWindowFullscreen(final Context context) {
     @SuppressWarnings("ResourceType, unchecked")
     public GSYBaseVideoPlayer startWindowFullscreen(final Context context, final boolean actionBar, final boolean statusBar) {
 
+
         mSystemUiVisibility = ((Activity) context).getWindow().getDecorView().getSystemUiVisibility();
 
         hideSupportActionBar(context, actionBar, statusBar);

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYVideoControlView.java
Patch:
@@ -880,7 +880,7 @@ protected void setTextAndProgress(int secProgress) {
 
     protected void setProgressAndTime(int progress, int secProgress, int currentTime, int totalTime) {
 
-        if (mGSYVideoProgressListener != null) {
+        if (mGSYVideoProgressListener != null && mCurrentState == CURRENT_STATE_PLAYING) {
             mGSYVideoProgressListener.onProgress(progress, secProgress, currentTime, totalTime);
         }
 

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/GSYBaseADActivityDetail.java
Patch:
@@ -99,8 +99,7 @@ public void showFull() {
             //直接横屏
             orientationUtils.resolveByClick();
         }
-        getGSYVideoPlayer().startWindowFullscreen(this);
-
+        getGSYVideoPlayer().startWindowFullscreen(this, hideActionBarWhenFull(), hideStatusBarWhenFull());
     }
 
     @Override

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/GSYSampleADVideoPlayer.java
Patch:
@@ -20,7 +20,8 @@
 import java.util.Map;
 
 /**
- * 广告播放
+ * 只支持每个片头广告播放的类
+ * 其实就是根据实体，判断播放列表中哪个是广告，哪个不是，从而处理不同的UI显示效果
  * Created by guoshuyu on 2018/1/26.
  */
 

File: app/src/main/java/com/example/gsyvideoplayer/DetailADPlayer2.java
Patch:
@@ -12,7 +12,7 @@
 import com.shuyu.gsyvideoplayer.video.base.GSYVideoPlayer;
 
 
-public class DetailADPlayer2 extends GSYBaseADActivityDetail<NormalGSYVideoPlayer> {
+public class DetailADPlayer2 extends GSYBaseADActivityDetail<NormalGSYVideoPlayer, GSYADVideoPlayer> {
 
     private NormalGSYVideoPlayer detailPlayer;
 

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/GSYBaseADActivityDetail.java
Patch:
@@ -20,7 +20,7 @@
  * 详情AD模式播放页面基础类
  * Created by guoshuyu on 2017/9/14.
  */
-public abstract class GSYBaseADActivityDetail<T extends GSYBaseVideoPlayer> extends GSYBaseActivityDetail<T> {
+public abstract class GSYBaseADActivityDetail<T extends GSYBaseVideoPlayer, R extends GSYADVideoPlayer> extends GSYBaseActivityDetail<T> {
 
     protected OrientationUtils mADOrientationUtils;
 
@@ -216,7 +216,7 @@ public void showADFull() {
         getGSYADVideoPlayer().startWindowFullscreen(GSYBaseADActivityDetail.this, hideActionBarWhenFull(), hideStatusBarWhenFull());
     }
 
-    public abstract GSYADVideoPlayer getGSYADVideoPlayer();
+    public abstract R getGSYADVideoPlayer();
 
     /**
      * 配置AD播放器

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/listener/VideoAllCallBack.java
Patch:
@@ -6,6 +6,9 @@
  */
 public interface VideoAllCallBack {
 
+    //开始加载，objects[0]是title，object[1]是当前所处播放器（全屏或非全屏）
+    void onStartPrepared(String url, Object... objects);
+
     //加载成功，objects[0]是title，object[1]是当前所处播放器（全屏或非全屏）
     void onPrepared(String url, Object... objects);
 

File: app/src/main/java/com/example/gsyvideoplayer/DanmkuVideoActivity.java
Patch:
@@ -90,7 +90,7 @@ public void onClick(View v) {
             }
         });
 
-        danmakuVideoPlayer.setStandardVideoAllCallBack(new GSYSampleCallBack() {
+        danmakuVideoPlayer.setVideoAllCallBack(new GSYSampleCallBack() {
             @Override
             public void onPrepared(String url, Object... objects) {
                 super.onPrepared(url, objects);

File: app/src/main/java/com/example/gsyvideoplayer/DetailADPlayer.java
Patch:
@@ -70,7 +70,7 @@ protected void onCreate(Bundle savedInstanceState) {
         detailPlayer.setShowFullAnimation(false);
         detailPlayer.setNeedLockFull(true);
 
-        detailPlayer.setStandardVideoAllCallBack(this);
+        detailPlayer.setVideoAllCallBack(this);
 
         detailPlayer.setLockClickListener(new LockClickListener() {
             @Override

File: app/src/main/java/com/example/gsyvideoplayer/DetailListPlayer.java
Patch:
@@ -71,7 +71,7 @@ protected void onCreate(Bundle savedInstanceState) {
         detailPlayer.setShowFullAnimation(false);
         detailPlayer.setNeedLockFull(true);
 
-        detailPlayer.setStandardVideoAllCallBack(this);
+        detailPlayer.setVideoAllCallBack(this);
 
         detailPlayer.setLockClickListener(new LockClickListener() {
             @Override

File: app/src/main/java/com/example/gsyvideoplayer/DetailMoreTypeActivity.java
Patch:
@@ -112,7 +112,7 @@ public void onClick(View v) {
             }
         });
 
-        detailPlayer.setStandardVideoAllCallBack(new GSYSampleCallBack() {
+        detailPlayer.setVideoAllCallBack(new GSYSampleCallBack() {
             @Override
             public void onPrepared(String url, Object... objects) {
                 super.onPrepared(url, objects);

File: app/src/main/java/com/example/gsyvideoplayer/DetailPlayer.java
Patch:
@@ -112,7 +112,7 @@ protected void onCreate(Bundle savedInstanceState) {
                 .setUrl(url)
                 .setCacheWithPlay(false)
                 .setVideoTitle("测试视频")
-                .setStandardVideoAllCallBack(new GSYSampleCallBack() {
+                .setVideoAllCallBack(new GSYSampleCallBack() {
                     @Override
                     public void onPrepared(String url, Object... objects) {
                         Debuger.printfError("***** onPrepared **** " + objects[0]);

File: app/src/main/java/com/example/gsyvideoplayer/InputUrlDetailActivity.java
Patch:
@@ -80,7 +80,7 @@ protected void onCreate(Bundle savedInstanceState) {
                 .setUrl(url)
                 .setCacheWithPlay(cache)
                 .setVideoTitle("测试视频")
-                .setStandardVideoAllCallBack(new GSYSampleCallBack() {
+                .setVideoAllCallBack(new GSYSampleCallBack() {
                     @Override
                     public void onPrepared(String url, Object... objects) {
                         super.onPrepared(url, objects);

File: app/src/main/java/com/example/gsyvideoplayer/PlayActivity.java
Patch:
@@ -150,7 +150,7 @@ public void onBackPressed() {
             return;
         }
         //释放所有
-        videoPlayer.setStandardVideoAllCallBack(null);
+        videoPlayer.setVideoAllCallBack(null);
         GSYVideoManager.releaseAllVideos();
         if (isTransition && Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
             super.onBackPressed();

File: app/src/main/java/com/example/gsyvideoplayer/PlayEmptyControlActivity.java
Patch:
@@ -75,7 +75,7 @@ protected void onDestroy() {
     @Override
     public void onBackPressed() {
         //释放所有
-        videoPlayer.setStandardVideoAllCallBack(null);
+        videoPlayer.setVideoAllCallBack(null);
         GSYVideoManager.releaseAllVideos();
         if (isTransition && Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
             super.onBackPressed();

File: app/src/main/java/com/example/gsyvideoplayer/PlayPickActivity.java
Patch:
@@ -133,7 +133,7 @@ public void onBackPressed() {
             return;
         }
         //释放所有
-        videoPlayer.setStandardVideoAllCallBack(null);
+        videoPlayer.setVideoAllCallBack(null);
         GSYVideoManager.releaseAllVideos();
         if (isTransition && Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
             super.onBackPressed();

File: app/src/main/java/com/example/gsyvideoplayer/ScrollingActivity.java
Patch:
@@ -75,7 +75,7 @@ protected void onCreate(Bundle savedInstanceState) {
                 .setUrl(url)
                 .setCacheWithPlay(false)
                 .setVideoTitle("测试视频")
-                .setStandardVideoAllCallBack(new GSYSampleCallBack() {
+                .setVideoAllCallBack(new GSYSampleCallBack() {
 
                     @Override
                     public void onPrepared(String url, Object... objects) {

File: app/src/main/java/com/example/gsyvideoplayer/adapter/ListMultiNormalAdapter.java
Patch:
@@ -107,7 +107,7 @@ public void onClick(View v) {
             holder.gsyVideoPlayer.loadCoverImage(url, R.mipmap.xxx2);
         }
 
-        holder.gsyVideoPlayer.setStandardVideoAllCallBack(new GSYSampleCallBack() {
+        holder.gsyVideoPlayer.setVideoAllCallBack(new GSYSampleCallBack() {
 
 
             @Override

File: app/src/main/java/com/example/gsyvideoplayer/adapter/ListNormalAdapter.java
Patch:
@@ -157,7 +157,7 @@ public void onClick(View v) {
 
         holder.gsyVideoPlayer.setPlayPosition(position);
 
-        holder.gsyVideoPlayer.setStandardVideoAllCallBack(new GSYSampleCallBack() {
+        holder.gsyVideoPlayer.setVideoAllCallBack(new GSYSampleCallBack() {
             @Override
             public void onClickStartIcon(String url, Object... objects) {
                 super.onClickStartIcon(url, objects);

File: app/src/main/java/com/example/gsyvideoplayer/holder/RecyclerItemNormalHolder.java
Patch:
@@ -77,7 +77,7 @@ public void onBind(final int position, VideoModel videoModel) {
                 .setShowFullAnimation(true)
                 .setNeedLockFull(true)
                 .setPlayPosition(position)
-                .setStandardVideoAllCallBack(new GSYSampleCallBack() {
+                .setVideoAllCallBack(new GSYSampleCallBack() {
                     @Override
                     public void onPrepared(String url, Object... objects) {
                         super.onPrepared(url, objects);

File: app/src/main/java/com/example/gsyvideoplayer/listener/SampleListener.java
Patch:
@@ -1,12 +1,12 @@
 package com.example.gsyvideoplayer.listener;
 
-import com.shuyu.gsyvideoplayer.listener.StandardVideoAllCallBack;
+import com.shuyu.gsyvideoplayer.listener.VideoAllCallBack;
 
 /**
  * Created by shuyu on 2016/11/23.
  */
 
-public class SampleListener implements StandardVideoAllCallBack {
+public class SampleListener implements VideoAllCallBack {
 
     //加载成功，objects[0]是title，object[1]是当前所处播放器（全屏或非全屏）
     @Override

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/GSYBaseActivityDetail.java
Patch:
@@ -6,15 +6,15 @@
 import android.view.View;
 
 import com.shuyu.gsyvideoplayer.builder.GSYVideoOptionBuilder;
-import com.shuyu.gsyvideoplayer.listener.StandardVideoAllCallBack;
+import com.shuyu.gsyvideoplayer.listener.VideoAllCallBack;
 import com.shuyu.gsyvideoplayer.utils.OrientationUtils;
 import com.shuyu.gsyvideoplayer.video.base.GSYBaseVideoPlayer;
 
 /**
  * 详情模式播放页面基础类
  * Created by guoshuyu on 2017/9/14.
  */
-public abstract class GSYBaseActivityDetail<T extends GSYBaseVideoPlayer> extends AppCompatActivity implements StandardVideoAllCallBack {
+public abstract class GSYBaseActivityDetail<T extends GSYBaseVideoPlayer> extends AppCompatActivity implements VideoAllCallBack {
 
     protected boolean isPlay;
 

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/listener/GSYSampleCallBack.java
Patch:
@@ -5,7 +5,7 @@
  * Created by shuyu on 2016/11/23.
  */
 
-public class GSYSampleCallBack implements StandardVideoAllCallBack {
+public class GSYSampleCallBack implements VideoAllCallBack {
 
     //加载成功，objects[0]是title，object[1]是当前所处播放器（全屏或非全屏）
     @Override

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/GSYADVideoPlayer.java
Patch:
@@ -51,7 +51,9 @@ protected void init(Context context) {
             mJumpAd.setOnClickListener(new OnClickListener() {
                 @Override
                 public void onClick(View v) {
-                    onAutoCompletion();
+                    if (getGSYVideoManager().listener() != null) {
+                        getGSYVideoManager().listener().onAutoCompletion();
+                    }
                 }
             });
         }
@@ -89,7 +91,6 @@ protected HttpProxyCacheServer getProxy(Context context, File file) {
     }
 
 
-
     @Override
     public void onPrepared() {
         super.onPrepared();

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYBaseVideoPlayer.java
Patch:
@@ -36,7 +36,7 @@
 
 public abstract class GSYBaseVideoPlayer extends GSYVideoControlView {
 
-    public static final int SMALL_ID = 84778;
+    public static final int SMALL_ID = 85598;
 
     public static final int FULLSCREEN_ID = 85597;
 

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYVideoPlayer.java
Patch:
@@ -15,7 +15,7 @@
  * Created by shuyu on 2016/11/11.
  */
 
-public abstract class GSYVideoPlayer extends GSYBaseVideoPlayer{
+public abstract class GSYVideoPlayer extends GSYBaseVideoPlayer {
 
     public GSYVideoPlayer(Context context, Boolean fullFlag) {
         super(context, fullFlag);
@@ -58,6 +58,6 @@ protected void releaseVideos() {
 
     @Override
     protected HttpProxyCacheServer getProxy(Context context, File file) {
-        return  GSYVideoManager.getProxy(context, file);
+        return GSYVideoManager.getProxy(context, file);
     }
 }
\ No newline at end of file

File: app/src/main/java/com/example/gsyvideoplayer/adapter/ListNormalAdapter.java
Patch:
@@ -195,6 +195,7 @@ public void onQuitFullscreen(String url, Object... objects) {
             public void onEnterFullscreen(String url, Object... objects) {
                 super.onEnterFullscreen(url, objects);
                 GSYVideoManager.instance().setNeedMute(false);
+                holder.gsyVideoPlayer.getCurrentPlayer().getTitleTextView().setText((String)objects[0]);
             }
 
             @Override

File: app/src/main/java/com/example/gsyvideoplayer/holder/RecyclerItemNormalHolder.java
Patch:
@@ -100,6 +100,7 @@ public void onQuitFullscreen(String url, Object... objects) {
                     public void onEnterFullscreen(String url, Object... objects) {
                         super.onEnterFullscreen(url, objects);
                         GSYVideoManager.instance().setNeedMute(false);
+                        gsyVideoPlayer.getCurrentPlayer().getTitleTextView().setText((String)objects[0]);
                     }
                 }).build(gsyVideoPlayer);
 

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/render/glrender/GSYVideoGLViewBaseRender.java
Patch:
@@ -109,7 +109,7 @@ protected void checkGlError(String op) {
         int error;
         while ((error = GLES20.glGetError()) != GLES20.GL_NO_ERROR) {
             Debuger.printfError(op + ": glError " + error);
-            throw new RuntimeException(op + ": glError " + error);
+            //throw new RuntimeException(op + ": glError " + error);
         }
     }
 

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/video/base/GSYVideoControlView.java
Patch:
@@ -1055,7 +1055,7 @@ public ImageView getBackButton() {
 
 
     public int getEnlargeImageRes() {
-        if (mShrinkImageRes == -1) {
+        if (mEnlargeImageRes == -1) {
             return R.drawable.video_enlarge;
         }
         return mEnlargeImageRes;

File: gsyVideoPlayer-java/src/main/java/com/shuyu/gsyvideoplayer/GSYVideoPlayer.java
Patch:
@@ -1205,6 +1205,7 @@ protected void loopSetProgressAndTime() {
      * 页面销毁了记得调用是否所有的video
      */
     public static void releaseAllVideos() {
+        CLICK_QUIT_FULLSCREEN_TIME = 0;
         if (IF_RELEASE_WHEN_ON_PAUSE) {
             if (GSYVideoManager.instance().listener() != null) {
                 GSYVideoManager.instance().listener().onCompletion();
@@ -1219,6 +1220,7 @@ public static void releaseAllVideos() {
      * if I am playing release me
      */
     public void release() {
+        CLICK_QUIT_FULLSCREEN_TIME = 0;
         if (isCurrentMediaListener() &&
                 (System.currentTimeMillis() - CLICK_QUIT_FULLSCREEN_TIME) > FULL_SCREEN_NORMAL_DELAY) {
             releaseAllVideos();

File: gsyVideoPlayer/src/main/java/com/shuyu/gsyvideoplayer/video/GSYBaseVideoPlayer.java
Patch:
@@ -735,7 +735,7 @@ public void setSpeed(float speed) {
         this.mSpeed = speed;
         if (GSYVideoManager.instance().getMediaPlayer() != null
                 && GSYVideoManager.instance().getMediaPlayer() instanceof IjkMediaPlayer) {
-            if (speed != 1 && speed > 0) {
+            if (speed > 0) {
                 ((IjkMediaPlayer) GSYVideoManager.instance().getMediaPlayer()).setSpeed(speed);
             }
         }

File: app/src/main/java/com/example/gsyvideoplayer/DetailPlayer.java
Patch:
@@ -55,6 +55,7 @@ protected void onCreate(Bundle savedInstanceState) {
         ButterKnife.bind(this);
 
         String url = "http://baobab.wdjcdn.com/14564977406580.mp4";
+        //String url = "http://hls.ciguang.tv/hdtv/video.m3u8";
         //String url = "https://res.exexm.com/cw_145225549855002";
         detailPlayer.setUp(url, true, null, "测试视频");
 

File: app/src/main/java/com/example/gsyvideoplayer/RecyclerView2Activity.java
Patch:
@@ -113,7 +113,7 @@ public void onPrepared(String url, Object... objects) {
             public void onQuitSmallWidget(String url, Object... objects) {
                 super.onQuitSmallWidget(url, objects);
                 //大于0说明有播放,//对应的播放列表TAG
-                if (listVideoUtil.getPlayPosition() >= 0 && listVideoUtil.getPlayTAG().equals(ListVideoAdapter.TAG)) {
+                if (listVideoUtil.getPlayPosition() >= 0 && listVideoUtil.getPlayTAG().equals(RecyclerItemViewHolder.TAG)) {
                     //当前播放的位置
                     int position = listVideoUtil.getPlayPosition();
                     //不可视的是时候

File: gsyVideoPlayer/src/main/java/com/shuyu/gsyvideoplayer/GSYVideoPlayer.java
Patch:
@@ -181,7 +181,7 @@ protected void init(Context context) {
         mFullscreenButton.setOnTouchListener(this);
         mScreenWidth = getContext().getResources().getDisplayMetrics().widthPixels;
         mScreenHeight = getContext().getResources().getDisplayMetrics().heightPixels;
-        mAudioManager = (AudioManager) getContext().getSystemService(Context.AUDIO_SERVICE);
+        mAudioManager = (AudioManager) getContext().getApplicationContext().getSystemService(Context.AUDIO_SERVICE);
 
         mSeekEndOffset = CommonUtil.dip2px(getContext(), 50);
     }

File: gsyVideoPlayer/src/main/java/com/shuyu/gsyvideoplayer/GSYVideoPlayer.java
Patch:
@@ -233,15 +233,17 @@ public boolean setUp(String url, boolean cacheWithPlay, File cachePath, Map<Stri
     public boolean setUp(String url, boolean cacheWithPlay, File cachePath, Object... objects) {
         mCache = cacheWithPlay;
         mCachePath = cachePath;
+        mOriginUrl = url;
         if (isCurrentMediaListener() &&
                 (System.currentTimeMillis() - CLICK_QUIT_FULLSCREEN_TIME) < FULL_SCREEN_NORMAL_DELAY)
             return false;
         mCurrentState = CURRENT_STATE_NORMAL;
         if (cacheWithPlay && url.startsWith("http") && !url.contains("127.0.0.1")) {
-            mOriginUrl = url;
             HttpProxyCacheServer proxy = GSYVideoManager.getProxy(getContext().getApplicationContext(), cachePath);
+            //此处转换了url，然后再赋值给mUrl。
             url = proxy.getProxyUrl(url);
             mCacheFile = (!url.startsWith("http"));
+            //注册上缓冲监听
             if (!mCacheFile && GSYVideoManager.instance() != null) {
                 proxy.registerCacheListener(GSYVideoManager.instance(), mOriginUrl);
             }

File: gsyVideoPlayer/src/main/java/com/shuyu/gsyvideoplayer/video/GSYBaseVideoPlayer.java
Patch:
@@ -346,7 +346,7 @@ public void run() {
             gsyVideoPlayer.mCacheFile = mCacheFile;
             gsyVideoPlayer.mFullPauseBitmap = mFullPauseBitmap;
             gsyVideoPlayer.mNeedShowWifiTip = mNeedShowWifiTip;
-            gsyVideoPlayer.setUp(mUrl, mCache, mCachePath, mMapHeadData, mObjects);
+            gsyVideoPlayer.setUp(mOriginUrl, mCache, mCachePath, mMapHeadData, mObjects);
             gsyVideoPlayer.setStateAndUi(mCurrentState);
             gsyVideoPlayer.addTextureView();
 
@@ -515,7 +515,7 @@ public GSYBaseVideoPlayer showSmallVideo(Point size, final boolean actionBar, fi
 
             vp.addView(frameLayout, lpParent);
             gsyVideoPlayer.mHadPlay = mHadPlay;
-            gsyVideoPlayer.setUp(mUrl, mCache, mCachePath, mMapHeadData, mObjects);
+            gsyVideoPlayer.setUp(mOriginUrl, mCache, mCachePath, mMapHeadData, mObjects);
             gsyVideoPlayer.setStateAndUi(mCurrentState);
             gsyVideoPlayer.addTextureView();
             //隐藏掉所有的弹出状态哟

File: gsyVideoPlayer/src/main/java/com/shuyu/gsyvideoplayer/GSYVideoPlayer.java
Patch:
@@ -879,6 +879,9 @@ public void onError(int what, int extra) {
         if (what != 38 && what != -38) {
             setStateAndUi(CURRENT_STATE_ERROR);
             deleteCacheFileWhenError();
+            if (mVideoAllCallBack != null) {
+                mVideoAllCallBack.onPlayError(mUrl, mObjects);
+            }
         }
     }
 

File: gsyVideoPlayer/src/main/java/com/shuyu/gsyvideoplayer/listener/VideoAllCallBack.java
Patch:
@@ -57,4 +57,7 @@ public interface VideoAllCallBack {
     //触摸调整亮度
     void onTouchScreenSeekLight(String url, Object... objects);
 
+    //播放错误
+    void onPlayError(String url, Object... objects);
+
 }

File: app/src/main/java/com/example/gsyvideoplayer/WebDetailActivity.java
Patch:
@@ -133,7 +133,6 @@ public void onClick(View view, boolean lock) {
             @Override
             public void onScrollChange(NestedScrollView v, int scrollX, int scrollY, int oldScrollX, int oldScrollY) {
                 if (!webPlayer.isIfCurrentIsFullscreen() && scrollY >= 0 && isPlay) {
-                    Debuger.printfError("ffffffffffffff " + webPlayer.getHeight());
                     if (scrollY > webPlayer.getHeight()) {
                         //如果是小窗口就不需要处理
                         if (!isSamll) {

File: app/src/main/java/com/example/gsyvideoplayer/DetailPlayer.java
Patch:
@@ -71,7 +71,7 @@ protected void onCreate(Bundle savedInstanceState) {
         detailPlayer.setLockLand(false);
         detailPlayer.setShowFullAnimation(false);
         detailPlayer.setNeedLockFull(true);
-        //detailPlayer.setOpenPreView(true);
+        detailPlayer.setOpenPreView(true);
         detailPlayer.getFullscreenButton().setOnClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View v) {

File: app/src/main/java/com/example/gsyvideoplayer/DetailPlayer.java
Patch:
@@ -70,7 +70,7 @@ protected void onCreate(Bundle savedInstanceState) {
         detailPlayer.setLockLand(false);
         detailPlayer.setShowFullAnimation(false);
         detailPlayer.setNeedLockFull(true);
-        detailPlayer.setOpenPreView(true);
+        //detailPlayer.setOpenPreView(true);
         detailPlayer.getFullscreenButton().setOnClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View v) {

File: gsyVideoPlayer/src/main/java/com/shuyu/gsyvideoplayer/video/StandardGSYVideoPlayer.java
Patch:
@@ -320,7 +320,7 @@ public void onClick(View v) {
     @Override
     public void showWifiDialog() {
         super.showWifiDialog();
-        if (!mUrl.contains("127.0.0.1") && !NetworkUtils.isAvailable(mContext)) {
+        if (!NetworkUtils.isAvailable(mContext)) {
             Toast.makeText(mContext, getResources().getString(R.string.no_net), Toast.LENGTH_LONG).show();
             return;
         }

File: app/src/main/java/com/example/gsyvideoplayer/GSYApplication.java
Patch:
@@ -5,6 +5,7 @@
 import com.shuyu.gsyvideoplayer.GSYVideoManager;
 
 /**
+ * 初始化视频播放
  * Created by shuyu on 2016/11/11.
  */
 

File: app/src/main/java/com/example/gsyvideoplayer/listener/OnTransitionListener.java
Patch:
@@ -5,6 +5,7 @@
 import android.transition.Transition;
 
 /**
+ * 重载了过渡动画的方法
  * Created by shuyu on 2016/8/15.
  */
 

File: app/src/main/java/com/example/gsyvideoplayer/utils/JumpUtils.java
Patch:
@@ -17,6 +17,8 @@
 public class JumpUtils {
 
     /**
+     * 跳转到视频播放
+     *
      * @param activity
      * @param view
      */

File: gsyVideoPlayer/src/main/java/com/shuyu/gsyvideoplayer/GSYVideoManager.java
Patch:
@@ -74,7 +74,8 @@ public static GSYVideoManager instance() {
      */
     public static HttpProxyCacheServer getProxy(Context context) {
         HttpProxyCacheServer proxy = GSYVideoManager.instance().proxy;
-        return proxy == null ? (proxy = GSYVideoManager.instance().newProxy(context)) : proxy;
+        return proxy == null ? (GSYVideoManager.instance().proxy =
+                GSYVideoManager.instance().newProxy(context)) : proxy;
     }
 
     /**
@@ -157,6 +158,7 @@ public void handleMessage(Message msg) {
                         Surface holder = (Surface) msg.obj;
                         if (holder.isValid()) {
                             mediaPlayer.setSurface(holder);
+                            //exoPlayer在一些手机上在onPause后会声音先出来，画面黑一段时间，目前通过seekTo之后重新渲染解决
                             if (mediaPlayer != null && mediaPlayer.getDuration() > 30
                                     && mediaPlayer.getCurrentPosition() < mediaPlayer.getDuration()) {
                                 mediaPlayer.seekTo(mediaPlayer.getCurrentPosition() - 20);

File: gsyVideoPlayer/src/main/java/com/shuyu/gsyvideoplayer/model/GSYModel.java
Patch:
@@ -3,10 +3,12 @@
 import java.util.Map;
 
 /**
+ * 视频内部接受数据model
  * Created by shuyu on 2016/11/11.
  */
 
 public class GSYModel {
+
     String url;
     Map<String, String> mapHeadData;
     boolean looping;

File: gsyVideoPlayer/src/main/java/com/shuyu/gsyvideoplayer/utils/CommonUtil.java
Patch:
@@ -8,6 +8,7 @@
 import java.util.Locale;
 
 /**
+ * 公共类
  * Created by shuyu on 2016/11/11.
  */
 

