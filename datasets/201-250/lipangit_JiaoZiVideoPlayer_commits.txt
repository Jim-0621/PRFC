File: app/src/main/java/cn/jzvd/demo/CustomMedia/JZMediaExo.java
Patch:
@@ -151,6 +151,8 @@ public void release() {
         if (mMediaHandler != null && mMediaHandlerThread != null && simpleExoPlayer != null) {//不知道有没有妖孽
             HandlerThread tmpHandlerThread = mMediaHandlerThread;
             SimpleExoPlayer tmpMediaPlayer = simpleExoPlayer;
+            JZMediaInterface.SAVED_SURFACE = null;
+
             mMediaHandler.post(() -> {
                 tmpMediaPlayer.release();//release就不能放到主线程里，界面会卡顿
                 tmpHandlerThread.quit();

File: app/src/main/java/cn/jzvd/demo/CustomMedia/JZMediaSystemAssertFolder.java
Patch:
@@ -91,6 +91,8 @@ public void release() {
         if (mMediaHandler != null && mMediaHandlerThread != null && mediaPlayer != null) {//不知道有没有妖孽
             HandlerThread tmpHandlerThread = mMediaHandlerThread;
             MediaPlayer tmpMediaPlayer = mediaPlayer;
+            JZMediaInterface.SAVED_SURFACE = null;
+
             mMediaHandler.post(() -> {
                 tmpMediaPlayer.release();//release就不能放到主线程里，界面会卡顿
                 tmpHandlerThread.quit();

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZMediaSystem.java
Patch:
@@ -88,6 +88,8 @@ public void release() {//not perfect change you later
         if (mMediaHandler != null && mMediaHandlerThread != null && mediaPlayer != null) {//不知道有没有妖孽
             HandlerThread tmpHandlerThread = mMediaHandlerThread;
             MediaPlayer tmpMediaPlayer = mediaPlayer;
+            JZMediaInterface.SAVED_SURFACE = null;
+
             mMediaHandler.post(() -> {
                 tmpMediaPlayer.setSurface(null);
                 tmpMediaPlayer.release();

File: jiaozivideoplayer/src/main/java/cn/jzvd/Jzvd.java
Patch:
@@ -457,7 +457,6 @@ public void reset() {
         dismissVolumeDialog();
         onStateNormal();
         textureViewContainer.removeAllViews();
-        JZMediaInterface.SAVED_SURFACE = null;
 
         AudioManager mAudioManager = (AudioManager) getApplicationContext().getSystemService(Context.AUDIO_SERVICE);
         mAudioManager.abandonAudioFocus(onAudioFocusChangeListener);

File: jiaozivideoplayer/src/main/java/cn/jzvd/Jzvd.java
Patch:
@@ -928,6 +928,7 @@ public static void goOnPlayOnPause() {
         if (CURRENT_JZVD != null) {
             if (CURRENT_JZVD.state == Jzvd.STATE_AUTO_COMPLETE ||
                     CURRENT_JZVD.state == Jzvd.STATE_NORMAL ||
+                    CURRENT_JZVD.state == Jzvd.STATE_PREPARING ||
                     CURRENT_JZVD.state == Jzvd.STATE_ERROR) {
                 Jzvd.releaseAllVideos();
             } else {

File: app/src/main/java/cn/jzvd/demo/ActivityMain.java
Patch:
@@ -24,9 +24,9 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         setContentView(R.layout.activity_main);
 
         myJzvdStd = findViewById(R.id.jz_video);
-        myJzvdStd.setUp("http://jzvdStd.nathen.cn/342a5f7ef6124a4a8faf00e738b8bee4/cf6d9db0bd4d41f59d09ea0a81e918fd-5287d2089db37e62345123a1be272f8b.mp4"
+        myJzvdStd.setUp("http://jzvd.nathen.cn/342a5f7ef6124a4a8faf00e738b8bee4/cf6d9db0bd4d41f59d09ea0a81e918fd-5287d2089db37e62345123a1be272f8b.mp4"
                 , "饺子快长大");
-        Glide.with(this).load("http://jzvdStd-pic.nathen.cn/jzvdStd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png").into(myJzvdStd.thumbImageView);
+        Glide.with(this).load("http://jzvd-pic.nathen.cn/jzvd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png").into(myJzvdStd.thumbImageView);
 
     }
 

File: app/src/main/java/cn/jzvd/demo/ActivityPreloading.java
Patch:
@@ -23,15 +23,15 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
 
 //        jzvdStd.setUp("http://jzvd.nathen.cn/342a5f7ef6124a4a8faf00e738b8bee4/cf6d9db0bd4d41f59d09ea0a81e918fd-5287d2089db37e62345123a1be272f8b.mp4"
 //                , "饺子快长大", Jzvd.SCREEN_NORMAL, JZMediaIjk.class);
-        jzvdStd.setUp("http://jzvdStd.nathen.cn/4f965ad507ef4194a60a943a34cfe147/32af151ea132471f92c9ced2cff785ea-5287d2089db37e62345123a1be272f8b.mp4"
+        jzvdStd.setUp("http://jzvd.nathen.cn/4f965ad507ef4194a60a943a34cfe147/32af151ea132471f92c9ced2cff785ea-5287d2089db37e62345123a1be272f8b.mp4"
                 , "饺子快长大", Jzvd.SCREEN_NORMAL, JZMediaIjk.class);
 
 
 //        jzvdStd.setUp("http://jzvd.nathen.cn/342a5f7ef6124a4a8faf00e738b8bee4/cf6d9db0bd4d41f59d09ea0a81e918fd-5287d2089db37e62345123a1be272f8b.mp4"
 //                , "饺子快长大");
 //        jzvdStd.setUp("http://jzvd.nathen.cn/4f965ad507ef4194a60a943a34cfe147/32af151ea132471f92c9ced2cff785ea-5287d2089db37e62345123a1be272f8b.mp4"
 //                , "饺子快长大");
-        Glide.with(this).load("http://jzvdStd-pic.nathen.cn/jzvdStd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png").into(jzvdStd.thumbImageView);
+        Glide.with(this).load("http://jzvd-pic.nathen.cn/jzvd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png").into(jzvdStd.thumbImageView);
 
     }
 

File: app/src/main/java/cn/jzvd/demo/ActivityTinyWindow.java
Patch:
@@ -32,10 +32,10 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         setContentView(R.layout.activity_tiny_window);
 
         jzvdStdTinyWindow = findViewById(R.id.jz_video);
-        jzvdStdTinyWindow.setUp("http://jzvdStd.nathen.cn/342a5f7ef6124a4a8faf00e738b8bee4/cf6d9db0bd4d41f59d09ea0a81e918fd-5287d2089db37e62345123a1be272f8b.mp4", "饺子快长大"
+        jzvdStdTinyWindow.setUp("http://jzvd.nathen.cn/342a5f7ef6124a4a8faf00e738b8bee4/cf6d9db0bd4d41f59d09ea0a81e918fd-5287d2089db37e62345123a1be272f8b.mp4", "饺子快长大"
                 , JzvdStd.SCREEN_NORMAL);
         Glide.with(this)
-                .load("http://jzvdStd-pic.nathen.cn/jzvdStd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png")
+                .load("http://jzvd-pic.nathen.cn/jzvd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png")
                 .into(jzvdStdTinyWindow.thumbImageView);
 
     }

File: app/src/main/java/cn/jzvd/demo/ActivityWebView.java
Patch:
@@ -35,8 +35,8 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         setContentView(R.layout.activity_webview);
         mWebView = findViewById(R.id.webview);
         mWebView.getSettings().setJavaScriptEnabled(true);
-        mWebView.addJavascriptInterface(new JZCallBack(), "jzvdStd");
-        mWebView.loadUrl("file:///android_asset/jzvdStd.html");
+        mWebView.addJavascriptInterface(new JZCallBack(), "jzvd");
+        mWebView.loadUrl("file:///android_asset/jzvd.html");
     }
 
     @Override

File: app/src/main/java/cn/jzvd/demo/ActivityMain.java
Patch:
@@ -24,9 +24,9 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         setContentView(R.layout.activity_main);
 
         myJzvdStd = findViewById(R.id.jz_video);
-        myJzvdStd.setUp("http://jzvd.nathen.cn/342a5f7ef6124a4a8faf00e738b8bee4/cf6d9db0bd4d41f59d09ea0a81e918fd-5287d2089db37e62345123a1be272f8b.mp4"
+        myJzvdStd.setUp("http://jzvdStd.nathen.cn/342a5f7ef6124a4a8faf00e738b8bee4/cf6d9db0bd4d41f59d09ea0a81e918fd-5287d2089db37e62345123a1be272f8b.mp4"
                 , "饺子快长大");
-        Glide.with(this).load("http://jzvd-pic.nathen.cn/jzvd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png").into(myJzvdStd.thumbImageView);
+        Glide.with(this).load("http://jzvdStd-pic.nathen.cn/jzvdStd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png").into(myJzvdStd.thumbImageView);
 
     }
 

File: app/src/main/java/cn/jzvd/demo/ActivityTinyWindow.java
Patch:
@@ -32,10 +32,10 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         setContentView(R.layout.activity_tiny_window);
 
         jzvdStdTinyWindow = findViewById(R.id.jz_video);
-        jzvdStdTinyWindow.setUp("http://jzvd.nathen.cn/342a5f7ef6124a4a8faf00e738b8bee4/cf6d9db0bd4d41f59d09ea0a81e918fd-5287d2089db37e62345123a1be272f8b.mp4", "饺子快长大"
+        jzvdStdTinyWindow.setUp("http://jzvdStd.nathen.cn/342a5f7ef6124a4a8faf00e738b8bee4/cf6d9db0bd4d41f59d09ea0a81e918fd-5287d2089db37e62345123a1be272f8b.mp4", "饺子快长大"
                 , JzvdStd.SCREEN_NORMAL);
         Glide.with(this)
-                .load("http://jzvd-pic.nathen.cn/jzvd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png")
+                .load("http://jzvdStd-pic.nathen.cn/jzvdStd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png")
                 .into(jzvdStdTinyWindow.thumbImageView);
 
     }

File: app/src/main/java/cn/jzvd/demo/ActivityWebView.java
Patch:
@@ -35,8 +35,8 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         setContentView(R.layout.activity_webview);
         mWebView = findViewById(R.id.webview);
         mWebView.getSettings().setJavaScriptEnabled(true);
-        mWebView.addJavascriptInterface(new JZCallBack(), "jzvd");
-        mWebView.loadUrl("file:///android_asset/jzvd.html");
+        mWebView.addJavascriptInterface(new JZCallBack(), "jzvdStd");
+        mWebView.loadUrl("file:///android_asset/jzvdStd.html");
     }
 
     @Override

File: app/src/main/java/cn/jzvd/demo/CustomMedia/JZMediaExo.java
Patch:
@@ -220,7 +220,7 @@ public void onPlayerStateChanged(final boolean playWhenReady, final int playback
                 break;
                 case Player.STATE_READY: {
                     if (playWhenReady) {
-                        jzvd.onMediaPrepared();
+                        jzvd.onStatePrepared();
                     } else {
                     }
                 }

File: jiaozivideoplayer/src/main/java/cn/jzvd/Jzvd.java
Patch:
@@ -565,7 +565,7 @@ public void clearFloatScreen() {
 
         ViewGroup vg = (ViewGroup) (JZUtils.scanForActivity(getContext())).getWindow().getDecorView();
         vg.removeView(this);
-        mediaInterface.release();
+        if (mediaInterface != null) mediaInterface.release();
         CURRENT_JZVD = null;
     }
 

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZMediaInterface.java
Patch:
@@ -3,6 +3,7 @@
 import android.graphics.SurfaceTexture;
 import android.os.Handler;
 import android.os.HandlerThread;
+import android.view.Surface;
 import android.view.TextureView;
 
 /**
@@ -42,4 +43,5 @@ public JZMediaInterface(Jzvd jzvd) {
 
     public abstract void setSpeed(float speed);
 
+    public abstract void setSurface(Surface surface);
 }

File: jiaozivideoplayer/src/main/java/cn/jzvd/Jzvd.java
Patch:
@@ -510,6 +510,7 @@ public void changeUrl(int urlMapIndex, long seekToInAdvance) {
         state = STATE_PREPARING_CHANGING_URL;
         this.seekToInAdvance = seekToInAdvance;
         jzDataSource.currentUrlIndex = urlMapIndex;
+        mediaInterface.setSurface(null);
         mediaInterface.release();
         mediaInterface.prepare();
     }
@@ -518,6 +519,7 @@ public void changeUrl(JZDataSource jzDataSource, long seekToInAdvance) {
         state = STATE_PREPARING_CHANGING_URL;
         this.seekToInAdvance = seekToInAdvance;
         this.jzDataSource = jzDataSource;
+        mediaInterface.setSurface(null);
         mediaInterface.release();
         mediaInterface.prepare();
     }

File: app/src/main/java/cn/jzvd/demo/ActivityListViewMultiHolder.java
Patch:
@@ -55,7 +55,7 @@ public void onScroll(AbsListView view, int firstVisibleItem, int visibleItemCoun
 //                        currentPlayPosition + " " + firstVisibleItem + " " + currentPlayPosition + " " + lastVisibleItem);
                 if (currentPlayPosition >= 0) {
                     if ((currentPlayPosition < firstVisibleItem || currentPlayPosition > (lastVisibleItem - 1))) {
-                        if (Jzvd.CURRENT_JZVD.currentScreen != Jzvd.SCREEN_WINDOW_FULLSCREEN) {
+                        if (Jzvd.CURRENT_JZVD.screen != Jzvd.SCREEN_FULLSCREEN) {
                             Jzvd.resetAllVideos();//为什么最后一个视频横屏会调用这个，其他地方不会
                         }
                     }

File: app/src/main/java/cn/jzvd/demo/ActivityListViewNormal.java
Patch:
@@ -51,7 +51,7 @@ public void onScroll(AbsListView view, int firstVisibleItem, int visibleItemCoun
 //                        currentPlayPosition + " " + firstVisibleItem + " " + currentPlayPosition + " " + lastVisibleItem);
                 if (currentPlayPosition >= 0) {
                     if ((currentPlayPosition < firstVisibleItem || currentPlayPosition > (lastVisibleItem - 1))) {
-                        if (Jzvd.CURRENT_JZVD.currentScreen != Jzvd.SCREEN_WINDOW_FULLSCREEN) {
+                        if (Jzvd.CURRENT_JZVD.screen != Jzvd.SCREEN_FULLSCREEN) {
                             Jzvd.resetAllVideos();//为什么最后一个视频横屏会调用这个，其他地方不会
                         }
                     }

File: app/src/main/java/cn/jzvd/demo/ActivityListViewRecyclerView.java
Patch:
@@ -43,7 +43,7 @@ public void onChildViewDetachedFromWindow(View view) {
                 Jzvd jzvd = view.findViewById(R.id.videoplayer);
                 if (jzvd != null && Jzvd.CURRENT_JZVD != null &&
                         jzvd.jzDataSource.containsTheUrl(Jzvd.CURRENT_JZVD.jzDataSource.getCurrentUrl())) {
-                    if (Jzvd.CURRENT_JZVD != null && Jzvd.CURRENT_JZVD.currentScreen != Jzvd.SCREEN_WINDOW_FULLSCREEN) {
+                    if (Jzvd.CURRENT_JZVD != null && Jzvd.CURRENT_JZVD.screen != Jzvd.SCREEN_FULLSCREEN) {
                         Jzvd.resetAllVideos();
                     }
                 }

File: app/src/main/java/cn/jzvd/demo/ActivityTinyWindowRecycleView.java
Patch:
@@ -44,7 +44,7 @@ public void onChildViewAttachedToWindow(View view) {//这个的本质是gotoThis
                 JzvdStdTinyWindow currentJzvd = (JzvdStdTinyWindow) Jzvd.CURRENT_JZVD;
                 if (jzvd != null && currentJzvd != null &&
                         jzvd.jzDataSource.containsTheUrl(Jzvd.CURRENT_JZVD.jzDataSource.getCurrentUrl())
-                        && Jzvd.CURRENT_JZVD.currentState == Jzvd.CURRENT_STATE_PLAYING) {
+                        && Jzvd.CURRENT_JZVD.state == Jzvd.STATE_PLAYING) {
                     ViewGroup vp = (ViewGroup) jzvd.getParent();
                     vp.removeAllViews();
                     ((ViewGroup) currentJzvd.getParent()).removeView(currentJzvd);
@@ -60,8 +60,8 @@ public void onChildViewDetachedFromWindow(View view) {
                 JzvdStdTinyWindow jzvd = view.findViewById(R.id.videoplayer);
                 if (jzvd != null && Jzvd.CURRENT_JZVD != null &&
                         jzvd.jzDataSource.containsTheUrl(Jzvd.CURRENT_JZVD.jzDataSource.getCurrentUrl())
-                        && Jzvd.CURRENT_JZVD.currentScreen != Jzvd.SCREEN_WINDOW_TINY) {
-                    if (Jzvd.CURRENT_JZVD.currentState == Jzvd.CURRENT_STATE_PAUSE) {
+                        && Jzvd.CURRENT_JZVD.screen != Jzvd.SCREEN_TINY) {
+                    if (Jzvd.CURRENT_JZVD.state == Jzvd.STATE_PAUSE) {
                         Jzvd.resetAllVideos();
                     } else {
                         ((JzvdStdTinyWindow) Jzvd.CURRENT_JZVD).gotoScreenTiny();

File: app/src/main/java/cn/jzvd/demo/ActivityTinyWindowRecycleViewMultiHolder.java
Patch:
@@ -49,7 +49,7 @@ public void onChildViewAttachedToWindow(View view) {
                 JzvdStdTinyWindow currentJzvd = (JzvdStdTinyWindow) Jzvd.CURRENT_JZVD;
                 if (jzvd != null && currentJzvd != null &&
                         jzvd.jzDataSource.containsTheUrl(Jzvd.CURRENT_JZVD.jzDataSource.getCurrentUrl())
-                        && Jzvd.CURRENT_JZVD.currentState == Jzvd.CURRENT_STATE_PLAYING) {
+                        && Jzvd.CURRENT_JZVD.state == Jzvd.STATE_PLAYING) {
                     ViewGroup vp = (ViewGroup) jzvd.getParent();
                     vp.removeAllViews();
                     ((ViewGroup) currentJzvd.getParent()).removeView(currentJzvd);
@@ -65,8 +65,8 @@ public void onChildViewDetachedFromWindow(View view) {
                 JzvdStdTinyWindow jzvd = view.findViewById(R.id.videoplayer);
                 if (jzvd != null && Jzvd.CURRENT_JZVD != null &&
                         jzvd.jzDataSource.containsTheUrl(Jzvd.CURRENT_JZVD.jzDataSource.getCurrentUrl())
-                        && Jzvd.CURRENT_JZVD.currentScreen != Jzvd.SCREEN_WINDOW_TINY) {
-                    if (Jzvd.CURRENT_JZVD.currentState == Jzvd.CURRENT_STATE_PAUSE) {
+                        && Jzvd.CURRENT_JZVD.screen != Jzvd.SCREEN_TINY) {
+                    if (Jzvd.CURRENT_JZVD.state == Jzvd.STATE_PAUSE) {
                         Jzvd.resetAllVideos();
                     } else {
                         ((JzvdStdTinyWindow) Jzvd.CURRENT_JZVD).gotoScreenTiny();

File: app/src/main/java/cn/jzvd/demo/CustomJzvd/JzvdStdAutoCompleteAfterFullscreen.java
Patch:
@@ -25,7 +25,7 @@ public JzvdStdAutoCompleteAfterFullscreen(Context context, AttributeSet attrs) {
 
     @Override
     public void startVideo() {
-        if (currentScreen == SCREEN_WINDOW_FULLSCREEN) {
+        if (screen == SCREEN_FULLSCREEN) {
             Log.d(TAG, "startVideo [" + this.hashCode() + "] ");
             JZMediaInterface.SAVED_SURFACE = null;
             addTextureView();
@@ -41,7 +41,7 @@ public void startVideo() {
 
     @Override
     public void onAutoCompletion() {
-        if (currentScreen == SCREEN_WINDOW_FULLSCREEN) {
+        if (screen == SCREEN_FULLSCREEN) {
             onStateAutoComplete();
         } else {
             super.onAutoCompletion();

File: app/src/main/java/cn/jzvd/demo/CustomJzvd/JzvdStdMp3.java
Patch:
@@ -28,8 +28,8 @@ public int getLayoutId() {
     @Override
     public void onClick(View v) {
         if (v.getId() == cn.jzvd.R.id.thumb &&
-                (currentState == CURRENT_STATE_PLAYING ||
-                        currentState == CURRENT_STATE_PAUSE)) {
+                (state == STATE_PLAYING ||
+                        state == STATE_PAUSE)) {
             onClickUiToggle();
         } else if (v.getId() == R.id.fullscreen) {
 

File: app/src/main/java/cn/jzvd/demo/CustomJzvd/JzvdStdShowTitleAfterFullscreen.java
Patch:
@@ -23,7 +23,7 @@ public JzvdStdShowTitleAfterFullscreen(Context context, AttributeSet attrs) {
     @Override
     public void setUp(JZDataSource jzDataSource, int screen) {
         super.setUp(jzDataSource, screen);
-        if (currentScreen == SCREEN_WINDOW_FULLSCREEN) {
+        if (this.screen == SCREEN_FULLSCREEN) {
             titleTextView.setVisibility(View.VISIBLE);
         } else {
             titleTextView.setVisibility(View.INVISIBLE);

File: app/src/main/java/cn/jzvd/demo/CustomJzvd/JzvdStdTinyWindow.java
Patch:
@@ -30,7 +30,7 @@ public void setUp(JZDataSource jzDataSource, int screen, Class mediaInterface) {
 
     public void gotoScreenTiny() {
         Log.i(TAG, "startWindowTiny " + " [" + this.hashCode() + "] ");
-        if (currentState == CURRENT_STATE_NORMAL || currentState == CURRENT_STATE_ERROR || currentState == CURRENT_STATE_AUTO_COMPLETE)
+        if (state == STATE_NORMAL || state == STATE_ERROR || state == STATE_AUTO_COMPLETE)
             return;
         ViewGroup vg = (ViewGroup) getParent();
         vg.removeView(this);

File: app/src/main/java/cn/jzvd/demo/CustomJzvd/JzvdStdVolumeAfterFullscreen.java
Patch:
@@ -21,7 +21,7 @@ public JzvdStdVolumeAfterFullscreen(Context context, AttributeSet attrs) {
     @Override
     public void onPrepared() {
         super.onPrepared();
-        if (currentScreen == SCREEN_WINDOW_FULLSCREEN) {
+        if (screen == SCREEN_FULLSCREEN) {
             mediaInterface.setVolume(1f, 1f);
         } else {
             mediaInterface.setVolume(0f, 0f);

File: app/src/main/java/cn/jzvd/demo/CustomMedia/JZMediaSystemAssertFolder.java
Patch:
@@ -168,8 +168,8 @@ public boolean onError(MediaPlayer mediaPlayer, final int what, final int extra)
     public boolean onInfo(MediaPlayer mediaPlayer, final int what, final int extra) {
         handler.post(() -> {
             if (what == MediaPlayer.MEDIA_INFO_VIDEO_RENDERING_START) {
-                if (jzvd.currentState == Jzvd.CURRENT_STATE_PREPARING
-                        || jzvd.currentState == Jzvd.CURRENT_STATE_PREPARING_CHANGING_URL) {
+                if (jzvd.state == Jzvd.STATE_PREPARING
+                        || jzvd.state == Jzvd.STATE_PREPARING_CHANGING_URL) {
                     jzvd.onPrepared();
                 }
             } else {

File: app/src/main/java/cn/jzvd/demo/FragmentDemo.java
Patch:
@@ -54,7 +54,7 @@ public void onScroll(AbsListView view, int firstVisibleItem, int visibleItemCoun
 //                        currentPlayPosition + " " + firstVisibleItem + " " + currentPlayPosition + " " + lastVisibleItem);
                 if (currentPlayPosition >= 0) {
                     if ((currentPlayPosition < firstVisibleItem || currentPlayPosition > (lastVisibleItem - 1))) {
-                        if (Jzvd.CURRENT_JZVD.currentScreen != Jzvd.SCREEN_WINDOW_FULLSCREEN) {
+                        if (Jzvd.CURRENT_JZVD.screen != Jzvd.SCREEN_FULLSCREEN) {
                             Jzvd.resetAllVideos();//为什么最后一个视频横屏会调用这个，其他地方不会
                         }
                     }

File: jiaozivideoplayer/src/main/java/cn/jzvd/Jzvd.java
Patch:
@@ -663,7 +663,7 @@ public void reset() {
         AudioManager mAudioManager = (AudioManager) getApplicationContext().getSystemService(Context.AUDIO_SERVICE);
         mAudioManager.abandonAudioFocus(onAudioFocusChangeListener);
         JZUtils.scanForActivity(getContext()).getWindow().clearFlags(WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON);
-        mediaInterface.release();
+        if (mediaInterface != null) mediaInterface.release();
     }
 
     public void addTextureView() {

File: jiaozivideoplayer/src/main/java/cn/jzvd/JzvdStd.java
Patch:
@@ -290,7 +290,7 @@ public void onClick(View v) {
         } else if (i == R.id.back) {
             backPress();
         } else if (i == R.id.back_tiny) {
-            backPress();
+            clearFloatScreen();
         } else if (i == R.id.clarity) {
             LayoutInflater inflater = (LayoutInflater) getContext()
                     .getSystemService(Context.LAYOUT_INFLATER_SERVICE);

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZMediaSystem.java
Patch:
@@ -88,8 +88,8 @@ public void release() {//not perfect change you later
         if (mMediaHandler != null && mMediaHandlerThread != null && mediaPlayer != null) {//不知道有没有妖孽
             HandlerThread tmpHandlerThread = mMediaHandlerThread;
             MediaPlayer tmpMediaPlayer = mediaPlayer;
-            tmpMediaPlayer.setSurface(null);
             mMediaHandler.post(() -> {
+                tmpMediaPlayer.setSurface(null);
                 tmpMediaPlayer.release();
                 tmpHandlerThread.quit();
             });

File: app/src/main/java/cn/jzvd/demo/ActivityMain.java
Patch:
@@ -28,6 +28,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         myJzvdStd.setUp("http://jzvd.nathen.cn/342a5f7ef6124a4a8faf00e738b8bee4/cf6d9db0bd4d41f59d09ea0a81e918fd-5287d2089db37e62345123a1be272f8b.mp4"
                 , "饺子快长大", JzvdStd.SCREEN_NORMAL);
         Glide.with(this).load("http://jzvd-pic.nathen.cn/jzvd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png").into(myJzvdStd.thumbImageView);
+
     }
 
     @Override

File: app/src/main/java/cn/jzvd/demo/AdapterRecyclerViewTiny.java
Patch:
@@ -49,7 +49,6 @@ public void onBindViewHolder(MyViewHolder holder, int position) {
                 VideoConstant.videoUrls[0][position],
                 VideoConstant.videoTitles[0][position], Jzvd.SCREEN_NORMAL);
         Glide.with(holder.jzvdStd.getContext()).load(VideoConstant.videoThumbs[0][position]).into(holder.jzvdStd.thumbImageView);
-        System.out.println("fsdfsa onBindViewHolder " + holder.jzvdStd.jzDataSource.title);
     }
 
     @Override

File: app/src/main/java/cn/jzvd/demo/CustomJzvd/JzvdStdTinyWindow.java
Patch:
@@ -89,7 +89,6 @@ public void gotoScreenTiny() {
         lp.gravity = Gravity.RIGHT | Gravity.BOTTOM;
         //添加滑动事件等
         vgg.addView(this, lp);
-        System.out.println(jj + " " + this);
         setScreenTiny();
     }
 

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZMediaSystem.java
Patch:
@@ -84,12 +84,13 @@ public void seekTo(long time) {
     }
 
     @Override
-    public void release() {
+    public void release() {//not perfect change you later
         if (mMediaHandler != null && mMediaHandlerThread != null && mediaPlayer != null) {//不知道有没有妖孽
             HandlerThread tmpHandlerThread = mMediaHandlerThread;
             MediaPlayer tmpMediaPlayer = mediaPlayer;
+            tmpMediaPlayer.setSurface(null);
             mMediaHandler.post(() -> {
-                tmpMediaPlayer.release();//release就不能放到主线程里，界面会卡顿
+                tmpMediaPlayer.release();
                 tmpHandlerThread.quit();
             });
             mediaPlayer = null;

File: jiaozivideoplayer/src/main/java/cn/jzvd/Jzvd.java
Patch:
@@ -227,6 +227,8 @@ public static void startFullscreenDirectly(Context context, Class _class, String
     public static void startFullscreenDirectly(Context context, Class _class, JZDataSource jzDataSource) {
         JZUtils.hideStatusBar(context);
         JZUtils.setRequestedOrientation(context, FULLSCREEN_ORIENTATION);
+        JZUtils.hideSystemUI(context);
+
         ViewGroup vp = (ViewGroup) JZUtils.scanForActivity(context).getWindow().getDecorView();
         try {
             Constructor<Jzvd> constructor = _class.getConstructor(Context.class);
@@ -241,7 +243,6 @@ public static void startFullscreenDirectly(Context context, Class _class, JZData
         } catch (Exception e) {
             e.printStackTrace();
         }
-
     }
 
     /**

File: app/src/main/java/cn/jzvd/demo/ActivityApi.java
Patch:
@@ -55,12 +55,12 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         mJzvdStd.setUp(jzDataSource
                 , JzvdStd.SCREEN_NORMAL);
         Glide.with(this).load(VideoConstant.videoThumbList[0]).into(mJzvdStd.thumbImageView);
-//        jzvdStdTinyWindow.seekToInAdvance = 20000;
-        //JZVideoPlayer.SAVE_PROGRESS = false;
+//        mJzvdStd.seekToInAdvance = 20000;
+//        Jzvd.SAVE_PROGRESS = false;
 
         /** Play video in local path, eg:record by system camera **/
 //        cpAssertVideoToLocalPath();
-//        jzvdStdTinyWindow.setUp(Environment.getExternalStorageDirectory().getAbsolutePath() + "/DCIM/Camera/local_video.mp4"
+//        mJzvdStd.setUp(Environment.getExternalStorageDirectory().getAbsolutePath() + "/DCIM/Camera/local_video.mp4"
 //                , "饺子不信", Jzvd.SCREEN_NORMAL);
         mSensorManager = (SensorManager) getSystemService(SENSOR_SERVICE);
         mSensorEventListener = new Jzvd.JZAutoFullscreenListener();

File: app/src/main/java/cn/jzvd/demo/ActivityListViewMultiHolder.java
Patch:
@@ -48,8 +48,6 @@ public void onScrollStateChanged(AbsListView view, int scrollState) {
 
             @Override
             public void onScroll(AbsListView view, int firstVisibleItem, int visibleItemCount, int totalItemCount) {
-//                Jzvd.onScrollReleaseAllVideos(view, firstVisibleItem, visibleItemCount, totalItemCount);
-
                 if (Jzvd.CURRENT_JZVD == null) return;
                 int lastVisibleItem = firstVisibleItem + visibleItemCount;
                 int currentPlayPosition = Jzvd.CURRENT_JZVD.positionInList;

File: app/src/main/java/cn/jzvd/demo/ActivityListViewNormal.java
Patch:
@@ -56,7 +56,6 @@ public void onScroll(AbsListView view, int firstVisibleItem, int visibleItemCoun
                         }
                     }
                 }
-//                Jzvd.onScrollReleaseAllVideos(view, firstVisibleItem, visibleItemCount, totalItemCount);
             }
         });
 

File: jiaozivideoplayer/src/main/java/cn/jzvd/Jzvd.java
Patch:
@@ -37,6 +37,7 @@ public abstract class Jzvd extends FrameLayout implements View.OnClickListener,
     public static final int THRESHOLD = 80;
 
     public static final int SCREEN_NORMAL = 0;
+    //TODO 干掉这个变量
     public static final int SCREEN_WINDOW_LIST = 1;
     public static final int SCREEN_WINDOW_FULLSCREEN = 2;
     public static final int SCREEN_WINDOW_TINY = 3;

File: app/src/main/java/cn/jzvd/demo/CustomJzvd/JzvdStdTinyWindow.java
Patch:
@@ -94,9 +94,9 @@ public void gotoScreenTiny() {
     }
 
     public Jzvd cloneMe() {
-        Jzvd jzvd = null;
+        JzvdStdTinyWindow jzvd = null;
         try {
-            Constructor<Jzvd> constructor = (Constructor<Jzvd>) JzvdStdTinyWindow.this.getClass().getConstructor(Context.class);
+            Constructor<JzvdStdTinyWindow> constructor = (Constructor<JzvdStdTinyWindow>) JzvdStdTinyWindow.this.getClass().getConstructor(Context.class);
             jzvd = constructor.newInstance(getContext());
             jzvd.jzDataSource = jzDataSource.cloneMe();//jzvd应该是idle状态
             jzvd.setId(getId());

File: app/src/main/java/cn/jzvd/demo/ActivityApi.java
Patch:
@@ -146,7 +146,7 @@ public void clickRotationAndVideoSize(View view) {
     }
 
     public void clickCustomMediaPlayer(View view) {
-        startActivity(new Intent(ActivityApi.this, ActivityApiCustomMediaPlayer.class));
+        startActivity(new Intent(ActivityApi.this, ActivityApiCustomMedia.class));
     }
 
 }

File: jiaozivideoplayer/src/main/java/cn/jzvd/JzvdStd.java
Patch:
@@ -263,7 +263,7 @@ public void onClick(View v) {
         super.onClick(v);
         int i = v.getId();
         if (i == R.id.thumb) {
-            if (jzDataSource.urlsMap.isEmpty() || jzDataSource.getCurrentUrl() == null) {
+            if (jzDataSource == null ||jzDataSource.urlsMap.isEmpty() || jzDataSource.getCurrentUrl() == null) {
                 Toast.makeText(getContext(), getResources().getString(R.string.no_url), Toast.LENGTH_SHORT).show();
                 return;
             }

File: jiaozivideoplayer/src/main/java/cn/jzvd/JzvdStd.java
Patch:
@@ -363,7 +363,7 @@ public void showWifiDialog() {
             dialog.dismiss();
             clearFloatScreen();
         });
-        builder.setOnCancelListener(dialog -> dialog.dismiss());
+        builder.setOnCancelListener(DialogInterface::dismiss);
         builder.create().show();
     }
 

File: jiaozivideoplayer/src/main/java/cn/jzvd/Jzvd.java
Patch:
@@ -810,7 +810,7 @@ public void release() {
 
     public void initTextureView() {
         removeTextureView();
-        JZMediaManager.textureView = new JZTextureView(getContext());
+        JZMediaManager.textureView = new JZTextureView(getContext().getApplicationContext());
         JZMediaManager.textureView.setSurfaceTextureListener(JZMediaManager.instance());
     }
 

File: jiaozivideoplayer/src/main/java/cn/jzvd/Jzvd.java
Patch:
@@ -432,7 +432,7 @@ public void onClick(View v) {
         int i = v.getId();
         if (i == R.id.start) {
             Log.i(TAG, "onClick start [" + this.hashCode() + "] ");
-            if (jzDataSource.urlsMap.isEmpty() || jzDataSource.getCurrentUrl() == null) {
+            if (jzDataSource == null || jzDataSource.urlsMap.isEmpty() || jzDataSource.getCurrentUrl() == null) {
                 Toast.makeText(getContext(), getResources().getString(R.string.no_url), Toast.LENGTH_SHORT).show();
                 return;
             }

File: app/src/main/java/cn/jzvd/demo/ActivityApiCustomMediaPlayer.java
Patch:
@@ -58,7 +58,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         }
         jzvdStd.setUp(jzDataSource, JzvdStd.SCREEN_WINDOW_NORMAL);
         Glide.with(this)
-                .load("http://jzvd-pic.nathen.cn/jzvdStd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png")
+                .load("http://jzvd-pic.nathen.cn/jzvd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png")
                 .into(jzvdStd.thumbImageView);
 
         Jzvd.setMediaInterface(new CustomMediaPlayerAssertFolder());//进入此页面修改MediaInterface，让此页面的jzvd正常工作

File: app/src/main/java/cn/jzvd/demo/ActivityTinyWindow.java
Patch:
@@ -36,7 +36,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         mJzvdStd.setUp("http://jzvd.nathen.cn/342a5f7ef6124a4a8faf00e738b8bee4/cf6d9db0bd4d41f59d09ea0a81e918fd-5287d2089db37e62345123a1be272f8b.mp4", "饺子快长大"
                 , JzvdStd.SCREEN_WINDOW_NORMAL);
         Glide.with(this)
-                .load("http://jzvd-pic.nathen.cn/jzvdStd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png")
+                .load("http://jzvd-pic.nathen.cn/jzvd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png")
                 .into(mJzvdStd.thumbImageView);
 
         mBtnTinyWindow = findViewById(R.id.tiny_window);

File: app/src/main/java/cn/jzvd/demo/ActivityApiCustomMediaPlayer.java
Patch:
@@ -58,7 +58,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         }
         jzvdStd.setUp(jzDataSource, JzvdStd.SCREEN_WINDOW_NORMAL);
         Glide.with(this)
-                .load("http://jzvdStd-pic.nathen.cn/jzvdStd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png")
+                .load("http://jzvd-pic.nathen.cn/jzvdStd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png")
                 .into(jzvdStd.thumbImageView);
 
         Jzvd.setMediaInterface(new CustomMediaPlayerAssertFolder());//进入此页面修改MediaInterface，让此页面的jzvd正常工作

File: app/src/main/java/cn/jzvd/demo/ActivityTinyWindow.java
Patch:
@@ -33,10 +33,10 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         setContentView(R.layout.activity_tiny_window);
 
         mJzvdStd = findViewById(R.id.jz_video);
-        mJzvdStd.setUp("http://jzvdStd.nathen.cn/342a5f7ef6124a4a8faf00e738b8bee4/cf6d9db0bd4d41f59d09ea0a81e918fd-5287d2089db37e62345123a1be272f8b.mp4", "饺子快长大"
+        mJzvdStd.setUp("http://jzvd.nathen.cn/342a5f7ef6124a4a8faf00e738b8bee4/cf6d9db0bd4d41f59d09ea0a81e918fd-5287d2089db37e62345123a1be272f8b.mp4", "饺子快长大"
                 , JzvdStd.SCREEN_WINDOW_NORMAL);
         Glide.with(this)
-                .load("http://jzvdStd-pic.nathen.cn/jzvdStd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png")
+                .load("http://jzvd-pic.nathen.cn/jzvdStd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png")
                 .into(mJzvdStd.thumbImageView);
 
         mBtnTinyWindow = findViewById(R.id.tiny_window);

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -388,7 +388,7 @@ public void setUp(String url, int screen, Object... objects) {
 
     public void setUp(JZDataSource jzDataSource, int screen, Object... objects) {
         if (this.jzDataSource != null && jzDataSource.getCurrentUrl() != null &&
-                jzDataSource.containsTheUrl(jzDataSource.getCurrentUrl())) {
+                this.jzDataSource.containsTheUrl(jzDataSource.getCurrentUrl())) {
             return;
         }
         if (isCurrentJZVD() && jzDataSource.containsTheUrl(JZMediaManager.getCurrentUrl())) {

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -383,7 +383,7 @@ public void init(Context context) {
     }
 
     public void setUp(String url, int screen, Object... objects) {
-        setUp(new JZDataSource(url), 0, screen, objects);
+        setUp(new JZDataSource(url), screen, objects);
     }
 
     public void setUp(JZDataSource jzDataSource, int screen, Object... objects) {

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZMediaManager.java
Patch:
@@ -106,6 +106,7 @@ public void prepare() {
 
     @Override
     public void onSurfaceTextureAvailable(SurfaceTexture surfaceTexture, int i, int i1) {
+        if(JZVideoPlayerManager.getCurrentJzvd() == null) return;
         Log.i(TAG, "onSurfaceTextureAvailable [" + JZVideoPlayerManager.getCurrentJzvd().hashCode() + "] ");
         if (savedSurfaceTexture == null) {
             savedSurfaceTexture = surfaceTexture;

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -447,8 +447,8 @@ public void onClick(View v) {
                     showWifiDialog();
                     return;
                 }
-                onEvent(JZUserAction.ON_CLICK_START_ICON);
                 startVideo();
+                onEvent(JZUserAction.ON_CLICK_START_ICON);//开始的事件应该在播放之后，此处特殊
             } else if (currentState == CURRENT_STATE_PLAYING) {
                 onEvent(JZUserAction.ON_CLICK_PAUSE);
                 Log.d(TAG, "pauseVideo [" + this.hashCode() + "] ");

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayerStandard.java
Patch:
@@ -265,8 +265,8 @@ public void onClick(View v) {
                     showWifiDialog();
                     return;
                 }
-                onEvent(JZUserActionStandard.ON_CLICK_START_THUMB);
                 startVideo();
+                onEvent(JZUserActionStandard.ON_CLICK_START_THUMB);//开始的事件应该在播放之后，此处特殊
             } else if (currentState == CURRENT_STATE_AUTO_COMPLETE) {
                 onClickUiToggle();
             }

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -447,8 +447,8 @@ public void onClick(View v) {
                     showWifiDialog();
                     return;
                 }
-                startVideo();
                 onEvent(JZUserAction.ON_CLICK_START_ICON);
+                startVideo();
             } else if (currentState == CURRENT_STATE_PLAYING) {
                 onEvent(JZUserAction.ON_CLICK_PAUSE);
                 Log.d(TAG, "pauseVideo [" + this.hashCode() + "] ");

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -1064,7 +1064,7 @@ public void playOnThisJzvd() {
     //重力感应的时候调用的函数，
     public void autoFullscreen(float x) {
         if (isCurrentPlay()
-                && currentState == CURRENT_STATE_PLAYING
+                && (currentState == CURRENT_STATE_PLAYING || currentState == CURRENT_STATE_PAUSE)
                 && currentScreen != SCREEN_WINDOW_FULLSCREEN
                 && currentScreen != SCREEN_WINDOW_TINY) {
             if (x > 0) {

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayerStandard.java
Patch:
@@ -319,7 +319,9 @@ public void onClick(View v) {
             clarityPopWindow.setContentView(layout);
             clarityPopWindow.showAsDropDown(clarity);
             layout.measure(View.MeasureSpec.UNSPECIFIED, View.MeasureSpec.UNSPECIFIED);
-            clarityPopWindow.update(clarity, -40, 46, Math.round(layout.getMeasuredWidth() * 2), layout.getMeasuredHeight());
+            int offsetX = clarity.getMeasuredWidth() / 3;
+            int offsetY = clarity.getMeasuredHeight() / 3;
+            clarityPopWindow.update(clarity, - offsetX, - offsetY, Math.round(layout.getMeasuredWidth() * 2), layout.getMeasuredHeight());
         } else if (i == R.id.retry_btn) {
             if (dataSourceObjects == null || JZUtils.getCurrentFromDataSource(dataSourceObjects, currentUrlMapIndex) == null) {
                 Toast.makeText(getContext(), getResources().getString(R.string.no_url), Toast.LENGTH_SHORT).show();

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayerStandard.java
Patch:
@@ -319,7 +319,9 @@ public void onClick(View v) {
             clarityPopWindow.setContentView(layout);
             clarityPopWindow.showAsDropDown(clarity);
             layout.measure(View.MeasureSpec.UNSPECIFIED, View.MeasureSpec.UNSPECIFIED);
-            clarityPopWindow.update(clarity, -40, 46, Math.round(layout.getMeasuredWidth() * 2), layout.getMeasuredHeight());
+            int offsetX = clarity.getMeasuredWidth() / 3;
+            int offsetY = clarity.getMeasuredHeight() / 3;
+            clarityPopWindow.update(clarity, - offsetX, - offsetY, Math.round(layout.getMeasuredWidth() * 2), layout.getMeasuredHeight());
         } else if (i == R.id.retry_btn) {
             if (dataSourceObjects == null || JZUtils.getCurrentFromDataSource(dataSourceObjects, currentUrlMapIndex) == null) {
                 Toast.makeText(getContext(), getResources().getString(R.string.no_url), Toast.LENGTH_SHORT).show();

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZMediaSystem.java
Patch:
@@ -173,7 +173,8 @@ public boolean onInfo(MediaPlayer mediaPlayer, final int what, final int extra)
             public void run() {
                 if (JZVideoPlayerManager.getCurrentJzvd() != null) {
                     if (what == MediaPlayer.MEDIA_INFO_VIDEO_RENDERING_START) {
-                        if (JZVideoPlayerManager.getCurrentJzvd().currentState == JZVideoPlayer.CURRENT_STATE_PREPARING) {
+                        if (JZVideoPlayerManager.getCurrentJzvd().currentState == JZVideoPlayer.CURRENT_STATE_PREPARING
+                                ||JZVideoPlayerManager.getCurrentJzvd().currentState == JZVideoPlayer.CURRENT_STATE_PREPARING_CHANGING_URL) {
                             JZVideoPlayerManager.getCurrentJzvd().onPrepared();
                         }
                     } else {

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -762,6 +762,9 @@ public void onCompletion() {
             JZUtils.saveProgress(getContext(), JZUtils.getCurrentFromDataSource(dataSourceObjects, currentUrlMapIndex), position);
         }
         cancelProgressTimer();
+        dismissBrightnessDialog();
+        dismissProgressDialog();
+        dismissVolumeDialog();
         onStateNormal();
         textureViewContainer.removeView(JZMediaManager.textureView);
         JZMediaManager.instance().currentVideoWidth = 0;

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZUtils.java
Patch:
@@ -166,7 +166,7 @@ public static Object getValueFromLinkedMap(LinkedHashMap<String, Object> map, in
 
     public static boolean dataSourceObjectsContainsUri(Object[] dataSourceObjects, Object object) {
         LinkedHashMap<String, Object> map = (LinkedHashMap) dataSourceObjects[0];
-        if (map != null) {
+        if (map != null && object != null) {
             return map.containsValue(object);
         }
         return false;

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZMediaSystem.java
Patch:
@@ -173,7 +173,9 @@ public boolean onInfo(MediaPlayer mediaPlayer, final int what, final int extra)
             public void run() {
                 if (JZVideoPlayerManager.getCurrentJzvd() != null) {
                     if (what == MediaPlayer.MEDIA_INFO_VIDEO_RENDERING_START) {
-                        JZVideoPlayerManager.getCurrentJzvd().onPrepared();
+                        if (JZVideoPlayerManager.getCurrentJzvd().currentState == JZVideoPlayer.CURRENT_STATE_PREPARING) {
+                            JZVideoPlayerManager.getCurrentJzvd().onPrepared();
+                        }
                     } else {
                         JZVideoPlayerManager.getCurrentJzvd().onInfo(what, extra);
                     }

File: app/src/main/java/cn/jzvd/demo/ActivityListViewRecyclerView.java
Patch:
@@ -45,7 +45,8 @@ public void onChildViewAttachedToWindow(View view) {
             public void onChildViewDetachedFromWindow(View view) {
                 JZVideoPlayer jzvd = view.findViewById(R.id.videoplayer);
                 if (jzvd != null && JZUtils.dataSourceObjectsContainsUri(jzvd.dataSourceObjects, JZMediaManager.getCurrentDataSource())) {
-                    if(JZVideoPlayerManager.getCurrentJzvd().currentScreen != JZVideoPlayer.SCREEN_WINDOW_FULLSCREEN){
+                    JZVideoPlayer currentJzvd = JZVideoPlayerManager.getCurrentJzvd();
+                    if (currentJzvd != null && currentJzvd.currentScreen != JZVideoPlayer.SCREEN_WINDOW_FULLSCREEN) {
                         JZVideoPlayer.releaseAllVideos();
                     }
                 }

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -965,7 +965,6 @@ public void onProgressChanged(SeekBar seekBar, int progress, boolean fromUser) {
     public void startWindowFullscreen() {
         Log.i(TAG, "startWindowFullscreen " + " [" + this.hashCode() + "] ");
         hideSupportActionBar(getContext());
-        JZUtils.setRequestedOrientation(getContext(), FULLSCREEN_ORIENTATION);
 
         ViewGroup vp = (JZUtils.scanForActivity(getContext()))//.getWindow().getDecorView();
                 .findViewById(Window.ID_ANDROID_CONTENT);
@@ -989,13 +988,16 @@ public void startWindowFullscreen() {
             JZVideoPlayerManager.setSecondFloor(jzVideoPlayer);
 //            final Animation ra = AnimationUtils.loadAnimation(getContext(), R.anim.start_fullscreen);
 //            jzVideoPlayer.setAnimation(ra);
+            JZUtils.setRequestedOrientation(getContext(), FULLSCREEN_ORIENTATION);
+
             onStateNormal();
             jzVideoPlayer.progressBar.setSecondaryProgress(progressBar.getSecondaryProgress());
             jzVideoPlayer.startProgressTimer();
             CLICK_QUIT_FULLSCREEN_TIME = System.currentTimeMillis();
         } catch (Exception e) {
             e.printStackTrace();
         }
+
     }
 
     public void startWindowTiny() {

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZUtils.java
Patch:
@@ -8,7 +8,6 @@
 import android.net.NetworkInfo;
 import android.support.v7.app.AppCompatActivity;
 import android.support.v7.view.ContextThemeWrapper;
-import android.text.TextUtils;
 import android.util.Log;
 import android.view.Window;
 

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayerStandard.java
Patch:
@@ -610,7 +610,7 @@ public void changeUiToError() {
                 updateStartImage();
                 break;
             case SCREEN_WINDOW_FULLSCREEN:
-                setAllControlsVisiblity(View.INVISIBLE, View.INVISIBLE, View.VISIBLE,
+                setAllControlsVisiblity(View.VISIBLE, View.INVISIBLE, View.VISIBLE,
                         View.INVISIBLE, View.INVISIBLE, View.INVISIBLE, View.VISIBLE);
                 updateStartImage();
                 break;

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayerStandard.java
Patch:
@@ -365,6 +365,7 @@ public void onClick(DialogInterface dialog, int which) {
             @Override
             public void onClick(DialogInterface dialog, int which) {
                 dialog.dismiss();
+                clearFloatScreen();
             }
         });
         builder.setOnCancelListener(new DialogInterface.OnCancelListener() {

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -81,8 +81,8 @@ public void onAudioFocusChange(int focusChange) {
                     break;
                 case AudioManager.AUDIOFOCUS_LOSS_TRANSIENT:
                     try {
-                        if (JZMediaManager.isPlaying()) {
-                            JZMediaManager.pause();
+                        if (JZVideoPlayerManager.getCurrentJzvd().currentState == JZVideoPlayer.CURRENT_STATE_PLAYING) {
+                            JZVideoPlayerManager.getCurrentJzvd().startButton.performClick();
                         }
                     } catch (IllegalStateException e) {
                         e.printStackTrace();

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZUtils.java
Patch:
@@ -119,7 +119,7 @@ public static void saveProgress(Context context, Object url, long progress) {
         SharedPreferences spn = context.getSharedPreferences("JZVD_PROGRESS",
                 Context.MODE_PRIVATE);
         SharedPreferences.Editor editor = spn.edit();
-        editor.putLong(url.toString(), progress);
+        editor.putLong("newVersion:" + url.toString(), progress);
         editor.apply();
     }
 
@@ -128,7 +128,7 @@ public static long getSavedProgress(Context context, Object url) {
         SharedPreferences spn;
         spn = context.getSharedPreferences("JZVD_PROGRESS",
                 Context.MODE_PRIVATE);
-        return spn.getLong(url.toString(), 0);
+        return spn.getLong("newVersion:" + url.toString(), 0);
     }
 
     /**

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -285,7 +285,8 @@ public static void onScrollAutoTiny(AbsListView view, int firstVisibleItem, int
         if (currentPlayPosition >= 0) {
             if ((currentPlayPosition < firstVisibleItem || currentPlayPosition > (lastVisibleItem - 1))) {
                 if (JZVideoPlayerManager.getCurrentJzvd() != null &&
-                        JZVideoPlayerManager.getCurrentJzvd().currentScreen != JZVideoPlayer.SCREEN_WINDOW_TINY) {
+                        JZVideoPlayerManager.getCurrentJzvd().currentScreen != JZVideoPlayer.SCREEN_WINDOW_TINY &&
+                        JZVideoPlayerManager.getCurrentJzvd().currentScreen != JZVideoPlayer.SCREEN_WINDOW_FULLSCREEN) {
                     if (JZVideoPlayerManager.getCurrentJzvd().currentState == JZVideoPlayer.CURRENT_STATE_PAUSE) {
                         JZVideoPlayer.releaseAllVideos();
                     } else {

File: app/src/main/java/cn/jzvd/demo/ActivityApi.java
Patch:
@@ -65,7 +65,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         map.put("普清", VideoConstant.videoUrlList[0]);
         Object[] objects = new Object[3];
         objects[0] = map;
-        objects[1] = true;
+        objects[1] = false;
         objects[2] = new HashMap<>();
         ((HashMap) objects[2]).put("key", "value");
         mJzVideoPlayerStandard.setUp(objects, 2

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -81,8 +81,7 @@ public void onAudioFocusChange(int focusChange) {
                     break;
                 case AudioManager.AUDIOFOCUS_LOSS_TRANSIENT:
                     try {
-                        if (//JZMediaManager.instance().mediaPlayer != null &&
-                                JZMediaManager.isPlaying()) {
+                        if (JZMediaManager.isPlaying()) {
                             JZMediaManager.pause();
                         }
                     } catch (IllegalStateException e) {
@@ -270,7 +269,8 @@ public static void goOnPlayOnPause() {
         if (JZVideoPlayerManager.getCurrentJzvd() != null) {
             JZVideoPlayer jzvd = JZVideoPlayerManager.getCurrentJzvd();
             if (jzvd.currentState == JZVideoPlayer.CURRENT_STATE_AUTO_COMPLETE ||
-                    jzvd.currentState == JZVideoPlayer.CURRENT_STATE_NORMAL) {
+                    jzvd.currentState == JZVideoPlayer.CURRENT_STATE_NORMAL ||
+                    jzvd.currentState == JZVideoPlayer.CURRENT_STATE_ERROR) {
 //                JZVideoPlayer.releaseAllVideos();
             } else {
                 jzvd.onStatePause();

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayerStandard.java
Patch:
@@ -633,11 +633,14 @@ public void setAllControlsVisiblity(int topCon, int bottomCon, int startBtn, int
 
     public void updateStartImage() {
         if (currentState == CURRENT_STATE_PLAYING) {
+            startButton.setVisibility(VISIBLE);
             startButton.setImageResource(R.drawable.jz_click_pause_selector);
             replayTextView.setVisibility(INVISIBLE);
         } else if (currentState == CURRENT_STATE_ERROR) {
+            startButton.setVisibility(INVISIBLE);
             replayTextView.setVisibility(INVISIBLE);
         } else if (currentState == CURRENT_STATE_AUTO_COMPLETE) {
+            startButton.setVisibility(VISIBLE);
             startButton.setImageResource(R.drawable.jz_click_replay_selector);
             replayTextView.setVisibility(VISIBLE);
         } else {

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZMediaManager.java
Patch:
@@ -37,6 +37,8 @@ public JZMediaManager() {
         mMediaHandlerThread.start();
         mMediaHandler = new MediaHandler(mMediaHandlerThread.getLooper());
         mainThreadHandler = new Handler();
+        if (jzMediaInterface == null)
+            jzMediaInterface = new JZMediaSystem();
     }
 
     public static JZMediaManager instance() {

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -395,9 +395,6 @@ public void setUp(String url, int screen, Object... objects) {
     }
 
     public void setUp(Object[] dataSourceObjects, int defaultUrlMapIndex, int screen, Object... objects) {
-        if (JZMediaManager.instance().jzMediaInterface == null)
-            setMediaInterface(new JZMediaSystem());
-
         if (this.dataSourceObjects != null && JZUtils.getCurrentFromDataSource(dataSourceObjects, currentUrlMapIndex) != null &&
                 JZUtils.getCurrentFromDataSource(this.dataSourceObjects, currentUrlMapIndex).equals(JZUtils.getCurrentFromDataSource(dataSourceObjects, currentUrlMapIndex))) {
             return;

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -712,7 +712,7 @@ public void onInfo(int what, int extra) {
 
     public void onError(int what, int extra) {
         Log.e(TAG, "onError " + what + " - " + extra + " [" + this.hashCode() + "] ");
-        if (what != 38 && what != -38 && extra != -38) {
+        if (what != 38 && extra != -38 && what != -38 && extra != 38 && extra != -19) {
             onStateError();
             if (isCurrentPlay()) {
                 JZMediaManager.instance().releaseMediaPlayer();

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -473,9 +473,6 @@ public void onClick(View v) {
                 onEvent(JZUserAction.ON_ENTER_FULLSCREEN);
                 startWindowFullscreen();
             }
-        } else if (i == R.id.surface_container && currentState == CURRENT_STATE_ERROR) {
-            Log.i(TAG, "onClick surfaceContainer State=Error [" + this.hashCode() + "] ");
-            startVideo();
         }
     }
 

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZMediaManager.java
Patch:
@@ -140,7 +140,6 @@ public void handleMessage(Message msg) {
                 case HANDLER_PREPARE:
                     currentVideoWidth = 0;
                     currentVideoHeight = 0;
-                    jzMediaInterface.release();
                     jzMediaInterface.prepare();
                     if (surface != null) {
                         surface.release();

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -194,7 +194,7 @@ public static boolean backPress() {
 
         if (JZVideoPlayerManager.getSecondFloor() != null) {
             CLICK_QUIT_FULLSCREEN_TIME = System.currentTimeMillis();
-            if (JZUtils.dataSourceObjectsContainsUri(JZVideoPlayerManager.getFirstFloor().dataSourceObjects,JZMediaManager.getCurrentDataSource())) {
+            if (JZUtils.dataSourceObjectsContainsUri(JZVideoPlayerManager.getFirstFloor().dataSourceObjects, JZMediaManager.getCurrentDataSource())) {
                 JZVideoPlayer jzVideoPlayer = JZVideoPlayerManager.getSecondFloor();
                 jzVideoPlayer.onEvent(jzVideoPlayer.currentScreen == JZVideoPlayerStandard.SCREEN_WINDOW_FULLSCREEN ?
                         JZUserAction.ON_QUIT_FULLSCREEN :
@@ -781,6 +781,7 @@ public void onCompletion() {
         JZUtils.setRequestedOrientation(getContext(), NORMAL_ORIENTATION);
 
         if (JZMediaManager.surface != null) JZMediaManager.surface.release();
+        if (JZMediaManager.savedSurfaceTexture != null) JZMediaManager.savedSurfaceTexture.release();
         JZMediaManager.textureView = null;
         JZMediaManager.savedSurfaceTexture = null;
     }

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayerStandard.java
Patch:
@@ -122,8 +122,7 @@ public void init(Context context) {
 
     public void setUp(Object[] dataSourceObjects, int defaultUrlMapIndex, int screen, Object... objects) {
         super.setUp(dataSourceObjects, defaultUrlMapIndex, screen, objects);
-        if (objects.length == 0) return;
-        titleTextView.setText(objects[0].toString());
+        if (objects.length != 0) titleTextView.setText(objects[0].toString());
         if (currentScreen == SCREEN_WINDOW_FULLSCREEN) {
             fullscreenButton.setImageResource(R.drawable.jz_shrink);
             backButton.setVisibility(View.VISIBLE);

File: app/src/main/java/cn/jzvd/demo/ActivityListViewRecyclerView.java
Patch:
@@ -9,6 +9,7 @@
 import android.view.View;
 
 import cn.jzvd.JZMediaManager;
+import cn.jzvd.JZUtils;
 import cn.jzvd.JZVideoPlayer;
 
 /**
@@ -41,7 +42,7 @@ public void onChildViewAttachedToWindow(View view) {
             @Override
             public void onChildViewDetachedFromWindow(View view) {
                 JZVideoPlayer jzvd = view.findViewById(R.id.videoplayer);
-                if (jzvd != null && jzvd.getCurrentUrl().equals(JZMediaManager.getCurrentDataSource())) {
+                if (jzvd != null && JZUtils.dataSourceObjectsContainsUri(jzvd.dataSourceObjects, JZMediaManager.getCurrentDataSource())) {
                     JZVideoPlayer.releaseAllVideos();
                 }
             }

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -194,7 +194,7 @@ public static boolean backPress() {
 
         if (JZVideoPlayerManager.getSecondFloor() != null) {
             CLICK_QUIT_FULLSCREEN_TIME = System.currentTimeMillis();
-            if (JZVideoPlayerManager.getFirstFloor().getCurrentUrl().equals(JZMediaManager.getCurrentDataSource())) {
+            if (JZUtils.dataSourceObjectsContainsUri(JZVideoPlayerManager.getFirstFloor().dataSourceObjects,JZMediaManager.getCurrentDataSource())) {
                 JZVideoPlayer jzVideoPlayer = JZVideoPlayerManager.getSecondFloor();
                 jzVideoPlayer.onEvent(jzVideoPlayer.currentScreen == JZVideoPlayerStandard.SCREEN_WINDOW_FULLSCREEN ?
                         JZUserAction.ON_QUIT_FULLSCREEN :
@@ -218,8 +218,7 @@ public static void quitFullscreenOrTinyWindow() {
         //直接退出全屏和小窗
         JZVideoPlayerManager.getFirstFloor().clearFloatScreen();
         JZMediaManager.instance().releaseMediaPlayer();
-        JZVideoPlayerManager.setFirstFloor(null);
-        JZVideoPlayerManager.setSecondFloor(null);
+        JZVideoPlayerManager.completeAll();
     }
 
     @SuppressLint("RestrictedApi")

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZUtils.java
Patch:
@@ -113,7 +113,7 @@ public static int dip2px(Context context, float dpValue) {
     public static void saveProgress(Context context, Object url, int progress) {
         if (!JZVideoPlayer.SAVE_PROGRESS) return;
         Log.i(TAG, "saveProgress: " + progress);
-        if (progress < 6000) {
+        if (progress < 5000) {
             progress = 0;
         }
         SharedPreferences spn = context.getSharedPreferences("JZVD_PROGRESS",
@@ -123,12 +123,12 @@ public static void saveProgress(Context context, Object url, int progress) {
         editor.apply();
     }
 
-    public static int getSavedProgress(Context context, String url) {
+    public static int getSavedProgress(Context context, Object url) {
         if (!JZVideoPlayer.SAVE_PROGRESS) return 0;
         SharedPreferences spn;
         spn = context.getSharedPreferences("JZVD_PROGRESS",
                 Context.MODE_PRIVATE);
-        return spn.getInt(url, 0);
+        return spn.getInt(url.toString(), 0);
     }
 
     /**

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -679,7 +679,7 @@ public void onStatePrepared() {//因为这个紧接着就会进入播放状态
             JZMediaManager.seekTo(seekToInAdvance);
             seekToInAdvance = 0;
         } else {
-            int position = JZUtils.getSavedProgress(getContext(), JZUtils.getCurrentFromDataSource(dataSourceObjects, currentUrlMapIndex).toString());
+            int position = JZUtils.getSavedProgress(getContext(), JZUtils.getCurrentFromDataSource(dataSourceObjects, currentUrlMapIndex));
             if (position != 0) {
                 JZMediaManager.seekTo(position);
             }

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -100,9 +100,7 @@ public void onAudioFocusChange(int focusChange) {
     protected static Timer UPDATE_PROGRESS_TIMER;
     public int currentState = -1;
     public int currentScreen = -1;
-    public boolean loop = false;
     public Map<String, String> headData;
-    //    public String url = "";
     public Object[] objects = null;
     public int seekToInAdvance = 0;
     public ImageView startButton;
@@ -114,7 +112,6 @@ public void onAudioFocusChange(int focusChange) {
     public int widthRatio = 0;
     public int heightRatio = 0;
     public Object[] dataSourceObjects;//这个参数原封不动直接通过JZMeidaManager传给JZMediaInterface。
-    // 取得当前url，取得urlmap，这个要从jzMediaManager中取得
     public int currentUrlMapIndex = 0;
     public int positionInList = -1;
     public int videoRotation = 0;

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZUtils.java
Patch:
@@ -110,7 +110,7 @@ public static int dip2px(Context context, float dpValue) {
         return (int) (dpValue * scale + 0.5f);
     }
 
-    public static void saveProgress(Context context, String url, int progress) {
+    public static void saveProgress(Context context, Object url, int progress) {
         if (!JZVideoPlayer.SAVE_PROGRESS) return;
         Log.i(TAG, "saveProgress: " + progress);
         if (progress < 6000) {
@@ -119,7 +119,7 @@ public static void saveProgress(Context context, String url, int progress) {
         SharedPreferences spn = context.getSharedPreferences("JZVD_PROGRESS",
                 Context.MODE_PRIVATE);
         SharedPreferences.Editor editor = spn.edit();
-        editor.putInt(url, progress);
+        editor.putInt(url.toString(), progress);
         editor.apply();
     }
 

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -348,7 +348,7 @@ public void setUp(Object[] dataSourceObjects, int defaultUrlMapIndex, int screen
                 e.printStackTrace();
             }
             if (position != 0) {
-                JZUtils.saveProgress(getContext(), JZMediaManager.getCurrentDataSource().toString(), position);
+                JZUtils.saveProgress(getContext(), JZMediaManager.getCurrentDataSource(), position);
             }
             JZMediaManager.instance().releaseMediaPlayer();
         } else if (isCurrentJZVD() && !JZUtils.dataSourceObjectsContainsUri(dataSourceObjects, JZMediaManager.getCurrentDataSource())) {
@@ -698,14 +698,14 @@ public void onAutoCompletion() {
             backPress();
         }
         JZMediaManager.instance().releaseMediaPlayer();
-        JZUtils.saveProgress(getContext(), JZUtils.getCurrentFromDataSource(dataSourceObjects, currentUrlMapIndex).toString(), 0);
+        JZUtils.saveProgress(getContext(), JZUtils.getCurrentFromDataSource(dataSourceObjects, currentUrlMapIndex), 0);
     }
 
     public void onCompletion() {
         Log.i(TAG, "onCompletion " + " [" + this.hashCode() + "] ");
         if (currentState == CURRENT_STATE_PLAYING || currentState == CURRENT_STATE_PAUSE) {
             int position = getCurrentPositionWhenPlaying();
-            JZUtils.saveProgress(getContext(), JZUtils.getCurrentFromDataSource(dataSourceObjects, currentUrlMapIndex).toString(), position);
+            JZUtils.saveProgress(getContext(), JZUtils.getCurrentFromDataSource(dataSourceObjects, currentUrlMapIndex), position);
         }
         cancelProgressTimer();
         onStateNormal();

File: app/src/main/java/cn/jzvd/demo/ActivityApi.java
Patch:
@@ -61,7 +61,9 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         map.put("高清", VideoConstant.videoUrls[0][9]);
         map.put("标清", VideoConstant.videoUrls[0][6]);
         map.put("普清", VideoConstant.videoUrlList[0]);
-        mJzVideoPlayerStandard.setUp(map, 2
+        Object[] objects = new Object[1];
+        objects[0] = map;
+        mJzVideoPlayerStandard.setUp(objects, 2
                 , JZVideoPlayerStandard.SCREEN_WINDOW_NORMAL, "饺子不信");
         Picasso.with(this)
                 .load(VideoConstant.videoThumbList[0])

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZUserAction.java
Patch:
@@ -24,6 +24,6 @@ public interface JZUserAction {
     int ON_TOUCH_SCREEN_SEEK_VOLUME = 11;
     int ON_TOUCH_SCREEN_SEEK_POSITION = 12;
 
-    void onEvent(int type, String url, int screen, Object... objects);
+    void onEvent(int type, Object url, int screen, Object... objects);
 
 }

File: app/src/main/java/cn/jzvd/demo/CustomMediaPlayer/JZMediaIjkplayer.java
Patch:
@@ -22,7 +22,7 @@ public class JZMediaIjkplayer extends JZMediaInterface implements IMediaPlayer.O
 
     @Override
     public void start() {
-
+        ijkMediaPlayer.start();
     }
 
     @Override

File: app/src/main/java/cn/jzvd/demo/ActivityListViewRecyclerView.java
Patch:
@@ -8,7 +8,7 @@
 import android.view.MenuItem;
 import android.view.View;
 
-import cn.jzvd.JZMediaManagerNew;
+import cn.jzvd.JZMediaManager;
 import cn.jzvd.JZVideoPlayer;
 
 /**
@@ -41,7 +41,7 @@ public void onChildViewAttachedToWindow(View view) {
             @Override
             public void onChildViewDetachedFromWindow(View view) {
                 JZVideoPlayer jzvd = view.findViewById(R.id.videoplayer);
-                if (jzvd != null && jzvd.getCurrentUrl().equals(JZMediaManagerNew.getCurrentDataSource())) {
+                if (jzvd != null && jzvd.getCurrentUrl().equals(JZMediaManager.getCurrentDataSource())) {
                     JZVideoPlayer.releaseAllVideos();
                 }
             }

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayerStandard.java
Patch:
@@ -261,7 +261,7 @@ public void onClick(View v) {
         super.onClick(v);
         int i = v.getId();
         if (i == R.id.thumb) {
-            if (dataSourceObjects == null || JZUtils.getCurrentFromDataSource(dataSourceObjects, currentUrlMapIndex) != null) {
+            if (dataSourceObjects == null || JZUtils.getCurrentFromDataSource(dataSourceObjects, currentUrlMapIndex) == null) {
                 Toast.makeText(getContext(), getResources().getString(R.string.no_url), Toast.LENGTH_SHORT).show();
                 return;
             }

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZMediaManager.java
Patch:
@@ -32,7 +32,7 @@ public class JZMediaManager implements TextureView.SurfaceTextureListener, Media
     public static boolean CURRENT_PLING_LOOP;
     public static Map<String, String> MAP_HEADER_DATA;
     private static JZMediaManager JZMediaManager;
-    public MediaPlayer mediaPlayer = new MediaPlayer();
+    public MediaPlayer mediaPlayer;
     public int currentVideoWidth = 0;
     public int currentVideoHeight = 0;
     HandlerThread mMediaHandlerThread;
@@ -203,7 +203,6 @@ public void handleMessage(Message msg) {
                     try {
                         currentVideoWidth = 0;
                         currentVideoHeight = 0;
-                        mediaPlayer.release();
                         mediaPlayer = new MediaPlayer();
                         mediaPlayer.setAudioStreamType(AudioManager.STREAM_MUSIC);
                         mediaPlayer.setLooping(CURRENT_PLING_LOOP);
@@ -232,7 +231,7 @@ public void handleMessage(Message msg) {
 //                    CURRENT_PLAYING_URL = null;
 //                    CURRENT_PLING_LOOP = false;
 //                    MAP_HEADER_DATA = null;
-                    mediaPlayer.release();
+                    if (mediaPlayer != null) mediaPlayer.release();
                     break;
             }
         }

File: app/src/main/java/cn/jzvd/demo/ActivityApi.java
Patch:
@@ -66,12 +66,12 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         Picasso.with(this)
                 .load(VideoConstant.videoThumbList[0])
                 .into(mJzVideoPlayerStandard.thumbImageView);
-//        mJzVideoPlayerStandard.loop = true;
+        //mJzVideoPlayerStandard.loop = true;
+        //JZVideoPlayer.SAVE_PROGRESS = false;
         mJzVideoPlayerStandard.headData = new HashMap<>();
         mJzVideoPlayerStandard.headData.put("key", "value");
 
 
-//        JZVideoPlayer.SAVE_PROGRESS = false;
         /** Play video in local path, eg:record by system camera **/
 //        cpAssertVideoToLocalPath();
 //        mJzVideoPlayerStandard.setUp(Environment.getExternalStorageDirectory().getAbsolutePath() + "/DCIM/Camera/local_video.mp4"

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZResizeTextureView.java
Patch:
@@ -131,8 +131,8 @@ protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
         if (parentWidth != 0 && parentHeight != 0 && videoWidth != 0 && videoHeight != 0) {
             if (JZVideoPlayer.VIDEO_IMAGE_DISPLAY_TYPE == JZVideoPlayer.VIDEO_IMAGE_DISPLAY_TYPE_ORIGINAL) {
                 /**原图**/
-                height = mVideoSize.y;
-                width = mVideoSize.x;
+                height = videoHeight;
+                width = videoWidth;
             } else if (JZVideoPlayer.VIDEO_IMAGE_DISPLAY_TYPE == JZVideoPlayer.VIDEO_IMAGE_DISPLAY_TYPE_FILL_SCROP) {
                 /**充满剪切**/
                 if (videoHeight / videoWidth > parentHeight / parentWidth) {

File: app/src/main/java/cn/jzvd/demo/ActivityApiRotationVideoSize.java
Patch:
@@ -39,7 +39,6 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
                 .load(VideoConstant.videoThumbs[0][7])
                 .into(myJZVideoPlayerStandard.thumbImageView);
         // The Point IS
-        //
         myJZVideoPlayerStandard.videoRotation = 180;
 
         mBtnRotation = findViewById(R.id.rotation_to_90);

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayerStandard.java
Patch:
@@ -552,19 +552,18 @@ public void changeUiToPauseShow() {
             case SCREEN_WINDOW_TINY:
                 break;
         }
-
     }
 
     public void changeUiToPauseClear() {
         switch (currentScreen) {
             case SCREEN_WINDOW_NORMAL:
             case SCREEN_WINDOW_LIST:
                 setAllControlsVisiblity(View.INVISIBLE, View.INVISIBLE, View.INVISIBLE,
-                        View.INVISIBLE, View.INVISIBLE, View.INVISIBLE);
+                        View.INVISIBLE, View.INVISIBLE, View.VISIBLE);
                 break;
             case SCREEN_WINDOW_FULLSCREEN:
                 setAllControlsVisiblity(View.INVISIBLE, View.INVISIBLE, View.INVISIBLE,
-                        View.INVISIBLE, View.INVISIBLE, View.INVISIBLE);
+                        View.INVISIBLE, View.INVISIBLE, View.VISIBLE);
                 break;
             case SCREEN_WINDOW_TINY:
                 break;

File: app/src/main/java/cn/jzvd/demo/ActivityTinyWindowListViewMultiHolder.java
Patch:
@@ -48,7 +48,7 @@ public void onScrollStateChanged(AbsListView view, int scrollState) {
 
             @Override
             public void onScroll(AbsListView view, int firstVisibleItem, int visibleItemCount, int totalItemCount) {
-                JZVideoPlayer.onScrollReleaseAllVideos(view, firstVisibleItem, visibleItemCount, totalItemCount);
+                JZVideoPlayer.onScrollAutoTiny(view, firstVisibleItem, visibleItemCount, totalItemCount);
             }
         });
     }

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -216,7 +216,7 @@ public static boolean backPress() {
         return false;
     }
 
-    public static void quitFullscreenOrTinyWindow(){
+    public static void quitFullscreenOrTinyWindow() {
         //直接退出全屏和小窗
         JZVideoPlayerManager.getFirstFloor().clearFloatScreen();
         JZMediaManager.instance().releaseMediaPlayer();
@@ -795,7 +795,7 @@ public void onVideoSizeChanged() {
     }
 
     public void startProgressTimer() {
-        Log.e(TAG, "startProgressTimer: ");
+        Log.i(TAG, "startProgressTimer: " + " [" + this.hashCode() + "] ");
         cancelProgressTimer();
         UPDATE_PROGRESS_TIMER = new Timer();
         mProgressTimerTask = new ProgressTimerTask();

File: app/src/main/java/cn/jzvd/demo/ActivityApi.java
Patch:
@@ -60,7 +60,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         map.put("标清", VideoConstant.videoUrls[0][6]);
         map.put("普清", VideoConstant.videoUrlList[0]);
         mJzVideoPlayerStandard.setUp(map, 2
-                , JZVideoPlayerStandard.SCREEN_LAYOUT_NORMAL, "饺子不信");
+                , JZVideoPlayerStandard.SCREEN_WINDOW_NORMAL, "饺子不信");
         Picasso.with(this)
                 .load(VideoConstant.videoThumbList[0])
                 .into(mJzVideoPlayerStandard.thumbImageView);
@@ -73,10 +73,10 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         /** Play video in local path, eg:record by system camera **/
 //        cpAssertVideoToLocalPath();
 //        mJzVideoPlayerStandard.setUp(Environment.getExternalStorageDirectory().getAbsolutePath() + "/DCIM/Camera/local_video.mp4"
-//                , JZVideoPlayerStandard.SCREEN_LAYOUT_NORMAL, "饺子不信");
+//                , JZVideoPlayerStandard.SCREEN_WINDOW_NORMAL, "饺子不信");
         /** Play video in assert, but not work now **/
 //        mJzVideoPlayerStandard.setUp("file:///android_asset/local_video.mp4"
-//                , JZVideoPlayerStandard.SCREEN_LAYOUT_NORMAL, "饺子不信");
+//                , JZVideoPlayerStandard.SCREEN_WINDOW_NORMAL, "饺子不信");
 
         /** ImageLoader **/
 //        ImageLoader.getInstance().displayImage(VideoConstant.videoThumbs[0][1],

File: app/src/main/java/cn/jzvd/demo/ActivityApiExtendsNormal.java
Patch:
@@ -20,7 +20,7 @@ protected void onCreate(Bundle savedInstanceState) {
         setContentView(R.layout.activity_extends_normal);
         JZVideoPlayerStandard jzVideoPlayerStandard = findViewById(R.id.videoplayer);
         jzVideoPlayerStandard.setUp(VideoConstant.videoUrlList[0]
-                , JZVideoPlayerStandard.SCREEN_LAYOUT_NORMAL, "饺子不信");
+                , JZVideoPlayerStandard.SCREEN_WINDOW_NORMAL, "饺子不信");
         Picasso.with(this)
                 .load(VideoConstant.videoThumbList[0])
                 .into(jzVideoPlayerStandard.thumbImageView);

File: app/src/main/java/cn/jzvd/demo/ActivityApiOrientation.java
Patch:
@@ -28,7 +28,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         setContentView(R.layout.activity_orientation);
         mJzVideoPlayerStandard = findViewById(R.id.jz_video);
         mJzVideoPlayerStandard.setUp(VideoConstant.videoUrlList[0]
-                , JZVideoPlayerStandard.SCREEN_LAYOUT_NORMAL, "饺子不信");
+                , JZVideoPlayerStandard.SCREEN_WINDOW_NORMAL, "饺子不信");
         Picasso.with(this)
                 .load(VideoConstant.videoThumbList[0])
                 .into(mJzVideoPlayerStandard.thumbImageView);

File: app/src/main/java/cn/jzvd/demo/ActivityListViewMultiHolder.java
Patch:
@@ -118,7 +118,7 @@ public View getView(int position, View convertView, ViewGroup parent) {
                 }
 
                 viewHolder.jzVideoPlayer.setUp(
-                        VideoConstant.videoUrls[0][position], JZVideoPlayer.SCREEN_LAYOUT_LIST,
+                        VideoConstant.videoUrls[0][position], JZVideoPlayer.SCREEN_WINDOW_LIST,
                         VideoConstant.videoTitles[0][position]);
                 viewHolder.jzVideoPlayer.positionInList = position;
                 Picasso.with(ActivityListViewMultiHolder.this)

File: app/src/main/java/cn/jzvd/demo/ActivityMain.java
Patch:
@@ -45,7 +45,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
 
         myJZVideoPlayerStandard = findViewById(R.id.jz_video);
         myJZVideoPlayerStandard.setUp("http://jzvd.nathen.cn/342a5f7ef6124a4a8faf00e738b8bee4/cf6d9db0bd4d41f59d09ea0a81e918fd-5287d2089db37e62345123a1be272f8b.mp4"
-                , JZVideoPlayerStandard.SCREEN_LAYOUT_NORMAL, "饺子快长大");
+                , JZVideoPlayerStandard.SCREEN_WINDOW_NORMAL, "饺子快长大");
         Picasso.with(this)
                 .load("http://jzvd-pic.nathen.cn/jzvd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png")
                 .into(myJZVideoPlayerStandard.thumbImageView);

File: app/src/main/java/cn/jzvd/demo/ActivityTinyWindow.java
Patch:
@@ -34,7 +34,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
 
         mJzVideoPlayerStandard = findViewById(R.id.jz_video);
         mJzVideoPlayerStandard.setUp("http://jzvd.nathen.cn/342a5f7ef6124a4a8faf00e738b8bee4/cf6d9db0bd4d41f59d09ea0a81e918fd-5287d2089db37e62345123a1be272f8b.mp4"
-                , JZVideoPlayerStandard.SCREEN_LAYOUT_NORMAL, "饺子快长大");
+                , JZVideoPlayerStandard.SCREEN_WINDOW_NORMAL, "饺子快长大");
         Picasso.with(this)
                 .load("http://jzvd-pic.nathen.cn/jzvd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png")
                 .into(mJzVideoPlayerStandard.thumbImageView);

File: app/src/main/java/cn/jzvd/demo/ActivityTinyWindowListViewMultiHolder.java
Patch:
@@ -119,7 +119,7 @@ public View getView(int position, View convertView, ViewGroup parent) {
                 }
 
                 viewHolder.jzVideoPlayer.setUp(
-                        VideoConstant.videoUrls[0][position], JZVideoPlayer.SCREEN_LAYOUT_LIST,
+                        VideoConstant.videoUrls[0][position], JZVideoPlayer.SCREEN_WINDOW_LIST,
                         VideoConstant.videoTitles[0][position]);
                 viewHolder.jzVideoPlayer.positionInList = position;
                 Picasso.with(ActivityTinyWindowListViewMultiHolder.this)

File: app/src/main/java/cn/jzvd/demo/ActivityWebView.java
Patch:
@@ -71,7 +71,7 @@ public void run() {
                     if (index == 0) {
                         JZVideoPlayerStandard webVieo = new JZVideoPlayerStandard(ActivityWebView.this);
                         webVieo.setUp(VideoConstant.videoUrlList[1],
-                                JZVideoPlayer.SCREEN_LAYOUT_LIST, "饺子骑大马");
+                                JZVideoPlayer.SCREEN_WINDOW_LIST, "饺子骑大马");
                         Picasso.with(ActivityWebView.this)
                                 .load(VideoConstant.videoThumbList[1])
                                 .into(webVieo.thumbImageView);
@@ -85,7 +85,7 @@ public void run() {
                     } else {
                         JZVideoPlayerStandard webVieo = new JZVideoPlayerStandard(ActivityWebView.this);
                         webVieo.setUp(VideoConstant.videoUrlList[2],
-                                JZVideoPlayer.SCREEN_LAYOUT_LIST, "饺子失态了");
+                                JZVideoPlayer.SCREEN_WINDOW_LIST, "饺子失态了");
                         Picasso.with(ActivityWebView.this)
                                 .load(VideoConstant.videoThumbList[2])
                                 .into(webVieo.thumbImageView);

File: app/src/main/java/cn/jzvd/demo/AdapterRecyclerViewVideo.java
Patch:
@@ -37,7 +37,7 @@ public void onBindViewHolder(MyViewHolder holder, int position) {
         Log.i(TAG, "onBindViewHolder [" + holder.jzVideoPlayer.hashCode() + "] position=" + position);
 
         holder.jzVideoPlayer.setUp(
-                VideoConstant.videoUrls[0][position], JZVideoPlayer.SCREEN_LAYOUT_LIST,
+                VideoConstant.videoUrls[0][position], JZVideoPlayer.SCREEN_WINDOW_LIST,
                 VideoConstant.videoTitles[0][position]);
         Picasso.with(holder.jzVideoPlayer.getContext())
                 .load(VideoConstant.videoThumbs[0][position])

File: app/src/main/java/cn/jzvd/demo/AdapterVideoList.java
Patch:
@@ -61,7 +61,7 @@ public View getView(int position, View convertView, ViewGroup parent) {
         }
         viewHolder.jzVideoPlayer = convertView.findViewById(R.id.videoplayer);
         viewHolder.jzVideoPlayer.setUp(
-                videoUrls[position], JZVideoPlayer.SCREEN_LAYOUT_LIST,
+                videoUrls[position], JZVideoPlayer.SCREEN_WINDOW_LIST,
                 videoTitles[position]);
         Picasso.with(convertView.getContext())
                 .load(videoThumbs[position])

File: app/src/main/java/cn/jzvd/demo/FragmentDemo.java
Patch:
@@ -45,7 +45,7 @@ public void onScrollStateChanged(AbsListView view, int scrollState) {
 
             @Override
             public void onScroll(AbsListView view, int firstVisibleItem, int visibleItemCount, int totalItemCount) {
-                JZVideoPlayer.onScrollAutoTiny(view, firstVisibleItem, visibleItemCount, totalItemCount);
+                JZVideoPlayer.onScrollReleaseAllVideos(view, firstVisibleItem, visibleItemCount, totalItemCount);
             }
         });
         return listView;

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -924,7 +924,8 @@ public void startWindowFullscreen() {
     public void startWindowTiny() {
         Log.i(TAG, "startWindowTiny " + " [" + this.hashCode() + "] ");
         onEvent(JZUserAction.ON_ENTER_TINYSCREEN);
-        if (currentState == CURRENT_STATE_NORMAL || currentState == CURRENT_STATE_ERROR) return;
+        if (currentState == CURRENT_STATE_NORMAL || currentState == CURRENT_STATE_ERROR || currentState == CURRENT_STATE_AUTO_COMPLETE)
+            return;
         ViewGroup vp = (JZUtils.scanForActivity(getContext()))//.getWindow().getDecorView();
                 .findViewById(Window.ID_ANDROID_CONTENT);
         View old = vp.findViewById(R.id.jz_tiny_id);

File: app/src/main/java/cn/jzvd/demo/MainActivity.java
Patch:
@@ -71,7 +71,7 @@ public void onBackPressed() {
     public void onClick(View v) {
         switch (v.getId()) {
             case R.id.tiny_window:
-                myJZVideoPlayerStandard.startWindowTiny();
+                startActivity(new Intent(MainActivity.this, TinyWindowActivity.class));
                 break;
             case R.id.direct_fullscreen:
                 startActivity(new Intent(MainActivity.this, DirectFullscreenActivity.class));

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayerStandard.java
Patch:
@@ -264,7 +264,7 @@ public void onClick(View v) {
         super.onClick(v);
         int i = v.getId();
         if (i == R.id.thumb) {
-            if (TextUtils.isEmpty(JZUtils.getCurrentUrlFromMap(urlMap, currentUrlMapIndex))) {
+            if (urlMap == null || TextUtils.isEmpty(JZUtils.getCurrentUrlFromMap(urlMap, currentUrlMapIndex))) {
                 Toast.makeText(getContext(), getResources().getString(R.string.no_url), Toast.LENGTH_SHORT).show();
                 return;
             }

File: app/src/main/java/cn/jzvd/demo/CustomView/JZVideoPlayerStandardAutoCompleteAfterFullscreen.java
Patch:
@@ -25,7 +25,6 @@ public JZVideoPlayerStandardAutoCompleteAfterFullscreen(Context context, Attribu
 
     @Override
     public void startVideo() {
-//        super.startVideo();
         if (currentScreen == SCREEN_WINDOW_FULLSCREEN) {
             Log.d(TAG, "startVideo [" + this.hashCode() + "] ");
             initTextureView();

File: app/src/main/java/cn/jzvd/demo/CustomView/JZVideoPlayerStandardShowShareButtonAfterFullscreen.java
Patch:
@@ -28,7 +28,7 @@ public JZVideoPlayerStandardShowShareButtonAfterFullscreen(Context context, Attr
     @Override
     public void init(Context context) {
         super.init(context);
-        shareButton = (ImageView) findViewById(R.id.share);
+        shareButton = findViewById(R.id.share);
         shareButton.setOnClickListener(this);
 
     }

File: app/src/main/java/cn/jzvd/demo/DirectFullscreenActivity.java
Patch:
@@ -28,8 +28,8 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         getSupportActionBar().setTitle("PlayDirectlyWithoutLayout");
         setContentView(R.layout.activity_directly_play);
 
-        mStartFullscreen = (Button) findViewById(R.id.fullscreen);
-        mStartTiny = (Button) findViewById(R.id.tiny_window);
+        mStartFullscreen = findViewById(R.id.fullscreen);
+        mStartTiny = findViewById(R.id.tiny_window);
 
         mStartFullscreen.setOnClickListener(this);
         mStartTiny.setOnClickListener(this);

File: app/src/main/java/cn/jzvd/demo/ListViewFragmentViewPagerActivity.java
Patch:
@@ -35,7 +35,7 @@ protected void onCreate(Bundle savedInstanceState) {
         fragmentList.add(new DemoFragment().setIndex(2));
 
         MyAdapter myAdapter = new MyAdapter(getSupportFragmentManager());
-        ViewPager viewPager = (ViewPager) findViewById(R.id.viewPager);
+        ViewPager viewPager = findViewById(R.id.viewPager);
         viewPager.setAdapter(myAdapter);
         viewPager.setOnPageChangeListener(this);
     }

File: app/src/main/java/cn/jzvd/demo/ListViewMultiHolderActivity.java
Patch:
@@ -36,7 +36,7 @@ protected void onCreate(Bundle savedInstanceState) {
         getSupportActionBar().setTitle("MultiHolderListView");
 
 
-        listView = (ListView) findViewById(R.id.listview);
+        listView = findViewById(R.id.listview);
         mAdapter = new VideoListAdapter(this);
         listView.setAdapter(mAdapter);
 
@@ -113,7 +113,7 @@ public View getView(int position, View convertView, ViewGroup parent) {
                 } else {
                     viewHolder = new VideoHolder();
                     convertView = mInflater.inflate(R.layout.item_videoview, null);
-                    viewHolder.jzVideoPlayer = (JZVideoPlayerStandard) convertView.findViewById(R.id.videoplayer);
+                    viewHolder.jzVideoPlayer = convertView.findViewById(R.id.videoplayer);
                     convertView.setTag(viewHolder);
                 }
 
@@ -132,7 +132,7 @@ public View getView(int position, View convertView, ViewGroup parent) {
                     textViewHolder = new TextViewHolder();
                     LayoutInflater mInflater = LayoutInflater.from(context);
                     convertView = mInflater.inflate(R.layout.item_textview, null);
-                    textViewHolder.textView = (TextView) convertView.findViewById(R.id.textview);
+                    textViewHolder.textView = convertView.findViewById(R.id.textview);
                     convertView.setTag(textViewHolder);
                 }
             }

File: app/src/main/java/cn/jzvd/demo/ListViewNormalActivity.java
Patch:
@@ -33,7 +33,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         getSupportActionBar().setTitle("NormalListView");
         setContentView(R.layout.activity_listview_normal);
 
-        listView = (ListView) findViewById(R.id.listview);
+        listView = findViewById(R.id.listview);
         listView.setAdapter(new VideoListAdapter(this,
                 VideoConstant.videoUrls[0],
                 VideoConstant.videoTitles[0],

File: app/src/main/java/cn/jzvd/demo/ListViewNormalAutoTinyActivity.java
Patch:
@@ -30,7 +30,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         getSupportActionBar().setTitle("NormalListViewAutoTiny");
         setContentView(R.layout.activity_listview_normal_auto_tiny);
 
-        listView = (ListView) findViewById(R.id.listview);
+        listView = findViewById(R.id.listview);
         listView.setAdapter(new VideoListAdapter(this,
                 VideoConstant.videoUrls[0],
                 VideoConstant.videoTitles[0],

File: app/src/main/java/cn/jzvd/demo/OrientationActivity.java
Patch:
@@ -26,7 +26,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         getSupportActionBar().setDisplayUseLogoEnabled(false);
         getSupportActionBar().setTitle("Orientation");
         setContentView(R.layout.activity_orientation);
-        mJzVideoPlayerStandard = (JZVideoPlayerStandard) findViewById(R.id.jz_video);
+        mJzVideoPlayerStandard = findViewById(R.id.jz_video);
         mJzVideoPlayerStandard.setUp(VideoConstant.videoUrlList[0]
                 , JZVideoPlayerStandard.SCREEN_LAYOUT_NORMAL, "饺子不信");
         Picasso.with(this)

File: app/src/main/java/cn/jzvd/demo/RecyclerViewNormalActivity.java
Patch:
@@ -33,7 +33,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         getSupportActionBar().setTitle("NormalRecyclerView");
         setContentView(R.layout.activity_recyclerview_content);
 
-        recyclerView = (RecyclerView) findViewById(R.id.recyclerview);
+        recyclerView = findViewById(R.id.recyclerview);
         recyclerView.setLayoutManager(new LinearLayoutManager(this));
 
         adapterVideoList = new RecyclerViewVideoAdapter(this);

File: app/src/main/java/cn/jzvd/demo/RecyclerViewVideoAdapter.java
Patch:
@@ -54,7 +54,7 @@ class MyViewHolder extends RecyclerView.ViewHolder {
 
         public MyViewHolder(View itemView) {
             super(itemView);
-            jzVideoPlayer = (JZVideoPlayerStandard) itemView.findViewById(R.id.videoplayer);
+            jzVideoPlayer = itemView.findViewById(R.id.videoplayer);
         }
     }
 

File: app/src/main/java/cn/jzvd/demo/VideoListAdapter.java
Patch:
@@ -59,7 +59,7 @@ public View getView(int position, View convertView, ViewGroup parent) {
         } else {
             viewHolder = (ViewHolder) convertView.getTag();
         }
-        viewHolder.jzVideoPlayer = (JZVideoPlayerStandard) convertView.findViewById(R.id.videoplayer);
+        viewHolder.jzVideoPlayer = convertView.findViewById(R.id.videoplayer);
         viewHolder.jzVideoPlayer.setUp(
                 videoUrls[position], JZVideoPlayer.SCREEN_LAYOUT_LIST,
                 videoTitles[position]);

File: app/src/main/java/cn/jzvd/demo/WebViewActivity.java
Patch:
@@ -31,7 +31,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         getSupportActionBar().setDisplayUseLogoEnabled(false);
         getSupportActionBar().setTitle("WebView");
         setContentView(R.layout.activity_webview);
-        mWebView = (WebView) findViewById(R.id.webview);
+        mWebView = findViewById(R.id.webview);
         mWebView.getSettings().setJavaScriptEnabled(true);
         mWebView.addJavascriptInterface(new JZCallBack(), "jzvd");
         mWebView.loadUrl("file:///android_asset/jzvd.html");

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -903,6 +903,8 @@ public void startWindowFullscreen() {
             FrameLayout.LayoutParams lp = new FrameLayout.LayoutParams(
                     ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);
             vp.addView(jzVideoPlayer, lp);
+            jzVideoPlayer.setSystemUiVisibility(View.SYSTEM_UI_FLAG_HIDE_NAVIGATION
+                    | View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY | View.SYSTEM_UI_FLAG_FULLSCREEN);
             jzVideoPlayer.setUp(urlMap, currentUrlMapIndex, JZVideoPlayerStandard.SCREEN_WINDOW_FULLSCREEN, objects);
             jzVideoPlayer.setState(currentState);
             jzVideoPlayer.addTextureView();

File: app/src/main/java/cn/jzvd/demo/ListViewActivity.java
Patch:
@@ -48,7 +48,7 @@ public void onClick(View v) {
                 startActivity(new Intent(ListViewActivity.this, ListViewNormalAutoTinyActivity.class));
                 break;
             case R.id.listview_fragment_viewpager:
-                startActivity(new Intent(ListViewActivity.this, ListViewFragmentViewpagerActivity.class));
+                startActivity(new Intent(ListViewActivity.this, ListViewFragmentViewPagerActivity.class));
                 break;
             case R.id.multiholder:
                 startActivity(new Intent(ListViewActivity.this, ListViewMultiHolderActivity.class));

File: app/src/main/java/cn/jzvd/demo/ListViewFragmentViewPagerActivity.java
Patch:
@@ -17,7 +17,7 @@
  * Created by Nathen
  * On 2016/02/07 01:01
  */
-public class ListViewFragmentViewpagerActivity extends AppCompatActivity implements ViewPager.OnPageChangeListener {
+public class ListViewFragmentViewPagerActivity extends AppCompatActivity implements ViewPager.OnPageChangeListener {
     List<DemoFragment> fragmentList = new ArrayList<>();
 
     @Override
@@ -28,7 +28,7 @@ protected void onCreate(Bundle savedInstanceState) {
         getSupportActionBar().setDisplayShowHomeEnabled(true);
         getSupportActionBar().setDisplayShowTitleEnabled(true);
         getSupportActionBar().setDisplayUseLogoEnabled(false);
-        getSupportActionBar().setTitle("ViewPagerAndListView");
+        getSupportActionBar().setTitle("ListViewFragmentViewPagerActivity");
 
         fragmentList.add(new DemoFragment().setIndex(0));
         fragmentList.add(new DemoFragment().setIndex(1));

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayerStandard.java
Patch:
@@ -192,7 +192,7 @@ public void onStateNormal() {
     public void onStatePreparing() {
         super.onStatePreparing();
         changeUiToPreparing();
-        startDismissControlViewTimer();
+//        startDismissControlViewTimer();
     }
 
     @Override
@@ -491,11 +491,11 @@ public void changeUiToPreparing() {
         switch (currentScreen) {
             case SCREEN_LAYOUT_NORMAL:
             case SCREEN_LAYOUT_LIST:
-                setAllControlsVisiblity(View.VISIBLE, View.INVISIBLE, View.INVISIBLE,
+                setAllControlsVisiblity(View.INVISIBLE, View.INVISIBLE, View.INVISIBLE,
                         View.VISIBLE, View.VISIBLE, View.INVISIBLE);
                 break;
             case SCREEN_WINDOW_FULLSCREEN:
-                setAllControlsVisiblity(View.VISIBLE, View.INVISIBLE, View.INVISIBLE,
+                setAllControlsVisiblity(View.INVISIBLE, View.INVISIBLE, View.INVISIBLE,
                         View.VISIBLE, View.VISIBLE, View.INVISIBLE);
                 break;
             case SCREEN_WINDOW_TINY:

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -698,7 +698,7 @@ public void onAutoCompletion() {
         cancelProgressTimer();
         onStateAutoComplete();
 
-        if (currentScreen == SCREEN_WINDOW_FULLSCREEN) {
+        if (currentScreen == SCREEN_WINDOW_FULLSCREEN || currentScreen == SCREEN_WINDOW_TINY) {
             backPress();
         }
         JZMediaManager.instance().mediaPlayer.release();

File: app/src/main/java/cn/jzvd/demo/ApiActivity.java
Patch:
@@ -42,7 +42,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         getSupportActionBar().setDisplayShowHomeEnabled(true);
         getSupportActionBar().setDisplayShowTitleEnabled(true);
         getSupportActionBar().setDisplayUseLogoEnabled(false);
-        getSupportActionBar().setTitle("About Api");
+        getSupportActionBar().setTitle("Api");
         setContentView(R.layout.activity_api);
 
         mSmallChange = (Button) findViewById(R.id.small_change);

File: app/src/main/java/cn/jzvd/demo/ListViewActivity.java
Patch:
@@ -23,7 +23,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         getSupportActionBar().setDisplayShowHomeEnabled(true);
         getSupportActionBar().setDisplayShowTitleEnabled(true);
         getSupportActionBar().setDisplayUseLogoEnabled(false);
-        getSupportActionBar().setTitle("About ListView");
+        getSupportActionBar().setTitle("ListView");
         setContentView(R.layout.activity_listview);
 
         mNormalList = (Button) findViewById(R.id.normal_list);

File: app/src/main/java/cn/jzvd/demo/WebViewActivity.java
Patch:
@@ -29,7 +29,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         getSupportActionBar().setDisplayShowHomeEnabled(true);
         getSupportActionBar().setDisplayShowTitleEnabled(true);
         getSupportActionBar().setDisplayUseLogoEnabled(false);
-        getSupportActionBar().setTitle("AboutWebView");
+        getSupportActionBar().setTitle("WebView");
         setContentView(R.layout.activity_webview);
         mWebView = (WebView) findViewById(R.id.webview);
         mWebView.getSettings().setJavaScriptEnabled(true);

File: app/src/main/java/cn/jzvd/demo/DirectFullscreenActivity.java
Patch:
@@ -14,7 +14,7 @@
 /**
  * Created by Nathen on 16/7/31.
  */
-public class PlayDirectlyActivity extends AppCompatActivity implements View.OnClickListener {
+public class DirectFullscreenActivity extends AppCompatActivity implements View.OnClickListener {
     Button mStartFullscreen, mStartTiny;
 
     @Override
@@ -43,7 +43,7 @@ public void onClick(View v) {
                 JZVideoPlayerStandard.startFullscreen(this, JZVideoPlayerStandard.class, VideoConstant.videoUrlList[6], "饺子辛苦了");
                 break;
             case R.id.tiny_window:
-                Toast.makeText(PlayDirectlyActivity.this, "Comming Soon", Toast.LENGTH_SHORT).show();
+                Toast.makeText(DirectFullscreenActivity.this, "Comming Soon", Toast.LENGTH_SHORT).show();
                 break;
         }
     }

File: app/src/main/java/cn/jzvd/demo/ListViewNormalActivity.java
Patch:
@@ -52,7 +52,7 @@ public void onScroll(AbsListView view, int firstVisibleItem, int visibleItemCoun
                 int lastVisibleItem = firstVisibleItem + visibleItemCount;
                 int currentPlayPosition = JZMediaManager.instance().positionInList;
                 if (currentPlayPosition >= 0) {
-                    if ((currentPlayPosition < firstVisibleItem || currentPlayPosition > lastVisibleItem)) {
+                    if ((currentPlayPosition < firstVisibleItem || currentPlayPosition > (lastVisibleItem - 1))) {
                         //划出屏幕
                         //要么release 要么进入小窗
 //                        JZVideoPlayer.releaseAllVideos();

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -121,8 +121,8 @@ public void onAudioFocusChange(int focusChange) {
     protected int mGestureDownVolume;
     protected float mGestureDownBrightness;
     protected int mSeekTimePosition;
-    LinkedHashMap urlMap;
-    int currentUrlMapIndex = 0;
+    protected LinkedHashMap urlMap;
+    protected int currentUrlMapIndex = 0;
 
     public JZVideoPlayer(Context context) {
         super(context);

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -327,7 +327,7 @@ public void onClick(View v) {
                 if (!JZUtils.getCurrentUrlFromMap(urlMap, currentUrlMapIndex).startsWith("file") && !
                         JZUtils.getCurrentUrlFromMap(urlMap, currentUrlMapIndex).startsWith("/") &&
                         !JZUtils.isWifiConnected(getContext()) && !WIFI_TIP_DIALOG_SHOWED) {
-                    showWifiDialog(JZUserActionStandard.ON_CLICK_START_ICON);
+                    showWifiDialog(JZUserAction.ON_CLICK_START_ICON);
                     return;
                 }
                 startVideo();

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayerStandard.java
Patch:
@@ -121,7 +121,6 @@ public void init(Context context) {
         tinyBackImageView.setOnClickListener(this);
         clarity.setOnClickListener(this);
 
-        setSystemTimeAndBattery();
     }
 
     public void setUp(LinkedHashMap urlMap, int defaultUrlMapIndex, int screen, Object... objects) {
@@ -155,7 +154,7 @@ public void setUp(LinkedHashMap urlMap, int defaultUrlMapIndex, int screen, Obje
             batteryTimeLayout.setVisibility(View.GONE);
             clarity.setVisibility(View.GONE);
         }
-
+        setSystemTimeAndBattery();
     }
 
     public void changeStartButtonSize(int size) {

File: app/src/main/java/cn/jzvd/demo/ApiActivity.java
Patch:
@@ -70,7 +70,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         Picasso.with(this)
                 .load(VideoConstant.videoThumbList[0])
                 .into(mJzVideoPlayerStandard.thumbImageView);
-        mJzVideoPlayerStandard.loop = true;
+//        mJzVideoPlayerStandard.loop = true;
         mJzVideoPlayerStandard.headData = new HashMap<>();
         mJzVideoPlayerStandard.headData.put("key", "value");
 

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayerStandard.java
Patch:
@@ -121,6 +121,7 @@ public void init(Context context) {
         tinyBackImageView.setOnClickListener(this);
         clarity.setOnClickListener(this);
 
+        setSystemTimeAndBattery();
     }
 
     public void setUp(LinkedHashMap urlMap, int defaultUrlMapIndex, int screen, Object... objects) {
@@ -154,7 +155,6 @@ public void setUp(LinkedHashMap urlMap, int defaultUrlMapIndex, int screen, Obje
             batteryTimeLayout.setVisibility(View.GONE);
             clarity.setVisibility(View.GONE);
         }
-        setSystemTimeAndBattery();
 
     }
 

File: app/src/main/java/cn/jzvd/demo/CustomView/JZVideoPlayerStandardFresco.java
Patch:
@@ -59,7 +59,7 @@ public void setUp(String url, int screen, Object... objects) {
             tinyBackImageView.setVisibility(View.INVISIBLE);
         } else if (currentScreen == SCREEN_WINDOW_TINY) {
             tinyBackImageView.setVisibility(View.VISIBLE);
-            setAllControlsVisible(View.INVISIBLE, View.INVISIBLE, View.INVISIBLE,
+            setAllControlsVisiblity(View.INVISIBLE, View.INVISIBLE, View.INVISIBLE,
                     View.INVISIBLE, View.INVISIBLE, View.INVISIBLE, View.INVISIBLE);
         }
     }

File: app/src/main/java/cn/jzvd/demo/MainActivity.java
Patch:
@@ -46,7 +46,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         mAboutWebView.setOnClickListener(this);
 
         myJZVideoPlayerStandard = (MyJZVideoPlayerStandard) findViewById(R.id.jz_video);
-        myJZVideoPlayerStandard.setUp("http://jzvd.nathen.cn/342a5f7ef6124a4a8faf00e738b8bee4/cf6d9db0bd4d41f59d09ea0a81e918fd-5287d2089db37e62345123a1be272f8b.mp4"
+        myJZVideoPlayerStandard.setUp("http://115.29.103.172:8080/videos/hello.mp3"
                 , JZVideoPlayerStandard.SCREEN_LAYOUT_NORMAL, "嫂子快长大");
         Picasso.with(this)
                 .load("http://jzvd-pic.nathen.cn/jzvd-pic/1bb2ebbe-140d-4e2e-abd2-9e7e564f71ac.png")

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -903,6 +903,7 @@ public void startWindowFullscreen() {
 //            final Animation ra = AnimationUtils.loadAnimation(getContext(), R.anim.start_fullscreen);
 //            jzVideoPlayer.setAnimation(ra);
             onStateNormal();
+            jzVideoPlayer.progressBar.setSecondaryProgress(progressBar.getSecondaryProgress());
             jzVideoPlayer.startProgressTimer();
             CLICK_QUIT_FULLSCREEN_TIME = System.currentTimeMillis();
         } catch (Exception e) {

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZUtils.java
Patch:
@@ -9,6 +9,7 @@
 import android.support.v7.app.AppCompatActivity;
 import android.support.v7.view.ContextThemeWrapper;
 import android.text.TextUtils;
+import android.util.Log;
 
 import java.util.Formatter;
 import java.util.Iterator;
@@ -20,6 +21,7 @@
  * On 2016/02/21 12:25
  */
 public class JZUtils {
+    public static final String TAG = "JiaoZiVideoPlayer";
 
     public static String stringForTime(int timeMs) {
         if (timeMs <= 0 || timeMs >= 24 * 60 * 60 * 1000) {
@@ -91,6 +93,7 @@ public static int dip2px(Context context, float dpValue) {
 
     public static void saveProgress(Context context, String url, int progress) {
         if (!JZVideoPlayer.SAVE_PROGRESS) return;
+        Log.i(TAG, "saveProgress: " + progress);
         SharedPreferences spn = context.getSharedPreferences("JZVD_PROGRESS",
                 Context.MODE_PRIVATE);
         SharedPreferences.Editor editor = spn.edit();

File: jiaozivideoplayer/src/main/java/cn/jzvd/JZVideoPlayer.java
Patch:
@@ -677,6 +677,7 @@ public void onAutoCompletion() {
         if (currentScreen == SCREEN_WINDOW_FULLSCREEN) {
             backPress();
         }
+        JZMediaManager.instance().mediaPlayer.release();
         JZUtils.saveProgress(getContext(), JZUtils.getCurrentUrlFromMap(urlMap, currentUrlMapIndex), 0);
     }
 

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -300,7 +300,7 @@ public void onClick(View v) {
         int i = v.getId();
         if (i == R.id.start) {
             Log.i(TAG, "onClick start [" + this.hashCode() + "] ");
-            if (TextUtils.isEmpty(JCUtils.getCurrentUrlFromMap(urlMap, currentUrlMapIndex))) {
+            if (urlMap == null || TextUtils.isEmpty(JCUtils.getCurrentUrlFromMap(urlMap, currentUrlMapIndex))) {
                 Toast.makeText(getContext(), getResources().getString(R.string.no_url), Toast.LENGTH_SHORT).show();
                 return;
             }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -782,6 +782,7 @@ public void startWindowFullscreen() {
 //            final Animation ra = AnimationUtils.loadAnimation(getContext(), R.anim.start_fullscreen);
 //            jcVideoPlayer.setAnimation(ra);
             onStateNormal();
+            jcVideoPlayer.startProgressTimer();
             CLICK_QUIT_FULLSCREEN_TIME = System.currentTimeMillis();
         } catch (Exception e) {
             e.printStackTrace();

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -482,7 +482,7 @@ public void onInfo(int what, int extra) {
                 BACKUP_PLAYING_BUFFERING_STATE = -1;
             }
             Log.d(TAG, "MEDIA_INFO_BUFFERING_END");
-        }else if (what == MediaPlayer.MEDIA_INFO_VIDEO_RENDERING_START){
+        } else if (what == MediaPlayer.MEDIA_INFO_VIDEO_RENDERING_START) {
             onVideoRendingStart();
         }
     }
@@ -871,6 +871,7 @@ public void playOnThisJcvd() {
         Log.i(TAG, "playOnThisJcvd " + " [" + this.hashCode() + "] ");
         //1.清空全屏和小窗的jcvd
         currentState = JCVideoPlayerManager.getSecondFloor().currentState;
+        currentUrlMapIndex = JCVideoPlayerManager.getSecondFloor().currentUrlMapIndex;
         clearFloatScreen();
         //2.在本jcvd上播放
         setState(currentState);

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerStandard.java
Patch:
@@ -695,7 +695,7 @@ public void changeUiToError() {
     public void setAllControlsVisible(int topCon, int bottomCon, int startBtn, int loadingPro,
                                       int thumbImg, int coverImg, int bottomPro) {
         //TODO 这个地方由于前边的各种状态不是太明白，所以暂时只能这样写一下（目前没发现问题），作者可以优化一下
-        if (!isVideoRendingStart) {
+        if (!isVideoRendingStart && currentScreen != SCREEN_WINDOW_FULLSCREEN && currentScreen != SCREEN_WINDOW_TINY) {
             //只要没开始播放，一直显示缩略图
             thumbImg = VISIBLE;
         }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerStandard.java
Patch:
@@ -695,7 +695,7 @@ public void changeUiToError() {
     public void setAllControlsVisible(int topCon, int bottomCon, int startBtn, int loadingPro,
                                       int thumbImg, int coverImg, int bottomPro) {
         //TODO 这个地方由于前边的各种状态不是太明白，所以暂时只能这样写一下（目前没发现问题），作者可以优化一下
-        if (!isVideoRendingStart && currentScreen != SCREEN_WINDOW_FULLSCREEN && currentScreen != SCREEN_WINDOW_TINY) {
+        if (!isVideoRendingStart) {
             //只要没开始播放，一直显示缩略图
             thumbImg = VISIBLE;
         }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCMediaManager.java
Patch:
@@ -78,9 +78,6 @@ public void handleMessage(Message msg) {
                         mediaPlayer.release();
                         mediaPlayer = new MediaPlayer();
                         mediaPlayer.setAudioStreamType(AudioManager.STREAM_MUSIC);
-                        Class<MediaPlayer> clazz = MediaPlayer.class;
-                        Method method = clazz.getDeclaredMethod("setDataSource", String.class, Map.class);
-                        method.invoke(mediaPlayer, CURRENT_PLAYING_URL, MAP_HEADER_DATA);
                         mediaPlayer.setLooping(CURRENT_PLING_LOOP);
                         mediaPlayer.setOnPreparedListener(JCMediaManager.this);
                         mediaPlayer.setOnCompletionListener(JCMediaManager.this);
@@ -90,6 +87,9 @@ public void handleMessage(Message msg) {
                         mediaPlayer.setOnErrorListener(JCMediaManager.this);
                         mediaPlayer.setOnInfoListener(JCMediaManager.this);
                         mediaPlayer.setOnVideoSizeChangedListener(JCMediaManager.this);
+                        Class<MediaPlayer> clazz = MediaPlayer.class;
+                        Method method = clazz.getDeclaredMethod("setDataSource", String.class, Map.class);
+                        method.invoke(mediaPlayer, CURRENT_PLAYING_URL, MAP_HEADER_DATA);
                         mediaPlayer.prepareAsync();
                         mediaPlayer.setSurface(new Surface(savedSurfaceTexture));
                     } catch (Exception e) {

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -757,7 +757,6 @@ public void startWindowFullscreen() {
         if (old != null) {
             vp.removeView(old);
         }
-//        ((ViewGroup)JCMediaManager.textureView.getParent()).removeView(JCMediaManager.textureView);
         textureViewContainer.removeView(JCMediaManager.textureView);
         try {
             Constructor<JCVideoPlayer> constructor = (Constructor<JCVideoPlayer>) JCVideoPlayer.this.getClass().getConstructor(Context.class);
@@ -772,6 +771,7 @@ public void startWindowFullscreen() {
             JCVideoPlayerManager.setSecondFloor(jcVideoPlayer);
 //            final Animation ra = AnimationUtils.loadAnimation(getContext(), R.anim.start_fullscreen);
 //            jcVideoPlayer.setAnimation(ra);
+            onStateNormal();
             CLICK_QUIT_FULLSCREEN_TIME = System.currentTimeMillis();
         } catch (Exception e) {
             e.printStackTrace();
@@ -801,6 +801,7 @@ public void startWindowTiny() {
             jcVideoPlayer.setState(currentState);
             jcVideoPlayer.addTextureView();
             JCVideoPlayerManager.setSecondFloor(jcVideoPlayer);
+            onStateNormal();
         } catch (InstantiationException e) {
             e.printStackTrace();
         } catch (Exception e) {

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/VideoConstant.java
Patch:
@@ -73,7 +73,7 @@ public class VideoConstant {
                             "嫂子别笑",
                             "嫂子坐火车",
                             "嫂子打游戏",
-                            "嫂子还小"
+                            "嫂子快长大"
                     },
                     {
                             "嫂子堵车了",

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/ListViewViewpagerActivity.java
Patch:
@@ -4,12 +4,9 @@
 import android.support.v4.app.Fragment;
 import android.support.v4.app.FragmentManager;
 import android.support.v4.app.FragmentPagerAdapter;
-import android.support.v4.view.PagerAdapter;
 import android.support.v4.view.ViewPager;
 import android.support.v7.app.AppCompatActivity;
 import android.view.MenuItem;
-import android.view.View;
-import android.widget.ListView;
 
 import java.util.ArrayList;
 import java.util.List;

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -1,8 +1,6 @@
 package fm.jiecao.jcvideoplayer_lib;
 
-import android.content.BroadcastReceiver;
 import android.content.Context;
-import android.content.Intent;
 import android.content.pm.ActivityInfo;
 import android.hardware.Sensor;
 import android.hardware.SensorEvent;

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerStandard.java
Patch:
@@ -97,12 +97,12 @@ public void setUp(String url, int screen, Object... objects) {
             backButton.setVisibility(View.GONE);
             tinyBackImageView.setVisibility(View.INVISIBLE);
             changeStartButtonSize((int) getResources().getDimension(R.dimen.jc_start_button_w_h_normal));
-            batteryTimeLayout.setVisibility(View.INVISIBLE);
+            batteryTimeLayout.setVisibility(View.GONE);
         } else if (currentScreen == SCREEN_WINDOW_TINY) {
             tinyBackImageView.setVisibility(View.VISIBLE);
             setAllControlsVisible(View.INVISIBLE, View.INVISIBLE, View.INVISIBLE,
                     View.INVISIBLE, View.INVISIBLE, View.INVISIBLE, View.INVISIBLE);
-            batteryTimeLayout.setVisibility(View.INVISIBLE);
+            batteryTimeLayout.setVisibility(View.GONE);
         }
         setSystemTimeAndBattery();
     }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerStandard.java
Patch:
@@ -648,7 +648,7 @@ public void updateStartImage() {
             startButton.setImageResource(R.drawable.jc_click_error_selector);
             retryTextView.setVisibility(INVISIBLE);
         } else if (currentState == CURRENT_STATE_AUTO_COMPLETE) {
-            startButton.setImageResource(R.drawable.jc_click_restart_selector);
+            startButton.setImageResource(R.drawable.jc_click_replay_selector);
             retryTextView.setVisibility(VISIBLE);
         } else {
             startButton.setImageResource(R.drawable.jc_click_play_selector);

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerStandard.java
Patch:
@@ -595,12 +595,12 @@ public void changeUiToCompleteClear() {
             case SCREEN_LAYOUT_NORMAL:
             case SCREEN_LAYOUT_LIST:
                 setAllControlsVisible(View.VISIBLE, View.INVISIBLE, View.VISIBLE,
-                        View.INVISIBLE, View.VISIBLE, View.INVISIBLE, View.VISIBLE);
+                        View.INVISIBLE, View.VISIBLE, View.INVISIBLE, View.INVISIBLE);
                 updateStartImage();
                 break;
             case SCREEN_WINDOW_FULLSCREEN:
                 setAllControlsVisible(View.VISIBLE, View.INVISIBLE, View.VISIBLE,
-                        View.INVISIBLE, View.VISIBLE, View.INVISIBLE, View.VISIBLE);
+                        View.INVISIBLE, View.VISIBLE, View.INVISIBLE, View.INVISIBLE);
                 updateStartImage();
                 break;
             case SCREEN_WINDOW_TINY:

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -165,7 +165,8 @@ public void onClick(View v) {
                 return;
             }
             if (currentState == CURRENT_STATE_NORMAL || currentState == CURRENT_STATE_ERROR) {
-                if (!url.startsWith("file") && !JCUtils.isWifiConnected(getContext()) && !WIFI_TIP_DIALOG_SHOWED) {
+                if (!url.startsWith("file") && !url.startsWith("/") &&
+                        !JCUtils.isWifiConnected(getContext()) && !WIFI_TIP_DIALOG_SHOWED) {
                     showWifiDialog(JCUserActionStandard.ON_CLICK_START_ICON);
                     return;
                 }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -136,6 +136,8 @@ public void init(Context context) {
         mScreenHeight = getContext().getResources().getDisplayMetrics().heightPixels;
         mAudioManager = (AudioManager) getContext().getSystemService(Context.AUDIO_SERVICE);
         mHandler = new Handler();
+
+        NORMAL_ORIENTATION = context.getResources().getConfiguration().orientation;
     }
 
     public void setUp(String url, int screen, Object... objects) {

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -389,10 +389,12 @@ public void onStatePreparing() {
 
     public void onStatePlaying() {
         currentState = CURRENT_STATE_PLAYING;
+        startProgressTimer();
     }
 
     public void onStatePause() {
         currentState = CURRENT_STATE_PAUSE;
+        startProgressTimer();
     }
 
     public void onStatePlaybackBufferingStart() {

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -549,7 +549,7 @@ public void onSeekComplete() {
 
     public void onError(int what, int extra) {
         Log.e(TAG, "onError " + what + " - " + extra + " [" + this.hashCode() + "] ");
-        if (what != 38 && what != -38) {
+        if (what != 38 && extra != -38) {
             setUiWitStateAndScreen(CURRENT_STATE_ERROR);
             if (isCurrentJcvd()) {
                 JCMediaManager.instance().releaseMediaPlayer();

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/ApiActivity.java
Patch:
@@ -71,8 +71,8 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
 //        mJcVideoPlayerStandard.setUp(Environment.getExternalStorageDirectory().getAbsolutePath() + "/DCIM/Camera/local_video.mp4"
 //                , JCVideoPlayerStandard.SCREEN_LAYOUT_NORMAL, "嫂子不信");
         /** Play video in assert, but not work now **/
-        mJcVideoPlayerStandard.setUp("file:///android_asset/local_video.mp4"
-                , JCVideoPlayerStandard.SCREEN_LAYOUT_NORMAL, "嫂子不信");
+//        mJcVideoPlayerStandard.setUp("file:///android_asset/local_video.mp4"
+//                , JCVideoPlayerStandard.SCREEN_LAYOUT_NORMAL, "嫂子不信");
 
         /** ImageLoader **/
 //        ImageLoader.getInstance().displayImage("http://img4.jiecaojingxuan.com/2016/8/17/f2dbd12e-b1cb-4daf-aff1-8c6be2f64d1a.jpg",

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCMediaManager.java
Patch:
@@ -8,6 +8,7 @@
 import android.os.HandlerThread;
 import android.os.Looper;
 import android.os.Message;
+import android.util.Log;
 import android.view.Surface;
 import android.view.TextureView;
 
@@ -117,7 +118,7 @@ public void releaseMediaPlayer() {
 
     @Override
     public void onSurfaceTextureAvailable(SurfaceTexture surfaceTexture, int i, int i1) {
-        JCUtils.i(TAG, "onSurfaceTextureAvailable [" + this.hashCode() + "] ");
+        Log.i(TAG, "onSurfaceTextureAvailable [" + this.hashCode() + "] ");
         if (savedSurfaceTexture == null) {
             savedSurfaceTexture = surfaceTexture;
             prepare();
@@ -129,7 +130,7 @@ public void onSurfaceTextureAvailable(SurfaceTexture surfaceTexture, int i, int
     @Override
     public void onSurfaceTextureSizeChanged(SurfaceTexture surfaceTexture, int i, int i1) {
         // 如果SurfaceTexture还没有更新Image，则记录SizeChanged事件，否则忽略
-        JCUtils.i(TAG, "onSurfaceTextureSizeChanged [" + this.hashCode() + "] ");
+        Log.i(TAG, "onSurfaceTextureSizeChanged [" + this.hashCode() + "] ");
     }
 
     @Override

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerStandard.java
Patch:
@@ -712,7 +712,6 @@ public Dialog createDialogWithView(View localView) {
         WindowManager.LayoutParams localLayoutParams = window.getAttributes();
         localLayoutParams.gravity = Gravity.CENTER;
         window.setAttributes(localLayoutParams);
-
         return dialog;
     }
 

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/DemoFragment.java
Patch:
@@ -11,7 +11,6 @@
 /**
  * Created by Nathen on 2017/6/9.
  */
-
 public class DemoFragment extends Fragment {
 
     ListView listView;

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCMediaManager.java
Patch:
@@ -8,7 +8,6 @@
 import android.os.HandlerThread;
 import android.os.Looper;
 import android.os.Message;
-import android.util.Log;
 import android.view.Surface;
 import android.view.TextureView;
 
@@ -118,7 +117,7 @@ public void releaseMediaPlayer() {
 
     @Override
     public void onSurfaceTextureAvailable(SurfaceTexture surfaceTexture, int i, int i1) {
-        Log.i(TAG, "onSurfaceTextureAvailable [" + this.hashCode() + "] ");
+        JCUtils.i(TAG, "onSurfaceTextureAvailable [" + this.hashCode() + "] ");
         if (savedSurfaceTexture == null) {
             savedSurfaceTexture = surfaceTexture;
             prepare();
@@ -130,7 +129,7 @@ public void onSurfaceTextureAvailable(SurfaceTexture surfaceTexture, int i, int
     @Override
     public void onSurfaceTextureSizeChanged(SurfaceTexture surfaceTexture, int i, int i1) {
         // 如果SurfaceTexture还没有更新Image，则记录SizeChanged事件，否则忽略
-        Log.i(TAG, "onSurfaceTextureSizeChanged [" + this.hashCode() + "] ");
+        JCUtils.i(TAG, "onSurfaceTextureSizeChanged [" + this.hashCode() + "] ");
     }
 
     @Override

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerSimple.java
Patch:
@@ -75,7 +75,7 @@ public void updateFullscreenButton() {
     @Override
     public void onClick(View v) {
         if (v.getId() == R.id.fullscreen && currentState == CURRENT_STATE_NORMAL) {
-            Toast.makeText(getContext(), "Play video first", Toast.LENGTH_SHORT).show();
+            Toast.makeText(getContext(), getResources().getString(R.string.play_first), Toast.LENGTH_SHORT).show();
             return;
         }
         super.onClick(v);
@@ -85,7 +85,7 @@ public void onClick(View v) {
     public void onProgressChanged(SeekBar seekBar, int progress, boolean fromUser) {
         if (fromUser) {
             if (currentState == CURRENT_STATE_NORMAL) {
-                Toast.makeText(getContext(), "Play video first", Toast.LENGTH_SHORT).show();
+                Toast.makeText(getContext(), getResources().getString(R.string.play_first), Toast.LENGTH_SHORT).show();
                 return;
             }
         }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCMediaManager.java
Patch:
@@ -8,7 +8,6 @@
 import android.os.HandlerThread;
 import android.os.Looper;
 import android.os.Message;
-import android.util.Log;
 import android.view.Surface;
 import android.view.TextureView;
 
@@ -118,7 +117,7 @@ public void releaseMediaPlayer() {
 
     @Override
     public void onSurfaceTextureAvailable(SurfaceTexture surfaceTexture, int i, int i1) {
-        Log.i(TAG, "onSurfaceTextureAvailable [" + this.hashCode() + "] ");
+        JCUtils.i(TAG, "onSurfaceTextureAvailable [" + this.hashCode() + "] ");
         if (savedSurfaceTexture == null) {
             savedSurfaceTexture = surfaceTexture;
             prepare();
@@ -130,7 +129,7 @@ public void onSurfaceTextureAvailable(SurfaceTexture surfaceTexture, int i, int
     @Override
     public void onSurfaceTextureSizeChanged(SurfaceTexture surfaceTexture, int i, int i1) {
         // 如果SurfaceTexture还没有更新Image，则记录SizeChanged事件，否则忽略
-        Log.i(TAG, "onSurfaceTextureSizeChanged [" + this.hashCode() + "] ");
+        JCUtils.i(TAG, "onSurfaceTextureSizeChanged [" + this.hashCode() + "] ");
     }
 
     @Override

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/VideoListAdapter.java
Patch:
@@ -64,7 +64,6 @@ public View getView(int position, View convertView, ViewGroup parent) {
             viewHolder.jcVideoPlayer.setUp(
                     VideoConstant.videoUrls[0][position], JCVideoPlayer.SCREEN_LAYOUT_LIST,
                     VideoConstant.videoTitles[0][position]);
-            System.out.println("fdsfdsfdsfdsfa setup " + position);
             Picasso.with(convertView.getContext())
                     .load(VideoConstant.videoThumbs[0][position])
                     .into(viewHolder.jcVideoPlayer.thumbImageView);

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -461,9 +461,6 @@ public void onAutoCompletion() {
             backPress();
         }
         JCUtils.saveProgress(getContext(), url, 0);
-
-//        JCMediaManager.textureView = null;
-        JCMediaManager.savedSurfaceTexture = null;
     }
 
     public void onCompletion() {

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -505,11 +505,11 @@ public void playOnThisJcvd() {
     public void clearFloatScreen() {
         JCUtils.getAppCompActivity(getContext()).setRequestedOrientation(NORMAL_ORIENTATION);
         showSupportActionBar(getContext());
-        JCVideoPlayer secJcvd = JCVideoPlayerManager.getCurrentJcvd();
-        secJcvd.textureViewContainer.removeView(JCMediaManager.textureView);
+        JCVideoPlayer currJcvd = JCVideoPlayerManager.getCurrentJcvd();
+        currJcvd.textureViewContainer.removeView(JCMediaManager.textureView);
         ViewGroup vp = (ViewGroup) (JCUtils.scanForActivity(getContext()))//.getWindow().getDecorView();
                 .findViewById(Window.ID_ANDROID_CONTENT);
-        vp.removeView(secJcvd);
+        vp.removeView(currJcvd);
         JCVideoPlayerManager.setSecondFloor(null);
     }
 

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -716,6 +716,7 @@ public void run() {
 
     public int getCurrentPositionWhenPlaying() {
         int position = 0;
+        if (JCMediaManager.instance().mediaPlayer == null) return position;//这行代码不应该在这，如果代码和逻辑万无一失的话，心头之恨呐
         if (currentState == CURRENT_STATE_PLAYING ||
                 currentState == CURRENT_STATE_PAUSE ||
                 currentState == CURRENT_STATE_PLAYING_BUFFERING_START) {
@@ -731,6 +732,7 @@ public int getCurrentPositionWhenPlaying() {
 
     public int getDuration() {
         int duration = 0;
+        if (JCMediaManager.instance().mediaPlayer == null) return duration;
         try {
             duration = JCMediaManager.instance().mediaPlayer.getDuration();
         } catch (IllegalStateException e) {

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -461,6 +461,9 @@ public void onAutoCompletion() {
             backPress();
         }
         JCUtils.saveProgress(getContext(), url, 0);
+
+        JCMediaManager.textureView = null;
+        JCMediaManager.savedSurfaceTexture = null;
     }
 
     public void onCompletion() {
@@ -507,7 +510,6 @@ public void clearFloatScreen() {
         ViewGroup vp = (ViewGroup) (JCUtils.scanForActivity(getContext()))//.getWindow().getDecorView();
                 .findViewById(Window.ID_ANDROID_CONTENT);
         vp.removeView(secJcvd);
-//        secJcvd.onCompletion();
         JCVideoPlayerManager.setSecondFloor(null);
     }
 

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -486,6 +486,7 @@ public void onCompletion() {
 
         JCMediaManager.textureView = null;
         JCMediaManager.savedSurfaceTexture = null;
+        cancelProgressTimer();
 //        JCMediaManager.textureView = null;
     }
 
@@ -819,6 +820,7 @@ public static void releaseAllVideos() {
         if ((System.currentTimeMillis() - CLICK_QUIT_FULLSCREEN_TIME) > FULL_SCREEN_NORMAL_DELAY) {
             Log.d(TAG, "releaseAllVideos");
             JCVideoPlayerManager.completeAll();
+            JCVideoPlayerManager.releaseFullscreenVideos();
             JCMediaManager.instance().releaseMediaPlayer();
         }
     }
@@ -854,6 +856,7 @@ public static void startFullscreen(Context context, Class _class, String url, Ob
             jcVideoPlayer.setUp(url, JCVideoPlayerStandard.SCREEN_WINDOW_FULLSCREEN, objects);
             CLICK_QUIT_FULLSCREEN_TIME = System.currentTimeMillis();
             jcVideoPlayer.startButton.performClick();
+            JCVideoPlayerManager.setFullscreenJcvd(jcVideoPlayer);
         } catch (InstantiationException e) {
             e.printStackTrace();
         } catch (Exception e) {
@@ -944,5 +947,4 @@ public void dismissBrightnessDialog() {
 
     public abstract int getLayoutId();
 
-
 }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -484,6 +484,7 @@ public void onCompletion() {
 
         JCMediaManager.textureView = null;
         JCMediaManager.savedSurfaceTexture = null;
+        cancelProgressTimer();
 //        JCMediaManager.textureView = null;
     }
 
@@ -817,6 +818,7 @@ public static void releaseAllVideos() {
         if ((System.currentTimeMillis() - CLICK_QUIT_FULLSCREEN_TIME) > FULL_SCREEN_NORMAL_DELAY) {
             Log.d(TAG, "releaseAllVideos");
             JCVideoPlayerManager.completeAll();
+            JCVideoPlayerManager.releaseFullscreenVideos();
             JCMediaManager.instance().releaseMediaPlayer();
         }
     }
@@ -852,6 +854,7 @@ public static void startFullscreen(Context context, Class _class, String url, Ob
             jcVideoPlayer.setUp(url, JCVideoPlayerStandard.SCREEN_WINDOW_FULLSCREEN, objects);
             CLICK_QUIT_FULLSCREEN_TIME = System.currentTimeMillis();
             jcVideoPlayer.startButton.performClick();
+            JCVideoPlayerManager.setFullscreenJcvd(jcVideoPlayer);
         } catch (InstantiationException e) {
             e.printStackTrace();
         } catch (Exception e) {
@@ -942,5 +945,4 @@ public void dismissBrightnessDialog() {
 
     public abstract int getLayoutId();
 
-
 }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCMediaManager.java
Patch:
@@ -201,7 +201,7 @@ public void run() {
                 }
             }
         });
-        return false;
+        return true;
     }
 
     @Override

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/CustomView/JCVideoPlayerStandardAutoCompleteAfterFullscreen.java
Patch:
@@ -9,12 +9,12 @@
  * Created by Nathen on 2016/11/26.
  */
 
-public class JCVideoPlayerStandardAutoComplete extends JCVideoPlayerStandard {
-    public JCVideoPlayerStandardAutoComplete(Context context) {
+public class JCVideoPlayerStandardAutoCompleteAfterFullscreen extends JCVideoPlayerStandard {
+    public JCVideoPlayerStandardAutoCompleteAfterFullscreen(Context context) {
         super(context);
     }
 
-    public JCVideoPlayerStandardAutoComplete(Context context, AttributeSet attrs) {
+    public JCVideoPlayerStandardAutoCompleteAfterFullscreen(Context context, AttributeSet attrs) {
         super(context, attrs);
     }
 

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCMediaManager.java
Patch:
@@ -216,8 +216,8 @@ public boolean onInfo(MediaPlayer mp, final int what, final int extra) {
         mainThreadHandler.post(new Runnable() {
             @Override
             public void run() {
-                if (JCVideoPlayerManager.getFirstFloor() != null) {
-                    JCVideoPlayerManager.getFirstFloor().onInfo(what, extra);
+                if (JCVideoPlayerManager.getCurrentJcvd() != null) {
+                    JCVideoPlayerManager.getCurrentJcvd().onInfo(what, extra);
                 }
             }
         });

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -64,7 +64,7 @@ public abstract class JCVideoPlayer extends FrameLayout implements View.OnClickL
     public static final int CURRENT_STATE_AUTO_COMPLETE = 6;
     public static final int CURRENT_STATE_ERROR = 7;
 
-    int BACKUP_PLAYING_BUFFERING_STATE = -1;
+    public static int BACKUP_PLAYING_BUFFERING_STATE = -1;
 
     public int currentState = -1;
     public int currentScreen = -1;
@@ -520,6 +520,7 @@ public void onError(int what, int extra) {
     public void onInfo(int what, int extra) {
         Log.d(TAG, "onInfo what - " + what + " extra - " + extra);
         if (what == MediaPlayer.MEDIA_INFO_BUFFERING_START) {
+            if (currentState == CURRENT_STATE_PLAYING_BUFFERING_START) return;
             BACKUP_PLAYING_BUFFERING_STATE = currentState;
             setUiWitStateAndScreen(CURRENT_STATE_PLAYING_BUFFERING_START);//没这个case
             Log.d(TAG, "MEDIA_INFO_BUFFERING_START");

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -438,6 +438,7 @@ public void playOnThisJcvd() {
         ViewGroup vp = (ViewGroup) (JCUtils.scanForActivity(getContext()))//.getWindow().getDecorView();
                 .findViewById(Window.ID_ANDROID_CONTENT);
         vp.removeView(secJcvd);
+        JCVideoPlayerManager.setSecondFloor(null);
         JCMediaManager.instance().lastState = secJcvd.currentState;
         //2.在本jcvd上播放
         currentState = JCMediaManager.instance().lastState;
@@ -668,6 +669,7 @@ public void startWindowTiny() {
             jcVideoPlayer.setUp(url, JCVideoPlayerStandard.SCREEN_WINDOW_TINY, objects);
             jcVideoPlayer.setUiWitStateAndScreen(currentState);
             jcVideoPlayer.addTextureView();
+            JCVideoPlayerManager.setSecondFloor(jcVideoPlayer);
         } catch (InstantiationException e) {
             e.printStackTrace();
         } catch (Exception e) {

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -652,7 +652,7 @@ public void startWindowFullscreen() {
     public void startWindowTiny() {
         Log.i(TAG, "startWindowTiny " + " [" + this.hashCode() + "] ");
         onEvent(JCUserAction.ON_ENTER_TINYSCREEN);
-
+        if (currentState == CURRENT_STATE_NORMAL || currentState == CURRENT_STATE_ERROR) return;
         ViewGroup vp = (ViewGroup) (JCUtils.scanForActivity(getContext()))//.getWindow().getDecorView();
                 .findViewById(Window.ID_ANDROID_CONTENT);
         View old = vp.findViewById(TINY_ID);
@@ -882,7 +882,7 @@ public static void startFullscreen(Context context, Class _class, String url, Ob
 //            final Animation ra = AnimationUtils.loadAnimation(getContext(), R.anim.start_fullscreen);
 //            jcVideoPlayer.setAnimation(ra);
             CLICK_QUIT_FULLSCREEN_TIME = System.currentTimeMillis();
-                    jcVideoPlayer.startButton.performClick();
+            jcVideoPlayer.startButton.performClick();
             JCVideoPlayerManager.FIRST_FLOOR_LIST.put(url, new WeakReference<>((JCMediaPlayerListener) jcVideoPlayer));
         } catch (InstantiationException e) {
             e.printStackTrace();

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerManager.java
Patch:
@@ -53,6 +53,7 @@ public static JCMediaPlayerListener getCurrentJcvdOnSecondFloor() {
     public static void completeAll() {
         if (SECOND_FLOOR != null && SECOND_FLOOR.get() != null) {
             SECOND_FLOOR.get().onCompletion();
+            putSecondFloor(null);
         }
         Set<String> set = FIRST_FLOOR_LIST.keySet();
         for (String s : set) {

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/RecyclerViewVideoAdapter.java
Patch:
@@ -35,10 +35,10 @@ public void onBindViewHolder(MyViewHolder holder, int position) {
         Log.i(TAG, "onBindViewHolder [" + holder.jcVideoPlayer.hashCode() + "] position=" + position);
 
         holder.jcVideoPlayer.setUp(
-                VideoConstant.videoUrls[position][0], JCVideoPlayer.SCREEN_LAYOUT_LIST,
-                VideoConstant.videoTitles[position][0]);
+                VideoConstant.videoUrls[0][position], JCVideoPlayer.SCREEN_LAYOUT_LIST,
+                VideoConstant.videoTitles[0][position]);
         Picasso.with(holder.jcVideoPlayer.getContext())
-                .load(VideoConstant.videoThumbs[position][0])
+                .load(VideoConstant.videoThumbs[0][position])
                 .into(holder.jcVideoPlayer.thumbImageView);
     }
 

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/ListViewMultiHolderActivity.java
Patch:
@@ -86,11 +86,11 @@ public View getView(int position, View convertView, ViewGroup parent) {
                 }
 
                 viewHolder.jcVideoPlayer.setUp(
-                        VideoConstant.videoUrls[position], JCVideoPlayer.SCREEN_LAYOUT_LIST,
-                        VideoConstant.videoTitles[position]);
+                        VideoConstant.videoUrls[0][position], JCVideoPlayer.SCREEN_LAYOUT_LIST,
+                        VideoConstant.videoTitles[0][position]);
 
                 Picasso.with(ListViewMultiHolderActivity.this)
-                        .load(VideoConstant.videoThumbs[position])
+                        .load(VideoConstant.videoThumbs[0][position])
                         .into(viewHolder.jcVideoPlayer.thumbImageView);
             } else {
                 TextViewHolder textViewHolder;

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/ListViewViewpagerActivity.java
Patch:
@@ -33,9 +33,9 @@ protected void onCreate(Bundle savedInstanceState) {
         ListView listView2 = (ListView) getLayoutInflater().inflate(R.layout.layout_list, null);
         ListView listView3 = (ListView) getLayoutInflater().inflate(R.layout.layout_list, null);
 
-        listView1.setAdapter(new VideoListAdapter(this));
-        listView2.setAdapter(new VideoListAdapter(this));
-        listView3.setAdapter(new VideoListAdapter(this));
+        listView1.setAdapter(new VideoListAdapter(this, 0));
+        listView2.setAdapter(new VideoListAdapter(this, 1));
+        listView3.setAdapter(new VideoListAdapter(this, 2));
 
         listViews.add(listView1);
         listViews.add(listView2);

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/MainActivity.java
Patch:
@@ -56,10 +56,10 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
                 , JCVideoPlayerStandard.SCREEN_LAYOUT_NORMAL, "嫂子在家吗");
 
         mJcVideoPlayerStandard = (JCVideoPlayerStandard) findViewById(R.id.jc_video);
-        mJcVideoPlayerStandard.setUp("http://video.jiecao.fm/8/17/%E6%8A%AB%E8%90%A8.mp4"
-                , JCVideoPlayerStandard.SCREEN_LAYOUT_NORMAL, "嫂子真嘚瑟");
+        mJcVideoPlayerStandard.setUp("http://video.jiecao.fm/11/23/xin/%E5%81%87%E4%BA%BA.mp4"
+                , JCVideoPlayerStandard.SCREEN_LAYOUT_NORMAL, "嫂子不咋信");
         Picasso.with(this)
-                .load("http://img4.jiecaojingxuan.com/2016/8/17/f2dbd12e-b1cb-4daf-aff1-8c6be2f64d1a.jpg")
+                .load("http://img4.jiecaojingxuan.com/2016/11/23/00b026e7-b830-4994-bc87-38f4033806a6.jpg@!640_360")
                 .into(mJcVideoPlayerStandard.thumbImageView);
         mJcVideoPlayerStandard.looping = true;
 

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/RecyclerViewVideoAdapter.java
Patch:
@@ -35,10 +35,10 @@ public void onBindViewHolder(MyViewHolder holder, int position) {
         Log.i(TAG, "onBindViewHolder [" + holder.jcVideoPlayer.hashCode() + "] position=" + position);
 
         holder.jcVideoPlayer.setUp(
-                VideoConstant.videoUrls[position], JCVideoPlayer.SCREEN_LAYOUT_LIST,
-                VideoConstant.videoTitles[position]);
+                VideoConstant.videoUrls[position][0], JCVideoPlayer.SCREEN_LAYOUT_LIST,
+                VideoConstant.videoTitles[position][0]);
         Picasso.with(holder.jcVideoPlayer.getContext())
-                .load(VideoConstant.videoThumbs[position])
+                .load(VideoConstant.videoThumbs[position][0])
                 .into(holder.jcVideoPlayer.thumbImageView);
     }
 

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerManager.java
Patch:
@@ -46,7 +46,7 @@ public static JCMediaPlayerListener getCurrentJcvdOnSecondFloor() {
 //    }
 
     public static void completeAll() {
-        if (SECOND_FLOOR != null) {
+        if (SECOND_FLOOR != null && SECOND_FLOOR.get() != null) {
             SECOND_FLOOR.get().onCompletion();
         }
         if (getCurrentJcvdOnFirtFloor() != null) {

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -323,6 +323,9 @@ public void addTextureView() {
             JCMediaManager.textureView = new JCResizeTextureView(getContext());
             JCMediaManager.textureView.setSurfaceTextureListener(JCMediaManager.instance());
         }
+        if (JCMediaManager.textureView.getParent() != null) {
+            ((ViewGroup) JCMediaManager.textureView.getParent()).removeView(JCMediaManager.textureView);
+        }
 //        textureViewContainer.removeView(JCMediaManager.textureView);
         JCMediaManager.textureView.setVideoSize(JCMediaManager.instance().getVideoSize());
         JCMediaManager.textureView.setRotation(JCMediaManager.instance().videoRotation);
@@ -333,7 +336,6 @@ public void addTextureView() {
                         ViewGroup.LayoutParams.MATCH_PARENT,
                         Gravity.CENTER);
         textureViewContainer.addView(JCMediaManager.textureView, layoutParams);
-
     }
 
     public void setUiWitStateAndScreen(int state) {

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -428,6 +428,8 @@ public void clearFullscreenLayout() {
     public void onAutoCompletion() {
         Log.i(TAG, "onAutoCompletion " + " [" + this.hashCode() + "] ");
         onEvent(JCBuriedPoint.ON_AUTO_COMPLETE);
+        dismissVolumeDialog();
+        dismissProgressDialog();
         setUiWitStateAndScreen(CURRENT_STATE_AUTO_COMPLETE);
         JCVideoPlayerManager.popListener();//自己进入autoComplete状态，其他的进入complete状态
         JCVideoPlayerManager.completeAll();
@@ -476,7 +478,7 @@ public boolean backToOtherListener() {//这里这个名字这么写并不对,这
                 return true;
             }
             ViewGroup vp = (ViewGroup) (JCUtils.scanForActivity(getContext()))//.getWindow().getDecorView();
-                .findViewById(Window.ID_ANDROID_CONTENT);
+                    .findViewById(Window.ID_ANDROID_CONTENT);
             vp.removeView(this);
             JCMediaManager.instance().lastState = currentState;//save state
             JCVideoPlayerManager.popListener();

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerStandard.java
Patch:
@@ -142,7 +142,6 @@ public void setUiWitStateAndScreen(int state) {
     @Override
     public void onCompletion() {
         super.onCompletion();
-        JCUtils.switchNormalOrientation(getContext());
         // 清理cover image,回收bitmap内存
         clearCacheImage();
     }
@@ -325,15 +324,13 @@ public void addTextureView() {
     public void startWindowFullscreen() {
         obtainCache();
         super.startWindowFullscreen();
-        JCUtils.switchFullOrientation(getContext());
         refreshCache();
     }
 
     @Override
     public boolean backToOtherListener() {
         obtainCache();
         boolean b = super.backToOtherListener();
-        JCUtils.switchNormalOrientation(getContext());
         refreshCache();
         return b;
     }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCMediaPlayerListener.java
Patch:
@@ -32,7 +32,7 @@ public interface JCMediaPlayerListener {
 
     int getState();
 
-    void autoFullscreen();
+    void autoFullscreen(float x);
 
     void autoFullscreenRight();
 

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/VideoConstant.java
Patch:
@@ -35,7 +35,7 @@ public class VideoConstant {
             "嫂子出来",
             "嫂子溢出",
             "嫂子我姓王",
-            "嫂子怕好了",
+            "嫂子趴好了",
             "嫂子很渴",
             "嫂子这样不好",
             "嫂子别笑",

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -440,8 +440,8 @@ public boolean goToOtherListener() {//这里这个名字这么写并不对,这
             onEvent(currentScreen == JCVideoPlayerStandard.SCREEN_WINDOW_FULLSCREEN ?
                     JCBuriedPoint.ON_QUIT_FULLSCREEN :
                     JCBuriedPoint.ON_QUIT_TINYSCREEN);
-            if (JCVideoPlayerManager.lastListener() == null) {//directly fullscreen
-                JCVideoPlayerManager.lastListener().onCompletion();
+            if (JCVideoPlayerManager.listener() == null) {//directly fullscreen
+                JCVideoPlayerManager.listener().onCompletion();
                 showSupportActionBar(getContext());
                 return true;
             }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -434,7 +434,7 @@ public boolean goToOtherListener() {//这里这个名字这么写并不对,这
                     JCBuriedPoint.ON_QUIT_FULLSCREEN :
                     JCBuriedPoint.ON_QUIT_TINYSCREEN);
             if (JCVideoPlayerManager.lastListener() == null) {//directly fullscreen
-                JCVideoPlayerManager.listener().onCompletion();
+                JCVideoPlayerManager.lastListener().onCompletion();
                 showSupportActionBar(getContext());
                 return true;
             }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -865,14 +865,14 @@ public void onSensorChanged(SensorEvent event) {//可以得到传感器实时测
             float x = event.values[SensorManager.DATA_X];
             float y = event.values[SensorManager.DATA_Y];
             float z = event.values[SensorManager.DATA_Z];
-            if (x < -11) {
+            if (x < -10) {
                 //direction right
-            } else if (x > 11) {
+            } else if (x > 10) {
                 //direction left
                 if (JCVideoPlayerManager.listener() != null) {
                     JCVideoPlayerManager.listener().autoFullscreenLeft();
                 }
-            } else if (y > 11) {
+            } else if (y > 9) {
                 if (JCVideoPlayerManager.listener() != null) {
                     JCVideoPlayerManager.listener().autoQuitFullscreen();
                 }

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/ListViewNormalActivity.java
Patch:
@@ -37,7 +37,7 @@ public void onScrollStateChanged(AbsListView view, int scrollState) {
 
             @Override
             public void onScroll(AbsListView view, int firstVisibleItem, int visibleItemCount, int totalItemCount) {
-                JCVideoPlayer.onListScroll();
+                JCVideoPlayer.onScroll();
             }
         });
     }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCMediaPlayerListener.java
Patch:
@@ -24,6 +24,6 @@ public interface JCMediaPlayerListener {
 
     boolean goToOtherListener();
 
-    void onListScrollChange();
+    void onScrollChange();
 
 }

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/MainActiivty.java
Patch:
@@ -41,11 +41,11 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
 
         jcVideoPlayerSimple = (JCVideoPlayerSimple) findViewById(R.id.simple_demo);
         jcVideoPlayerSimple.setUp("http://devimages.apple.com/iphone/samples/bipbop/gear1/prog_index.m3u8"
-                , JCVideoPlayerStandard.SCREEN_LAYOUT_LIST, "嫂子在家吗");
+                , JCVideoPlayerStandard.SCREEN_LAYOUT_NORMAL, "嫂子在家吗");
 
         jcVideoPlayerStandard = (JCVideoPlayerStandard) findViewById(R.id.jc_video);
         jcVideoPlayerStandard.setUp("http://2449.vod.myqcloud.com/2449_22ca37a6ea9011e5acaaf51d105342e3.f20.mp4"
-                , JCVideoPlayerStandard.SCREEN_LAYOUT_LIST, "嫂子坐这");
+                , JCVideoPlayerStandard.SCREEN_LAYOUT_NORMAL, "嫂子坐这");
         ImageLoader.getInstance().displayImage("http://cos.myqcloud.com/1000264/qcloud_video_attachment/842646334/vod_cover/cover1458036374.jpg",
                 jcVideoPlayerStandard.thumbImageView);
 

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/UISmallChangeActivity.java
Patch:
@@ -29,14 +29,14 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         setContentView(R.layout.activity_ui_small_change);
 
         jcVideoPlayerStandardWithShareButton = (JCVideoPlayerStandardShowShareButtonAfterFullscreen) findViewById(R.id.custom_videoplayer_standard_with_share_button);
-        jcVideoPlayerStandardWithShareButton.setUp("http://2449.vod.myqcloud.com/2449_22ca37a6ea9011e5acaaf51d105342e3.f20.mp4", JCVideoPlayer.SCREEN_LAYOUT_LIST
+        jcVideoPlayerStandardWithShareButton.setUp("http://2449.vod.myqcloud.com/2449_22ca37a6ea9011e5acaaf51d105342e3.f20.mp4", JCVideoPlayer.SCREEN_LAYOUT_NORMAL
                 , "嫂子上飞机");
         ImageLoader.getInstance().displayImage("http://cos.myqcloud.com/1000264/qcloud_video_attachment/842646334/vod_cover/cover1458036374.jpg",
                 jcVideoPlayerStandardWithShareButton.thumbImageView);
 
 
         jcVideoPlayerStandardShowTitleAfterFullscreen = (JCVideoPlayerStandardShowTitleAfterFullscreen) findViewById(R.id.custom_videoplayer_standard_show_title_after_fullscreen);
-        jcVideoPlayerStandardShowTitleAfterFullscreen.setUp("http://video.jiecao.fm/5/1/%E8%87%AA%E5%8F%96%E5%85%B6%E8%BE%B1.mp4", JCVideoPlayer.SCREEN_LAYOUT_LIST
+        jcVideoPlayerStandardShowTitleAfterFullscreen.setUp("http://video.jiecao.fm/5/1/%E8%87%AA%E5%8F%96%E5%85%B6%E8%BE%B1.mp4", JCVideoPlayer.SCREEN_LAYOUT_NORMAL
                 , "嫂子看电视");
         ImageLoader.getInstance().displayImage("http://img4.jiecaojingxuan.com/2016/5/1/3430ec64-e6a7-4d8e-b044-9d408e075b7c.jpg",
                 jcVideoPlayerStandardShowTitleAfterFullscreen.thumbImageView);

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -694,7 +694,7 @@ public void setProgressAndTime(int progress, int secProgress, int currentTime, i
         }
         if (secProgress > 95) secProgress = 100;
         if (secProgress != 0) progressBar.setSecondaryProgress(secProgress);
-        currentTimeTextView.setText(JCUtils.stringForTime(currentTime));
+        if (currentTime != 0) currentTimeTextView.setText(JCUtils.stringForTime(currentTime));
         totalTimeTextView.setText(JCUtils.stringForTime(totalTime));
     }
 

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -422,6 +422,7 @@ public boolean goToOtherListener() {//这里这个名字这么写并不对,这
                     JCBuriedPoint.ON_QUIT_TINYSCREEN);
             if (JCVideoPlayerManager.LISTENERLIST.size() == 1) {//directly fullscreen
                 JCVideoPlayerManager.popListener().onCompletion();
+                JCMediaManager.instance().releaseMediaPlayer();
                 showSupportActionBar(getContext());
                 return true;
             }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerStandard.java
Patch:
@@ -353,11 +353,11 @@ private void changeUiToPlayingClear() {
         switch (currentScreen) {
             case SCREEN_LAYOUT_LIST:
                 setAllControlsVisible(View.INVISIBLE, View.INVISIBLE, View.INVISIBLE,
-                        View.INVISIBLE, View.INVISIBLE, View.INVISIBLE, View.INVISIBLE);
+                        View.INVISIBLE, View.INVISIBLE, View.INVISIBLE, View.VISIBLE);
                 break;
             case SCREEN_WINDOW_FULLSCREEN:
                 setAllControlsVisible(View.INVISIBLE, View.INVISIBLE, View.INVISIBLE,
-                        View.INVISIBLE, View.INVISIBLE, View.INVISIBLE, View.INVISIBLE);
+                        View.INVISIBLE, View.INVISIBLE, View.INVISIBLE, View.VISIBLE);
                 break;
             case SCREEN_WINDOW_TINY:
                 break;

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerStandard.java
Patch:
@@ -543,7 +543,7 @@ protected void showProgressDialog(float deltaX, String seekTime, int seekTimePos
 
         mDialogSeekTime.setText(seekTime);
         mDialogTotalTime.setText(" / " + totalTime);
-        mDialogProgressBar.setProgress(seekTimePosition * 100 / totalTimeDuration);
+        mDialogProgressBar.setProgress(totalTimeDuration <= 0 ? 0 : (seekTimePosition * 100 / totalTimeDuration));
         if (deltaX > 0) {
             mDialogIcon.setBackgroundResource(R.drawable.jc_forward_icon);
         } else {

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/CustomView/JCVideoPlayerStandardShowShareButtonAfterFullscreen.java
Patch:
@@ -49,7 +49,7 @@ public void onClick(View v) {
     @Override
     public boolean setUp(String url, int screen, Object... objects) {
         if (super.setUp(url, screen, objects)) {
-            if (mCurrentScreen == SCREEN_WINDOW_FULLSCREEN) {
+            if (currentScreen == SCREEN_WINDOW_FULLSCREEN) {
                 shareButton.setVisibility(View.VISIBLE);
             } else {
                 shareButton.setVisibility(View.INVISIBLE);

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/CustomView/JCVideoPlayerStandardShowTitleAfterFullscreen.java
Patch:
@@ -22,7 +22,7 @@ public JCVideoPlayerStandardShowTitleAfterFullscreen(Context context, AttributeS
     @Override
     public boolean setUp(String url, int screen, Object... objects) {
         if (super.setUp(url, screen, objects)) {
-            if (mCurrentScreen == SCREEN_WINDOW_FULLSCREEN) {
+            if (currentScreen == SCREEN_WINDOW_FULLSCREEN) {
                 titleTextView.setVisibility(View.VISIBLE);
             } else {
                 titleTextView.setVisibility(View.INVISIBLE);

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerSimple.java
Patch:
@@ -41,8 +41,8 @@ public boolean setUp(String url, int screen, Object... objects) {
     }
 
     @Override
-    protected void setStateAndUi(int state) {
-        super.setStateAndUi(state);
+    protected void setUiWitStateAndScreen(int state) {
+        super.setUiWitStateAndScreen(state);
         switch (mCurrentState) {
             case CURRENT_STATE_NORMAL:
                 startButton.setVisibility(View.VISIBLE);

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -676,6 +676,7 @@ protected void setProgressAndTime(int progress, int secProgress, int currentTime
         if (!mTouchingProgressBar) {
             if (progress != 0) progressBar.setProgress(progress);
         }
+        if (secProgress > 95) secProgress = 100;
         if (secProgress != 0) progressBar.setSecondaryProgress(secProgress);
         currentTimeTextView.setText(JCUtils.stringForTime(currentTime));
         totalTimeTextView.setText(JCUtils.stringForTime(totalTime));

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCMediaManager.java
Patch:
@@ -49,7 +49,7 @@ public JCMediaPlayerListener listener() {
     }
 
     public JCMediaPlayerListener lastListener() {
-        if (listener == null)
+        if (lastListener == null)
             return null;
         return lastListener.get();
     }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -607,6 +607,7 @@ public void onVideoSizeChanged() {
     public void onBackFullscreen() {
         mCurrentState = JCMediaManager.instance().lastState;
         setStateAndUi(mCurrentState);
+        addTextureView();
     }
 
     protected void startProgressTimer() {

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCFullScreenActivity.java
Patch:
@@ -82,7 +82,7 @@ protected void onCreate(Bundle savedInstanceState) {
     mJcVideoPlayer.mIfFullscreenIsDirectly = DIRECT_FULLSCREEN;
     mJcVideoPlayer.setUp(URL, OBJECTS);
     mJcVideoPlayer.setStateAndUi(CURRENT_STATE);
-    mJcVideoPlayer.addSurfaceView();
+    mJcVideoPlayer.addTextureView();
     if (mJcVideoPlayer.mIfFullscreenIsDirectly) {
       mJcVideoPlayer.startButton.performClick();
     } else {

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -295,7 +295,7 @@ protected void prepareVideo() {
       JCMediaManager.instance().listener.onCompletion();
     }
     JCMediaManager.instance().listener = this;
-    addSurfaceView();
+    addTextureView();
     AudioManager mAudioManager = (AudioManager) getContext().getSystemService(Context.AUDIO_SERVICE);
     mAudioManager.requestAudioFocus(onAudioFocusChangeListener, AudioManager.STREAM_MUSIC, AudioManager.AUDIOFOCUS_GAIN_TRANSIENT);
 
@@ -324,8 +324,8 @@ public void onAudioFocusChange(int focusChange) {
     }
   };
 
-  protected void addSurfaceView() {
-    Log.i(TAG, "addSurfaceView [" + this.hashCode() + "] ");
+  protected void addTextureView() {
+    Log.i(TAG, "addTextureView [" + this.hashCode() + "] ");
     if (textureViewContainer.getChildCount() > 0) {
       textureViewContainer.removeAllViews();
     }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -56,7 +56,7 @@ public abstract class JCVideoPlayer extends FrameLayout implements View.OnClickL
   protected static boolean IF_FULLSCREEN_FROM_NORMAL = false;//to prevent infinite looping
   public static boolean IF_RELEASE_WHEN_ON_PAUSE = true;
   protected static long CLICK_QUIT_FULLSCREEN_TIME = 0;
-  public static final int FULL_SCREEN_NORMAL_DELAY = 1000;
+  public static final int FULL_SCREEN_NORMAL_DELAY = 2000;
 
   public ImageView startButton;
   public SeekBar progressBar;
@@ -560,6 +560,7 @@ public void onAutoCompletion() {
       IF_FULLSCREEN_FROM_NORMAL = false;
       JCMediaManager.instance().lastListener.onAutoCompletion();
     }
+    JCMediaManager.instance().listener = null;
     JCMediaManager.instance().lastListener = null;
     AudioManager mAudioManager = (AudioManager) getContext().getSystemService(Context.AUDIO_SERVICE);
     mAudioManager.abandonAudioFocus(onAudioFocusChangeListener);
@@ -764,7 +765,7 @@ public static void releaseAllVideos() {
    */
   public void release() {
     if (JCMediaManager.instance().listener == this &&
-      mCurrentState != CURRENT_STATE_NORMAL &&
+//      mCurrentState != CURRENT_STATE_NORMAL &&
       (System.currentTimeMillis() - CLICK_QUIT_FULLSCREEN_TIME) > FULL_SCREEN_NORMAL_DELAY) {
       Log.i(TAG, "release [" + this.hashCode() + "]");
       releaseAllVideos();

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -370,7 +370,6 @@ public boolean onTouch(View v, MotionEvent event) {
           mChangeVolume = false;
           mChangePosition = false;
           /////////////////////
-          cancelProgressTimer();
           break;
         case MotionEvent.ACTION_MOVE:
           float deltaX = x - mDownX;
@@ -380,6 +379,7 @@ public boolean onTouch(View v, MotionEvent event) {
           if (mIfCurrentIsFullscreen) {
             if (!mChangePosition && !mChangeVolume) {
               if (absDeltaX > mThreshold || absDeltaY > mThreshold) {
+                cancelProgressTimer();
                 if (absDeltaX >= mThreshold) {
                   mChangePosition = true;
                   mDownPosition = getCurrentPositionWhenPlaying();
@@ -661,6 +661,7 @@ public void run() {
   protected void cancelProgressTimer() {
     if (UPDATE_PROGRESS_TIMER != null) {
       UPDATE_PROGRESS_TIMER.cancel();
+      UPDATE_PROGRESS_TIMER = null;
     }
   }
 

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -189,6 +189,7 @@ protected void setStateAndUi(int state) {
 //        if (JCMediaManager.instance().listener == this) {
 //          JCMediaManager.instance().releaseMediaPlayer();
         cancelProgressTimer();
+        progressBar.setProgress(100);
 //        }
         break;
     }
@@ -556,7 +557,6 @@ public void onAutoCompletion() {
       IF_FULLSCREEN_FROM_NORMAL = false;
       JCMediaManager.instance().lastListener.onAutoCompletion();
     }
-    JCMediaManager.instance().listener = null;
     JCMediaManager.instance().lastListener = null;
     AudioManager mAudioManager = (AudioManager) getContext().getSystemService(Context.AUDIO_SERVICE);
     mAudioManager.abandonAudioFocus(onAudioFocusChangeListener);

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerStandard.java
Patch:
@@ -100,6 +100,7 @@ protected void setStateAndUi(int state) {
       case CURRENT_STATE_COMPLETE:
         changeUiToShowUiComplete();
         cancelDismissControlViewTimer();
+        bottomProgressBar.setProgress(100);
         break;
     }
   }

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/DemoApplication.java
Patch:
@@ -24,7 +24,6 @@ public class DemoApplication extends Application {
   @Override
   public void onCreate() {
     super.onCreate();
-    JCVideoPlayer.DEBUG = true;
     initUniversalImageLoader();
   }
 

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -166,6 +166,7 @@ protected void setStateAndUi(int state) {
         break;
       case CURRENT_STATE_ERROR:
         JCMediaManager.instance().mediaPlayer.release();
+        onCompletion();
         break;
     }
   }

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/View/JCVideoPlayerStandardFresco.java
Patch:
@@ -126,7 +126,7 @@ public void onClick(View v) {
         startDismissControlViewTimer();
       }
     } else if (i == R.id.surface_container) {
-      if (jc_BuriedPointStandard != null && JCMediaManager.intance().listener == this) {
+      if (jc_BuriedPointStandard != null && JCMediaManager.instance().listener == this) {
         if (IF_CURRENT_IS_FULLSCREEN) {
           jc_BuriedPointStandard.onClickBlankFullscreen(url, objects);
         } else {

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCFullScreenActivity.java
Patch:
@@ -86,7 +86,7 @@ protected void onCreate(Bundle savedInstanceState) {
       jcVideoPlayer.ivStart.performClick();
     } else {
       JCVideoPlayer.IF_RELEASE_WHEN_ON_PAUSE = true;
-      JCMediaManager.intance().listener = jcVideoPlayer;
+      JCMediaManager.instance().listener = jcVideoPlayer;
     }
   }
 

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCMediaManager.java
Patch:
@@ -26,7 +26,7 @@ public class JCMediaManager implements MediaPlayer.OnPreparedListener, MediaPlay
   public JCMediaPlayerListener lastListener;
   public int lastState;
 
-  public static JCMediaManager intance() {
+  public static JCMediaManager instance() {
     if (jcMediaManager == null) {
       jcMediaManager = new JCMediaManager();
     }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCResizeSurfaceView.java
Patch:
@@ -26,8 +26,8 @@ public JCResizeSurfaceView(Context context, AttributeSet attrs) {
 
   @Override
   protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
-    int mVideoWidth = JCMediaManager.intance().currentVideoWidth;
-    int mVideoHeight = JCMediaManager.intance().currentVideoHeight;
+    int mVideoWidth = JCMediaManager.instance().currentVideoWidth;
+    int mVideoHeight = JCMediaManager.instance().currentVideoHeight;
 
     int width = getDefaultSize(mVideoWidth, widthMeasureSpec);
     int height = getDefaultSize(mVideoHeight, heightMeasureSpec);

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerStandard.java
Patch:
@@ -108,7 +108,7 @@ public boolean onTouch(View v, MotionEvent event) {
         case MotionEvent.ACTION_UP:
           startDismissControlViewTimer();
           if (changePosition) {
-            int duration = JCMediaManager.intance().mediaPlayer.getDuration();
+            int duration = JCMediaManager.instance().mediaPlayer.getDuration();
             int progress = resultTimePosition * 100 / (duration == 0 ? 1 : duration);
             pbBottom.setProgress(progress);
           }
@@ -147,7 +147,7 @@ public void onClick(View v) {
         startDismissControlViewTimer();
       }
     } else if (i == R.id.surface_container) {
-      if (jc_BuriedPointStandard != null && JCMediaManager.intance().listener == this) {
+      if (jc_BuriedPointStandard != null && JCMediaManager.instance().listener == this) {
         if (IF_CURRENT_IS_FULLSCREEN) {
           jc_BuriedPointStandard.onClickBlankFullscreen(url, objects);
         } else {

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -530,7 +530,7 @@ public void onSeekComplete() {
 
   @Override
   public void onError(int what, int extra) {
-    if (what != 38) {
+    if (what != 38 && what != -38) {
       setStateAndUi(CURRENT_STATE_ERROR);
     }
   }
@@ -562,7 +562,7 @@ public void run() {
           ((Activity) getContext()).runOnUiThread(new Runnable() {
             @Override
             public void run() {
-              if (CURRENT_STATE == CURRENT_STATE_PLAYING) {
+              if (CURRENT_STATE == CURRENT_STATE_PLAYING || CURRENT_STATE == CURRENT_STATE_PAUSE) {
                 setTextAndProgress(0);
               }
             }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -337,13 +337,15 @@ public boolean onTouch(View v, MotionEvent event) {
     } else if (id == R.id.progress) {//if I am seeking bar,no mater whoever can not intercept my event
       switch (event.getAction()) {
         case MotionEvent.ACTION_DOWN:
+          cancelProgressTimer();
           ViewParent vpdown = getParent();
           while (vpdown != null) {
             vpdown.requestDisallowInterceptTouchEvent(true);
             vpdown = vpdown.getParent();
           }
           break;
         case MotionEvent.ACTION_UP:
+          startProgressTimer();
           ViewParent vpup = getParent();
           while (vpup != null) {
             vpup.requestDisallowInterceptTouchEvent(false);

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -104,7 +104,6 @@ public void setUp(String url, Object... objects) {
             return;
         CURRENT_STATE = CURRENT_STATE_NORMAL;
         this.url = url;
-        resetProgressAndTime();
         this.objects = objects;
         setStateAndUi(CURRENT_STATE_NORMAL);
     }
@@ -114,7 +113,6 @@ protected void setStateAndUi(int state) {
         CURRENT_STATE = state;
         switch (CURRENT_STATE) {
             case CURRENT_STATE_NORMAL:
-                cancelProgressTimer();
                 if (JCMediaManager.intance().listener == this) {
                     JCMediaManager.intance().mediaPlayer.release();
                 }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -98,13 +98,13 @@ protected static void setJcBuriedPoint(JCBuriedPoint jcBuriedPoint) {
         JC_BURIED_POINT = jcBuriedPoint;
     }
 
-    public void setUp(String url, Object... obj) {
+    public void setUp(String url, Object... objects) {
         if (JCMediaManager.intance().listener == this && (System.currentTimeMillis() - CLICK_QUIT_FULLSCREEN_TIME) < FULL_SCREEN_NORMAL_DELAY)
             return;
         CURRENT_STATE = CURRENT_STATE_NORMAL;
         this.url = url;
         resetProgressAndTime();
-        this.objects = obj;
+        this.objects = objects;
         setStateAndUi(CURRENT_STATE_NORMAL);
     }
 

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerStandard.java
Patch:
@@ -54,6 +54,7 @@ protected void init(Context context) {
 
     @Override
     public void setUp(String url, Object... objects) {
+        if (objects.length == 0) return;
         super.setUp(url, objects);
         tvTitle.setText(objects[0].toString());
         if (IF_CURRENT_IS_FULLSCREEN) {

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -116,8 +116,10 @@ protected void setStateAndUi(int state) {
             case CURRENT_STATE_PREPAREING:
                 break;
             case CURRENT_STATE_PLAYING:
+                startProgressTimer();
                 break;
             case CURRENT_STATE_PAUSE:
+                startProgressTimer();
                 break;
             case CURRENT_STATE_ERROR:
                 JCMediaManager.intance().mediaPlayer.release();

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerStandard.java
Patch:
@@ -263,7 +263,8 @@ public void run() {
                     ((Activity) getContext()).runOnUiThread(new Runnable() {
                         @Override
                         public void run() {
-                            if (CURRENT_STATE != CURRENT_STATE_NORMAL) {
+                            if (CURRENT_STATE != CURRENT_STATE_NORMAL
+                                    && CURRENT_STATE != CURRENT_STATE_ERROR) {
                                 llBottomControl.setVisibility(View.INVISIBLE);
                                 llTopContainer.setVisibility(View.INVISIBLE);
                                 pbBottom.setVisibility(View.VISIBLE);

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerSimple.java
Patch:
@@ -51,6 +51,7 @@ public void setStateAndUi(int state) {
         super.setStateAndUi(state);
         switch (CURRENT_STATE) {
             case CURRENT_STATE_NORMAL:
+                ivStart.setVisibility(View.VISIBLE);
                 break;
             case CURRENT_STATE_PREPAREING:
                 ivStart.setVisibility(View.INVISIBLE);
@@ -60,6 +61,8 @@ public void setStateAndUi(int state) {
                 break;
             case CURRENT_STATE_PAUSE:
                 break;
+            case CURRENT_STATE_ERROR:
+                break;
         }
         updateStartImage();
     }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerSimple.java
Patch:
@@ -44,7 +44,6 @@ public void setUp(String url, Object... objects) {
         } else {
             ivFullScreen.setImageResource(R.drawable.jc_enlarge);
         }
-        setStateAndUi(CURRENT_STATE_NORMAL);
     }
 
     @Override

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerStandard.java
Patch:
@@ -59,7 +59,6 @@ public void setUp(String url, Object... objects) {
             ivFullScreen.setImageResource(R.drawable.jc_enlarge);
             ivBack.setVisibility(View.GONE);
         }
-        setStateAndUi(CURRENT_STATE_NORMAL);
     }
 
     @Override

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCFullScreenActivity.java
Patch:
@@ -80,8 +80,8 @@ protected void onCreate(Bundle savedInstanceState) {
 
         jcVideoPlayer.IF_CURRENT_IS_FULLSCREEN = true;
         jcVideoPlayer.IF_FULLSCREEN_IS_DIRECTLY = DIRECT_FULLSCREEN;
-        jcVideoPlayer.addSurfaceView();
         jcVideoPlayer.setUp(URL, OBJECTS);
+        jcVideoPlayer.addSurfaceView();
         jcVideoPlayer.setStateAndUi(CURRENT_STATE);
 
 

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerSimple.java
Patch:
@@ -44,6 +44,7 @@ public void setUp(String url, Object... objects) {
         } else {
             ivFullScreen.setImageResource(R.drawable.jc_enlarge);
         }
+        setStateAndUi(CURRENT_STATE_NORMAL);
     }
 
     @Override

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayerStandard.java
Patch:
@@ -114,8 +114,9 @@ public void onClick(View v) {
         } else if (i == R.id.parentview) {
             onClickUiToggle();
             startDismissControlViewTimer();
+        } else if (i == R.id.back) {
+            backFullscreen();
         }
-
     }
 
     private void onClickUiToggle() {

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -776,6 +776,7 @@ public static void toFullscreenActivity(Context context, String url, String titl
 
     @Override
     public void onPrepared() {
+        if (surfaceHolder.getSurface() == null || !surfaceHolder.getSurface().isValid()) return;
         if (CURRENT_STATE != CURRENT_STATE_PREPAREING) return;
         JCMediaManager.intance().mediaPlayer.setDisplay(surfaceHolder);
         JCMediaManager.intance().mediaPlayer.start();

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -229,6 +229,8 @@ public void onClick(View v) {
                 }
             }
             if (CURRENT_STATE == CURRENT_STATE_NORMAL || CURRENT_STATE == CURRENT_STATE_ERROR) {
+                touchingProgressBar = false;//This should not be here , but this can improve accident bug .
+
                 addSurfaceView();
 
                 if (JCMediaManager.intance().listener != null) {

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCMediaManager.java
Patch:
@@ -86,7 +86,7 @@ public void onSeekComplete(MediaPlayer mp) {
     @Override
     public boolean onError(MediaPlayer mp, int what, int extra) {
         if (listener != null) {
-            listener.onError();
+            listener.onError(what, extra);
         }
         return true;
     }
@@ -114,7 +114,7 @@ interface JCMediaPlayerListener {
 
         void onSeekComplete();
 
-        void onError();
+        void onError(int what, int extra);
 
         void onVideoSizeChanged();
 

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCMediaManager.java
Patch:
@@ -86,7 +86,7 @@ public void onSeekComplete(MediaPlayer mp) {
     @Override
     public boolean onError(MediaPlayer mp, int what, int extra) {
         if (listener != null) {
-            listener.onError();
+            listener.onError(what, extra);
         }
         return true;
     }
@@ -114,7 +114,7 @@ interface JCMediaPlayerListener {
 
         void onSeekComplete();
 
-        void onError();
+        void onError(int what, int extra);
 
         void onVideoSizeChanged();
 

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCFullScreenActivity.java
Patch:
@@ -76,7 +76,6 @@ protected void onCreate(Bundle savedInstanceState) {
                 JCMediaManager.intance().listener.onCompletion();
             }
             JCMediaManager.intance().listener = jcVideoPlayer;
-
         }
     }
 

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -323,7 +323,7 @@ public void onClick(View v) {
         }
     }
 
-    private void addSurfaceView() {
+    void addSurfaceView() {
         if (rlParent.getChildAt(0) instanceof ResizeSurfaceView) {
             rlParent.removeViewAt(0);
         }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -420,6 +420,7 @@ private void changeUiToShowUiPrepareing() {
     private void changeUiToClearUiPrepareing() {
         changeUiToClearUi();
         pbLoading.setVisibility(View.VISIBLE);
+        ivCover.setVisibility(View.VISIBLE);
     }
 
     private void changeUiToShowUiPlaying() {

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCFullScreenActivity.java
Patch:
@@ -81,15 +81,15 @@ protected void onCreate(Bundle savedInstanceState) {
 
     @Override
     public void onBackPressed() {
+        JCVideoPlayer.isClickFullscreen = false;
         jcVideoPlayer.quitFullScreen();
-        super.onBackPressed();
     }
 
     @Override
     protected void onPause() {
         super.onPause();
         if (!manualQuit) {
-            jcVideoPlayer.isClickFullscreen = false;
+            JCVideoPlayer.isClickFullscreen = false;
             JCVideoPlayer.releaseAllVideos();
             finish();
         }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -185,6 +185,7 @@ public void setUpForFullscreen(String url, String title) {
         this.url = url;
         this.title = title;
         setIfShowTitle(true);
+        ifFullScreen = true;
         if (ifFullScreen) {
             ivFullScreen.setImageResource(shrinkRecId == 0 ? R.drawable.shrink_video : shrinkRecId);
         } else {

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/MainActivity.java
Patch:
@@ -40,13 +40,13 @@ protected void onCreate(Bundle savedInstanceState) {
         videoController2.setUp("http://2449.vod.myqcloud.com/2449_bfbbfa3cea8f11e5aac3db03cda99974.f20.mp4",//
                 "嫂子还摸我", false);
         ImageLoader.getInstance().displayImage("http://p.qpic.cn/videoyun/0/2449_bfbbfa3cea8f11e5aac3db03cda99974_1/640",
-                videoController1.ivThumb);
+                videoController2.ivThumb);
 
         videoController3 = (JCVideoPlayer) findViewById(R.id.videocontroller3);
         videoController3.setUp("http://121.40.64.47/resource/mp3/music_yangguang3.mp3",
                 "嫂子别闹");
         ImageLoader.getInstance().displayImage("http://p.qpic.cn/videoyun/0/2449_38e65894d9e211e5b0e0a3699ca1d490_1/640",
-                videoController1.ivThumb);
+                videoController3.ivThumb);
 
         btnToList = (Button) findViewById(R.id.to_list_activity);
         btnToListViewpager = (Button) findViewById(R.id.to_list_viewpager_activity);

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -561,7 +561,8 @@ private void setProgressBuffered(int secProgress) {
     private void setProgressAndTimeFromTimer() {
         int position = JCMediaManager.intance().mediaPlayer.getCurrentPosition();
         int duration = JCMediaManager.intance().mediaPlayer.getDuration();
-        int progress = position * 100 / duration;
+        // if duration == 0 (e.g. in HLS streams) avoids ArithmeticException
+        int progress = position * 100 / (duration==0?1:duration);
         setProgressAndTime(progress, position, duration);
     }
 

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -683,7 +683,6 @@ public void surfaceDestroyed(SurfaceHolder holder) {
     public static void releaseAllVideos() {
         if (!isClickFullscreen) {
             JCMediaManager.intance().mediaPlayer.stop();
-            JCMediaManager.intance().mediaPlayer = null;
             JCMediaManager.intance().setUuid("");
             JCMediaManager.intance().setUuid("");
             EventBus.getDefault().post(new VideoEvents().setType(VideoEvents.VE_MEDIAPLAYER_FINISH_COMPLETE));

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/FullScreenActivity.java
Patch:
@@ -29,7 +29,7 @@ static void toActivityFromNormal(Context context, int state, String url, String
         context.startActivity(intent);
     }
 
-    public static void toActivity(Context context, String url, String thumb, String title) {
+    static void toActivity(Context context, String url, String thumb, String title) {
         STATE = JCVideoPlayer.CURRENT_STATE_NORMAL;
         URL = url;
         THUMB = thumb;

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/DemoApplication.java
Patch:
@@ -31,10 +31,10 @@ public class DemoApplication extends Application {
     public void onCreate() {
         super.onCreate();
         application = this;
-
+        initUniversalImageLoader();
 //        JCVideoPlayer.setGlobleSkin(R.color.colorPrimary, R.color.colorAccent, R.drawable.skin_seek_progress,
 //                R.color.bottom_bg, R.drawable.skin_enlarge_video, R.drawable.skin_shrink_video);
-        initUniversalImageLoader();
+//        JCVideoPlayer.setThumbImageViewScalType(ImageView.ScaleType.FIT_XY);
     }
 
     private void initUniversalImageLoader() {

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/ListViewpagerActivity.java
Patch:
@@ -53,7 +53,7 @@ public void onPageScrolled(int position, float positionOffset, int positionOffse
 
     @Override
     public void onPageSelected(int position) {
-        JCVideoPlayer.releaseAllVideo();
+        JCVideoPlayer.releaseAllVideos();
     }
 
     @Override

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/MainActivity.java
Patch:
@@ -48,7 +48,7 @@ protected void onCreate(Bundle savedInstanceState) {
     @Override
     protected void onPause() {
         super.onPause();
-        JCVideoPlayer.releaseAllVideo();
+        JCVideoPlayer.releaseAllVideos();
     }
 
     @Override
@@ -91,7 +91,7 @@ public void onEventMainThread(VideoEvents event) {
 
     @Override
     public void onClick(View v) {
-        JCVideoPlayer.releaseAllVideo();
+        JCVideoPlayer.releaseAllVideos();
         switch (v.getId()) {
             case R.id.to_list_activity:
                 startActivity(new Intent(MainActivity.this, ListActivity.class));

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/FullScreenActivity.java
Patch:
@@ -46,7 +46,7 @@ protected void onCreate(Bundle savedInstanceState) {
         jcVideoPlayer = (JCVideoPlayer) findViewById(R.id.jcvideoplayer);
         jcVideoPlayer.setUpForFullscreen(URL, THUMB, TITLE);
         jcVideoPlayer.setState(STATE);
-        JCMediaPlayer.intance().setUuid(jcVideoPlayer.uuid);
+        JCMediaManager.intance().setUuid(jcVideoPlayer.uuid);
         manualQuit = false;
     }
 
@@ -65,7 +65,8 @@ public void onBackPressed() {
     protected void onPause() {
         super.onPause();
         if (!manualQuit) {
-            JCVideoPlayer.releaseAllVideo();
+            jcVideoPlayer.isClickFullscreen = false;
+            JCVideoPlayer.releaseAllVideos();
             finish();
         }
     }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/ResizeSurfaceView.java
Patch:
@@ -21,8 +21,8 @@ public ResizeSurfaceView(Context context, AttributeSet attrs) {
     protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
         //Log.i("@@@@", "onMeasure(" + MeasureSpec.toString(widthMeasureSpec) + ", "
         //        + MeasureSpec.toString(heightMeasureSpec) + ")");
-        int mVideoWidth = JCMediaPlayer.intance().currentVideoWidth;
-        int mVideoHeight = JCMediaPlayer.intance().currentVideoHeight;
+        int mVideoWidth = JCMediaManager.intance().currentVideoWidth;
+        int mVideoHeight = JCMediaManager.intance().currentVideoHeight;
 
         int width = getDefaultSize(mVideoWidth, widthMeasureSpec);
         int height = getDefaultSize(mVideoHeight, heightMeasureSpec);

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -151,6 +151,9 @@ public void setUp(String url, String thumb, String title, boolean ifShowTitle) {
         ImageLoader.getInstance().displayImage(thumb, ivThumb, getDefaultDisplayImageOption());
         CURRENT_STATE = CURRENT_STATE_NORMAL;
         setTitleVisibility(View.VISIBLE);
+        if (uuid.equals(JCMediaPlayer.intance().uuid)) {
+            JCMediaPlayer.intance().mediaPlayer.stop();
+        }
     }
 
     public void setUpForFullscreen(String url, String thumb, String title, boolean ifFullScreen) {

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCMediaPlayer.java
Patch:
@@ -68,7 +68,7 @@ public void onCompletion(MediaPlayer mp) {
 
     @Override
     public void onBufferingUpdate(MediaPlayer mp, int percent) {
-        VideoEvents videoEvents = new VideoEvents().setType(VideoEvents.VE_MEDIAPLAYER_BUFFERUPDATE);
+        VideoEvents videoEvents = new VideoEvents().setType(VideoEvents.VE_MEDIAPLAYER_UPDATE_BUFFER);
         videoEvents.obj = percent;
         EventBus.getDefault().post(videoEvents);
     }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/VideoEvents.java
Patch:
@@ -12,7 +12,8 @@ public class VideoEvents {
     public static final int VE_SURFACEHOLDER_CREATED = 366005;
     public static final int VE_SURFACEHOLDER_FINISH_FULLSCREEN = 366006;
     public static final int VE_MEDIAPLAYER_FINISH_COMPLETE = 366007;
-    public static final int VE_MEDIAPLAYER_BUFFERUPDATE = 366008;
+    public static final int VE_MEDIAPLAYER_UPDATE_BUFFER = 366008;
+    public static final int VE_MEDIAPLAYER_UPDATE_PROGRESS = 366011;
     public static final int VE_MEDIAPLAYER_SEEKCOMPLETE = 366009;
     public static final int VE_MEDIAPLAYER_RESIZE = 366010;
 

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/MainActivity.java
Patch:
@@ -23,8 +23,8 @@ protected void onCreate(Bundle savedInstanceState) {
                 "嫂子别摸我");
 
         videoController2 = (JCVideoPlayer) findViewById(R.id.videocontroller2);
-        videoController2.setUp("http://2449.vod.myqcloud.com/2449_a80a72289b1211e5a28d6dc08193c3c9.f20.mp4",//
-                "http://cos.myqcloud.com/1000264/qcloud_video_attachment/842646334/vod_cover/cover1449294460.jpg",
+        videoController2.setUp("http://2449.vod.myqcloud.com/2449_ded7b566b37911e5942f0b208e48548d.f20.mp4",//
+                "http://p.qpic.cn/videoyun/0/2449_ded7b566b37911e5942f0b208e48548d_2/640",
                 "嫂子还摸我", false);
         EventBus.getDefault().register(this);
     }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -214,6 +214,7 @@ public void setState(int state) {
             setTitleVisibility(View.VISIBLE);
             ivThumb.setVisibility(View.INVISIBLE);
             ivCover.setVisibility(View.INVISIBLE);
+            pbLoading.setVisibility(View.INVISIBLE);
         } else if (CURRENT_STATE == CURRENT_STATE_PAUSE) {
             updateStartImage();
             ivStart.setVisibility(View.VISIBLE);

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/MainActivity.java
Patch:
@@ -65,6 +65,5 @@ public void onEventMainThread(VideoEvents event) {
         } else if (event.type == VideoEvents.POINT_QUIT_FULLSCREEN) {
             Log.i("Video Event", "POINT_QUIT_FULLSCREEN");
         }
-//        Log.i("Video Event", "type : " + event.type);
     }
 }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -231,6 +231,7 @@ public void setState(int state) {
             llBottomControl.setVisibility(View.INVISIBLE);
             pbBottom.setVisibility(View.VISIBLE);
             ivCover.setVisibility(View.VISIBLE);
+            setTitleVisibility(View.VISIBLE);
             updateStartImage();
             cancelDismissControlViewTimer();
             cancelBufferTimer();

File: app/src/main/java/fm/jiecao/jiecaovideoplayer/MainActivity.java
Patch:
@@ -20,12 +20,12 @@ protected void onCreate(Bundle savedInstanceState) {
         videoController1 = (JCVideoPlayer) findViewById(R.id.videocontroller1);
         videoController1.setUp("http://2449.vod.myqcloud.com/2449_43b6f696980311e59ed467f22794e792.f20.mp4",
                 "http://p.qpic.cn/videoyun/0/2449_43b6f696980311e59ed467f22794e792_1/640",
-                "嫂子别摸我", false);
+                "嫂子别摸我");
 
         videoController2 = (JCVideoPlayer) findViewById(R.id.videocontroller2);
-        videoController2.setUp("http://2449.vod.myqcloud.com/2449_a80a72289b1211e5a28d6dc08193c3c9.f20.mp4",
+        videoController2.setUp("http://2449.vod.myqcloud.com/2449_a80a72289b1211e5a28d6dc08193c3c9.f20.mp4",//
                 "http://cos.myqcloud.com/1000264/qcloud_video_attachment/842646334/vod_cover/cover1449294460.jpg",
-                "嫂子还摸我", false, false);
+                "嫂子还摸我", false);
         EventBus.getDefault().register(this);
     }
 

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCMediaPlayer.java
Patch:
@@ -4,6 +4,7 @@
 import android.media.AudioManager;
 import android.media.MediaPlayer;
 import android.net.Uri;
+import android.text.TextUtils;
 import android.util.Log;
 
 import java.io.IOException;
@@ -37,6 +38,7 @@ public JCMediaPlayer() {
     }
 
     public void prepareToPlay(Context context, String url) {
+        if (TextUtils.isEmpty(url)) return;
         try {
             mediaPlayer.release();
             mediaPlayer = new MediaPlayer();

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -305,7 +305,7 @@ private void dismissControlView() {
         pbBottom.setVisibility(View.VISIBLE);
         setTitleVisibility(View.INVISIBLE);
         ivStart.setVisibility(View.INVISIBLE);
-        pbLoading.setVisibility(View.INVISIBLE);
+//        pbLoading.setVisibility(View.INVISIBLE);
     }
 
     public void setIfShowTitle(boolean ifShowTitle) {

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -477,6 +477,7 @@ public void onEventMainThread(VideoEvents videoEvents) {
             return;
         }
         if (videoEvents.type == VideoEvents.VE_PREPARED) {
+            if (CURRENT_STATE != CURRENT_STATE_PREPAREING) return;
             JCMediaPlayer.intance().mediaPlayer.setDisplay(surfaceHolder);
             JCMediaPlayer.intance().mediaPlayer.start();
             pbLoading.setVisibility(View.INVISIBLE);

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -504,6 +504,7 @@ public void onEventMainThread(VideoEvents videoEvents) {
                 JCMediaPlayer.intance().mediaPlayer.setDisplay(surfaceHolder);
                 stopToFullscreenOrQuitFullscreenShowDisplay();
                 isFromFullScreenBackHere = false;
+                startDismissControlViewTimer();
             }
         } else if (videoEvents.type == VideoEvents.VE_MEDIAPLAYER_RESIZE) {
             int mVideoWidth = JCMediaPlayer.intance().currentVideoWidth;
@@ -566,7 +567,7 @@ public void onStopTrackingTouch(SeekBar seekBar) {
     protected void onDetachedFromWindow() {
         super.onDetachedFromWindow();
         EventBus.getDefault().unregister(this);
-        cancelDismissControlViewTimer();
+//        cancelDismissControlViewTimer();
         if (uuid.equals(JCMediaPlayer.intance().uuid)) {
             JCMediaPlayer.intance().mediaPlayer.stop();
         }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -465,8 +465,6 @@ public void onEventMainThread(VideoEvents videoEvents) {
             //TODO 这里要将背景置黑，
 //            surfaceView.setBackgroundColor(R.color.black_a10_color);
                 CURRENT_STATE = CURRENT_STATE_NORMAL;
-            }
-//            }
             setKeepScreenOn(false);
         }
         if (!JCMediaPlayer.intance().uuid.equals(uuid)) {

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -190,6 +190,9 @@ public void setState(int state) {
             updateStartImage();
             cancelDismissControlViewTimer();
             cancelBufferTimer();
+            if (uuid.equals(JCMediaPlayer.intance().uuid)) {
+                JCMediaPlayer.intance().mediaPlayer.stop();
+            }
         }
 
     }

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoPlayer.java
Patch:
@@ -155,6 +155,8 @@ public void setUp(String url, String thumb, String title, boolean ifFullScreen)
         ivThumb.setVisibility(View.VISIBLE);
         ivStart.setVisibility(View.VISIBLE);
         llBottomControl.setVisibility(View.GONE);
+
+        ivThumb.setImageResource(R.drawable.ic_logo_small);
         ImageLoader.getInstance().displayImage(thumb, ivThumb);
         CURRENT_STATE = CURRENT_STATE_NORMAL;
         setTitleVisibility(View.VISIBLE);

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/ResizeSurfaceView.java
Patch:
@@ -1,6 +1,7 @@
 package fm.jiecao.jcvideoplayer_lib;
 
 import android.content.Context;
+import android.graphics.PixelFormat;
 import android.util.AttributeSet;
 import android.view.SurfaceView;
 
@@ -12,6 +13,7 @@
 public class ResizeSurfaceView extends SurfaceView {
     public ResizeSurfaceView(Context context, AttributeSet attrs) {
         super(context, attrs);
+        getHolder().setFormat(PixelFormat.TRANSPARENT);
     }
 
     @Override

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoView.java
Patch:
@@ -482,7 +482,7 @@ public void surfaceDestroyed(SurfaceHolder holder) {
     }
 
     private String stringForTime(int timeMs) {
-        if (timeMs <= 0) {
+        if (timeMs <= 0 || timeMs >= 24 * 60 * 60 * 1000) {
             return "00:00";
         }
         int totalSeconds = timeMs / 1000;

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoView.java
Patch:
@@ -119,6 +119,9 @@ public void setUp(String url, String thumb, String title, boolean ifFullScreen)
             ivFullScreen.setImageResource(R.drawable.enlarge_video);
         }
         tvTitle.setText(title);
+        ivThumb.setVisibility(View.VISIBLE);
+        ivStart.setVisibility(View.VISIBLE);
+        llBottomControl.setVisibility(View.GONE);
         ImageLoader.getInstance().displayImage(thumb, ivThumb);
         CURRENT_STATE = CURRENT_STATE_NORMAL;
         setTitleVisibility(View.VISIBLE);

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/FullScreenActivity.java
Patch:
@@ -47,9 +47,6 @@ protected void onCreate(Bundle savedInstanceState) {
         jcVideoView.setUp(URL, THUMB, TITLE, true);
         jcVideoView.setState(STATE);
         JCMediaPlayer.intance().setUuid(jcVideoView.uuid);
-//        jcVideoView.delaySetdisplay();
-        //TODO 来到全屏之后继续之前的状态，准备，播放，暂停
-
     }
 
     public void onEventMainThread(VideoEvents videoEvents) {

File: jcvideoplayer-lib/src/main/java/fm/jiecao/jcvideoplayer_lib/JCVideoView.java
Patch:
@@ -162,8 +162,8 @@ public void onClick(View v) {
             //此时如果是loading，正在播放，暂停
             JCMediaPlayer.intance().mediaPlayer.setDisplay(null);
             if (ifFullScreen) {
-                //把uuid指回到
-                JCMediaPlayer.intance().backUpUuid();
+                //退出全屏
+                JCMediaPlayer.intance().revertUuid();
                 VideoEvents videoEvents = new VideoEvents().setType(VideoEvents.VE_SURFACEHOLDER_FINISH_FULLSCREEN);
                 videoEvents.obj = CURRENT_STATE;
                 EventBus.getDefault().post(videoEvents);

