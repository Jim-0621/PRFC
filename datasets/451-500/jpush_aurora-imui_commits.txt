File: Android/sample/exampleui/src/main/java/imui/jiguang/cn/imuisample/messages/MessageListActivity.java
Patch:
@@ -134,7 +134,8 @@ public void onSendFiles(List<FileItem> list) {
                 if (list == null || list.isEmpty()) {
                     return;
                 }
-
+                // should reset messageList height
+                mChatView.setMsgListHeight(true);
                 MyMessage message;
                 for (FileItem item : list) {
                     if (item.getType() == FileItem.Type.Image) {

File: Android/sample/exampleui/src/main/java/imui/jiguang/cn/imuisample/messages/MessageListActivity.java
Patch:
@@ -681,6 +681,7 @@ public void run() {
     }
 
     private void scrollToBottom() {
+        mChatView.setMsgListHeight(false);
         new Handler().postDelayed(new Runnable() {
             @Override
             public void run() {
@@ -697,6 +698,7 @@ public boolean onTouch(View view, MotionEvent motionEvent) {
                 if (chatInputView.getMenuState() == View.VISIBLE) {
                     chatInputView.dismissMenuLayout();
                 }
+                mChatView.setMsgListHeight(true);
                 try {
                     View v = getCurrentFocus();
                     if (mImm != null && v != null) {

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/ChatInputView.java
Patch:
@@ -815,6 +815,7 @@ public void initCamera() {
             Camera.getCameraInfo(i, info);
             if (info.facing == Camera.CameraInfo.CAMERA_FACING_BACK) {
                 mCameraId = i;
+                mIsBackCamera = true;
                 break;
             }
         }

File: Android/sample/exampleui/src/main/java/imui/jiguang/cn/imuisample/messages/MessageListActivity.java
Patch:
@@ -209,6 +209,7 @@ public boolean switchToCameraMode() {
                     EasyPermissions.requestPermissions(MessageListActivity.this,
                             getResources().getString(R.string.rationale_camera),
                             RC_CAMERA, perms);
+                    return false;
                 } else {
                     File rootDir = getFilesDir();
                     String fileDir = rootDir.getAbsolutePath() + "/photo";

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/record/RecordVoiceButton.java
Patch:
@@ -94,6 +94,7 @@ public void setVoiceFilePath(String path, String fileName) {
         }
         //录音文件的命名格式
         myRecAudioFile = new File(path, fileName + ".m4a");
+        myRecAudioFile.setReadable(true,false);
         Log.i(TAG, "Create file success file path: " + myRecAudioFile.getAbsolutePath());
     }
 

File: Android/messagelist/src/main/java/cn/jiguang/imui/messages/PhotoViewHolder.java
Patch:
@@ -162,6 +162,7 @@ public void applyStyle(MessageListStyle style) {
         mDisplayNameTv.setTextColor(style.getDisplayNameTextColor());
         mDisplayNameTv.setPadding(style.getDisplayNamePaddingLeft(), style.getDisplayNamePaddingTop(),
                 style.getDisplayNamePaddingRight(), style.getDisplayNamePaddingBottom());
+        mDisplayNameTv.setEms(style.getDisplayNameEmsNumber());
         android.view.ViewGroup.LayoutParams layoutParams = mAvatarIv.getLayoutParams();
         layoutParams.width = style.getAvatarWidth();
         layoutParams.height = style.getAvatarHeight();

File: Android/messagelist/src/main/java/cn/jiguang/imui/messages/ptr/PullToRefreshLayout.java
Patch:
@@ -166,7 +166,7 @@ protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
 
     @Override
     public boolean dispatchTouchEvent(MotionEvent ev) {
-        if (!isEnabled() || mMsgList == null || mHeaderView == null) {
+        if (!isEnabled() || mMsgList == null || mHeaderView == null || !isPullToRefresh()) {
             return super.dispatchTouchEvent(ev);
         }
         int action = ev.getAction();

File: Android/messagelist/src/main/java/cn/jiguang/imui/messages/PhotoViewHolder.java
Patch:
@@ -46,6 +46,7 @@ public PhotoViewHolder(View itemView, boolean isSender) {
     @Override
     public void onBind(final MESSAGE message) {
         String timeString = message.getTimeString();
+        mDateTv.setVisibility(View.VISIBLE);
         if (timeString != null && !TextUtils.isEmpty(timeString)) {
             mDateTv.setText(timeString);
         } else {

File: Android/messagelist/src/main/java/cn/jiguang/imui/messages/TxtViewHolder.java
Patch:
@@ -45,6 +45,7 @@ public TxtViewHolder(View itemView, boolean isSender) {
     public void onBind(final MESSAGE message) {
         mMsgTv.setText(message.getText());
         String timeString = message.getTimeString();
+        mDateTv.setVisibility(View.VISIBLE);
         if (timeString != null && !TextUtils.isEmpty(timeString)) {
             mDateTv.setText(timeString);
         } else {

File: Android/messagelist/src/main/java/cn/jiguang/imui/messages/VideoViewHolder.java
Patch:
@@ -54,6 +54,7 @@ public VideoViewHolder(View itemView, boolean isSender) {
     @Override
     public void onBind(final Message message) {
         String timeString = message.getTimeString();
+        mDateTv.setVisibility(View.VISIBLE);
         if (timeString != null && !TextUtils.isEmpty(timeString)) {
             mDateTv.setText(timeString);
         } else {

File: Android/messagelist/src/main/java/cn/jiguang/imui/messages/VoiceViewHolder.java
Patch:
@@ -73,6 +73,7 @@ public boolean onError(MediaPlayer mp, int what, int extra) {
             }
         });
         String timeString = message.getTimeString();
+        mDateTv.setVisibility(View.VISIBLE);
         if (timeString != null && !TextUtils.isEmpty(timeString)) {
             mDateTv.setText(timeString);
         } else {

File: ReactNative/android/src/main/java/cn/jiguang/imui/messagelist/viewmanager/ReactChatInputManager.java
Patch:
@@ -284,7 +284,7 @@ public void run() {
             @Override
             public boolean switchToGalleryMode() {
                 String[] perms = new String[]{
-                        Manifest.permission.READ_EXTERNAL_STORAGE
+                        Manifest.permission.WRITE_EXTERNAL_STORAGE
                 };
 
                 if (!EasyPermissions.hasPermissions(activity, perms)) {
@@ -562,11 +562,13 @@ public void onPermissionsGranted(int requestCode, List<String> perms) {
                 break;
             case RC_SELECT_PHOTO:
                 mChatInput.showSelectPhotoLayout();
+                mChatInput.getSelectPhotoView().initData();
                 break;
             default:
                 mChatInput.showCameraLayout();
                 break;
         }
+        mChatInput.requestLayout();
     }
 
     @Override

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/record/RecordControllerView.java
Patch:
@@ -197,7 +197,7 @@ public void onActionUp() {
             default:
                 mRecordVoiceBtn.finishRecord(false);
                 if (mListener != null) {
-                    mListener.onRightUpTapped();
+                    mListener.onFinish();
                 }
         }
         mCurrentState = INIT_STATE;
@@ -226,5 +226,7 @@ public interface OnRecordActionListener {
         void onRightUpTapped();
 
         void onLeftUpTapped();
+
+        void onFinish();
     }
 }

File: ReactNative/android/src/main/java/cn/jiguang/imui/messagelist/view/ImageTarget.java
Patch:
@@ -55,6 +55,9 @@ private Bitmap resolveBitmap(Bitmap resource) {
             srcWidth = srcWidth * (200 * mDensity / srcHeight);
             srcHeight = 200 * mDensity;
         }
+        if (srcWidth < 60 * mDensity) {
+            srcWidth = 60 * mDensity;
+        }
         ViewGroup.LayoutParams params = mImageView.getLayoutParams();
         params.width = (int) srcWidth;
         params.height = (int) srcHeight;

File: Android/sample/exampleui/src/main/java/imui/jiguang/cn/imuisample/views/ChatView.java
Patch:
@@ -56,7 +56,7 @@ public void initModule() {
          * Should set menu container height once the ChatInputView has been initialized.
          * For perfect display, the height should be equals with soft input height.
          */
-        mChatInput.setMenuContainerHeight(831);
+        mChatInput.setMenuContainerHeight(819);
         mRecordVoiceBtn = mChatInput.getRecordVoiceButton();
         mSelectAlbumIb = mChatInput.getSelectAlbumBtn();
         PtrDefaultHeader header = new PtrDefaultHeader(getContext());

File: ReactNative/android/src/main/java/cn/jiguang/imui/messagelist/viewmanager/ReactChatInputManager.java
Patch:
@@ -494,6 +494,7 @@ public void onRecoverScreenClick() {
 
             @Override
             public void onCloseCameraClick() {
+                mShowMenu = false;
                 reactContext.getJSModule(RCTEventEmitter.class).receiveEvent(mChatInput.getId(), CLOSE_CAMERA_EVENT, null);
             }
 

File: Android/sample/exampleui/src/main/java/imui/jiguang/cn/imuisample/views/ChatView.java
Patch:
@@ -112,7 +112,7 @@ public void setCameraCaptureFile(String path, String fileName) {
     }
 
     public void setRecordVoiceListener(RecordVoiceListener listener) {
-        mRecordVoiceBtn.setRecordVoiceListener(listener);
+        mChatInput.setRecordVoiceListener(listener);
     }
 
     public void setOnCameraCallbackListener(OnCameraCallbackListener listener) {

File: ReactNative/android/src/main/java/cn/jiguang/imui/messagelist/viewmanager/ReactMsgListManager.java
Patch:
@@ -270,7 +270,6 @@ public void onEvent(MessageEvent event) {
                     Log.d("RCTMessageListManager", "Add message to start, message: " + rctMessage);
                     if (activity != null) {
                         mAdapter.addToStart(rctMessage, true);
-                        mMessageList.smoothScrollToPosition(0);
                     }
                 }
                 break;
@@ -279,7 +278,6 @@ public void onEvent(MessageEvent event) {
                 Log.d("RCTMessageListManager", "updating message, message: " + rctMessage);
                 if (activity != null) {
                     mAdapter.updateMessage(rctMessage.getMsgId(), rctMessage);
-                    mMessageList.smoothScrollBy(0, 1);
                 }
                 break;
             case RCT_INSERT_MESSAGES_ACTION:
@@ -294,6 +292,7 @@ public void onEvent(MessageEvent event) {
             default:
                 mAdapter.clear();
         }
+        mMessageList.requestLayout();
     }
 
     @Subscribe(threadMode = ThreadMode.MAIN)

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/ChatInputView.java
Patch:
@@ -608,7 +608,8 @@ public void run() {
                 // if finished recording video, send it
             } else if (mFinishRecordingVideo) {
                 if (mListener != null) {
-                    VideoItem video = new VideoItem(mVideoFilePath, null, null, null, mMediaPlayer.getDuration() / 1000);
+                    File file = new File(mVideoFilePath);
+                    VideoItem video = new VideoItem(mVideoFilePath, file.getName(), file.length() + "", System.currentTimeMillis() + "", mMediaPlayer.getDuration() / 1000);
                     List<FileItem> list = new ArrayList<>();
                     list.add(video);
                     mListener.onSendFiles(list);
@@ -627,6 +628,7 @@ public void run() {
             try {
                 mMediaPlayer.stop();
                 mMediaPlayer.release();
+                mCameraSupport.cancelRecordingVideo();
             } catch (IllegalStateException e) {
                 e.printStackTrace();
             }
@@ -635,7 +637,6 @@ public void run() {
             mIsRecordVideoMode = false;
             mIsRecordingVideo = false;
             if (mFinishRecordingVideo) {
-                mCameraSupport.cancelRecordingVideo();
                 mFinishRecordingVideo = false;
             }
         } else if (view.getId() == R.id.aurora_ib_camera_switch) {

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/photo/SelectPhotoView.java
Patch:
@@ -118,7 +118,6 @@ private boolean getPhotos() {
                             cursor.getString(cursor.getColumnIndex(MediaStore.Images.Media.DISPLAY_NAME));
                     String size = cursor.getString(cursor.getColumnIndex(MediaStore.Images.Media.SIZE));
                     String date = cursor.getString(cursor.getColumnIndex(MediaStore.Images.Media.DATE_ADDED));
-
                     FileItem item = new FileItem(path, fileName, size, date);
                     item.setType(FileItem.Type.Image);
                     mMedias.add(item);

File: ReactNative/android/src/main/java/cn/jiguang/imui/messagelist/ReactIMUIPackage.java
Patch:
@@ -12,7 +12,6 @@
 
 import cn.jiguang.imui.messagelist.viewmanager.ReactChatInputManager;
 import cn.jiguang.imui.messagelist.viewmanager.ReactMsgListManager;
-import cn.jiguang.imui.messagelist.viewmanager.ReactPhotoBrowserManager;
 
 /**
  * Created by caiyaoguan on 2017/5/24.
@@ -36,7 +35,6 @@ public List<ViewManager> createViewManagers(ReactApplicationContext reactContext
         List<ViewManager> viewManagers = new ArrayList<>();
         viewManagers.add(new ReactMsgListManager());
         viewManagers.add(new ReactChatInputManager());
-        viewManagers.add(new ReactPhotoBrowserManager());
         return  viewManagers;
     }
 }

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/photo/SelectPhotoView.java
Patch:
@@ -134,7 +134,8 @@ private boolean getVideos() {
         ContentResolver cr = getContext().getContentResolver();
         String[] projection = new String[]{
                 MediaStore.Video.VideoColumns.DATA, MediaStore.Video.VideoColumns.DURATION,
-                MediaStore.Video.VideoColumns.DISPLAY_NAME, MediaStore.Video.VideoColumns.DATE_ADDED
+                MediaStore.Video.VideoColumns.SIZE, MediaStore.Video.VideoColumns.DISPLAY_NAME,
+                MediaStore.Video.VideoColumns.DATE_ADDED
         };
 
         Cursor cursor = cr.query(videoUri, projection, null, null, null);

File: Android/sample/exampleui/src/main/java/imui/jiguang/cn/imuisample/messages/MessageListActivity.java
Patch:
@@ -30,7 +30,6 @@
 import android.widget.Toast;
 
 import com.bumptech.glide.Glide;
-import com.bumptech.glide.request.RequestOptions;
 
 import java.io.File;
 import java.text.SimpleDateFormat;
@@ -419,7 +418,7 @@ public void loadAvatarImage(ImageView avatarImageView, String string) {
                 } else {
                     Glide.with(getApplicationContext())
                             .load(string)
-                            .apply(new RequestOptions().placeholder(R.drawable.aurora_headicon_default))
+                            .placeholder(R.drawable.aurora_headicon_default)
                             .into(avatarImageView);
                 }
             }
@@ -429,7 +428,8 @@ public void loadImage(ImageView imageView, String string) {
                 // You can use other image load libraries.
                 Glide.with(getApplicationContext())
                         .load(string)
-                        .apply(new RequestOptions().fitCenter().placeholder(R.drawable.aurora_picture_not_found))
+                        .fitCenter()
+                        .placeholder(R.drawable.aurora_picture_not_found)
                         .into(imageView);
             }
         };

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/photo/SelectPhotoView.java
Patch:
@@ -148,9 +148,10 @@ private boolean getVideos() {
                 if (file.exists()) {
                     String name = cursor.getString(cursor.getColumnIndex(MediaStore.Video.Media.DISPLAY_NAME));
                     String date = cursor.getString(cursor.getColumnIndex(MediaStore.Video.Media.DATE_ADDED));
+                    String size = cursor.getString(cursor.getColumnIndex(MediaStore.Video.Media.SIZE));
                     long duration = cursor.getLong(cursor.getColumnIndex(MediaStore.Video.Media.DURATION));
 
-                    VideoItem item = new VideoItem(path, name, null, date, duration / 1000);
+                    VideoItem item = new VideoItem(path, name, size, date, duration / 1000);
                     item.setType(FileItem.Type.Video);
                     mMedias.add(item);
                 }

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/photo/PhotoAdapter.java
Patch:
@@ -103,8 +103,8 @@ public void onBindViewHolder(final PhotoViewHolder holder, int position) {
 
             long duration = ((VideoItem) item).getDuration();
             String durationStr = String.format(Locale.CHINA, "%02d:%02d",
-                    TimeUnit.MILLISECONDS.toMinutes(duration),
-                    TimeUnit.MILLISECONDS.toSeconds(duration));
+                    TimeUnit.SECONDS.toMinutes(duration),
+                    TimeUnit.SECONDS.toSeconds(duration));
 
             holder.tvDuration.setText(durationStr);
         }

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/photo/SelectPhotoView.java
Patch:
@@ -150,7 +150,7 @@ private boolean getVideos() {
                     String date = cursor.getString(cursor.getColumnIndex(MediaStore.Video.Media.DATE_ADDED));
                     long duration = cursor.getLong(cursor.getColumnIndex(MediaStore.Video.Media.DURATION));
 
-                    VideoItem item = new VideoItem(path, name, null, date, duration);
+                    VideoItem item = new VideoItem(path, name, null, date, duration / 1000);
                     item.setType(FileItem.Type.Video);
                     mMedias.add(item);
                 }

File: Android/messagelist/src/main/java/cn/jiguang/imui/commons/models/IMessage.java
Patch:
@@ -91,7 +91,7 @@ enum MessageStatus {
 
     /**
      * If message type is voice or video, get duration through this method.
-     * @return duration of audio or video
+     * @return duration of audio or video, TimeUnit: SECONDS.
      */
     long getDuration();
 

File: ReactNative/android/src/main/java/cn/jiguang/imui/messagelist/CustomViewHolder.java
Patch:
@@ -23,6 +23,7 @@
 import java.io.File;
 
 import cn.jiguang.imui.commons.models.IMessage;
+import cn.jiguang.imui.messagelist.model.RCTMessage;
 import cn.jiguang.imui.messages.BaseMessageViewHolder;
 import cn.jiguang.imui.messages.MessageListStyle;
 import cn.jiguang.imui.messages.MsgListAdapter;

File: ReactNative/android/src/main/java/cn/jiguang/imui/messagelist/event/MessageEvent.java
Patch:
@@ -2,7 +2,7 @@
 
 import javax.annotation.Nullable;
 
-import cn.jiguang.imui.messagelist.RCTMessage;
+import cn.jiguang.imui.messagelist.model.RCTMessage;
 
 public class MessageEvent {
 

File: ReactNative/android/src/main/java/cn/jiguang/imui/messagelist/model/RCTMessageDeserializer.java
Patch:
@@ -1,4 +1,4 @@
-package cn.jiguang.imui.messagelist;
+package cn.jiguang.imui.messagelist.model;
 
 import com.google.gson.JsonDeserializationContext;
 import com.google.gson.JsonDeserializer;

File: ReactNative/android/src/main/java/cn/jiguang/imui/messagelist/model/RCTUser.java
Patch:
@@ -1,4 +1,4 @@
-package cn.jiguang.imui.messagelist;
+package cn.jiguang.imui.messagelist.model;
 
 import com.google.gson.Gson;
 import com.google.gson.JsonElement;

File: ReactNative/android/src/main/java/cn/jiguang/imui/messagelist/viewmanager/ReactChatInputManager.java
Patch:
@@ -1,4 +1,4 @@
-package cn.jiguang.imui.messagelist;
+package cn.jiguang.imui.messagelist.viewmanager;
 
 import android.app.Activity;
 import android.graphics.BitmapFactory;
@@ -52,6 +52,7 @@
 import cn.jiguang.imui.chatinput.listener.RecordVoiceListener;
 import cn.jiguang.imui.chatinput.model.FileItem;
 import cn.jiguang.imui.chatinput.model.VideoItem;
+import cn.jiguang.imui.messagelist.AuroraIMUIModule;
 import cn.jiguang.imui.messagelist.event.GetTextEvent;
 import cn.jiguang.imui.messagelist.event.OnTouchMsgListEvent;
 import cn.jiguang.imui.messagelist.event.ScrollEvent;
@@ -351,6 +352,7 @@ public void onClick(View v) {
                 reactContext.getJSModule(RCTEventEmitter.class).receiveEvent(mChatInput.getId(), ON_CLICK_SELECT_ALBUM_EVENT, null);
             }
         });
+
         return mChatInput;
     }
 

File: Android/messagelist/src/main/java/cn/jiguang/imui/messages/PhotoViewHolder.java
Patch:
@@ -87,7 +87,7 @@ public void onClick(View view) {
             @Override
             public boolean onLongClick(View view) {
                 if (mMsgLongClickListener != null) {
-                    mMsgLongClickListener.onMessageLongClick(message);
+                    mMsgLongClickListener.onMessageLongClick(view, message);
                 } else {
                     if (BuildConfig.DEBUG) {
                         Log.w("MsgListAdapter", "Didn't set long click listener! Drop event.");

File: Android/messagelist/src/main/java/cn/jiguang/imui/messages/TxtViewHolder.java
Patch:
@@ -101,7 +101,7 @@ public void onClick(View view) {
             @Override
             public boolean onLongClick(View view) {
                 if (mMsgLongClickListener != null) {
-                    mMsgLongClickListener.onMessageLongClick(message);
+                    mMsgLongClickListener.onMessageLongClick(view, message);
                 } else {
                     if (BuildConfig.DEBUG) {
                         Log.w("MsgListAdapter", "Didn't set long click listener! Drop event.");

File: Android/messagelist/src/main/java/cn/jiguang/imui/messages/VideoViewHolder.java
Patch:
@@ -77,7 +77,7 @@ public void onClick(View view) {
 
             @Override
             public boolean onLongClick(View view) {
-                mMsgLongClickListener.onMessageLongClick(message);
+                mMsgLongClickListener.onMessageLongClick(view, message);
                 return false;
             }
         });

File: Android/messagelist/src/main/java/cn/jiguang/imui/messages/VoiceViewHolder.java
Patch:
@@ -182,7 +182,7 @@ public void onClick(View view) {
             @Override
             public boolean onLongClick(View view) {
                 if (mMsgLongClickListener != null) {
-                    mMsgLongClickListener.onMessageLongClick(message);
+                    mMsgLongClickListener.onMessageLongClick(view, message);
                 } else {
                     if (BuildConfig.DEBUG) {
                         Log.w("MsgListAdapter", "Didn't set long click listener! Drop event.");

File: Android/sample/exampleui/src/main/java/imui/jiguang/cn/imuisample/messages/BrowserImageActivity.java
Patch:
@@ -10,6 +10,7 @@
 import android.util.LruCache;
 import android.view.View;
 import android.view.ViewGroup;
+import android.widget.ImageView;
 
 import java.io.File;
 import java.util.ArrayList;
@@ -93,6 +94,7 @@ public boolean isViewFromObject(View view, Object object) {
         @Override
         public Object instantiateItem(ViewGroup container, int position) {
             PhotoView photoView = new PhotoView(true, BrowserImageActivity.this);
+            photoView.setScaleType(ImageView.ScaleType.CENTER_CROP);
             photoView.setTag(position);
             String path = mPathList.get(position);
             if (path != null) {

File: Android/sample/exampleui/src/main/java/imui/jiguang/cn/imuisample/messages/MessageListActivity.java
Patch:
@@ -31,7 +31,6 @@
 
 import com.bumptech.glide.Glide;
 import com.bumptech.glide.request.RequestOptions;
-import com.bumptech.glide.request.target.Target;
 
 import java.io.File;
 import java.text.SimpleDateFormat;
@@ -434,7 +433,7 @@ public void loadImage(ImageView imageView, String string) {
                 // You can use other image load libraries.
                 Glide.with(getApplicationContext())
                         .load(string)
-                        .apply(new RequestOptions().fitCenter().placeholder(R.drawable.aurora_picture_not_found).override(400, Target.SIZE_ORIGINAL))
+                        .apply(new RequestOptions().fitCenter().placeholder(R.drawable.aurora_picture_not_found))
                         .into(imageView);
             }
         };
@@ -476,7 +475,7 @@ public void onMessageClick(MyMessage message) {
 
         mAdapter.setMsgLongClickListener(new MsgListAdapter.OnMsgLongClickListener<MyMessage>() {
             @Override
-            public void onMessageLongClick(MyMessage message) {
+            public void onMessageLongClick(View view, MyMessage message) {
                 Toast.makeText(getApplicationContext(),
                         getApplicationContext().getString(R.string.message_long_click_hint),
                         Toast.LENGTH_SHORT).show();

File: Android/messagelist/src/main/java/cn/jiguang/imui/messages/PhotoViewHolder.java
Patch:
@@ -47,6 +47,8 @@ public PhotoViewHolder(View itemView, boolean isSender) {
     public void onBind(final MESSAGE message) {
         if (message.getTimeString() != null) {
             mDateTv.setText(message.getTimeString());
+        } else {
+            mDateTv.setVisibility(View.GONE);
         }
         boolean isAvatarExists = message.getFromUser().getAvatarFilePath() != null
                 && !message.getFromUser().getAvatarFilePath().isEmpty();

File: Android/messagelist/src/main/java/cn/jiguang/imui/messages/TxtViewHolder.java
Patch:
@@ -45,6 +45,8 @@ public void onBind(final MESSAGE message) {
         mMsgTv.setText(message.getText());
         if (message.getTimeString() != null) {
             mDateTv.setText(message.getTimeString());
+        } else {
+            mDateTv.setVisibility(View.GONE);
         }
         boolean isAvatarExists = message.getFromUser().getAvatarFilePath() != null
                 && !message.getFromUser().getAvatarFilePath().isEmpty();

File: Android/messagelist/src/main/java/cn/jiguang/imui/messages/VideoViewHolder.java
Patch:
@@ -53,6 +53,8 @@ public VideoViewHolder(View itemView, boolean isSender) {
     public void onBind(final Message message) {
         if (message.getTimeString() != null) {
             mTextDate.setText(message.getTimeString());
+        } else {
+            mTextDate.setVisibility(View.GONE);
         }
         boolean isAvatarExists = message.getFromUser().getAvatarFilePath() != null
                 && !message.getFromUser().getAvatarFilePath().isEmpty();

File: Android/messagelist/src/main/java/cn/jiguang/imui/messages/VoiceViewHolder.java
Patch:
@@ -73,6 +73,8 @@ public boolean onError(MediaPlayer mp, int what, int extra) {
         });
         if (message.getTimeString() != null) {
             mDateTv.setText(message.getTimeString());
+        } else {
+            mDateTv.setVisibility(View.GONE);
         }
         boolean isAvatarExists = message.getFromUser().getAvatarFilePath() != null
                 && !message.getFromUser().getAvatarFilePath().isEmpty();

File: ReactNative/android/src/main/java/cn/jiguang/imui/messagelist/ReactMsgListManager.java
Patch:
@@ -450,7 +450,7 @@ public void setDisplayNamePadding(PullToRefreshLayout root, ReadableMap map) {
     @ReactProp(name = "isAllowPullToRefresh")
     public void isAllowPullToRefresh(PullToRefreshLayout root, boolean flag) {
         mMessageList.forbidScrollToRefresh(!flag);
-        root.getHandler().che
+        root.setEnabledNextPtrAtOnce(false);
     }
 
     @ReactProp(name = "eventTextColor")
@@ -557,8 +557,6 @@ public void onDropViewInstance(PullToRefreshLayout view) {
 
     }
 
-    PtrDefaultHandler
-
     @Override
     public void onCatalystInstanceDestroy() {
         super.onCatalystInstanceDestroy();

File: ReactNative/android/src/main/java/cn/jiguang/imui/messagelist/ReactMsgListManager.java
Patch:
@@ -274,6 +274,7 @@ public void onEvent(MessageEvent event) {
                 Log.d("RCTMessageListManager", "updating message, message: " + rctMessage);
                 if (activity != null) {
                     mAdapter.updateMessage(rctMessage.getMsgId(), rctMessage);
+                    mMessageList.smoothScrollToPosition(0);
                 }
                 break;
             case RCT_INSERT_MESSAGES_ACTION:

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/ChatInputView.java
Patch:
@@ -135,7 +135,7 @@ public class ChatInputView extends LinearLayout
     private int mSoftKeyboardHeight;
     private int mNowh;
     private int mOldh;
-    public static int sMenuHeight = 800;
+    public static int sMenuHeight = 831;
 
     private boolean mShowSoftInput = false;
 
@@ -1217,7 +1217,7 @@ public void onGlobalLayout() {
                 if (mOldh != -1 && mNowh != mOldh) {
                     mShowSoftInput = mNowh > 0;
                     mSoftKeyboardHeight = mShowSoftInput ? mNowh : 0;
-                    sMenuHeight = mSoftKeyboardHeight;
+                    sMenuHeight = mSoftKeyboardHeight > 0 ? mSoftKeyboardHeight : 831;
                 }
                 mOldh = mNowh;
             } catch (Exception e) {

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/ChatInputView.java
Patch:
@@ -708,7 +708,7 @@ public void onPrepared(MediaPlayer mediaPlayer) {
                     mediaPlayer.start();
                 }
             });
-        } catch (IOException | IllegalArgumentException | IllegalStateException e) {
+        } catch (Exception e) {
             e.printStackTrace();
         }
     }

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/camera/CameraNew.java
Patch:
@@ -44,10 +44,8 @@
 import android.widget.Toast;
 
 import java.io.File;
-import java.io.FileNotFoundException;
 import java.io.FileOutputStream;
 import java.io.IOException;
-import java.io.OutputStream;
 import java.nio.ByteBuffer;
 import java.text.SimpleDateFormat;
 import java.util.ArrayList;

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/ChatInputView.java
Patch:
@@ -1011,7 +1011,7 @@ public void onAnimationEnd(Animator animator) {
                     requestLayout();
                     invalidate();
                 }
-                if (mSelectPhotoView.getSelectFiles().size() > 0) {
+                if (mSelectPhotoView.getSelectFiles() != null && mSelectPhotoView.getSelectFiles().size() > 0) {
                     mSendCountTv.setVisibility(View.VISIBLE);
                 }
             }

File: ReactNative/android/src/main/java/cn/jiguang/imui/messagelist/AuroraIMUIModule.java
Patch:
@@ -44,7 +44,9 @@ public String getName() {
     @Override
     public void initialize() {
         super.initialize();
-        EventBus.getDefault().register(this);
+        if (!EventBus.getDefault().isRegistered(this)) {
+            EventBus.getDefault().register(this);
+        }
     }
 
     @Override

File: ReactNative/android/src/main/java/cn/jiguang/imui/messagelist/ReactMsgListManager.java
Patch:
@@ -101,7 +101,9 @@ public String getName() {
     @SuppressWarnings("unchecked")
     @Override
     protected MessageList createViewInstance(final ThemedReactContext reactContext) {
-        EventBus.getDefault().register(this);
+        if (!EventBus.getDefault().isRegistered(this)) {
+            EventBus.getDefault().register(this);
+        }
         registerProximitySensorListener();
         IntentFilter intentFilter = new IntentFilter();
         intentFilter.addAction(Intent.ACTION_HEADSET_PLUG);

File: Android/messagelist/src/main/java/cn/jiguang/imui/messages/MsgListAdapter.java
Patch:
@@ -210,7 +210,7 @@ public int getItemViewType(int position) {
 
     private int getCustomType(IMessage message) {
         for (int i=0; i < mCustomMsgList.size(); i++) {
-            CustomMsgConfig config = mCustomMsgList.valueAt(0);
+            CustomMsgConfig config = mCustomMsgList.valueAt(i);
             if (message.getType().getCustomType() == config.getViewType()) {
                 return config.getViewType();
             }

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/ChatInputView.java
Patch:
@@ -77,7 +77,6 @@
 import sj.keyboard.interfaces.EmoticonClickListener;
 import sj.keyboard.utils.EmoticonsKeyboardUtils;
 import sj.keyboard.widget.EmoticonsEditText;
-import sj.keyboard.widget.SoftKeyboardSizeWatchLayout;
 
 public class ChatInputView extends LinearLayout
         implements View.OnClickListener, TextWatcher, RecordControllerView.OnRecordActionListener,
@@ -934,8 +933,8 @@ public void dismissEmojiLayout() {
     public void setMenuContainerHeight(int height) {
         if (height > 0) {
             sMenuHeight = height;
-            mMenuContainer.setLayoutParams(
-                    new LinearLayout.LayoutParams(RelativeLayout.LayoutParams.MATCH_PARENT, height));
+            ViewGroup.LayoutParams params = new LinearLayout.LayoutParams(LinearLayout.LayoutParams.MATCH_PARENT, height);
+            mMenuContainer.setLayoutParams(params);
         }
     }
 

File: ReactNative/android/src/main/java/cn/jiguang/imui/messagelist/event/LoadedEvent.java
Patch:
@@ -1,4 +1,4 @@
-package cn.jiguang.imui.messagelist;
+package cn.jiguang.imui.messagelist.event;
 
 
 public class LoadedEvent {

File: ReactNative/android/src/main/java/cn/jiguang/imui/messagelist/event/MessageEvent.java
Patch:
@@ -1,4 +1,6 @@
-package cn.jiguang.imui.messagelist;
+package cn.jiguang.imui.messagelist.event;
+
+import cn.jiguang.imui.messagelist.RCTMessage;
 
 public class MessageEvent {
 

File: ReactNative/android/src/main/java/cn/jiguang/imui/messagelist/event/ScrollEvent.java
Patch:
@@ -1,4 +1,4 @@
-package cn.jiguang.imui.messagelist;
+package cn.jiguang.imui.messagelist.event;
 
 public class ScrollEvent {
 

File: Android/sample/exampleui/src/main/java/imui/jiguang/cn/imuisample/messages/MessageListActivity.java
Patch:
@@ -245,7 +245,7 @@ public void onCancelVideoRecord() {
         mChatView.setOnTouchEditTextListener(new OnClickEditTextListener() {
             @Override
             public void onTouchEditText() {
-                mAdapter.getLayoutManager().scrollToPosition(0);
+//                mAdapter.getLayoutManager().scrollToPosition(0);
             }
         });
     }
@@ -431,6 +431,7 @@ public void onSizeChanged(int w, int h, int oldw, int oldh) {
         if (oldh - h > 300) {
             mChatView.setMenuHeight(oldh - h);
         }
+        mAdapter.getLayoutManager().scrollToPosition(0);
     }
 
     @Override

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/listener/OnMenuClickListener.java
Patch:
@@ -30,15 +30,15 @@ public interface OnMenuClickListener {
     /**
      * Fires when voice button is on click.
      */
-    void switchToMicrophoneMode();
+    boolean switchToMicrophoneMode();
 
     /**
      * Fires when photo button is on click.
      */
-    void switchToGalleryMode();
+    boolean switchToGalleryMode();
 
     /**
      * Fires when camera button is on click.
      */
-    void switchToCameraMode();
+    boolean switchToCameraMode();
 }
\ No newline at end of file

File: Android/messagelist/src/main/java/cn/jiguang/imui/messages/VoiceViewHolder.java
Patch:
@@ -173,7 +173,7 @@ public void onClick(View view) {
         });
     }
 
-    private void playVoice(int position, MESSAGE message) {
+    public void playVoice(int position, MESSAGE message) {
         mController.setLastPlayPosition(position, mIsSender);
         try {
             mMediaPlayer.reset();

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/camera/CameraSupport.java
Patch:
@@ -1,7 +1,7 @@
 package cn.jiguang.imui.chatinput.camera;
 
-import java.io.File;
 
+import cn.jiguang.imui.chatinput.listener.CameraEventListener;
 import cn.jiguang.imui.chatinput.listener.OnCameraCallbackListener;
 
 
@@ -11,6 +11,7 @@ public interface CameraSupport {
     void release();
     void takePicture();
     void setCameraCallbackListener(OnCameraCallbackListener listener);
+    void setCameraEventListener(CameraEventListener listener);
     void startRecordingVideo();
     void cancelRecordingVideo();
     String finishRecordingVideo();

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/camera/CameraSupport.java
Patch:
@@ -9,7 +9,6 @@ public interface CameraSupport {
     CameraSupport open(int cameraId, int width, int height, boolean isFacingBack);
     int getOrientation(int cameraId);
     void release();
-    void setOutputFile(File file);
     void takePicture();
     void setCameraCallbackListener(OnCameraCallbackListener listener);
     void startRecordingVideo();

File: Android/sample/exampleui/src/main/java/imui/jiguang/cn/imuisample/messages/MessageListActivity.java
Patch:
@@ -171,7 +171,8 @@ public void switchToCameraMode() {
                 } else {
                     File rootDir = getFilesDir();
                     String fileDir = rootDir.getAbsolutePath() + "/photo";
-                    mChatView.setCameraCaptureFile(fileDir, "temp_photo");
+                    mChatView.setCameraCaptureFile(fileDir, new SimpleDateFormat("yyyy-MM-dd-hhmmss",
+                            Locale.getDefault()).format(new Date()));
                 }
             }
         });

File: Android/messagelist/src/main/java/cn/jiguang/imui/messages/VoiceViewHolder.java
Patch:
@@ -122,11 +122,10 @@ public void onClick(View view) {
 //                    mVoiceAnimation.stop();
 //                    mVoiceAnimation = null;
 //                }
+                mController.notifyAnimStop();
                 if (mIsSender) {
-                    mController.notifyAnimStop(mSendDrawable);
                     mVoiceIv.setImageResource(mPlaySendAnim);
                 } else {
-                    mController.notifyAnimStop(mReceiveDrawable);
                     mVoiceIv.setImageResource(mPlayReceiveAnim);
                 }
                 mVoiceAnimation = (AnimationDrawable) mVoiceIv.getDrawable();
@@ -180,7 +179,7 @@ public void onClick(View view) {
     }
 
     private void playVoice(int position, MESSAGE message) {
-        mController.setLastPlayPosition(position);
+        mController.setLastPlayPosition(position, mIsSender);
         try {
             mMediaPlayer.reset();
             mFIS = new FileInputStream(message.getMediaFilePath());
@@ -257,6 +256,7 @@ public void applyStyle(MessageListStyle style) {
         mDateTv.setTextColor(style.getDateTextColor());
         mSendDrawable = style.getSendVoiceDrawable();
         mReceiveDrawable = style.getReceiveVoiceDrawable();
+        mController.setDrawable(mSendDrawable, mReceiveDrawable);
         mPlaySendAnim = style.getPlaySendVoiceAnim();
         mPlayReceiveAnim = style.getPlayReceiveVoiceAnim();
         if (mIsSender) {

File: Android/messagelist/src/main/java/cn/jiguang/imui/messages/ViewHolderController.java
Patch:
@@ -49,7 +49,7 @@ public void notifyAnimStop(int resId) {
     }
 
     public void remove(int position) {
-        if (mData.size() > 0) {
+        if (null != mData && mData.size() > 0) {
             mData.remove(position);
         }
     }

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/record/RecordVoiceButton.java
Patch:
@@ -125,9 +125,6 @@ public boolean onTouchEvent(MotionEvent event) {
                     mControllerView.setRecordButton(this);
                     mSetController = true;
                 }
-                if (mControllerView != null) {
-                    mControllerView.onActionDown();
-                }
 //                this.setText(mStyle.getTapDownText());
                 mIsPressed = true;
                 time1 = System.currentTimeMillis();
@@ -271,6 +268,9 @@ private void startRecording() {
             if (mListener != null) {
                 mListener.onStartRecord();
             }
+            if (mControllerView != null) {
+                mControllerView.onActionDown();
+            }
             recorder = new MediaRecorder();
             recorder.setAudioSource(MediaRecorder.AudioSource.MIC);
             recorder.setOutputFormat(MediaRecorder.OutputFormat.DEFAULT);

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/ChatInputView.java
Patch:
@@ -246,7 +246,9 @@ private void init(Context context) {
         mChatInput.setOnTouchListener(new OnTouchListener() {
             @Override
             public boolean onTouch(View view, MotionEvent motionEvent) {
-                mEditTextListener.onTouchEditText();
+                if (mEditTextListener != null) {
+                    mEditTextListener.onTouchEditText();
+                }
                 if (motionEvent.getAction() == MotionEvent.ACTION_DOWN && !mShowSoftInput) {
                     mShowSoftInput = true;
                     invisibleMenuLayout();

File: ReactNative/android/src/main/java/com/testrnimuiexample/MainApplication.java
Patch:
@@ -1,10 +1,8 @@
-package imui.jiguang.cn.imuirnexample;
+package com.testrnimuiexample;
 
 import android.app.Application;
 
 import com.facebook.react.ReactApplication;
-
-
 import com.facebook.react.ReactNativeHost;
 import com.facebook.react.ReactPackage;
 import com.facebook.react.shell.MainReactPackage;

File: Android/messagelist/src/main/java/cn/jiguang/imui/messages/MessageList.java
Patch:
@@ -50,6 +50,7 @@ public <MESSAGE extends IMessage> void setAdapter(MsgListAdapter<MESSAGE> adapte
 
         LinearLayoutManager layoutManager = new LinearLayoutManager(
                 getContext(), LinearLayoutManager.VERTICAL, true);
+        layoutManager.setStackFromEnd(true);
         setLayoutManager(layoutManager);
 
         adapter.setLayoutManager(layoutManager);

File: Android/imui/src/main/java/cn/jiguang/imui/messages/MsgListAdapter.java
Patch:
@@ -197,11 +197,11 @@ public void addToStart(MESSAGE message, boolean scrollToBottom) {
     /**
      * Add messages chronologically, to load last page of messages from history, use this method.
      *
-     * @param messages Last page of messages.
+     * @param messages Last page of messages. Should be ordered by date.
      */
     public void addToEnd(List<MESSAGE> messages) {
         int oldSize = mItems.size();
-        for (int i = 0; i < messages.size(); i++) {
+        for (int i = messages.size() - 1; i >= 0; i--) {
             MESSAGE message = messages.get(i);
             mItems.add(new Wrapper<>(message));
         }

File: Android/imui/src/main/java/cn/jiguang/imui/messages/PhotoViewHolder.java
Patch:
@@ -3,13 +3,13 @@
 
 import android.util.Log;
 import android.view.View;
+import android.view.ViewGroup;
 import android.widget.ImageView;
 import android.widget.TextView;
 
 import cn.jiguang.imui.BuildConfig;
 import cn.jiguang.imui.R;
 import cn.jiguang.imui.commons.models.IMessage;
-import cn.jiguang.imui.view.CircleImageView;
 
 public class PhotoViewHolder<MESSAGE extends IMessage> extends BaseMessageViewHolder<MESSAGE>
         implements MsgListAdapter.DefaultMessageViewHolder {
@@ -78,9 +78,9 @@ public void applyStyle(MessageListStyle style) {
         } else {
             mPhotoIv.setBackground(style.getReceivePhotoMsgBg());
         }
-        android.view.ViewGroup.LayoutParams layoutParams = mAvatarIv.getLayoutParams();
+        ViewGroup.LayoutParams layoutParams = mAvatarIv.getLayoutParams();
         layoutParams.width = style.getAvatarWidth();
         layoutParams.height = style.getAvatarHeight();
         mAvatarIv.setLayoutParams(layoutParams);
     }
-}
+}
\ No newline at end of file

File: Android/imui/src/main/java/cn/jiguang/imui/messages/BaseMessageViewHolder.java
Patch:
@@ -1,6 +1,7 @@
 package cn.jiguang.imui.messages;
 
 import android.content.Context;
+import android.media.MediaPlayer;
 import android.view.View;
 
 import cn.jiguang.imui.commons.ImageLoader;
@@ -20,6 +21,7 @@ public abstract class BaseMessageViewHolder<MESSAGE extends IMessage>
     protected MsgListAdapter.OnMsgLongClickListener<MESSAGE> mMsgLongClickListener;
     protected MsgListAdapter.OnMsgClickListener<MESSAGE> mMsgClickListener;
     protected MsgListAdapter.OnAvatarClickListener<MESSAGE> mAvatarClickListener;
+    protected MediaPlayer mMediaPlayer;
 
     public BaseMessageViewHolder(View itemView) {
         super(itemView);

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/photo/SelectPhotoView.java
Patch:
@@ -159,7 +159,7 @@ public boolean handleMessage(Message message) {
 
         if (message.what == MSG_WHAT_SCAN_SUCCESS) {
             Collections.sort(mMedias);
-            mPhotoAdapter = new PhotoAdapter(mMedias, getMeasuredHeight());
+            mPhotoAdapter = new PhotoAdapter(mMedias);
             mPhotoAdapter.setOnPhotoSelectedListener(mOnFileSelectedListener);
             mRvPhotos.setAdapter(mPhotoAdapter);
         } else if (message.what == MSG_WHAT_SCAN_FAILED) {

File: Android/sample/exampleui/src/main/java/imui/jiguang/cn/imuisample/views/ChatView.java
Patch:
@@ -53,7 +53,6 @@ public void initModule() {
         mMsgList = (MessageList) findViewById(R.id.msg_list);
         mMenuLl = (LinearLayout) findViewById(R.id.aurora_ll_menuitem_container);
         mChatInput = (ChatInputView) findViewById(R.id.chat_input);
-        mChatInput.setMenuContainerHeight(500);
 
         mRecordVoiceBtn = mChatInput.getRecordVoiceButton();
 

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/ChatInputView.java
Patch:
@@ -341,7 +341,7 @@ public void onClick(View view) {
                 if (onSubmit()) {
                     mChatInput.setText("");
                 }
-                if (mSelectPhotoView.getSelectFiles().size() > 0) {
+                if (mSelectPhotoView.getSelectFiles() != null && mSelectPhotoView.getSelectFiles().size() > 0) {
                     mListener.onSendFiles(mSelectPhotoView.getSelectFiles());
 
                     mSendBtn.setImageDrawable(ContextCompat.getDrawable(getContext(),

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/ChatInputView.java
Patch:
@@ -341,7 +341,7 @@ public void onClick(View view) {
                 if (onSubmit()) {
                     mChatInput.setText("");
                 }
-                if (mSelectPhotoView.getSelectFiles().size() > 0) {
+                if (mSelectPhotoView.getSelectFiles() != null && mSelectPhotoView.getSelectFiles().size() > 0) {
                     mListener.onSendFiles(mSelectPhotoView.getSelectFiles());
 
                     mSendBtn.setImageDrawable(ContextCompat.getDrawable(getContext(),

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/ChatInputView.java
Patch:
@@ -374,6 +374,7 @@ public void onClick(View view) {
                 dismissRecordVoiceLayout();
                 dismissCameraLayout();
                 mSelectPhotoView.setVisibility(VISIBLE);
+                mSelectPhotoView.initData();
 
             } else if (view.getId() == R.id.aurora_framelayout_menuitem_camera) {
                 if (mListener != null) {

File: Android/imui/src/main/java/cn/jiguang/imui/view/ShapeImageView.java
Patch:
@@ -11,14 +11,13 @@
 import android.graphics.drawable.shapes.Shape;
 import android.support.annotation.Nullable;
 import android.util.AttributeSet;
-import android.widget.ImageView;
 
 import java.util.Arrays;
 
 import cn.jiguang.imui.R;
 
 
-public class ShapeImageView extends ImageView {
+public class ShapeImageView extends android.support.v7.widget.AppCompatImageView {
 
     private Paint mPaint;
     private Shape mShape;

File: Android/chatinput/src/main/java/cn/jiguang/imui/chatinput/camera/CameraSupport.java
Patch:
@@ -6,7 +6,7 @@
 
 
 public interface CameraSupport {
-    CameraSupport open(int cameraId, int width, int height);
+    CameraSupport open(int cameraId, int width, int height, boolean isFacingBack);
     int getOrientation(int cameraId);
     void release();
     void setOutputFile(File file);

File: Android/sample/exampleui/src/main/java/imui/jiguang/cn/imuisample/messages/MessageListActivity.java
Patch:
@@ -84,6 +84,7 @@ public boolean onSendTextMessage(CharSequence input) {
                 }
                 MyMessage message = new MyMessage(input.toString(), IMessage.MessageType.SEND_TEXT);
                 message.setUserInfo(new DefaultUser("1", "Ironman", "ironman"));
+                message.setTimeString(new SimpleDateFormat("HH:mm", Locale.getDefault()).format(new Date()));
                 mAdapter.addToStart(message, true);
                 return true;
             }

File: Android/imui/src/main/java/cn/jiguang/imui/messages/ScrollMoreListener.java
Patch:
@@ -12,7 +12,7 @@ public class ScrollMoreListener extends RecyclerView.OnScrollListener {
     private OnLoadMoreListener mListener;
     private int mCurrentPage = 0;
     private int mPreviousTotalItemCount = 0;
-    private boolean mLoading = true;
+    private boolean mLoading = false;
 
     public ScrollMoreListener(LinearLayoutManager layoutManager, OnLoadMoreListener listener) {
         this.mLayoutManager = layoutManager;

File: Android/chatinput/src/cn/jiguang/imui/chatinput/ChatInputView.java
Patch:
@@ -1047,6 +1047,7 @@ public void onTakePictureCompleted(String photoPath) {
 
     @Override
     public void onRecordVideoCompleted(String videoPath) {
+        Log.e("ChatInputView", "Video path: " + videoPath);
         // TODO send video message
         if (mListener != null) {
             mListener.onVideoRecordFinished(videoPath);

File: Android/chatinput/src/cn/jiguang/imui/chatinput/camera/CameraNew.java
Patch:
@@ -483,7 +483,6 @@ public void stopRecordingVideo() {
         }
         mMediaRecorder.reset();
         Log.e(TAG, "Stop recording video");
-        mNextVideoAbsolutePath = null;
         startPreview();
     }
 

File: Android/chatinput/src/cn/jiguang/imui/chatinput/camera/CameraOld.java
Patch:
@@ -251,7 +251,6 @@ public void stopRecordingVideo() {
         mMediaRecorder.reset();
         Log.e(TAG, "Stop recording video");
         mCamera.startPreview();
-        mNextVideoAbsolutePath = null;
     }
 
     @Override

File: Android/sample/exampleui/src/main/java/imui/jiguang/cn/imuisample/messages/MessageListActivity.java
Patch:
@@ -12,6 +12,7 @@
 import android.support.v4.app.ActivityCompat;
 import android.support.v4.content.ContextCompat;
 import android.text.format.DateFormat;
+import android.util.Log;
 import android.view.MotionEvent;
 import android.view.View;
 import android.view.Window;
@@ -150,6 +151,7 @@ public void onCameraClick() {
 
             @Override
             public void onVideoRecordFinished(String filePath) {
+                Log.e("MessageListActivity", "Video Path: " + filePath);
                 final MyMessage message = new MyMessage(null, IMessage.MessageType.SEND_VIDEO);
                 message.setContentFile(filePath);
                 MessageListActivity.this.runOnUiThread(new Runnable() {

File: Android/chatinput/src/cn/jiguang/imui/chatinput/camera/CameraSupport.java
Patch:
@@ -12,4 +12,5 @@ public interface CameraSupport {
     void setCameraCallbackListener(OnCameraCallbackListener listener);
     void startRecordingVideo();
     void stopRecordingVideo();
+    void finishRecordingVideo();
 }

File: sample/exampleui/src/main/java/imui/jiguang/cn/imuisample/views/ChatView.java
Patch:
@@ -53,6 +53,7 @@ public void initModule() {
         mMenuLl = (LinearLayout) findViewById(R.id.menu_item_container);
         mChatInput = (ChatInputView) findViewById(R.id.chat_input);
         mRecordVoiceBtn = mChatInput.getRecordVoiceButton();
+        mChatInput.setMenuContainerHeight(500);
     }
 
     public void setMenuClickListener(ChatInputView.OnMenuClickListener listener) {

File: android/src/main/java/cn/jiguang/imui/messages/CameraNew.java
Patch:
@@ -304,7 +304,7 @@ public void takePicture() {
             List<Surface> outputSurfaces = new ArrayList<Surface>(2);
             outputSurfaces.add(reader.getSurface());
             outputSurfaces.add(new Surface(mTextureView.getSurfaceTexture()));
-            CaptureRequest.Builder builder = mCamera.createCaptureRequest(CameraDevice.TEMPLATE_STILL_CAPTURE);
+            final CaptureRequest.Builder builder = mCamera.createCaptureRequest(CameraDevice.TEMPLATE_STILL_CAPTURE);
             builder.addTarget(reader.getSurface());
             builder.set(CaptureRequest.CONTROL_MODE, CameraMetadata.CONTROL_MODE_AUTO);
             builder.set(CaptureRequest.JPEG_ORIENTATION, getOrientation(Integer.parseInt(mCameraId)));
@@ -345,7 +345,7 @@ public void onCaptureCompleted(CameraCaptureSession session, CaptureRequest requ
                 @Override
                 public void onConfigured(CameraCaptureSession cameraCaptureSession) {
                     try {
-                        cameraCaptureSession.capture(mBuilder.build(), captureCallback, mBackgroundHandler);
+                        cameraCaptureSession.capture(builder.build(), captureCallback, mBackgroundHandler);
                     } catch (CameraAccessException e) {
                         e.printStackTrace();
                     }

File: android/src/main/java/cn/jiguang/imui/messages/ChatInputView.java
Patch:
@@ -444,7 +444,6 @@ public void showCameraLayout() {
 
     public void dismissCameraLayout() {
         mCameraFl.setVisibility(GONE);
-        mCameraSupport.release();
         ViewGroup.LayoutParams params = new FrameLayout.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, mMenuHeight);
         mTextureView.setLayoutParams(params);
     }

File: android/src/main/java/cn/jiguang/imui/messages/MessageList.java
Patch:
@@ -14,6 +14,7 @@
 public class MessageList extends RecyclerView {
 
     private MessageListStyle mMsgListStyle;
+    private Context mContext;
 
     public MessageList(Context context) {
         super(context);
@@ -31,6 +32,7 @@ public MessageList(Context context, @Nullable AttributeSet attrs, int defStyle)
 
     @SuppressWarnings("ResourceType")
     private void parseStyle(Context context, AttributeSet attrs) {
+        mContext = context;
         mMsgListStyle = MessageListStyle.parse(context, attrs);
     }
 
@@ -51,7 +53,7 @@ public <MESSAGE extends IMessage> void setAdapter(MsgListAdapter<MESSAGE> adapte
         setItemAnimator(itemAnimator);
         setLayoutManager(layoutManager);
         adapter.setLayoutManager(layoutManager);
-        adapter.setStyle(mMsgListStyle);
+        adapter.setStyle(mContext, mMsgListStyle);
         addOnScrollListener(new ScrollMoreListener(layoutManager, adapter));
         super.setAdapter(adapter);
     }

File: android/src/main/java/cn/jiguang/imui/commons/models/IConversation.java
Patch:
@@ -12,7 +12,7 @@ public interface IConversation {
 
     String getConvPhoto();
 
-    List<UserInfo> getUsers();
+    List<IUser> getUsers();
 
     IMessage getLastMsg();
 

File: android/src/main/java/cn/jiguang/imui/commons/models/IMessage.java
Patch:
@@ -8,7 +8,7 @@ public interface IMessage {
 
     String getId();
 
-    UserInfo getUserInfo();
+    IUser getUserInfo();
 
     Date getCreatedAt();
 

File: android/src/main/java/cn/jiguang/imui/commons/models/IUser.java
Patch:
@@ -1,7 +1,7 @@
 package cn.jiguang.imui.commons.models;
 
 
-public interface UserInfo {
+public interface IUser {
 
     String getId();
 

File: android/src/main/java/cn/jiguang/imui/messages/MessageListStyle.java
Patch:
@@ -148,7 +148,7 @@ public int getAvatarHeight() {
     public Drawable getReceiveBubbleDrawable() {
         if (receiveBubbleDrawable == -1) {
             return getMessageSelector(receiveBubbleColor, receiveBubbleSelectedColor, receiveBubblePressedColor,
-                    R.mipmap.receive_bubble);
+                    R.drawable.receive_bubble);
         } else {
             return ContextCompat.getDrawable(mContext, receiveBubbleDrawable);
         }
@@ -193,7 +193,7 @@ public int getReceiveBubblePaddingBottom() {
     public Drawable getSendBubbleDrawable() {
         if (sendBubbleDrawable == -1) {
             return getMessageSelector(sendBubbleColor, sendBubbleSelectedColor, sendBubblePressedColor,
-                    R.mipmap.send_bubble);
+                    R.drawable.send_bubble);
         } else {
             return ContextCompat.getDrawable(mContext, sendBubbleDrawable);
         }

File: android/src/main/java/cn/jiguang/imui/messages/RecordVoiceBtnStyle.java
Patch:
@@ -26,7 +26,7 @@ public static RecordVoiceBtnStyle parse(Context context, AttributeSet attrs) {
         TypedArray typedArray = context.obtainStyledAttributes(attrs, R.styleable.RecordVoiceButton);
         style.voiceBtnText = typedArray.getString(R.styleable.RecordVoiceButton_voiceBtnText);
         style.tapDownText = typedArray.getString(R.styleable.RecordVoiceButton_tapDownText);
-        style.voiceBtnBg = typedArray.getDrawable(R.styleable.RecordVoiceButton_voiceBtnBg);
+        style.voiceBtnBg = typedArray.getDrawable(R.styleable.RecordVoiceButton_recordVoiceBtnBg);
         style.mic_1 = typedArray.getDrawable(R.styleable.RecordVoiceButton_mic_1);
         style.mic_2 = typedArray.getDrawable(R.styleable.RecordVoiceButton_mic_2);
         style.mic_3 = typedArray.getDrawable(R.styleable.RecordVoiceButton_mic_3);

