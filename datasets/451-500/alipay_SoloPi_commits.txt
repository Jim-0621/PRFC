File: src/app/src/main/java/com/alipay/hulu/util/FunctionSelectUtil.java
Patch:
@@ -1411,7 +1411,7 @@ public void afterTextChanged(Editable s) {
 
         } catch (Exception e) {
             LogUtil.e(TAG, "Throw exception: " + e.getMessage(), e);
-
+            listener.onCancel();
         }
     }
 
@@ -1669,6 +1669,7 @@ public void onClick(DialogInterface dialog, int which) {
 
         } catch (Exception e) {
             LogUtil.e(TAG, "Login info dialog throw exception: " + e.getMessage(), e);
+            listener.onCancel();
         }
     }
 

File: src/app/src/main/java/com/alipay/hulu/util/RecordUtil.java
Patch:
@@ -93,12 +93,13 @@ public static File saveToFile(Map<RecordPattern, List<RecordPattern.RecordItem>>
                     BufferedWriter writer = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(saveFile), charset));
 
                     // 第一行写标题
-                    writer.write("RecordTime," + pattern.getName() + "(" + pattern.getUnit() + "),extra\n");
+                    writer.write("RecordTime," + pattern.getName() + "(" + pattern.getUnit() + "),extra,SimpleTime\n");
                     writer.flush();
+                    long dataStartTime = entry.getKey().getStartTime();
 
                     // 写入录制
                     for (RecordPattern.RecordItem item: entry.getValue()) {
-                        writer.write(item.time + "," + item.value + "," + item.extra + "\n");
+                        writer.write(item.time + "," + item.value + "," + item.extra + "," + (item.time - dataStartTime) / 1000F + "\n");
                         writer.flush();
                     }
                     writer.close();

File: src/app/src/main/java/com/alipay/hulu/activity/SettingsActivity.java
Patch:
@@ -927,7 +927,7 @@ private void initView() {
 
         mMaxScrollFindSettingWrapper = findViewById(R.id.max_scroll_find_setting_wrapper);
         mMaxScrollFindSettingInfo = _findViewById(R.id.max_scroll_find_setting_info);
-        mMaxScrollFindSettingInfo.setText(Long.toString(SPService.getInt(SPService.KEY_MAX_SCROLL_FIND_COUNT, 0)));
+        mMaxScrollFindSettingInfo.setText(Integer.toString(SPService.getInt(SPService.KEY_MAX_SCROLL_FIND_COUNT, 2)));
 
 
         mCheckUpdateSettingWrapper = findViewById(R.id.check_update_setting_wrapper);

File: src/app/src/main/java/com/alipay/hulu/scheme/PerformanceSchemeResolver.java
Patch:
@@ -30,6 +30,7 @@
 import com.alipay.hulu.common.scheme.SchemeResolver;
 import com.alipay.hulu.common.tools.AppInfoProvider;
 import com.alipay.hulu.common.tools.BackgroundExecutor;
+import com.alipay.hulu.common.utils.Callback;
 import com.alipay.hulu.common.utils.PermissionUtil;
 import com.alipay.hulu.common.utils.StringUtil;
 import com.alipay.hulu.screenRecord.Notifications;
@@ -64,7 +65,7 @@ public class PerformanceSchemeResolver implements SchemeActionResolver {
     private boolean isRecording = false;
 
     @Override
-    public boolean processScheme(Context context, Map<String, String> params) {
+    public boolean processScheme(Context context, Map<String, String> params, Callback<Map<String, Object>> callback) {
         String mode = params.get(PERFORMANCE_MODE);
         if (StringUtil.isEmpty(mode)) {
             return false;

File: src/app/src/main/java/com/alipay/hulu/scheme/RecordSchemeResolver.java
Patch:
@@ -26,6 +26,7 @@
 import com.alipay.hulu.common.scheme.SchemeActionResolver;
 import com.alipay.hulu.common.scheme.SchemeResolver;
 import com.alipay.hulu.common.tools.BackgroundExecutor;
+import com.alipay.hulu.common.utils.Callback;
 import com.alipay.hulu.common.utils.PermissionUtil;
 import com.alipay.hulu.common.utils.StringUtil;
 import com.alipay.hulu.service.CaseRecordManager;
@@ -52,7 +53,7 @@ public class RecordSchemeResolver implements SchemeActionResolver {
     public static final String MODE_NORMAL = "normal";
 
     @Override
-    public boolean processScheme(Context context, Map<String, String> params) {
+    public boolean processScheme(Context context, Map<String, String> params, Callback<Map<String, Object>> callback) {
         String mode = params.get(RECORD_MODE);
         if (StringUtil.isEmpty(mode)) {
             return false;

File: src/app/src/main/java/com/alipay/hulu/scheme/ReplaySchemeResolver.java
Patch:
@@ -23,6 +23,7 @@
 import com.alipay.hulu.common.application.LauncherApplication;
 import com.alipay.hulu.common.scheme.SchemeActionResolver;
 import com.alipay.hulu.common.scheme.SchemeResolver;
+import com.alipay.hulu.common.utils.Callback;
 import com.alipay.hulu.common.utils.PermissionUtil;
 import com.alipay.hulu.common.utils.StringUtil;
 import com.alipay.hulu.shared.io.bean.RecordCaseInfo;
@@ -46,7 +47,7 @@ public class ReplaySchemeResolver implements SchemeActionResolver {
     public static final String MODE_NORMAL = "normal";
 
     @Override
-    public boolean processScheme(Context context, Map<String, String> params) {
+    public boolean processScheme(Context context, Map<String, String> params, Callback<Map<String, Object>> callback) {
         String mode = params.get(REPLAY_MODE);
         if (StringUtil.isEmpty(mode)) {
             return false;

File: src/app/src/main/java/com/alipay/hulu/activity/PerformanceChartActivity.java
Patch:
@@ -18,14 +18,14 @@
 import android.content.Intent;
 import android.os.Build;
 import android.os.Bundle;
-import androidx.annotation.Nullable;
-import androidx.core.app.ActivityCompat;
-import androidx.appcompat.widget.AppCompatSpinner;
 import android.view.View;
 import android.widget.AdapterView;
 import android.widget.SimpleAdapter;
 import android.widget.TextView;
 
+import androidx.annotation.Nullable;
+import androidx.appcompat.widget.AppCompatSpinner;
+
 import com.alipay.hulu.R;
 import com.alipay.hulu.common.utils.FileUtils;
 import com.alipay.hulu.common.utils.LogUtil;

File: src/shared/src/main/java/com/alipay/hulu/shared/display/items/ResponseTools.java
Patch:
@@ -129,7 +129,7 @@ public void receiveAccessibilityEvent(UniversalEventBean eventBean) {
         }
 
         if (!StringUtil.equals((String) eventBean.getParam(Constant.KEY_ACCESSIBILITY_SOURCE), app)) {
-            LogUtil.d(TAG, "收到其他来源：%s", eventBean.getParam(Constant.KEY_ACCESSIBILITY_SOURCE));
+            LogUtil.d(TAG, "收到其他来源：%s", (Object) eventBean.getParam(Constant.KEY_ACCESSIBILITY_SOURCE));
             return;
         }
 

File: src/shared/src/main/java/com/alipay/hulu/shared/display/items/base/DisplayItem.java
Patch:
@@ -41,7 +41,7 @@
      * 显示名称
      * @return
      */
-    String key();
+    String key() default "";
 
 //    @StringRes
     FinalR nameRes() default FinalR.NULL;

File: src/shared/src/main/java/com/alipay/hulu/shared/display/items/CPUTools.java
Patch:
@@ -50,7 +50,7 @@
 import java.util.List;
 import java.util.Map;
 
-@DisplayItem(name = "CPU", key = "CPU")
+@DisplayItem(name = "CPU", key = "CPU", permissions = "adb")
 public class CPUTools implements Displayable{
 
 	private static final String TAG = "CPUTools";

File: src/shared/src/main/java/com/alipay/hulu/shared/display/items/FpsTools.java
Patch:
@@ -31,7 +31,7 @@
 import java.util.List;
 import java.util.Map;
 
-@DisplayItem(nameRes = FinalR.FPS, key = "FPS", permissions = "toast:${com.alipay.hulu.shared.R$string.toast_message__turn_on_gfx_info}")
+@DisplayItem(nameRes = FinalR.FPS, key = "FPS", permissions = {"adb", "toast:${com.alipay.hulu.shared.R$string.toast_message__turn_on_gfx_info}"})
 public class FpsTools implements Displayable {
 	private static String TAG = "FpsTools";
 	private static Long startTime = 0L;

File: src/shared/src/main/java/com/alipay/hulu/shared/display/items/MemoryTools.java
Patch:
@@ -43,7 +43,7 @@
 import java.util.Locale;
 import java.util.Map;
 
-@DisplayItem(nameRes = FinalR.MEMORY, key = "Memory")
+@DisplayItem(nameRes = FinalR.MEMORY, key = "Memory", permissions = "adb")
 public class MemoryTools implements Displayable{
 
 	private static String TAG = "MemoryTools";

File: src/shared/src/main/java/com/alipay/hulu/shared/display/items/NetworkTools.java
Patch:
@@ -38,7 +38,7 @@
 import java.util.List;
 import java.util.Map;
 
-@DisplayItem(nameRes = FinalR.NETWORK, key = "Network", trigger = "清零")
+@DisplayItem(nameRes = FinalR.NETWORK, key = "Network", trigger = "清零", permissions = "adb")
 public class NetworkTools implements Displayable{
 
 	private static final float KB_MILLION_SECOND = 1000 / 1024f;

File: src/shared/src/main/java/com/alipay/hulu/shared/display/items/StatusTools.java
Patch:
@@ -36,7 +36,7 @@
 import java.util.List;
 import java.util.Map;
 
-@DisplayItem(nameRes = FinalR.PROCESS_STATUS, key = "Status")
+@DisplayItem(nameRes = FinalR.PROCESS_STATUS, key = "Status", permissions = "adb")
 public class StatusTools implements Displayable {
     private static final String TAG = StatusTools.class.getSimpleName();
 

File: src/shared/src/main/java/com/alipay/hulu/shared/display/items/BatteryInfo.java
Patch:
@@ -48,7 +48,7 @@
 import java.util.List;
 import java.util.Map;
 
-@DisplayItem(nameRes = FinalR.BATTERY, trigger = "清零")
+@DisplayItem(nameRes = FinalR.BATTERY, key = "Battery", trigger = "清零")
 public class BatteryInfo implements Displayable{
 
 	private static String batteryPath = null;

File: src/shared/src/main/java/com/alipay/hulu/shared/display/items/CPUTools.java
Patch:
@@ -50,7 +50,7 @@
 import java.util.List;
 import java.util.Map;
 
-@DisplayItem(name = "CPU")
+@DisplayItem(name = "CPU", key = "CPU")
 public class CPUTools implements Displayable{
 
 	private static final String TAG = "CPUTools";

File: src/shared/src/main/java/com/alipay/hulu/shared/display/items/FpsTools.java
Patch:
@@ -31,7 +31,7 @@
 import java.util.List;
 import java.util.Map;
 
-@DisplayItem(nameRes = FinalR.FPS, permissions = "toast:${com.alipay.hulu.shared.R$string.toast_message__turn_on_gfx_info}")
+@DisplayItem(nameRes = FinalR.FPS, key = "FPS", permissions = "toast:${com.alipay.hulu.shared.R$string.toast_message__turn_on_gfx_info}")
 public class FpsTools implements Displayable {
 	private static String TAG = "FpsTools";
 	private static Long startTime = 0L;

File: src/shared/src/main/java/com/alipay/hulu/shared/display/items/MemoryTools.java
Patch:
@@ -43,7 +43,7 @@
 import java.util.Locale;
 import java.util.Map;
 
-@DisplayItem(nameRes = FinalR.MEMORY)
+@DisplayItem(nameRes = FinalR.MEMORY, key = "Memory")
 public class MemoryTools implements Displayable{
 
 	private static String TAG = "MemoryTools";

File: src/shared/src/main/java/com/alipay/hulu/shared/display/items/NetworkTools.java
Patch:
@@ -38,7 +38,7 @@
 import java.util.List;
 import java.util.Map;
 
-@DisplayItem(nameRes = FinalR.NETWORK, trigger = "清零")
+@DisplayItem(nameRes = FinalR.NETWORK, key = "Network", trigger = "清零")
 public class NetworkTools implements Displayable{
 
 	private static final float KB_MILLION_SECOND = 1000 / 1024f;

File: src/shared/src/main/java/com/alipay/hulu/shared/display/items/ResponseTools.java
Patch:
@@ -45,7 +45,7 @@
  * Created by cathor on 17/7/25.
  */
 
-@DisplayItem(nameRes = FinalR.RESPONSE_TIME, permissions = {Settings.ACTION_ACCESSIBILITY_SETTINGS})
+@DisplayItem(nameRes = FinalR.RESPONSE_TIME, key = "Response", permissions = {Settings.ACTION_ACCESSIBILITY_SETTINGS})
 public class ResponseTools implements Displayable {
     public static final int RES = 1;
     private static final String TAG = "ResponseTools";

File: src/shared/src/main/java/com/alipay/hulu/shared/display/items/StatusTools.java
Patch:
@@ -36,7 +36,7 @@
 import java.util.List;
 import java.util.Map;
 
-@DisplayItem(nameRes = FinalR.PROCESS_STATUS)
+@DisplayItem(nameRes = FinalR.PROCESS_STATUS, key = "Status")
 public class StatusTools implements Displayable {
     private static final String TAG = StatusTools.class.getSimpleName();
 

File: src/app/src/main/java/com/alipay/hulu/replay/OperationStepProvider.java
Patch:
@@ -490,9 +490,8 @@ protected void takeScreenshot() {
 
         // 生成文件名
         Date now = new Date();
-        SimpleDateFormat format = new SimpleDateFormat("yyyyMMddHHmmssSSS_" +
-                StringUtil.getString(R.string.step_provider__error_step, currentIdx), Locale.CHINA);
-        String newFileName = format.format(now);
+        SimpleDateFormat format = new SimpleDateFormat("yyyyMMddHHmmssSSS_", Locale.CHINA);
+        String newFileName = format.format(now) + StringUtil.getString(R.string.step_provider__error_step, currentIdx);
         method.putParam(OperationExecutor.INPUT_TEXT_KEY, newFileName);
         screenshotFiles.put(StringUtil.getString(R.string.step_provider__error_step, currentIdx), newFileName);
 

File: src/common/src/main/java/com/alipay/hulu/common/constant/Constant.java
Patch:
@@ -24,7 +24,7 @@ public class Constant {
 
     public static final String AES_KEY = "com.alipay.hulu";
 
-    public static final String MAIL_ADDERSS = "ruikai.qrk@antfin.com";
+    public static final String MAIL_ADDERSS = "ruikai.qrk@antgroup.com";
 
 
     public static final String EVENT_RECORD_SCREEN_CODE = "recordScreenCode";

File: src/shared/src/main/java/com/alipay/hulu/shared/node/action/OperationExecutor.java
Patch:
@@ -977,7 +977,8 @@ public void handlePermissionAlert() {
                         || StringUtil.equals("允许", node.getText())
                         || StringUtil.equals("总是允许", node.getText())
                         || StringUtil.equals("好的", node.getText())
-                        || StringUtil.equals("仅在使用中允许", node.getText())) {
+                        || StringUtil.equals("仅在使用中允许", node.getText())
+                        || StringUtil.equals("仅在使用该应用时允许", node.getText())) {
                     target = node;
                     break;
                 }

File: src/shared/src/main/java/com/alipay/hulu/shared/node/tree/accessibility/AccessibilityProvider.java
Patch:
@@ -444,7 +444,7 @@ public void onFailed() {
         LogUtil.i(TAG, "等待辅助功能重新激活");
         long startTime = System.currentTimeMillis();
 
-        LauncherApplication.getInstance().showToast("辅助功能重新启动");
+        LauncherApplication.getInstance().showToast(R.string.permission__starting_accessibility_service);
 
         // 等待辅助功能重新激活
         try {

File: src/shared/src/main/java/com/alipay/hulu/shared/node/utils/OperationUtil.java
Patch:
@@ -62,6 +62,7 @@ public class OperationUtil {
         map.put("始终允许", 1);
         map.put("总是允许", 1);
         map.put("仅在使用中允许", 1);
+        map.put("仅在使用该应用时允许", 1);
         map.put("安装", 1);
         map.put("重新安装", 1);
         map.put("继续安装", 1);

File: src/app/src/main/java/com/alipay/hulu/screenRecord/ScreenRecorder.java
Patch:
@@ -28,6 +28,7 @@
 import android.os.Looper;
 import android.os.Message;
 
+import com.alipay.hulu.BuildConfig;
 import com.alipay.hulu.common.utils.LogUtil;
 
 import java.io.IOException;
@@ -41,7 +42,7 @@
 @TargetApi(value = Build.VERSION_CODES.LOLLIPOP)
 public class ScreenRecorder {
     private static final String TAG = "ScreenRecorder";
-    private static final boolean VERBOSE = false;
+    private static final boolean VERBOSE = BuildConfig.DEBUG;
     private static final int INVALID_INDEX = -1;
     public static final String VIDEO_AVC = MediaFormat.MIMETYPE_VIDEO_AVC; // H.264 Advanced Video Coding
     private int mWidth;

File: src/app/src/main/java/com/alipay/hulu/adapter/LocalTaskResultListAdapter.java
Patch:
@@ -67,7 +67,7 @@ public View getView(int position, View convertView, ViewGroup parent) {
             holder.deviceInfo.setVisibility(View.GONE);
         }
 
-        if (result.getExceptionStep() > -1) {
+        if (result.getExceptionMessage() != null) {
             holder.status.setTextColor(0xfff76262);
             holder.status.setText(R.string.constant__fail);
         } else {

File: src/app/src/main/java/com/alipay/hulu/fragment/LocalReplayResultListFragment.java
Patch:
@@ -36,7 +36,6 @@
 import com.alipay.hulu.bean.ReplayResultBean;
 import com.alipay.hulu.bean.ReplayStepInfoBean;
 import com.alipay.hulu.common.bean.DeviceInfo;
-import com.alipay.hulu.common.injector.InjectorService;
 import com.alipay.hulu.common.tools.BackgroundExecutor;
 import com.alipay.hulu.common.utils.FileUtils;
 import com.alipay.hulu.common.utils.LogUtil;
@@ -273,7 +272,7 @@ private void deleteResult(int position) {
     private void initEmptyView(View view) {
         mEmptyView = view.findViewById(R.id.empty_view_container);
         mEmptyTextView = view.findViewById(R.id.empty_text);
-        mEmptyTextView.setText("您还没有回放过用例哦");
+        mEmptyTextView.setText(R.string.replay_result__no_history);
     }
 
     /**

File: src/app/src/main/java/com/alipay/hulu/util/FunctionSelectUtil.java
Patch:
@@ -423,7 +423,7 @@ private static void showSelectView(final OperationMethod method, final Context c
             View itemScan = customView.findViewById(R.id.item_scan);
             TextView itemUrl = customView.findViewById(R.id.item_url);
             if (actionEnum == PerformActionEnum.GENERATE_QR_CODE) {
-                itemUrl.setText("输入码值");
+                itemUrl.setText(R.string.function__input_code);
             }
             final AlertDialog dialog = new AlertDialog.Builder(context, R.style.AppDialogTheme)
                     .setView(customView)

File: src/common/src/main/java/com/alipay/hulu/common/utils/activity/PermissionDialogActivity.java
Patch:
@@ -933,7 +933,7 @@ public void onFailed() {
         CmdTools.putAccessibility("enabled_accessibility_services", "com.alipay.hulu/com.alipay.hulu.shared.event.accessibility.AccessibilityServiceImpl");
 
         // 等待辅助功能重新激活
-        LauncherApplication.getInstance().showToast("尝试重启辅助功能，等待10秒");
+        LauncherApplication.getInstance().showToast(R.string.permission__restarting_accessibility);
         try {
             latch.await(10000, TimeUnit.MILLISECONDS);
         } catch (InterruptedException e) {

File: src/shared/src/main/java/com/alipay/hulu/shared/node/tree/accessibility/AccessibilityProvider.java
Patch:
@@ -33,6 +33,7 @@
 import com.alipay.hulu.common.utils.LogUtil;
 import com.alipay.hulu.common.utils.MiscUtil;
 import com.alipay.hulu.common.utils.StringUtil;
+import com.alipay.hulu.shared.R;
 import com.alipay.hulu.shared.event.accessibility.AccessibilityServiceImpl;
 import com.alipay.hulu.shared.node.AbstractProvider;
 import com.alipay.hulu.shared.node.tree.FakeNodeTree;
@@ -379,7 +380,7 @@ private MetaTree loadMetaTree() {
      * 重启辅助功能
      */
     private void restartAccessibilityService() {
-        LauncherApplication.getInstance().showToast("重启辅助功能中，请耐心等待");
+        LauncherApplication.getInstance().showToast(StringUtil.getString(R.string.permission__restarting_accessibility));
         // 关uiautomator
         cleanInstrumentationAndUiAutomator();
 
@@ -418,7 +419,7 @@ public void onFailed() {
      * 重启辅助功能
      */
     private void simpleRestartAccessibilityService() {
-        LauncherApplication.getInstance().showToast("简易重启辅助功能中，请耐心等待");
+        LauncherApplication.getInstance().showToast(R.string.permission__restarting_accessibility);
 
         // 切换回TalkBack
         CmdTools.putAccessibility("enabled_accessibility_services", "com.android.talkback/com.google.android.marvin.talkback.TalkBackService");

File: src/app/src/main/java/com/alipay/hulu/activity/NewRecordActivity.java
Patch:
@@ -72,7 +72,7 @@
 /**
  * Created by lezhou.wyl on 2018/2/1.
  */
-@EntryActivity(iconName = "com.alipay.hulu.R$drawable.icon_luxiang", nameResName = "com.alipay.hulu.R$string.activity__record", permissions = {"adb", "float", "background", "toast:请将SoloPi添加到后台白名单中"}, index = 1, cornerText = "New", cornerPersist = 3, cornerBg = 0xFFFF5900)
+@EntryActivity(iconName = "com.alipay.hulu.R$drawable.icon_luxiang", nameResName = "com.alipay.hulu.R$string.activity__record", permissions = {"adb", "float", "background", "toast:${com.alipay.hulu.R$string.toast_message__add_solopi_background}"}, index = 1, cornerText = "New", cornerPersist = 3, cornerBg = 0xFFFF5900)
 public class NewRecordActivity extends BaseActivity {
 
     private static final String TAG = NewRecordActivity.class.getSimpleName();

File: src/app/src/main/java/com/alipay/hulu/activity/NewReplayListActivity.java
Patch:
@@ -93,6 +93,7 @@ public void onClick(View v) {
         mHeadPanel.addMenuFromLeft(rightTitle);
 
         mHeadPanel.setMiddleTitle(getString(R.string.activity__case_list));
+        mHeadPanel.setTitlePosition(HeadControlPanel.POSITION_LEFT);
         mHeadPanel.setBackIconClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View v) {

File: src/app/src/main/java/com/alipay/hulu/fragment/LocalReplayResultListFragment.java
Patch:
@@ -230,14 +230,14 @@ public void onItemClick(AdapterView<?> parent, View view, int position, long id)
             @Override
             public boolean onItemLongClick(AdapterView<?> parent, View view, final int position, long id) {
                 new AlertDialog.Builder(getActivity())
-                        .setMessage("是否删除回放结果？")
-                        .setNegativeButton("取消", new DialogInterface.OnClickListener() {
+                        .setMessage(R.string.replay_result__delete_item)
+                        .setNegativeButton(R.string.constant__cancel, new DialogInterface.OnClickListener() {
                             @Override
                             public void onClick(DialogInterface dialog, int which) {
 
                             }
                         })
-                        .setPositiveButton("确定", new DialogInterface.OnClickListener() {
+                        .setPositiveButton(R.string.constant__confirm, new DialogInterface.OnClickListener() {
                             @Override
                             public void onClick(DialogInterface dialog, int which) {
                                 deleteResult(position);

File: src/app/src/main/java/com/alipay/hulu/screenRecord/RecordService.java
Patch:
@@ -464,13 +464,13 @@ private void addResultValue(long result) {
             long val = results.get(i);
             total += val;
             Map<String, String> display = new HashMap<>(3);
-            display.put("title", "第" + (i + 1) + "次");
+            display.put("title", getString(R.string.record_float__nth_time, i + 1));
             display.put("value", val + "ms");
             displayDataSource.add(display);
         }
 
         Map<String, String> display = new HashMap<>(3);
-        display.put("title", "平均值");
+        display.put("title", getString(R.string.record_float__average));
         display.put("value", (total / results.size()) + "ms");
         displayDataSource.add(display);
 

File: src/common/src/main/java/com/alipay/hulu/common/application/LauncherApplication.java
Patch:
@@ -550,7 +550,7 @@ public boolean isLoggable(int priority, String tag) {
             // 调试模式走SimpleFormat
             SimpleFormatStrategy formatStrategy = new SimpleFormatStrategy();
             LogUtil.LOG_LEVEL = Logger.VERBOSE;
-            Logger.printer(new ThreadInfoLoggerPrinter());
+//            Logger.printer(new ThreadInfoLoggerPrinter());
             Logger.addLogAdapter(new AndroidLogAdapter(formatStrategy) {
                 @Override
                 public boolean isLoggable(int priority, String tag) {

File: src/shared/src/main/java/com/alipay/hulu/shared/display/items/FpsTools.java
Patch:
@@ -20,7 +20,6 @@
 import com.alipay.hulu.common.injector.param.Subscriber;
 import com.alipay.hulu.common.injector.provider.Param;
 import com.alipay.hulu.common.utils.StringUtil;
-import com.alipay.hulu.shared.R;
 import com.alipay.hulu.shared.display.items.base.DisplayItem;
 import com.alipay.hulu.shared.display.items.base.Displayable;
 import com.alipay.hulu.shared.display.items.base.RecordPattern;
@@ -32,7 +31,7 @@
 import java.util.List;
 import java.util.Map;
 
-@DisplayItem(nameRes = FinalR.FPS, permissions = "toast:请在设置里\"开发人员选项\"中开启\"GPU呈现模式分析\"选项")
+@DisplayItem(nameRes = FinalR.FPS, permissions = "toast:${com.alipay.hulu.shared.R$string.toast_message__turn_on_gfx_info}")
 public class FpsTools implements Displayable {
 	private static String TAG = "FpsTools";
 	private static Long startTime = 0L;

File: src/app/src/main/java/com/alipay/hulu/scheme/ConfigSchemeResolver.java
Patch:
@@ -50,7 +50,6 @@ private boolean processConfigSet(String key, String value) {
             case KEY_HIGHLIGHT_REPLAY_NODE:
             case KEY_REPLAY_AUTO_START:
             case KEY_SCREEN_ROTATION:
-            case KEY_RECORD_COVER_MODE:
                 if (StringUtil.equalsIgnoreCase(value, "true")) {
                     LogUtil.i(TAG, "Update Config " + key + " to value " + true);
                     SPService.putBoolean(key, true);
@@ -69,7 +68,6 @@ private boolean processConfigSet(String key, String value) {
                 LogUtil.i(TAG, "Update Config " + key + " to value " + obj);
                 SPService.putString(key, obj.toJSONString());
                 break;
-            case KEY_OV_PASSWORD:
             case KEY_ADB_SERVER:
             case KEY_PATCH_URL:
             case KEY_PERFORMANCE_UPLOAD:

File: src/app/src/main/java/com/alipay/hulu/util/CaseReplayUtil.java
Patch:
@@ -131,7 +131,6 @@ public static void restartTargetApp(final String packageName) {
             return;
         }
 
-        //如果是支付宝，点击后通过scheme跳到首页
         BackgroundExecutor.execute(new Runnable() {
             @Override
             public void run() {

File: src/app/src/main/java/com/alipay/hulu/service/FloatWinService.java
Patch:
@@ -293,7 +293,7 @@ public void writeFileData(String fileName, String message) {
 	 * 初始化界面
 	 */
 	private void createView() {
-		view = LayoutInflater.from(this).inflate(R.layout.float_win, null);
+		view = LayoutInflater.from(ContextUtil.getContextThemeWrapper(this, R.style.AppTheme)).inflate(R.layout.float_win, null);
 		// 关闭按钮
 		close = (ImageView) view.findViewById(R.id.closeIcon);
 		// 录制开关

File: src/app/src/main/java/com/alipay/hulu/activity/NewReplayListActivity.java
Patch:
@@ -24,6 +24,7 @@
 import android.support.v4.app.FragmentManager;
 import android.support.v4.app.FragmentPagerAdapter;
 import android.support.v4.view.ViewPager;
+import android.util.TypedValue;
 import android.view.LayoutInflater;
 import android.view.View;
 import android.view.ViewGroup;
@@ -63,6 +64,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
         LinearLayout.LayoutParams params = new LinearLayout.LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT);
         params.setMarginEnd(ContextUtil.dip2px(this, 16));
         rightTitle.setTextColor(Color.WHITE);
+        rightTitle.setTextSize(TypedValue.COMPLEX_UNIT_PX, getResources().getDimensionPixelSize(R.dimen.textsize_13));
         rightTitle.setText(R.string.constant__batch_replay);
         rightTitle.setOnClickListener(new View.OnClickListener() {
             @Override

File: src/app/src/main/java/com/alipay/hulu/activity/SettingsActivity.java
Patch:
@@ -51,6 +51,7 @@
 import com.alipay.hulu.shared.node.tree.export.bean.OperationStep;
 import com.alipay.hulu.ui.HeadControlPanel;
 import com.alipay.hulu.upgrade.PatchRequest;
+import com.alipay.hulu.util.DialogUtils;
 import com.alipay.hulu.util.DialogUtils.OnDialogResultListener;
 import com.zhy.view.flowlayout.FlowLayout;
 import com.zhy.view.flowlayout.TagAdapter;

File: src/app/src/main/java/com/alipay/hulu/replay/AbstractStepProvider.java
Patch:
@@ -144,7 +144,7 @@ public void onCancel(DialogInterface dialog) {
                             dialog.dismiss();
                         }
                     }).create();
-            dialog.getWindow().setType(WindowManager.LayoutParams.TYPE_SYSTEM_ALERT);
+            dialog.getWindow().setType(com.alipay.hulu.common.constant.Constant.TYPE_ALERT);
             dialog.setCanceledOnTouchOutside(false);
             dialog.show();
         } catch (Exception e) {

File: src/app/src/main/java/com/alipay/hulu/scheme/PerformanceSchemeResolver.java
Patch:
@@ -30,6 +30,7 @@
 import com.alipay.hulu.common.tools.BackgroundExecutor;
 import com.alipay.hulu.common.utils.PermissionUtil;
 import com.alipay.hulu.common.utils.StringUtil;
+import com.alipay.hulu.screenRecord.Notifications;
 import com.alipay.hulu.shared.display.DisplayProvider;
 import com.alipay.hulu.shared.display.items.base.RecordPattern;
 import com.alipay.hulu.util.RecordUtil;
@@ -116,7 +117,7 @@ public void onPermissionResult(boolean result, String reason) {
                             displayProvider.startDisplay(name);
                         }
                         displayProvider.startRecording();
-                        notification = new Notification.Builder(context)
+                        notification = Notifications.generateNotificationBuilder(context)
                                 .setContentTitle(context.getString(R.string.performance__recording))
                                 .setOngoing(true)
                                 .setOnlyAlertOnce(true)

File: src/app/src/main/java/com/alipay/hulu/screenRecord/RecordService.java
Patch:
@@ -246,7 +246,7 @@ public void onClick(View v) {
 
         wm = (WindowManager) getApplicationContext().getSystemService(WINDOW_SERVICE);
         wmParams = ((MyApplication)getApplication()).getFloatWinParams();
-        wmParams.type = WindowManager.LayoutParams.TYPE_SYSTEM_ALERT;
+        wmParams.type = com.alipay.hulu.common.constant.Constant.TYPE_ALERT;
         wmParams.flags |= 8;
         wmParams.gravity = Gravity.LEFT | Gravity.TOP; // 调整悬浮窗口至左上角
         // 以屏幕左上角为原点，设置x、y初始值

File: src/app/src/main/java/com/alipay/hulu/service/CaseRecordManager.java
Patch:
@@ -1207,7 +1207,7 @@ public void onClick(DialogInterface dialog, int which) {
                             notifyDialogDismiss(2000);
                         }
                     }).create();
-            dialog.getWindow().setType(WindowManager.LayoutParams.TYPE_SYSTEM_ALERT);
+            dialog.getWindow().setType(com.alipay.hulu.common.constant.Constant.TYPE_ALERT);
             dialog.setCanceledOnTouchOutside(false);
             dialog.setCancelable(false);
             dialog.show();

File: src/app/src/main/java/com/alipay/hulu/service/CaseReplayManager.java
Patch:
@@ -870,7 +870,7 @@ public void onClick(DialogInterface dialog, int which) {
                             dialog.dismiss();
                         }
                     }).create();
-            dialog.getWindow().setType(WindowManager.LayoutParams.TYPE_SYSTEM_ALERT);
+            dialog.getWindow().setType(com.alipay.hulu.common.constant.Constant.TYPE_ALERT);
             dialog.setCanceledOnTouchOutside(false);
             dialog.setCancelable(false);
             dialog.show();

File: src/shared/src/main/java/com/alipay/hulu/shared/event/accessibility/AccessibilityEventTracker.java
Patch:
@@ -211,7 +211,8 @@ public void run() {
                     }
                 }, 10);
             // Android Q 权限处理
-            } else if (Build.VERSION.SDK_INT >= 29 && StringUtil.equals(event.getPackageName(), "com.android.permissioncontroller")) {
+            } else if (Build.VERSION.SDK_INT >= 29 && (StringUtil.equals(event.getPackageName(), "com.android.permissioncontroller")
+                        || StringUtil.equals(event.getPackageName(), "com.google.android.permissioncontroller"))) {
                 // 就是个Dialog，直接用HandleAlert处理掉
                 BackgroundExecutor.execute(new Runnable() {
                     @Override

File: src/app/src/main/java/com/alipay/hulu/service/CaseRecordManager.java
Patch:
@@ -880,7 +880,7 @@ highLightService, operationService, getLocalClickPos(), new FunctionSelectUtil.F
                     public void onProcessFunction(final OperationMethod method, final AbstractNodeTree node) {
                         LogUtil.d(TAG, "悬浮窗消失");
 
-                        // 切换回葫芦娃输入法
+                        // 切换回SoloPi输入法
                         CmdTools.switchToIme("com.alipay.hulu/.tools.AdbIME");
 
                         // 等悬浮窗消失了再操作

File: src/app/src/main/java/com/alipay/hulu/util/DialogUtils.java
Patch:
@@ -535,8 +535,8 @@ public void onSubMenuClick(TwoLevelSelectLayout.SubMenuItem item) {
                 DisplayMetrics metrics = new DisplayMetrics();
                 wm.getDefaultDisplay().getMetrics(metrics);
 
-                // 高度450dp, 宽度260dp
-                int pix = ContextUtil.dip2px(context, 440);
+                // 高度400dp, 宽度260dpa
+                int pix = ContextUtil.dip2px(context, 400);
                 int width = ContextUtil.dip2px(context, 270);
                 if (metrics.heightPixels < pix) {
                     if (metrics.widthPixels < width) {

File: src/shared/src/main/java/com/alipay/hulu/shared/node/action/OperationExecutor.java
Patch:
@@ -491,11 +491,10 @@ private void inputText(final String text, final Rect rect, OperationContext list
             public void run() {
                 LogUtil.e(TAG, "Start Input");
                 try {
-                    String defaultIme = executor.executeCmdSync("settings get secure default_input_method");
                     CmdTools.switchToIme("com.alipay.hulu/.tools.AdbIME");
                     executor.executeClick(rect.centerX(), rect.centerY());
                     MiscUtil.sleep(1500);
-                    executor.executeCmdSync("am broadcast -a ADB_INPUT_TEXT --es msg '" + text + "' --es default '" + StringUtil.trim(defaultIme) + "'", 0);
+                    InjectorService.g().pushMessage("ADB_INPUT_TEXT", text);
                 } catch (Exception e) {
                     LogUtil.e(TAG, "Input throw Exception：" + e.getLocalizedMessage(), e);
                 }

File: src/shared/src/main/java/com/alipay/hulu/shared/node/tree/AbstractNodeTree.java
Patch:
@@ -21,6 +21,7 @@
 import android.support.annotation.NonNull;
 
 import com.alipay.hulu.common.application.LauncherApplication;
+import com.alipay.hulu.common.injector.InjectorService;
 import com.alipay.hulu.common.tools.CmdTools;
 import com.alipay.hulu.common.utils.ClassUtil;
 import com.alipay.hulu.common.utils.LogUtil;
@@ -188,11 +189,10 @@ public boolean performAction(OperationMethod method, final OperationContext cont
                     public void run() {
                         LogUtil.e(TAG, "Start Input");
                         try {
-                            String defaultIme = context.executor.executeCmdSync("settings get secure default_input_method");
                             CmdTools.switchToIme("com.alipay.hulu/.tools.AdbIME");
                             context.executor.executeClick(rect.centerX(), rect.centerY());
                             MiscUtil.sleep(1500);
-                            context.executor.executeCmdSync("am broadcast -a ADB_SEARCH_TEXT --es msg '" + text + "' --es default '" + StringUtil.trim(defaultIme) + "'", 0);
+                            InjectorService.g().pushMessage("ADB_SEARCH_TEXT", text);
                         } catch (Exception e) {
                             LogUtil.e(TAG, "Input throw Exception：" + e.getLocalizedMessage(), e);
                         }

File: src/app/src/main/java/com/alipay/hulu/activity/IndexActivity.java
Patch:
@@ -233,7 +233,7 @@ public void onPermissionResult(boolean result, String reason) {
         mGridView.setAdapter(adapter);
 
         // 有写权限，申请下
-        PatchRequest.updatePatchList(this);
+        PatchRequest.updatePatchList(null);
     }
 
     /**

File: src/app/src/main/java/com/alipay/hulu/service/CaseRecordManager.java
Patch:
@@ -746,6 +746,7 @@ public void run() {
         GLOBAL_KEYS.add(R.string.function_group__extra);
         GLOBAL_ICONS.add(R.drawable.dialog_action_drawable_extra);
 
+        GLOBAL_KEYS.add(R.string.function_group__logic);
         GLOBAL_ICONS.add(R.drawable.dialog_action_drawable_logic);
         List<TwoLevelSelectLayout.SubMenuItem> gLoopActions = new ArrayList<>();
         gLoopActions.add(convertPerformActionToSubMenu(PerformActionEnum.LET));

File: src/common/src/main/java/com/alipay/hulu/common/injector/provider/Param.java
Patch:
@@ -24,4 +24,6 @@
     Class<?> type() default Void.class;
 
     boolean sticky() default true;
+
+    boolean persistent() default false;
 }

File: src/common/src/main/java/com/alipay/hulu/common/utils/activity/PermissionDialogActivity.java
Patch:
@@ -753,7 +753,7 @@ public void run() {
     /**
      * 关闭Instrument和UIAutomator
      */
-    public void cleanInstrumentationAndUiAutomator() {
+    public static void cleanInstrumentationAndUiAutomator() {
         String allActions = CmdTools.execHighPrivilegeCmd("ps -ef | grep shell");
         LogUtil.i(TAG, "Let me see::::" + allActions);
 
@@ -775,7 +775,7 @@ public void cleanInstrumentationAndUiAutomator() {
                     continue;
                 }
 
-                LauncherApplication.getInstance().showToast(getString(R.string.permission__kill_app, instPkg));
+                LauncherApplication.getInstance().showToast(StringUtil.getString(R.string.permission__kill_app, instPkg));
                 LogUtil.i(TAG, "Find instrumentation package and killing \"" + instPkg + "\"");
                 String exeRes = CmdTools.execHighPrivilegeCmd("am force-stop " + instPkg);
                 LogUtil.i(TAG, "force-stop result:::" + exeRes);

File: src/common/src/main/java/com/alipay/hulu/common/service/SPService.java
Patch:
@@ -43,6 +43,7 @@ public class SPService {
     public static final String KEY_USE_LANGUAGE = "KEY_USE_LANGUAGE";
     public static final String KEY_SCREEN_FACTOR_ROTATION = "KEY_SCREEN_FACTOR_ROTATION";
     public static final String KEY_SCREEN_ROTATION = "KEY_SCREEN_ROTATION";
+    public static final String KEY_SERIAL_ID = "KEY_SERIAL_ID";
 
     public static final String KEY_SCREENSHOT_RESOLUTION = "KEY_SCREENSHOT_RESOLUTION";
     public static final String KEY_HIGHLIGHT_REPLAY_NODE = "KEY_HIGHLIGHT_REPLAY_NODE";

File: src/app/src/main/java/com/alipay/hulu/activity/MyApplication.java
Patch:
@@ -60,10 +60,8 @@
 import java.util.Map;
 import java.util.Timer;
 import java.util.TimerTask;
-import java.util.concurrent.TimeUnit;
 
 import cn.dreamtobe.filedownloader.OkHttp3Connection;
-import okhttp3.OkHttpClient;
 
 public class MyApplication extends LauncherApplication {
     private static final String TAG = "MyApplication";
@@ -493,7 +491,7 @@ public Map<String, Object> getAppAndAppName() {
 
     private void initLibraries() {
         initGreenDao();
-        initFileDownloader();
+//        initFileDownloader();
 
         curSysInputMethod = Settings.Secure.getString(getContentResolver(), Settings.Secure.DEFAULT_INPUT_METHOD);
 

File: src/app/src/main/java/com/alipay/hulu/actions/RecordScreenActionProvider.java
Patch:
@@ -408,7 +408,7 @@ public void onReceiveEvent(PerformActionEnum actionEnum) {
 
             LogUtil.d(TAG, "Receive event: " + actionEnum);
 
-            // 主机模式需要监控葫芦点击事件
+            // 主机模式需要监控点击事件
             if (inMasterMode) {
                 LogUtil.d(TAG, "主机模式，控制悬浮窗点击");
                 injectorService.pushMessage("FloatClickMethod", new Callable<OperationMethod>() {

File: src/shared/src/main/java/com/alipay/hulu/shared/event/touch/TouchEventTracker.java
Patch:
@@ -499,7 +499,7 @@ private boolean envCheck() {
                 count ++;
             }
 
-            // adb完全挂了，stream无法恢复，等10s，看看葫芦娃的15s的adb保活是否有用
+            // adb完全挂了，stream无法恢复，等10s，看看SoloPi的15s的adb保活是否有用
             if (cmdLine == null || cmdLine.isClosed()) {
                 LogUtil.e(TAG, "Stream can't recover from dead");
                 return false;

File: src/app/src/main/java/com/alipay/hulu/actions/ImageCompareActionProvider.java
Patch:
@@ -157,7 +157,7 @@ public void run() {
                     }, 1000);
 
                     // 执行adb命令
-                    CmdTools.execAdbCmd("input tap " + target.centerX() + " " + target.centerY(), 2000);
+                    context.executor.executeClick(target.centerX(), target.centerY());
 
                     // 等500ms
                     MiscUtil.sleep(500);
@@ -255,8 +255,8 @@ public Map<String, String> provideActions(AbstractNodeTree node) {
         Map<String, String> actionMap = new HashMap<>(2);
 
         // 配置功能项
-        actionMap.put(ACTION_ASSERT_SCREENSHOT, "截图断言");
-        actionMap.put(ACTION_CLICK_BY_SCREENSHOT, "根据截图点击");
+        actionMap.put(ACTION_ASSERT_SCREENSHOT, StringUtil.getString(R.string.image_compare__screenshot_assert));
+        actionMap.put(ACTION_CLICK_BY_SCREENSHOT, StringUtil.getString(R.string.image_compare__screenshot_click));
 
         return actionMap;
     }

File: src/app/src/main/java/com/alipay/hulu/actions/PerformanceActionProvider.java
Patch:
@@ -135,9 +135,9 @@ public Map<String, String> provideActions(AbstractNodeTree node) {
 
         // 配置功能项
         if (isRecording) {
-            actionMap.put(ACTION_STOP_RECORD, "停止性能录制");
+            actionMap.put(ACTION_STOP_RECORD, StringUtil.getString(R.string.performance__stop_record));
         } else {
-            actionMap.put(ACTION_START_RECORD, "开始性能录制");
+            actionMap.put(ACTION_START_RECORD, StringUtil.getString(R.string.performance__start_record));
         }
 
         return actionMap;

File: src/app/src/main/java/com/alipay/hulu/actions/RecordScreenActionProvider.java
Patch:
@@ -233,9 +233,9 @@ public Map<String, String> provideActions(AbstractNodeTree node) {
 
         Map<String, String> desc = new HashMap<>(2);
         if (!isRecording) {
-            desc.put(ACTION_START_RECORD_SCREEN, "开始响应耗时计算");
+            desc.put(ACTION_START_RECORD_SCREEN, StringUtil.getString(R.string.record_screen__start_launch_time));
         } else {
-            desc.put(ACTION_STOP_RECORD_SCREEN, "结束响应耗时计算");
+            desc.put(ACTION_STOP_RECORD_SCREEN, StringUtil.getString(R.string.record_screen__stop_launch_time));
         }
 
         return desc;

File: src/app/src/main/java/com/alipay/hulu/activity/CaseParamEditActivity.java
Patch:
@@ -140,13 +140,13 @@ private void initView() {
     @Override
     public void onBackPressed() {
         if (!saved) {
-            LauncherApplication.getInstance().showDialog(this, "是否保存用例", "是", new Runnable() {
+            LauncherApplication.getInstance().showDialog(this, getString(R.string.case_edit__should_save_case), getString(R.string.constant__yes), new Runnable() {
                 @Override
                 public void run() {
                     saveCase();
                     finish();
                 }
-            }, "否", new Runnable() {
+            }, getString(R.string.constant__no), new Runnable() {
                 @Override
                 public void run() {
                     finish();

File: src/app/src/main/java/com/alipay/hulu/activity/NewRecordActivity.java
Patch:
@@ -74,7 +74,7 @@
 /**
  * Created by lezhou.wyl on 2018/2/1.
  */
-@EntryActivity(icon = R.drawable.icon_luxiang, nameRes = R.string.activity__record, permissions = {"adb", "float", "toast:请将Soloπ添加到后台白名单中"}, index = 1, cornerText = "New", cornerPersist = 3, cornerBg = 0xFFFF5900)
+@EntryActivity(icon = R.drawable.icon_luxiang, nameRes = R.string.activity__record, permissions = {"adb", "float", "background", "toast:请将SoloPi添加到后台白名单中"}, index = 1, cornerText = "New", cornerPersist = 3, cornerBg = 0xFFFF5900)
 public class NewRecordActivity extends BaseActivity {
 
     private static final String TAG = NewRecordActivity.class.getSimpleName();

File: src/app/src/main/java/com/alipay/hulu/activity/entry/EntryActivity.java
Patch:
@@ -15,6 +15,8 @@
  */
 package com.alipay.hulu.activity.entry;
 
+import android.support.annotation.StringRes;
+
 import java.lang.annotation.ElementType;
 import java.lang.annotation.Retention;
 import java.lang.annotation.RetentionPolicy;
@@ -43,6 +45,7 @@
      * name string res
      * @return
      */
+    @StringRes
     int nameRes() default 0;
 
     /**

File: src/app/src/main/java/com/alipay/hulu/event/ScanSuccessEvent.java
Patch:
@@ -26,6 +26,7 @@ public class ScanSuccessEvent implements Parcelable {
 
     public static final int SCAN_TYPE_SCHEME = 1;
     public static final int SCAN_TYPE_PARAM = 6;
+    public static final int SCAN_TYPE_OTHER = 7;
     private int type;
     private String content;
 

File: src/app/src/main/java/com/alipay/hulu/fragment/BatchExecutionFragment.java
Patch:
@@ -29,6 +29,7 @@
 import com.alipay.hulu.adapter.BatchExecutionListAdapter;
 import com.alipay.hulu.common.tools.BackgroundExecutor;
 import com.alipay.hulu.common.utils.PermissionUtil;
+import com.alipay.hulu.common.utils.StringUtil;
 import com.alipay.hulu.replay.BatchStepProvider;
 import com.alipay.hulu.service.CaseReplayManager;
 import com.alipay.hulu.shared.io.bean.RecordCaseInfo;
@@ -58,7 +59,7 @@ public static int[] getTypes() {
     }
 
     public static String getTypeName(int type) {
-        return "本地";
+        return StringUtil.getString(R.string.replay_list__local);
     }
 
     public static BatchExecutionFragment newInstance(int type) {

File: src/app/src/main/java/com/alipay/hulu/fragment/CaseStepEditFragment.java
Patch:
@@ -734,6 +734,8 @@ public void onCancel() {
         gScrollActions.add(convertPerformActionToSubMenu(PerformActionEnum.GLOBAL_SCROLL_TO_TOP));
         gScrollActions.add(convertPerformActionToSubMenu(PerformActionEnum.GLOBAL_SCROLL_TO_LEFT));
         gScrollActions.add(convertPerformActionToSubMenu(PerformActionEnum.GLOBAL_SCROLL_TO_RIGHT));
+        gScrollActions.add(convertPerformActionToSubMenu(PerformActionEnum.GLOBAL_PINCH_OUT));
+        gScrollActions.add(convertPerformActionToSubMenu(PerformActionEnum.GLOBAL_PINCH_IN));
         GLOBAL_ACTION_MAP.put(R.string.function_group__scroll, gScrollActions);
 
         // 循环逻辑控制

File: src/app/src/main/java/com/alipay/hulu/fragment/ReplayListFragment.java
Patch:
@@ -107,7 +107,7 @@ public static int[] getAvailableTypes() {
     }
 
     public static String getTypeName(int type) {
-        return "本地";
+        return StringUtil.getString(R.string.replay_list__local);
     }
 
     @Override

File: src/app/src/main/java/com/alipay/hulu/service/DisplayManager.java
Patch:
@@ -267,10 +267,10 @@ public void run() {
                     File folder = RecordUtil.saveToFile(result);
 
                     // 显示提示框
-                    LauncherApplication.getInstance().showDialog(binder.loadServiceContext(), "录制数据已经保存到\"" + folder.getPath() + "\"下" , "确定", null);
+                    LauncherApplication.getInstance().showDialog(binder.loadServiceContext(), StringUtil.getString(R.string.performance__record_save, folder.getPath()) , StringUtil.getString(R.string.constant__confirm), null);
                 } else {
                     String response = RecordUtil.uploadData(uploadUrl, result);
-                    LauncherApplication.getInstance().showDialog(binder.loadServiceContext(), "录制数据已经上传至\"" + uploadUrl + "\"，响应结果: " + response , "确定", null);
+                    LauncherApplication.getInstance().showDialog(binder.loadServiceContext(), StringUtil.getString(R.string.performance__record_upload,  uploadUrl, response), StringUtil.getString(R.string.constant__confirm), null);
                 }
             }
         });

File: src/app/src/main/java/com/alipay/hulu/tools/AdbIME.java
Patch:
@@ -180,13 +180,13 @@ public void onReceive(Context context, Intent intent) {
                 if (defaultIme == null) {
                     defaultIme = MyApplication.getCurSysInputMethod();
                 }
-                if (!StringUtil.isEmpty(defaultIme)) {
+                if (!StringUtil.isEmpty(defaultIme) && !StringUtil.equals(defaultIme, "com.alipay.hulu/.tools.AdbIME")) {
                     final String finalDefaultIme = defaultIme;
                     // 两秒后切回原始输入法
                     BackgroundExecutor.execute(new Runnable() {
                         @Override
                         public void run() {
-                            CmdTools.execAdbCmd("settings put secure default_input_method " + finalDefaultIme, 2000);
+                            CmdTools.switchToIme(finalDefaultIme);
                             OperationService service = LauncherApplication.getInstance().findServiceByName(OperationService.class.getName());
 
                             MiscUtil.sleep(1000);

File: src/app/src/main/java/com/alipay/hulu/ui/ReverseImageView.java
Patch:
@@ -123,7 +123,7 @@ private void restoreImage() {
      */
     private static Bitmap getBitmap(Context context,int vectorDrawableId) {
         Bitmap bitmap;
-        if (Build.VERSION.SDK_INT>Build.VERSION_CODES.LOLLIPOP){
+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP){
             Drawable vectorDrawable = context.getDrawable(vectorDrawableId);
             bitmap = Bitmap.createBitmap(vectorDrawable.getIntrinsicWidth(),
                     vectorDrawable.getIntrinsicHeight(), Bitmap.Config.ARGB_8888);

File: src/app/src/main/java/com/alipay/hulu/ui/TwoLevelSelectLayout.java
Patch:
@@ -106,7 +106,7 @@ private void initView(Context context, AttributeSet attrs, int style) {
         firstLevel = new ListView(styledContext);
         firstLevel.setVerticalScrollBarEnabled(false);
 
-        LayoutParams params = new LayoutParams(ContextUtil.dip2px(context, 40), ViewGroup.LayoutParams.MATCH_PARENT);
+        LayoutParams params = new LayoutParams(ContextUtil.dip2px(context, 50), ViewGroup.LayoutParams.MATCH_PARENT);
         addView(firstLevel, params);
 
         // 分割线

File: src/app/src/main/java/com/alipay/hulu/util/DialogUtils.java
Patch:
@@ -200,6 +200,7 @@ public static ProgressDialog showProgressDialog(final Context context, final Str
             public void run() {
                 ProgressDialog progressDialog = new ProgressDialog(context, R.style.SimpleDialogTheme);
                 progressDialog.setMessage(str);
+                progressDialog.getWindow().setType(WindowManager.LayoutParams.TYPE_SYSTEM_ALERT);
                 progressDialog.setProgressStyle(ProgressDialog.STYLE_SPINNER);
                 progressDialog.show();
                 dialogs[0] = progressDialog;
@@ -535,7 +536,7 @@ public void onSubMenuClick(TwoLevelSelectLayout.SubMenuItem item) {
 
                 // 高度400dp, 宽度260dp
                 int pix = ContextUtil.dip2px(context, 400);
-                int width = ContextUtil.dip2px(context, 260);
+                int width = ContextUtil.dip2px(context, 270);
                 if (metrics.heightPixels < pix) {
                     if (metrics.widthPixels < width) {
                         dialog.getWindow().setLayout(WindowManager.LayoutParams.WRAP_CONTENT, WindowManager.LayoutParams.WRAP_CONTENT);

File: src/app/src/main/java/com/alipay/hulu/util/RecordUtil.java
Patch:
@@ -51,6 +51,7 @@
  */
 public class RecordUtil {
     private static final String TAG = "RecordUtil";
+    private static final DateFormat TIME_FORMAT = new SimpleDateFormat("yyyyMMddHHmmss", Locale.CHINA);
 
     /**
      * 保存到文件夹
@@ -121,8 +122,7 @@ public static File saveToFile(Map<RecordPattern, List<RecordPattern.RecordItem>>
      */
     private static File loadSaveDir(Date startTime, Date endTime) {
         File recordDir = FileUtils.getSubDir("records");
-        DateFormat format = new SimpleDateFormat("MM月dd日HH:mm:ss", Locale.CHINA);
-        File saveFolder = new File(recordDir, format.format(startTime) + "-" + format.format(endTime));
+        File saveFolder = new File(recordDir, TIME_FORMAT.format(startTime) + "_" + TIME_FORMAT.format(endTime));
         saveFolder.mkdir();
         return saveFolder;
     }

File: src/common/src/main/java/com/alipay/hulu/common/utils/FileUtils.java
Patch:
@@ -201,7 +201,7 @@ public static File[] getAutoClearDirs() {
     }
 
     /**
-     * 获取Soloπ子目录
+     * 获取SoloPi子目录
      * @return
      */
     public static File getSubDir(String name) {
@@ -214,7 +214,7 @@ public static File getSubDir(String name) {
     }
 
     /**
-     * 获取SoloπCache目录
+     * 获取SoloPiCache目录
      * @param name
      * @return
      */
@@ -251,7 +251,7 @@ public static String getPathInShell(File file) {
     }
 
     /**
-     * 获取Soloπ子目录
+     * 获取SoloPi子目录
      * @return
      */
     public static File getInnerSubDir(String name) {

File: src/common/src/main/java/com/alipay/hulu/common/utils/PermissionUtil.java
Patch:
@@ -191,7 +191,7 @@ public void run() {
                     CmdTools.generateConnection();
                 }
             });
-            LauncherApplication.toast(R.string.permission__no_root_need_adb);
+            LauncherApplication.toast(R.string.open_adb_permission_failed);
             return false;
         }
         return true;

File: src/permission/src/main/java/com/android/permission/rom/MiuiUtils.java
Patch:
@@ -88,6 +88,7 @@ public static void applyMiuiPermission(Context context) {
             goToMiuiPermissionActivity_V8(context);
         } else {
             Log.e(TAG, "this is a special MIUI rom version, its version code " + versionCode);
+            goToMiuiPermissionActivity_V8(context);
         }
     }
 

File: src/shared/src/main/java/com/alipay/hulu/shared/display/DisplayProvider.java
Patch:
@@ -45,7 +45,7 @@
  * Created by qiaoruikai on 2018/10/15 2:27 PM.
  */
 @LocalService
-public class DisplayProvider implements ExportService{
+public class DisplayProvider implements ExportService {
     private static final String TAG = "DisplayProvider";
 
     public static final int DISPLAY_MODE = 0;

File: src/shared/src/main/java/com/alipay/hulu/shared/display/items/BatteryInfo.java
Patch:
@@ -29,9 +29,11 @@
 import com.alipay.hulu.common.tools.CmdTools;
 import com.alipay.hulu.common.utils.LogUtil;
 import com.alipay.hulu.common.utils.StringUtil;
+import com.alipay.hulu.shared.R;
 import com.alipay.hulu.shared.display.items.base.DisplayItem;
 import com.alipay.hulu.shared.display.items.base.Displayable;
 import com.alipay.hulu.shared.display.items.base.RecordPattern;
+import com.alipay.hulu.shared.display.items.util.FinalR;
 
 import java.io.File;
 import java.io.FileDescriptor;
@@ -46,7 +48,7 @@
 import java.util.List;
 import java.util.Map;
 
-@DisplayItem(name = "电池", trigger = "清零")
+@DisplayItem(nameRes = FinalR.BATTERY, trigger = "清零")
 public class BatteryInfo implements Displayable{
 
 	private static String batteryPath = null;

File: src/shared/src/main/java/com/alipay/hulu/shared/display/items/FpsTools.java
Patch:
@@ -20,17 +20,19 @@
 import com.alipay.hulu.common.injector.param.Subscriber;
 import com.alipay.hulu.common.injector.provider.Param;
 import com.alipay.hulu.common.utils.StringUtil;
+import com.alipay.hulu.shared.R;
 import com.alipay.hulu.shared.display.items.base.DisplayItem;
 import com.alipay.hulu.shared.display.items.base.Displayable;
 import com.alipay.hulu.shared.display.items.base.RecordPattern;
+import com.alipay.hulu.shared.display.items.util.FinalR;
 import com.alipay.hulu.shared.display.items.util.FpsUtil;
 
 import java.util.ArrayList;
 import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
 
-@DisplayItem(name = "帧率", permissions = "toast:请在设置里\"开发人员选项\"中开启\"GPU呈现模式分析\"选项")
+@DisplayItem(nameRes = FinalR.FPS, permissions = "toast:请在设置里\"开发人员选项\"中开启\"GPU呈现模式分析\"选项")
 public class FpsTools implements Displayable {
 	private static String TAG = "FpsTools";
 	private static Long startTime = 0L;

File: src/shared/src/main/java/com/alipay/hulu/shared/display/items/MemoryTools.java
Patch:
@@ -27,10 +27,12 @@
 import com.alipay.hulu.common.injector.param.Subscriber;
 import com.alipay.hulu.common.injector.provider.Param;
 import com.alipay.hulu.common.utils.LogUtil;
+import com.alipay.hulu.shared.R;
 import com.alipay.hulu.shared.display.items.base.DisplayItem;
 import com.alipay.hulu.shared.display.items.base.Displayable;
 import com.alipay.hulu.shared.display.items.base.FixedLengthCircularArray;
 import com.alipay.hulu.shared.display.items.base.RecordPattern;
+import com.alipay.hulu.shared.display.items.util.FinalR;
 
 import java.util.ArrayList;
 import java.util.Collections;
@@ -39,7 +41,7 @@
 import java.util.Locale;
 import java.util.Map;
 
-@DisplayItem(name = "内存")
+@DisplayItem(nameRes = FinalR.MEMORY)
 public class MemoryTools implements Displayable{
 
 	private static String TAG = "MemoryTools";

File: src/shared/src/main/java/com/alipay/hulu/shared/display/items/NetworkTools.java
Patch:
@@ -24,16 +24,18 @@
 import com.alipay.hulu.common.injector.provider.Param;
 import com.alipay.hulu.common.tools.CmdTools;
 import com.alipay.hulu.common.utils.LogUtil;
+import com.alipay.hulu.shared.R;
 import com.alipay.hulu.shared.display.items.base.DisplayItem;
 import com.alipay.hulu.shared.display.items.base.Displayable;
 import com.alipay.hulu.shared.display.items.base.RecordPattern;
+import com.alipay.hulu.shared.display.items.util.FinalR;
 
 import java.util.ArrayList;
 import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
 
-@DisplayItem(name = "网络", trigger = "清零")
+@DisplayItem(nameRes = FinalR.NETWORK, trigger = "清零")
 public class NetworkTools implements Displayable{
 
 	private static final float KB_MILLION_SECOND = 1000 / 1024f;

File: src/shared/src/main/java/com/alipay/hulu/shared/event/accessibility/AccessibilityEventTracker.java
Patch:
@@ -185,7 +185,7 @@ public void run() {
                         public void run() {
                             Rect pos = new Rect();
                             targetNode.getBoundsInScreen(pos);
-                            CmdTools.execAdbCmd("input tap " + pos.centerX() + " " + pos.centerY(), 0);
+                            CmdTools.execClick(pos.centerX(), pos.centerY());
 
                             // 点击了确定，需要cancel
                             operationRef.get().invalidRoot();
@@ -217,7 +217,7 @@ public void run() {
                         if (button != null && button.size() > 0) {
                             Rect pos = new Rect();
                             button.get(0).getBoundsInScreen(pos);
-                            CmdTools.execAdbCmd("input tap " + pos.centerX() + " " + pos.centerY(), 0);
+                            CmdTools.execClick(pos.centerX(), pos.centerY());
 
                             operationRef.get().invalidRoot();
                         }
@@ -231,7 +231,7 @@ public void run() {
                 if (nodeInfos != null && nodeInfos.size() == 1 && StringUtil.contains(nodeInfos.get(0).getText(), "允许")) {
                     Rect pos = new Rect();
                     nodeInfos.get(0).getBoundsInScreen(pos);
-                    CmdTools.execAdbCmd("input tap " + pos.centerX() + " " + pos.centerY(), 0);
+                    CmdTools.execClick(pos.centerX(), pos.centerY());
 
                     operationRef.get().invalidRoot();
                 }

File: src/shared/src/main/java/com/alipay/hulu/shared/event/accessibility/AccessibilityServiceImpl.java
Patch:
@@ -123,7 +123,7 @@ public void setAccessibilityEventTracker(AccessibilityEventTracker tracker) {
 
     @Override
     public void onAccessibilityEvent(AccessibilityEvent event) {
-        // Soloπ的窗口事件，不处理
+        // SoloPi的窗口事件，不处理
         if (StringUtil.equals(event.getPackageName(), getPackageName())) {
             return;
         }

File: src/shared/src/main/java/com/alipay/hulu/shared/io/db/OperationLogHandler.java
Patch:
@@ -46,10 +46,10 @@ public class OperationLogHandler implements OperationStepProcessor {
 
     private static final String TAG = "OperationLogHandler";
 
-    private RecordCaseInfo caseInfo;
+    protected RecordCaseInfo caseInfo;
 
-    private GeneralOperationLogBean generalOperation;
-    private PriorityQueue<Pair<Integer, OperationStep>> generalPriorityQueue;
+    protected GeneralOperationLogBean generalOperation;
+    protected PriorityQueue<Pair<Integer, OperationStep>> generalPriorityQueue;
 
     private ExecutorService dbOperationExecutor = Executors.newSingleThreadExecutor();
 

File: src/shared/src/main/java/com/alipay/hulu/shared/node/action/OperationContext.java
Patch:
@@ -30,6 +30,8 @@ public void run() {
                 } catch (Throwable e) {
                     LogUtil.e("OperationContext", "execute background action throw " + e.getMessage(), e);
                 } finally {
+                    // 清理当前结构
+                    opExecutor.invalidRoot();
                     notifyOperationFinish();
                 }
             }

File: src/shared/src/main/java/com/alipay/hulu/shared/node/tree/accessibility/AccessibilityProvider.java
Patch:
@@ -86,7 +86,7 @@ private MetaTree getRootInWindows(AccessibilityService service) {
                 if (root == null) {
                     continue;
                 }
-                // 如果是Soloπ自己的window，就不处理
+                // 如果是SoloPi自己的window，就不处理
                 if (StringUtil.equals(root.getPackageName(), "com.alipay.hulu")) {
                     LogUtil.d(TAG, "自己的Windows，不处理");
                     continue;

File: src/shared/src/main/java/com/alipay/hulu/shared/node/utils/PrepareUtil.java
Patch:
@@ -81,7 +81,7 @@ private static void initPrepareWorkers() {
                     public int compare(Class<? extends PrepareWorker> o1, Class<? extends PrepareWorker> o2) {
                         PrepareWorker.PrepareTool o1T = o1.getAnnotation(PrepareWorker.PrepareTool.class);
                         PrepareWorker.PrepareTool o2T = o2.getAnnotation(PrepareWorker.PrepareTool.class);
-                        return o2T.priority() - o1T.priority();
+                        return o2T.priority() < o1T.priority()? -1: ((o2T.priority() == o1T.priority())? 0: 1);
                     }
                 });
 

File: src/app/src/main/java/com/alipay/hulu/activity/IndexActivity.java
Patch:
@@ -218,7 +218,7 @@ public int compare(Entry o1, Entry o2) {
         mGridView.setAdapter(adapter);
 
         // 有写权限，申请下
-        PatchRequest.updatePatchList();
+        PatchRequest.updatePatchList(this);
     }
 
     /**

File: src/app/src/main/java/com/alipay/hulu/activity/SettingsActivity.java
Patch:
@@ -211,7 +211,7 @@ public void onDialogPositive(List<String> data) {
                                 mPatchListInfo.setText(path);
 
                                 // 更新patch列表
-                                PatchRequest.updatePatchList();
+                                PatchRequest.updatePatchList(SettingsActivity.this);
                             }
                         }
                     }

File: src/app/src/main/java/com/alipay/hulu/fragment/CaseParamUnionFragment.java
Patch:
@@ -68,6 +68,9 @@ public void setAdvanceCaseSetting(@NonNull AdvanceCaseSetting advanceCaseSetting
         if (runningParam == null) {
             runningParam = new CaseRunningParam();
         }
+        if (presetParams == null) {
+            presetParams = new ArrayList<>();
+        }
 
         // 如果之前有存储p
         if (runningParam.getMode() == CaseRunningParam.ParamMode.UNION) {

File: src/app/src/main/java/com/alipay/hulu/activity/IndexActivity.java
Patch:
@@ -218,7 +218,7 @@ public int compare(Entry o1, Entry o2) {
         mGridView.setAdapter(adapter);
 
         // 有写权限，申请下
-        PatchRequest.updatePatchList();
+        PatchRequest.updatePatchList(this);
     }
 
     /**

File: src/app/src/main/java/com/alipay/hulu/activity/SettingsActivity.java
Patch:
@@ -211,7 +211,7 @@ public void onDialogPositive(List<String> data) {
                                 mPatchListInfo.setText(path);
 
                                 // 更新patch列表
-                                PatchRequest.updatePatchList();
+                                PatchRequest.updatePatchList(SettingsActivity.this);
                             }
                         }
                     }

File: src/AdbLib/src/com/cgutman/adblib/ByteQueueInputStream.java
Patch:
@@ -110,7 +110,7 @@ class ByteQueueInputStream extends InputStream {
      * <code>buf</code>.
      *
      */
-    protected ByteQueueInputStream() {
+    public ByteQueueInputStream() {
         this.readQueue = new ConcurrentLinkedQueue<>();
         this.pos = 0;
         this.count = 0;
@@ -133,7 +133,7 @@ public void closeSocketForwardingMode() {
      * 添加bytes到队列中
      * @param bytes
      */
-    protected void addBytes(byte[] bytes) {
+    public void addBytes(byte[] bytes) {
         this.readQueue.add(bytes);
 
         if (socketForward) {

File: src/app/src/main/java/com/alipay/hulu/actions/PerformanceActionProvider.java
Patch:
@@ -113,10 +113,10 @@ public void run() {
                         File folder = RecordUtil.saveToFile(records);
 
                         // 显示提示框
-                        LauncherApplication.getInstance().showToast("录制数据已经保存到\"" + folder.getPath() + "\"下");
+                        LauncherApplication.getInstance().showToast(StringUtil.getString(R.string.performance__record_save, folder.getPath()));
                     } else {
                         String response = RecordUtil.uploadData(uploadUrl, records);
-                        LauncherApplication.getInstance().showToast("录制数据已经上传至\"" + uploadUrl + "\"，响应结果: " + response);
+                        LauncherApplication.getInstance().showToast(StringUtil.getString(R.string.performance__record_upload, uploadUrl, response));
                     }
                 }
             });

File: src/app/src/main/java/com/alipay/hulu/activity/BatchReplayResultActivity.java
Patch:
@@ -120,7 +120,7 @@ public void onClick(View v) {
                 finish();
             }
         });
-        mPanel.setMiddleTitle("批量回放执行结果");
+        mPanel.setMiddleTitle(getString(R.string.activity__batch_replay_result));
     }
 
     private static class ResultAdapter extends BaseAdapter {
@@ -166,10 +166,10 @@ public View getView(int position, View convertView, ViewGroup parent) {
             if (bean != null) {
                 holder.caseName.setText(bean.getCaseName());
                 if (TextUtils.isEmpty(bean.getExceptionMessage())) {
-                    holder.result.setText("成功");
+                    holder.result.setText(R.string.constant__success);
                     holder.result.setTextColor(0xff65c0ba);
                 } else {
-                    holder.result.setText("失败");
+                    holder.result.setText(R.string.constant__fail);
                     holder.result.setTextColor(0xfff76262);
                 }
             }

File: src/app/src/main/java/com/alipay/hulu/activity/CaseReplayResultActivity.java
Patch:
@@ -103,7 +103,7 @@ private void initData() {
             return;
         }
 
-        mHeadPanel.setMiddleTitle("回放结果");
+        mHeadPanel.setMiddleTitle(getString(R.string.activity__replay_result));
         mHeadPanel.setBackIconClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View v) {
@@ -118,7 +118,7 @@ public void onClick(View v) {
             mHeadPanel.setInfoIconClickListener(R.drawable.icon_save, new View.OnClickListener() {
                 @Override
                 public void onClick(View v) {
-                    showProgressDialog("保存中");
+                    showProgressDialog(getString(R.string.case_replay__saving));
                     BackgroundExecutor.execute(new Runnable() {
                         @Override
                         public void run() {

File: src/app/src/main/java/com/alipay/hulu/activity/InfoActivity.java
Patch:
@@ -49,7 +49,7 @@ public void onClick(View v) {
                 InfoActivity.this.finish();
             }
         });
-        panel.setMiddleTitle("关于");
+        panel.setMiddleTitle(getString(R.string.activity__about));
 
         TextView versionName = (TextView) findViewById(R.id.version_name);
         versionName.setText(getString(R.string.info__version_text, SystemUtil.getAppVersionName()));

File: src/app/src/main/java/com/alipay/hulu/activity/LicenseActivity.java
Patch:
@@ -43,7 +43,7 @@ public void onClick(View v) {
                 finish();
             }
         });
-        panel.setMiddleTitle("开源许可");
+        panel.setMiddleTitle(getString(R.string.activity__license));
 
         final WebView licenseText = (WebView) findViewById(R.id.license_text);
         licenseText.loadUrl(NOTICE_HTML);

File: src/app/src/main/java/com/alipay/hulu/activity/MyApplication.java
Patch:
@@ -26,6 +26,7 @@
 import android.provider.Settings;
 import android.view.WindowManager;
 
+import com.alipay.hulu.R;
 import com.alipay.hulu.bean.CaseStepHolder;
 import com.alipay.hulu.bean.ReplayResultBean;
 import com.alipay.hulu.common.application.LauncherApplication;
@@ -181,7 +182,7 @@ public void run() {
 
                     LogUtil.w(TAG, "Copy anr file result: " + result);
 
-                    MyApplication.getInstance().showToast("发现anr信息，已拷贝至: " + pathInShell);
+                    MyApplication.getInstance().showToast(getString(R.string.app__find_anr_info, pathInShell));
                 }
             }
         }

File: src/app/src/main/java/com/alipay/hulu/activity/NewReplayListActivity.java
Patch:
@@ -72,7 +72,7 @@ public void onClick(View v) {
         });
         mHeadPanel.addMenuFromLeft(rightTitle);
 
-        mHeadPanel.setMiddleTitle(getString(R.string.constant__case_list));
+        mHeadPanel.setMiddleTitle(getString(R.string.activity__case_list));
         mHeadPanel.setBackIconClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View v) {
@@ -93,6 +93,7 @@ public void run() {
 
         ReplayPagerAdapter pagerAdapter = new ReplayPagerAdapter(getSupportFragmentManager());
         mPager.setAdapter(pagerAdapter);
+        mPager.setOffscreenPageLimit(2);
 
     }
 

File: src/app/src/main/java/com/alipay/hulu/activity/PerformanceChartActivity.java
Patch:
@@ -131,7 +131,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {
     private void initView(){
         setContentView(R.layout.activity_record_chart);
         headPanel = (HeadControlPanel) findViewById(R.id.head_layout);
-        headPanel.setMiddleTitle("录制数据");
+        headPanel.setMiddleTitle(getString(R.string.activity__performance_display));
         headPanel.setBackIconClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View v) {
@@ -227,7 +227,7 @@ public void onItemSelected(AdapterView<?> parent, View view, int position, long
                     }
 
                     if (realPattern == null) {
-                        Toast.makeText(PerformanceChartActivity.this, "录制数据未找到，请重新打开应用", Toast.LENGTH_SHORT).show();
+                        toastShort(R.string.performance_chart__no_record_data);
                         return;
                     }
 

File: src/app/src/main/java/com/alipay/hulu/adapter/BatchExecutionListAdapter.java
Patch:
@@ -99,7 +99,7 @@ public View getView(int position, View convertView, ViewGroup parent) {
             holder.createTime.setText(DateFormat.getDateTimeInstance().format(sDate));
             String caseDesc = recordCaseInfo.getCaseDesc();
             if (StringUtil.isEmpty(caseDesc)) {
-                holder.caseDesc.setText("暂无描述");
+                holder.caseDesc.setText(R.string.batch_adapter__no_desc);
             } else {
                 holder.caseDesc.setText(recordCaseInfo.getCaseDesc());
             }

File: src/app/src/main/java/com/alipay/hulu/event/ScanSuccessEvent.java
Patch:
@@ -25,6 +25,7 @@
 public class ScanSuccessEvent implements Parcelable {
 
     public static final int SCAN_TYPE_SCHEME = 1;
+    public static final int SCAN_TYPE_PARAM = 6;
     private int type;
     private String content;
 

File: src/app/src/main/java/com/alipay/hulu/replay/AbstractStepProvider.java
Patch:
@@ -72,7 +72,7 @@ public boolean canStart() {
      * @param reason 故障原因
      * @return 是否是故障
      */
-    public abstract boolean reportErrorStep(OperationStep step, String reason);
+    public abstract boolean reportErrorStep(OperationStep step, String reason, List<String> callStack);
 
     /**
      * 获取回放结果
@@ -121,7 +121,7 @@ protected void showFunctionView(Context context, String message, final Runnable
         try {
             AlertDialog dialog = new AlertDialog.Builder(context, R.style.SimpleDialogTheme)
                     .setMessage(message)
-                    .setPositiveButton("确定", new DialogInterface.OnClickListener() {
+                    .setPositiveButton(R.string.constant__confirm, new DialogInterface.OnClickListener() {
                         @Override
                         public void onClick(DialogInterface dialog, int which) {
                             if (confirmAction != null) {
@@ -130,7 +130,7 @@ public void onClick(DialogInterface dialog, int which) {
                             dialog.dismiss();
                         }
                     })
-                    .setNegativeButton("取消", new DialogInterface.OnClickListener() {
+                    .setNegativeButton(R.string.constant__cancel, new DialogInterface.OnClickListener() {
                         @Override
                         public void onClick(DialogInterface dialog, int which) {
                             if (cancelAction != null) {

File: src/app/src/main/java/com/alipay/hulu/replay/BatchStepProvider.java
Patch:
@@ -112,8 +112,8 @@ public boolean hasNext() {
     }
 
     @Override
-    public boolean reportErrorStep(OperationStep step, String reason) {
-        boolean errorResult = currentStepProvider.reportErrorStep(step, reason);
+    public boolean reportErrorStep(OperationStep step, String reason, List<String> stack) {
+        boolean errorResult = currentStepProvider.reportErrorStep(step, reason, stack);
 
         // 如果是关键性错误
         if (errorResult) {

File: src/app/src/main/java/com/alipay/hulu/replay/RepeatStepProvider.java
Patch:
@@ -98,8 +98,8 @@ public boolean hasNext() {
     }
 
     @Override
-    public boolean reportErrorStep(OperationStep step, String reason) {
-        boolean errorResult = currentStepProvider.reportErrorStep(step, reason);
+    public boolean reportErrorStep(OperationStep step, String reason, List<String> stack) {
+        boolean errorResult = currentStepProvider.reportErrorStep(step, reason, stack);
 
         // 如果是关键性错误
         if (errorResult) {

File: src/app/src/main/java/com/alipay/hulu/service/FloatWinService.java
Patch:
@@ -216,7 +216,7 @@ public void startDialog(String message) {
 			messageText = (TextView) v.findViewById(R.id.loading_dialog_text);
 			loadingDialog = new AlertDialog.Builder(this, R.style.AppDialogTheme)
 					.setView(v)
-					.setNegativeButton("隐藏", new DialogInterface.OnClickListener() {
+					.setNegativeButton(R.string.float__hide, new DialogInterface.OnClickListener() {
 						@Override
 						public void onClick(DialogInterface dialog, int which) {
 							dialog.dismiss();

File: src/app/src/main/java/com/alipay/hulu/upgrade/PatchRequest.java
Patch:
@@ -192,7 +192,7 @@ public void run() {
         if (loadingCount.get() > 0) {
             final BaseActivity activity = (BaseActivity) LauncherApplication.getInstance().loadActivityOnTop();
             if (activity != null) {
-                activity.showProgressDialog("加载插件中，请耐心等待");
+                activity.showProgressDialog(StringUtil.getString(R.string.patch__loading_plugin_wait));
                 BackgroundExecutor.execute(new Runnable() {
                     @Override
                     public void run() {

File: src/common/src/main/java/com/alipay/hulu/common/service/SPService.java
Patch:
@@ -34,6 +34,7 @@ public class SPService {
     public static final String KEY_SOLOPI_PATH_NAME = "KEY_SOLOPI_PATH_NAME";
     public static final String KEY_OUTPUT_CHARSET = "KEY_OUTPUT_CHARSET";
     public static final String KEY_ERROR_CHECK_TIME = "KEY_ERROR_CHECK_TIME";
+    public static final String KEY_GLOBAL_SETTINGS = "KEY_GLOBAL_SETTINGS";
     public static final String KEY_PERFORMANCE_UPLOAD = "KEY_PERFORMANCE_UPLOAD";
     public static final String KEY_DISPLAY_SYSTEM_APP = "KEY_DISPLAY_SYSTEM_APP";
     public static final String KEY_BASE_DIR = "KEY_BASE_DIR";

File: src/common/src/main/java/com/alipay/hulu/common/utils/PermissionUtil.java
Patch:
@@ -28,6 +28,7 @@
 import android.support.v4.content.ContextCompat;
 import android.widget.Toast;
 
+import com.alipay.hulu.common.R;
 import com.alipay.hulu.common.application.LauncherApplication;
 import com.alipay.hulu.common.tools.BackgroundExecutor;
 import com.alipay.hulu.common.tools.CmdTools;
@@ -190,8 +191,7 @@ public void run() {
                     CmdTools.generateConnection();
                 }
             });
-            Toast.makeText(context, "非Root设备需要开启ADB 5555端口并授权调试才可使用" +
-                    "\n请在命令行执行 adb tcpip 5555", Toast.LENGTH_LONG).show();
+            LauncherApplication.toast(R.string.permission__no_root_need_adb);
             return false;
         }
         return true;

File: src/common/src/main/java/com/alipay/hulu/common/utils/activity/FileChooseDialogActivity.java
Patch:
@@ -237,9 +237,9 @@ private void showCreateDialog() {
         editText.setText(defaultFileName);
         // 显示Dialog
         new AlertDialog.Builder(this, R.style.PermissionAppDialogTheme)
-                .setTitle("创建新文件夹")
+                .setTitle(R.string.file_choose__create_folder)
                 .setView(editText)
-                .setPositiveButton("确定", new DialogInterface.OnClickListener() {
+                .setPositiveButton(R.string.constant__confirm, new DialogInterface.OnClickListener() {
                     @Override
                     public void onClick(DialogInterface dialog, int which) {
                         if (StringUtil.isEmpty(editText.getText())) {
@@ -255,7 +255,7 @@ public void onClick(DialogInterface dialog, int which) {
                         }
                         dialog.dismiss();
                     }
-                }).setNegativeButton("取消", new DialogInterface.OnClickListener() {
+                }).setNegativeButton(R.string.constant__cancel, new DialogInterface.OnClickListener() {
             @Override
             public void onClick(DialogInterface dialog, int which) {
                 dialog.dismiss();

File: src/permission/src/main/java/com/android/permission/FloatWindowManager.java
Patch:
@@ -17,6 +17,7 @@
 import android.view.Gravity;
 import android.view.WindowManager;
 
+import com.android.floatwindowpermission.R;
 import com.android.permission.rom.HuaweiUtils;
 import com.android.permission.rom.MeizuUtils;
 import com.android.permission.rom.MiuiUtils;
@@ -298,14 +299,14 @@ private void showConfirmDialog(Context context, String message, final OnConfirmR
 
         dialog = new AlertDialog.Builder(context).setCancelable(true).setTitle("")
                 .setMessage(message)
-                .setPositiveButton("现在去开启",
+                .setPositiveButton(R.string.float__go_to_grant,
                         new DialogInterface.OnClickListener() {
                             @Override
                             public void onClick(DialogInterface dialog, int which) {
                                 result.confirmResult(true);
                                 dialog.dismiss();
                             }
-                        }).setNegativeButton("暂不开启",
+                        }).setNegativeButton(R.string.float__no_grant_now,
                         new DialogInterface.OnClickListener() {
 
                             @Override

File: src/permission/src/main/java/com/android/permission/rom/HuaweiUtils.java
Patch:
@@ -16,6 +16,8 @@
 import android.util.Log;
 import android.widget.Toast;
 
+import com.android.floatwindowpermission.R;
+
 import java.lang.reflect.Field;
 import java.lang.reflect.Method;
 
@@ -79,7 +81,7 @@ public static void applyPermission(Context context) {
             Log.e(TAG, Log.getStackTraceString(e));
         } catch (Exception e) {
             //抛出异常时提示信息
-            Toast.makeText(context, "进入设置页面失败，请手动设置", Toast.LENGTH_LONG).show();
+            Toast.makeText(context, R.string.huawei__setting_fail, Toast.LENGTH_LONG).show();
             Log.e(TAG, Log.getStackTraceString(e));
         }
     }

File: src/shared/src/main/java/com/alipay/hulu/shared/event/EventService.java
Patch:
@@ -20,6 +20,7 @@
 import android.provider.Settings;
 import android.widget.Toast;
 
+import com.alipay.hulu.common.application.LauncherApplication;
 import com.alipay.hulu.common.service.base.ExportService;
 import com.alipay.hulu.common.service.base.LocalService;
 import com.alipay.hulu.common.utils.PermissionUtil;
@@ -123,6 +124,6 @@ public void onDestroy(Context context) {
      * 展示开启辅助功能提示
      */
     private void showEnableAccessibilityServiceHint() {
-        Toast.makeText(contextRef.get(), "请在辅助功能中开启Soloπ", Toast.LENGTH_LONG).show();
+        LauncherApplication.getInstance().showToast("请在辅助功能中开启Soloπ");
     }
 }

File: src/shared/src/main/java/com/alipay/hulu/shared/node/tree/export/BaseStepExporter.java
Patch:
@@ -21,6 +21,6 @@
 /**
  * Created by qiaoruikai on 2018/10/10 5:15 PM.
  */
-public interface BaseStepProvider<T> {
+public interface BaseStepExporter<T> {
     T exportStep(AbstractNodeTree root, AbstractNodeTree currentNode, OperationMethod method);
 }

File: src/shared/src/main/java/com/alipay/hulu/shared/node/tree/export/OperationStepExporter.java
Patch:
@@ -21,7 +21,6 @@
 
 import com.alipay.hulu.common.application.LauncherApplication;
 import com.alipay.hulu.common.service.SPService;
-import com.alipay.hulu.common.utils.DeviceInfoUtil;
 import com.alipay.hulu.common.utils.StringUtil;
 import com.alipay.hulu.shared.node.action.OperationMethod;
 import com.alipay.hulu.shared.node.tree.AbstractNodeTree;
@@ -38,13 +37,13 @@
 /**
  * Created by qiaoruikai on 2018/10/10 5:15 PM.
  */
-public class OperationStepProvider implements BaseStepProvider<OperationStep> {
+public class OperationStepExporter implements BaseStepExporter<OperationStep> {
     public static final String CAPTURE_IMAGE_BASE64 = "captureImage";
     public static final String ORIGIN_SCREEN_SIZE = "screenSize";
     String operationId;
     AtomicInteger operationIdx;
 
-    public OperationStepProvider(String operationId) {
+    public OperationStepExporter(String operationId) {
         this.operationId = operationId;
         operationIdx = new AtomicInteger(0);
     }

File: src/shared/src/main/java/com/alipay/hulu/shared/node/utils/LogicUtil.java
Patch:
@@ -116,7 +116,7 @@ public static boolean letStep(OperationMethod method, AbstractNodeTree node, Ope
         // 确保临时变量不影响全局变量
         try {
             // 设置临时变量
-            service.putTemplateParam(NODE_NAME, node);
+            service.putTemporaryParam(NODE_NAME, node);
             String realValue = getMappedContent(allocValue, service);
 
             // 根据声明类型解析
@@ -136,7 +136,7 @@ public static boolean letStep(OperationMethod method, AbstractNodeTree node, Ope
             LogUtil.e(TAG, "do let throw FormatException: " + e.getMessage(), e);
             return false;
         } finally {
-            service.removeTemplateParam(NODE_NAME);
+            service.removeTemporaryParam(NODE_NAME);
         }
     }
 

File: src/shared/src/main/java/com/alipay/hulu/shared/node/utils/OperationUtil.java
Patch:
@@ -147,20 +147,20 @@ public static AbstractNodeTree scrollToScreen(OperationNode node, OperationServi
                 if (!(operationNode instanceof CaptureTree)) {
                     // 判断下是否在屏幕内
                     Rect bound = operationNode.getNodeBound();
-                    LogUtil.d(TAG, "控件空间属性：%s, 屏幕属性：%s",  bound, DeviceInfoUtil.curScreenSize);
+                    LogUtil.d(TAG, "控件空间属性：%s, 屏幕属性：%s",  bound, DeviceInfoUtil.realScreenSize);
                     if (bound.top <= 0 && bound.bottom <= 0) {
                         service.doSomeAction(new OperationMethod(PerformActionEnum.GLOBAL_SCROLL_TO_BOTTOM), null);
                         MiscUtil.sleep(2500);
                         scrollCount ++;
-                    } else if (bound.top >= DeviceInfoUtil.curScreenSize.y) {
+                    } else if (bound.top >= DeviceInfoUtil.realScreenSize.y) {
                         service.doSomeAction(new OperationMethod(PerformActionEnum.GLOBAL_SCROLL_TO_TOP), null);
                         MiscUtil.sleep(2500);
                         scrollCount ++;
                     } else if (bound.centerX() <= 0) {
                         service.doSomeAction(new OperationMethod(PerformActionEnum.GLOBAL_SCROLL_TO_RIGHT), null);
                         MiscUtil.sleep(2500);
                         scrollCount ++;
-                    } else if (bound.centerX() >= DeviceInfoUtil.curScreenSize.x) {
+                    } else if (bound.centerX() >= DeviceInfoUtil.realScreenSize.x) {
                         service.doSomeAction(new OperationMethod(PerformActionEnum.GLOBAL_SCROLL_TO_LEFT), null);
                         MiscUtil.sleep(2500);
                         scrollCount ++;

File: src/shared/src/main/java/com/alipay/hulu/shared/node/utils/PrepareUtil.java
Patch:
@@ -61,6 +61,7 @@ public static boolean doPrepareWork(String targetApp, PrepareStatus status) {
                     }
                 } catch (Throwable t) {
                     LogUtil.e(TAG, "准备失败，message=" + t.getMessage(), t);
+                    return false;
                 }
             }
         }

