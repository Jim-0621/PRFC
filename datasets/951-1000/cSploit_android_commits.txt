File: cSploit/src/main/java/org/csploit/android/ActionActivity.java
Patch:
@@ -20,7 +20,7 @@
 
 import android.content.SharedPreferences;
 import android.os.Bundle;
-import android.support.v7.app.AppCompatActivity;
+import androidx.appcompat.app.AppCompatActivity;
 
 public class ActionActivity extends AppCompatActivity {
 

File: cSploit/src/main/java/org/csploit/android/CSploitApplication.java
Patch:
@@ -21,7 +21,7 @@
 import android.app.Application;
 import android.content.Context;
 import android.content.SharedPreferences;
-import android.support.multidex.MultiDex;
+import androidx.multidex.MultiDex;
 
 import org.acra.ACRA;
 import org.acra.annotation.AcraCore;

File: cSploit/src/main/java/org/csploit/android/SettingsActivity.java
Patch:
@@ -20,7 +20,7 @@
 
 import android.content.SharedPreferences;
 import android.os.Bundle;
-import android.support.v7.app.AppCompatActivity;
+import androidx.appcompat.app.AppCompatActivity;
 
 public class SettingsActivity extends AppCompatActivity {
 

File: cSploit/src/main/java/org/csploit/android/WifiScannerActivity.java
Patch:
@@ -20,7 +20,7 @@
 
 import android.content.SharedPreferences;
 import android.os.Bundle;
-import android.support.v7.app.AppCompatActivity;
+import androidx.appcompat.app.AppCompatActivity;
 
 public class WifiScannerActivity extends AppCompatActivity {
 

File: cSploit/src/main/java/org/csploit/android/core/MultiAttackService.java
Patch:
@@ -7,7 +7,7 @@
 import android.content.Context;
 import android.content.Intent;
 import android.content.IntentFilter;
-import android.support.v4.app.NotificationCompat;
+import androidx.core.app.NotificationCompat;
 
 import org.csploit.android.R;
 import org.csploit.android.net.Network;

File: cSploit/src/main/java/org/csploit/android/core/Plugin.java
Patch:
@@ -20,13 +20,11 @@
 
 import android.content.Context;
 import android.os.Bundle;
-import android.support.v7.app.AppCompatActivity;
+import androidx.appcompat.app.AppCompatActivity;
 import android.view.MenuItem;
 
 import org.csploit.android.R;
 import org.csploit.android.net.Target;
-import org.csploit.android.net.Target.Exploit;
-import org.csploit.android.net.Target.Port;
 import org.csploit.android.net.metasploit.RPCClient;
 
 import java.util.Arrays;

File: cSploit/src/main/java/org/csploit/android/gui/Console.java
Patch:
@@ -3,8 +3,8 @@
 import android.content.Context;
 import android.os.Build;
 import android.os.Bundle;
-import android.support.design.widget.FloatingActionButton;
-import android.support.v7.app.AppCompatActivity;
+import com.google.android.material.floatingactionbutton.FloatingActionButton;
+import androidx.appcompat.app.AppCompatActivity;
 import android.text.Html;
 import android.view.KeyEvent;
 import android.view.Menu;

File: cSploit/src/main/java/org/csploit/android/gui/FileEdit.java
Patch:
@@ -1,7 +1,7 @@
 package org.csploit.android.gui;
 
 import android.os.Bundle;
-import android.support.v7.app.AppCompatActivity;
+import androidx.appcompat.app.AppCompatActivity;
 import android.view.View;
 import android.widget.Button;
 import android.widget.EditText;

File: cSploit/src/main/java/org/csploit/android/gui/dialogs/ChangelogDialog.java
Patch:
@@ -19,10 +19,10 @@
 package org.csploit.android.gui.dialogs;
 
 import android.annotation.SuppressLint;
-import android.app.Activity;
-import android.app.AlertDialog;
 import android.app.ProgressDialog;
 import android.content.DialogInterface;
+import androidx.appcompat.app.AlertDialog;
+import androidx.appcompat.app.AppCompatActivity;
 import android.text.Html;
 import android.widget.TextView;
 
@@ -41,7 +41,7 @@ public class ChangelogDialog extends AlertDialog
   private ProgressDialog mLoader = null;
 
   @SuppressLint("SetJavaScriptEnabled")
-  public ChangelogDialog(final Activity activity){
+  public ChangelogDialog(final AppCompatActivity activity){
     super(activity);
 
     this.setTitle("Changelog");

File: cSploit/src/main/java/org/csploit/android/gui/dialogs/ConfirmDialog.java
Patch:
@@ -18,9 +18,9 @@
  */
 package org.csploit.android.gui.dialogs;
 
-import android.app.Activity;
-import android.app.AlertDialog;
 import android.content.DialogInterface;
+import androidx.fragment.app.FragmentActivity;
+import androidx.appcompat.app.AlertDialog;
 
 import org.csploit.android.R;
 
@@ -31,7 +31,7 @@ public interface ConfirmDialogListener{
     void onCancel();
   }
 
-  public ConfirmDialog(String title, CharSequence message, Activity activity, ConfirmDialogListener confirmDialogListener){
+  public ConfirmDialog(String title, CharSequence message, FragmentActivity activity, ConfirmDialogListener confirmDialogListener){
     super(activity);
 
     this.setTitle(title);

File: cSploit/src/main/java/org/csploit/android/gui/dialogs/CustomFilterDialog.java
Patch:
@@ -18,9 +18,9 @@
  */
 package org.csploit.android.gui.dialogs;
 
-import android.app.Activity;
-import android.app.AlertDialog;
 import android.content.DialogInterface;
+import androidx.appcompat.app.AlertDialog;
+import androidx.appcompat.app.AppCompatActivity;
 import android.view.LayoutInflater;
 import android.view.View;
 import android.widget.EditText;
@@ -34,7 +34,7 @@ public interface CustomFilterDialogListener{
     void onInputEntered(ArrayList<String> from, ArrayList<String> to);
   }
 
-  public CustomFilterDialog(String title, Activity activity, final CustomFilterDialogListener listener){
+  public CustomFilterDialog(String title, AppCompatActivity activity, final CustomFilterDialogListener listener){
     super(activity);
 
     final View view = LayoutInflater.from(activity).inflate(R.layout.plugin_mitm_filter_dialog, null);

File: cSploit/src/main/java/org/csploit/android/gui/dialogs/FinishDialog.java
Patch:
@@ -18,12 +18,12 @@
  */
 package org.csploit.android.gui.dialogs;
 
-import android.app.Activity;
-import android.app.AlertDialog;
 import android.content.DialogInterface;
+import androidx.fragment.app.FragmentActivity;
+import androidx.appcompat.app.AlertDialog;
 
 public class FinishDialog extends AlertDialog{
-  public FinishDialog(String title, String message, final Activity activity){
+  public FinishDialog(String title, String message, final FragmentActivity activity){
     super(activity);
 
     this.setTitle(title);

File: cSploit/src/main/java/org/csploit/android/gui/dialogs/RedirectionDialog.java
Patch:
@@ -18,17 +18,17 @@
  */
 package org.csploit.android.gui.dialogs;
 
-import android.app.Activity;
-import android.app.AlertDialog;
 import android.content.DialogInterface;
+import androidx.appcompat.app.AlertDialog;
+import androidx.appcompat.app.AppCompatActivity;
 import android.view.LayoutInflater;
 import android.view.View;
 import android.widget.EditText;
 
 import org.csploit.android.R;
 
 public class RedirectionDialog extends AlertDialog{
-  public RedirectionDialog(String title, Activity activity, final RedirectionDialogListener listener){
+  public RedirectionDialog(String title, AppCompatActivity activity, final RedirectionDialogListener listener){
     super(activity);
 
     final View view = LayoutInflater.from(activity).inflate(R.layout.plugin_mitm_redirect_dialog, null);

File: cSploit/src/main/java/org/csploit/android/gui/dialogs/WifiCrackDialog.java
Patch:
@@ -18,9 +18,9 @@
  */
 package org.csploit.android.gui.dialogs;
 
-import android.app.Activity;
-import android.app.AlertDialog;
 import android.content.DialogInterface;
+import androidx.fragment.app.FragmentActivity;
+import androidx.appcompat.app.AlertDialog;
 import android.text.InputType;
 import android.widget.EditText;
 
@@ -29,7 +29,7 @@
 public class WifiCrackDialog extends AlertDialog{
   private EditText mEditText = null;
 
-  public WifiCrackDialog(String title, String message, Activity activity, WifiCrackDialogListener wifiCrackDialogListener){
+  public WifiCrackDialog(String title, String message, FragmentActivity activity, WifiCrackDialogListener wifiCrackDialogListener){
     super(activity);
 
     mEditText = new EditText(activity);

File: cSploit/src/main/java/org/csploit/android/net/Endpoint.java
Patch:
@@ -18,8 +18,8 @@
  */
 package org.csploit.android.net;
 
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
 import org.csploit.android.core.System;
 import org.csploit.android.helpers.NetworkHelper;
 

File: cSploit/src/main/java/org/csploit/android/net/Network.java
Patch:
@@ -24,8 +24,8 @@
 import android.net.NetworkInfo;
 import android.net.wifi.WifiInfo;
 import android.net.wifi.WifiManager;
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
+import androidx.annotation.NonNull;
+import androidx.annotation.Nullable;
 import android.util.Patterns;
 import org.apache.commons.net.util.SubnetUtils;
 import org.csploit.android.core.Logger;

File: cSploit/src/main/java/org/csploit/android/net/Target.java
Patch:
@@ -19,7 +19,6 @@
 package org.csploit.android.net;
 
 import android.os.StrictMode;
-import android.support.annotation.NonNull;
 
 import org.csploit.android.R;
 import org.csploit.android.core.Logger;
@@ -40,6 +39,8 @@
 import java.util.regex.Matcher;
 import java.util.regex.Pattern;
 
+import androidx.annotation.NonNull;
+
 public class Target implements Comparable<Target>
 {
 

File: cSploit/src/main/java/org/csploit/android/plugins/ExploitFinder.java
Patch:
@@ -24,8 +24,8 @@
 import android.graphics.Typeface;
 import android.net.Uri;
 import android.os.Bundle;
-import android.support.design.widget.FloatingActionButton;
-import android.support.v4.content.ContextCompat;
+import com.google.android.material.floatingactionbutton.FloatingActionButton;
+import androidx.core.content.ContextCompat;
 import android.text.Html;
 import android.view.LayoutInflater;
 import android.view.Menu;

File: cSploit/src/main/java/org/csploit/android/plugins/Inspector.java
Patch:
@@ -20,8 +20,8 @@
 
 import android.content.SharedPreferences;
 import android.os.Bundle;
-import android.support.design.widget.FloatingActionButton;
-import android.support.v4.content.ContextCompat;
+import com.google.android.material.floatingactionbutton.FloatingActionButton;
+import androidx.core.content.ContextCompat;
 import android.view.Menu;
 import android.view.MenuInflater;
 import android.view.MenuItem;

File: cSploit/src/main/java/org/csploit/android/plugins/LoginCracker.java
Patch:
@@ -25,8 +25,8 @@
 import android.graphics.Typeface;
 import android.os.Build;
 import android.os.Bundle;
-import android.support.design.widget.FloatingActionButton;
-import android.support.v4.content.ContextCompat;
+import com.google.android.material.floatingactionbutton.FloatingActionButton;
+import androidx.core.content.ContextCompat;
 import android.view.LayoutInflater;
 import android.view.Menu;
 import android.view.MenuInflater;

File: cSploit/src/main/java/org/csploit/android/plugins/PortScanner.java
Patch:
@@ -23,8 +23,8 @@
 import android.content.SharedPreferences;
 import android.net.Uri;
 import android.os.Bundle;
-import android.support.design.widget.FloatingActionButton;
-import android.support.v4.content.ContextCompat;
+import com.google.android.material.floatingactionbutton.FloatingActionButton;
+import androidx.core.content.ContextCompat;
 import android.view.Menu;
 import android.view.MenuInflater;
 import android.view.MenuItem;

File: cSploit/src/main/java/org/csploit/android/plugins/RouterPwn.java
Patch:
@@ -18,7 +18,6 @@
  */
 package org.csploit.android.plugins;
 
-import android.app.Activity;
 import android.content.ActivityNotFoundException;
 import android.content.Context;
 import android.content.Intent;
@@ -30,6 +29,8 @@
 import org.csploit.android.gui.dialogs.ErrorDialog;
 import org.csploit.android.net.Target;
 
+import androidx.fragment.app.FragmentActivity;
+
 public class RouterPwn extends Plugin{
   public RouterPwn(){
     super(
@@ -64,7 +65,7 @@ public void onActionClick(Context context){
     }
     catch(ActivityNotFoundException e){
       System.errorLogging(e);
-      new ErrorDialog(getString(R.string.error), getString(R.string.no_activities_for_url), (Activity) context).show();
+      new ErrorDialog(getString(R.string.error), getString(R.string.no_activities_for_url), (FragmentActivity) context).show();
     }
   }
 }

File: cSploit/src/main/java/org/csploit/android/plugins/Traceroute.java
Patch:
@@ -20,8 +20,8 @@
 
 import android.content.SharedPreferences;
 import android.os.Bundle;
-import android.support.design.widget.FloatingActionButton;
-import android.support.v4.content.ContextCompat;
+import com.google.android.material.floatingactionbutton.FloatingActionButton;
+import androidx.core.content.ContextCompat;
 import android.view.Menu;
 import android.view.MenuInflater;
 import android.view.MenuItem;

File: cSploit/src/main/java/org/csploit/android/plugins/mitm/DNSSpoofing.java
Patch:
@@ -20,7 +20,7 @@
 
 import android.content.SharedPreferences;
 import android.os.Bundle;
-import android.support.v7.app.AppCompatActivity;
+import androidx.appcompat.app.AppCompatActivity;
 import android.view.MenuItem;
 import android.view.View;
 import android.widget.Button;

File: cSploit/src/main/java/org/csploit/android/plugins/mitm/PasswordSniffer.java
Patch:
@@ -23,7 +23,7 @@
 import android.content.SharedPreferences;
 import android.graphics.Typeface;
 import android.os.Bundle;
-import android.support.v7.app.AppCompatActivity;
+import androidx.appcompat.app.AppCompatActivity;
 import android.view.Menu;
 import android.view.MenuInflater;
 import android.view.MenuItem;

File: cSploit/src/main/java/org/csploit/android/plugins/mitm/Sniffer.java
Patch:
@@ -23,7 +23,7 @@
 import android.content.SharedPreferences;
 import android.os.Bundle;
 import android.os.FileObserver;
-import android.support.v7.app.AppCompatActivity;
+import androidx.appcompat.app.AppCompatActivity;
 import android.text.Html;
 import android.view.LayoutInflater;
 import android.view.MenuItem;
@@ -44,7 +44,6 @@
 import org.csploit.android.R;
 import org.csploit.android.core.Child;
 import org.csploit.android.core.ChildManager;
-import org.csploit.android.core.Logger;
 import org.csploit.android.core.System;
 import org.csploit.android.gui.dialogs.ConfirmDialog;
 import org.csploit.android.gui.dialogs.ErrorDialog;

File: cSploit/src/main/java/org/csploit/android/plugins/mitm/hijacker/Hijacker.java
Patch:
@@ -26,7 +26,7 @@
 import android.graphics.Canvas;
 import android.os.AsyncTask;
 import android.os.Bundle;
-import android.support.v7.app.AppCompatActivity;
+import androidx.appcompat.app.AppCompatActivity;
 import android.view.LayoutInflater;
 import android.view.Menu;
 import android.view.MenuInflater;

File: cSploit/src/main/java/org/csploit/android/plugins/mitm/hijacker/HijackerWebView.java
Patch:
@@ -22,7 +22,7 @@
 import android.content.SharedPreferences;
 import android.os.Build;
 import android.os.Bundle;
-import android.support.v7.app.AppCompatActivity;
+import androidx.appcompat.app.AppCompatActivity;
 import android.util.Patterns;
 import android.view.KeyEvent;
 import android.view.Menu;

File: cSploit/src/main/java/org/csploit/android/services/UpdateService.java
Patch:
@@ -25,7 +25,7 @@
 import android.content.Context;
 import android.content.Intent;
 import android.content.IntentFilter;
-import android.support.v4.app.NotificationCompat;
+import androidx.core.app.NotificationCompat;
 
 import org.apache.commons.compress.archivers.ArchiveEntry;
 import org.apache.commons.compress.archivers.ArchiveInputStream;

File: cSploit/src/main/java/org/csploit/android/gui/dialogs/ChangelogDialog.java
Patch:
@@ -19,10 +19,10 @@
 package org.csploit.android.gui.dialogs;
 
 import android.annotation.SuppressLint;
-import android.app.Activity;
-import android.app.AlertDialog;
 import android.app.ProgressDialog;
 import android.content.DialogInterface;
+import android.support.v7.app.AlertDialog;
+import android.support.v7.app.AppCompatActivity;
 import android.text.Html;
 import android.widget.TextView;
 
@@ -41,7 +41,7 @@ public class ChangelogDialog extends AlertDialog
   private ProgressDialog mLoader = null;
 
   @SuppressLint("SetJavaScriptEnabled")
-  public ChangelogDialog(final Activity activity){
+  public ChangelogDialog(final AppCompatActivity activity){
     super(activity);
 
     this.setTitle("Changelog");

File: cSploit/src/main/java/org/csploit/android/gui/dialogs/ChoiceDialog.java
Patch:
@@ -18,9 +18,9 @@
  */
 package org.csploit.android.gui.dialogs;
 
-import android.app.Activity;
-import android.app.AlertDialog;
 import android.content.DialogInterface;
+import android.support.v4.app.FragmentActivity;
+import android.support.v7.app.AlertDialog;
 import android.view.View;
 import android.widget.Button;
 import android.widget.LinearLayout;
@@ -33,7 +33,7 @@ public interface ChoiceDialogListener{
     void onChoice(int choice);
   }
 
-  public ChoiceDialog(final Activity activity, String title, String[] choices, final ChoiceDialogListener listener){
+  public ChoiceDialog(final FragmentActivity activity, String title, String[] choices, final ChoiceDialogListener listener){
     super(activity);
 
     this.setTitle(title);

File: cSploit/src/main/java/org/csploit/android/gui/dialogs/ConfirmDialog.java
Patch:
@@ -18,9 +18,9 @@
  */
 package org.csploit.android.gui.dialogs;
 
-import android.app.Activity;
-import android.app.AlertDialog;
 import android.content.DialogInterface;
+import android.support.v4.app.FragmentActivity;
+import android.support.v7.app.AlertDialog;
 
 import org.csploit.android.R;
 
@@ -31,7 +31,7 @@ public interface ConfirmDialogListener{
     void onCancel();
   }
 
-  public ConfirmDialog(String title, CharSequence message, Activity activity, ConfirmDialogListener confirmDialogListener){
+  public ConfirmDialog(String title, CharSequence message, FragmentActivity activity, ConfirmDialogListener confirmDialogListener){
     super(activity);
 
     this.setTitle(title);

File: cSploit/src/main/java/org/csploit/android/gui/dialogs/CustomFilterDialog.java
Patch:
@@ -18,9 +18,9 @@
  */
 package org.csploit.android.gui.dialogs;
 
-import android.app.Activity;
-import android.app.AlertDialog;
 import android.content.DialogInterface;
+import android.support.v7.app.AlertDialog;
+import android.support.v7.app.AppCompatActivity;
 import android.view.LayoutInflater;
 import android.view.View;
 import android.widget.EditText;
@@ -34,7 +34,7 @@ public interface CustomFilterDialogListener{
     void onInputEntered(ArrayList<String> from, ArrayList<String> to);
   }
 
-  public CustomFilterDialog(String title, Activity activity, final CustomFilterDialogListener listener){
+  public CustomFilterDialog(String title, AppCompatActivity activity, final CustomFilterDialogListener listener){
     super(activity);
 
     final View view = LayoutInflater.from(activity).inflate(R.layout.plugin_mitm_filter_dialog, null);

File: cSploit/src/main/java/org/csploit/android/gui/dialogs/FinishDialog.java
Patch:
@@ -18,12 +18,12 @@
  */
 package org.csploit.android.gui.dialogs;
 
-import android.app.Activity;
-import android.app.AlertDialog;
 import android.content.DialogInterface;
+import android.support.v4.app.FragmentActivity;
+import android.support.v7.app.AlertDialog;
 
 public class FinishDialog extends AlertDialog{
-  public FinishDialog(String title, String message, final Activity activity){
+  public FinishDialog(String title, String message, final FragmentActivity activity){
     super(activity);
 
     this.setTitle(title);

File: cSploit/src/main/java/org/csploit/android/gui/dialogs/RedirectionDialog.java
Patch:
@@ -18,17 +18,17 @@
  */
 package org.csploit.android.gui.dialogs;
 
-import android.app.Activity;
-import android.app.AlertDialog;
 import android.content.DialogInterface;
+import android.support.v7.app.AlertDialog;
+import android.support.v7.app.AppCompatActivity;
 import android.view.LayoutInflater;
 import android.view.View;
 import android.widget.EditText;
 
 import org.csploit.android.R;
 
 public class RedirectionDialog extends AlertDialog{
-  public RedirectionDialog(String title, Activity activity, final RedirectionDialogListener listener){
+  public RedirectionDialog(String title, AppCompatActivity activity, final RedirectionDialogListener listener){
     super(activity);
 
     final View view = LayoutInflater.from(activity).inflate(R.layout.plugin_mitm_redirect_dialog, null);

File: cSploit/src/main/java/org/csploit/android/gui/dialogs/WifiCrackDialog.java
Patch:
@@ -18,9 +18,9 @@
  */
 package org.csploit.android.gui.dialogs;
 
-import android.app.Activity;
-import android.app.AlertDialog;
 import android.content.DialogInterface;
+import android.support.v4.app.FragmentActivity;
+import android.support.v7.app.AlertDialog;
 import android.text.InputType;
 import android.widget.EditText;
 
@@ -29,7 +29,7 @@
 public class WifiCrackDialog extends AlertDialog{
   private EditText mEditText = null;
 
-  public WifiCrackDialog(String title, String message, Activity activity, WifiCrackDialogListener wifiCrackDialogListener){
+  public WifiCrackDialog(String title, String message, FragmentActivity activity, WifiCrackDialogListener wifiCrackDialogListener){
     super(activity);
 
     mEditText = new EditText(activity);

File: cSploit/src/main/java/org/csploit/android/plugins/RouterPwn.java
Patch:
@@ -18,11 +18,11 @@
  */
 package org.csploit.android.plugins;
 
-import android.app.Activity;
 import android.content.ActivityNotFoundException;
 import android.content.Context;
 import android.content.Intent;
 import android.net.Uri;
+import android.support.v4.app.FragmentActivity;
 
 import org.csploit.android.R;
 import org.csploit.android.core.Plugin;
@@ -64,7 +64,7 @@ public void onActionClick(Context context){
     }
     catch(ActivityNotFoundException e){
       System.errorLogging(e);
-      new ErrorDialog(getString(R.string.error), getString(R.string.no_activities_for_url), (Activity) context).show();
+      new ErrorDialog(getString(R.string.error), getString(R.string.no_activities_for_url), (FragmentActivity) context).show();
     }
   }
 }

File: cSploit/src/main/java/org/csploit/android/services/receivers/MsfRpcdServiceReceiver.java
Patch:
@@ -9,6 +9,7 @@
 import android.support.design.widget.Snackbar;
 import android.support.v4.app.NotificationCompat;
 import android.support.v4.content.ContextCompat;
+import android.support.v7.app.AppCompatActivity;
 
 import org.csploit.android.R;
 import org.csploit.android.core.ManagedReceiver;
@@ -63,7 +64,7 @@ public void run() {
 
   private void showToastForStatus(Context context, MsfRpcdService.Status status) {
     Snackbar
-            .make(((Activity) context).findViewById(android.R.id.content), status.getText(), status.isError() ? Snackbar.LENGTH_LONG : Snackbar.LENGTH_SHORT)
+            .make(((AppCompatActivity) context).findViewById(android.R.id.content), status.getText(), status.isError() ? Snackbar.LENGTH_LONG : Snackbar.LENGTH_SHORT)
     .show();
   }
 

File: cSploit/src/main/java/org/csploit/android/SettingsFragment.java
Patch:
@@ -99,6 +99,7 @@ public static class PrefsFrag extends PreferenceFragmentCompat implements Shared
 
             @Override
             public void onViewCreated(View v, Bundle savedInstanceState) {
+                super.onViewCreated(v, savedInstanceState);
                 SharedPreferences themePrefs = getActivity().getSharedPreferences("THEME", 0);
                 Boolean isDark = themePrefs.getBoolean("isDark", false);
                 if (isDark) {
@@ -140,7 +141,7 @@ public void onCreate(Bundle savedInstanceState) {
                 @Override
                 public boolean onPreferenceChange(Preference preference, Object newValue) {
                     SharedPreferences themePrefs = getActivity().getBaseContext().getSharedPreferences("THEME", 0);
-                    themePrefs.edit().putBoolean("isDark", (Boolean) newValue).commit();
+                    themePrefs.edit().putBoolean("isDark", (Boolean) newValue).apply();
                     Toast.makeText(getActivity().getBaseContext(), getString(R.string.please_restart), Toast.LENGTH_LONG).show();
                     return true;
                 }
@@ -276,7 +277,7 @@ else if (checker != null && !checker.canExecuteInDir(path))
 
                 else {
                     //noinspection ConstantConditions
-                    getPreferenceManager().getSharedPreferences().edit().putString(key, path).commit();
+                    getPreferenceManager().getSharedPreferences().edit().putString(key, path).apply();
                     if (oldPath != null && !oldPath.equals(path)) {
                         File current = new File(oldPath);
 

File: cSploit/src/main/java/org/csploit/android/services/receivers/MsfRpcdServiceReceiver.java
Patch:
@@ -69,12 +69,13 @@ private void showToastForStatus(Context context, MsfRpcdService.Status status) {
 
   private void updateNotificationForStatus(Context context, MsfRpcdService.Status status) {
     NotificationCompat.Builder mBuilder =
-            new NotificationCompat.Builder(context)
+            new NotificationCompat.Builder(context, context.getString(R.string.csploitChannelId))
             .setSmallIcon(R.drawable.exploit_msf)
             .setContentTitle(context.getString(R.string.msf_status))
             .setProgress(0, 0, status.inProgress())
             .setContentText(context.getString(status.getText()))
-            .setColor(ContextCompat.getColor(context, status.getColor()));
+            .setColor(ContextCompat.getColor(context, status.getColor()))
+            .setChannelId(context.getString(R.string.csploitChannelId));
 
     NotificationManager mNotificationManager =
             (NotificationManager) context.getSystemService(Context.NOTIFICATION_SERVICE);

File: cSploit/src/main/java/org/csploit/android/net/http/proxy/StreamThread.java
Patch:
@@ -36,8 +36,9 @@ public class StreamThread implements Runnable
       "/html",
       "/css",
       "/javascript",
-      "/javascript",
-      "/x-javascript"
+      "/json",
+      "/x-javascript",
+      "/x-json"
     };
 
   private final static String HEAD_SEPARATOR = "\r\n\r\n";

File: cSploit/src/main/java/org/csploit/android/net/metasploit/RPCClient.java
Patch:
@@ -35,7 +35,7 @@ public class RPCClient
   private URL u;
   private URLConnection huc;
   private String token;
-  private static MessagePack msgpack = null;
+  private static volatile MessagePack msgpack = null;
   private final Map callCache = new HashMap();
   private final Lock lock = new ReentrantLock();
   private final boolean mRemote;

File: cSploit/src/main/java/org/csploit/android/core/System.java
Patch:
@@ -608,9 +608,9 @@ private static void preloadVendors() {
       BufferedReader reader = null;
       try {
         mVendors = new HashMap<>();
-        @SuppressWarnings("ConstantConditions")
-                fstream = new FileInputStream(
-                mContext.getFilesDir().getAbsolutePath() + "/tools/nmap/nmap-mac-prefixes");
+
+        fstream = new FileInputStream(
+        mContext.getFilesDir().getAbsolutePath() + "/tools/nmap/nmap-mac-prefixes");
 
         in = new DataInputStream(fstream);
         reader = new BufferedReader(new InputStreamReader(in));

File: cSploit/src/main/java/org/csploit/android/core/ExecChecker.java
Patch:
@@ -36,7 +36,7 @@ private static class FuseBind {
 
     @Override
     public boolean equals(Object o) {
-      if(o.getClass() != FuseBind.class)
+      if(o == null || o.getClass() != FuseBind.class)
         return false;
 
       FuseBind b = (FuseBind)o;
@@ -57,6 +57,8 @@ public boolean equals(Object o) {
     }
   }
 
+
+
   /**
    * test if root can execute stuff inside a directory
    * @param dir the directory to check

File: cSploit/src/main/java/org/csploit/android/core/System.java
Patch:
@@ -354,6 +354,7 @@ public static void initCore() throws DaemonException, SuException {
 
     mCoreInitialized = true;
     Services.getNetworkRadar().onAutoScanChanged();
+    getNetwork().onCoreAttached();
   }
 
   public static void setIfname(String ifname) {
@@ -1269,6 +1270,7 @@ public static void clean(boolean releaseLocks) {
 
       Client.Disconnect();
       mCoreInitialized = false;
+      mInitialized = false;
       Services.getNetworkRadar().onAutoScanChanged();
     } catch (Exception e) {
       errorLogging(e);

File: cSploit/src/main/java/org/csploit/android/tools/ToolBox.java
Patch:
@@ -36,6 +36,7 @@ public class ToolBox {
   public final NetworkRadar networkRadar;
   public final MsfRpcd msfrpcd;
   public final Logcat logcat;
+  public final Ip ip;
 
   public ToolBox() {
     raw = new Raw();
@@ -52,6 +53,7 @@ public ToolBox() {
     networkRadar = new NetworkRadar();
     msfrpcd = new MsfRpcd();
     logcat = new Logcat();
+    ip = new Ip();
   }
 
   public void reload() {
@@ -66,6 +68,7 @@ public void reload() {
     tcpDump.setEnabled();
     networkRadar.setEnabled();
     logcat.setEnabled();
+    ip.setEnabled();
 
     ruby.init();
     msf.init();

File: cSploit/src/main/java/org/csploit/android/core/System.java
Patch:
@@ -352,6 +352,7 @@ public static void initCore() throws DaemonException, SuException {
 
     mCoreInitialized = true;
     Services.getNetworkRadar().onAutoScanChanged();
+    getNetwork().onCoreAttached();
   }
 
   public static void setIfname(String ifname) {
@@ -381,8 +382,6 @@ private static void uncaughtReloadNetworkMapping() throws UnknownHostException,
     reset();
 
     mInitialized = true;
-
-    Network.watchForIssue480();
   }
 
   public static boolean checkNetworking(final Activity current) {

File: cSploit/src/main/java/org/csploit/android/tools/ToolBox.java
Patch:
@@ -36,6 +36,7 @@ public class ToolBox {
   public final NetworkRadar networkRadar;
   public final MsfRpcd msfrpcd;
   public final Logcat logcat;
+  public final Ip ip;
 
   public ToolBox() {
     raw = new Raw();
@@ -52,6 +53,7 @@ public ToolBox() {
     networkRadar = new NetworkRadar();
     msfrpcd = new MsfRpcd();
     logcat = new Logcat();
+    ip = new Ip();
   }
 
   public void reload() {
@@ -66,6 +68,7 @@ public void reload() {
     tcpDump.setEnabled();
     networkRadar.setEnabled();
     logcat.setEnabled();
+    ip.setEnabled();
 
     ruby.init();
     msf.init();

File: cSploit/src/main/java/org/csploit/android/net/http/proxy/StreamThread.java
Patch:
@@ -41,7 +41,7 @@ public class StreamThread implements Runnable
     };
 
   private final static String HEAD_SEPARATOR = "\r\n\r\n";
-  private final static int CHUNK_SIZE = 1024;
+  private final static int CHUNK_SIZE = 64 * 1024;
 
   private String mClient = null;
   private InputStream mReader = null;

File: cSploit/src/main/java/org/csploit/android/net/Network.java
Patch:
@@ -189,8 +189,11 @@ public boolean initNetworkInterface(String iface) {
 
       if(gateway == null) {
         mGateway = null;
+        Logger.debug("gateway not found");
       } else {
         mGateway = new IP4Address(gateway);
+        Logger.debug("gateway: " + gateway);
+        Logger.debug("mGateway: " + mGateway);
       }
 
       return true;

File: cSploit/src/main/java/org/csploit/android/net/Network.java
Patch:
@@ -406,7 +406,9 @@ public String getSystemGateway(String iface) {
             break;
           }
         }
-        return sb.toString();
+        String res = sb.toString();
+        Logger.debug("found system default gateway for interface " + iface + ": " + res);
+        return res;
       }
     } catch (IOException e) {
       System.errorLogging(e);

File: cSploit/src/main/java/org/csploit/android/core/System.java
Patch:
@@ -40,7 +40,7 @@
 import org.acra.ACRAConfiguration;
 import org.apache.commons.compress.utils.IOUtils;
 import org.csploit.android.R;
-import org.csploit.android.WifiScannerActivity;
+import org.csploit.android.WifiScannerFragment;
 import org.csploit.android.gui.dialogs.FatalDialog;
 import org.csploit.android.helpers.NetworkHelper;
 import org.csploit.android.helpers.ThreadHelper;
@@ -387,7 +387,7 @@ public static boolean checkNetworking(final Activity current) {
     if (!mNetwork.isConnected()) {
 
       Intent intent = new Intent();
-      intent.putExtra(WifiScannerActivity.CONNECTED, false);
+      intent.putExtra(WifiScannerFragment.CONNECTED, false);
       current.setResult(Activity.RESULT_OK, intent);
 
       String title = current.getString(R.string.error);

File: cSploit/src/main/java/org/csploit/android/plugins/mitm/MITM.java
Patch:
@@ -42,6 +42,7 @@
 
 import org.csploit.android.R;
 import org.csploit.android.SettingsActivity;
+import org.csploit.android.SettingsFragment;
 import org.csploit.android.core.Child;
 import org.csploit.android.core.ChildManager;
 import org.csploit.android.core.Logger;
@@ -309,7 +310,7 @@ public void onError(String error, int resId){
           new ErrorDialog(getString(R.string.error), getString(R.string.unexpected_file_error) + e.getMessage(), MITM.this).show();
         }
       }
-    } else if(request == SettingsActivity.SETTINGS_DONE){
+    } else if(request == SettingsFragment.SETTINGS_DONE){
       new CheckForOpenPortsTask().execute();
     }
   }
@@ -343,7 +344,7 @@ protected void onPostExecute(Boolean result){
         new ConfirmDialog( getString(R.string.warning), mMessage, MITM.this, new ConfirmDialogListener(){
           @Override
           public void onConfirm(){
-            startActivityForResult(new Intent(MITM.this, SettingsActivity.class), SettingsActivity.SETTINGS_DONE);
+            startActivityForResult(new Intent(MITM.this, SettingsActivity.class), SettingsFragment.SETTINGS_DONE);
           }
 
           @Override

File: cSploit/src/main/java/org/csploit/android/net/Network.java
Patch:
@@ -323,7 +323,7 @@ public static List<String> getAvailableInterfaces() {
     while (interfaces.hasMoreElements()) {
       NetworkInterface iface = interfaces.nextElement();
       if (isIfaceConnected(iface)) {
-        result.add(iface.getDisplayName());
+        result.add(iface.getName());
       }
     }
 

File: cSploit/src/main/java/org/csploit/android/MainActivity.java
Patch:
@@ -150,6 +150,7 @@ public void run() {
   }
 
   private void onCoreUpdated() {
+    System.onCoreInstalled();
     MainActivity.this.runOnUiThread(new Runnable() {
       @Override
       public void run() {

File: cSploit/src/main/java/org/csploit/android/MainActivity.java
Patch:
@@ -687,7 +687,6 @@ public void onInputEntered(String input) {
                         @Override
                         public void run() {
                           System.addOrderedTarget(target);
-                          mTargetAdapter.update(null, null);
                         }
                       });
                     } else

File: cSploit/src/org/csploit/android/MainActivity.java
Patch:
@@ -1130,7 +1130,7 @@ public void onReceive(Context context, Intent intent) {
             mUpdateStatus.setText(UPDATE_MESSAGE.replace(
                     "#STATUS#", getString(R.string.no_updates_available)));
 
-          if (!System.isCoreInitialized()) {
+          if (!System.isCoreInstalled()) {
             onInitializationError(getString(R.string.no_core_found));
           }
           break;

File: cSploit/src/org/csploit/android/MainActivity.java
Patch:
@@ -1130,7 +1130,7 @@ public void onReceive(Context context, Intent intent) {
             mUpdateStatus.setText(UPDATE_MESSAGE.replace(
                     "#STATUS#", getString(R.string.no_updates_available)));
 
-          if (!System.isCoreInitialized()) {
+          if (!System.isCoreInstalled()) {
             onInitializationError(getString(R.string.no_core_found));
           }
           break;

File: cSploit/src/org/csploit/android/core/System.java
Patch:
@@ -845,8 +845,10 @@ public static void loadSession(String filename) throws Exception{
   }
 
   public synchronized static ToolBox getTools() {
-    if(mTools == null)
+    if(mTools == null) {
       mTools = new ToolBox();
+      mTools.reload();
+    }
     return mTools;
   }
 

File: cSploit/src/org/csploit/android/tools/Ruby.java
Patch:
@@ -30,10 +30,11 @@ public class Ruby extends Tool {
 
   private final static String rubyLib = "%1$s/site_ruby/1.9.1:%1$s/site_ruby/1.9.1/arm-linux-androideabi:%1$s/site_ruby:%1$s/vendor_ruby/1.9.1:%1$s/vendor_ruby/1.9.1/arm-linux-androideabi:%1$s/vendor_ruby:%1$s/1.9.1:%1$s/1.9.1/arm-linux-androideabi";
 
-
   public Ruby() {
     mHandler = "raw";
+  }
 
+  public void init() {
     setEnabled();
 
     if(mEnabled)

File: cSploit/src/org/csploit/android/net/datasource/CVEDetails.java
Patch:
@@ -58,7 +58,7 @@ private void checkCompatibility(String html) {
 
       target = exploit.getParent();
 
-      if(!target.hasOpenPorts()) {
+      if(target == null || !target.hasOpenPorts()) {
         return;
       }
 

File: cSploit/src/org/csploit/android/ActionActivity.java
Patch:
@@ -83,7 +83,7 @@ public void onItemClick(AdapterView<?> parent, View view, int position, long id)
                       ActionActivity.this,
                       plugin.getClass()
               ));
-              overridePendingTransition(R.anim.slide_in_left, R.anim.slide_out_left);
+              overridePendingTransition(R.anim.fadeout, R.anim.fadein);
             } else
               plugin.onActionClick(getApplicationContext());
           }
@@ -113,7 +113,7 @@ public boolean onOptionsItemSelected(MenuItem item) {
   @Override
   public void onBackPressed() {
     super.onBackPressed();
-    overridePendingTransition(R.anim.slide_in_left, R.anim.slide_out_left);
+    overridePendingTransition(R.anim.fadeout, R.anim.fadein);
   }
 
   public class ActionsAdapter extends ArrayAdapter<Plugin> {

File: cSploit/src/org/csploit/android/CSploitApplication.java
Patch:
@@ -35,6 +35,7 @@
 import org.csploit.android.plugins.Sessions;
 import org.csploit.android.plugins.Traceroute;
 import org.csploit.android.plugins.mitm.MITM;
+import org.csploit.android.services.Services;
 
 import java.net.NoRouteToHostException;
 
@@ -63,6 +64,7 @@ public void onCreate() {
     super.onCreate();
 
     ACRA.init(this);
+    Services.init(this);
 
     // initialize the system
     try {

File: cSploit/src/org/csploit/android/WifiScannerActivity.java
Patch:
@@ -415,7 +415,6 @@ public boolean onOptionsItemSelected(MenuItem item){
     }
     if(item.getItemId() == android.R.id.home){
       onBackPressed();
-
       return true;
     } else
       return super.onOptionsItemSelected(item);
@@ -435,7 +434,7 @@ public void onBackPressed(){
     setResult(RESULT_OK, intent);
 
     super.onBackPressed();
-    overridePendingTransition(R.anim.slide_in_left, R.anim.slide_out_left);
+    overridePendingTransition(R.anim.fadeout, R.anim.fadein);
   }
 
   public class ScanAdapter extends ArrayAdapter<ScanResult>{

File: cSploit/src/org/csploit/android/plugins/Inspector.java
Patch:
@@ -184,6 +184,7 @@ public void onClick(View v){
   public void onBackPressed(){
     setStoppedState();
     super.onBackPressed();
+    overridePendingTransition(R.anim.fadeout, R.anim.fadein);
   }
 
   @Override

File: cSploit/src/org/csploit/android/plugins/LoginCracker.java
Patch:
@@ -413,6 +413,7 @@ protected void onActivityResult(int request, int result, Intent intent) {
   public void onBackPressed() {
     setStoppedState();
     super.onBackPressed();
+    overridePendingTransition(R.anim.fadeout, R.anim.fadein);
   }
 
   public class ProtocolAdapter extends BaseAdapter implements SpinnerAdapter {

File: cSploit/src/org/csploit/android/plugins/PacketForger.java
Patch:
@@ -289,7 +289,7 @@ private void setStoppedState(String errorMessage) {
 	@Override
 	public void onBackPressed() {
 		setStoppedState(null);
-
 		super.onBackPressed();
+		overridePendingTransition(R.anim.fadeout, R.anim.fadein);
 	}
 }

File: cSploit/src/org/csploit/android/plugins/PortScanner.java
Patch:
@@ -352,6 +352,7 @@ public void onInputEntered(String input) {
   public void onBackPressed() {
     setStoppedState();
     super.onBackPressed();
+    overridePendingTransition(R.anim.fadeout, R.anim.fadein);
   }
 
   private class Receiver extends NMap.SynScanReceiver {

File: cSploit/src/org/csploit/android/plugins/Traceroute.java
Patch:
@@ -141,6 +141,7 @@ public boolean onOptionsItemSelected(MenuItem item){
 	public void onBackPressed() {
 		setStoppedState();
 		super.onBackPressed();
+		overridePendingTransition(R.anim.fadeout, R.anim.fadein);
 	}
 
 	private class Receiver extends NMap.TraceReceiver {

File: cSploit/src/org/csploit/android/plugins/mitm/DNSSpoofing.java
Patch:
@@ -236,7 +236,7 @@ public void run() {
 	public void onBackPressed() {
 		setStoppedState();
 		super.onBackPressed();
-		overridePendingTransition(R.anim.slide_in_left, R.anim.slide_out_left);
+        overridePendingTransition(R.anim.fadeout, R.anim.fadein);
 	}
 
 }

File: cSploit/src/org/csploit/android/plugins/mitm/PasswordSniffer.java
Patch:
@@ -352,6 +352,6 @@ public void run() {
 	public void onBackPressed() {
 		setStoppedState();
 		super.onBackPressed();
-		overridePendingTransition(R.anim.slide_in_left, R.anim.slide_out_left);
+		overridePendingTransition(R.anim.fadeout, R.anim.fadein);
 	}
 }
\ No newline at end of file

File: cSploit/src/org/csploit/android/plugins/mitm/Sniffer.java
Patch:
@@ -504,6 +504,6 @@ public void run() {
   public void onBackPressed(){
     setStoppedState();
     super.onBackPressed();
-    overridePendingTransition(R.anim.slide_in_left, R.anim.slide_out_left);
+    overridePendingTransition(R.anim.fadeout, R.anim.fadein);
   }
 }
\ No newline at end of file

File: cSploit/src/org/csploit/android/plugins/mitm/hijacker/Hijacker.java
Patch:
@@ -622,6 +622,6 @@ public void onItemSelected(int index) {
 	public void onBackPressed() {
 		setStoppedState();
 		super.onBackPressed();
-		overridePendingTransition(R.anim.slide_in_left, R.anim.slide_out_left);
+		overridePendingTransition(R.anim.fadeout, R.anim.fadein);
 	}
 }

File: cSploit/src/org/csploit/android/SettingsActivity.java
Patch:
@@ -50,7 +50,7 @@
 public class SettingsActivity extends AppCompatActivity {
 
 
-  public static final int SETTINGS_DONE = 101285;
+  public static final int SETTINGS_DONE = 1285;
   public static final String SETTINGS_WIPE_START = "SettingsActivity.WIPE_START";
   public static final String SETTINGS_WIPE_DIR = "SettingsActivity.data.WIPE_DIR";
   public static final String SETTINGS_WIPE_DONE = "SettingsActivity.WIPE_DONE";

File: cSploit/src/org/csploit/android/services/NetworkRadar.java
Patch:
@@ -61,7 +61,7 @@ public void run() {
   @Override
   public void buildMenuItem(MenuItem item) {
     item.setTitle(isRunning() ? R.string.stop_monitor : R.string.start_monitor);
-    item.setEnabled(System.getTools().networkRadar.isEnabled());
+    item.setEnabled(System.getTools().networkRadar.isEnabled() && System.getNetwork() != null);
   }
 
   private class Receiver extends org.csploit.android.tools.NetworkRadar.HostReceiver {

File: cSploit/src/org/csploit/android/helpers/NetworkHelper.java
Patch:
@@ -10,7 +10,7 @@ public final class NetworkHelper {
    * @return the OUI integer
    */
   public static int getOUICode(byte[] macAddress) {
-    return (macAddress[2] << 16) & (macAddress[1] << 8) & macAddress[0];
+    return (macAddress[0] << 16) | (macAddress[1] << 8) | macAddress[2];
   }
 
   /**

File: cSploit/src/org/csploit/android/services/UpdateService.java
Patch:
@@ -274,7 +274,7 @@ private void finishNotification() {
     Intent contentIntent;
 
     errorOccurred = mCurrentTask.errorOccurred;
-    contentIntent = mCurrentTask.contentIntent;
+    contentIntent = mCurrentTask.haveIntent() ? mCurrentTask.buildIntent() : null;
 
     if(errorOccurred || contentIntent==null){
       Logger.debug("deleting notifications");

File: cSploit/src/org/csploit/android/core/System.java
Patch:
@@ -47,6 +47,7 @@
 import org.csploit.android.net.Endpoint;
 import org.csploit.android.net.GitHubParser;
 import org.csploit.android.net.Network;
+import org.csploit.android.net.RemoteReader;
 import org.csploit.android.net.Target;
 import org.csploit.android.net.Target.Exploit;
 import org.csploit.android.net.Target.Type;
@@ -1199,6 +1200,8 @@ public static void clean(boolean releaseLocks){
           mWakeLock.release();
       }
 
+      RemoteReader.terminateAll();
+
       GitHubParser.resetAll();
 
       synchronized (mTargets) {

File: cSploit/src/org/csploit/android/core/System.java
Patch:
@@ -945,7 +945,7 @@ public static KnownIssues getKnownIssues() {
   }
 
   public static String getMacVendor(byte[] mac){
-    if(mac != null && mac.length >= 3)
+    if(mac != null && mVendors != null && mac.length >= 3)
       return mVendors.get(String.format("%02X%02X%02X", mac[0], mac[1], mac[2]));
     else
       return null;

File: cSploit/src/org/csploit/android/net/metasploit/MsfExploit.java
Patch:
@@ -87,7 +87,9 @@ public MsfExploit(String name, String summary, String description, Ranking rank,
     this.authors = authors;
     this.platforms = platforms;
     this.architectures = architectures;
-    this.references.addAll(references);
+    if(references != null) {
+      this.references.addAll(references);
+    }
 
     refresh();
   }

File: cSploit/src/org/csploit/android/net/Target.java
Patch:
@@ -427,7 +427,7 @@ else if(mType == Type.REMOTE){
   }
 
   public void setAlias(String alias){
-    mAlias = alias.trim();
+    mAlias = alias != null ? alias.trim() : null;
   }
 
   public String getAlias(){

File: cSploit/src/org/csploit/android/MainActivity.java
Patch:
@@ -198,7 +198,7 @@ public boolean onItemLongClick(AdapterView<?> parent, View view, int position, l
     mWipeReceiver.register(MainActivity.this);
     mMsfReceiver.register(MainActivity.this);
 
-    mRadarReceiver.setTargetAdapter(mTargetAdapter);
+    getNetworkRadar().setAdapter(mTargetAdapter);
 
     StartRPCServer();
 

File: cSploit/src/org/csploit/android/gui/DirectoryPicker.java
Patch:
@@ -33,19 +33,19 @@
 import android.widget.ListView;
 import android.widget.Toast;
 
+import org.csploit.android.R;
+
 import java.io.File;
 import java.util.ArrayList;
 import java.util.Collections;
 
-import org.csploit.android.R;
-
 public class DirectoryPicker extends ListActivity{
   public static final String START_DIR = "startDir";
   public static final String ONLY_DIRS = "onlyDirs";
   public static final String SHOW_HIDDEN = "showHidden";
   public static final String CHOSEN_DIRECTORY = "chosenDir";
   public static final String AFFECTED_PREF = "prefKey";
-  public static final int PICK_DIRECTORY = 43522432;
+  public static final int PICK_DIRECTORY = 1212;
   private File dir;
   private boolean showHidden = false;
   private boolean onlyDirs = true;

File: cSploit/src/org/csploit/android/core/ChildManager.java
Patch:
@@ -164,7 +164,7 @@ private static void dispatchEvent(Child c, Event event) {
       if(c.receiver != null)
         c.receiver.onEnd(c.exitValue);
       terminated = true;
-      crash = c.exitValue > 126 && c.exitValue != 130 && c.exitValue != 137 && c.exitValue < 150;
+      crash = c.exitValue > 128 && c.exitValue != 130 && c.exitValue != 137 && c.exitValue < 150;
       if(crash) {
         c.signal = c.exitValue - 128;
       }

File: cSploit/src/org/csploit/android/core/ChildManager.java
Patch:
@@ -164,7 +164,7 @@ private static void dispatchEvent(Child c, Event event) {
       if(c.receiver != null)
         c.receiver.onEnd(c.exitValue);
       terminated = true;
-      crash = c.exitValue > 126 && c.exitValue != 130 && c.exitValue != 137 && c.exitValue < 150;
+      crash = c.exitValue > 128 && c.exitValue != 130 && c.exitValue != 137 && c.exitValue < 150;
       if(crash) {
         c.signal = c.exitValue - 128;
       }

File: cSploit/src/org/csploit/android/MainActivity.java
Patch:
@@ -364,6 +364,8 @@ public void run() {
           return;
         }
       }
+    } else {
+      System.reloadNetworkMapping();
     }
 
     boolean coreInstalled = System.isCoreInstalled();

File: cSploit/src/org/csploit/android/services/UpdateService.java
Patch:
@@ -138,6 +138,7 @@ private void sendError(int message) {
    */
   private void sendDone() {
     Intent i = new Intent(DONE);
+    i.putExtra(UPDATE, mCurrentTask);
     sendBroadcast(i);
   }
 

File: cSploit/src/org/csploit/android/ActionActivity.java
Patch:
@@ -127,7 +127,7 @@ public View getView(int position, View convertView, ViewGroup parent) {
         LayoutInflater inflater = (LayoutInflater) ActionActivity.this.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
         row = inflater.inflate(R.layout.actions_list_item, parent, false);
         if (getSharedPreferences("THEME", 0).getBoolean("isDark", false))
-          row.setBackground(getResources().getDrawable(R.drawable.card_background_dark));
+          row.setBackgroundResource(R.drawable.card_background_dark);
         holder = new ActionHolder();
 
         holder.icon = (ImageView) (row != null ? row.findViewById(R.id.actionIcon) : null);

File: cSploit/src/org/csploit/android/MainActivity.java
Patch:
@@ -858,8 +858,7 @@ public View getView(int position, View convertView, ViewGroup parent) {
       holder.itemTitle.setTextColor(getResources().getColor((target.isConnected() ? R.color.app_color : R.color.gray_text)));
 
       if (row != null && (getSharedPreferences("THEME", 0).getBoolean("isDark", false)))
-          row.setBackground(getResources().getDrawable(R.drawable.card_background_dark));
-
+          row.setBackgroundResource(R.drawable.card_background_dark);
       holder.itemTitle.setTypeface(null, Typeface.NORMAL);
       holder.itemImage.setImageResource(target.getDrawableResourceId());
       holder.itemDescription.setText(target.getDescription());

File: cSploit/src/org/csploit/android/plugins/mitm/MITM.java
Patch:
@@ -136,7 +136,7 @@ public View getView(int position, View convertView, ViewGroup parent){
         LayoutInflater inflater = (LayoutInflater) MITM.this.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
         row = inflater.inflate(mLayoutId, parent, false);
         if (getSharedPreferences("THEME", 0).getBoolean("isDark", false))
-            row.setBackground(getResources().getDrawable(R.drawable.card_background_dark));
+            row.setBackgroundResource(R.drawable.card_background_dark);
         holder = new ActionHolder();
         holder.icon = (ImageView) (row != null ? row.findViewById(R.id.actionIcon) : null);
         holder.name = (TextView) (row != null ? row.findViewById(R.id.itemName) : null);

File: cSploit/src/org/csploit/android/ActionActivity.java
Patch:
@@ -68,7 +68,7 @@ public void onCreate(Bundle savedInstanceState) {
                 @Override
                 public void onItemClick(AdapterView<?> parent, View view, int position, long id) {
 
-                    if (System.checkNetworking(getParent())) {
+                    if (System.checkNetworking(ActionActivity.this)) {
                         Plugin plugin = mAvailable.get(position);
                         System.setCurrentPlugin(plugin);
 

File: cSploit/src/org/csploit/android/MainActivity.java
Patch:
@@ -831,7 +831,7 @@ public View getView(int position, View convertView, ViewGroup parent) {
         row = inflater
                 .inflate(R.layout.target_list_item, parent, false);
         if (getSharedPreferences("THEME", 0).getBoolean("isDark", false))
-          row.setBackground(getResources().getDrawable(R.drawable.card_background_dark));
+          row.setBackgroundResource(R.drawable.card_background_dark);
         holder = new TargetHolder();
         holder.itemImage = (ImageView) (row != null ? row
                 .findViewById(R.id.itemIcon) : null);

File: cSploit/src/org/csploit/android/ActionActivity.java
Patch:
@@ -23,7 +23,7 @@
 import android.content.Intent;
 import android.content.SharedPreferences;
 import android.os.Bundle;
-import android.support.v7.app.ActionBarActivity;
+import android.support.v7.app.AppCompatActivity;
 import android.view.LayoutInflater;
 import android.view.MenuItem;
 import android.view.View;
@@ -41,20 +41,20 @@
 
 import java.util.ArrayList;
 
-public class ActionActivity extends ActionBarActivity {
+public class ActionActivity extends AppCompatActivity {
     private ArrayList<Plugin> mAvailable = null;
     private ListView theList;
 
     @Override
     public void onCreate(Bundle savedInstanceState) {
-        super.onCreate(savedInstanceState);
         SharedPreferences themePrefs = getSharedPreferences("THEME", 0);
         Boolean isDark = themePrefs.getBoolean("isDark", false);
 
         if (isDark)
             setTheme(R.style.DarkTheme);
         else
             setTheme(R.style.AppTheme);
+        super.onCreate(savedInstanceState);
 
         if (System.getTargets() != null && System.getTargets().size() > 0 && System.getCurrentTarget() != null) {
             setTitle("cSploit > " + System.getCurrentTarget());

File: cSploit/src/org/csploit/android/core/System.java
Patch:
@@ -180,11 +180,12 @@ public static void init(Context context) throws Exception{
         HTTP_PROXY_PORT  = Integer.parseInt(getSettings().getString("PREF_HTTP_PROXY_PORT", "8080"));
         HTTP_SERVER_PORT = Integer.parseInt(getSettings().getString("PREF_HTTP_SERVER_PORT", "8081"));
         HTTPS_REDIR_PORT = Integer.parseInt(getSettings().getString("PREF_HTTPS_REDIRECTOR_PORT", "8082"));
-        MSF_RPC_PORT     = Integer.parseInt(getSettings().getString("MSF_RPC_PORT", "5553"));
+        MSF_RPC_PORT     = Integer.parseInt(getSettings().getString("MSF_RPC_PORT", "55553"));
       } catch(NumberFormatException e){
         HTTP_PROXY_PORT = 8080;
         HTTP_SERVER_PORT = 8081;
         HTTPS_REDIR_PORT = 8082;
+        MSF_RPC_PORT = 55553;
       }
 
       // initialize network data at the end

File: cSploit/src/org/csploit/android/tools/Logcat.java
Patch:
@@ -39,7 +39,7 @@ public void onNewLine(String line) {
         if(!line.contains("*** *** ***")) {
           return;
         }
-        libcFingerprint = line.substring(0, line.indexOf(':' + 1));
+        libcFingerprint = line.substring(0, line.indexOf(':') + 1);
       } else if (!line.startsWith(libcFingerprint)) {
         return;
       }

File: cSploit/src/org/csploit/android/events/Hop.java
Patch:
@@ -5,7 +5,7 @@
 /**
  * an hop has been found
  */
-public class Hop {
+public class Hop implements Event {
   public final int hop;
   public final long usec;
   public final InetAddress node;

File: cSploit/src/org/csploit/android/plugins/mitm/SpoofSession.java
Patch:
@@ -138,6 +138,7 @@ public void start(final OnDNSSpoofedReceiver listener) throws ChildManager.Child
               @Override
               public void onError(String line) {
                 SpoofSession.this.stop();
+                listener.onError(line);
               }
             });
 

File: cSploit/src/org/csploit/android/tools/Ettercap.java
Patch:
@@ -68,7 +68,7 @@ else if(e instanceof Message) {
           Logger.info("OnDNSSpooferReceiver() message: " + e);
           Message m = (Message)e;
           if (m.severity == Message.Severity.ERROR)
-            onEnd(0);
+            onError(((Message) e).message);
         }
         else if (e instanceof Newline){
           Logger.info("OnDNSSpooferReceiver() Newline: " + e.toString());
@@ -81,6 +81,7 @@ else if (e instanceof Newline){
       public abstract void onEnd(int exitValue);
       public abstract void onSpoofed(String line);
       public abstract void onStderr(String line);
+      public abstract void onError(String error);
       public abstract void onReady();
     }
 

File: cSploit/src/org/csploit/android/MainActivity.java
Patch:
@@ -1254,7 +1254,8 @@ private void onUpdateDone(UpdateService.action target) {
       switch (target) {
         case ruby_update:
         case msf_update:
-          StartRPCServer();
+          if(!MsfRpcd.isLocal() || MsfRpcd.isInstalled())
+            StartRPCServer();
           break;
         case core_update:
           onCoreUpdated();

File: cSploit/src/org/csploit/android/net/GitHubParser.java
Patch:
@@ -62,7 +62,7 @@ public static GitHubParser getMsfRepo() {
       msfRepo = new GitHubParser(customUsername, customProject);
     }
 
-    msfRepo.mTagFilter = "csploit";
+    msfRepo.mTagFilter = ".*csploit.*";
 
     return msfRepo;
   }

File: cSploit/src/org/csploit/android/plugins/mitm/SpoofSession.java
Patch:
@@ -97,10 +97,10 @@ public void onError(String line) {
     System.setForwarding(true);
 
     if (mWithProxy) {
-      if (System.getSettings().getBoolean("PREF_HTTPS_REDIRECT", true))
-        System.getTools().ipTables.portRedirect(443, System.HTTPS_REDIR_PORT);
+      System.getTools().ipTables.portRedirect(80, System.HTTP_PROXY_PORT, true);
 
-      System.getTools().ipTables.portRedirect(80, System.HTTP_PROXY_PORT);
+      if (System.getSettings().getBoolean("PREF_HTTPS_REDIRECT", true))
+        System.getTools().ipTables.portRedirect(443, System.HTTPS_REDIR_PORT, false);
     }
 
     listener.onSessionReady();

File: cSploit/src/org/csploit/android/net/ByteBuffer.java
Patch:
@@ -18,13 +18,12 @@
  */
 package org.csploit.android.net;
 
+import org.csploit.android.core.System;
 import org.mozilla.universalchardet.UniversalDetector;
 
 import java.io.UnsupportedEncodingException;
 import java.util.Arrays;
 
-import org.csploit.android.core.System;
-
 public class ByteBuffer{
   private byte[] mBuffer = null;
   private UniversalDetector mCharsetDetector = null;

File: cSploit/src/org/csploit/android/plugins/Sessions.java
Patch:
@@ -19,8 +19,6 @@
  */
 package org.csploit.android.plugins;
 
-import java.util.ArrayList;
-
 import android.content.Intent;
 import android.content.SharedPreferences;
 import android.os.Bundle;
@@ -43,6 +41,8 @@
 import org.csploit.android.net.metasploit.Session;
 import org.csploit.android.net.metasploit.ShellSession;
 
+import java.util.ArrayList;
+
 public class Sessions extends Plugin {
 	private ListView mListView = null;
   private ArrayList<Session> mResults;
@@ -138,7 +138,7 @@ public void onCreate(Bundle savedInstanceState) {
 		SharedPreferences themePrefs = getSharedPreferences("THEME", 0);
 		Boolean isDark = themePrefs.getBoolean("isDark", false);
 		if (isDark)
-			setTheme(R.style.Sherlock___Theme);
+			setTheme(R.style.DarkTheme);
 		else
 			setTheme(R.style.AppTheme);
 		super.onCreate(savedInstanceState);

File: cSploit/src/org/csploit/android/plugins/Traceroute.java
Patch:
@@ -79,7 +79,7 @@ public void onCreate(Bundle savedInstanceState) {
 		SharedPreferences themePrefs = getSharedPreferences("THEME", 0);
 		Boolean isDark = themePrefs.getBoolean("isDark", false);
 		if (isDark)
-			setTheme(R.style.Sherlock___Theme);
+			setTheme(R.style.DarkTheme);
 		else
 			setTheme(R.style.AppTheme);
 		super.onCreate(savedInstanceState);

File: cSploit/src/org/csploit/android/tools/Ettercap.java
Patch:
@@ -69,7 +69,7 @@ public Child dissect(Target target, OnAccountListener listener) throws ChildMana
       sb.append(" /// ///");
       // router -> target poison
     else {
-      sb.append("/");
+      sb.append(" /");
       sb.append(target.getCommandLineRepresentation());
       sb.append("// ///");
     }

File: cSploit/src/org/csploit/android/events/Attempts.java
Patch:
@@ -6,14 +6,12 @@
 public class Attempts implements Event {
   public final long sent;
   public final long left;
-  public final long rate;
   public final long elapsed;
   public final long eta;
 
-  public Attempts(long sent, long left, long rate, long elapsed, long eta) {
+  public Attempts(long sent, long left, long elapsed, long eta) {
     this.sent = sent;
     this.left = left;
-    this.rate = rate;
     this.elapsed = elapsed;
     this.eta = eta;
   }

File: cSploit/src/org/csploit/android/events/Packet.java
Patch:
@@ -8,9 +8,9 @@
 public class Packet implements Event {
   public final InetAddress src;
   public final InetAddress dst;
-  public final short len;
+  public final int len;
 
-  public Packet(InetAddress src, InetAddress dst, short len) {
+  public Packet(InetAddress src, InetAddress dst, int len) {
     this.src = src;
     this.dst = dst;
     this.len = len;

File: cSploit/src/org/csploit/android/events/StderrNewline.java
Patch:
@@ -1,7 +1,7 @@
 package org.csploit.android.events;
 
 /**
- * Created by max on 28/10/14.
+ * a line has been printed on child stderr
  */
 public class StderrNewline implements Event {
   public final String line;

File: cSploit/src/org/csploit/android/plugins/mitm/Sniffer.java
Patch:
@@ -402,7 +402,7 @@ public void onSessionReady(){
             mTcpdumpProcess = System.getTools().tcpDump.sniff(PCAP_FILTER, mPcapFileName, new TcpDump.TcpDumpReceiver() {
 
               @Override
-              public void onPacket(InetAddress src, InetAddress dst, short len) {
+              public void onPacket(InetAddress src, InetAddress dst, int len) {
               long now = java.lang.System.currentTimeMillis();
               long deltat;
               AddressStats stats = null;

File: cSploit/src/org/csploit/android/tools/TcpDump.java
Patch:
@@ -45,7 +45,7 @@ public void onEvent(Event e) {
       }
     }
 
-    public abstract void onPacket(InetAddress src, InetAddress dst, short len);
+    public abstract void onPacket(InetAddress src, InetAddress dst, int len);
   }
 
   public Child sniff(String filter, String pcap, TcpDumpReceiver receiver) throws ChildManager.ChildNotStartedException {

File: cSploit/src/org/csploit/android/core/System.java
Patch:
@@ -150,10 +150,10 @@ public static void init(Context context) throws Exception{
       Logger.debug("initializing System...");
       mStoragePath = getSettings().getString("PREF_SAVE_PATH", Environment.getExternalStorageDirectory().toString());
       mSessionName = "dsploit-session-" + java.lang.System.currentTimeMillis();
+      mKnownIssues = new KnownIssues();
       mTools = new ToolBox();
       mPlugins = new ArrayList<Plugin>();
       mOpenPorts = new SparseIntArray(3);
-      mKnownIssues = new KnownIssues();
 
       // if we are here, network initialization didn't throw any error, lock wifi
       WifiManager wifiManager = (WifiManager) mContext.getSystemService(Context.WIFI_SERVICE);

File: cSploit/src/org/csploit/android/tools/Tool.java
Patch:
@@ -68,8 +68,6 @@ public boolean isEnabled() {
   }
 
   public void setEnabled() {
-    if(ChildManager.handlers != null) {
-      mEnabled = ChildManager.handlers.contains(mHandler);
-    }
+    mEnabled = ChildManager.handlers != null && ChildManager.handlers.contains(mHandler);
   }
 }

File: cSploit/src/org/csploit/android/core/UpdateService.java
Patch:
@@ -421,6 +421,7 @@ public static boolean isMsfUpdateAvailable() {
         mMsfInfo.outputDir = System.getMsfPath();
         mMsfInfo.executableOutputDir = ExecChecker.msf().getRoot();
         mMsfInfo.archiver = archiveAlgorithm.zip;
+        mMsfInfo.fixShebang = true;
 
         if (!mSettingReceiver.getFilter().contains("MSF_DIR")) {
           mSettingReceiver.addFilter("MSF_DIR");

File: cSploit/src/org/csploit/android/core/UpdateService.java
Patch:
@@ -246,7 +246,7 @@ public static boolean isCoreUpdateAvailable() {
         mCoreInfo.url = remoteURL;
         mCoreInfo.versionString = remoteVersion;
         mCoreInfo.version = Version.valueOf(mCoreInfo.versionString);
-        mCoreInfo.name = String.format("core-%s+%s.tar.xz", mCoreInfo.versionString, platform);
+        mCoreInfo.name = "core.tar.xz";
         mCoreInfo.path = String.format("%s/%s", System.getStoragePath(), mCoreInfo.name);
         mCoreInfo.archiver = archiveAlgorithm.tar;
         mCoreInfo.compression = compressionAlgorithm.xz;
@@ -304,7 +304,7 @@ public static boolean isRubyUpdateAvailable() {
         platform = System.getCompatiblePlatform();
         Logger.debug(String.format("trying with '%s'", platform));
 
-        remoteURL = GitHubParser.getCoreRepo().getLastReleaseAssetUrl(platform + ".");
+        remoteURL = GitHubParser.getRubyRepo().getLastReleaseAssetUrl(platform + ".");
       }
 
       Logger.debug(String.format("localVersion   = %s", localVersion));
@@ -319,7 +319,7 @@ public static boolean isRubyUpdateAvailable() {
         mRubyInfo.url = remoteURL;
         mRubyInfo.versionString = remoteVersion;
         mRubyInfo.version = Version.valueOf(mRubyInfo.versionString);
-        mRubyInfo.name = String.format("core-%s+%s.tar.xz", mRubyInfo.versionString, platform);
+        mRubyInfo.name = "ruby.tar.xz";
         mRubyInfo.path = String.format("%s/%s", System.getStoragePath(), mRubyInfo.name);
         mRubyInfo.archiver = archiveAlgorithm.tar;
         mRubyInfo.compression = compressionAlgorithm.xz;

File: cSploit/src/org/csploit/android/core/ArchiveMetadata.java
Patch:
@@ -27,6 +27,7 @@ public class ArchiveMetadata {
   public Intent
           contentIntent;
   public boolean
+          fixShebang,
           errorOccurred;
 
   public ArchiveMetadata() {
@@ -41,7 +42,7 @@ public void reset() {
       compression = null;
       archiver = null;
       contentIntent = null;
-      errorOccurred = false;
+      fixShebang = errorOccurred = false;
     }
   }
 

File: cSploit/src/org/csploit/android/core/System.java
Patch:
@@ -241,7 +241,7 @@ private static void startCoreDaemon() throws SuException, DaemonException {
       writer = new DataOutputStream(shell.getOutputStream());
       String cmd;
 
-      cmd = String.format("{ echo 'ACCESS GRANTED' >&2; cd '%s' && exec ./cSploitd ;} || exit 1\n",
+      cmd = String.format("{ echo 'ACCESS GRANTED' >&2; cd '%s' && exec ./start_daemon.sh ;} || exit 1\n",
           System.getCoreBinPath());
 
       writer.write(cmd.getBytes());

File: cSploit/src/org/csploit/android/core/UpdateService.java
Patch:
@@ -1074,7 +1074,7 @@ private void installGems() throws CancellationException, RuntimeException, IOExc
     try {
       // install bundle gem, required for install msf
       if (System.getTools().ruby.run("which bundle") != 0) {
-        bundleInstallTask = System.getTools().ruby.async("gem install bundle --source http://rubygems.org/", mErrorReceiver);
+        bundleInstallTask = System.getTools().ruby.async("gem install bundle", mErrorReceiver);
       }
 
       mBuilder.setContentText(getString(R.string.installing_msf_gems));
@@ -1103,7 +1103,7 @@ public void onNewLine(String line) {
       // append our REMOTE_GEM_SERVER to msf Gemfile sources.
       // we use an our gem server to provide cross compiled gems,
       // because android does not comes with a compiler.
-      sb.append(String.format("-e \"s#source 'https:\\/\\/rubygems.org'#source 'http:\\/\\/rubygems.org'\\\nsource '%s'#g\" ",
+      sb.append(String.format("-e \"/source 'https:\\/\\/rubygems.org'/a\\\nsource '%s'\" ",
               REMOTE_GEM_SERVER));
 
       for (String compiledGem : ourGems) {

File: cSploit/src/org/csploit/android/core/UpdateService.java
Patch:
@@ -1075,7 +1075,7 @@ private void installGems() throws CancellationException, RuntimeException, IOExc
     try {
       // install bundle gem, required for install msf
       if (System.getTools().ruby.run("which bundle") != 0) {
-        bundleInstallTask = System.getTools().ruby.async("gem install bundle", mErrorReceiver);
+        bundleInstallTask = System.getTools().ruby.async("gem install bundle --source http://rubygems.org/", mErrorReceiver);
       }
 
       mBuilder.setContentText(getString(R.string.installing_msf_gems));
@@ -1104,7 +1104,7 @@ public void onNewLine(String line) {
       // append our REMOTE_GEM_SERVER to msf Gemfile sources.
       // we use an our gem server to provide cross compiled gems,
       // because android does not comes with a compiler.
-      sb.append(String.format("-e \"/source 'https:\\/\\/rubygems.org'/a\\\nsource '%s'\" ",
+      sb.append(String.format("-e \"s#source 'https:\\/\\/rubygems.org'#source 'http:\\/\\/rubygems.org'\\\nsource '%s'#g\" ",
               REMOTE_GEM_SERVER));
 
       for (String compiledGem : ourGems) {

File: cSploit/src/org/csploit/android/core/ToolsInstaller.java
Patch:
@@ -49,7 +49,7 @@ public class ToolsInstaller{
   public ToolsInstaller(Context c){
     mAppContext = c;
     //noinspection ConstantConditions
-    mDestPath = mAppContext.getFilesDir().getAbsolutePath();
+    mDestPath = System.getCoreBinPath();
     mAppVersion = System.getAppVersionName();
     mVersionFile = mDestPath + "/tools/VERSION";
   }

File: cSploit/src/org/csploit/android/core/ToolsInstaller.java
Patch:
@@ -49,7 +49,7 @@ public class ToolsInstaller{
   public ToolsInstaller(Context c){
     mAppContext = c;
     //noinspection ConstantConditions
-    mDestPath = mAppContext.getFilesDir().getAbsolutePath();
+    mDestPath = System.getCoreBinPath();
     mAppVersion = System.getAppVersionName();
     mVersionFile = mDestPath + "/tools/VERSION";
   }

File: cSploit/src/org/csploit/android/tools/Hydra.java
Patch:
@@ -60,8 +60,9 @@ public void onEvent(Event e) {
         }
       } else if(e instanceof Login) {
         //TODO
+      } else {
+        Logger.error("Unknown event: " + e);
       }
-      Logger.error("Unknown event: " + e);
     }
   }
 

File: cSploit/src/org/csploit/android/tools/Shell.java
Patch:
@@ -36,7 +36,7 @@ public Shell() {
    */
   @Override
   public int run(String cmd, RawReceiver receiver) throws InterruptedException, ChildManager.ChildDiedException, ChildManager.ChildNotStartedException {
-    return super.run("-c '" + cmd.replaceAll("'", "\\'") + "'", receiver);
+    return super.run("-c '" + cmd.replace("'", "\\'") + "'", receiver);
   }
 
   public int run(String cmd) throws InterruptedException, ChildManager.ChildDiedException, ChildManager.ChildNotStartedException {

File: dSploit/src/it/evilsocket/dsploit/core/Client.java
Patch:
@@ -6,6 +6,7 @@
 public class Client {
 
   static {
+    java.lang.System.loadLibrary("dSploitCommon");
     java.lang.System.loadLibrary("dSploitClient");
   }
 

File: dSploit/src/it/evilsocket/dsploit/core/UpdateService.java
Patch:
@@ -1041,15 +1041,15 @@ public void onNewLine(String line) {
           continue;
         }
 
-        if(f.setExecutable(x, true)) {
+        if(!f.setExecutable(x, true)) {
           Logger.warning(String.format("cannot set executable permission of '%s'",name));
         }
 
-        if(f.setWritable(w, true)) {
+        if(!f.setWritable(w, true)) {
           Logger.warning(String.format("cannot set writable permission of '%s'",name));
         }
 
-        if(f.setReadable(r, true)) {
+        if(!f.setReadable(r, true)) {
           Logger.warning(String.format("cannot set readable permission of '%s'",name));
         }
       }

File: dSploit/src/it/evilsocket/dsploit/core/System.java
Patch:
@@ -201,8 +201,6 @@ public static void init(Context context) throws Exception{
       mTargets.add(gateway);
       mTargets.add(device);
 
-      UpdateService.setMsfBranch(getSettings().getString("MSF_BRANCH", "release"));
-
       mInitialized = true;
     }
     catch(Exception e){

File: dSploit/src/it/evilsocket/dsploit/core/ArchiveMetadata.java
Patch:
@@ -26,6 +26,8 @@ public class ArchiveMetadata {
           archiver;
   public Intent
           contentIntent;
+  public boolean
+          errorOccurred;
 
   public ArchiveMetadata() {
     reset();
@@ -39,6 +41,7 @@ public void reset() {
       compression = null;
       archiver = null;
       contentIntent = null;
+      errorOccurred = false;
     }
   }
 

File: dSploit/src/it/evilsocket/dsploit/core/UpdateService.java
Patch:
@@ -327,7 +327,7 @@ public static void setMsfBranch(String branch) {
         mMsfRepoParser.setBranch(branch);
       }
     } catch (Exception e) {
-      Logger.error(e.getMessage());
+      Logger.error(e.getClass().getName() + ": " + e.getMessage());
     }
   }
 
@@ -376,7 +376,7 @@ public static boolean isMsfUpdateAvailable() {
 
         exitForError = false;
 
-        if (!mMsfInfo.version.equals(localVersion))
+        if (localVersion == null || !localVersion.equals(mMsfInfo.versionString))
           return true;
       }
     } catch (Exception e) {

File: dSploit/src/it/evilsocket/dsploit/core/UpdateService.java
Patch:
@@ -1211,7 +1211,7 @@ private void updateRubyGems() throws CancellationException, IOException, Interru
     Shell.setupRubyEnviron();
     Thread shell;
 
-    shell = Shell.async("gem update --system --no-ri --no-rdoc --source 'http://rubygems.org/'", mErrorReceiver);
+    shell = Shell.async("gem update --backtrace --debug --system --no-ri --no-rdoc --source 'http://rubygems.org/' 2>&1", mErrorReceiver);
 
     if (execShell(shell, "cancelled on gem system update") != 0)
       throw new IOException("cannot update RubyGems");

File: dSploit/src/it/evilsocket/dsploit/net/Databases/Metasploit.java
Patch:
@@ -47,7 +47,7 @@ private static MsfExploit search( String encoded_query )
       if (new_location.equals(query)) {
         return null;
       }
-      int i = new_location.indexOf("/modules/");
+      int i = new_location.indexOf("/modules/exploit/");
 
       if(i<0)
         return null;

File: dSploit/src/it/evilsocket/dsploit/net/metasploit/MsfExploit.java
Patch:
@@ -88,7 +88,7 @@ private void retrieveInfos() throws IOException, RPCClient.MSFException {
     try {
       mVersion = Integer.parseInt((String)map.get("version"));
     } catch (NumberFormatException e) {
-      Logger.error(mDescription + ": " + e.getMessage());
+      Logger.warning(mDescription + ": unknown version");
       mVersion = 0;
     }
     // should we take references too ?

File: dSploit/src/it/evilsocket/dsploit/net/metasploit/RPCServer.java
Patch:
@@ -26,6 +26,7 @@
 import it.evilsocket.dsploit.core.Shell;
 import it.evilsocket.dsploit.core.System;
 import it.evilsocket.dsploit.core.Logger;
+import it.evilsocket.dsploit.net.Network;
 
 import android.content.Context;
 import android.content.Intent;
@@ -62,7 +63,8 @@ public static boolean exists() {
   }
 
   public static boolean isInternal() {
-    return System.getNetwork().isInternal(System.getSettings().getString("MSF_RPC_HOST", "127.0.0.1"));
+    Network network = System.getNetwork();
+    return network != null && network.isInternal(System.getSettings().getString("MSF_RPC_HOST", "127.0.0.1"));
   }
 
   public static boolean isLocal() {

File: dSploit/src/it/evilsocket/dsploit/core/UpdateService.java
Patch:
@@ -1150,7 +1150,7 @@ public void onEnd(int exitCode) {
             String.format("sed -i '1s,^#!/usr/bin/env,#!%s,' $(find '%s' -type f -perm +111 )",
                     envPath.toString(), mCurrentTask.executableOutputDir), mErrorReceiver);
 
-    if (execShell(shell, "cannot change shebang") != 0)
+    if (execShell(shell, "cancelled while changing shebangs") != 0)
       throw new RuntimeException("cannot change shebang");
   }
 

File: dSploit/src/it/evilsocket/dsploit/plugins/LoginCracker.java
Patch:
@@ -553,7 +553,7 @@ public void onStart(String command) {
 		@Override
 		public void onNewAttempt(String login, String password,
 				final int progress, final int total) {
-			String status = getString(R.string.trying) + login + ":" + password;
+			String status = getString(R.string.trying) + " " + login + ":" + password;
 
 			mNow = java.lang.System.currentTimeMillis();
 

File: dSploit/src/it/evilsocket/dsploit/tools/Hydra.java
Patch:
@@ -106,7 +106,7 @@ public Thread crack(Target target, int port, String service, String charset, int
     else
       command += " -x \"" + minlength + ":" + maxlength + ":" + charset + "\" ";
 
-    command += "-s " + port + " -V -t 10 " + target.getCommandLineRepresentation() + " " + service;
+    command += " -s " + port + " -V -t 10 " + target.getCommandLineRepresentation() + " " + service;
 
     if(service.equalsIgnoreCase("http-head"))
       command += " /";

File: dSploit/src/it/evilsocket/dsploit/plugins/LoginCracker.java
Patch:
@@ -553,7 +553,7 @@ public void onStart(String command) {
 		@Override
 		public void onNewAttempt(String login, String password,
 				final int progress, final int total) {
-			String status = getString(R.string.trying) + login + ":" + password;
+			String status = getString(R.string.trying) + " " + login + ":" + password;
 
 			mNow = java.lang.System.currentTimeMillis();
 

File: dSploit/src/it/evilsocket/dsploit/tools/Hydra.java
Patch:
@@ -106,7 +106,7 @@ public Thread crack(Target target, int port, String service, String charset, int
     else
       command += " -x \"" + minlength + ":" + maxlength + ":" + charset + "\" ";
 
-    command += "-s " + port + " -V -t 10 " + target.getCommandLineRepresentation() + " " + service;
+    command += " -s " + port + " -V -t 10 " + target.getCommandLineRepresentation() + " " + service;
 
     if(service.equalsIgnoreCase("http-head"))
       command += " /";

File: dSploit/src/it/evilsocket/dsploit/net/metasploit/RPCServer.java
Patch:
@@ -234,9 +234,9 @@ public void run( ) {
 
     msfHost     = prefs.getString("MSF_RPC_HOST", "127.0.0.1");
     msfUser     = prefs.getString("MSF_RPC_USER", "msf");
-    msfPassword = prefs.getString("MSF_RPC_PSWD", "pswd");
+    msfPassword = prefs.getString("MSF_RPC_PSWD", "msf");
     msfRoot     = prefs.getString("GENTOO_ROOT", System.getDefaultGentooPath());
-    msfPort     = prefs.getInt("MSF_RPC_PORT", 55553);
+    msfPort     = System.MSF_RPC_PORT;
     msfSsl      = prefs.getBoolean("MSF_RPC_SSL", false);
 
     mRemote     = !msfHost.equals("127.0.0.1");

File: dSploit/src/it/evilsocket/dsploit/tools/Tool.java
Patch:
@@ -44,7 +44,7 @@ public Tool(String name, Context context){
       Logger.error("cannot find tool: '"+name+"'");
       Logger.error(mPath +": No such file or directory");
       Logger.error("this tool will be disabled.");
-      mPath = "date";
+      mPath = "false";
     } else {
       mBasename = stat.getName();
     }

File: dSploit/src/it/evilsocket/dsploit/tools/Ettercap.java
Patch:
@@ -24,6 +24,7 @@
 import java.util.regex.Matcher;
 import java.util.regex.Pattern;
 
+import it.evilsocket.dsploit.core.Logger;
 import it.evilsocket.dsploit.core.Shell.OutputReceiver;
 import it.evilsocket.dsploit.core.System;
 import it.evilsocket.dsploit.net.Target;
@@ -87,7 +88,7 @@ public Thread dissect(Target target, OnAccountListener listener){
       System.errorLogging(e);
     }
 
-    return super.async(commandLine, listener);
+    return super.async(commandLine, listener, true);
   }
 
   public boolean kill(){

File: dSploit/src/it/evilsocket/dsploit/plugins/mitm/hijacker/Hijacker.java
Patch:
@@ -338,10 +338,10 @@ else if (session.mDomain.contains("xda-developers.")
 			if (holder.favicon != null)
 				holder.favicon.setImageBitmap(picture);
 
-			if (session.mUserName != null)
+			if (session.mUserName != null) {
 				if (holder.address != null)
 					holder.address.setText(session.mUserName);
-				else if (holder.address != null)
+      } else if (holder.address != null)
 					holder.address.setText(session.mAddress);
 
 			if (holder.domain != null)

File: dSploit/src/it/evilsocket/dsploit/net/NetworkDiscovery.java
Patch:
@@ -186,8 +186,9 @@ else if(name != null){
           boolean update = false;
           boolean found;
           int i;
+          Target[] currentTargets = System.getTargets().toArray(new Target[System.getTargets().size()]);
 
-          for(Target t : System.getTargets()) {
+          for(Target t : currentTargets) {
 
             endpoint = t.getEndpoint();
 

File: dSploit/src/it/evilsocket/dsploit/plugins/mitm/hijacker/Hijacker.java
Patch:
@@ -486,7 +486,7 @@ public void onInputEntered(String name) {
 							}).show();
 				}
 
-				return false;
+				return true;
 			}
 		});
 

File: dSploit/src/it/evilsocket/dsploit/plugins/mitm/hijacker/Hijacker.java
Patch:
@@ -486,7 +486,7 @@ public void onInputEntered(String name) {
 							}).show();
 				}
 
-				return false;
+				return true;
 			}
 		});
 

File: dSploit/src/it/evilsocket/dsploit/MainActivity.java
Patch:
@@ -184,7 +184,7 @@ public void onInputEntered(String input) {
 							}
 						}).show();
 
-				return false;
+				return true;
 			}
 		});
 
@@ -1043,4 +1043,4 @@ public void run() {
       }
 		}
 	}
-}
\ No newline at end of file
+}

File: dSploit/src/it/evilsocket/dsploit/MainActivity.java
Patch:
@@ -184,7 +184,7 @@ public void onInputEntered(String input) {
 							}
 						}).show();
 
-				return false;
+				return true;
 			}
 		});
 
@@ -1043,4 +1043,4 @@ public void run() {
       }
 		}
 	}
-}
\ No newline at end of file
+}

File: dSploit/src/it/evilsocket/dsploit/core/UpdateService.java
Patch:
@@ -297,6 +297,7 @@ public void onReceive(Context context, Intent intent) {
     registerReceiver(mReceiver,new IntentFilter(NOTIFICATION_CANCELLED));
     // set common notification actions
     mBuilder.setDeleteIntent(PendingIntent.getBroadcast(this, CANCEL_CODE, new Intent(NOTIFICATION_CANCELLED), 0));
+    mBuilder.setContentIntent(PendingIntent.getActivity(this, 0, new Intent(), 0));
   }
 
   /**

File: dSploit/src/it/evilsocket/dsploit/MainActivity.java
Patch:
@@ -287,7 +287,7 @@ public void run() {
 					if (!Shell.isRootGranted())
 						fatal = getString(R.string.only_4_root);
 
-					else if (!Shell.isBinaryAvailable("killall"))
+					else if (!Shell.isBinaryAvailable("killall", true))
 						fatal = getString(R.string.busybox_required);
 
 					else if (!System.isARM())

File: dSploit/src/it/evilsocket/dsploit/core/UpdateChecker.java
Patch:
@@ -56,7 +56,7 @@ public void run(){
 
     if(System.getUpdateService().isUpdateAvailable())
       send(UPDATE_AVAILABLE, AVAILABLE_VERSION, System.getUpdateService().getRemoteVersion());
-    else if(System.getSettings().getBoolean("MSF_ENABLED",true) && !RPCServer.exists() && Shell.isBinaryAvailable("tar") && System.getUpdateService().isGentooAvailable())
+    else if(System.getSettings().getBoolean("MSF_ENABLED",true) && !RPCServer.exists() && Shell.isBinaryAvailable("tar", true) && System.getUpdateService().isGentooAvailable())
       send(GENTOO_AVAILABLE, null, null);
     else
       send(UPDATE_NOT_AVAILABLE, null, null);

File: dSploit/src/it/evilsocket/dsploit/core/Shell.java
Patch:
@@ -196,7 +196,7 @@ public static Thread async(final String command, final OutputReceiver receiver)
 
       mWriter.writeBytes(String.format("mkfifo -m 666 '%s'\n", fifo_path));
       mWriter.flush();
-      mWriter.writeBytes(String.format("(%s ; echo -e \"\\n%s$?\") 2>&1 >%s &\n", command, token, fifo_path));
+      mWriter.writeBytes(String.format("(%s%s echo -e \"\\n%s$?\") 2>&1 >%s &\n", command,(command.trim().endsWith(";") ? "" : " ;"), token, fifo_path));
       mWriter.flush();
 
       gobbler = new StreamGobbler(fifo_path, receiver, token, fifonum);
@@ -210,7 +210,6 @@ public static Thread async(final String command, final OutputReceiver receiver)
         public void run() {
           if(receiver!=null)
             receiver.onEnd(-1);
-          return;
         }
       });
       return fakeThread;

File: dSploit/src/it/evilsocket/dsploit/core/Plugin.java
Patch:
@@ -29,6 +29,7 @@
 import it.evilsocket.dsploit.net.Target.Exploit;
 import it.evilsocket.dsploit.net.Target.Port;
 import it.evilsocket.dsploit.net.Target.Vulnerability;
+import it.evilsocket.dsploit.net.metasploit.RPCClient;
 
 public abstract class Plugin extends SherlockActivity{
   public static final int NO_LAYOUT = -1;
@@ -127,4 +128,6 @@ public void onTargetNewExploit( Target target, Vulnerability vulnerability, Expl
   public void onTargetNewExploit( Target target, Exploit ex ) {
 
   }
+
+  public void onRpcChange(RPCClient currentValue) { }
 }

File: dSploit/src/it/evilsocket/dsploit/net/metasploit/RPCServer.java
Patch:
@@ -116,7 +116,7 @@ public void onNewLine(String line) {
 
       @Override
       public void onEnd(int exitCode) {
-        Logger.debug("exit_code="+exitCode);
+        Logger.debug("mExitCode="+exitCode);
       }
     }
 

File: dSploit/src/it/evilsocket/dsploit/plugins/mitm/Sniffer.java
Patch:
@@ -45,6 +45,7 @@
 import java.util.regex.Pattern;
 
 import it.evilsocket.dsploit.R;
+import it.evilsocket.dsploit.core.Logger;
 import it.evilsocket.dsploit.core.Shell.OutputReceiver;
 import it.evilsocket.dsploit.core.System;
 import it.evilsocket.dsploit.gui.dialogs.ConfirmDialog;
@@ -390,10 +391,12 @@ public void onSessionReady(){
         System.getTcpDump().sniff(PCAP_FILTER, mPcapFileName, new OutputReceiver(){
           @Override
           public void onStart(String command){
+            Logger.debug( "TCPDUMP: " + command );
           }
 
           @Override
           public void onNewLine(String line){
+            Logger.debug( line );
 
             try{
               Matcher matcher = PARSER.matcher(line.trim());

File: dSploit/src/it/evilsocket/dsploit/MainActivity.java
Patch:
@@ -428,6 +428,7 @@ public void StopRPCServer() {
       }
       System.setMsfRpc(null);
       Shell.exec("killall msfrpcd");
+      Toast.makeText(this, getString(R.string.rpcd_stopped), Toast.LENGTH_SHORT).show();
     }
     catch ( Exception e)
     {

File: dSploit/src/it/evilsocket/dsploit/MainActivity.java
Patch:
@@ -348,7 +348,7 @@ public boolean onPrepareOptionsMenu(Menu menu){
 
     item = menu.findItem(R.id.ss_msfrpcd);
 
-    if(System.getMsfRpc()!=null)
+    if(System.getMsfRpc()!=null || (mRPCServer!=null && mRPCServer.isRunning()))
       item.setTitle( getString(R.string.stop_msfrpcd) );
     else
       item.setTitle( getString(R.string.start_msfrpcd) );

File: dSploit/src/it/evilsocket/dsploit/net/metasploit/RPCServer.java
Patch:
@@ -95,7 +95,7 @@ public void run( ) {
         }
         catch ( IOException ioe)
         {
-          System.errorLogging(ioe);
+          Logger.debug(ioe.getMessage());
           Shell.exec("killall msfrpcd");
         }
         catch ( RPCClient.MSFException me)

File: dSploit/src/it/evilsocket/dsploit/ActionActivity.java
Patch:
@@ -36,11 +36,11 @@
 import java.util.ArrayList;
 
 import it.evilsocket.dsploit.core.Plugin;
-import it.evilsocket.dsploit.core.Profiler;
 import it.evilsocket.dsploit.core.System;
 import it.evilsocket.dsploit.gui.dialogs.FinishDialog;
 
-public class ActionActivity extends SherlockListActivity{
+public class ActionActivity extends SherlockListActivity
+{
   private ArrayList<Plugin> mAvailable = null;
 
   @Override

File: dSploit/src/it/evilsocket/dsploit/DSploitApplication.java
Patch:
@@ -42,14 +42,14 @@ public void onCreate(){
     try{
       BugSenseHandler.initAndStartSession(this, "d5d1ed80");
     } catch(Exception e){
-      System.errorLogging("DSPLOIT", e);
+      System.errorLogging(e);
     }
 
     // initialize the system
     try{
       System.init(this);
     } catch(Exception e){
-      System.errorLogging("DSPLOIT", e);
+      System.errorLogging(e);
 
       // ignore exception when the user has wifi off
       if(!(e instanceof NoRouteToHostException))

File: dSploit/src/it/evilsocket/dsploit/MainActivity.java
Patch:
@@ -53,7 +53,6 @@
 import java.util.ArrayList;
 
 import it.evilsocket.dsploit.core.ManagedReceiver;
-import it.evilsocket.dsploit.core.Profiler;
 import it.evilsocket.dsploit.core.Shell;
 import it.evilsocket.dsploit.core.System;
 import it.evilsocket.dsploit.core.ToolsInstaller;
@@ -83,7 +82,8 @@
 import static it.evilsocket.dsploit.net.NetworkDiscovery.ENDPOINT_UPDATE;
 import static it.evilsocket.dsploit.net.NetworkDiscovery.NEW_ENDPOINT;
 
-public class MainActivity extends SherlockListActivity{
+public class MainActivity extends SherlockListActivity
+{
   private String NO_WIFI_UPDATE_MESSAGE;
   private static final int WIFI_CONNECTION_REQUEST = 1012;
   private boolean isWifiAvailable = false;

File: dSploit/src/it/evilsocket/dsploit/core/Profiler.java
Patch:
@@ -54,7 +54,7 @@ public void emit(){
     if(mEnabled && mTick > 0 && mProfiling != null){
       long delta = java.lang.System.currentTimeMillis() - mTick;
 
-      Log.d("PROFILER", "[" + mProfiling + "] " + format(delta));
+      Logger.debug("[" + mProfiling + "] " + format(delta));
 
       mProfiling = null;
       mTick = 0;

File: dSploit/src/it/evilsocket/dsploit/net/ByteBuffer.java
Patch:
@@ -119,7 +119,7 @@ public String toString(){
         return new String(mBuffer, charset != null ? charset : "UTF-8");
       }
     } catch(UnsupportedEncodingException e){
-      System.errorLogging("BYTEBUFFER", e);
+      System.errorLogging(e);
     }
 
     return new String(mBuffer);

File: dSploit/src/it/evilsocket/dsploit/net/IP4Address.java
Patch:
@@ -23,7 +23,8 @@
 import java.net.UnknownHostException;
 import java.nio.ByteOrder;
 
-public class IP4Address{
+public class IP4Address
+{
   private byte[] mByteArray = null;
   private String mString = "";
   private int mInteger = 0;

File: dSploit/src/it/evilsocket/dsploit/net/http/RequestParser.java
Patch:
@@ -27,7 +27,8 @@
 
 import it.evilsocket.dsploit.net.ByteBuffer;
 
-public class RequestParser{
+public class RequestParser
+{
   public final static String HOST_HEADER = "Host";
   public final static String ACCEPT_ENCODING_HEADER = "Accept-Encoding";
   public final static String CONNECTION_HEADER = "Connection";

File: dSploit/src/it/evilsocket/dsploit/plugins/RouterPwn.java
Patch:
@@ -54,9 +54,9 @@ public void onActionClick(Context context){
       Intent browser = new Intent(Intent.ACTION_VIEW, Uri.parse(uri));
 
       context.startActivity(browser);
-    } catch(ActivityNotFoundException e){
-      System.errorLogging("ROUTERPWN", e);
-
+    }
+    catch(ActivityNotFoundException e){
+      System.errorLogging(e);
       new ErrorDialog(getString(R.string.error), getString(R.string.no_activities_for_url), (Activity) context).show();
     }
   }

File: dSploit/src/it/evilsocket/dsploit/plugins/Traceroute.java
Patch:
@@ -32,7 +32,8 @@
 import it.evilsocket.dsploit.net.Target;
 import it.evilsocket.dsploit.tools.NMap.TraceOutputReceiver;
 
-public class Traceroute extends Plugin{
+public class Traceroute extends Plugin
+{
   private ToggleButton mTraceToggleButton = null;
   private ProgressBar mTraceProgress = null;
   private boolean mRunning = false;

File: dSploit/src/it/evilsocket/dsploit/plugins/mitm/HijackerWebView.java
Patch:
@@ -38,7 +38,8 @@
 import it.evilsocket.dsploit.core.System;
 import it.evilsocket.dsploit.plugins.mitm.Hijacker.Session;
 
-public class HijackerWebView extends SherlockActivity{
+public class HijackerWebView extends SherlockActivity
+{
   private static final String DEFAULT_USER_AGENT = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_5) AppleWebKit/537.4 (KHTML, like Gecko) Chrome/22.0.1229.94 Safari/537.4";
 
   private WebSettings mSettings = null;

File: dSploit/src/it/evilsocket/dsploit/wifi/NetworkManager.java
Patch:
@@ -25,7 +25,8 @@
 import java.util.Comparator;
 import java.util.List;
 
-public class NetworkManager{
+public class NetworkManager
+{
   public static void cleanPreviousConfiguration(WifiManager wifiMgr, WifiInfo info){
     WifiConfiguration config;
     do{

File: dSploit/src/it/evilsocket/dsploit/wifi/WirelessMatcher.java
Patch:
@@ -55,8 +55,8 @@
 import it.evilsocket.dsploit.wifi.algorithms.helpers.AliceHandle;
 import it.evilsocket.dsploit.wifi.algorithms.helpers.AliceMagicInfo;
 
-public class WirelessMatcher{
-
+public class WirelessMatcher
+{
   private final Map<String, ArrayList<AliceMagicInfo>> supportedAlices;
 
   public WirelessMatcher(InputStream aliceXml){

File: dSploit/src/it/evilsocket/dsploit/WifiScannerActivity.java
Patch:
@@ -134,7 +134,7 @@ public void onCreate(Bundle savedInstanceState){
     mWifiMatcher = new WirelessMatcher(getResources().openRawResource(R.raw.alice));
     mScanReceiver = new ScanReceiver();
     mConnectionReceiver = new ConnectionReceiver();
-    mStatusText = (TextView) findViewById(R.id.statusText);
+    mStatusText = (TextView) findViewById(R.id.scanStatusText);
     mAdapter = new ScanAdapter();
     mKeyList = new ArrayList<String>();
 

File: dSploit/src/it/evilsocket/dsploit/ActionActivity.java
Patch:
@@ -84,7 +84,7 @@ protected void onListItemClick(ListView l, View v, int position, long id) {
             System.setCurrentPlugin(plugin);
 
             if (plugin.hasLayoutToShow()) {
-                Toast.makeText(ActionActivity.this, getString(R.string.selected) + plugin.getName(), Toast.LENGTH_SHORT).show();
+                Toast.makeText(ActionActivity.this, getString(R.string.selected) + getString(plugin.getName()), Toast.LENGTH_SHORT).show();
 
                 startActivity(new Intent(
                         ActionActivity.this,
@@ -128,8 +128,8 @@ public View getView(int position, View convertView, ViewGroup parent) {
             Plugin action = mAvailable.get(position);
 
             holder.icon.setImageResource(action.getIconResourceId());
-            holder.name.setText(action.getName());
-            holder.description.setText(action.getDescription());
+            holder.name.setText(getString(action.getName()));
+            holder.description.setText(getString(action.getDescription()));
 
             return row;
         }

File: dSploit/src/it/evilsocket/dsploit/ActionActivity.java
Patch:
@@ -84,7 +84,7 @@ protected void onListItemClick(ListView l, View v, int position, long id) {
             System.setCurrentPlugin(plugin);
 
             if (plugin.hasLayoutToShow()) {
-                Toast.makeText(ActionActivity.this, getString(R.string.selected) + plugin.getName(), Toast.LENGTH_SHORT).show();
+                Toast.makeText(ActionActivity.this, getString(R.string.selected) + getString(plugin.getName()), Toast.LENGTH_SHORT).show();
 
                 startActivity(new Intent(
                         ActionActivity.this,
@@ -128,8 +128,8 @@ public View getView(int position, View convertView, ViewGroup parent) {
             Plugin action = mAvailable.get(position);
 
             holder.icon.setImageResource(action.getIconResourceId());
-            holder.name.setText(action.getName());
-            holder.description.setText(action.getDescription());
+            holder.name.setText(getString(action.getName()));
+            holder.description.setText(getString(action.getDescription()));
 
             return row;
         }

File: src/it/evilsocket/dsploit/net/Network.java
Patch:
@@ -95,6 +95,8 @@ public Network( Context context ) throws NoRouteToHostException, SocketException
 			try
 			{
 				mInterface = NetworkInterface.getByInetAddress( getLocalAddress() );			
+				if( mInterface == null )
+					throw new IllegalStateException("Error retrieving network interface.");
 			}
 			catch( SocketException e )
 			{

File: src/it/evilsocket/dsploit/net/http/proxy/ProxyThread.java
Patch:
@@ -237,7 +237,7 @@ public String onDataReceived( String headers, String data )
             else
             {
             	mReader.close();            	
-            }
+            }            
 		} 
 		catch( IOException e )
 		{

File: src/it/evilsocket/dsploit/net/http/RequestParser.java
Patch:
@@ -409,7 +409,7 @@ public static String getHeaderValue( String name, ByteBuffer buffer ) {
 			}						
 		}
 		
-		return value;
+		return value == null ? value : value.trim();
 	}
 	
 	public static String getHeaderValue( String name, ArrayList<String> headers ) {

File: src/it/evilsocket/dsploit/plugins/mitm/MITM.java
Patch:
@@ -80,7 +80,7 @@ public class MITM extends Plugin
 	private Intent			  mScriptPicker    = null;
 	private ProgressBar       mCurrentActivity = null;
 	private SpoofSession	  mSpoofSession	   = null;
-	
+		
 	static class Action
 	{
 		public int			   resourceId;
@@ -395,7 +395,7 @@ private void setStoppedState() {
 	@Override
     public void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);   
-                                
+
         new CheckForOpenPortsTask().execute();
         
         mActionListView = ( ListView )findViewById( R.id.actionListView );

File: src/it/evilsocket/dsploit/tools/NMap.java
Patch:
@@ -58,7 +58,7 @@ public void onEnd( int exitCode ) {
 	}
 	
 	public Thread trace( Target target, TraceOutputReceiver receiver ) {		
-		return super.async( "-sn --traceroute --system-dns " + target.getCommandLineRepresentation(), receiver );
+		return super.async( "-sn --traceroute --privileged --send-ip --system-dns " + target.getCommandLineRepresentation(), receiver );
 	}
 	
 	public static abstract class SynScanOutputReceiver implements OutputReceiver
@@ -87,7 +87,7 @@ public void onEnd( int exitCode ) {
 	}
 	
 	public Thread synScan( Target target, SynScanOutputReceiver receiver, String custom ) {
-		String command = "-sS -P0 --system-dns -vvv ";
+		String command = "-sS -P0 --privileged --send-ip --system-dns -vvv ";
 		
 		if( custom != null )
 			command += "-p " + custom + " ";
@@ -146,6 +146,6 @@ public void onEnd( int exitCode ) {
 	}
 	
 	public Thread inpsect( Target target, InspectionReceiver receiver ) {
-		return super.async( "-T4 -F -O -sV --system-dns -vvv " + target.getCommandLineRepresentation(), receiver );
+		return super.async( "-T4 -F -O -sV --privileged --send-ip --system-dns -vvv " + target.getCommandLineRepresentation(), receiver );
 	}
 }

File: src/it/evilsocket/dsploit/plugins/mitm/Hijacker.java
Patch:
@@ -531,6 +531,7 @@ public void onSessionReady() {
 				Hijacker.this.runOnUiThread( new Runnable() {					
 					@Override
 					public void run() {
+						mHijackToggleButton.setText("Stop");
 						mHijackProgress.setVisibility( View.VISIBLE );
 						mRunning = true;						
 					}

File: src/it/evilsocket/dsploit/net/http/proxy/Proxy.java
Patch:
@@ -118,7 +118,7 @@ public void run() {
 					
 					new ProxyThread( client, mRequestListener, mFilters, mHostRedirect, mPortRedirect ).start();
 				}
-				catch( IOException e )
+				catch( Exception e )
 				{
 					
 				}

File: src/it/evilsocket/dsploit/plugins/mitm/SpoofSession.java
Patch:
@@ -146,7 +146,9 @@ public void stop() {
 			if( System.getSettings().getBoolean( "PREF_HTTPS_REDIRECT", true ) )
 			{
 				System.getIPTables().undoPortRedirect( 443, System.HTTPS_REDIR_PORT );
-				System.getHttpsRedirector().stop();
+				
+				if( System.getHttpsRedirector() != null )
+					System.getHttpsRedirector().stop();
 			}
 			System.getProxy().stop();
 			System.getProxy().setRedirection( null, 0 );

File: src/it/evilsocket/dsploit/MainActivity.java
Patch:
@@ -489,7 +489,7 @@ public void run() {
 							}
 						});													
 					}
-	
+					
 					MainActivity.this.runOnUiThread( new Runnable(){			    			
 						@Override
 						public void run() 

File: src/it/evilsocket/dsploit/MainActivity.java
Patch:
@@ -261,7 +261,8 @@ public void run() {
 							public void onConfirm() 
 							{
 								final ProgressDialog dialog = new ProgressDialog( MainActivity.this );
-							    dialog.setMessage( "Downloading update ..." );
+								dialog.setTitle( "Downloading update ..." );
+							    dialog.setMessage( "Connecting ..." );
 							    dialog.setProgressStyle( ProgressDialog.STYLE_HORIZONTAL );
 							    dialog.setMax(100);
 							    dialog.setCancelable( false );

File: src/it/evilsocket/dsploit/plugins/mitm/Hijacker.java
Patch:
@@ -263,7 +263,7 @@ protected void onPostExecute( Boolean result ) {
 				mAdapter.notifyDataSetChanged();
 			}
 		}
-		
+
 		public class SessionHolder
 	    {
 			ImageView favicon;

File: src/it/evilsocket/dsploit/plugins/mitm/MITM.java
Patch:
@@ -516,6 +516,8 @@ public void onInputEntered( String address, String port ) {
 									if( iport <= 0 || iport > 65535 )
 										throw new Exception( "Port out of range." );
 
+									address = address.startsWith("http") ? address : "http://" + address;
+									
 									URL url = new URL( address );								
 									address = url.getHost();
 	

File: src/it/evilsocket/dsploit/WifiScannerActivity.java
Patch:
@@ -558,7 +558,7 @@ protected void onListItemClick( ListView l, View v, int position, long id ){
 				mKeyList.clear();
 				new WifiCrackDialog
 				(
-				   "Connect", 
+				   result.SSID, 
 				   "Enter WiFi Key or attempt cracking:", 
 				   this, 
 				   new WifiCrackDialogListener() {					
@@ -583,7 +583,7 @@ public void onCrack() {
 			{
 				if( result.capabilities.contains("WEP") || result.capabilities.contains("WPA") )
 				{
-					new InputDialog( "Connect", "Enter WiFi Key:", null, true, true, this, new InputDialogListener() {					
+					new InputDialog( result.SSID, "Enter WiFi Key:", null, true, true, this, new InputDialogListener() {					
 						@Override
 						public void onInputEntered( String input ) {
 							mCurrentNetworkId = performConnection( result, input );

File: src/it/evilsocket/dsploit/WifiScannerActivity.java
Patch:
@@ -252,7 +252,7 @@ private class ScanReceiver extends ManagedReceiver
 		private IntentFilter mFilter = null;
 				
 		public ScanReceiver() {
-			mFilter = new IntentFilter( WifiManager.SUPPLICANT_STATE_CHANGED_ACTION );
+			mFilter = new IntentFilter( WifiManager.SCAN_RESULTS_AVAILABLE_ACTION );
 		}
 		
 		public IntentFilter getFilter( ) {

File: src/it/evilsocket/dsploit/gui/dialogs/InputDialog.java
Patch:
@@ -46,6 +46,7 @@ public InputDialog( String title, String message, String text, boolean editable,
 			mEditText.setText(text);
 		
 		mEditText.setEnabled( editable );
+		mEditText.setMaxHeight( 250 );
 		
 		if( password )
 			mEditText.setInputType( InputType.TYPE_CLASS_TEXT | InputType.TYPE_TEXT_VARIATION_PASSWORD );

File: src/it/evilsocket/dsploit/net/Endpoint.java
Patch:
@@ -87,7 +87,7 @@ public void serialize( StringBuilder builder ) {
 	
 	public boolean equals( Endpoint endpoint ){		
 		if( mHardware != null && endpoint.mHardware != null && mHardware.length == endpoint.mHardware.length )
-			return mHardware.equals( endpoint.mHardware );
+			return getHardwareAsString().equals( endpoint.getHardwareAsString() );		
 		
 		else
 			return mAddress.equals( endpoint.getAddress() );

File: src/it/evilsocket/dsploit/core/ToolsInstaller.java
Patch:
@@ -58,7 +58,8 @@ public class ToolsInstaller
 		"chmod 755 {PATH}/tcpdump/tcpdump",
 		"chmod 666 {PATH}/hydra/*",
 		"chmod 755 {PATH}/hydra/hydra",
-		"mount -o remount,rw /system /system && ( chmod 6755 /system/*/su; mount -o remount,ro /system /system )"
+		"mount -o remount,rw /system /system && ( chmod 6755 /system/*/su; mount -o remount,ro /system /system )",
+		"chmod 755 {FILES}"
 	};
 	
 	private Context mAppContext  = null;
@@ -148,7 +149,7 @@ public boolean install( )
 	    	
 	    	for( String install_cmd : INSTALL_COMMANDS )
 	    	{
-	    		cmd += install_cmd.replace( "{PATH}", mDestPath + "/tools" ) + "; ";
+	    		cmd += install_cmd.replace( "{PATH}", mDestPath + "/tools" ).replace( "{FILES}", mDestPath ) + "; ";
 	    	}
 	    	        	
         	Shell.exec( cmd );

File: src/it/evilsocket/dsploit/net/Network.java
Patch:
@@ -160,7 +160,8 @@ public boolean isInternal( String ip ) {
 	}
 	
 	public static boolean isWifiConnected( Context context ){
-		return ( ( ConnectivityManager )context.getSystemService( Context.CONNECTIVITY_SERVICE ) ).getNetworkInfo( ConnectivityManager.TYPE_WIFI ).isConnected();
+		return ( ( ConnectivityManager )context.getSystemService( Context.CONNECTIVITY_SERVICE ) ).getNetworkInfo( ConnectivityManager.TYPE_WIFI ) != null &&
+			   ( ( ConnectivityManager )context.getSystemService( Context.CONNECTIVITY_SERVICE ) ).getNetworkInfo( ConnectivityManager.TYPE_WIFI ).isConnected();
 	}
 	
 	public static boolean isConnectivityAvailable( Context context ) {

File: src/it/evilsocket/dsploit/gui/dialogs/InputDialog.java
Patch:
@@ -67,6 +67,6 @@ public void onClick(DialogInterface dialog, int id) {
             public void onClick(DialogInterface dialog, int id) {
             	dialog.dismiss();
             }
-        });	
+        });		
 	}
 }

File: src/it/evilsocket/dsploit/net/http/proxy/HTTPSRedirector.java
Patch:
@@ -206,7 +206,7 @@ else if( line.indexOf(':') != -1 )
 				}
 				catch( Exception e )
 				{
-					System.errorLogging( TAG, e );
+					
 				}
 			}
 			

File: src/it/evilsocket/dsploit/net/http/proxy/Proxy.java
Patch:
@@ -120,7 +120,7 @@ public void run() {
 				}
 				catch( IOException e )
 				{
-					System.errorLogging( TAG, e );
+					
 				}
 			}
 			

File: src/it/evilsocket/dsploit/net/http/proxy/StreamThread.java
Patch:
@@ -97,7 +97,7 @@ public void run() {
 		        		String   hname  = hsplit[0].trim(),
 		        				 hvalue = hsplit[1].trim();
 		        		
-		        		if( hname.equals( "Location" ) && hvalue.startsWith("https://") )
+		        		if( hname.equals( "Location" ) && hvalue.startsWith("https://") && System.getSettings().getBoolean( "PREF_HTTPS_REDIRECT", true ) == true )
 		        		{
 		        			Log.w( TAG, "Patching 302 HTTPS redirect : " + hvalue );
 							

File: src/it/evilsocket/dsploit/core/System.java
Patch:
@@ -129,7 +129,7 @@ public static void init( Context context ) throws Exception {
 		mContext = context;		
 		try
 		{				
-			mStoragePath   = Environment.getExternalStorageDirectory().toString();
+			mStoragePath   = getSettings().getString( "PREF_SAVE_PATH", Environment.getExternalStorageDirectory().toString() );
 			mSessionName   = "dsploit-session-" + java.lang.System.currentTimeMillis();
 			mUpdateManager = new UpdateManager( mContext );
 			mPlugins 	   = new ArrayList<Plugin>();

File: src/it/evilsocket/dsploit/MainActivity.java
Patch:
@@ -389,7 +389,7 @@ public void onConfirm()
 														    dialog.setMessage( "Downloading update ..." );
 														    dialog.setProgressStyle( ProgressDialog.STYLE_HORIZONTAL );
 														    dialog.setMax(100);
-														    dialog.setCancelable(false);
+														    dialog.setCancelable( true );
 														    dialog.show();
 															
 															new Thread( new Runnable(){

File: src/it/evilsocket/dsploit/gui/dialogs/ConfirmDialog.java
Patch:
@@ -27,6 +27,7 @@ public class ConfirmDialog extends AlertDialog
 	public interface ConfirmDialogListener
 	{
 		public void onConfirm();
+		public void onCancel();
 	}
 	
 	public ConfirmDialog( String title, String message, Activity activity, ConfirmDialogListener confirmDialogListener ){
@@ -46,6 +47,7 @@ public void onClick(DialogInterface dialog, int id) {
 		this.setButton2( "No", new DialogInterface.OnClickListener() {
             public void onClick(DialogInterface dialog, int id) {
             	dialog.dismiss();
+            	listener.onCancel();
             }
         });	
 	}

File: src/it/evilsocket/dsploit/plugins/PortScanner.java
Patch:
@@ -215,6 +215,9 @@ public void onConfirm() {
 						}
 						
 					}
+					
+					@Override
+					public void onCancel() { }
             	  }
             	).show();
 				

File: src/it/evilsocket/dsploit/plugins/mitm/Hijacker.java
Patch:
@@ -402,6 +402,9 @@ public void onConfirm() {
 								
 								startActivity( new Intent( Hijacker.this, HijackerWebView.class ) );
 							}
+							
+							@Override
+							public void onCancel() { }
 						} 
 					).show();
 				}

File: src/it/evilsocket/dsploit/tools/NMap.java
Patch:
@@ -35,7 +35,7 @@ public class NMap extends Tool
 	public NMap( Context context ){
 		super( "nmap/nmap", context );		
 	}
-	
+
 	public static abstract class FindAliveEndpointsOutputReceiver implements OutputReceiver
 	{		
 		private static final Pattern IP_PATTERN  = Pattern.compile( "^nmap scan report for ([\\d]{1,3}\\.[\\d]{1,3}\\.[\\d]{1,3}\\.[\\d]{1,3}).*", 			  Pattern.CASE_INSENSITIVE );

File: src/it/evilsocket/dsploit/core/Shell.java
Patch:
@@ -167,7 +167,8 @@ public static int exec( String command, OutputReceiver receiver ) throws IOExcep
 
 		while( ( line = reader.readLine() ) != null )
 		{
-			if( receiver != null ) receiver.onNewLine( line );
+			if( receiver != null ) 
+				receiver.onNewLine( line );
 		}
 
 		int exit = process.waitFor();

File: src/it/evilsocket/dsploit/core/System.java
Patch:
@@ -646,7 +646,7 @@ public static Target getTarget( int index ){
 		return mTargets.get( index );
 	}
 	
-	public static boolean hasTarget( Target target ) {
+	public synchronized static boolean hasTarget( Target target ) {
 		for( Target t : mTargets )
 		{
 			if( t != null && t.equals(target) )

File: src/it/evilsocket/dsploit/net/http/proxy/ProxyThread.java
Patch:
@@ -133,7 +133,7 @@ else if( header.equals( HOST_HEADER ) )
 								mServerReader = mServer.getInputStream(); 
 								mServerWriter = mServer.getOutputStream();		
 								
-								Log.d( TAG, mSocket.getLocalAddress().getHostAddress() + " > " + mServerName );
+								Log.d( TAG, mSocket.getInetAddress().getHostAddress() + " > " + mServerName );
 		            		}
 		            			
 		            		if( header != null )
@@ -149,7 +149,7 @@ else if( header.equals( HOST_HEADER ) )
 	 			if( mServer != null )
 	 			{				
 	 				if( mRequestListener != null )
-	            		mRequestListener.onRequest( mSocket.getLocalAddress().getHostAddress(), mServerName, headers );
+	            		mRequestListener.onRequest( mSocket.getInetAddress().getHostAddress(), mServerName, headers );
 	 				
 	 				// send the patched request
 	 				mServerWriter.write( builder.toString().getBytes() );

File: src/it/evilsocket/dsploit/core/ToolsInstaller.java
Patch:
@@ -68,7 +68,7 @@ public ToolsInstaller( Context c ){
 	
 	public boolean needed( )
 	{
-		return !( new File( mDestPath + "/tools/libs" ) ).exists();
+		return !( new File( System.getLibraryPath() ) ).exists();
 	}
 	
 	public boolean install( )
@@ -82,7 +82,7 @@ public boolean install( )
 		ZipEntry 		 zipEntry;
 	    byte[] 		     buffer = new byte[ BUFFER_SIZE ];
 	    int				 read;
-	    FileOutputStream fileOutput;
+	    FileOutputStream fileOutput;																																																																																																																																																																																													
 	    File			 file;
 	    String			 fileName;
 	    

File: src/it/evilsocket/dsploit/core/ToolsInstaller.java
Patch:
@@ -68,7 +68,7 @@ public ToolsInstaller( Context c ){
 	
 	public boolean needed( )
 	{
-		return !( new File( mDestPath + "/libs" ) ).exists();
+		return !( new File( mDestPath + "/tools/libs" ) ).exists();
 	}
 	
 	public boolean install( )

File: src/it/evilsocket/dsploit/net/http/proxy/Proxy.java
Patch:
@@ -40,7 +40,7 @@ public class Proxy implements Runnable
 	
 	public static interface ProxyFilter
 	{
-		public String onHtmlReceived( String html );
+		public String onDataReceived( String headers, String data );
 	}
 	
 	public Proxy( InetAddress address, int port ) throws UnknownHostException, IOException {

File: src/it/evilsocket/dsploit/net/http/proxy/ProxyThread.java
Patch:
@@ -135,15 +135,15 @@ else if( header.equals( HOST_HEADER ) )
 	 				// start the stream session with specified filters				
 	 				new StreamThread( mServerReader, mWriter, new Proxy.ProxyFilter() {									
 	 					@Override
-	 					public String onHtmlReceived( String html ) 
+	 					public String onDataReceived( String headers, String data ) 
 	 					{	
 	 						// apply each provided filter
 	 						for( Proxy.ProxyFilter filter : mFilters )
 	 						{
-	 							html = filter.onHtmlReceived( html );
+	 							data = filter.onDataReceived( headers, data );
 	 						}
 	 						
-	 						return html;
+	 						return data;
 	 					}
 	 				});
 	 			}					

File: src/it/evilsocket/dsploit/core/ToolsInstaller.java
Patch:
@@ -76,7 +76,7 @@ public boolean install( )
 		Log.d( TAG, "Installing tools ..." );
 		
 		// Avoid some binary file being busy as a running process.
-		System.clean();
+		System.clean( false );
 		
 		ZipInputStream   zipInput;
 		ZipEntry 		 zipEntry;

File: src/it/evilsocket/dsploit/plugins/PacketForger.java
Patch:
@@ -226,7 +226,7 @@ private void setStoppedState( String errorMessage ) {
 			
 		}
 		
-		if( errorMessage != null )
+		if( errorMessage != null && !isFinishing() )
 			new ErrorDialog( "Error", errorMessage, this ).show();
 	}
 	

File: src/it/evilsocket/dsploit/DSploitApplication.java
Patch:
@@ -30,7 +30,6 @@
 import org.acra.annotation.*;
 
 import android.app.Application;
-import android.util.Log;
 
 @ReportsCrashes
 (
@@ -59,8 +58,7 @@ public void onCreate() {
 		}
 		catch( Exception e )
 		{
-			System.setLastError( e.getMessage() );
-			Log.e( "DSPLOIT", e.toString() );
+			System.errorLogging( "DSPLOIT", e );
 		}
 		        
 		super.onCreate();

File: src/it/evilsocket/dsploit/core/ToolsInstaller.java
Patch:
@@ -127,7 +127,7 @@ public boolean install( )
 	    }
 	    catch( Exception e )
 	    {
-	    	Log.e( "ToolsInstaller", e.getMessage() );
+	    	System.errorLogging( TAG, e );
 	    	
 	    	return false;
 	    }

File: src/it/evilsocket/dsploit/net/StreamAssembler.java
Patch:
@@ -30,8 +30,6 @@
 import java.util.regex.Matcher;
 import java.util.regex.Pattern;
 
-import android.util.Log;
-
 public class StreamAssembler 
 {
 	private static final String  TAG = "StreamAssembler";
@@ -100,7 +98,7 @@ public void assemble( String line ){
 				}
 				catch( SocketException e )
 				{
-					Log.e( TAG, e.toString() );
+					System.errorLogging( TAG, e );
 					
 					server = source;
 					type   = Stream.Type.fromString( sport );		

File: src/it/evilsocket/dsploit/net/http/proxy/Proxy.java
Patch:
@@ -101,15 +101,15 @@ public void run() {
 				}
 				catch( IOException e )
 				{
-					Log.e( TAG, e.toString() );
+					System.errorLogging( TAG, e );
 				}
 			}
 			
 			Log.d( TAG, "Proxy stopped." );
 		}
 		catch( IOException e )
 		{
-			Log.e( TAG, e.toString() );
+			System.errorLogging( TAG, e );
 		}
 	}
 }

File: src/it/evilsocket/dsploit/net/http/proxy/ProxyThread.java
Patch:
@@ -19,6 +19,8 @@
 package it.evilsocket.dsploit.net.http.proxy;
 
 
+import it.evilsocket.dsploit.core.System;
+
 import java.io.BufferedOutputStream;
 import java.io.BufferedReader;
 import java.io.ByteArrayInputStream;
@@ -154,7 +156,7 @@ public String onHtmlReceived( String html )
 		} 
 		catch( IOException e )
 		{
-			Log.e( TAG, e.toString() );
+			System.errorLogging( TAG, e );
 		}			
 	}
 }
\ No newline at end of file

File: src/it/evilsocket/dsploit/net/http/proxy/StreamThread.java
Patch:
@@ -103,7 +103,7 @@ public void run() {
     	}
     	catch( Exception e ) 
     	{			
-    		Log.e( TAG, e.toString() );
+    		System.errorLogging( TAG, e );
 		}
     	finally
     	{
@@ -115,7 +115,7 @@ public void run() {
 			} 
     		catch( IOException e ) 
     		{			
-    			Log.e( TAG, e.toString() );
+    			System.errorLogging( TAG, e );
 			}
     	}
     }

File: src/it/evilsocket/dsploit/net/http/server/Server.java
Patch:
@@ -134,15 +134,15 @@ public void run() {
 				}
 				catch( IOException e )
 				{
-					Log.e( TAG, e.toString() );
+					System.errorLogging( TAG, e );
 				}
 			}
 			
 			Log.d( TAG, "Server stopped." );
 		}
 		catch( IOException e )
 		{
-			Log.e( TAG, e.toString() );
+			System.errorLogging( TAG, e );
 		}
 	}
 }

File: src/it/evilsocket/dsploit/plugins/LoginCracker.java
Patch:
@@ -28,7 +28,6 @@
 import android.content.Intent;
 import android.graphics.Color;
 import android.os.Bundle;
-import android.util.Log;
 import android.view.View;
 import android.view.View.OnClickListener;
 import android.widget.AdapterView;
@@ -461,8 +460,7 @@ protected void onActivityResult( int request, int result, Intent intent ) {
 	    	}
 	    	catch( Exception e )
 	    	{
-	    		e.printStackTrace();
-	    		Log.e( TAG, e.toString() );
+	    		System.errorLogging( TAG, e );
 	    	}
 	    }
 	}

File: src/it/evilsocket/dsploit/plugins/mitm/MITM.java
Patch:
@@ -193,8 +193,7 @@ protected void onActivityResult( int request, int result, Intent intent ) {
 	    	}
 	    	catch( Exception e )
 	    	{
-	    		e.printStackTrace();
-	    		Log.e( TAG, e.toString() );
+	    		System.errorLogging( TAG, e );
 	    	}
 	    }	    
 	}

File: src/it/evilsocket/dsploit/plugins/mitm/PasswordSniffer.java
Patch:
@@ -35,7 +35,6 @@
 import android.content.Context;
 import android.graphics.Typeface;
 import android.os.Bundle;
-import android.util.Log;
 import android.view.View;
 import android.view.View.OnClickListener;
 import android.view.ViewGroup;
@@ -214,7 +213,7 @@ private void setStoppedState( ) {
 		}
 		catch( IOException e )
 		{
-			Log.e( TAG, e.toString() );
+			System.errorLogging( TAG, e );
 		}
 
 		System.setForwarding( false );
@@ -267,7 +266,7 @@ public void run()
 								}
 								catch( IOException e )
 								{
-									Log.e( TAG, e.toString() );
+									System.errorLogging( TAG, e );
 								}
 								
 								mAdapter.addChild( stream.endpoint.toString(), data );

File: src/it/evilsocket/dsploit/plugins/mitm/Sniffer.java
Patch:
@@ -30,7 +30,6 @@
 import android.content.Context;
 import android.os.Bundle;
 import android.text.Html;
-import android.util.Log;
 import android.view.LayoutInflater;
 import android.view.View;
 import android.view.ViewGroup;
@@ -285,7 +284,7 @@ public void run(){
 						}
 						catch( Exception e )
 						{
-							Log.e( TAG, e.toString() );
+							System.errorLogging( TAG, e );
 						}
 					}
 

File: src/it/evilsocket/dsploit/tools/EtterFilter.java
Patch:
@@ -18,6 +18,8 @@
  */
 package it.evilsocket.dsploit.tools;
 
+import it.evilsocket.dsploit.core.System;
+
 import java.io.BufferedReader;
 import java.io.BufferedWriter;
 import java.io.DataInputStream;
@@ -28,7 +30,6 @@
 import java.io.InputStreamReader;
 
 import android.content.Context;
-import android.util.Log;
 
 public class EtterFilter extends Tool
 {
@@ -72,7 +73,7 @@ public void compile( String output ) {
 		}
 		catch( Exception e )
 		{
-			Log.e( TAG, e.toString() );
+			System.errorLogging( TAG, e );
 		}
 	}
 	

File: src/it/evilsocket/dsploit/tools/Ettercap.java
Patch:
@@ -22,7 +22,6 @@
 import it.evilsocket.dsploit.core.Shell.OutputReceiver;
 import it.evilsocket.dsploit.net.Target;
 import android.content.Context;
-import android.util.Log;
 
 public class Ettercap extends Tool
 {
@@ -71,7 +70,7 @@ public Thread spoof( Target target, OnReadyListener listener ) {
 		}
 		catch( Exception e )
 		{
-			Log.e( TAG, e.toString() );
+			System.errorLogging( TAG, e );
 		}
 		
 		return super.async( commandLine, listener );
@@ -92,7 +91,7 @@ public Thread drop( Target target, OnReadyListener listener ) {
 		}
 		catch( Exception e )
 		{
-			Log.e( TAG, e.toString() );
+			System.errorLogging( TAG, e );
 		}
 		
 		return super.async( commandLine, listener );

File: src/it/evilsocket/dsploit/tools/IPTables.java
Patch:
@@ -18,6 +18,7 @@
  */
 package it.evilsocket.dsploit.tools;
 
+import it.evilsocket.dsploit.core.System;
 import android.util.Log;
 
 public class IPTables extends Tool
@@ -40,7 +41,7 @@ public void portRedirect( int from, int to ){
 		}
 		catch( Exception e )
 		{
-			Log.e( TAG, e.toString() );
+			System.errorLogging( TAG, e );
 		}
 	}
 	
@@ -54,7 +55,7 @@ public void undoPortRedirect( int from, int to ){
 		}
 		catch( Exception e )
 		{
-			Log.e( TAG, e.toString() );
+			System.errorLogging( TAG, e );
 		}
 	}
 	

File: src/it/evilsocket/dsploit/tools/Tool.java
Patch:
@@ -19,12 +19,12 @@
 package it.evilsocket.dsploit.tools;
 
 import it.evilsocket.dsploit.core.Shell;
+import it.evilsocket.dsploit.core.System;
 import it.evilsocket.dsploit.core.Shell.OutputReceiver;
 
 import java.io.File;
 import java.io.IOException;
 import android.content.Context;
-import android.util.Log;
 
 public class Tool 
 {
@@ -100,7 +100,7 @@ public boolean kill( String signal ){
 		}
 		catch( Exception e )
 		{ 
-			Log.e( TAG, e.toString() );
+			System.errorLogging( TAG, e );
 		}
 		
 		return false;

File: src/it/evilsocket/dsploit/DSploitApplication.java
Patch:
@@ -59,7 +59,7 @@ public void onCreate() {
 		}
 		catch( Exception e )
 		{
-			System.setLastError( e.toString() );
+			System.setLastError( e.getMessage() );
 			Log.e( "DSPLOIT", e.toString() );
 		}
 		        

File: src/it/evilsocket/dsploit/MainActivity.java
Patch:
@@ -138,7 +138,7 @@ public void onCreate( Bundle savedInstanceState ) {
         	// make sure system object was correctly initialized during application startup
         	if( System.isInitialized() == false )
         	{
-        		new FatalDialog( "Error", "Error during system initialization: " + System.getLastError(), this ).show();
+        		new FatalDialog( "Initialization Error", System.getLastError(), this ).show();
         		return;
         	}
         	

File: src/it/evilsocket/dsploit/core/Plugin.java
Patch:
@@ -18,14 +18,15 @@
  */
 package it.evilsocket.dsploit.core;
 
-import android.app.Activity;
+import com.actionbarsherlock.app.SherlockActivity;
+
 import android.os.Bundle;
 import it.evilsocket.dsploit.R;
 import it.evilsocket.dsploit.net.Target;
 import it.evilsocket.dsploit.net.Target.Port;
 import it.evilsocket.dsploit.net.Target.Vulnerability;
 
-public abstract class Plugin extends Activity 
+public abstract class Plugin extends SherlockActivity 
 {
 	private String        mName				  = null;
 	private String		  mDescription		  = null;

File: src/it/evilsocket/dsploit/MainActivity.java
Patch:
@@ -263,7 +263,7 @@ public void run() {
 						        registerReceiver( mMessageReceiver, mIntentFilter );		
 						        
 						        if( System.getSettings().getBoolean( "PREF_CHECK_UPDATES", true ) )
-						        	startService( new Intent( MainActivity.this, UpdateService.class ) );
+						        	startService( new Intent( MainActivity.this, UpdateService.class ) );						        						        
 					    	}
 					    	catch( Exception e )
 					    	{

File: src/it/evilsocket/dsploit/plugins/LoginCracker.java
Patch:
@@ -393,7 +393,7 @@ public void onClick(View v) {
 					setStartedState();
 				}
 			}} 
-		);
+		);       
 	}
 	
 	@Override

File: src/it/evilsocket/dsploit/ActionActivity.java
Patch:
@@ -96,7 +96,7 @@ public View getView( int position, View convertView, ViewGroup parent ) {
 	@Override
     public void onCreate( Bundle savedInstanceState ) {
         super.onCreate(savedInstanceState);        
-        
+                        
         if( System.getCurrentTarget() != null )
         {
 	        setTitle( "dSploit > " + System.getCurrentTarget() );

File: src/it/evilsocket/dsploit/net/Network.java
Patch:
@@ -79,7 +79,7 @@ public Network( Context context ) throws NoRouteToHostException, SocketException
 			throw new NoRouteToHostException("Not connected to any WiFi access point.");
 		
 		else
-			mInterface = NetworkInterface.getByInetAddress( getLoacalAddress() );		
+			mInterface = NetworkInterface.getByInetAddress( getLocalAddress() );		
 	}
 			
 	private static int countBits( int n ){
@@ -177,7 +177,7 @@ public byte[] getLocalHardware( ){
 		return null;
 	}
 	
-	public InetAddress getLoacalAddress( ){
+	public InetAddress getLocalAddress( ){
 		try
 		{
 			return InetAddress.getByName( ( mInfo.ipAddress & 0xFF) + "." + (( mInfo.ipAddress >> 8 ) & 0xFF) + "." + (( mInfo.ipAddress >> 16 ) & 0xFF) + "." + (( mInfo.ipAddress >> 24 ) & 0xFF) );

File: src/it/evilsocket/dsploit/net/Target.java
Patch:
@@ -431,7 +431,7 @@ else if( mType == Type.ENDPOINT )
 				if( mEndpoint.getAddress().equals( System.getNetwork().getGatewayAddress() ) )
 					desc += " ( Your network gateway / router )";
 			
-				else if( mEndpoint.getAddress().equals( System.getNetwork().getLoacalAddress() ) )
+				else if( mEndpoint.getAddress().equals( System.getNetwork().getLocalAddress() ) )
 					desc += " ( This device )";
 			}
 			catch( SocketException e )
@@ -473,7 +473,7 @@ else if( mType == Type.ENDPOINT )
 				if( mEndpoint.getAddress().equals( System.getNetwork().getGatewayAddress() ) )
 					return R.drawable.target_router_48;
 			
-				else if( mEndpoint.getAddress().equals( System.getNetwork().getLoacalAddress() ) )
+				else if( mEndpoint.getAddress().equals( System.getNetwork().getLocalAddress() ) )
 					return R.drawable.target_self_48;
 			
 				else

File: src/it/evilsocket/dsploit/plugins/mitm/PasswordSniffer.java
Patch:
@@ -51,7 +51,6 @@ public class PasswordSniffer extends Activity
 {
 	private static final String TAG			= "PASSWORDSNIFFER";
 	private static final String PCAP_FILTER = "not '(src host localhost or dst host localhost or arp)'";
-	private static final String FILENAME    = "dsploit-password-sniff.log";
 	
 	private ToggleButton       mSniffToggleButton = null;
 	private CheckBox		   mSniffCookies	  = null;
@@ -180,7 +179,7 @@ public void onCreate(Bundle savedInstanceState) {
         setTitle( System.getCurrentTarget() + " > MITM > Password Sniffer" );
         setContentView( R.layout.plugin_mitm_password_sniffer );
         
-        mFileOutput		   = ( new File( System.getStoragePath(), FILENAME ) ).getAbsolutePath();
+        mFileOutput		   = ( new File( System.getStoragePath(), System.getSettings().getString( "PREF_PASSWORD_FILENAME", "dsploit-password-sniff.log" ) ) ).getAbsolutePath();
         mSniffToggleButton = ( ToggleButton )findViewById( R.id.sniffToggleButton );
         mSniffCookies	   = ( CheckBox )findViewById( R.id.cookieCheckBox );
         mSniffProgress	   = ( ProgressBar )findViewById( R.id.sniffActivity );

File: src/it/evilsocket/dsploit/plugins/mitm/Sniffer.java
Patch:
@@ -52,6 +52,7 @@ public class Sniffer extends Activity
 	private ListView 		   mListView    	  = null;		
 	private StatListAdapter	   mAdapter			  = null;
 	private boolean	     	   mRunning			  = false;	
+	private double			   mSampleTime		  = 1.0;
 	
 	public static class AddressStats
 	{
@@ -181,6 +182,7 @@ public void onCreate(Bundle savedInstanceState) {
         mSniffProgress	   = ( ProgressBar )findViewById( R.id.sniffActivity );
         mListView 		   = ( ListView )findViewById( R.id.listView );
         mAdapter		   = new StatListAdapter( R.layout.plugin_mitm_sniffer_list_item );
+        mSampleTime		   = Double.parseDouble( System.getSettings().getString( "PREF_SNIFFER_SAMPLE_TIME", "1.0" ) );
         
         mListView.setAdapter( mAdapter );
                 
@@ -263,7 +265,7 @@ else if( System.getNetwork().isInternal( dest ) )
 									
 									deltat = ( now - stats.mSampledTime ) / 1000.0;
 									
-									if( deltat >= 1 )
+									if( deltat >= mSampleTime )
 									{										
 										stats.mBandwidth   = ( stats.mPackets - stats.mSampledSize ) / deltat;
 										stats.mSampledTime = java.lang.System.currentTimeMillis();

File: src/it/evilsocket/dsploit/net/NetworkMonitorService.java
Patch:
@@ -62,11 +62,11 @@ private void sendNotification( String message ) {
 		NotificationManager manager 	 = ( NotificationManager )getSystemService(Context.NOTIFICATION_SERVICE);
 		Notification 		notification = new Notification( R.drawable.dsploit_icon_48 , message, java.lang.System.currentTimeMillis() );
 		Context 			context 	 = getApplicationContext();
+		PendingIntent	    pending		 = PendingIntent.getActivity( context, 0, new Intent(), PendingIntent.FLAG_UPDATE_CURRENT );
 
-		notification.flags 		  |= Notification.FLAG_AUTO_CANCEL;
-		notification.contentIntent = PendingIntent.getActivity( context, 0, new Intent(), PendingIntent.FLAG_UPDATE_CURRENT );
+		notification.flags |= Notification.FLAG_AUTO_CANCEL;
 		
-		notification.setLatestEventInfo( context, "Network Monitor", message, null );
+		notification.setLatestEventInfo( context, "Network Monitor", message, pending );
 		
 		manager.cancel( mNotificationId );
 		manager.notify( ++mNotificationId, notification );

File: src/it/evilsocket/dsploit/net/http/proxy/StreamThread.java
Patch:
@@ -54,7 +54,6 @@ public void run() {
     	
     	try 
     	{
-    		// TODO: Implement support for chunkend transfer encoding
     		while( ( read = mReader.read( chunk, 0, CHUNK_SIZE ) ) > 0 )
     		{
     			mBuffer.append( chunk, read );

File: src/it/evilsocket/dsploit/tools/Hydra.java
Patch:
@@ -80,6 +80,9 @@ public void onEnd( int exitCode ) {
 	public Thread crack( Target target, int port, String service, String charset, int minlength, int maxlength, String username, AttemptReceiver receiver ){
 		String command = "-F -l " + username + " -s " + port + " -x " + minlength + ":" + maxlength + ":" + charset + " -V -t 10 " + target.getCommandLineRepresentation() + " " + service;
 		
+		if( service.equalsIgnoreCase("http-head") )
+			command += " /";
+		
 		return super.async( command, receiver );
 	}
 }

File: src/it/evilsocket/dsploit/MainActivity.java
Patch:
@@ -144,7 +144,7 @@ public void onCreate( Bundle savedInstanceState ) {
 	        new Thread( new Runnable(){
 				@Override
 				public void run() 
-				{				
+				{												
 					dialog.show();
 
 					String 		   fatal     = null;										
@@ -176,7 +176,7 @@ else if( Network.isWifiConnected( MainActivity.this ) )
 					}
 				}
 			}).start();
-	               	   
+	            					
 		    try
 	    	{	    	
 		    	// initialize the system
@@ -326,7 +326,7 @@ public void run() {
 						@Override
 						public void onEndpointFound( Endpoint endpoint ) {
 							Target target = new Target( endpoint );
-
+							
 							if( System.addOrderedTarget( target ) == true )
 							{													
 								// refresh the target listview

File: src/it/evilsocket/dsploit/core/CrashManager.java
Patch:
@@ -50,7 +50,7 @@ public CrashManager( Context context ) {
 	}
 	
 	public static void register( Context context ) {
-		 Thread.setDefaultUncaughtExceptionHandler( new CrashManager( context) );
+		 Thread.setDefaultUncaughtExceptionHandler( new CrashManager( context ) );
 	}
 	
 	@Override
@@ -142,7 +142,7 @@ public void uncaughtException( Thread thread, Throwable exception ) {
 	        catch( Exception e ) 
 	        {
 	        	Log.e( TAG, e.toString() );
-	        }
+	        }	        
 		}
 		catch( Exception e )
 		{

File: src/it/evilsocket/dsploit/gui/dialogs/AboutDialog.java
Patch:
@@ -19,6 +19,7 @@
 package it.evilsocket.dsploit.gui.dialogs;
 
 import it.evilsocket.dsploit.R;
+import it.evilsocket.dsploit.core.System;
 import android.app.Activity;
 import android.app.AlertDialog;
 import android.content.DialogInterface;
@@ -32,7 +33,7 @@ public AboutDialog( Activity activity ){
 		
 		final View view = LayoutInflater.from( activity ).inflate( R.layout.about_dialog, null );
 		
-		this.setTitle( "About" );
+		this.setTitle( "About dSploit v" + System.getAppVersionName() );
 		this.setView( view );
 
 		this.setButton( "Ok", new DialogInterface.OnClickListener() {

File: src/it/evilsocket/dsploit/plugins/mitm/ConnectionKiller.java
Patch:
@@ -24,10 +24,11 @@
 public class ConnectionKiller 
 {
 	public static void start() {
-		System.getEttercap().spoof( System.getCurrentTarget(), new OnReadyListener(){
+		System.getEttercap().drop( System.getCurrentTarget(), new OnReadyListener(){
 			@Override
 			public void onReady() 
 			{
+				// just in case :)
 				System.setForwarding( false );							
 			}
 			

File: src/it/evilsocket/dsploit/plugins/LoginCracker.java
Patch:
@@ -126,7 +126,7 @@ public class LoginCracker extends Plugin
 		"Admin",
 		"admin",
 		"system",
-		"webadminadministrator",
+		"webadmin",
 		"daemon ",
 		"bin ",
 		"sys ",

File: src/it/evilsocket/dsploit/core/System.java
Patch:
@@ -69,6 +69,7 @@ public class System
 	private static Map<String,String>    mServices 	    = null;
 	private static Map<String,String>    mPorts         = null;
 	private static Map< String, String > mVendors       = null;
+	
 	// registered plugins
 	private static ArrayList<Plugin>     mPlugins  	    = null;
 	private static Plugin			     mCurrentPlugin = null;	
@@ -163,13 +164,13 @@ public static void init( Context context ) throws NoRouteToHostException, Socket
 		{
 			Log.e( TAG, e.toString() );
 		}
-		
+								
 		mStoragePath = Environment.getExternalStorageDirectory().toString();
 		mSessionName = "dsploit-session-" + java.lang.System.currentTimeMillis();
 		
 		mInitialized = true;
 	}
-	
+
 	public static String getSessionName() {
 		return mSessionName;
 	}

File: src/it/evilsocket/dsploit/net/http/Proxy.java
Patch:
@@ -24,16 +24,16 @@
 import java.net.Socket;
 import java.net.UnknownHostException;
 import java.util.ArrayList;
-
 import android.util.Log;
+import it.evilsocket.dsploit.core.System;
 
 public class Proxy implements Runnable
 {
 	private static final String TAG     = "PROXY";
 	private static final int    BACKLOG = 10;
 	
 	private InetAddress  		   mAddress = null;
-	private int     	 		   mPort    = 8080;
+	private int     	 		   mPort    = System.HTTP_PROXY_PORT;
 	private boolean 	 		   mRunning = false;
 	private ServerSocket 		   mSocket  = null;
 	private ArrayList<ProxyFilter> mFilters = null;

File: src/it/evilsocket/dsploit/plugins/mitm/HTTPFilter.java
Patch:
@@ -41,15 +41,15 @@ public String onHtmlReceived(String html) {
 				
 				new Thread( proxy ).start();
 				
-				System.getIPTables().portRedirect( 80, 8080 );									
+				System.getIPTables().portRedirect( 80, System.HTTP_PROXY_PORT );									
 			}
 			
 		}).start();				
 	}
 	
 	public static void stop( Proxy proxy ){
 		System.getEttercap().kill();
-		System.getIPTables().undoPortRedirect( 80, 8080 );
+		System.getIPTables().undoPortRedirect( 80, System.HTTP_PROXY_PORT );
 		proxy.stop();
 		System.setForwarding( false );
 	}

File: src/it/evilsocket/dsploit/plugins/mitm/MITM.java
Patch:
@@ -166,7 +166,7 @@ private void setStoppedState() {
 			System.setForwarding( false );
 			
 			System.getEttercap().kill();
-			System.getIPTables().undoPortRedirect( 80, 8080 );
+			System.getIPTables().undoPortRedirect( 80, System.HTTP_PROXY_PORT );
 			System.getProxy().stop();
 			
 			for( i = 0; i < rows; i++ )

File: src/it/evilsocket/dsploit/core/System.java
Patch:
@@ -427,6 +427,9 @@ public static ArrayList<Endpoint> getNetworkEndpoints() {
 	
 	public static void addTarget( int index, Target target ){
 		mTargets.add( index, target );
+		// update current target index
+		if( mCurrentTarget >= index )
+			mCurrentTarget++;
 	}
 	
 	public static void addTarget( Target target ){

File: src/it/evilsocket/dsploit/core/ToolsInstaller.java
Patch:
@@ -75,6 +75,9 @@ public boolean install( )
 	{
 		Log.d( TAG, "Installing tools ..." );
 		
+		// Avoid some binary file being busy as a running process.
+		System.clean();
+		
 		ZipInputStream   zipInput;
 		ZipEntry 		 zipEntry;
 	    byte[] 		     buffer = new byte[ BUFFER_SIZE ];

File: src/it/evilsocket/dsploit/MainActivity.java
Patch:
@@ -35,6 +35,7 @@
 import it.evilsocket.dsploit.gui.dialogs.SpinnerDialog;
 import it.evilsocket.dsploit.gui.dialogs.SpinnerDialog.SpinnerDialogListener;
 import it.evilsocket.dsploit.net.Endpoint;
+import it.evilsocket.dsploit.net.Network;
 import it.evilsocket.dsploit.net.NetworkMonitorService;
 import it.evilsocket.dsploit.net.Target;
 import it.evilsocket.dsploit.plugins.ExploitFinder;
@@ -170,7 +171,8 @@ public void run() {
 					
 					dialog.dismiss();
 					
-			        startService( new Intent( MainActivity.this, NetworkMonitorService.class ) );
+					if( Network.isWifiConnected( MainActivity.this ) ) 
+						startService( new Intent( MainActivity.this, NetworkMonitorService.class ) );
 				}
 			}).start();
 	               	   

File: src/it/evilsocket/dsploit/ActionActivity.java
Patch:
@@ -95,7 +95,7 @@ public View getView( int position, View convertView, ViewGroup parent ) {
 	@Override
     public void onCreate( Bundle savedInstanceState ) {
         super.onCreate(savedInstanceState);        
-
+        setTitle( "dSploit > " + System.getCurrentTarget() );
         setContentView( LAYOUT );
         
         mAvailable      = System.getPluginsForTarget();

File: src/it/evilsocket/dsploit/core/Plugin.java
Patch:
@@ -72,7 +72,7 @@ public boolean isAllowedTarget( Target target ){
 	@Override
     public void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);     
-        setTitle( mName );
+        setTitle( System.getCurrentTarget() + " > " + mName );
         setContentView( mLayoutId );        
 	}
 	

File: src/it/evilsocket/dsploit/plugins/mitm/PasswordSniffer.java
Patch:
@@ -177,7 +177,7 @@ public boolean isChildSelectable(int groupPosition, int childPosition) {
 	
 	public void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);        
-        setTitle( "MITM - Password Sniffer" );
+        setTitle( System.getCurrentTarget() + " > MITM > Password Sniffer" );
         setContentView( R.layout.plugin_mitm_password_sniffer );
         
         mFileOutput		   = ( new File( System.getStoragePath(), FILENAME ) ).getAbsolutePath();

File: src/it/evilsocket/dsploit/plugins/mitm/Sniffer.java
Patch:
@@ -45,7 +45,7 @@ public class Sniffer extends Activity
 	
 	public void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);        
-        setTitle( "MITM - Sniffer" );
+        setTitle( System.getCurrentTarget() + " > MITM > Sniffer" );
         setContentView( R.layout.plugin_mitm_sniffer );
         
         mSniffToggleButton = ( ToggleButton )findViewById( R.id.sniffToggleButton );

File: src/it/evilsocket/dsploit/net/Endpoint.java
Patch:
@@ -25,10 +25,10 @@
 import android.util.Log;
 
 public class Endpoint 
-{
+{	
 	private InetAddress mAddress  = null;
 	private byte[]      mHardware = null;
-	
+		
 	public static byte[] parseMacAddress( String macAddress ) {
         String[] bytes = macAddress.split(":");
         byte[] parsed  = new byte[bytes.length];

File: src/it/evilsocket/dsploit/gui/dialogs/InputDialog.java
Patch:
@@ -43,7 +43,7 @@ public InputDialog( String title, String message, String text, Activity activity
 		
 		if( text != null )
 			mEditText.setText(text);
-		
+				
 		this.setTitle( title );
 		this.setMessage( message );
 		this.setView( mEditText );

File: src/it/evilsocket/dsploit/plugins/mitm/MITM.java
Patch:
@@ -389,7 +389,7 @@ public String onHtmlReceived(String html) {
 		}));
         
         /*        
-    	TODO:
+    	TODO: ?
         mActions.add( new Action( "Traffic Redirect", "Redirect every http request to a specific website.", new OnClickListener(){
 			@Override
 			public void onClick(View v) {

File: src/it/evilsocket/dsploit/plugins/mitm/PasswordSniffer.java
Patch:
@@ -218,7 +218,8 @@ private void setStoppedState( ) {
 
 		try
 		{
-			mBufferedWriter.close();
+			if( mBufferedWriter != null )
+				mBufferedWriter.close();
 		}
 		catch( IOException e )
 		{

File: src/it/evilsocket/dsploit/tools/NMap.java
Patch:
@@ -28,7 +28,8 @@
 import android.content.Context;
 import android.util.Log;
 
-public class NMap extends Tool {
+public class NMap extends Tool 
+{
 	private static final String TAG = "NMAP";
 	
 	public NMap( Context context ){

File: src/it/evilsocket/dsploit/tools/Ettercap.java
Patch:
@@ -43,7 +43,7 @@ public void onStart(String command) {
 
 		@Override
 		public void onNewLine(String line) {	
-			if( line.toLowerCase().contains("(press 'q' to exit)") )
+			if( line.toLowerCase().contains("for inline help") )
 				onReady();			
 		}
 
@@ -67,7 +67,7 @@ public Thread spoof( Target target, OnReadyListener listener ) {
 		
 		try
 		{
-			commandLine = "-Tqo -M arp:remote -i " + System.getNetwork().getInterface().getDisplayName() + " " + commandLine;
+			commandLine = "-Tq -M arp:remote -i " + System.getNetwork().getInterface().getDisplayName() + " " + commandLine;
 		}
 		catch( Exception e )
 		{

File: src/it/evilsocket/dsploit/MainActivity.java
Patch:
@@ -307,8 +307,7 @@ public void run() {
     		new FatalDialog( "Error", e.getMessage(), this ).show();
     	}
 	}
-	
-	
+
 	@Override
 	public void onDestroy() {		
 		// make sure no zombie process is running before destroying the activity

File: src/it/evilsocket/dsploit/tools/Ettercap.java
Patch:
@@ -42,8 +42,8 @@ public void onStart(String command) {
 		}
 
 		@Override
-		public void onNewLine(String line) {			
-			if( line.toLowerCase().contains("for inline help") )
+		public void onNewLine(String line) {	
+			if( line.toLowerCase().contains("(press 'q' to exit)") )
 				onReady();			
 		}
 
@@ -67,7 +67,7 @@ public Thread spoof( Target target, OnReadyListener listener ) {
 		
 		try
 		{
-			commandLine = "-Tq -M arp:remote -i " + System.getNetwork().getInterface().getDisplayName() + " " + commandLine;
+			commandLine = "-Tqo -M arp:remote -i " + System.getNetwork().getInterface().getDisplayName() + " " + commandLine;
 		}
 		catch( Exception e )
 		{

File: src/it/evilsocket/dsploit/tools/NMap.java
Patch:
@@ -81,8 +81,8 @@ public static abstract class SynScanOutputReceiver implements OutputReceiver
 	{
 		private final Pattern PORT_PATTERN = Pattern.compile( "^discovered open port (\\d+)/([^\\s]+).+", Pattern.CASE_INSENSITIVE );
 		
-		public void onStart( String commandLine) {
-			Log.d( TAG, "synScan OnStart( " + commandLine + " )" );
+		public void onStart( String commandLine ) {
+			
 		}
 		
 		public void onNewLine( String line ) {			

File: src/it/evilsocket/dsploit/MainActivity.java
Patch:
@@ -168,7 +168,7 @@ public void onClick( View v )
 				final Target target = ( ( TargetHolder )v.getTag() ).target;
 	
 				System.setTarget( target );
-					
+
 				MainActivity.this.runOnUiThread( new Runnable() {
 	                @Override
 	                public void run() {

File: src/it/evilsocket/dsploit/net/Endpoint.java
Patch:
@@ -65,8 +65,8 @@ public Endpoint( String address, String hardware ) {
 		}
 	}
 	
-	public boolean equals( Endpoint endpoint ){
-		return mAddress.equals( endpoint.getAddress() ) && ( mHardware == null ? ( mHardware == endpoint.getHardware() ) : mHardware.equals( endpoint.getHardware() ) );
+	public boolean equals( Endpoint endpoint ){		
+		return mAddress.equals( endpoint.getAddress() );
 	}
 	
 	public InetAddress getAddress() {

File: src/it/evilsocket/dsploit/net/Target.java
Patch:
@@ -154,10 +154,10 @@ public boolean equals( Target target )
 				return mNetwork.equals( target.getNetwork() );
 			
 			else if( mType == Type.ENDPOINT )
-				return mEndpoint.equals( target.getEndpoint() ) && mPort == target.getPort(); 
+				return mEndpoint.equals( target.getEndpoint() ); 
 			
 			else if( mType == Type.REMOTE )
-				return mHostname.equals( target.getHostname() ) && mPort == target.getPort(); 
+				return mHostname.equals( target.getHostname() ); 
 		}
 		
 		

File: src/it/evilsocket/dsploit/net/http/Proxy.java
Patch:
@@ -68,7 +68,8 @@ public void stop() {
 		
 		try 
 		{
-			mSocket.close();
+			if( mSocket != null )
+				mSocket.close();
 		} 
 		catch( IOException e )
 		{

File: src/it/evilsocket/dsploit/net/http/StreamThread.java
Patch:
@@ -114,6 +114,7 @@ public void run() {
     		{
     			try
     			{
+    				// TODO: Implement support for chunkend transfer encoding
     				if( ( read = mReader.read( buffer, 0, BUFFER_SIZE ) ) != -1 )
     				{
     					// since we don't know yet if we have a binary or text stream,

File: src/it/evilsocket/dsploit/tools/Ettercap.java
Patch:
@@ -38,7 +38,6 @@ public static abstract class OnReadyListener implements OutputReceiver
 	{
 		@Override
 		public void onStart(String command) {
-			// TODO Auto-generated method stub
 			
 		}
 
@@ -50,7 +49,6 @@ public void onNewLine(String line) {
 
 		@Override
 		public void onEnd(int exitCode) {
-			// TODO Auto-generated method stub
 			
 		}
 		

File: src/it/evilsocket/dsploit/net/http/ProxyThread.java
Patch:
@@ -79,6 +79,7 @@ private String readRequest( InputStream reader ) throws IOException {
 	}
 	
 	public void run() {
+		Log.d( TAG, "New connection from " + mSocket.getLocalAddress() );
 		
 		try 
 		{						

File: src/it/evilsocket/dsploit/net/parsers/FTPStreamParser.java
Patch:
@@ -59,7 +59,7 @@ public boolean isComplete(){
 	
 	@Override
 	public String getCredentials(){
-		return "FTP : " + mStream + " > USERNAME='" + mUsername + "' PASSWORD='" + mPassword + "'";
+		return mStream.endpoint.getAddress().toString().substring(1) + " -> " + mStream + " :\n" + mStream + " > USERNAME='" + mUsername + "' PASSWORD='" + mPassword + "'";
 	}
 	
 	@Override

File: src/it/evilsocket/dsploit/net/parsers/HTTPCookieStreamParser.java
Patch:
@@ -61,7 +61,7 @@ public boolean isComplete(){
 	
 	@Override
 	public String getCredentials(){
-		return "COOKIES : " + mHostname + " > '" + mCookie + "'";
+		return mStream.endpoint.getAddress().toString().substring(1) + " -> " + mStream + " COOKIES :\nhttp://" + mHostname + " > '" + mCookie + "'";
 	}
 	
 	@Override

File: src/it/evilsocket/dsploit/net/parsers/HTTPFormStreamParser.java
Patch:
@@ -68,7 +68,7 @@ public boolean isComplete(){
 	
 	@Override
 	public String getCredentials(){
-		return "POST : " + mHostname + mPage + " > '" + mData + "'";
+		return mStream.endpoint.getAddress().toString().substring(1) + " -> " + mStream + " POST :\nhttp://" + mHostname + mPage + " > '" + mData + "'";
 	}
 	
 	@Override

File: src/it/evilsocket/dsploit/system/Shell.java
Patch:
@@ -140,6 +140,7 @@ public void run() {
 				}
 				catch( Exception e )
 				{
+					e.printStackTrace();
 					Log.e( TAG, e.toString() );
 				}
 			}} 

