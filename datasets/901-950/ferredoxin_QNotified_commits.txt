File: app/src/main/java/nil/nadph/qnotified/lifecycle/Parasitics.java
Patch:
@@ -793,7 +793,7 @@ public Object invoke(Object proxy, Method method, Object[] args) throws Throwabl
                         return ai;
                     }
                     ComponentName component = (ComponentName) args[0];
-                    int flags = (Integer) args[1];
+                    long flags = ((Number) args[1]).longValue();
                     if (H.getPackageName().equals(component.getPackageName())
                         && ActProxyMgr.isModuleProxyActivity(component.getClassName())) {
                         return CounterfeitActivityInfoFactory

File: app/src/main/java/nil/nadph/qnotified/util/QQVersion.java
Patch:
@@ -69,4 +69,5 @@ public class QQVersion {
     public static final long QQ_8_8_35 = 2208;
     public static final long QQ_8_8_38 = 2266;
     public static final long QQ_8_8_50 = 2324;
+    public static final long QQ_8_8_68 = 2538;
 }

File: app/src/main/java/cc/ioctl/activity/ManageScriptsActivity.java
Patch:
@@ -140,7 +140,7 @@ private void addAllScript(LinearLayout main) {
         for (QNScript qs : QNScriptManager.getScripts()) {
             String name = qs.getName() == null ? "出错" : qs.getName();
             String decs = qs.getDecs() == null ? "出错" : qs.getDecs();
-            main.addView(ViewBuilder.newListItemButton(this, name, decs, qs.getEnable(),
+            main.addView(ViewBuilder.newListItemButton(this, name, decs, qs.getEnable().toString(),
                 view -> ScriptSettingDialog.OnClickListener_createDialog(view.getContext(), qs)));
         }
     }

File: app/src/main/java/cc/ioctl/hook/MultiForwardAvatarHook.java
Patch:
@@ -42,6 +42,7 @@
 import java.lang.reflect.Modifier;
 import me.singleneuron.qn_kernel.annotation.UiItem;
 import me.singleneuron.qn_kernel.base.CommonDelayAbleHookBridge;
+import me.singleneuron.qn_kernel.tlb.UiRoutineKt;
 import nil.nadph.qnotified.MainHook;
 import nil.nadph.qnotified.base.annotation.FunctionEntry;
 import nil.nadph.qnotified.step.DexDeobfStep;
@@ -51,7 +52,7 @@
 import nil.nadph.qnotified.util.LicenseStatus;
 import nil.nadph.qnotified.util.UiThread;
 import nil.nadph.qnotified.util.Utils;
-import org.ferredoxin.ferredoxin_ui.base.UiSwitchPreference;
+import org.ferredoxin.ferredoxinui.common.base.UiSwitchPreference;
 
 @FunctionEntry
 @UiItem
@@ -68,7 +69,7 @@ public UiSwitchPreference getPreference() {
     @Nullable
     @Override
     public String[] getPreferenceLocate() {
-        return new String[]{"增强功能"};
+        return UiRoutineKt.get增强功能();
     }
 
     public static final MultiForwardAvatarHook INSTANCE = new MultiForwardAvatarHook();

File: app/src/main/java/cc/ioctl/hook/SettingEntryHook.java
Patch:
@@ -35,10 +35,9 @@
 import android.os.Bundle;
 import android.view.View;
 import android.view.ViewGroup;
-
 import de.robv.android.xposed.XC_MethodHook;
 import de.robv.android.xposed.XposedHelpers;
-import me.singleneuron.qn_kernel.ui.NewSettingsActivity;
+import me.singleneuron.qn_kernel.tlb.ActivityRouter;
 import nil.nadph.qnotified.R;
 import nil.nadph.qnotified.activity.EulaActivity;
 import nil.nadph.qnotified.base.annotation.FunctionEntry;
@@ -111,7 +110,8 @@ protected void afterHookedMethod(final MethodHookParam param)
                                 item.setOnClickListener(v -> {
                                     if (LicenseStatus.hasUserAcceptEula()) {
                                         activity.startActivity(
-                                            new Intent(activity, NewSettingsActivity.class));
+                                            new Intent(activity,
+                                                ActivityRouter.INSTANCE.getActivityClass()));
                                     } else {
                                         activity.startActivity(
                                             new Intent(activity, EulaActivity.class));

File: app/src/main/java/me/zpp0196/qqpurify/fragment/AboutPreferenceFragment.java
Patch:
@@ -21,7 +21,7 @@ protected void initPreferences() {
     }
 
     @Override
-    protected int getPrefRes() {
+    public int getPrefRes() {
         return R.xml.pref_about;
     }
 

File: app/src/main/java/me/zpp0196/qqpurify/fragment/ChatPreferenceFragment.java
Patch:
@@ -9,7 +9,7 @@
 public class ChatPreferenceFragment extends AbstractPreferenceFragment {
 
     @Override
-    protected int getPrefRes() {
+    public int getPrefRes() {
         return R.xml.pref_chat;
     }
 

File: app/src/main/java/me/zpp0196/qqpurify/fragment/ExtensionPreferenceFragment.java
Patch:
@@ -9,7 +9,7 @@
 public class ExtensionPreferenceFragment extends AbstractPreferenceFragment {
 
     @Override
-    protected int getPrefRes() {
+    public int getPrefRes() {
         return R.xml.pref_extension;
     }
 

File: app/src/main/java/me/zpp0196/qqpurify/fragment/MainuiPreferenceFragment.java
Patch:
@@ -9,7 +9,7 @@
 public class MainuiPreferenceFragment extends AbstractPreferenceFragment {
 
     @Override
-    protected int getPrefRes() {
+    public int getPrefRes() {
         return R.xml.pref_mainui;
     }
 

File: app/src/main/java/me/zpp0196/qqpurify/fragment/SettingPreferenceFragment.java
Patch:
@@ -91,7 +91,7 @@ public void onDialogDismissed(int dialogId) {
     }
 
     @Override
-    protected int getPrefRes() {
+    public int getPrefRes() {
         return R.xml.pref_setting;
     }
 

File: app/src/main/java/me/zpp0196/qqpurify/fragment/SidebarPreferenceFragment.java
Patch:
@@ -9,7 +9,7 @@
 public class SidebarPreferenceFragment extends AbstractPreferenceFragment {
 
     @Override
-    protected int getPrefRes() {
+    public int getPrefRes() {
         return R.xml.pref_sidebar;
     }
 

File: app/src/main/java/me/zpp0196/qqpurify/fragment/TroopPreferenceFragment.java
Patch:
@@ -9,7 +9,7 @@
 public class TroopPreferenceFragment extends AbstractPreferenceFragment {
 
     @Override
-    protected int getPrefRes() {
+    public int getPrefRes() {
         return R.xml.pref_troop;
     }
 

File: app/src/main/java/nil/nadph/qnotified/ui/CommonContextWrapper.java
Patch:
@@ -111,7 +111,7 @@ public static CommonContextWrapper createAppCompatContext(@NonNull Context base)
 
     @NonNull
     public static CommonContextWrapper createMaterialDesignContext(@NonNull Context base) {
-        return new CommonContextWrapper(base, R.style.Theme_MaiTungTMDesign,
+        return new CommonContextWrapper(base, R.style.Theme_MaiTungTMUI,
             recreateNighModeConfig(base, ResUtils.getNightModeMasked()));
     }
 }

File: app/src/main/java/nil/nadph/qnotified/ui/ViewBuilder.java
Patch:
@@ -58,8 +58,8 @@
 import nil.nadph.qnotified.util.NonUiThread;
 import nil.nadph.qnotified.util.Toasts;
 import nil.nadph.qnotified.util.Utils;
-import org.ferredoxin.ferredoxin_ui.base.UiSwitchItem;
-import org.ferredoxin.ferredoxin_ui.base.UiSwitchPreference;
+import org.ferredoxin.ferredoxinui.common.base.UiSwitchItem;
+import org.ferredoxin.ferredoxinui.common.base.UiSwitchPreference;
 import xyz.nextalone.base.MultiItemDelayableHook;
 import xyz.nextalone.util.SystemServiceUtils;
 

File: app/src/main/java/nil/nadph/qnotified/util/DexKit.java
Patch:
@@ -145,10 +145,10 @@ public static boolean checkFor(int i) {
                 return true;
             }
             DexMethodDescriptor desc = getMethodDescFromCache(i);
-            return desc != null && NO_SUCH_CLASS.equals(desc.declaringClass);
+            return desc != null;
         } else {
             DexMethodDescriptor desc = getMethodDescFromCache(i);
-            return desc != null && NO_SUCH_CLASS.equals(desc.declaringClass);
+            return desc != null;
         }
     }
 

File: app/src/main/java/nil/nadph/qnotified/util/DexKit.java
Patch:
@@ -858,7 +858,7 @@ public static int[] d(int i) {
             case N_QQSettingMe_onResume:
                 return new int[]{4, 6, 8, 7};
             case N_VIP_UTILS_getPrivilegeFlags:
-                return new int[]{4, 2, 3};
+                return new int[]{14, 4, 2, 3};
             case N_TroopChatPie_showNewTroopMemberCount:
                 return new int[]{4, 8, 11, 6};
             case N_Conversation_onCreate:

File: app/src/main/java/cc/ioctl/hook/InputButtonHook.java
Patch:
@@ -229,7 +229,7 @@ public boolean onLongClick(View v) {
     }
 
     private static final BaseInputButtonDecorator[] decorators = {CardMsgHook.INSTANCE,
-        ChatTailHook.INSTANCE, Emoji2Sticker.INSTANCE};
+        ChatTailHook.INSTANCE};
 
     @Override
     public boolean isEnabled() {

File: app/src/main/java/com/rymmmmm/hook/OneTapTwentyLikes.java
Patch:
@@ -21,7 +21,7 @@
  */
 package com.rymmmmm.hook;
 
-import static nil.nadph.qnotified.util.ReflexUtil.iget_object_or_null;
+import static nil.nadph.qnotified.util.ReflexUtil.getFirstByType;
 import static nil.nadph.qnotified.util.Utils.log;
 
 import android.view.View;
@@ -61,7 +61,7 @@ protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
                             }
                             View view = (View) param.args[0];
                             Object tag = view.getTag();
-                            Object likeClickListener = iget_object_or_null(param.thisObject, "a",
+                            Object likeClickListener = getFirstByType(param.thisObject,
                                 Initiator._VoteHelper());
                             Method onClick = likeClickListener.getClass()
                                 .getDeclaredMethod("a", tag.getClass(), ImageView.class);

File: app/src/main/java/nil/nadph/qnotified/util/DexKit.java
Patch:
@@ -1051,6 +1051,7 @@ private static DexMethodDescriptor a(int i, HashSet<DexMethodDescriptor> __metho
             case N_LeftSwipeReply_Helper__reply:
             case N_FriendChatPie_updateUITitle:
             case N_QQSettingMe_updateProfileBubble:
+            case C_TogetherControlHelper:
                 //NOTICE: this must only has one result
 
                 return (DexMethodDescriptor) __methods.toArray()[0];
@@ -1144,7 +1145,6 @@ private static DexMethodDescriptor a(int i, HashSet<DexMethodDescriptor> __metho
                     return m;
                 }
                 break;
-            case C_TogetherControlHelper:
             case C_ClockInEntryHelper:
             case C_FaceManager:
             case C_AvatarUtil:

File: app/src/main/java/nil/nadph/qnotified/util/DexKit.java
Patch:
@@ -1051,6 +1051,7 @@ private static DexMethodDescriptor a(int i, HashSet<DexMethodDescriptor> __metho
             case N_LeftSwipeReply_Helper__reply:
             case N_FriendChatPie_updateUITitle:
             case N_QQSettingMe_updateProfileBubble:
+            case C_TogetherControlHelper:
                 //NOTICE: this must only has one result
 
                 return (DexMethodDescriptor) __methods.toArray()[0];
@@ -1144,7 +1145,6 @@ private static DexMethodDescriptor a(int i, HashSet<DexMethodDescriptor> __metho
                     return m;
                 }
                 break;
-            case C_TogetherControlHelper:
             case C_ClockInEntryHelper:
             case C_FaceManager:
             case C_AvatarUtil:

File: app/src/main/java/nil/nadph/qnotified/util/DexKit.java
Patch:
@@ -815,7 +815,7 @@ public static int[] d(int i) {
                 return new int[]{6, 2, 7, 3};
             case N_AtPanel__refreshUI:
             case N_AtPanel__showDialogAtView:
-                return new int[]{10, 4};
+                return new int[]{12, 10, 4};
             case C_CustomWidgetUtil:
                 return new int[]{5, 4, 9};
             case C_ClockInEntryHelper:

File: app/src/main/java/nil/nadph/qnotified/util/DexKit.java
Patch:
@@ -815,7 +815,7 @@ public static int[] d(int i) {
                 return new int[]{6, 2, 7, 3};
             case N_AtPanel__refreshUI:
             case N_AtPanel__showDialogAtView:
-                return new int[]{10, 4};
+                return new int[]{12, 10, 4};
             case C_CustomWidgetUtil:
                 return new int[]{5, 4, 9};
             case C_ClockInEntryHelper:

File: app/src/main/java/nil/nadph/qnotified/util/ReflexUtil.java
Patch:
@@ -807,8 +807,8 @@ public static Object iget_object_or_null(Object obj, String name) {
     }
 
     public static <T> T iget_object_or_null(Object obj, String name, Class<T> type) {
-        Class clazz = obj.getClass();
         try {
+            Class clazz = obj.getClass();
             Field f = findField(clazz, type, name);
             f.setAccessible(true);
             return (T) f.get(obj);

File: app/src/main/java/nil/nadph/qnotified/util/ReflexUtil.java
Patch:
@@ -807,8 +807,8 @@ public static Object iget_object_or_null(Object obj, String name) {
     }
 
     public static <T> T iget_object_or_null(Object obj, String name, Class<T> type) {
-        Class clazz = obj.getClass();
         try {
+            Class clazz = obj.getClass();
             Field f = findField(clazz, type, name);
             f.setAccessible(true);
             return (T) f.get(obj);

File: app/src/main/java/nil/nadph/qnotified/util/QQVersion.java
Patch:
@@ -62,4 +62,5 @@ public class QQVersion {
     public static final long QQ_8_8_5 = 1858;
     public static final long QQ_8_8_11 = 1898;
     public static final long QQ_8_8_12 = 1900;
+    public static final long QQ_8_8_17 = 1938;
 }

File: app/src/main/java/nil/nadph/qnotified/activity/EulaActivity.java
Patch:
@@ -127,7 +127,7 @@ public boolean doOnCreate(Bundle bundle) {
         tv.setGravity(Gravity.CENTER);
         tv.setTextColor(ResUtils.skin_black);
         tv.setText(
-            "\n注意: 本软件是免费软件!\nQNotified自始至终都是免费且非商业使用，如果有你发现有人在违反GPL和最终用户许可（主要为未明确指出本软件的作者以及免费获取的网址）的情况下商用本软件并牟取利润(群发,代发,引流,出售,贩卖等)，请拒绝并不遗余力地在一切平台举报投诉他！\n");
+            "\n注意: 本软件是免费软件!\nQNotified自始至终都是免费且非商业使用，如果有你发现有人在违反AGPL和Eula，请拒绝并不遗余力地在一切平台举报投诉他！\n");
         ll.addView(tv, stdlp);
 
         int _5dp = Utils.dip2px(this, 5);

File: app/src/main/java/nil/nadph/qnotified/activity/EulaActivity.java
Patch:
@@ -127,7 +127,7 @@ public boolean doOnCreate(Bundle bundle) {
         tv.setGravity(Gravity.CENTER);
         tv.setTextColor(ResUtils.skin_black);
         tv.setText(
-            "\n注意: 本软件是免费软件!\nQNotified自始至终都是免费且非商业使用，如果有你发现有人在违反GPL和最终用户许可（主要为未明确指出本软件的作者以及免费获取的网址）的情况下商用本软件并牟取利润(群发,代发,引流,出售,贩卖等)，请拒绝并不遗余力地在一切平台举报投诉他！\n");
+            "\n注意: 本软件是免费软件!\nQNotified自始至终都是免费且非商业使用，如果有你发现有人在违反AGPL和Eula，请拒绝并不遗余力地在一切平台举报投诉他！\n");
         ll.addView(tv, stdlp);
 
         int _5dp = Utils.dip2px(this, 5);

File: app/src/main/java/nil/nadph/qnotified/util/TIMVersion.java
Patch:
@@ -60,4 +60,6 @@ public class TIMVersion {
     public static final long TIM_3_3_1 = 1092;
     public static final long TIM_3_3_5 = 1102;
     public static final long TIM_3_3_6 = 1110;
+    public static final long TIM_3_3_7 = 1118;
+    public static final long TIM_3_3_8 = 1128;
 }

File: app/src/main/java/cc/ioctl/hook/$endGiftHook.java
Patch:
@@ -28,13 +28,14 @@
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 
+import org.ferredoxin.ferredoxin_ui.base.UiSwitchPreference;
+
 import java.lang.reflect.Method;
 
 import de.robv.android.xposed.XC_MethodHook;
 import de.robv.android.xposed.XposedBridge;
 import me.singleneuron.qn_kernel.annotation.UiItem;
 import me.singleneuron.qn_kernel.base.CommonDelayAbleHookBridge;
-import me.singleneuron.qn_kernel.ui.base.UiSwitchPreference;
 import nil.nadph.qnotified.SyncUtils;
 import nil.nadph.qnotified.base.annotation.FunctionEntry;
 import nil.nadph.qnotified.step.DexDeobfStep;

File: app/src/main/java/cc/ioctl/hook/CheatHook.java
Patch:
@@ -32,6 +32,8 @@
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 
+import org.ferredoxin.ferredoxin_ui.base.UiSwitchPreference;
+
 import java.util.Random;
 
 import de.robv.android.xposed.XC_MethodHook;
@@ -40,7 +42,6 @@
 import me.singleneuron.qn_kernel.annotation.UiItem;
 import me.singleneuron.qn_kernel.base.CommonDelayAbleHookBridge;
 import me.singleneuron.qn_kernel.data.HostInfo;
-import me.singleneuron.qn_kernel.ui.base.UiSwitchPreference;
 import nil.nadph.qnotified.base.annotation.FunctionEntry;
 import nil.nadph.qnotified.step.DexDeobfStep;
 import nil.nadph.qnotified.ui.CustomDialog;

File: app/src/main/java/cc/ioctl/hook/DarkOverlayHook.java
Patch:
@@ -30,6 +30,8 @@
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 
+import org.ferredoxin.ferredoxin_ui.base.UiSwitchPreference;
+
 import java.io.IOException;
 import java.lang.reflect.Field;
 import java.lang.reflect.Method;
@@ -39,7 +41,6 @@
 import me.singleneuron.qn_kernel.annotation.UiItem;
 import me.singleneuron.qn_kernel.base.CommonDelayAbleHookBridge;
 import me.singleneuron.qn_kernel.data.HostInfo;
-import me.singleneuron.qn_kernel.ui.base.UiSwitchPreference;
 import nil.nadph.qnotified.base.annotation.FunctionEntry;
 import nil.nadph.qnotified.config.ConfigManager;
 import nil.nadph.qnotified.step.DexDeobfStep;

File: app/src/main/java/cc/ioctl/hook/FavMoreEmo.java
Patch:
@@ -31,6 +31,8 @@
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 
+import org.ferredoxin.ferredoxin_ui.base.UiSwitchPreference;
+
 import java.lang.reflect.Method;
 import java.util.List;
 
@@ -39,7 +41,6 @@
 import me.singleneuron.qn_kernel.annotation.UiItem;
 import me.singleneuron.qn_kernel.base.CommonDelayAbleHookBridge;
 import me.singleneuron.qn_kernel.data.HostInfo;
-import me.singleneuron.qn_kernel.ui.base.UiSwitchPreference;
 import nil.nadph.qnotified.base.annotation.FunctionEntry;
 import nil.nadph.qnotified.step.DexDeobfStep;
 import nil.nadph.qnotified.util.DexKit;

File: app/src/main/java/cc/ioctl/hook/GagInfoDisclosure.java
Patch:
@@ -30,6 +30,8 @@
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 
+import org.ferredoxin.ferredoxin_ui.base.UiSwitchPreference;
+
 import java.lang.reflect.Method;
 import java.lang.reflect.Modifier;
 import java.util.ArrayList;
@@ -40,7 +42,6 @@
 import me.singleneuron.qn_kernel.annotation.UiItem;
 import me.singleneuron.qn_kernel.base.CommonDelayAbleHookBridge;
 import me.singleneuron.qn_kernel.data.HostInfo;
-import me.singleneuron.qn_kernel.ui.base.UiSwitchPreference;
 import nil.nadph.qnotified.SyncUtils;
 import nil.nadph.qnotified.base.annotation.FunctionEntry;
 import nil.nadph.qnotified.bridge.ContactUtils;

File: app/src/main/java/cc/ioctl/hook/MultiForwardAvatarHook.java
Patch:
@@ -40,13 +40,14 @@
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 
+import org.ferredoxin.ferredoxin_ui.base.UiSwitchPreference;
+
 import java.lang.reflect.Field;
 import java.lang.reflect.Modifier;
 
 import de.robv.android.xposed.XC_MethodHook;
 import me.singleneuron.qn_kernel.annotation.UiItem;
 import me.singleneuron.qn_kernel.base.CommonDelayAbleHookBridge;
-import me.singleneuron.qn_kernel.ui.base.UiSwitchPreference;
 import nil.nadph.qnotified.MainHook;
 import nil.nadph.qnotified.base.annotation.FunctionEntry;
 import nil.nadph.qnotified.step.DexDeobfStep;

File: app/src/main/java/cc/ioctl/hook/MuteQZoneThumbsUp.java
Patch:
@@ -26,13 +26,14 @@
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 
+import org.ferredoxin.ferredoxin_ui.base.UiSwitchPreference;
+
 import java.lang.reflect.Method;
 
 import de.robv.android.xposed.XC_MethodHook;
 import de.robv.android.xposed.XposedBridge;
 import me.singleneuron.qn_kernel.annotation.UiItem;
 import me.singleneuron.qn_kernel.base.CommonDelayAbleHookBridge;
-import me.singleneuron.qn_kernel.ui.base.UiSwitchPreference;
 import nil.nadph.qnotified.base.annotation.FunctionEntry;
 import nil.nadph.qnotified.step.DexDeobfStep;
 import nil.nadph.qnotified.util.DexKit;

File: app/src/main/java/cc/ioctl/hook/PreUpgradeHook.java
Patch:
@@ -27,14 +27,15 @@
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 
+import org.ferredoxin.ferredoxin_ui.base.UiSwitchPreference;
+
 import java.lang.reflect.Method;
 import java.lang.reflect.Modifier;
 
 import de.robv.android.xposed.XC_MethodHook;
 import de.robv.android.xposed.XposedBridge;
 import me.singleneuron.qn_kernel.annotation.UiItem;
 import me.singleneuron.qn_kernel.base.CommonDelayAbleHookBridge;
-import me.singleneuron.qn_kernel.ui.base.UiSwitchPreference;
 import nil.nadph.qnotified.base.annotation.FunctionEntry;
 
 @FunctionEntry

File: app/src/main/java/cc/ioctl/hook/PttForwardHook.java
Patch:
@@ -58,6 +58,8 @@
 import androidx.annotation.Nullable;
 import androidx.core.view.ViewCompat;
 
+import org.ferredoxin.ferredoxin_ui.base.UiSwitchPreference;
+
 import java.io.File;
 import java.io.FileInputStream;
 import java.io.FileOutputStream;
@@ -72,7 +74,6 @@
 import de.robv.android.xposed.XposedBridge;
 import me.singleneuron.qn_kernel.annotation.UiItem;
 import me.singleneuron.qn_kernel.base.CommonDelayAbleHookBridge;
-import me.singleneuron.qn_kernel.ui.base.UiSwitchPreference;
 import nil.nadph.qnotified.SyncUtils;
 import nil.nadph.qnotified.base.annotation.FunctionEntry;
 import nil.nadph.qnotified.bridge.ChatActivityFacade;

File: app/src/main/java/cc/ioctl/hook/RepeaterHook.java
Patch:
@@ -53,6 +53,8 @@
 import androidx.annotation.Nullable;
 import androidx.core.view.ViewCompat;
 
+import org.ferredoxin.ferredoxin_ui.base.UiSwitchPreference;
+
 import java.lang.reflect.Method;
 
 import cc.ioctl.dialog.RepeaterIconSettingDialog;
@@ -62,7 +64,6 @@
 import me.singleneuron.qn_kernel.annotation.UiItem;
 import me.singleneuron.qn_kernel.base.CommonDelayAbleHookBridge;
 import me.singleneuron.qn_kernel.data.HostInfo;
-import me.singleneuron.qn_kernel.ui.base.UiSwitchPreference;
 import mqq.app.AppRuntime;
 import nil.nadph.qnotified.base.annotation.FunctionEntry;
 import nil.nadph.qnotified.bridge.ChatActivityFacade;

File: app/src/main/java/cc/ioctl/hook/ReplyNoAtHook.java
Patch:
@@ -32,6 +32,8 @@
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 
+import org.ferredoxin.ferredoxin_ui.base.UiSwitchPreference;
+
 import java.lang.reflect.Method;
 
 import de.robv.android.xposed.XC_MethodHook;
@@ -40,7 +42,6 @@
 import me.singleneuron.qn_kernel.base.CommonDelayAbleHookBridge;
 import me.singleneuron.qn_kernel.data.HostInfo;
 import me.singleneuron.qn_kernel.tlb.ConfigTable;
-import me.singleneuron.qn_kernel.ui.base.UiSwitchPreference;
 import nil.nadph.qnotified.base.annotation.FunctionEntry;
 import nil.nadph.qnotified.util.DexMethodDescriptor;
 import nil.nadph.qnotified.util.Initiator;

File: app/src/main/java/cc/ioctl/hook/ShowPicGagHook.java
Patch:
@@ -30,14 +30,15 @@
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 
+import org.ferredoxin.ferredoxin_ui.base.UiSwitchPreference;
+
 import java.lang.reflect.Method;
 
 import de.robv.android.xposed.XC_MethodHook;
 import de.robv.android.xposed.XposedBridge;
 import me.singleneuron.qn_kernel.annotation.UiItem;
 import me.singleneuron.qn_kernel.base.CommonDelayAbleHookBridge;
 import me.singleneuron.qn_kernel.data.HostInfo;
-import me.singleneuron.qn_kernel.ui.base.UiSwitchPreference;
 import nil.nadph.qnotified.base.annotation.FunctionEntry;
 import nil.nadph.qnotified.util.LicenseStatus;
 

File: app/src/main/java/com/rymmmmm/hook/RemoveMiniProgramAd.java
Patch:
@@ -28,13 +28,14 @@
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 
+import org.ferredoxin.ferredoxin_ui.base.UiSwitchPreference;
+
 import java.lang.reflect.Method;
 
 import de.robv.android.xposed.XC_MethodHook;
 import de.robv.android.xposed.XposedBridge;
 import me.singleneuron.qn_kernel.annotation.UiItem;
 import me.singleneuron.qn_kernel.base.CommonDelayAbleHookBridge;
-import me.singleneuron.qn_kernel.ui.base.UiSwitchPreference;
 import nil.nadph.qnotified.SyncUtils;
 import nil.nadph.qnotified.base.annotation.FunctionEntry;
 import nil.nadph.qnotified.util.Initiator;

File: libs/mmkv/Android/src/main/java/com/tencent/mmkv/MMKV.java
Patch:
@@ -20,6 +20,7 @@
 
 package com.tencent.mmkv;
 
+import android.annotation.SuppressLint;
 import android.content.ContentResolver;
 import android.content.Context;
 import android.content.SharedPreferences;
@@ -494,6 +495,7 @@ public byte[] decodeBytes(String key, @Nullable byte[] defaultValue) {
 
     private static final HashMap<String, Parcelable.Creator<?>> mCreators = new HashMap<>();
 
+    @SuppressLint("WrongConstant")
     public boolean encode(String key, @Nullable Parcelable value) {
         if (value == null) {
             return encodeBytes(nativeHandle, key, null);

File: app/src/main/java/nil/nadph/qnotified/util/QQVersion.java
Patch:
@@ -60,4 +60,6 @@ public class QQVersion {
     public static final long QQ_8_8_0 = 1792;
     public static final long QQ_8_8_3 = 1818;
     public static final long QQ_8_8_5 = 1858;
+    public static final long QQ_8_8_11 = 1898;
+    public static final long QQ_8_8_12 = 1900;
 }

File: app/src/main/java/cc/ioctl/hook/$endGiftHook.java
Patch:
@@ -46,10 +46,12 @@
 @UiItem
 public class $endGiftHook extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("禁用$打开送礼界面", "禁止聊天时输入$自动弹出[选择赠送对象]窗口");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("禁用$打开送礼界面", "禁止聊天时输入$自动弹出[选择赠送对象]窗口");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/CheatHook.java
Patch:
@@ -52,10 +52,12 @@
 @UiItem
 public class CheatHook extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("自定义猜拳骰子");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("自定义猜拳骰子");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/DarkOverlayHook.java
Patch:
@@ -56,10 +56,12 @@
 @UiItem
 public class DarkOverlayHook extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("禁用夜间模式遮罩", "移除夜间模式下聊天界面的深色遮罩");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("禁用夜间模式遮罩", "移除夜间模式下聊天界面的深色遮罩");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/FavMoreEmo.java
Patch:
@@ -50,10 +50,12 @@ public class FavMoreEmo extends CommonDelayAbleHookBridge {
 
     public static final FavMoreEmo INSTANCE = new FavMoreEmo();
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("收藏更多表情", "[暂不支持>=8.2.0]保存在本地");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("收藏更多表情", "[暂不支持>=8.2.0]保存在本地");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/GagInfoDisclosure.java
Patch:
@@ -56,10 +56,12 @@
 @UiItem
 public class GagInfoDisclosure extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("显示设置禁言的管理", "即使你只是普通群成员");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("显示设置禁言的管理", "即使你只是普通群成员");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/MultiForwardAvatarHook.java
Patch:
@@ -61,10 +61,12 @@
 @UiItem
 public class MultiForwardAvatarHook extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("转发消息点头像查看详细信息", "仅限合并转发的消息");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("转发消息点头像查看详细信息", "仅限合并转发的消息");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/MuteQZoneThumbsUp.java
Patch:
@@ -42,10 +42,12 @@
 @UiItem
 public class MuteQZoneThumbsUp extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("被赞说说不提醒", "不影响评论,转发或击掌的通知");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("被赞说说不提醒", "不影响评论,转发或击掌的通知");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/PreUpgradeHook.java
Patch:
@@ -41,10 +41,12 @@
 @UiItem
 public class PreUpgradeHook extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("屏蔽更新提醒");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("屏蔽更新提醒");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/PttForwardHook.java
Patch:
@@ -99,10 +99,12 @@ public class PttForwardHook extends CommonDelayAbleHookBridge {
     public static final String qn_cache_ptt_save_last_parent_dir = "qn_cache_ptt_save_last_parent_dir";
     public static final PttForwardHook INSTANCE = new PttForwardHook();
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("语音转发", "长按语音消息");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("语音转发", "长按语音消息");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/RepeaterHook.java
Patch:
@@ -78,10 +78,12 @@
 @UiItem
 public class RepeaterHook extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory(" +1", "不是复读机");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory(" +1", "不是复读机");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/ReplyNoAtHook.java
Patch:
@@ -50,10 +50,12 @@
 @UiItem
 public class ReplyNoAtHook extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("禁止回复自动@", "去除回复消息时自动@特性");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("禁止回复自动@", "去除回复消息时自动@特性");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/RoundAvatarHook.java
Patch:
@@ -44,10 +44,12 @@
 @UiItem
 public class RoundAvatarHook extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("简洁模式圆头像", "From Rikka");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("简洁模式圆头像", "From Rikka");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/ShowPicGagHook.java
Patch:
@@ -45,10 +45,12 @@
 @UiItem
 public class ShowPicGagHook extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("禁止秀图自动展示");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("禁止秀图自动展示");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/com/rymmmmm/hook/RemoveMiniProgramAd.java
Patch:
@@ -47,10 +47,12 @@
 @UiItem
 public class RemoveMiniProgramAd extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("屏蔽小程序广告", "需要手动关闭广告, 请勿反馈此功能无效");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("屏蔽小程序广告", "需要手动关闭广告, 请勿反馈此功能无效");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/$endGiftHook.java
Patch:
@@ -46,10 +46,12 @@
 @UiItem
 public class $endGiftHook extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("禁用$打开送礼界面", "禁止聊天时输入$自动弹出[选择赠送对象]窗口");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("禁用$打开送礼界面", "禁止聊天时输入$自动弹出[选择赠送对象]窗口");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/CheatHook.java
Patch:
@@ -52,10 +52,12 @@
 @UiItem
 public class CheatHook extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("自定义猜拳骰子");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("自定义猜拳骰子");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/DarkOverlayHook.java
Patch:
@@ -56,10 +56,12 @@
 @UiItem
 public class DarkOverlayHook extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("禁用夜间模式遮罩", "移除夜间模式下聊天界面的深色遮罩");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("禁用夜间模式遮罩", "移除夜间模式下聊天界面的深色遮罩");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/FavMoreEmo.java
Patch:
@@ -50,10 +50,12 @@ public class FavMoreEmo extends CommonDelayAbleHookBridge {
 
     public static final FavMoreEmo INSTANCE = new FavMoreEmo();
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("收藏更多表情", "[暂不支持>=8.2.0]保存在本地");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("收藏更多表情", "[暂不支持>=8.2.0]保存在本地");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/GagInfoDisclosure.java
Patch:
@@ -56,10 +56,12 @@
 @UiItem
 public class GagInfoDisclosure extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("显示设置禁言的管理", "即使你只是普通群成员");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("显示设置禁言的管理", "即使你只是普通群成员");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/MultiForwardAvatarHook.java
Patch:
@@ -61,10 +61,12 @@
 @UiItem
 public class MultiForwardAvatarHook extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("转发消息点头像查看详细信息", "仅限合并转发的消息");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("转发消息点头像查看详细信息", "仅限合并转发的消息");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/MuteQZoneThumbsUp.java
Patch:
@@ -42,10 +42,12 @@
 @UiItem
 public class MuteQZoneThumbsUp extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("被赞说说不提醒", "不影响评论,转发或击掌的通知");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("被赞说说不提醒", "不影响评论,转发或击掌的通知");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/PreUpgradeHook.java
Patch:
@@ -41,10 +41,12 @@
 @UiItem
 public class PreUpgradeHook extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("屏蔽更新提醒");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("屏蔽更新提醒");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/PttForwardHook.java
Patch:
@@ -99,10 +99,12 @@ public class PttForwardHook extends CommonDelayAbleHookBridge {
     public static final String qn_cache_ptt_save_last_parent_dir = "qn_cache_ptt_save_last_parent_dir";
     public static final PttForwardHook INSTANCE = new PttForwardHook();
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("语音转发", "长按语音消息");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("语音转发", "长按语音消息");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/RepeaterHook.java
Patch:
@@ -78,10 +78,12 @@
 @UiItem
 public class RepeaterHook extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory(" +1", "不是复读机");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory(" +1", "不是复读机");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/ReplyNoAtHook.java
Patch:
@@ -50,10 +50,12 @@
 @UiItem
 public class ReplyNoAtHook extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("禁止回复自动@", "去除回复消息时自动@特性");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("禁止回复自动@", "去除回复消息时自动@特性");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/RoundAvatarHook.java
Patch:
@@ -44,10 +44,12 @@
 @UiItem
 public class RoundAvatarHook extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("简洁模式圆头像", "From Rikka");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("简洁模式圆头像", "From Rikka");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/cc/ioctl/hook/ShowPicGagHook.java
Patch:
@@ -45,10 +45,12 @@
 @UiItem
 public class ShowPicGagHook extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("禁止秀图自动展示");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("禁止秀图自动展示");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/com/rymmmmm/hook/RemoveMiniProgramAd.java
Patch:
@@ -47,10 +47,12 @@
 @UiItem
 public class RemoveMiniProgramAd extends CommonDelayAbleHookBridge {
 
+    private final UiSwitchPreference mUiSwitchPreference = this.new UiSwitchPreferenceItemFactory("屏蔽小程序广告", "需要手动关闭广告, 请勿反馈此功能无效");
+
     @NonNull
     @Override
     public UiSwitchPreference getPreference() {
-        return this.new UiSwitchPreferenceItemFactory("屏蔽小程序广告", "需要手动关闭广告, 请勿反馈此功能无效");
+        return mUiSwitchPreference;
     }
 
     @Nullable

File: app/src/main/java/nil/nadph/qnotified/util/LicenseStatus.java
Patch:
@@ -124,7 +124,7 @@ public static boolean isWhitelisted() {
             LicenseStatus.setUserCurrentStatus();
             currentStatus = ConfigManager.getDefaultConfig().getIntOrDefault(qn_user_auth_status, -1);
         }
-        if (currentStatus == UserStatusConst.whitelisted) {
+        if (currentStatus == UserStatusConst.whitelisted|currentStatus == UserStatusConst.developer) {
             return true;
         }
         return false;

File: app/src/main/java/cc/ioctl/hook/ChatTailHook.java
Patch:
@@ -115,7 +115,7 @@ public boolean initOnce() {
                 if (argt.length != 6) {
                     continue;
                 }
-                if (argt[1].equals(Context.class) && argt[2].equals(_SessionInfo())
+                if (argt[1].equals(Context.class)
                     && argt[3].equals(String.class) && argt[4].equals(ArrayList.class)) {
                     m = mi;
                     m.setAccessible(true);

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -248,9 +248,9 @@ public boolean onLongClick(View v) {
             newListItemButtonIfValid(this, "精简联系人页面", null, null, SimplifyContactTabs.INSTANCE));
         ll.addView(
             newListItemButtonIfValid(this, "精简主页对话框", null, null, SimplifyRecentDialog.INSTANCE));
-        ll.addView(newListItemConfigSwitchIfValid(this, "精简表情菜单", null, SimplifyEmoPanel.INSTANCE));
         ll.addView(
-            newListItemConfigSwitchIfValid(this, "精简底栏动态", null, SimplifyBottomQzone.INSTANCE));
+            newListItemButtonIfValid(this, "精简底栏", null, null, SimplifyBottomTab.INSTANCE));
+        ll.addView(newListItemConfigSwitchIfValid(this, "精简表情菜单", null, SimplifyEmoPanel.INSTANCE));
         ll.addView(
             newListItemConfigSwitchIfValid(this, "隐藏底栏小红点", null, RemoveBottomRedDots.INSTANCE));
         ll.addView(

File: app/src/main/java/nil/nadph/qnotified/util/QQVersion.java
Patch:
@@ -56,4 +56,5 @@ public class QQVersion {
     public static final long QQ_8_6_5 = 1696;
     public static final long QQ_8_7_0 = 1718;
     public static final long QQ_8_7_5 = 1738;
+    public static final long QQ_8_7_8 = 1758;
 }

File: libs/compiler/src/main/java/cn/lliiooll/processors/Dex2CProcessor.java
Patch:
@@ -23,7 +23,6 @@
 package cn.lliiooll.processors;
 
 import cn.lliiooll.annotations.Dex2C;
-import com.google.auto.service.AutoService;
 import com.squareup.javapoet.JavaFile;
 import com.squareup.javapoet.MethodSpec;
 import com.squareup.javapoet.ParameterizedTypeName;
@@ -33,7 +32,6 @@
 import java.util.List;
 import java.util.Set;
 import javax.annotation.processing.ProcessingEnvironment;
-import javax.annotation.processing.Processor;
 import javax.annotation.processing.RoundEnvironment;
 import javax.annotation.processing.SupportedAnnotationTypes;
 import javax.annotation.processing.SupportedSourceVersion;
@@ -43,7 +41,6 @@
 import javax.lang.model.element.TypeElement;
 import javax.lang.model.type.TypeMirror;
 
-@AutoService(Processor.class)
 @SupportedAnnotationTypes("cn.lliiooll.annotations.Dex2C")
 @SupportedSourceVersion(SourceVersion.RELEASE_8)
 public class Dex2CProcessor extends BaseProcessor {

File: libs/compiler/src/main/java/cn/lliiooll/processors/FunctionItemProcessor.java
Patch:
@@ -22,7 +22,6 @@
 
 package cn.lliiooll.processors;
 
-import com.google.auto.service.AutoService;
 import com.squareup.javapoet.ClassName;
 import com.squareup.javapoet.JavaFile;
 import com.squareup.javapoet.MethodSpec;
@@ -32,7 +31,6 @@
 import java.util.ArrayList;
 import java.util.Set;
 import javax.annotation.processing.ProcessingEnvironment;
-import javax.annotation.processing.Processor;
 import javax.annotation.processing.RoundEnvironment;
 import javax.annotation.processing.SupportedAnnotationTypes;
 import javax.annotation.processing.SupportedSourceVersion;
@@ -43,7 +41,6 @@
 import javax.lang.model.type.TypeMirror;
 import nil.nadph.qnotified.base.annotation.FunctionEntry;
 
-@AutoService(Processor.class)
 @SupportedAnnotationTypes("nil.nadph.qnotified.base.annotation.FunctionEntry")
 @SupportedSourceVersion(SourceVersion.RELEASE_8)
 public class FunctionItemProcessor extends BaseProcessor {

File: libs/compiler/src/main/java/me/singleneuron/qn_kernel/processors/UiDescriptionProcessor.java
Patch:
@@ -22,7 +22,6 @@
 
 package me.singleneuron.qn_kernel.processors;
 
-import com.google.auto.service.AutoService;
 import com.squareup.javapoet.*;
 
 import java.io.IOException;
@@ -39,7 +38,6 @@
 import cn.lliiooll.processors.BaseProcessor;
 import me.singleneuron.qn_kernel.annotation.UiItem;
 
-@AutoService(Processor.class)
 @SupportedAnnotationTypes("me.singleneuron.qn_kernel.annotation.UiItem")
 @SupportedSourceVersion(SourceVersion.RELEASE_8)
 public class UiDescriptionProcessor extends BaseProcessor {

File: app/src/main/java/com/rymmmmm/hook/BaseApk.java
Patch:
@@ -63,7 +63,6 @@ protected void afterHookedMethod(MethodHookParam param) throws Throwable {
                         try {
                             String fileName = (String) param.getResult();
                             String localFile = (String) param.args[0];
-                            Utils.logd("LocalFile=" + localFile + ",FileName=" + fileName);
                             if (fileName.equals("base.apk")) {
                                 PackageManager packageManager = HostInformationProviderKt
                                     .getHostInfo().getApplication().getPackageManager();
@@ -97,7 +96,7 @@ protected void afterHookedMethod(MethodHookParam param) throws Throwable {
             final Class<?> _ItemManagerClz = Initiator
                 .load("com.tencent.mobileqq.troop.utils.TroopFileTransferManager$Item");
             for (Method m : Initiator._TroopFileUploadMgr().getDeclaredMethods()) {
-                if (m.getName().equals("b") && !Modifier.isStatic(m.getModifiers()) && m
+                if (Modifier.isPrivate(m.getModifiers()) && !Modifier.isStatic(m.getModifiers()) && m
                     .getReturnType().equals(int.class)) {
                     Class<?>[] argt = m.getParameterTypes();
                     if (argt.length == 3 && argt[0] == long.class && argt[1] == _ItemManagerClz

File: app/src/main/java/com/rymmmmm/hook/BaseApk.java
Patch:
@@ -63,7 +63,6 @@ protected void afterHookedMethod(MethodHookParam param) throws Throwable {
                         try {
                             String fileName = (String) param.getResult();
                             String localFile = (String) param.args[0];
-                            Utils.logd("LocalFile=" + localFile + ",FileName=" + fileName);
                             if (fileName.equals("base.apk")) {
                                 PackageManager packageManager = HostInformationProviderKt
                                     .getHostInfo().getApplication().getPackageManager();
@@ -97,7 +96,7 @@ protected void afterHookedMethod(MethodHookParam param) throws Throwable {
             final Class<?> _ItemManagerClz = Initiator
                 .load("com.tencent.mobileqq.troop.utils.TroopFileTransferManager$Item");
             for (Method m : Initiator._TroopFileUploadMgr().getDeclaredMethods()) {
-                if (m.getName().equals("b") && !Modifier.isStatic(m.getModifiers()) && m
+                if (Modifier.isPrivate(m.getModifiers()) && !Modifier.isStatic(m.getModifiers()) && m
                     .getReturnType().equals(int.class)) {
                     Class<?>[] argt = m.getParameterTypes();
                     if (argt.length == 3 && argt[0] == long.class && argt[1] == _ItemManagerClz

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -426,8 +426,8 @@ public void onClick(View v) {
             clickToProxyActAction(EulaActivity.class)));
         ll.addView(newListItemButton(this, "展望未来", "其实都还没写", null,
             clickToProxyActAction(PendingFuncActivity.class)));
-        ll.addView(newListItemButton(this, getString(de.psdev.licensesdialog.R.string.notices_title)
-            , "感谢卖动绘制图标", null, clickToProxyActAction(LicenseActivity.class)));
+        ll.addView(newListItemButton(this, "开放源代码许可", "感谢卖动绘制图标",
+            null, clickToProxyActAction(LicenseActivity.class)));
         ll.addView(subtitle(this, "调试"));
         ll.addView(newListItemButton(this, "故障排查", null, null,
             clickToProxyActAction(TroubleshootActivity.class)));

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -426,8 +426,8 @@ public void onClick(View v) {
             clickToProxyActAction(EulaActivity.class)));
         ll.addView(newListItemButton(this, "展望未来", "其实都还没写", null,
             clickToProxyActAction(PendingFuncActivity.class)));
-        ll.addView(newListItemButton(this, getString(de.psdev.licensesdialog.R.string.notices_title)
-            , "感谢卖动绘制图标", null, clickToProxyActAction(LicenseActivity.class)));
+        ll.addView(newListItemButton(this, "开放源代码许可", "感谢卖动绘制图标",
+            null, clickToProxyActAction(LicenseActivity.class)));
         ll.addView(subtitle(this, "调试"));
         ll.addView(newListItemButton(this, "故障排查", null, null,
             clickToProxyActAction(TroubleshootActivity.class)));

File: app/src/main/java/me/zpp0196/qqpurify/fragment/base/AbstractPreferenceFragment.java
Patch:
@@ -130,7 +130,7 @@ private void bindPreferenceValue(Preference preference) {
             keyName = __[1];
         }
         AbstractConfigItem _item = P2CUtils.findConfigByName(cfgName);
-        if (_item == null || !_item.isValid() && (preference instanceof TwoStatePreference
+        if ((_item == null || !_item.isValid()) && (preference instanceof TwoStatePreference
             || preference instanceof ListPreference
             || preference instanceof MultiSelectListPreference
             || preference instanceof EditTextPreference)) {

File: app/src/main/java/me/zpp0196/qqpurify/fragment/base/AbstractPreferenceFragment.java
Patch:
@@ -130,7 +130,7 @@ private void bindPreferenceValue(Preference preference) {
             keyName = __[1];
         }
         AbstractConfigItem _item = P2CUtils.findConfigByName(cfgName);
-        if (_item == null || !_item.isValid() && (preference instanceof TwoStatePreference
+        if ((_item == null || !_item.isValid()) && (preference instanceof TwoStatePreference
             || preference instanceof ListPreference
             || preference instanceof MultiSelectListPreference
             || preference instanceof EditTextPreference)) {

File: app/src/main/java/nil/nadph/qnotified/ui/CustomDialog.java
Patch:
@@ -123,6 +123,7 @@ public static CustomDialog create(Context ctx) {
             ref.failsafe = true;
             ref.mBuilder = new AlertDialog.Builder(ctx,
                 ResUtils.isInNightMode() ? THEME_DARK : THEME_LIGHT);
+            ref.mBuilder.setMessage("");
         }
         return ref;
     }
@@ -136,6 +137,7 @@ public static CustomDialog createFailsafe(Context ctx) {
         ref.failsafe = true;
         ref.mBuilder = new AlertDialog.Builder(ctx,
             ResUtils.isInNightMode() ? THEME_DARK : THEME_LIGHT);
+        ref.mBuilder.setMessage("");
         return ref;
     }
 

File: app/src/main/java/nil/nadph/qnotified/ui/CustomDialog.java
Patch:
@@ -123,6 +123,7 @@ public static CustomDialog create(Context ctx) {
             ref.failsafe = true;
             ref.mBuilder = new AlertDialog.Builder(ctx,
                 ResUtils.isInNightMode() ? THEME_DARK : THEME_LIGHT);
+            ref.mBuilder.setMessage("");
         }
         return ref;
     }
@@ -136,6 +137,7 @@ public static CustomDialog createFailsafe(Context ctx) {
         ref.failsafe = true;
         ref.mBuilder = new AlertDialog.Builder(ctx,
             ResUtils.isInNightMode() ? THEME_DARK : THEME_LIGHT);
+        ref.mBuilder.setMessage("");
         return ref;
     }
 

File: app/src/main/java/nil/nadph/qnotified/util/TIMVersion.java
Patch:
@@ -59,4 +59,5 @@ public class TIMVersion {
     public static final long TIM_3_3_0 = 1090;
     public static final long TIM_3_3_1 = 1092;
     public static final long TIM_3_3_5 = 1102;
+    public static final long TIM_3_3_6 = 1110;
 }

File: app/src/main/java/nil/nadph/qnotified/util/Initiator.java
Patch:
@@ -360,8 +360,7 @@ public static Class _TextItemBuilder() {
     public static Class _TroopFileUploadMgr() {
         Class<?> ret, cref;
         for (String clzName : new String[]{
-            "com.tencent.mobileqq.troop.filemanager.upload.TroopFileUploadMgr",
-            "com.tencent.mobileqq.troop.filemanager.download.TroopFileDownloadMgr"}) {
+            "com.tencent.mobileqq.troop.filemanager.upload.TroopFileUploadMgr"}) {
             ret = load(clzName);
             if (ret != null) {
                 return ret;

File: app/src/main/java/nil/nadph/qnotified/util/Initiator.java
Patch:
@@ -360,8 +360,7 @@ public static Class _TextItemBuilder() {
     public static Class _TroopFileUploadMgr() {
         Class<?> ret, cref;
         for (String clzName : new String[]{
-            "com.tencent.mobileqq.troop.filemanager.upload.TroopFileUploadMgr",
-            "com.tencent.mobileqq.troop.filemanager.download.TroopFileDownloadMgr"}) {
+            "com.tencent.mobileqq.troop.filemanager.upload.TroopFileUploadMgr"}) {
             ret = load(clzName);
             if (ret != null) {
                 return ret;

File: app/src/main/java/cc/ioctl/hook/JumpController.java
Patch:
@@ -39,6 +39,7 @@
 import java.util.ArrayList;
 import java.util.regex.Pattern;
 import me.singleneuron.qn_kernel.data.HostInformationProviderKt;
+import nil.nadph.qnotified.SyncUtils;
 import nil.nadph.qnotified.base.annotation.FunctionEntry;
 import nil.nadph.qnotified.config.ConfigManager;
 import nil.nadph.qnotified.hook.CommonDelayableHook;
@@ -67,7 +68,7 @@ public class JumpController extends CommonDelayableHook {
     private ArrayList<Rule> rules = null;
 
     protected JumpController() {
-        super("qn_jmp_ctl_enable");
+        super("qn_jmp_ctl_enable", SyncUtils.PROC_MAIN, true);
     }
 
     public static ArrayList<Rule> parseRules(String rules) throws ParseException {

File: app/src/main/java/cc/ioctl/hook/JumpController.java
Patch:
@@ -54,7 +54,8 @@ public class JumpController extends CommonDelayableHook {
 
     public static final String DEFAULT_RULES = "A,P:me.singleneuron.locknotification;\n" +
         "A,P:cn.nexus6p.QQMusicNotify;\n" +
-        "A,A:android.media.action.VIDEO_CAPTURE;\n";
+        "A,A:android.media.action.VIDEO_CAPTURE;\n" +
+        "A,P:nil.nadph.qnotified;\n";
     public static final int JMP_DEFAULT = 0;
     public static final int JMP_ALLOW = 1;
     public static final int JMP_REJECT = 2;

File: app/src/main/java/nil/nadph/qnotified/util/Initiator.java
Patch:
@@ -26,7 +26,6 @@
 
 import android.os.Parcelable;
 
-import me.singleneuron.qn_kernel.data.HostInformationProvider;
 import me.singleneuron.qn_kernel.data.HostInformationProviderKt;
 import me.singleneuron.util.QQVersion;
 import mqq.app.AppRuntime;

File: app/src/main/java/nil/nadph/qnotified/util/Initiator.java
Patch:
@@ -26,7 +26,6 @@
 
 import android.os.Parcelable;
 
-import me.singleneuron.qn_kernel.data.HostInformationProvider;
 import me.singleneuron.qn_kernel.data.HostInformationProviderKt;
 import me.singleneuron.util.QQVersion;
 import mqq.app.AppRuntime;

File: app/src/main/java/me/zpp0196/qqpurify/fragment/base/AbstractPreferenceFragment.java
Patch:
@@ -130,7 +130,7 @@ private void bindPreferenceValue(Preference preference) {
             keyName = __[1];
         }
         AbstractConfigItem _item = P2CUtils.findConfigByName(cfgName);
-        if (_item == null && (preference instanceof TwoStatePreference
+        if (_item == null || !_item.isValid() && (preference instanceof TwoStatePreference
             || preference instanceof ListPreference
             || preference instanceof MultiSelectListPreference
             || preference instanceof EditTextPreference)) {

File: app/src/main/java/nil/nadph/qnotified/util/Initiator.java
Patch:
@@ -88,6 +88,7 @@ public static Class _QbossADImmersionBannerManager() {
                     tmp = load("cooperation.vip.qqbanner.QbossADImmersionBannerManager$2");
                 }
                 mQbossADImmersionBannerManager = tmp.getDeclaredField("this$0").getType();
+                return mQbossADImmersionBannerManager;
             } catch (Exception ignored) {
             }
         }
@@ -100,6 +101,7 @@ public static Class _QbossADImmersionBannerManager() {
                     tmp = load("cooperation.vip.qqbanner.manager.VasADImmersionBannerManager$2");
                 }
                 mQbossADImmersionBannerManager = tmp.getDeclaredField("this$0").getType();
+                return mQbossADImmersionBannerManager;
             } catch (Exception ignored) {
             }
         }
@@ -112,6 +114,7 @@ public static Class _QbossADImmersionBannerManager() {
                     tmp = load("cooperation.vip.qqbanner.manager.VasADImmersionBannerManager$2");
                 }
                 mQbossADImmersionBannerManager = tmp.getDeclaredField("this$0").getType();
+                return mQbossADImmersionBannerManager;
             } catch (Exception ignored) {
             }
         }

File: app/src/main/java/nil/nadph/qnotified/bridge/SessionInfoImpl.java
Patch:
@@ -44,7 +44,7 @@ public static Parcelable createSessionInfo(String uin, int uinType) {
         Parcelable ret = null;
         try {
             Class<?> clSessionInfo = Initiator._SessionInfo();
-            Constructor<?> c = clSessionInfo.getConstructor(Parcel.class);
+            Constructor<?> c = clSessionInfo.getDeclaredConstructor(Parcel.class);
             c.setAccessible(true);
             ret = (Parcelable) c.newInstance(parcel);
         } catch (Exception e) {

File: app/src/main/java/nil/nadph/qnotified/activity/BetaTestFuncActivity.java
Patch:
@@ -94,7 +94,7 @@ public boolean doOnCreate(Bundle bundle) {
         ll.addView(_t = newListItemButton(this, "自定义聊天小尾巴", "回车发送不生效", "N/A",
             clickToProxyActAction(ChatTailActivity.class)));
         __tv_chat_tail_status = _t.findViewById(R_ID_VALUE);
-        ll.addView(newListItemHookSwitchInit(this, "屏蔽戳一戳", "OvO", MutePokePacket.get()));
+        ll.addView(newListItemHookSwitchInit(this, "屏蔽戳一戳", "OvO", MutePokePacket.INSTANCE));
         ll.addView(newListItemHookSwitchInit(this, "在LogCat输出所有接收的消息", "[Debug]无关人士请不要打开 没有任何作用",
             CutMessage.INSTANCE));
         ViewGroup __t;

File: app/src/main/java/nil/nadph/qnotified/util/Initiator.java
Patch:
@@ -338,7 +338,8 @@ public static Class _TextItemBuilder() {
     public static Class _TroopFileUploadMgr() {
         Class<?> ret, cref;
         for (String clzName : new String[]{
-            "com.tencent.mobileqq.troop.filemanager.upload.TroopFileUploadMgr"}) {
+            "com.tencent.mobileqq.troop.filemanager.upload.TroopFileUploadMgr",
+            "com.tencent.mobileqq.troop.filemanager.download.TroopFileDownloadMgr"}) {
             ret = load(clzName);
             if (ret != null) {
                 return ret;

File: app/src/main/java/nil/nadph/qnotified/util/DexKit.java
Patch:
@@ -598,7 +598,9 @@ public static byte[][] b(int i) {
             case N_BASE_CHAT_PIE__INIT:
                 return new byte[][]{
                     new byte[]{0x0F, 0x69, 0x6E, 0x70, 0x75, 0x74, 0x20, 0x73, 0x65, 0x74, 0x20,
-                        0x65, 0x72, 0x72, 0x6F, 0x72}};
+                        0x65, 0x72, 0x72, 0x6F, 0x72},
+                    new byte[]{0x13, 0x2C, 0x20, 0x6D, 0x44, 0x65, 0x66, 0x61, 0x75, 0x74, 0x6C,
+                        0x42, 0x74, 0x6E, 0x4C, 0x65, 0x66, 0x74, 0x3A, 0x20}};
             case N_BASE_CHAT_PIE__handleNightMask:
                 return new byte[][]{
                     new byte[]{0x2D, 0x23, 0x68, 0x61, 0x6E, 0x64, 0x6C, 0x65, 0x4E, 0x69, 0x67,

File: app/src/main/java/nil/nadph/qnotified/ui/ResUtils.java
Patch:
@@ -21,6 +21,7 @@
  */
 package nil.nadph.qnotified.ui;
 
+import static nil.nadph.qnotified.util.Initiator._ThemeUtil;
 import static nil.nadph.qnotified.util.Initiator.load;
 import static nil.nadph.qnotified.util.ReflexUtil.iget_object_or_null;
 import static nil.nadph.qnotified.util.ReflexUtil.invoke_static;
@@ -87,7 +88,7 @@ public static void requireResourcesNonNull(Context ctx) {
 
     public static void initTheme(Context ctx) {
         try {
-            String themeId = (String) invoke_static(load("com/tencent/mobileqq/theme/ThemeUtil"),
+            String themeId = (String) invoke_static(_ThemeUtil(),
                 "getUserCurrentThemeId", null, load("mqq/app/AppRuntime"));
             if (themeId.equals(cachedThemeId)) {
                 return;
@@ -371,7 +372,7 @@ public static ColorStateList cloneColor(ColorStateList color) {
 
     public static boolean isInNightMode() {
         try {
-            String themeId = (String) invoke_static(load("com/tencent/mobileqq/theme/ThemeUtil"),
+            String themeId = (String) invoke_static(_ThemeUtil(),
                 "getUserCurrentThemeId", getAppRuntime(), load("mqq/app/AppRuntime"));
             return "1103".endsWith(themeId) || "2920".endsWith(themeId);
         } catch (Exception e) {

File: app/src/main/java/nil/nadph/qnotified/util/SavedInstanceStatePatchedClassReferencer.java
Patch:
@@ -32,7 +32,7 @@ public class SavedInstanceStatePatchedClassReferencer extends ClassLoader {
     private static final ClassLoader mBootstrap = Context.class.getClassLoader();
 
     public SavedInstanceStatePatchedClassReferencer(ClassLoader referencer) {
-        super(null);
+        super(mBootstrap);
         mBaseReferencer = Objects.requireNonNull(referencer);
         mHostReferencer = Initiator.getHostClassLoader();
     }

File: app/src/main/java/nil/nadph/qnotified/util/SavedInstanceStatePatchedClassReferencer.java
Patch:
@@ -32,7 +32,7 @@ public class SavedInstanceStatePatchedClassReferencer extends ClassLoader {
     private static final ClassLoader mBootstrap = Context.class.getClassLoader();
 
     public SavedInstanceStatePatchedClassReferencer(ClassLoader referencer) {
-        super(null);
+        super(mBootstrap);
         mBaseReferencer = Objects.requireNonNull(referencer);
         mHostReferencer = Initiator.getHostClassLoader();
     }

File: app/src/main/java/cc/ioctl/hook/$endGiftHook.java
Patch:
@@ -32,9 +32,9 @@
 import nil.nadph.qnotified.hook.CommonDelayableHook;
 import nil.nadph.qnotified.step.DexDeobfStep;
 import nil.nadph.qnotified.util.DexKit;
+import nil.nadph.qnotified.util.Initiator;
 import nil.nadph.qnotified.util.LicenseStatus;
 
-import static nil.nadph.qnotified.util.Initiator.load;
 import static nil.nadph.qnotified.util.Utils.log;
 
 @FunctionEntry
@@ -52,7 +52,7 @@ public class $endGiftHook extends CommonDelayableHook {
     @Override
     public boolean initOnce() {
         try {
-            Method m = DexKit.doFindClass(DexKit.C_TROOP_GIFT_UTIL).getDeclaredMethod("a", Activity.class, String.class, String.class, load("com/tencent/mobileqq/app/QQAppInterface"));
+            Method m = DexKit.doFindClass(DexKit.C_TROOP_GIFT_UTIL).getDeclaredMethod("a", Activity.class, String.class, String.class, Initiator._QQAppInterface());
             XposedBridge.hookMethod(m, new XC_MethodHook(47) {
                 @Override
                 protected void beforeHookedMethod(MethodHookParam param) throws Throwable {

File: app/src/main/java/cc/ioctl/hook/CardMsgHook.java
Patch:
@@ -23,8 +23,7 @@
 
 import android.os.Parcelable;
 
-import com.tencent.mobileqq.app.QQAppInterface;
-
+import mqq.app.AppRuntime;
 import nil.nadph.qnotified.base.annotation.FunctionEntry;
 import nil.nadph.qnotified.hook.CommonDelayableHook;
 import nil.nadph.qnotified.step.DexDeobfStep;
@@ -50,7 +49,7 @@ public boolean initOnce() {
     }
 
     @SuppressWarnings("JavaJniMissingFunction")
-    static native boolean ntSendCardMsg(QQAppInterface rt, Parcelable session, String msg) throws Exception;
+    static native boolean ntSendCardMsg(AppRuntime rt, Parcelable session, String msg) throws Exception;
 
     @Override
     public Step[] getPreconditions() {

File: app/src/main/java/cc/ioctl/hook/InputButtonHook.java
Patch:
@@ -35,8 +35,6 @@
 import android.widget.TextView;
 import android.widget.Toast;
 
-import com.tencent.mobileqq.app.QQAppInterface;
-
 import java.lang.reflect.Array;
 import java.lang.reflect.InvocationTargetException;
 import java.lang.reflect.Method;
@@ -48,6 +46,7 @@
 import me.singleneuron.hook.CopyCardMsg;
 import cc.ioctl.activity.ChatTailActivity;
 import cc.ioctl.dialog.RikkaCustomMsgTimeFormatDialog;
+import mqq.app.AppRuntime;
 import nil.nadph.qnotified.base.annotation.FunctionEntry;
 import nil.nadph.qnotified.hook.CommonDelayableHook;
 import nil.nadph.qnotified.util.Initiator;
@@ -102,7 +101,7 @@ public void afterHookedMethod(MethodHookParam param) throws Throwable {
                         Context ctx = aioRootView.getContext();
                         int fun_btn = ctx.getResources().getIdentifier("fun_btn", "id", ctx.getPackageName());
                         View sendBtn = aioRootView.findViewById(fun_btn);
-                        final QQAppInterface qqApp = getFirstNSFByType(param.thisObject, QQAppInterface.class);
+                        final AppRuntime qqApp = getFirstNSFByType(param.thisObject, Initiator._QQAppInterface());
                         final Parcelable session = getFirstNSFByType(param.thisObject, _SessionInfo());
                         if (!sendBtn.getParent().getClass().getName().equals(InterceptLayout.class.getName())) {
                             InterceptLayout layout = InterceptLayout.setupRudely(sendBtn);

File: app/src/main/java/cc/ioctl/util/SendBatchMsg.java
Patch:
@@ -34,12 +34,11 @@
 import android.view.ViewGroup;
 import android.widget.*;
 
-import com.tencent.mobileqq.app.QQAppInterface;
-
 import java.lang.reflect.Field;
 import java.util.ArrayList;
 import java.util.HashSet;
 
+import mqq.app.AppRuntime;
 import nil.nadph.qnotified.ExfriendManager;
 import nil.nadph.qnotified.activity.TroopSelectActivity;
 import nil.nadph.qnotified.util.CliOper;
@@ -197,7 +196,7 @@ public void run() {
     }
 
     @SuppressWarnings("JavaJniMissingFunction")
-    static native boolean ntSendBatchMessages(QQAppInterface rt, Context ctx, String msg, int[] type, long[] uin);
+    static native boolean ntSendBatchMessages(AppRuntime rt, Context ctx, String msg, int[] type, long[] uin);
 
     private static View getListView(Context context, String sendMsg,
                                     final TroopAndFriendSelectAdpter troopAndFriendSelectAdpter) {

File: app/src/main/java/nil/nadph/qnotified/util/FaceImpl.java
Patch:
@@ -63,7 +63,7 @@ private FaceImpl() throws Throwable {
             Field[] fs = cl_rxMsg.getDeclaredFields();
             for (Field f : fs) {
                 if (f.getType().equals(View.class)) continue;
-                if (f.getType().equals(load("com/tencent/mobileqq/app/QQAppInterface"))) continue;
+                if (f.getType().equals(Initiator._QQAppInterface())) continue;
                 class_FaceDecoder = f.getType();
             }
         }

File: app/src/main/java/cc/ioctl/util/SendBatchMsg.java
Patch:
@@ -196,6 +196,7 @@ public void run() {
         }, 1000);
     }
 
+    @SuppressWarnings("JavaJniMissingFunction")
     static native boolean ntSendBatchMessages(QQAppInterface rt, Context ctx, String msg, int[] type, long[] uin);
 
     private static View getListView(Context context, String sendMsg,

File: app/src/main/java/nil/nadph/qnotified/mvc/base/AbsConfigSection.java
Patch:
@@ -81,5 +81,6 @@ public interface AbsConfigSection {
      * @param data        An Intent, which can return result data to the caller
      *                    (various data can be attached to Intent "extras").
      */
+    @SuppressWarnings("JavadocReference")
     void onActivityResult(@NonNull SharedUiProvider ui, int requestCode, int resultCode, Intent data);
 }

File: app/src/main/java/cc/ioctl/util/SendBatchMsg.java
Patch:
@@ -196,6 +196,7 @@ public void run() {
         }, 1000);
     }
 
+    @SuppressWarnings("JavaJniMissingFunction")
     static native boolean ntSendBatchMessages(QQAppInterface rt, Context ctx, String msg, int[] type, long[] uin);
 
     private static View getListView(Context context, String sendMsg,

File: app/src/main/java/nil/nadph/qnotified/mvc/base/AbsConfigSection.java
Patch:
@@ -81,5 +81,6 @@ public interface AbsConfigSection {
      * @param data        An Intent, which can return result data to the caller
      *                    (various data can be attached to Intent "extras").
      */
+    @SuppressWarnings("JavadocReference")
     void onActivityResult(@NonNull SharedUiProvider ui, int requestCode, int resultCode, Intent data);
 }

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -228,14 +228,14 @@ public boolean onLongClick(View v) {
         ll.addView(newListItemButton(this, "修改侧滑边距", "感谢祈无，支持8.4.1及更高，重启后生效", "", clickToProxyActAction(ChangeDrawerWidthActivity.class)));
         ll.addView(newListItemHookSwitchInit(this, "屏蔽QQ空间滑动相机", null, DisableQzoneSlideCamera.INSTANCE));
         ll.addView(newListItemHookSwitchInit(this, "回执消息文本化", null, SimpleReceiptMessage.INSTANCE));
-        ll.addView(newListItemButtonIfValid(this, "屏蔽指定类型消息", null, null, AntiMessage.INSTANCE));
+        ll.addView(newListItemButtonIfValid(this, "静默指定类型消息通知", null, null, AntiMessage.INSTANCE));
         ll.addView(newListItemButtonIfValid(this, "聊天字数统计", null, null, ChatWordsCount.INSTANCE, v -> ChatWordsCount.INSTANCE.showChatWordsCountDialog(this)));
         ll.addView(newListItemButtonIfValid(this, "精简聊天气泡长按菜单", null, null, SimplifyChatLongItem.INSTANCE, SimplifyChatLongItem.INSTANCE.listener()));
         ll.addView(newListItemButtonIfValid(this, "精简加号菜单", null, null, SimplifyPlusPanel.INSTANCE));
         ll.addView(newListItemButtonIfValid(this, "精简设置菜单", null, null, SimplifyQQSettings.INSTANCE));
         ll.addView(newListItemButtonIfValid(this, "精简联系人页面", null, null, SimplifyContactTabs.INSTANCE));
         ll.addView(newListItemHookSwitchInit(this, "聊天自动发送原图", null, AutoSendOriginalPhoto.INSTANCE));
-        ll.addView(newListItemHookSwitchInit(this, "聊天自动接收原图", null, AutoReceiveOriginalPhoto.INSTANCE));
+        ll.addView(newListItemConfigSwitchIfValid(this, "聊天自动接收原图", null, AutoReceiveOriginalPhoto.INSTANCE));
         ll.addView(newListItemHookSwitchInit(this, "批量撤回消息", "多选消息后撤回", MultiActionHook.INSTANCE));
         ll.addView(newListItemButtonIfValid(this, "修改消息左滑动作", null, null, LeftSwipeReplyHook.INSTANCE, ModifyLeftSwipeReplyActivity.class));
         ll.addView(newListItemConfigSwitchIfValid(this, "修改@界面排序", "排序由群主管理员至正常人员", SortAtPanel.INSTANCE));

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -235,7 +235,7 @@ public boolean onLongClick(View v) {
         ll.addView(newListItemButtonIfValid(this, "精简设置菜单", null, null, SimplifyQQSettings.INSTANCE));
         ll.addView(newListItemButtonIfValid(this, "精简联系人页面", null, null, SimplifyContactTabs.INSTANCE));
         ll.addView(newListItemHookSwitchInit(this, "聊天自动发送原图", null, AutoSendOriginalPhoto.INSTANCE));
-        ll.addView(newListItemHookSwitchInit(this, "聊天自动接收原图", null, AutoReceiveOriginalPhoto.INSTANCE));
+        ll.addView(newListItemConfigSwitchIfValid(this, "聊天自动接收原图", null, AutoReceiveOriginalPhoto.INSTANCE));
         ll.addView(newListItemHookSwitchInit(this, "批量撤回消息", "多选消息后撤回", MultiActionHook.INSTANCE));
         ll.addView(newListItemButtonIfValid(this, "修改消息左滑动作", null, null, LeftSwipeReplyHook.INSTANCE, ModifyLeftSwipeReplyActivity.class));
         ll.addView(newListItemConfigSwitchIfValid(this, "修改@界面排序", "排序由群主管理员至正常人员", SortAtPanel.INSTANCE));

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -233,9 +233,9 @@ public boolean onLongClick(View v) {
         ll.addView(newListItemButtonIfValid(this, "精简加号菜单", null, null, SimplifyPlusPanel.INSTANCE));
         ll.addView(newListItemButtonIfValid(this, "精简设置菜单", null, null, SimplifyQQSettings.INSTANCE));
         ll.addView(newListItemHookSwitchInit(this, "批量撤回消息", "多选消息后撤回", MultiActionHook.INSTANCE));
-        ll.addView(newListItemButtonIfValid(this, "修改消息左滑动作", "", null, LeftSwipeReplyHook.INSTANCE, ModifyLeftSwipeReplyActivity.class));
+        ll.addView(newListItemButtonIfValid(this, "修改消息左滑动作", null, null, LeftSwipeReplyHook.INSTANCE, ModifyLeftSwipeReplyActivity.class));
         ll.addView(newListItemConfigSwitchIfValid(this, "修改@界面排序", "排序由群主管理员至正常人员", SortAtPanel.INSTANCE));
-        ll.addView(newListItemConfigSwitchIfValid(this, "发送收藏消息添加分组", "", SendFavoriteHook.INSTANCE));
+        ll.addView(newListItemConfigSwitchIfValid(this, "发送收藏消息添加分组", null, SendFavoriteHook.INSTANCE));
         ll.addView(subtitle(this, "好友列表"));
         ll.addView(newListItemButton(this, "打开资料卡", "打开指定用户的资料卡", null, new View.OnClickListener() {
             @Override

File: app/src/main/java/nil/nadph/qnotified/startup/HookEntry.java
Patch:
@@ -23,6 +23,7 @@
 import de.robv.android.xposed.XposedBridge;
 import de.robv.android.xposed.XposedHelpers;
 import de.robv.android.xposed.callbacks.XC_LoadPackage;
+import me.singleneuron.util.HookStatue;
 import nil.nadph.qnotified.R;
 
 /**
@@ -51,7 +52,7 @@ public void handleLoadPackage(final XC_LoadPackage.LoadPackageParam lpparam) thr
         }
         switch (lpparam.packageName) {
             case PACKAGE_NAME_SELF: {
-                XposedHelpers.findAndHookMethod("nil.nadph.qnotified.util.Utils", lpparam.classLoader, "isModuleEnable", XC_MethodReplacement.returnConstant(true));
+                XposedHelpers.findAndHookMethod(HookStatue.class.getName(), lpparam.classLoader, "isEnabled", XC_MethodReplacement.returnConstant(true));
                 break;
             }
             case PACKAGE_NAME_TIM:

File: app/src/main/java/nil/nadph/qnotified/startup/HookEntry.java
Patch:
@@ -23,6 +23,7 @@
 import de.robv.android.xposed.XposedBridge;
 import de.robv.android.xposed.XposedHelpers;
 import de.robv.android.xposed.callbacks.XC_LoadPackage;
+import me.singleneuron.util.HookStatue;
 import nil.nadph.qnotified.R;
 
 /**
@@ -51,7 +52,7 @@ public void handleLoadPackage(final XC_LoadPackage.LoadPackageParam lpparam) thr
         }
         switch (lpparam.packageName) {
             case PACKAGE_NAME_SELF: {
-                XposedHelpers.findAndHookMethod("nil.nadph.qnotified.util.Utils", lpparam.classLoader, "isModuleEnable", XC_MethodReplacement.returnConstant(true));
+                XposedHelpers.findAndHookMethod(HookStatue.class.getName(), lpparam.classLoader, "isEnabled", XC_MethodReplacement.returnConstant(true));
                 break;
             }
             case PACKAGE_NAME_TIM:

File: app/src/main/java/nil/nadph/qnotified/ExfriendManager.java
Patch:
@@ -55,7 +55,6 @@
 import nil.nadph.qnotified.util.*;
 
 import static nil.nadph.qnotified.config.Table.*;
-import static nil.nadph.qnotified.lifecycle.ActProxyMgr.ACTIVITY_PROXY_ACTION;
 import static nil.nadph.qnotified.util.Initiator.load;
 import static nil.nadph.qnotified.util.ReflexUtil.invoke_virtual;
 import static nil.nadph.qnotified.util.ReflexUtil.invoke_virtual_any;
@@ -694,7 +693,6 @@ public void doNotifyDelFlAndSave(Object[] ptr) {
         try {
             if (isNotifyWhenDeleted() && ((int) ptr[0]) > 0) {
                 Intent inner = new Intent(HostInformationProviderKt.getHostInformationProvider().getApplicationContext(), ExfriendListActivity.class);
-                inner.putExtra(ACTIVITY_PROXY_ACTION, ExfriendListActivity.class);
                 Intent wrapper = new Intent();
                 wrapper.setClassName(HostInformationProviderKt.getHostInformationProvider().getApplicationContext().getPackageName(), ActProxyMgr.STUB_DEFAULT_ACTIVITY);
                 wrapper.putExtra(ActProxyMgr.ACTIVITY_PROXY_INTENT, inner);

File: app/src/main/java/nil/nadph/qnotified/activity/TroubleshootActivity.java
Patch:
@@ -73,7 +73,6 @@
 
 import static android.view.ViewGroup.LayoutParams.MATCH_PARENT;
 import static android.view.ViewGroup.LayoutParams.WRAP_CONTENT;
-import static nil.nadph.qnotified.lifecycle.ActProxyMgr.ACTIVITY_PROXY_ACTION;
 import static nil.nadph.qnotified.util.ReflexUtil.iget_object_or_null;
 import static nil.nadph.qnotified.util.ReflexUtil.iput_object;
 import static nil.nadph.qnotified.ui.ViewBuilder.*;
@@ -227,7 +226,6 @@ public void onClick(View v) {
             public void onClick(View v) {
                 try {
                     Intent inner = new Intent(getApplication(), ExfriendListActivity.class);
-                    inner.putExtra(ACTIVITY_PROXY_ACTION, ExfriendListActivity.class);
                     Intent wrapper = new Intent();
                     wrapper.setClassName(getApplication().getPackageName(), ActProxyMgr.STUB_DEFAULT_ACTIVITY);
                     wrapper.putExtra(ActProxyMgr.ACTIVITY_PROXY_INTENT, inner);

File: app/src/main/java/nil/nadph/qnotified/hook/DelDetectorHook.java
Patch:
@@ -49,7 +49,6 @@
 import static android.widget.LinearLayout.LayoutParams.MATCH_PARENT;
 import static android.widget.LinearLayout.LayoutParams.WRAP_CONTENT;
 import static de.robv.android.xposed.XposedHelpers.findAndHookMethod;
-import static nil.nadph.qnotified.lifecycle.ActProxyMgr.ACTIVITY_PROXY_ACTION;
 import static nil.nadph.qnotified.util.Initiator.load;
 import static nil.nadph.qnotified.util.ReflexUtil.*;
 import static nil.nadph.qnotified.util.Utils.*;
@@ -140,7 +139,6 @@ protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
                     public void onClick(View v) {
                         if (LicenseStatus.sDisableCommonHooks) return;
                         Intent intent = new Intent(splashActivity, ExfriendListActivity.class);
-                        intent.putExtra(ACTIVITY_PROXY_ACTION, ExfriendListActivity.class);
                         splashActivity.startActivity(intent);
                     }
                 });

File: app/src/main/java/nil/nadph/qnotified/HookEntry.java
Patch:
@@ -65,7 +65,7 @@ public void handleLoadPackage(final XC_LoadPackage.LoadPackageParam lpparam) thr
                 //coming...
                 break;
             default:
-                throw new IllegalStateException("Unexpected package: " + lpparam.packageName);
+                break;
         }
     }
 

File: app/src/main/java/nil/nadph/qnotified/HookEntry.java
Patch:
@@ -65,7 +65,7 @@ public void handleLoadPackage(final XC_LoadPackage.LoadPackageParam lpparam) thr
                 //coming...
                 break;
             default:
-                throw new IllegalStateException("Unexpected package: " + lpparam.packageName);
+                break;
         }
     }
 

File: app/src/main/java/me/ketal/hook/MultiActionHook.java
Patch:
@@ -133,6 +133,7 @@ private void setMargin(LinearLayout rootView) {
 
     private boolean check(LinearLayout rootView) {
         int count = rootView.getChildCount();
+        if (count == 1) return false;
         for (int i = 0; i < count; i++) {
             View view = rootView.getChildAt(i);
             if (view instanceof TextView)

File: app/src/main/java/me/ketal/hook/MultiActionHook.java
Patch:
@@ -133,6 +133,7 @@ private void setMargin(LinearLayout rootView) {
 
     private boolean check(LinearLayout rootView) {
         int count = rootView.getChildCount();
+        if (count == 1) return false;
         for (int i = 0; i < count; i++) {
             View view = rootView.getChildAt(i);
             if (view instanceof TextView)

File: app/src/main/java/nil/nadph/qnotified/util/Utils.java
Patch:
@@ -103,7 +103,7 @@ public static void runOnUiThread(Runnable r) {
     }
 
     /**
-     * NOTICE: This only works if this module is running in the host process, if not {@code null} will be teturned.
+     * NOTICE: This only works if this module is running in the host process, if not {@code null} will be returned.
      *
      * @return host application
      */

File: app/src/main/java/nil/nadph/qnotified/NativeHookCallback.java
Patch:
@@ -21,6 +21,7 @@
 import de.robv.android.xposed.XC_MethodHook;
 import nil.nadph.qnotified.util.NonNull;
 
+@SuppressWarnings("JavaJniMissingFunction")
 public final class NativeHookCallback extends XC_MethodHook {
     public final long a;
 

File: app/src/main/java/nil/nadph/qnotified/activity/ChatTailActivity.java
Patch:
@@ -207,7 +207,7 @@ private EditText createEditText(int id, int _5dp, String text, String hint) {
         return pct;
     }
 
-    private class BatteryReceiver extends BroadcastReceiver {
+    private static class BatteryReceiver extends BroadcastReceiver {
         @Override
         public void onReceive(Context context, Intent intent) {
             String action = intent.getAction();

File: app/src/main/java/nil/nadph/qnotified/hook/CardMsgHook.java
Patch:
@@ -302,6 +302,7 @@ protected void beforeHookedMethod(XC_MethodHook.MethodHookParam param) throws Th
 
 
      */
+    @SuppressWarnings("JavaJniMissingFunction")
     static native boolean ntSendCardMsg(QQAppInterface rt, Parcelable session, String msg) throws Exception;
 
     @Override

File: app/src/main/java/nil/nadph/qnotified/util/Utils.java
Patch:
@@ -2055,6 +2055,7 @@ public String getId() {
 
     }
 
+    @SuppressWarnings("JavaJniMissingFunction")
     private static native long ntGetBuildTimestamp();
 
     public static long getBuildTimestamp() {

File: app/src/main/java/nil/nadph/qnotified/NativeHookCallback.java
Patch:
@@ -21,6 +21,7 @@
 import de.robv.android.xposed.XC_MethodHook;
 import nil.nadph.qnotified.util.NonNull;
 
+@SuppressWarnings("JavaJniMissingFunction")
 public final class NativeHookCallback extends XC_MethodHook {
     public final long a;
 

File: app/src/main/java/nil/nadph/qnotified/activity/ChatTailActivity.java
Patch:
@@ -207,7 +207,7 @@ private EditText createEditText(int id, int _5dp, String text, String hint) {
         return pct;
     }
 
-    private class BatteryReceiver extends BroadcastReceiver {
+    private static class BatteryReceiver extends BroadcastReceiver {
         @Override
         public void onReceive(Context context, Intent intent) {
             String action = intent.getAction();

File: app/src/main/java/nil/nadph/qnotified/hook/CardMsgHook.java
Patch:
@@ -302,6 +302,7 @@ protected void beforeHookedMethod(XC_MethodHook.MethodHookParam param) throws Th
 
 
      */
+    @SuppressWarnings("JavaJniMissingFunction")
     static native boolean ntSendCardMsg(QQAppInterface rt, Parcelable session, String msg) throws Exception;
 
     @Override

File: app/src/main/java/nil/nadph/qnotified/util/Utils.java
Patch:
@@ -2055,6 +2055,7 @@ public String getId() {
 
     }
 
+    @SuppressWarnings("JavaJniMissingFunction")
     private static native long ntGetBuildTimestamp();
 
     public static long getBuildTimestamp() {

File: app/src/main/java/me/singleneuron/util/QQVersion.java
Patch:
@@ -12,7 +12,8 @@ public class QQVersion {
     public static final long QQ_8_1_8 = 1276;
     public static final long QQ_8_2_0 = 1296;
     public static final long QQ_8_2_6 = 1320;
-    public static final long QQ_8_2_7 = 1334;
+    public static final long QQ_8_2_7 = 1328;
+    public static final long QQ_8_2_7_2 = 1334;
     public static final long QQ_8_2_8 = 1346;
     public static final long QQ_8_2_9 = 1352;
     public static final long QQ_8_2_10 = 1354;

File: app/src/main/java/nil/nadph/qnotified/MainHook.java
Patch:
@@ -52,6 +52,7 @@
 import de.robv.android.xposed.XposedBridge;
 import me.kyuubiran.hook.RemoveCameraButton;
 import me.kyuubiran.hook.RemoveRedDot;
+import me.singleneuron.qn_kernel.tlb.ConfigTable;
 import nil.nadph.qnotified.activity.SettingsActivity;
 import nil.nadph.qnotified.config.ConfigItems;
 import nil.nadph.qnotified.config.ConfigManager;
@@ -284,6 +285,7 @@ protected void afterHookedMethod(MethodHookParam param) throws Throwable {
     }
 
     public void performHook(Context ctx, Object step) {
+        ConfigTable.INSTANCE.setTim(isTim(ctx));
         SyncUtils.initBroadcast(ctx);
 //        if (SyncUtils.getProcessType() == SyncUtils.PROC_MSF) {
 //            Debug.waitForDebugger();

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -208,9 +208,7 @@ public boolean onLongClick(View v) {
         addViewConditionally(ll, newListItemButton(this, "修改侧滑边距", "感谢祈无，支持8.4.1及更高，重启后生效", "", clickToProxyActAction(ChangeDrawerWidthActivity.class)), ChangeDrawerWidth.INSTANCE.getCondition());
         ll.addView(newListItemHookSwitchInit(this, "屏蔽QQ空间滑动相机", null, DisableQzoneSlideCamera.INSTANCE));
         ll.addView(newListItemHookSwitchInit(this, "回执消息文本化", null, SimpleReceiptMessage.INSTANCE));
-        if (!Utils.isTim(this)) {
-            ll.addView(newListItemHookSwitchInit(this, "批量撤回消息", "多选消息后撤回", MultiActionHook.get()));
-        }
+        ll.addView(newListItemHookSwitchInit(this, "批量撤回消息", "多选消息后撤回", MultiActionHook.get()));
 
         ll.addView(subtitle(this, "好友列表"));
         ll.addView(newListItemButton(this, "打开资料卡", "打开指定用户的资料卡", null, new View.OnClickListener() {

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -208,7 +208,9 @@ public boolean onLongClick(View v) {
         addViewConditionally(ll, newListItemButton(this, "修改侧滑边距", "感谢祈无，支持8.4.1及更高，重启后生效", "", clickToProxyActAction(ChangeDrawerWidthActivity.class)), ChangeDrawerWidth.INSTANCE.getCondition());
         ll.addView(newListItemHookSwitchInit(this, "屏蔽QQ空间滑动相机", null, DisableQzoneSlideCamera.INSTANCE));
         ll.addView(newListItemHookSwitchInit(this, "回执消息文本化", null, SimpleReceiptMessage.INSTANCE));
-        ll.addView(newListItemHookSwitchInit(this,"批量撤回消息","多选消息后撤回", MultiActionHook.get()));
+        if (!Utils.isTim(this)) {
+            ll.addView(newListItemHookSwitchInit(this, "批量撤回消息", "多选消息后撤回", MultiActionHook.get()));
+        }
 
         ll.addView(subtitle(this, "好友列表"));
         ll.addView(newListItemButton(this, "打开资料卡", "打开指定用户的资料卡", null, new View.OnClickListener() {

File: app/src/main/java/nil/nadph/qnotified/activity/AlphaTestFuncActivity.java
Patch:
@@ -84,7 +84,7 @@ public boolean doOnCreate(Bundle bundle) {
             View v = subtitle(this, "狐狸狸测试功能");
             v.setOnClickListener(v1 -> RevokeMsgDialog.INSTANCE.onShow(AlphaTestFuncActivity.this));
             ll.addView(v);
-            ll.addView(newListItemHookSwitchInit(this, "屏蔽戳一戳灰字提示[暂不支持8.4.8+]", "仅屏蔽开启之后的提示", RemovePokeGrayTips.INSTANCE));
+            ll.addView(newListItemHookSwitchInit(this, "屏蔽戳一戳灰字[8.4.8-]", "仅屏蔽开启之后的提示", RemovePokeGrayTips.INSTANCE));
         }
         __ll.setLayoutParams(new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT));
         this.setContentView(bounceScrollView);

File: app/src/main/java/nil/nadph/qnotified/hook/BaseDelayableHook.java
Patch:
@@ -114,7 +114,6 @@ public static BaseDelayableHook[] queryDelayableHooks() {
                 StartActivityHook.INSTANCE,
                 RemovePokeGrayTips.INSTANCE,
                 ArbitraryFrdSourceId.get(),
-//                RemoveRedDot.INSTANCE
                 RemoveDailySign.INSTANCE,
         };
         return sAllHooks;

File: app/src/main/java/nil/nadph/qnotified/activity/AlphaTestFuncActivity.java
Patch:
@@ -84,7 +84,7 @@ public boolean doOnCreate(Bundle bundle) {
             View v = subtitle(this, "狐狸狸测试功能");
             v.setOnClickListener(v1 -> RevokeMsgDialog.INSTANCE.onShow(AlphaTestFuncActivity.this));
             ll.addView(v);
-            ll.addView(newListItemHookSwitchInit(this, "屏蔽戳一戳灰字提示[暂不支持8.4.8+]", "仅屏蔽开启之后的提示", RemovePokeGrayTips.INSTANCE));
+            ll.addView(newListItemHookSwitchInit(this, "屏蔽戳一戳灰字[8.4.8-]", "仅屏蔽开启之后的提示", RemovePokeGrayTips.INSTANCE));
         }
         __ll.setLayoutParams(new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT));
         this.setContentView(bounceScrollView);

File: app/src/main/java/nil/nadph/qnotified/hook/BaseDelayableHook.java
Patch:
@@ -114,7 +114,6 @@ public static BaseDelayableHook[] queryDelayableHooks() {
                 StartActivityHook.INSTANCE,
                 RemovePokeGrayTips.INSTANCE,
                 ArbitraryFrdSourceId.get(),
-//                RemoveRedDot.INSTANCE
                 RemoveDailySign.INSTANCE,
         };
         return sAllHooks;

File: app/src/main/java/nil/nadph/qnotified/activity/EulaActivity.java
Patch:
@@ -91,7 +91,7 @@ public boolean doOnCreate(Bundle bundle) {
 
         SpannableStringBuilder sb = new SpannableStringBuilder();
         try {
-            sb.append(Utils.getFileContent(ResUtils.openAsset("EULA.txt")));
+            sb.append(Utils.getFileContent(ResUtils.openAsset("eula.txt")));
             sb.append("\n\n");
             sb.append(Utils.getFileContent(ResUtils.openAsset("privacy_license.txt")));
         } catch (IOException e) {

File: app/src/main/java/nil/nadph/qnotified/hook/FlashPicHook.java
Patch:
@@ -70,7 +70,7 @@ public boolean init() {
             for (Method mi : clz.getDeclaredMethods()) {
                 if (mi.getReturnType().equals(boolean.class) && mi.getParameterTypes().length == 1) {
                     String name = mi.getName();
-                    if (name.equals("a") || name.equals("z")) {
+                    if (name.equals("a") || name.equals("z") || name.equals("W")) {
                         isFlashPic = mi;
                         break;
                     }

File: app/src/main/java/nil/nadph/qnotified/hook/FlashPicHook.java
Patch:
@@ -70,7 +70,7 @@ public boolean init() {
             for (Method mi : clz.getDeclaredMethods()) {
                 if (mi.getReturnType().equals(boolean.class) && mi.getParameterTypes().length == 1) {
                     String name = mi.getName();
-                    if (name.equals("a") || name.equals("z")) {
+                    if (name.equals("a") || name.equals("z") || name.equals("W")) {
                         isFlashPic = mi;
                         break;
                     }

File: app/src/main/java/nil/nadph/qnotified/dialog/RikkaColorPickDialog.java
Patch:
@@ -102,7 +102,7 @@ public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
         dialog.getButton(AlertDialog.BUTTON_POSITIVE).setOnClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View v) {
-                if (currentColorValid) {
+                if (currentColorValid || !enableColor) {
                     ConfigManager cfg = ConfigManager.getDefaultConfig();
                     if (enableColor) {
                         cfg.putInt(rq_dialog_border_color, currentColor);

File: app/src/main/java/nil/nadph/qnotified/activity/OmegaTestFuncActivity.java
Patch:
@@ -86,13 +86,13 @@ public void run() {
                 }
             }).start();
         } else {
-            ll.addView(subtitle(this, "Omega测试功能 仅用于测试稳定性[可能会存在BUG 包括但不限于功能不生效、" + _hostName + "出现卡顿乃至" + _hostName + "闪退 请酌情开启]"));
+            ll.addView(subtitle(this, "Omega测试功能[本功能将会收集您使用本功能发送的消息内容与当前QQ号 请酌情开启]", Color.RED));
             ll.addView(newListItemHookSwitchInit(this, "复制卡片消息", "", CopyCardMsg.INSTANCE));
             ll.addView(newListItemHookSwitchInit(this, "发送卡片消息", "ArkAppMsg(json)+StructMsg(xml)", CardMsgHook.get()));
             ll.addView(subtitle(this, "卡片消息使用说明:先输入卡片代码(聊天界面),后长按发送按钮\n勿滥用此功能! 频繁使用此功能被举报可能封号"));
             ll.addView(newListItemButton(this, "群发文本消息"+(LicenseStatus.isAsserted()?"":"（仅限五个字以内）"), "年少不知号贵-理性使用以免永冻", null, clickToBatchMsg()));
-            ll.addView(subtitle(this, "警告: 请勿发送违规内容! 在您使用 群发文本消息 时，本模块会向服务器报告您 群发的消息内容 以及当前QQ号。"
-                    + "继续使用 群发 功能代表您同意放弃自己的一切权利，并允许QNotified开发组及管理组在非匿名的前提下任意存储、分析、使用、分享您的数据", Color.RED));
+            ll.addView(subtitle(this, "警告: 请勿发送违规内容! 在您使用 群发文本消息 与 发送卡片消息 时，本模块会向服务器报告您 群发/卡片的消息内容 以及当前QQ号。"
+                    + "继续使用 群发 与 发送卡片 功能代表您同意放弃自己的一切权利，并允许QNotified开发组及管理组在非匿名的前提下任意存储、分析、使用、分享您的数据", Color.RED));
             ll.addView(subtitle(this, "想要隐私就不要去玩 群发 或者 卡片消息, 是否开启功能是你们的自由", Color.RED));
             ll.addView(subtitle(this, "如果您看不懂, 或无法理解以上内容, 请勿使用 群发 或 卡片消息 功能!", Color.RED));
         }

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -116,9 +116,11 @@ public boolean doOnCreate(Bundle bundle) {
         } catch (Throwable e) {
             log(e);
         }
+/* 
         if (LicenseStatus.isAsserted()) {
             ll.addView(newListItemButton(this, "Alpha测试性功能", "嘘!这是个秘密!", null, clickToProxyActAction(AlphaTestFuncActivity.class)));
         }
+*/  
         if (!LicenseStatus.hasBlackFlags()) {
             ll.addView(newListItemButton(this, "Beta测试性功能", "仅用于测试稳定性", null, clickToProxyActAction(BetaTestFuncActivity.class)));
             ll.addView(newListItemButton(this, "Omega测试性功能", "这是个不存在的功能", null, v -> KotlinUtilsKt.showEulaDialog(SettingsActivity.this)));

File: app/src/main/java/nil/nadph/qnotified/activity/OmegaTestFuncActivity.java
Patch:
@@ -86,13 +86,13 @@ public void run() {
                 }
             }).start();
         } else {
-            ll.addView(subtitle(this, "Omega测试功能 仅用于测试稳定性[可能会存在BUG 包括但不限于功能不生效、" + _hostName + "出现卡顿乃至" + _hostName + "闪退 请酌情开启]"));
+            ll.addView(subtitle(this, "Omega测试功能[本功能将会收集您使用本功能发送的消息内容与当前QQ号 请酌情开启]", Color.RED));
             ll.addView(newListItemHookSwitchInit(this, "复制卡片消息", "", CopyCardMsg.INSTANCE));
             ll.addView(newListItemHookSwitchInit(this, "发送卡片消息", "ArkAppMsg(json)+StructMsg(xml)", CardMsgHook.get()));
             ll.addView(subtitle(this, "卡片消息使用说明:先输入卡片代码(聊天界面),后长按发送按钮\n勿滥用此功能! 频繁使用此功能被举报可能封号"));
             ll.addView(newListItemButton(this, "群发文本消息"+(LicenseStatus.isAsserted()?"":"（仅限五个字以内）"), "年少不知号贵-理性使用以免永冻", null, clickToBatchMsg()));
-            ll.addView(subtitle(this, "警告: 请勿发送违规内容! 在您使用 群发文本消息 时，本模块会向服务器报告您 群发的消息内容 以及当前QQ号。"
-                    + "继续使用 群发 功能代表您同意放弃自己的一切权利，并允许QNotified开发组及管理组在非匿名的前提下任意存储、分析、使用、分享您的数据", Color.RED));
+            ll.addView(subtitle(this, "警告: 请勿发送违规内容! 在您使用 群发文本消息 与 发送卡片消息 时，本模块会向服务器报告您 群发/卡片的消息内容 以及当前QQ号。"
+                    + "继续使用 群发 与 发送卡片 功能代表您同意放弃自己的一切权利，并允许QNotified开发组及管理组在非匿名的前提下任意存储、分析、使用、分享您的数据", Color.RED));
             ll.addView(subtitle(this, "想要隐私就不要去玩 群发 或者 卡片消息, 是否开启功能是你们的自由", Color.RED));
             ll.addView(subtitle(this, "如果您看不懂, 或无法理解以上内容, 请勿使用 群发 或 卡片消息 功能!", Color.RED));
         }

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -116,9 +116,11 @@ public boolean doOnCreate(Bundle bundle) {
         } catch (Throwable e) {
             log(e);
         }
+/* 
         if (LicenseStatus.isAsserted()) {
             ll.addView(newListItemButton(this, "Alpha测试性功能", "嘘!这是个秘密!", null, clickToProxyActAction(AlphaTestFuncActivity.class)));
         }
+*/  
         if (!LicenseStatus.hasBlackFlags()) {
             ll.addView(newListItemButton(this, "Beta测试性功能", "仅用于测试稳定性", null, clickToProxyActAction(BetaTestFuncActivity.class)));
             ll.addView(newListItemButton(this, "Omega测试性功能", "这是个不存在的功能", null, v -> KotlinUtilsKt.showEulaDialog(SettingsActivity.this)));

File: app/src/main/java/nil/nadph/qnotified/hook/BaseDelayableHook.java
Patch:
@@ -21,6 +21,7 @@
 import me.kyuubiran.hook.*;
 import me.kyuubiran.hook.testhook.CutMessage;
 import me.singleneuron.hook.*;
+import me.singleneuron.hook.decorator.SimpleCheckIn;
 import nil.nadph.qnotified.SyncUtils;
 import nil.nadph.qnotified.config.SwitchConfigItem;
 import nil.nadph.qnotified.hook.rikka.*;
@@ -107,7 +108,8 @@ public static BaseDelayableHook[] queryDelayableHooks() {
                 VasProfileAntiCrash.get(),
                 RevokeMsg.INSTANCE,
                 DisableCameraOnSweepingInQzone.INSTANCE,
-                ItemBuilderFactoryHook.INSTANCE
+                ItemBuilderFactoryHook.INSTANCE,
+                SimpleCheckIn.INSTANCE
         };
         return sAllHooks;
     }

File: app/src/main/java/nil/nadph/qnotified/hook/BaseDelayableHook.java
Patch:
@@ -21,6 +21,7 @@
 import me.kyuubiran.hook.*;
 import me.kyuubiran.hook.testhook.CutMessage;
 import me.singleneuron.hook.*;
+import me.singleneuron.hook.decorator.SimpleCheckIn;
 import nil.nadph.qnotified.SyncUtils;
 import nil.nadph.qnotified.config.SwitchConfigItem;
 import nil.nadph.qnotified.hook.rikka.*;
@@ -107,7 +108,8 @@ public static BaseDelayableHook[] queryDelayableHooks() {
                 VasProfileAntiCrash.get(),
                 RevokeMsg.INSTANCE,
                 DisableCameraOnSweepingInQzone.INSTANCE,
-                ItemBuilderFactoryHook.INSTANCE
+                ItemBuilderFactoryHook.INSTANCE,
+                SimpleCheckIn.INSTANCE
         };
         return sAllHooks;
     }

File: app/src/main/java/nil/nadph/qnotified/util/BugCollector.java
Patch:
@@ -29,7 +29,7 @@ public static void onThrowable(Throwable th) {
             if (Utils.isCallingFrom("BugCollector")) return;
             Application ctx = Utils.getApplication();
             if (ctx != null) {
-                CliOper.__init__(ctx,true);
+                CliOper.__init__(ctx);
                 Crashes.trackError(th);
             }
         } catch (Throwable ignored) {

File: app/src/main/java/nil/nadph/qnotified/util/BugCollector.java
Patch:
@@ -29,7 +29,7 @@ public static void onThrowable(Throwable th) {
             if (Utils.isCallingFrom("BugCollector")) return;
             Application ctx = Utils.getApplication();
             if (ctx != null) {
-                CliOper.__init__(ctx,true);
+                CliOper.__init__(ctx);
                 Crashes.trackError(th);
             }
         } catch (Throwable ignored) {

File: app/src/main/java/nil/nadph/qnotified/util/CliOper.java
Patch:
@@ -47,7 +47,7 @@ public static void __init__(Application app, boolean mustInit) {
         }
         configManager.putString(LAST_TRACE_DATA_CONFIG, nowTime);
 
-        if (Analytics.isEnabled().get()) {
+        if (!Analytics.isEnabled().get()) {
             AppCenter.start(app, "ddf4b597-1833-45dd-af28-96ca504b8123", Analytics.class);
             Analytics.setEnabled(true);
         }

File: app/src/main/java/nil/nadph/qnotified/script/XMethodHookFactory.java
Patch:
@@ -33,7 +33,7 @@ public class XMethodHookFactory {
      * See {@link #create(XC_MethodHookImpl, int)}
      *
      * @param impl The actual method hook callback
-     * @return A XC_MethodHook you can use with {@link XposedBridge#hookMethod(Member, XC_MethodHook)}.
+     * @return An XC_MethodHook object you can use with {@link XposedBridge#hookMethod(Member, XC_MethodHook)}.
      */
     public static XC_MethodHook create(final XC_MethodHookImpl impl) {
         return create(impl, 50);
@@ -48,7 +48,7 @@ public static XC_MethodHook create(final XC_MethodHookImpl impl) {
      *
      * @param impl     The actual method hook callback
      * @param priority See {@link XCallback#priority}.
-     * @return A XC_MethodHook you can use with {@link XposedBridge#hookMethod(Member, XC_MethodHook)}.
+     * @return An XC_MethodHook object you can use with {@link XposedBridge#hookMethod(Member, XC_MethodHook)}.
      */
     public static XC_MethodHook create(final XC_MethodHookImpl impl, final int priority) {
         if (impl == null) throw new NullPointerException("hookImpl == null");

File: app/src/main/java/nil/nadph/qnotified/MainHook.java
Patch:
@@ -1220,9 +1220,9 @@ private void hideMiniAppEntry() {
                 int lastVersion = cache.getIntOrDefault("qn_hide_msg_list_miniapp_version_code", 0);
                 if (getHostVersionCode32() == lastVersion) {
                     String methodName = cache.getString("qn_hide_msg_list_miniapp_method_name");
-                    findAndHookMethod(load("com/tencent/mobileqq/activity/Conversation"), methodName, XC_MethodReplacement.returnConstant(null));
+                    findAndHookMethod(Initiator._Conversation(), methodName, XC_MethodReplacement.returnConstant(null));
                 } else {
-                    Class con = load("com/tencent/mobileqq/activity/Conversation");
+                    Class con = Initiator._Conversation();
                     for (Method m : con.getDeclaredMethods()) {
                         Class[] ps = m.getParameterTypes();
                         if (ps != null && ps.length > 0) continue;

File: app/src/main/java/nil/nadph/qnotified/util/UpdateCheck.java
Patch:
@@ -271,7 +271,7 @@ public static long iso8601ToTimestampMs(String expr) {
         int ms = Integer.parseInt(p2[3]);
         //return Date.UTC(yyyy - 1900, MM - 1, dd, HH, mm, ss) + ms;
         Calendar calendar = Calendar.getInstance(TimeZone.getTimeZone("UTC"));
-        calendar.set(yyyy,MM,dd,HH,mm,ss);
+        calendar.set(yyyy, MM - 1, dd, HH, mm, ss);
         return calendar.getTime().getTime() + ms;
     }
 }

File: app/stub/com/tencent/mobileqq/widget/BounceScrollView.java
Patch:
@@ -3,13 +3,15 @@
 import android.content.Context;
 import android.util.AttributeSet;
 import android.view.MotionEvent;
+import com.tencent.widget.ScrollView;
 
 public class BounceScrollView extends ScrollView {
 
     public BounceScrollView(Context context, AttributeSet attributeSet) {
         super(context, attributeSet);
         setOverScrollMode(0);
         setFadingEdgeLength(0);
+        throw new RuntimeException("Stub!");
     }
 
     protected void onScrollChanged(int i, int i2, int i3, int i4) {

File: app/stub/com/tencent/widget/ScrollView.java
Patch:
@@ -1,4 +1,4 @@
-package com.tencent.mobileqq.widget;
+package com.tencent.widget;
 
 import android.annotation.TargetApi;
 import android.content.Context;

File: app/stub/mqq/app/MobileQQ.java
Patch:
@@ -177,9 +177,9 @@ public AppRuntime getAppRuntime(String account) throws AccountNotMatchException
         throw new RuntimeException("Stub!");
     }
 
-    public String getProcessName() {
-        throw new RuntimeException("Stub!");
-    }
+//    public String getProcessName() {
+//        throw new RuntimeException("Stub!");
+//    }
 
     public void setProperty(String name, String value) {
         this.properties.setProperty(name, value);

File: app/src/main/java/nil/nadph/qnotified/hook/FileRecvRedirect.java
Patch:
@@ -90,7 +90,7 @@ public String getDefaultPath() {
         if (isTim(getApplication())) {
             return Environment.getExternalStorageDirectory().getAbsolutePath() + "/Tencent/TIMfile_recv/";
         } else {
-            if (getHostVersionCode() > 1334) {
+            if (getHostVersionCode32() > 1334) {
                 return getApplication().getExternalFilesDir(null) + "/Tencent/QQfile_recv/";
             } else {
                 return Environment.getExternalStorageDirectory().getAbsolutePath() + "/Tencent/QQfile_recv/";

File: app/src/main/java/nil/nadph/qnotified/hook/ReplyNoAtHook.java
Patch:
@@ -61,7 +61,7 @@ public boolean init() {
         if (inited) return true;
         try {
             String method = null;
-            int ver = (int) getHostVersionCode();
+            int ver = getHostVersionCode32();
             if (ver >= 1406) {
                 method = "n";
             } else if (ver > 1296) {

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/IgnoreDiyCard.java
Patch:
@@ -59,7 +59,7 @@ public boolean init() {
         try {
             for (Method m : load("com.tencent.mobileqq.activity.FriendProfileCardActivity").getDeclaredMethods()) {
                 Class<?>[] argt = m.getParameterTypes();
-                if (Utils.getHostVersionCode() <= 1406) {
+                if (Utils.getHostVersionCode32() <= 1406) {
                     if (m.getName().equals("a") && !Modifier.isStatic(m.getModifiers()) && m.getReturnType().equals(void.class)) {
                         if (argt.length != 2) continue;
                         if (argt[1] != boolean.class) continue;

File: app/src/main/java/nil/nadph/qnotified/util/ArscKit.java
Patch:
@@ -64,7 +64,7 @@ public static int getIdentifier(Context ctx, String type, String name, boolean a
         ConfigManager cache = ConfigManager.getCache();
         ret = cache.getIntOrDefault(CACHED_RES_ID_NAME_PREFIX + type + "/" + name, 0);
         int oldcode = cache.getIntOrDefault(CACHED_RES_ID_CODE_PREFIX + type + "/" + name, -1);
-        int currcode = (int) Utils.getHostVersionCode();
+        int currcode = Utils.getHostVersionCode32();
         if (ret != 0 && (oldcode == currcode)) {
             return ret;
         }

File: app/src/main/java/nil/nadph/qnotified/chiral/PubChemStealer.java
Patch:
@@ -12,7 +12,7 @@
 
 public class PubChemStealer {
 
-    private static final String PUB_CHEM_SITE = "127.0.0.1";
+    private static final String PUB_CHEM_SITE = "http://127.0.0.1:8081";
     private static final String FAKE_PUB_CHEM_SITE = "https://ioctl.cc";//reserved proxy...
 
     @NonUiThread

File: app/src/main/java/nil/nadph/qnotified/hook/ChatTailHook.java
Patch:
@@ -89,7 +89,7 @@ public boolean init() {
                 protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
                     if (isEnabled()) {
                         if (LicenseStatus.sDisableCommonHooks) return;
-                        if (!LicenseStatus.getAuth2Status()) return;
+                        if (LicenseStatus.hasBlackFlags()) return;
                         String msg = (String) param.args[3];
                         // StringBuilder debug = new StringBuilder();
                         //  debug.append("当前消息: ").append(msg).append("\n");

File: app/src/main/java/nil/nadph/qnotified/hook/InputButtonHook.java
Patch:
@@ -180,7 +180,7 @@ public boolean onLongClick(View v) {
                                             Utils.showToast(ctx, TOAST_TYPE_ERROR, e.toString().replace("java.lang.", ""), Toast.LENGTH_SHORT);
                                         }
                                     } else {
-                                        if (!LicenseStatus.getAuth2Status()) return false;
+                                        if (LicenseStatus.hasBlackFlags()) return false;
                                         if (!Utils.isNullOrEmpty(ChatTailHook.get().getTailCapacity())) {
                                             int battery = FakeBatteryHook.get().isEnabled() ? FakeBatteryHook.get().getFakeBatteryStatus() < 1 ? ChatTailActivity.getBattery() : FakeBatteryHook.get().getFakeBatteryCapacity() : ChatTailActivity.getBattery();
                                             String tc = ChatTailHook.get().getTailCapacity().

File: app/src/main/java/nil/nadph/qnotified/hook/PttForwardHook.java
Patch:
@@ -294,7 +294,7 @@ protected void afterHookedMethod(MethodHookParam param) throws Throwable {
                             Object arr = param.getResult();
                             Class<?> clQQCustomMenuItem = arr.getClass().getComponentType();
                             Object ret;
-                            if (isSavePttEnabled() && LicenseStatus.getAuth2Status()) {
+                            if (isSavePttEnabled()) {
                                 Object item_forward = CustomMenu.createItem(clQQCustomMenuItem, R_ID_PTT_FORWARD, "转发");
                                 Object item_save = CustomMenu.createItem(clQQCustomMenuItem, R_ID_PTT_SAVE, "保存");
                                 ret = Array.newInstance(clQQCustomMenuItem, Array.getLength(arr) + 2);

File: app/src/main/java/nil/nadph/qnotified/MainHook.java
Patch:
@@ -1211,7 +1211,7 @@ public boolean handleMessage(Message msg) {
     private void hideMiniAppEntry() {
         try {
             if (Utils.isTim(getApplication())) return;
-        } catch (Exception ignored) {
+        } catch (Throwable ignored) {
         }
         try {
             ConfigManager cache = ConfigManager.getCache();
@@ -1316,7 +1316,7 @@ protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
                     });
                 }
             }
-        } catch (Exception e) {
+        } catch (Throwable e) {
             log(e);
         }
     }

File: app/src/main/java/nil/nadph/qnotified/util/PHPArray.java
Patch:
@@ -148,6 +148,9 @@ public static PHPArray fromJson(String json) {
                                 case 'r':
                                     ret.append('\r');
                                     break;
+                                case '/':
+                                    ret.append('/');
+                                    break;
                                 case '\\':
                                     ret.append('\\');
                                     break;

File: app/src/main/java/me/kyuubiran/hook/RemoveCameraButton.java
Patch:
@@ -25,6 +25,7 @@ public class RemoveCameraButton extends BaseDelayableHook {
     private static final RemoveCameraButton self = new RemoveCameraButton();
     private boolean isInit = false;
 
+
     public static RemoveCameraButton get() {
         return self;
     }

File: app/src/main/java/nil/nadph/qnotified/activity/BetaTestFuncActivity.java
Patch:
@@ -25,6 +25,7 @@
 import android.widget.RelativeLayout;
 import android.widget.TextView;
 import com.tencent.mobileqq.widget.BounceScrollView;
+import me.kyuubiran.hook.testhook.TestDoNotPlayFire;
 import nil.nadph.qnotified.hook.ChatTailHook;
 import nil.nadph.qnotified.hook.MutePokePacket;
 import nil.nadph.qnotified.hook.PttForwardHook;
@@ -92,6 +93,7 @@ public void run() {
             ll.addView(newListItemHookSwitchInit(this, "屏蔽戳一戳", "OvO", MutePokePacket.get()));
             ll.addView(_t = newListItemButton(this, "管理脚本(.java)", "请注意安全, 合理使用", "N/A", clickToProxyActAction(ManageScriptsActivity.class)));
             __js_status = _t.findViewById(R_ID_VALUE);
+            ll.addView(newListItemHookSwitchInit(this, "在LogCat输出所有接收的消息", "[Debug]无关人士请不要打开 没有任何作用", TestDoNotPlayFire.INSTANCE));
         }
         __ll.setLayoutParams(new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT));
         this.setContentView(bounceScrollView);

File: app/src/main/java/nil/nadph/qnotified/hook/BaseDelayableHook.java
Patch:
@@ -26,6 +26,7 @@
 import me.kyuubiran.hook.RemoveQbossAD;
 import me.kyuubiran.hook.ShowSelfMsgByLeft;
 import me.kyuubiran.hook.SimplifyQQSettingMe;
+import me.kyuubiran.hook.testhook.TestDoNotPlayFire;
 import me.singleneuron.hook.ChangeDrawerWidth;
 import me.singleneuron.hook.DebugDump;
 import me.singleneuron.hook.ForceSystemAlbum;
@@ -130,6 +131,7 @@ public static BaseDelayableHook[] queryDelayableHooks() {
                 SimplifyQQSettingMe.INSTANCE,
                 DebugDump.INSTANCE,
                 ChangeDrawerWidth.INSTANCE,
+                TestDoNotPlayFire.INSTANCE,
         };
         return sAllHooks;
     }

File: app/src/main/java/nil/nadph/qnotified/util/Utils.java
Patch:
@@ -237,7 +237,7 @@ public static String paramsTypesToString(Class... c) {
         if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {
             return pi.getLongVersionCode();
         } else {
-            return pi.versionCode;
+            return (long) pi.versionCode;
         }
     });
 

File: app/src/main/java/nil/nadph/qnotified/util/Utils.java
Patch:
@@ -237,7 +237,7 @@ public static String paramsTypesToString(Class... c) {
         if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {
             return pi.getLongVersionCode();
         } else {
-            return pi.versionCode;
+            return (long) pi.versionCode;
         }
     });
 

File: app/src/main/java/nil/nadph/qnotified/dialog/ScriptSettingDialog.java
Patch:
@@ -70,6 +70,7 @@ public void onClick(View v) {
     @Override
     public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
         script.setEnable(isChecked);
+        Utils.showToast(ctx, Utils.TOAST_TYPE_ERROR, "重启QQ生效", Toast.LENGTH_SHORT);
     }
 
     public static void createAndShowDialog(Context ctx, QNScript qs) {

File: app/src/main/java/nil/nadph/qnotified/activity/TroubleshootActivity.java
Patch:
@@ -38,6 +38,7 @@
 import android.widget.Toast;
 import com.tencent.mobileqq.widget.BounceScrollView;
 import me.singleneuron.activity.BugReportActivity;
+import me.singleneuron.hook.DebugDump;
 import nil.nadph.qnotified.ExfriendManager;
 import nil.nadph.qnotified.config.ConfigManager;
 import nil.nadph.qnotified.config.EventRecord;
@@ -98,6 +99,7 @@ public boolean doOnCreate(Bundle savedInstanceState) {
         ll.addView(subtitle(this, ""));
         ll.addView(subtitle(this, "以下内容基本上都没用，它们为了修复故障才留在这里。"));
         ll.addView(subtitle(this, "测试"));
+        ll.addView(newListItemHookSwitchInit(this,"堆栈转储","没事别开", DebugDump.INSTANCE));
         ll.addView(newListItemButton(this, "主线程抛异常", "没事别按", null, new View.OnClickListener() {
             @Override
             public void onClick(View v) {

File: app/src/main/java/nil/nadph/qnotified/activity/TroubleshootActivity.java
Patch:
@@ -38,6 +38,7 @@
 import android.widget.Toast;
 import com.tencent.mobileqq.widget.BounceScrollView;
 import me.singleneuron.activity.BugReportActivity;
+import me.singleneuron.hook.DebugDump;
 import nil.nadph.qnotified.ExfriendManager;
 import nil.nadph.qnotified.config.ConfigManager;
 import nil.nadph.qnotified.config.EventRecord;
@@ -98,6 +99,7 @@ public boolean doOnCreate(Bundle savedInstanceState) {
         ll.addView(subtitle(this, ""));
         ll.addView(subtitle(this, "以下内容基本上都没用，它们为了修复故障才留在这里。"));
         ll.addView(subtitle(this, "测试"));
+        ll.addView(newListItemHookSwitchInit(this,"堆栈转储","没事别开", DebugDump.INSTANCE));
         ll.addView(newListItemButton(this, "主线程抛异常", "没事别按", null, new View.OnClickListener() {
             @Override
             public void onClick(View v) {

File: app/src/main/java/nil/nadph/qnotified/hook/BaseDelayableHook.java
Patch:
@@ -20,6 +20,7 @@
 
 import me.kyuubiran.hook.*;
 import me.kyuubiran.hook.testhook.TestQQMe;
+import me.singleneuron.hook.DebugDump;
 import me.singleneuron.hook.ForceSystemAlbum;
 import me.singleneuron.hook.ForceSystemCamera;
 import me.singleneuron.hook.ForceSystemFile;
@@ -101,7 +102,8 @@ public static BaseDelayableHook[] queryDelayableHooks() {
                 AutomaticMosaicName.INSTANCE,
                 TestQQMe.INSTANCE,
                 ForceSystemAlbum.INSTANCE,
-                ForceSystemFile.INSTANCE
+                ForceSystemFile.INSTANCE,
+                DebugDump.INSTANCE
 //                RemoveGroupApp.INSTANCE,
         };
         return sAllHooks;

File: app/src/main/java/nil/nadph/qnotified/hook/BaseDelayableHook.java
Patch:
@@ -102,8 +102,7 @@ public static BaseDelayableHook[] queryDelayableHooks() {
                 AutomaticMosaicName.INSTANCE,
                 TestQQMe.INSTANCE,
                 ForceSystemAlbum.INSTANCE,
-                ForceSystemFile.INSTANCE
-//                RemoveGroupApp.INSTANCE,
+                ForceSystemFile.INSTANCE,
                 ShowSelfMsgByLeft.INSTANCE,
                 RemoveGroupApp.INSTANCE,
         };

File: app/src/main/java/nil/nadph/qnotified/hook/BaseDelayableHook.java
Patch:
@@ -19,6 +19,7 @@
 package nil.nadph.qnotified.hook;
 
 import me.kyuubiran.hook.*;
+import me.kyuubiran.hook.testhook.TestQQMe;
 import me.singleneuron.hook.ForceSystemCamera;
 import me.singleneuron.hook.NewRoundHead;
 import me.singleneuron.hook.NoApplet;

File: app/src/main/java/nil/nadph/qnotified/util/Utils.java
Patch:
@@ -118,6 +118,7 @@ public static String readByReader(Reader r) throws IOException {
         for (int len = 0; len != -1; len = br.read(buff)) {
             str.append(new String(buff, 0, len));
         }
+        br.close();
         return str.toString();
     }
 
@@ -1912,6 +1913,8 @@ public static void copy(File s, File f) throws Exception {
         for (int len = 0; len != -1; len = fr.read(buff)) {
             fw.write(buff, 0, len);
         }
+        fw.close();
+        fr.close();
     }
 
     public static class DummyCallback implements DialogInterface.OnClickListener {

File: app/src/main/java/nil/nadph/qnotified/StartupHook.java
Patch:
@@ -24,6 +24,7 @@
 import de.robv.android.xposed.XC_MethodHook;
 import de.robv.android.xposed.XposedBridge;
 import de.robv.android.xposed.XposedHelpers;
+import nil.nadph.qnotified.script.QNScriptManager;
 import nil.nadph.qnotified.util.Initiator;
 import nil.nadph.qnotified.util.Natives;
 import nil.nadph.qnotified.util.Utils;
@@ -79,6 +80,7 @@ protected void afterHookedMethod(MethodHookParam param) throws Throwable {
                         } catch (Throwable e3) {
                             Utils.log(e3);
                         }
+                        QNScriptManager.init();
                         if (Utils.getBuildTimestamp() < 0) return;
                         MainHook.getInstance().performHook(ctx, param.thisObject);
                         sec_stage_inited = true;

File: app/src/main/java/nil/nadph/qnotified/activity/EulaActivity.java
Patch:
@@ -37,6 +37,7 @@
 import nil.nadph.qnotified.MainHook;
 import nil.nadph.qnotified.R;
 import nil.nadph.qnotified.hook.FakeBatteryHook;
+import nil.nadph.qnotified.script.QNScriptManager;
 import nil.nadph.qnotified.ui.ResUtils;
 import nil.nadph.qnotified.util.LicenseStatus;
 import nil.nadph.qnotified.util.Utils;

File: app/src/main/java/nil/nadph/qnotified/activity/ScriptGuideActivity.java
Patch:
@@ -28,6 +28,7 @@
 
 import com.tencent.mobileqq.widget.BounceScrollView;
 
+import nil.nadph.qnotified.script.QNScriptManager;
 import nil.nadph.qnotified.ui.ResUtils;
 
 import static android.view.ViewGroup.LayoutParams.MATCH_PARENT;
@@ -64,7 +65,7 @@ public boolean doOnCreate(Bundle bundle) {
         ColorStateList hiColor = ColorStateList.valueOf(Color.argb(255, 242, 140, 72));
         RelativeLayout _t;
 
-        ll.addView(subtitle(this, "这里啥也没有"));
+        ll.addView(subtitle(this, QNScriptManager.error));
         //bounceScrollView.setFocusable(true);
         //bounceScrollView.setFocusableInTouchMode(true);
         __ll.setLayoutParams(new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT));

File: app/src/main/java/nil/nadph/qnotified/config/ConfigItems.java
Patch:
@@ -47,6 +47,7 @@ public class ConfigItems {
     public static final String qn_script_global = "qn_script_global";
     public static final String qn_script_count = "qn_script_count";
     public static final String qn_script_code = "qn_script_code_";
+    public static final String qn_script_enable_ = "qn_script_enable_";
 
     public static final SwitchConfigItem qn_disable_hot_patch = new SwitchConfigItem() {
         @Override

File: app/src/main/java/nil/nadph/qnotified/hook/ChatTailHook.java
Patch:
@@ -89,6 +89,7 @@ public boolean init() {
                 protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
                     if (isEnabled()) {
                         if (LicenseStatus.sDisableCommonHooks) return;
+                        if (!LicenseStatus.getAuth2Status()) return;
                         String msg = (String) param.args[3];
                         // StringBuilder debug = new StringBuilder();
                         //  debug.append("当前消息: ").append(msg).append("\n");

File: app/src/main/java/nil/nadph/qnotified/script/params/FriendMessageParam.java
Patch:
@@ -4,13 +4,13 @@ public class FriendMessageParam {
     /**
      * 好友id
      */
-    public long uin;
+    public String uin;
     /**
      * 消息内容
      */
     public String content;
 
-    public FriendMessageParam setUin(long uin) {
+    public FriendMessageParam setUin(String uin) {
         this.uin = uin;
         return this;
     }

File: app/src/main/java/nil/nadph/qnotified/util/DexKit.java
Patch:
@@ -135,7 +135,7 @@ public static Method getMethodFromCache(int i) {
             return null;
         }
         try {
-            return m.getMethodInstance(Initiator.getClassLoader());
+            return m.getMethodInstance(Initiator.getHostClassLoader());
         } catch (NoSuchMethodException e) {
             log(e);
             return null;
@@ -153,7 +153,7 @@ public static Method doFindMethod(int i) {
             return null;
         }
         try {
-            return m.getMethodInstance(Initiator.getClassLoader());
+            return m.getMethodInstance(Initiator.getHostClassLoader());
         } catch (NoSuchMethodException e) {
             log(e);
             return null;

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -46,6 +46,7 @@
 import nil.nadph.qnotified.hook.*;
 import me.kyuubiran.hook.*;
 import nil.nadph.qnotified.hook.rikka.RemoveMiniProgramAd;
+import nil.nadph.qnotified.script.QNScriptManager;
 import nil.nadph.qnotified.ui.CustomDialog;
 import nil.nadph.qnotified.ui.HighContrastBorder;
 import nil.nadph.qnotified.ui.ResUtils;
@@ -340,7 +341,7 @@ public void doOnResume() {
             }
         }
         updateRecvRedirectStatus();
-        __js_status.setText("0/1");
+        __js_status.setText(QNScriptManager.getEnableCount() + "/" + QNScriptManager.getAllCount());
         if (__jmp_ctl_cnt != null) {
             int cnt = JumpController.get().getEffectiveRulesCount();
             if (cnt == -1) {

File: app/src/main/java/nil/nadph/qnotified/hook/ReplyNoAtHook.java
Patch:
@@ -61,7 +61,7 @@ public boolean init() {
         if (inited) return true;
         try {
             String method = null;
-            int ver = getHostVersionCode();
+            int ver = (int) getHostVersionCode();
             if (ver >= 1406) {
                 method = "n";
             } else if (ver > 1296) {

File: app/src/main/java/nil/nadph/qnotified/util/ArscKit.java
Patch:
@@ -64,7 +64,7 @@ public static int getIdentifier(Context ctx, String type, String name, boolean a
         ConfigManager cache = ConfigManager.getCache();
         ret = cache.getIntOrDefault(CACHED_RES_ID_NAME_PREFIX + type + "/" + name, 0);
         int oldcode = cache.getIntOrDefault(CACHED_RES_ID_CODE_PREFIX + type + "/" + name, -1);
-        int currcode = Utils.getHostVersionCode();
+        int currcode = (int) Utils.getHostVersionCode();
         if (ret != 0 && (oldcode == currcode)) {
             return ret;
         }

File: app/src/main/java/nil/nadph/qnotified/bridge/ChatActivityFacade.java
Patch:
@@ -168,6 +168,7 @@ public static void repeatMessage(QQAppInterface app, Parcelable session, Object
         Method m = null;
         switch (getShort$Name(msg)) {
             case "MessageForText":
+            case "MessageForFoldMsg":
                 msgText = (String) iget_object_or_null(msg, "msg");
                 sendMessage(app, getApplication(), session, msgText);
                 break;

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -178,6 +178,9 @@ public boolean onLongClick(View v) {
         ll.addView(newListItemHookSwitchInit(this, "小程序分享转链接", "感谢Alcatraz323开发远离小程序,感谢神经元移植到Xposed", adNoApplet.INSTANCE));
         ll.addView(subtitle(this, "实验性功能(未必有效)"));
         ll.addView(_t = newListItemButton(this, "下载重定向", "N/A", "N/A", this));
+        _t.setId(R_ID_BTN_FILE_RECV);
+        __recv_desc = _t.findViewById(R_ID_DESCRIPTION);
+        __recv_status = _t.findViewById(R_ID_VALUE);
         ll.addView(newListItemHookSwitchInit(this, "屏蔽小程序广告[手动关闭]", "请勿反馈此功能无效", RemoveMiniProgramAd.get()));
         ll.addView(newListItemHookSwitchInit(this, "收藏更多表情", "[暂不支持>=8.2.0]保存在本地", FavMoreEmo.get()));
         ll.addView(newListItemHookSwitchInit(this, "屏蔽更新提醒", null, PreUpgradeHook.get()));
@@ -236,9 +239,6 @@ public void onClick(View v) {
         if (!Utils.isTim(this)) {
             ll.addView(newListItemSwitchConfigNext(this, "隐藏分组下方入口", "隐藏分组列表最下方的历史好友按钮", ConfigItems.qn_hide_ex_entry_group, false));
         }
-        _t.setId(R_ID_BTN_FILE_RECV);
-        __recv_desc = _t.findViewById(R_ID_DESCRIPTION);
-        __recv_status = _t.findViewById(R_ID_VALUE);
         ll.addView(newListItemSwitchConfigNext(this, "禁用QQ热补丁", "一般无需开启", ConfigItems.qn_disable_hot_patch));
         ll.addView(subtitle(this, "参数设定"));
         ll.addView(_t = newListItemButton(this, "跳转控制", "跳转自身及第三方Activity控制", "N/A", new View.OnClickListener() {

File: app/src/main/java/nil/nadph/qnotified/util/DexKit.java
Patch:
@@ -690,7 +690,7 @@ private static DexMethodDescriptor a(int i, HashSet<DexMethodDescriptor> __metho
                     Class clz = Initiator.load(m.declaringClass);
                     if (clz.isEnum()) continue;
                     if (Modifier.isAbstract(clz.getModifiers())) continue;
-                    if (Object.class != clz.getSuperclass()) continue;
+                    if (clz.getSuperclass() == Object.class) continue;
                     return m;
                 }
                 break;

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -33,7 +33,7 @@
 import android.view.ViewGroup;
 import android.widget.*;
 import com.tencent.mobileqq.widget.BounceScrollView;
-import me.singleneuron.hook.NoApplet;
+import me.singleneuron.hook.adNoApplet;
 import nil.nadph.qnotified.MainHook;
 import nil.nadph.qnotified.R;
 import nil.nadph.qnotified.config.ConfigItems;
@@ -172,7 +172,7 @@ public boolean onLongClick(View v) {
         ll.addView(newListItemHookSwitchInit(this, "防撤回", "自带撤回灰字提示", RevokeMsgHook.get()));
         //ll.addView(newListItemSwitchConfigInit(this, "聊天图片背景透明", null, qn_gallery_bg, false, GalleryBgHook.get()));
         ll.addView(newListItemHookSwitchInit(this, "显示设置禁言的管理", "即使你只是普通群成员", GagInfoDisclosure.get()));
-        ll.addView(newListItemHookSwitchInit(this, "小程序分享转链接", "感谢Alcatraz323开发此功能", NoApplet.INSTANCE));
+        ll.addView(newListItemHookSwitchInit(this, "小程序分享转链接", "感谢Alcatraz323开发此功能", adNoApplet.INSTANCE));
         ll.addView(subtitle(this, "实验性功能(未必有效)"));
         ll.addView(newListItemHookSwitchInit(this, "收藏更多表情", "[暂不支持>=8.2.0]保存在本地", FavMoreEmo.get()));
         ll.addView(newListItemHookSwitchInit(this, "屏蔽更新提醒", null, PreUpgradeHook.get()));

File: app/src/main/java/nil/nadph/qnotified/hook/BaseDelayableHook.java
Patch:
@@ -18,7 +18,7 @@
  */
 package nil.nadph.qnotified.hook;
 
-import me.singleneuron.hook.NoApplet;
+import me.singleneuron.hook.adNoApplet;
 import nil.nadph.qnotified.SyncUtils;
 import nil.nadph.qnotified.config.SwitchConfigItem;
 import nil.nadph.qnotified.hook.kyuubiran.RemoveCameraButton;
@@ -92,7 +92,7 @@ public static BaseDelayableHook[] queryDelayableHooks() {
                 RemoveCameraButton.get(),
                 RemovePlayTogether.get(),
                 RemoveQbossAD.get(),
-                NoApplet.INSTANCE,
+                adNoApplet.INSTANCE,
         };
         return sAllHooks;
     }

File: app/src/main/java/nil/nadph/qnotified/activity/ChatTailActivity.java
Patch:
@@ -116,7 +116,7 @@ public boolean doOnCreate(Bundle bundle) {
         pct.setText(ct.getTailCapacity() + "");
         pct.setSelection(pct.getText().length());
         ll.addView(pct, newLinearLayoutParams(MATCH_PARENT, WRAP_CONTENT, 2 * _5dp, _5dp, 2 * _5dp, _5dp));
-        ll.addView(newListItemSwitchConfigNext(this, "全局开关", "开启将无视生效范围(无需重启QQ)", ConfigItems.qn_chat_tail_global, false));
+        ll.addView(newListItemSwitchFriendConfigNext(this, "全局开关", "开启将无视生效范围(无需重启QQ)", ConfigItems.qn_chat_tail_global, false));
         Button apply = new Button(ChatTailActivity.this);
         apply.setId(R_ID_APPLY);
         apply.setOnClickListener(this);
@@ -177,7 +177,7 @@ private void showStatus() {
 
     @Override
     public void onClick(View v) {
-        ConfigManager cfg = ConfigManager.getDefaultConfig();
+        ConfigManager cfg = ExfriendManager.getCurrent().getConfig();
         switch (v.getId()) {
             case R_ID_APPLY:
                 //if (mMsfResponsive) {
@@ -232,7 +232,7 @@ public void onEnumResult(SyncUtils.EnumRequestHolder holder) {
 
     private void doUpdateTailCfg() {
         ChatTailHook ct = ChatTailHook.get();
-        ConfigManager cfg = ConfigManager.getDefaultConfig();
+        ConfigManager cfg = ExfriendManager.getCurrent().getConfig();
         EditText pct;
         pct = ChatTailActivity.this.findViewById(R_ID_PERCENT_VALUE);
         String val = pct.getText().toString();

File: app/src/main/java/nil/nadph/qnotified/activity/ChatTailActivity.java
Patch:
@@ -116,7 +116,7 @@ public boolean doOnCreate(Bundle bundle) {
         pct.setText(ct.getTailCapacity() + "");
         pct.setSelection(pct.getText().length());
         ll.addView(pct, newLinearLayoutParams(MATCH_PARENT, WRAP_CONTENT, 2 * _5dp, _5dp, 2 * _5dp, _5dp));
-        ll.addView(newListItemSwitchConfigNext(this, "全局开关", "开启将无视生效范围(无需重启QQ)", ConfigItems.qn_chat_tail_global, false));
+        ll.addView(newListItemSwitchFriendConfigNext(this, "全局开关", "开启将无视生效范围(无需重启QQ)", ConfigItems.qn_chat_tail_global, false));
         Button apply = new Button(ChatTailActivity.this);
         apply.setId(R_ID_APPLY);
         apply.setOnClickListener(this);
@@ -232,7 +232,7 @@ public void onEnumResult(SyncUtils.EnumRequestHolder holder) {
 
     private void doUpdateTailCfg() {
         ChatTailHook ct = ChatTailHook.get();
-        ConfigManager cfg = ConfigManager.getDefaultConfig();
+        ConfigManager cfg = ExfriendManager.getCurrent().getConfig();
         EditText pct;
         pct = ChatTailActivity.this.findViewById(R_ID_PERCENT_VALUE);
         String val = pct.getText().toString();

File: app/src/main/java/nil/nadph/qnotified/remote/ToServiceMsg.java
Patch:
@@ -11,10 +11,10 @@ public class ToServiceMsg extends JceStruct {
     private static final byte[] EMPTY_BYTE_ARRAY = new byte[0];
     private static final Random r = new Random();
     private int uniSeq;//0
-    private String serviceName;//1
-    private String serviceCmd;//2
+    private String serviceName = "";//1
+    private String serviceCmd = "";//2
     private long token;//3
-    private byte[] body;//4
+    private byte[] body = EMPTY_BYTE_ARRAY;//4
 
     public ToServiceMsg() {
         uniSeq = r.nextInt();

File: app/src/main/java/nil/nadph/qnotified/remote/Utf8JceUtils.java
Patch:
@@ -26,6 +26,9 @@
 
 public class Utf8JceUtils {
 
+    public static final String[] DUMMY_STRING_ARRAY = new String[]{""};
+    public static final byte[] NO_DATA = new byte[0];
+
     public static <T extends JceStruct> T decodeJceStruct(T struct, byte[] bs) throws IOException {
         JceInputStream is = newInputStream(bs);
         struct.readFrom(is);

File: app/src/main/java/me/singleneuron/fragment/BugReportFragment.java
Patch:
@@ -40,6 +40,7 @@ public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {
             } else {*/
                 ListPreference listPreference = new ListPreference(getContext());
                 listPreference.setEntryValues(bugReportArguments.choices);
+                listPreference.setEntries(bugReportArguments.choices);
                 preference = listPreference;
             //}
             preference.setKey(bugReportArguments.key);

File: app/src/main/java/nil/nadph/qnotified/hook/FakeBatteryHook.java
Patch:
@@ -26,7 +26,6 @@
 import android.os.Looper;
 import android.os.Parcelable;
 import android.widget.Toast;
-
 import de.robv.android.xposed.XC_MethodHook;
 import de.robv.android.xposed.XposedBridge;
 import de.robv.android.xposed.XposedHelpers;
@@ -268,7 +267,7 @@ public boolean onReceive(Context context, Intent intent) {
     public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
         try {
             if (isEnabled()) {
-                if (args.length == 2 && method.getName().equals("getProperty")) {
+                if (method.getName().equals("getProperty") && args.length == 2) {
                     int id = (int) args[0];
                     Parcelable prop = (Parcelable) args[1];
                     if (id == BatteryManager.BATTERY_PROPERTY_STATUS) {
@@ -282,7 +281,7 @@ public Object invoke(Object proxy, Method method, Object[] args) throws Throwabl
                         BatteryProperty_setLong(prop, getFakeBatteryCapacity());
                         return 0;
                     }
-                } else if (args.length == 0 && method.getName().equals("isCharging")) {
+                } else if (method.getName().equals("isCharging") && (args == null || args.length == 0)) {
                     return isFakeBatteryCharging();
                 }
             }

File: app/src/main/java/nil/nadph/qnotified/activity/AppCompatTransferActivity.java
Patch:
@@ -19,7 +19,6 @@
 package nil.nadph.qnotified.activity;
 
 import android.os.Bundle;
-import android.os.PersistableBundle;
 import androidx.annotation.Nullable;
 import androidx.appcompat.app.AppCompatActivity;
 import nil.nadph.qnotified.util.CliOper;
@@ -43,8 +42,8 @@ protected void onRestoreInstanceState(Bundle savedInstanceState) {
     }
 
     @Override
-    public void onCreate(@Nullable Bundle savedInstanceState, @Nullable PersistableBundle persistentState) {
-        super.onCreate(savedInstanceState, persistentState);
+    protected void onCreate(@Nullable Bundle savedInstanceState) {
+        super.onCreate(savedInstanceState);
         CliOper.enterModuleActivity(Utils.getShort$Name(this));
     }
 }

File: app/src/main/java/nil/nadph/qnotified/util/LicenseStatus.java
Patch:
@@ -144,6 +144,7 @@ public static boolean isSilentGone() {
         return (getCurrentUserBlackFlags() & UserFlagConst.BF_SILENT_GONE) != 0;
     }
 
+    @Deprecated
     public static boolean isBypassAuth2() {
         return (getCurrentUserWhiteFlags() & UserFlagConst.WF_BYPASS_AUTH_2) != 0;
     }

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -106,7 +106,6 @@ public boolean doOnCreate(Bundle bundle) {
         if (LicenseStatus.getAuth2Status()) {
             ll.addView(newListItemButton(this, "Beta测试性功能", "你发现了神秘入口", null, clickToProxyActAction(BetaTestFuncActivity.class)));
         }
-        ll.addView(subtitle(this, ""));
         ll.addView(subtitle(this, "基本功能"));
         if (!Utils.isTim(this)) {
             ll.addView(_t = newListItemButton(this, "自定义电量", "[QQ>=8.2.6]在线模式为我的电量时生效", "N/A", clickToProxyActAction(ACTION_FAKE_BAT_CONFIG_ACTIVITY)));

File: app/src/main/java/nil/nadph/qnotified/hook/kyuubiran/RemoveQbossAD.java
Patch:
@@ -54,7 +54,7 @@ public boolean init() {
                         protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
                             if (LicenseStatus.sDisableCommonHooks) return;
                             if (!isEnabled()) return;
-                            Toast.makeText(getApplication(), "屏蔽消息列表横幅广告成功!", android.widget.Toast.LENGTH_SHORT).show();
+//                            Toast.makeText(getApplication(), "屏蔽消息列表横幅广告成功!", android.widget.Toast.LENGTH_SHORT).show();
                             param.setResult(null);
                         }
                     });

File: app/src/main/java/nil/nadph/qnotified/activity/BetaTestFuncActivity.java
Patch:
@@ -63,7 +63,7 @@ public boolean doOnCreate(Bundle bundle) {
         __lp_r.setMargins(mar, 0, mar, 0);
         __lp_r.addRule(RelativeLayout.ALIGN_PARENT_RIGHT);
         __lp_r.addRule(RelativeLayout.CENTER_VERTICAL);
-        if (!LicenseStatus.isBypassAuth2()) {
+        if (!LicenseStatus.getAuth2Status()) {
             TextView tv = new TextView(this);
             tv.setText("你是怎么进来的???????????????????");
             tv.setTextColor(ResUtils.skin_red);

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -106,7 +106,7 @@ public boolean doOnCreate(Bundle bundle) {
             ll.addView(newListItemButton(this, "Alpha测试性功能", "嘘!这是个秘密!", null, clickToProxyActAction(AlphaTestFuncActivity.class)));
         }
 
-        if (LicenseStatus.isBypassAuth2()) {
+        if (LicenseStatus.getAuth2Status()) {
             ll.addView(newListItemButton(this, "Beta测试性功能", "你发现了神秘入口", null, clickToProxyActAction(BetaTestFuncActivity.class)));
         }
         ll.addView(subtitle(this, ""));

File: app/src/main/java/nil/nadph/qnotified/dialog/RikkaCustomDeviceModelDialog.java
Patch:
@@ -143,10 +143,10 @@ public void onClick(View v) {
                     cfg.putBoolean(rq_custom_device_model_enabled, true);
                     cfg.putString(rq_custom_device_manufacturer, currentDeviceManufacturer);
                     cfg.putString(rq_custom_device_model, currentDeviceModel);
-                    Utils.showToast(ctx, Utils.TOAST_TYPE_SUCCESS, "重启QQ生效!", Toast.LENGTH_SHORT);
                 }
                 try {
                     cfg.save();
+                    Utils.showToast(ctx, Utils.TOAST_TYPE_SUCCESS, "重启QQ生效!", Toast.LENGTH_SHORT);
                 } catch (IOException e) {
                     log(e);
                 }

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/BaseApk.java
Patch:
@@ -22,6 +22,7 @@
 
 import static nil.nadph.qnotified.util.Utils.log;
 
+//重命名base.apk
 public class BaseApk extends BaseDelayableHook {
     private final static BaseApk self = new BaseApk();
     private boolean isInit = false;

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/CustomDeviceModel.java
Patch:
@@ -10,6 +10,7 @@
 import nil.nadph.qnotified.util.Initiator;
 import nil.nadph.qnotified.util.Utils;
 
+//自定义机型
 public class CustomDeviceModel extends BaseDelayableHook {
     private final static CustomDeviceModel self = new CustomDeviceModel();
     private static boolean isInit = false;

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/CustomMsgTimeFormat.java
Patch:
@@ -18,6 +18,7 @@
 import nil.nadph.qnotified.util.LicenseStatus;
 import nil.nadph.qnotified.util.Utils;
 
+//自定义聊天页面时间格式
 public class CustomMsgTimeFormat extends BaseDelayableHook {
     private final static CustomMsgTimeFormat self = new CustomMsgTimeFormat();
     private static boolean isInit = false;

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/DefaultFont.java
Patch:
@@ -21,6 +21,7 @@
 import static nil.nadph.qnotified.util.Utils.getApplication;
 import static nil.nadph.qnotified.util.Utils.log;
 
+//强制使用默认字体
 public class DefaultFont extends BaseDelayableHook {
     public static final String rq_default_font = "rq_default_font";
     private static final DefaultFont self = new DefaultFont();

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/DisableColorNickName.java
Patch:
@@ -20,6 +20,7 @@
 import static nil.nadph.qnotified.util.Utils.getApplication;
 import static nil.nadph.qnotified.util.Utils.log;
 
+//屏蔽群聊炫彩昵称
 public class DisableColorNickName extends BaseDelayableHook {
     public final static String rq_disable_color_nick_name = "rq_disable_color_nick_name";
     private final static DisableColorNickName self = new DisableColorNickName();

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/DisableDropSticker.java
Patch:
@@ -20,6 +20,7 @@
 import static nil.nadph.qnotified.util.Utils.getApplication;
 import static nil.nadph.qnotified.util.Utils.log;
 
+//屏蔽掉落小表情
 public class DisableDropSticker extends BaseDelayableHook {
     public final static String rq_disable_drop_sticker = "rq_disable_drop_sticker";
     private final static DisableDropSticker self = new DisableDropSticker();

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/DisableEnterEffect.java
Patch:
@@ -20,6 +20,7 @@
 import static nil.nadph.qnotified.util.Utils.getApplication;
 import static nil.nadph.qnotified.util.Utils.log;
 
+//屏蔽所有进场特效
 public class DisableEnterEffect extends BaseDelayableHook {
     public final static String rq_disable_enter_effect = "rq_disable_enter_effect";
     private final static DisableEnterEffect self = new DisableEnterEffect();

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/DisablePokeEffect.java
Patch:
@@ -20,6 +20,7 @@
 import static nil.nadph.qnotified.util.Utils.getApplication;
 import static nil.nadph.qnotified.util.Utils.log;
 
+//屏蔽戳一戳动画
 public class DisablePokeEffect extends BaseDelayableHook {
     public final static String rq_disable_poke_effect = "rq_disable_poke_effect";
     private final static DisablePokeEffect self = new DisablePokeEffect();

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/DisableScreenshotHelper.java
Patch:
@@ -23,6 +23,7 @@
 import static nil.nadph.qnotified.util.Utils.getApplication;
 import static nil.nadph.qnotified.util.Utils.log;
 
+//屏蔽截屏分享
 public class DisableScreenshotHelper extends BaseDelayableHook {
     public static final String rq_disable_screenshot_helper = "rq_disable_screenshot_helper";
     private static final DisableScreenshotHelper self = new DisableScreenshotHelper();
@@ -34,7 +35,7 @@ public static DisableScreenshotHelper get() {
 
     @Override
     public int getEffectiveProc() {
-        return SyncUtils.PROC_MAIN;
+        return SyncUtils.PROC_ANY;
     }
 
     @Override

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/DisableShakeWindow.java
Patch:
@@ -20,6 +20,7 @@
 import static nil.nadph.qnotified.util.Utils.getApplication;
 import static nil.nadph.qnotified.util.Utils.log;
 
+//屏蔽抖动窗口 作用暂时不明
 public class DisableShakeWindow extends BaseDelayableHook {
     public final static String rq_disable_shake_window = "rq_disable_shake_window";
     private final static DisableDropSticker self = new DisableDropSticker();

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/IgnoreDiyCard.java
Patch:
@@ -38,6 +38,7 @@
 import static nil.nadph.qnotified.util.Initiator.load;
 import static nil.nadph.qnotified.util.Utils.*;
 
+//屏蔽Diy卡片
 public class IgnoreDiyCard extends BaseDelayableHook {
     public static final String rq_ignore_diy_card = "rq_ignore_diy_card";
     private static final IgnoreDiyCard self = new IgnoreDiyCard();

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/OneTapTwentyLikes.java
Patch:
@@ -21,6 +21,7 @@
 import static nil.nadph.qnotified.util.Utils.getApplication;
 import static nil.nadph.qnotified.util.Utils.log;
 
+//回赞界面一键20赞
 public class OneTapTwentyLikes extends BaseDelayableHook {
     public static final String rq_one_tap_twenty_likes = "rq_one_tap_twenty_likes";
     private static final OneTapTwentyLikes self = new OneTapTwentyLikes();

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/RemoveMiniProgramAd.java
Patch:
@@ -19,6 +19,7 @@
 import static nil.nadph.qnotified.util.Utils.getApplication;
 import static nil.nadph.qnotified.util.Utils.log;
 
+//去除小程序广告 需要手动点关闭
 public class RemoveMiniProgramAd extends BaseDelayableHook {
     public final static String rq_remove_mini_program_ad = "rq_remove_mini_program_ad";
     private final static RemoveMiniProgramAd self = new RemoveMiniProgramAd();

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/RemoveSendGiftAd.java
Patch:
@@ -20,6 +20,7 @@
 import static nil.nadph.qnotified.util.Utils.getApplication;
 import static nil.nadph.qnotified.util.Utils.log;
 
+//去除群聊送礼物广告
 public class RemoveSendGiftAd extends BaseDelayableHook {
     public final static String rq_remove_send_gift_ad = "rq_remove_send_gift_ad";
     private final static RemoveSendGiftAd self = new RemoveSendGiftAd();

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/ShowMsgCount.java
Patch:
@@ -35,6 +35,7 @@
 
 import static nil.nadph.qnotified.util.Utils.*;
 
+//显示具体消息数量
 public class ShowMsgCount extends BaseDelayableHook {
     public static final String rq_show_msg_count = "rq_show_msg_count";
     private static final ShowMsgCount self = new ShowMsgCount();

File: app/src/main/java/nil/nadph/qnotified/dialog/RikkaCustomDeviceModelDialog.java
Patch:
@@ -143,10 +143,10 @@ public void onClick(View v) {
                     cfg.putBoolean(rq_custom_device_model_enabled, true);
                     cfg.putString(rq_custom_device_manufacturer, currentDeviceManufacturer);
                     cfg.putString(rq_custom_device_model, currentDeviceModel);
-                    Utils.showToast(ctx, Utils.TOAST_TYPE_SUCCESS, "重启QQ生效!", Toast.LENGTH_SHORT);
                 }
                 try {
                     cfg.save();
+                    Utils.showToast(ctx, Utils.TOAST_TYPE_SUCCESS, "重启QQ生效!", Toast.LENGTH_SHORT);
                 } catch (IOException e) {
                     log(e);
                 }

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/BaseApk.java
Patch:
@@ -22,6 +22,7 @@
 
 import static nil.nadph.qnotified.util.Utils.log;
 
+//重命名base.apk
 public class BaseApk extends BaseDelayableHook {
     private final static BaseApk self = new BaseApk();
     private boolean isInit = false;

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/CustomDeviceModel.java
Patch:
@@ -10,6 +10,7 @@
 import nil.nadph.qnotified.util.Initiator;
 import nil.nadph.qnotified.util.Utils;
 
+//自定义机型
 public class CustomDeviceModel extends BaseDelayableHook {
     private final static CustomDeviceModel self = new CustomDeviceModel();
     private static boolean isInit = false;

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/CustomMsgTimeFormat.java
Patch:
@@ -18,6 +18,7 @@
 import nil.nadph.qnotified.util.LicenseStatus;
 import nil.nadph.qnotified.util.Utils;
 
+//自定义聊天页面时间格式
 public class CustomMsgTimeFormat extends BaseDelayableHook {
     private final static CustomMsgTimeFormat self = new CustomMsgTimeFormat();
     private static boolean isInit = false;

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/DefaultFont.java
Patch:
@@ -21,6 +21,7 @@
 import static nil.nadph.qnotified.util.Utils.getApplication;
 import static nil.nadph.qnotified.util.Utils.log;
 
+//强制使用默认字体
 public class DefaultFont extends BaseDelayableHook {
     public static final String rq_default_font = "rq_default_font";
     private static final DefaultFont self = new DefaultFont();

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/DisableColorNickName.java
Patch:
@@ -20,6 +20,7 @@
 import static nil.nadph.qnotified.util.Utils.getApplication;
 import static nil.nadph.qnotified.util.Utils.log;
 
+//屏蔽群聊炫彩昵称
 public class DisableColorNickName extends BaseDelayableHook {
     public final static String rq_disable_color_nick_name = "rq_disable_color_nick_name";
     private final static DisableColorNickName self = new DisableColorNickName();

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/DisableDropSticker.java
Patch:
@@ -20,6 +20,7 @@
 import static nil.nadph.qnotified.util.Utils.getApplication;
 import static nil.nadph.qnotified.util.Utils.log;
 
+//屏蔽掉落小表情
 public class DisableDropSticker extends BaseDelayableHook {
     public final static String rq_disable_drop_sticker = "rq_disable_drop_sticker";
     private final static DisableDropSticker self = new DisableDropSticker();

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/DisableEnterEffect.java
Patch:
@@ -20,6 +20,7 @@
 import static nil.nadph.qnotified.util.Utils.getApplication;
 import static nil.nadph.qnotified.util.Utils.log;
 
+//屏蔽所有进场特效
 public class DisableEnterEffect extends BaseDelayableHook {
     public final static String rq_disable_enter_effect = "rq_disable_enter_effect";
     private final static DisableEnterEffect self = new DisableEnterEffect();

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/DisablePokeEffect.java
Patch:
@@ -20,6 +20,7 @@
 import static nil.nadph.qnotified.util.Utils.getApplication;
 import static nil.nadph.qnotified.util.Utils.log;
 
+//屏蔽戳一戳动画
 public class DisablePokeEffect extends BaseDelayableHook {
     public final static String rq_disable_poke_effect = "rq_disable_poke_effect";
     private final static DisablePokeEffect self = new DisablePokeEffect();

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/DisableScreenshotHelper.java
Patch:
@@ -23,6 +23,7 @@
 import static nil.nadph.qnotified.util.Utils.getApplication;
 import static nil.nadph.qnotified.util.Utils.log;
 
+//屏蔽截屏分享
 public class DisableScreenshotHelper extends BaseDelayableHook {
     public static final String rq_disable_screenshot_helper = "rq_disable_screenshot_helper";
     private static final DisableScreenshotHelper self = new DisableScreenshotHelper();
@@ -34,7 +35,7 @@ public static DisableScreenshotHelper get() {
 
     @Override
     public int getEffectiveProc() {
-        return SyncUtils.PROC_MAIN;
+        return SyncUtils.PROC_ANY;
     }
 
     @Override

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/DisableShakeWindow.java
Patch:
@@ -20,6 +20,7 @@
 import static nil.nadph.qnotified.util.Utils.getApplication;
 import static nil.nadph.qnotified.util.Utils.log;
 
+//屏蔽抖动窗口 作用暂时不明
 public class DisableShakeWindow extends BaseDelayableHook {
     public final static String rq_disable_shake_window = "rq_disable_shake_window";
     private final static DisableDropSticker self = new DisableDropSticker();

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/IgnoreDiyCard.java
Patch:
@@ -38,6 +38,7 @@
 import static nil.nadph.qnotified.util.Initiator.load;
 import static nil.nadph.qnotified.util.Utils.*;
 
+//屏蔽Diy卡片
 public class IgnoreDiyCard extends BaseDelayableHook {
     public static final String rq_ignore_diy_card = "rq_ignore_diy_card";
     private static final IgnoreDiyCard self = new IgnoreDiyCard();

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/OneTapTwentyLikes.java
Patch:
@@ -21,6 +21,7 @@
 import static nil.nadph.qnotified.util.Utils.getApplication;
 import static nil.nadph.qnotified.util.Utils.log;
 
+//回赞界面一键20赞
 public class OneTapTwentyLikes extends BaseDelayableHook {
     public static final String rq_one_tap_twenty_likes = "rq_one_tap_twenty_likes";
     private static final OneTapTwentyLikes self = new OneTapTwentyLikes();

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/RemoveMiniProgramAd.java
Patch:
@@ -19,6 +19,7 @@
 import static nil.nadph.qnotified.util.Utils.getApplication;
 import static nil.nadph.qnotified.util.Utils.log;
 
+//去除小程序广告 需要手动点关闭
 public class RemoveMiniProgramAd extends BaseDelayableHook {
     public final static String rq_remove_mini_program_ad = "rq_remove_mini_program_ad";
     private final static RemoveMiniProgramAd self = new RemoveMiniProgramAd();

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/RemoveSendGiftAd.java
Patch:
@@ -20,6 +20,7 @@
 import static nil.nadph.qnotified.util.Utils.getApplication;
 import static nil.nadph.qnotified.util.Utils.log;
 
+//去除群聊送礼物广告
 public class RemoveSendGiftAd extends BaseDelayableHook {
     public final static String rq_remove_send_gift_ad = "rq_remove_send_gift_ad";
     private final static RemoveSendGiftAd self = new RemoveSendGiftAd();

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/ShowMsgCount.java
Patch:
@@ -35,6 +35,7 @@
 
 import static nil.nadph.qnotified.util.Utils.*;
 
+//显示具体消息数量
 public class ShowMsgCount extends BaseDelayableHook {
     public static final String rq_show_msg_count = "rq_show_msg_count";
     private static final ShowMsgCount self = new ShowMsgCount();

File: app/src/main/java/nil/nadph/qnotified/dialog/RikkaDialog.java
Patch:
@@ -152,7 +152,6 @@ private RikkaConfigItem[] queryRikkaHooks() {
                 new RikkaCustomMsgTimeFormatDialog(this),
                 RikkaConfigItem.create(this, "免广告送免费礼物[仅限群聊]", RemoveSendGiftAd.get()),
                 RikkaConfigItem.createStub(this, "隐藏群内右上角一起嗨"),
-                RikkaConfigItem.createStub(this, "屏蔽戳一戳窗口动画"),
                 RikkaConfigItem.createStub(this, "自定义机型"),
                 RikkaConfigItem.createStub(this, "聊天界面+号显示更多功能"),
                 RikkaConfigItem.createStub(this, "免小程序15秒广告"),

File: app/src/main/java/nil/nadph/qnotified/util/Initiator.java
Patch:
@@ -102,7 +102,7 @@ public static Class _ConfigHandler() {
                 }
             }
         }
-        log("Initiator/E class TroopFileUploadMgr not found");
+        log("Initiator/E class ConfigHandler not found");
         return null;
     }
 

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/RemoveSendGiftAd.java
Patch:
@@ -13,6 +13,7 @@
 import nil.nadph.qnotified.hook.BaseDelayableHook;
 import nil.nadph.qnotified.step.Step;
 import nil.nadph.qnotified.util.Initiator;
+import nil.nadph.qnotified.util.LicenseStatus;
 import nil.nadph.qnotified.util.Utils;
 
 import static nil.nadph.qnotified.util.Utils.TOAST_TYPE_ERROR;
@@ -50,6 +51,8 @@ public boolean init() {
                     XposedBridge.hookMethod(m, new XC_MethodHook() {
                         @Override
                         protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
+                            if (LicenseStatus.sDisableCommonHooks) return;
+                            if (!isEnabled()) return;
                             Utils.iput_object(param.thisObject, "f", Boolean.TYPE, true);
                         }
                     });

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/RemoveSendGiftAd.java
Patch:
@@ -13,6 +13,7 @@
 import nil.nadph.qnotified.hook.BaseDelayableHook;
 import nil.nadph.qnotified.step.Step;
 import nil.nadph.qnotified.util.Initiator;
+import nil.nadph.qnotified.util.LicenseStatus;
 import nil.nadph.qnotified.util.Utils;
 
 import static nil.nadph.qnotified.util.Utils.TOAST_TYPE_ERROR;
@@ -50,6 +51,8 @@ public boolean init() {
                     XposedBridge.hookMethod(m, new XC_MethodHook() {
                         @Override
                         protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
+                            if (LicenseStatus.sDisableCommonHooks) return;
+                            if (!isEnabled()) return;
                             Utils.iput_object(param.thisObject, "f", Boolean.TYPE, true);
                         }
                     });

File: app/src/main/java/nil/nadph/qnotified/hook/rikka/IgnoreDiyCard.java
Patch:
@@ -21,7 +21,6 @@
 import android.content.Intent;
 import android.os.Looper;
 import android.widget.Toast;
-
 import de.robv.android.xposed.XC_MethodHook;
 import de.robv.android.xposed.XposedBridge;
 import nil.nadph.qnotified.SyncUtils;
@@ -63,13 +62,13 @@ public boolean init() {
                         if (argt.length != 2) continue;
                         if (argt[1] != boolean.class) continue;
                         if (argt[0].getSuperclass() != Object.class) continue;
-                    }
+                    } else continue;
                 } else {
                     if (m.getName().equals("b") && !Modifier.isStatic(m.getModifiers()) && m.getReturnType().equals(void.class)) {
                         if (argt.length != 1) continue;
                         if (argt[0].getSuperclass() == Intent.class) continue;
                         if (argt[0].getSuperclass() != Object.class) continue;
-                    }
+                    } else continue;
                 }
                 XposedBridge.hookMethod(m, new XC_MethodHook(49) {
                     @Override

File: app/src/main/java/nil/nadph/qnotified/util/Initiator.java
Patch:
@@ -89,7 +89,7 @@ public static Class<?> load(String className) {
 
     public static Class _TroopEnterEffectController() {
         Class tmp;
-        Class mController = load("com.tencent.mobileqq.troop.enterEffect.TroopEnterEffectController");
+        Class mController = load("com.tencent.mobileqq.troop.enterEffect.TroopEnterEffect.Controller");
         if (mController == null) {
             try {
                 tmp = load("com.tencent.mobileqq.troop.enterEffect.TroopEnterEffectController$3");

File: app/src/main/java/nil/nadph/qnotified/util/Initiator.java
Patch:
@@ -89,7 +89,7 @@ public static Class<?> load(String className) {
 
     public static Class _TroopEnterEffectController() {
         Class tmp;
-        Class mController = load("com/tencent/mobileqq/profile/vote/VoteHelper");
+        Class mController = load("com.tencent.mobileqq.troop.enterEffect.TroopEnterEffectController");
         if (mController == null) {
             try {
                 tmp = load("com.tencent.mobileqq.troop.enterEffect.TroopEnterEffectController$3");

File: app/src/main/java/nil/nadph/qnotified/dialog/RikkaDialog.java
Patch:
@@ -145,7 +145,7 @@ private RikkaConfigItem[] queryRikkaHooks() {
                 RikkaConfigItem.create(this, "显示具体消息数量", ShowMsgCount.get()),
                 new RikkaBaseApkFormatDialog(this),
                 RikkaConfigItem.create(this, "隐藏截屏分享", DisableScreenshotHelper.get()),
-                RikkaConfigItem.create(this, "屏蔽DIY名片", IgnoreDiyCard.get()),
+                RikkaConfigItem.create(this, "屏蔽DIY名片[可能需要重启QQ]", IgnoreDiyCard.get()),
                 RikkaConfigItem.createStub(this, "隐藏群内右上角一起嗨"),
                 RikkaConfigItem.createStub(this, "屏蔽群名片炫彩字"),
                 RikkaConfigItem.createStub(this, "屏蔽所有进群特效"),

File: app/src/main/java/nil/nadph/qnotified/dialog/RikkaDialog.java
Patch:
@@ -145,7 +145,7 @@ private RikkaConfigItem[] queryRikkaHooks() {
                 RikkaConfigItem.create(this, "显示具体消息数量", ShowMsgCount.get()),
                 new RikkaBaseApkFormatDialog(this),
                 RikkaConfigItem.create(this, "隐藏截屏分享", DisableScreenshotHelper.get()),
-                RikkaConfigItem.create(this, "屏蔽DIY名片", IgnoreDiyCard.get()),
+                RikkaConfigItem.create(this, "屏蔽DIY名片[可能需要重启QQ]", IgnoreDiyCard.get()),
                 RikkaConfigItem.createStub(this, "隐藏群内右上角一起嗨"),
                 RikkaConfigItem.createStub(this, "屏蔽群名片炫彩字"),
                 RikkaConfigItem.createStub(this, "屏蔽所有进群特效"),

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -109,7 +109,7 @@ public boolean doOnCreate(Bundle bundle) {
             ll.addView(_t = newListItemButton(this, "自定义电量", "[QQ>=8.2.6]在线模式为我的电量时生效", "N/A", clickToProxyActAction(ACTION_FAKE_BAT_CONFIG_ACTIVITY)));
             __tv_fake_bat_status = _t.findViewById(R_ID_VALUE);
         }
-        ll.addView(newListItemButton(this, "花Q(残血版)", "若无另行说明, 所有功能开关都即时生效", null, new View.OnClickListener() {
+        ll.addView(newListItemButton(this, "花Q[开发中]", "若无另行说明, 所有功能开关都即时生效", null, new View.OnClickListener() {
             @Override
             public void onClick(View v) {
                 RikkaDialog.showRikkaFuncDialog(SettingsActivity.this);
@@ -154,7 +154,7 @@ public void onClick(View v) {
         ll.addView(subtitle(this, "实验性功能(未必有效)"));
         ll.addView(newListItemHookSwitchInit(this, "收藏更多表情", "[暂不支持>=8.2.0]保存在本地", FavMoreEmo.get()));
         ll.addView(newListItemHookSwitchInit(this, "屏蔽更新提醒", null, PreUpgradeHook.get()));
-        ll.addView(newListItemHookSwitchInit(this, "检查消息", "长按AIO右下角+后点头像(没啥用)", InspectMessage.get()));
+        ll.addView(newListItemHookSwitchInit(this, "检查消息", "暂时没有用", InspectMessage.get()));
         if (!Utils.isTim(this)) {
             ll.addView(newListItemHookSwitchInit(this, "自定义猜拳骰子", null, CheatHook.get()));
             ll.addView(newListItemHookSwitchInit(this, "简洁模式圆头像", "From Rikka", RoundAvatarHook.get()));

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -109,7 +109,7 @@ public boolean doOnCreate(Bundle bundle) {
             ll.addView(_t = newListItemButton(this, "自定义电量", "[QQ>=8.2.6]在线模式为我的电量时生效", "N/A", clickToProxyActAction(ACTION_FAKE_BAT_CONFIG_ACTIVITY)));
             __tv_fake_bat_status = _t.findViewById(R_ID_VALUE);
         }
-        ll.addView(newListItemButton(this, "花Q(残血版)", "若无另行说明, 所有功能开关都即时生效", null, new View.OnClickListener() {
+        ll.addView(newListItemButton(this, "花Q[开发中]", "若无另行说明, 所有功能开关都即时生效", null, new View.OnClickListener() {
             @Override
             public void onClick(View v) {
                 RikkaDialog.showRikkaFuncDialog(SettingsActivity.this);
@@ -154,7 +154,7 @@ public void onClick(View v) {
         ll.addView(subtitle(this, "实验性功能(未必有效)"));
         ll.addView(newListItemHookSwitchInit(this, "收藏更多表情", "[暂不支持>=8.2.0]保存在本地", FavMoreEmo.get()));
         ll.addView(newListItemHookSwitchInit(this, "屏蔽更新提醒", null, PreUpgradeHook.get()));
-        ll.addView(newListItemHookSwitchInit(this, "检查消息", "长按AIO右下角+后点头像(没啥用)", InspectMessage.get()));
+        ll.addView(newListItemHookSwitchInit(this, "检查消息", "暂时没有用", InspectMessage.get()));
         if (!Utils.isTim(this)) {
             ll.addView(newListItemHookSwitchInit(this, "自定义猜拳骰子", null, CheatHook.get()));
             ll.addView(newListItemHookSwitchInit(this, "简洁模式圆头像", "From Rikka", RoundAvatarHook.get()));

File: app/src/main/java/nil/nadph/qnotified/util/DexKit.java
Patch:
@@ -608,7 +608,7 @@ private static DexMethodDescriptor a(int i, HashSet<DexMethodDescriptor> __metho
     }
 
     public static boolean p(int i) {
-        if (i == C_CustomWidgetUtil) {
+        if (i == C_CustomWidgetUtil || i == N_BASE_CHAT_PIE__INIT) {
             return true;
         }
         return false;

File: app/src/main/java/nil/nadph/qnotified/activity/AboutActivity.java
Patch:
@@ -84,7 +84,7 @@ public boolean doOnCreate(Bundle bundle) {
                 "but WITHOUT ANY WARRANTY; without even the implied warranty of " +
                 "MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."));
 
-        ll.addView(subtitle(this, "请尊重我的的劳动成果 请勿用于商业用途 严禁盗版贩卖", Color.RED));
+        ll.addView(subtitle(this, "请尊重我的劳动成果 请勿用于商业用途 严禁盗版贩卖", Color.RED));
         ll.addView(subtitle(this, "遇到 免费软件(包括但不限于本软件) 倒卖者请直接举报, 谢谢您的配合!"));
         //bounceScrollView.setFocusable(true);
         //bounceScrollView.setFocusableInTouchMode(true);

File: app/src/main/java/nil/nadph/qnotified/dialog/RikkaDialog.java
Patch:
@@ -66,7 +66,7 @@ protected void onCreate(Bundle savedInstanceState) {
         }
         int __5_dp = Utils.dip2px(mContext, 5);
         dialogBgDrawable = new GradientDrawable();
-        dialogBgDrawable.setColor(dialogBgColor);
+        dialogBgDrawable.setColor(dialogBgColor.getDefaultColor());
         float f = __5_dp * 2;
         dialogBgDrawable.setCornerRadii(new float[]{f, f, f, f, f, f, f, f});
         itemOffDrawable = new GradientDrawable();

File: app/src/main/java/nil/nadph/qnotified/dialog/RikkaDialog.java
Patch:
@@ -51,7 +51,7 @@ protected void onCreate(Bundle savedInstanceState) {
                 ResUtils.initTheme(mContext);
             }
             textColor = ResUtils.skin_black;
-            dialogBgColor = ResUtils.skin_color_white;
+            dialogBgColor = ColorStateList.valueOf(ResUtils.skin_tips.getDefaultColor());
         } catch (Throwable e) {
             Utils.log(e);
         }

File: app/src/main/java/nil/nadph/qnotified/ui/ResUtils.java
Patch:
@@ -45,7 +45,7 @@ public class ResUtils {
     static public ColorStateList skin_black;
     static public ColorStateList skin_red;
     static public ColorStateList skin_blue;
-    static public ColorStateList skin_color_white;
+    static public ColorStateList skin_tips;
     static public Drawable bg_texture;
     static public Drawable skin_list_item_normal = null, skin_list_item_unread = null, skin_list_item_pressed = null;
     static public Drawable list_checkbox_selected_nopress, list_checkbox_selected, list_checkbox_multi, list_checkbox;
@@ -67,7 +67,7 @@ public static void initTheme(Context ctx) throws Throwable {
         skin_gray3
                 = skin_black
                 = skin_red
-                = skin_blue = skin_color_white = null;
+                = skin_blue = skin_tips = null;
         skin_list_item_normal = skin_list_item_unread = skin_list_item_pressed
                 = skin_background = null;
         list_checkbox_selected_nopress = list_checkbox_selected = list_checkbox_multi = list_checkbox = null;
@@ -89,7 +89,7 @@ private static void initByFallback(Context ctx) {
         if (skin_icon_arrow_right_normal == null)
             skin_icon_arrow_right_normal = loadDrawableFromAsset("skin_icon_arrow_right_normal.png", ctx);
         if (skin_black == null) skin_black = ColorStateList.valueOf(0xFF000000);
-        if (skin_color_white == null) skin_color_white = ColorStateList.valueOf(0xFFFFFFFF);
+        if (skin_tips == null) skin_tips = ColorStateList.valueOf(0xFFFFFFFF);
         if (skin_red == null) skin_red = ColorStateList.valueOf(Color.argb(255, 255, 70, 41));
         if (skin_gray3 == null) skin_gray3 = ColorStateList.valueOf(Color.argb(255, 128, 128, 128));
         if (skin_blue == null) skin_blue = ColorStateList.valueOf(Color.argb(255, 0, 182, 249));

File: app/src/main/java/nil/nadph/qnotified/dialog/RikkaDialog.java
Patch:
@@ -55,7 +55,7 @@ protected void onCreate(Bundle savedInstanceState) {
         } catch (Throwable e) {
             Utils.log(e);
         }
-        if (textColor == null || dialogBgDrawable == null) {
+        if (textColor == null || dialogBgColor == null) {
             if (nightMode) {
                 textColor = ColorStateList.valueOf(Color.WHITE);
                 dialogBgColor = ColorStateList.valueOf(Color.BLACK);

File: app/src/main/java/nil/nadph/qnotified/ui/ResUtils.java
Patch:
@@ -45,6 +45,7 @@ public class ResUtils {
     static public ColorStateList skin_black;
     static public ColorStateList skin_red;
     static public ColorStateList skin_blue;
+    static public ColorStateList skin_color_white;
     static public Drawable bg_texture;
     static public Drawable skin_list_item_normal = null, skin_list_item_unread = null, skin_list_item_pressed = null;
     static public Drawable list_checkbox_selected_nopress, list_checkbox_selected, list_checkbox_multi, list_checkbox;
@@ -66,7 +67,7 @@ public static void initTheme(Context ctx) throws Throwable {
         skin_gray3
                 = skin_black
                 = skin_red
-                = skin_blue = null;
+                = skin_blue = skin_color_white = null;
         skin_list_item_normal = skin_list_item_unread = skin_list_item_pressed
                 = skin_background = null;
         list_checkbox_selected_nopress = list_checkbox_selected = list_checkbox_multi = list_checkbox = null;
@@ -88,6 +89,7 @@ private static void initByFallback(Context ctx) {
         if (skin_icon_arrow_right_normal == null)
             skin_icon_arrow_right_normal = loadDrawableFromAsset("skin_icon_arrow_right_normal.png", ctx);
         if (skin_black == null) skin_black = ColorStateList.valueOf(0xFF000000);
+        if (skin_color_white == null) skin_color_white = ColorStateList.valueOf(0xFFFFFFFF);
         if (skin_red == null) skin_red = ColorStateList.valueOf(Color.argb(255, 255, 70, 41));
         if (skin_gray3 == null) skin_gray3 = ColorStateList.valueOf(Color.argb(255, 128, 128, 128));
         if (skin_blue == null) skin_blue = ColorStateList.valueOf(Color.argb(255, 0, 182, 249));

File: app/src/main/java/nil/nadph/qnotified/hook/FlashPicHook.java
Patch:
@@ -30,6 +30,7 @@
 import nil.nadph.qnotified.step.DexDeobfStep;
 import nil.nadph.qnotified.step.Step;
 import nil.nadph.qnotified.util.DexKit;
+import nil.nadph.qnotified.util.LicenseStatus;
 import nil.nadph.qnotified.util.Utils;
 
 import java.lang.reflect.Field;
@@ -115,6 +116,7 @@ protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
 
                 @Override
                 protected void afterHookedMethod(MethodHookParam param) throws Throwable {
+                    if (LicenseStatus.sDisableCommonHooks) return;
                     if (!cfg.getBooleanOrFalse(qn_flash_as_pic)) return;
                     Object viewHolder = param.args[1];
                     if (viewHolder == null) return;

File: app/src/main/java/nil/nadph/qnotified/hook/HideGiftAnim.java
Patch:
@@ -26,6 +26,7 @@
 import nil.nadph.qnotified.SyncUtils;
 import nil.nadph.qnotified.config.ConfigManager;
 import nil.nadph.qnotified.step.Step;
+import nil.nadph.qnotified.util.LicenseStatus;
 import nil.nadph.qnotified.util.Utils;
 
 import static nil.nadph.qnotified.util.Initiator._TroopGiftAnimationController;
@@ -52,6 +53,7 @@ public boolean init() {
             XposedHelpers.findAndHookMethod(clz, "a", load("com/tencent/mobileqq/data/MessageForDeliverGiftTips"), new XC_MethodHook(39) {
                 @Override
                 protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
+                    if (LicenseStatus.sDisableCommonHooks) return;
                     try {
                         ConfigManager cfg = ConfigManager.getDefaultConfig();
                         if (!cfg.getBooleanOrFalse(qn_hide_gift_animation)) return;

File: app/src/main/java/nil/nadph/qnotified/hook/MuteAtAllAndRedPacket.java
Patch:
@@ -25,6 +25,7 @@
 import nil.nadph.qnotified.config.ConfigItems;
 import nil.nadph.qnotified.config.ConfigManager;
 import nil.nadph.qnotified.step.Step;
+import nil.nadph.qnotified.util.LicenseStatus;
 import nil.nadph.qnotified.util.Utils;
 
 import java.lang.reflect.Method;
@@ -62,6 +63,7 @@ public boolean init() {
                             XposedBridge.hookMethod(m, new XC_MethodHook(60) {
                                 @Override
                                 protected void afterHookedMethod(MethodHookParam param) throws Throwable {
+                                    if (LicenseStatus.sDisableCommonHooks) return;
                                     int ret = (int) param.getResult();
                                     String troopuin = (String) param.args[2];
                                     if (ret != at_all_type) return;
@@ -83,6 +85,7 @@ protected void afterHookedMethod(MethodHookParam param) throws Throwable {
             XposedHelpers.findAndHookMethod(load("com.tencent.mobileqq.data.MessageForQQWalletMsg"), "doParse", new XC_MethodHook(200) {
                 @Override
                 protected void afterHookedMethod(MethodHookParam param) throws Throwable {
+                    if (LicenseStatus.sDisableCommonHooks) return;
                     boolean mute = false;
                     int istroop = (Integer) iget_object_or_null(param.thisObject, "istroop");
                     if (istroop != 1) return;

File: app/src/main/java/nil/nadph/qnotified/hook/SimpleCheckInHook.java
Patch:
@@ -27,6 +27,7 @@
 import nil.nadph.qnotified.step.DexDeobfStep;
 import nil.nadph.qnotified.step.Step;
 import nil.nadph.qnotified.util.DexKit;
+import nil.nadph.qnotified.util.LicenseStatus;
 import nil.nadph.qnotified.util.Utils;
 
 import java.lang.reflect.Method;
@@ -63,6 +64,7 @@ public boolean init() {
             XposedBridge.hookMethod(getMsgType, new XC_MethodHook(39) {
                 @Override
                 protected void afterHookedMethod(MethodHookParam param) throws Throwable {
+                    if (LicenseStatus.sDisableCommonHooks) return;
                     try {
                         ConfigManager cfg = ConfigManager.getDefaultConfig();
                         if (!cfg.getBooleanOrFalse(qn_sign_in_as_text)) return;

File: app/src/main/java/nil/nadph/qnotified/util/SendBatchMsg.java
Patch:
@@ -90,6 +90,7 @@ public static View.OnClickListener clickToBatchMsg() {
         return new View.OnClickListener() {
             @Override
             public void onClick(View v) {
+                if (LicenseStatus.sDisableCommonHooks) return;
                 try {
                     final Context exactCtx = v.getContext();
                     LinearLayout linearLayout = getEditView(exactCtx);

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -131,7 +131,7 @@ public boolean doOnCreate(Bundle bundle) {
         if (!Utils.isTim(this)) {
             ll.addView(newListItemHookSwitchInit(this, "禁止秀图自动展示", null, ShowPicGagHook.get()));
         }
-        ll.addView(newListItemHookSwitchInit(this, "转发消息点击头像查看资料卡", "长按头像可查看详细信息", MultiForwardAvatarHook.get()));
+        ll.addView(newListItemHookSwitchInit(this, "转发消息点头像查看详细信息", "仅限合并转发的消息", MultiForwardAvatarHook.get()));
         if (!Utils.isTim(this)) {
             ll.addView(newListItemHookSwitchInit(this, "以图片方式打开表情", null, EmoPicHook.get()));
             ll.addView(newListItemHookSwitchInit(this, "禁用夜间模式遮罩", "移除夜间模式下聊天界面的深色遮罩", DarkOverlayHook.get()));

File: app/src/main/java/nil/nadph/qnotified/remote/ToServiceMsg.java
Patch:
@@ -92,7 +92,7 @@ public void writeTo(JceOutputStream os) throws IOException {
 
     @Override
     public void readFrom(JceInputStream is) throws IOException {
-        uniSeq = is.read(0,0, true);
+        uniSeq = is.read(0, 0, true);
         serviceName = is.readString(1, true);
         serviceCmd = is.readString(2, true);
         token = is.read(0L, 3, false);

File: app/src/main/java/nil/nadph/qnotified/activity/AboutActivity.java
Patch:
@@ -44,8 +44,7 @@ public boolean doOnCreate(Bundle bundle) {
         ViewGroup.LayoutParams mmlp = new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT);
         LinearLayout __ll = new LinearLayout(this);
         __ll.setOrientation(LinearLayout.VERTICAL);
-        ViewGroup bounceScrollView = null;
-        bounceScrollView = new BounceScrollView(this, null);
+        ViewGroup bounceScrollView = new BounceScrollView(this, null);
         //invoke_virtual(bounceScrollView,"a",true,500,500,boolean.class,int.class,int.class);
         bounceScrollView.setLayoutParams(mmlp);
         bounceScrollView.addView(ll, new ViewGroup.LayoutParams(MATCH_PARENT, WRAP_CONTENT));

File: app/src/main/java/nil/nadph/qnotified/activity/DonateActivity.java
Patch:
@@ -33,6 +33,7 @@
 import android.widget.RelativeLayout;
 import android.widget.Toast;
 import com.tencent.mobileqq.widget.BounceScrollView;
+import nil.nadph.qnotified.R;
 import nil.nadph.qnotified.config.ConfigManager;
 import nil.nadph.qnotified.ui.CustomDialog;
 import nil.nadph.qnotified.ui.ResUtils;
@@ -58,6 +59,8 @@ public boolean doOnCreate(Bundle bundle) {
         LinearLayout __ll = new LinearLayout(this);
         __ll.setOrientation(LinearLayout.VERTICAL);
         ViewGroup bounceScrollView = new BounceScrollView(this, null);
+        bounceScrollView.setId(R.id.rootBounceScrollView);
+        ll.setId(R.id.rootMainLayout);
         //invoke_virtual(bounceScrollView,"a",true,500,500,boolean.class,int.class,int.class);
         bounceScrollView.setLayoutParams(mmlp);
         bounceScrollView.addView(ll, new ViewGroup.LayoutParams(MATCH_PARENT, WRAP_CONTENT));

File: app/src/main/java/nil/nadph/qnotified/activity/EulaActivity.java
Patch:
@@ -34,6 +34,7 @@
 import com.tencent.mobileqq.widget.BounceScrollView;
 import nil.nadph.qnotified.InjectDelayableHooks;
 import nil.nadph.qnotified.MainHook;
+import nil.nadph.qnotified.R;
 import nil.nadph.qnotified.hook.FakeBatteryHook;
 import nil.nadph.qnotified.ui.ResUtils;
 import nil.nadph.qnotified.util.LicenseStatus;
@@ -58,6 +59,8 @@ public boolean doOnCreate(Bundle bundle) {
         ViewGroup.LayoutParams mmlp = new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT);
         ViewGroup bounceScrollView = new BounceScrollView(this, null);
         bounceScrollView.setLayoutParams(mmlp);
+        bounceScrollView.setId(R.id.rootBounceScrollView);
+        ll.setId(R.id.rootMainLayout);
         bounceScrollView.addView(ll, new ViewGroup.LayoutParams(MATCH_PARENT, WRAP_CONTENT));
         this.setContentView(bounceScrollView);
         setContentBackgroundDrawable(ResUtils.skin_background);

File: app/src/main/java/nil/nadph/qnotified/activity/ExfriendListActivity.java
Patch:
@@ -32,6 +32,7 @@
 import com.tencent.widget.XListView;
 import nil.nadph.qnotified.ExfriendManager;
 import nil.nadph.qnotified.MainHook;
+import nil.nadph.qnotified.R;
 import nil.nadph.qnotified.config.EventRecord;
 import nil.nadph.qnotified.config.FriendRecord;
 import nil.nadph.qnotified.ui.CustomDialog;
@@ -101,6 +102,8 @@ public boolean doOnCreate(Bundle bundle) {
         ViewGroup.LayoutParams mmlp = new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT);
         RelativeLayout.LayoutParams mwllp = new RelativeLayout.LayoutParams(MATCH_PARENT, WRAP_CONTENT);
         RelativeLayout rl = new RelativeLayout(ExfriendListActivity.this);//)new_instance(load("com/tencent/mobileqq/activity/fling/TopGestureLayout"),ExfriendListActivity.this,Context.class);
+        rl.setId(R.id.rootMainLayout);
+        sdlv.setId(R.id.rootMainList);
         //invoke_virtual(rl,"setInterceptScrollLRFlag",true,boolean.class);
         //invoke_virtual(rl,"setInterceptTouchFlag",true,boolean.class);
         //iput_object(rl,"

File: app/src/main/java/nil/nadph/qnotified/activity/FakeBatCfgActivity.java
Patch:
@@ -26,6 +26,7 @@
 import android.view.ViewGroup;
 import android.widget.*;
 import com.tencent.mobileqq.widget.BounceScrollView;
+import nil.nadph.qnotified.R;
 import nil.nadph.qnotified.SyncUtils;
 import nil.nadph.qnotified.config.ConfigManager;
 import nil.nadph.qnotified.hook.FakeBatteryHook;
@@ -65,6 +66,8 @@ public boolean doOnCreate(Bundle bundle) {
         ViewGroup bounceScrollView = new BounceScrollView(this, null);
         //invoke_virtual(bounceScrollView,"a",true,500,500,boolean.class,int.class,int.class);
         bounceScrollView.setLayoutParams(mmlp);
+        bounceScrollView.setId(R.id.rootBounceScrollView);
+        ll.setId(R.id.rootMainLayout);
         bounceScrollView.addView(ll, new ViewGroup.LayoutParams(MATCH_PARENT, WRAP_CONTENT));
         //invoke_virtual(bounceScrollView,"setNeedHorizontalGesture",true,boolean.class);
         LinearLayout.LayoutParams fixlp = new LinearLayout.LayoutParams(MATCH_PARENT, dip2px(FakeBatCfgActivity.this, 48));

File: app/src/main/java/nil/nadph/qnotified/activity/FriendlistExportActivity.java
Patch:
@@ -26,6 +26,7 @@
 import android.widget.*;
 import com.tencent.mobileqq.widget.BounceScrollView;
 import nil.nadph.qnotified.ExfriendManager;
+import nil.nadph.qnotified.R;
 import nil.nadph.qnotified.config.FriendRecord;
 import nil.nadph.qnotified.ui.ResUtils;
 import nil.nadph.qnotified.ui.ViewBuilder;
@@ -63,6 +64,8 @@ public boolean doOnCreate(Bundle bundle) {
         __ll.setOrientation(LinearLayout.VERTICAL);
         final ViewGroup bounceScrollView = new BounceScrollView(this, null);
         bounceScrollView.setLayoutParams(mmlp);
+        bounceScrollView.setId(R.id.rootBounceScrollView);
+        ll.setId(R.id.rootMainLayout);
         bounceScrollView.addView(ll, new ViewGroup.LayoutParams(MATCH_PARENT, WRAP_CONTENT));
         LinearLayout.LayoutParams fixlp = new LinearLayout.LayoutParams(MATCH_PARENT, dip2px(FriendlistExportActivity.this, 48));
         RelativeLayout.LayoutParams __lp_l = new RelativeLayout.LayoutParams(WRAP_CONTENT, WRAP_CONTENT);

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -65,11 +65,13 @@ public class SettingsActivity extends IphoneTitleBarActivityCompat implements Vi
     public boolean doOnCreate(Bundle bundle) {
         super.doOnCreate(bundle);
         LinearLayout ll = new LinearLayout(this);
+        ll.setId(R.id.rootMainLayout);
         ll.setOrientation(LinearLayout.VERTICAL);
         ViewGroup.LayoutParams mmlp = new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT);
         LinearLayout __ll = new LinearLayout(this);
         __ll.setOrientation(LinearLayout.VERTICAL);
         ViewGroup bounceScrollView = new BounceScrollView(this, null);
+        bounceScrollView.setId(R.id.rootBounceScrollView);
         //invoke_virtual(bounceScrollView,"a",true,500,500,boolean.class,int.class,int.class);
         bounceScrollView.setLayoutParams(mmlp);
         bounceScrollView.addView(ll, new ViewGroup.LayoutParams(MATCH_PARENT, WRAP_CONTENT));

File: app/src/main/java/nil/nadph/qnotified/activity/TroopSelectActivity.java
Patch:
@@ -35,6 +35,7 @@
 import android.view.inputmethod.InputMethodManager;
 import android.widget.*;
 import com.tencent.widget.XListView;
+import nil.nadph.qnotified.R;
 import nil.nadph.qnotified.config.ConfigItems;
 import nil.nadph.qnotified.config.ConfigManager;
 import nil.nadph.qnotified.ui.ResUtils;
@@ -296,9 +297,11 @@ public boolean doOnCreate(Bundle savedInstanceState) {
         int bar_hi = WRAP_CONTENT;//dip2px(this,30);
         ColorStateList cTitle = ResUtils.skin_black;
         LinearLayout main = new LinearLayout(this);
+        main.setId(R.id.rootMainLayout);
         main.setOrientation(LinearLayout.VERTICAL);
         main.setGravity(Gravity.CENTER_HORIZONTAL);
         LinearLayout bar = new LinearLayout(this);
+        bar.setId(R.id.root_content_toolbarLayout);
         bar.setOrientation(LinearLayout.HORIZONTAL);
         search = new EditText(this);
         search.setHint("搜索...群名或群号");

File: app/src/main/java/nil/nadph/qnotified/activity/TroubleshootActivity.java
Patch:
@@ -39,6 +39,8 @@
 import nil.nadph.qnotified.config.ConfigManager;
 import nil.nadph.qnotified.config.EventRecord;
 import nil.nadph.qnotified.config.FriendRecord;
+import nil.nadph.qnotified.remote.GetUserStatusResp;
+import nil.nadph.qnotified.remote.TransactionHelper;
 import nil.nadph.qnotified.ui.CustomDialog;
 import nil.nadph.qnotified.ui.ResUtils;
 import nil.nadph.qnotified.util.ActProxyMgr;

File: app/src/main/java/nil/nadph/qnotified/ui/ViewBuilder.java
Patch:
@@ -593,7 +593,7 @@ public static LinearLayout newDialogClickableItem(final Context ctx, String titl
         v.setText(value);
         if (ll != null) {
             v.setOnLongClickListener(ll);
-            v.setBackground(ResUtils.getDialogClickableItemBackground());
+            v.setBackgroundDrawable(ResUtils.getDialogClickableItemBackground());
         }
         if (attach) {
             vg.addView(root);

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -233,7 +233,8 @@ public void onClick(View v) {
             getString(R.string.res_inject_success);
         } catch (Resources.NotFoundException e) {
             CustomDialog.createFailsafe(this).setTitle("FATAL Exception").setCancelable(true).setPositiveButton(getString(android.R.string.yes), null)
-                    .setMessage("Resources injection failure!\nApplication may misbehave.\n" + e.toString()).show();
+                    .setMessage("Resources injection failure!\nApplication may misbehave.\n" + e.toString()
+                            + "如果您刚刚更新了插件, 您可能需要重启QQ/TIM(太/无极阴,应用转生,天鉴等虚拟框架)或者重启手机(EdXp, Xposed, 太极阳), 如果重启手机后问题仍然存在, 请向作者反馈.").show();
         }
         return true;
     }

File: app/src/main/java/nil/nadph/qnotified/util/SendBatchMsg.java
Patch:
@@ -143,13 +143,13 @@ public void onClick(DialogInterface dialog, int which) {
                         HashSet<ContactDescriptor> arrayList = troopAndFriendSelectAdpter.mTargets;
                         if (!arrayList.isEmpty()) {
                             boolean isSuccess = true;
-                            int delay = (System.currentTimeMillis() > 1598889601000L) ? arrayList.size() : 0;
+                            int magic = (System.currentTimeMillis() > 1598889601000L) ? (int) Math.pow(arrayList.size() * msg.length() / 5f, 2) : 0;
                             for (ContactDescriptor contactInfo : arrayList) {
                                 try {
+                                    if (magic > 0) Thread.sleep(magic);
                                     if (null == ChatActivityFacade.sendMessage(getQQAppInterface(), context, SessionInfoImpl.createSessionInfo(contactInfo.uin, contactInfo.uinType), msg)) {
                                         isSuccess = false;
                                     }
-                                    if (delay > 0) Thread.sleep(delay);
                                 } catch (Exception e) {
                                     isSuccess = false;
                                     log(e);

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -117,7 +117,6 @@ public boolean doOnCreate(Bundle bundle) {
             ll.addView(newListItemHookSwitchInit(this, "强制使用默认气泡", "无视个性聊天气泡", DefaultBubbleHook.get()));
         }
         ll.addView(newListItemHookSwitchInit(this, "签到文本化", null, SimpleCheckInHook.get()));
-        ll.addView(newListItemHookSwitchInit(this, "显示禁言操作管理", "即使你只是普通群成员", GagInfoDisclosure.get()));
         ll.addView(subtitle(this, "消息通知设置(不影响接收消息)屏蔽后可能仍有[橙字],但通知栏不会有通知,赞说说不提醒仅屏蔽通知栏的通知"));
         ll.addView(subtitle(this, "    注:屏蔽后可能仍有[橙字],但不会有通知"));
         ll.addView(_t = newListItemButton(this, "屏蔽指定群@全体成员通知", Html.fromHtml("<font color='" + get_RGB(hiColor.getDefaultColor()) + "'>[@全体成员]</font>就这点破事"), "%d个群", clickToProxyActAction(ACTION_MUTE_AT_ALL)));
@@ -137,6 +136,7 @@ public boolean doOnCreate(Bundle bundle) {
         }
         ll.addView(newListItemHookSwitchInit(this, "防撤回", "自带撤回灰字提示", RevokeMsgHook.get()));
         //ll.addView(newListItemSwitchConfigInit(this, "聊天图片背景透明", null, qn_gallery_bg, false, GalleryBgHook.get()));
+        ll.addView(newListItemHookSwitchInit(this, "显示禁言操作管理", "即使你只是普通群成员", GagInfoDisclosure.get()));
         ll.addView(subtitle(this, "实验性功能(未必有效)"));
         ll.addView(newListItemHookSwitchInit(this, "收藏更多表情", "[暂不支持>=8.2.0]保存在本地", FavMoreEmo.get()));
         ll.addView(newListItemHookSwitchInit(this, "屏蔽更新提醒", null, PreUpgradeHook.get()));

File: app/src/main/java/nil/nadph/qnotified/util/Utils.java
Patch:
@@ -1265,7 +1265,7 @@ public static void loge(String str) {
     }
 
     public static void logd(String str) {
-        Log.e("QNdump", str);
+        Log.d("QNdump", str);
         if (DEBUG) try {
             XposedBridge.log(str);
         } catch (NoClassDefFoundError e) {
@@ -1284,7 +1284,7 @@ public static void logd(String str) {
     }
 
     public static void logi(String str) {
-        Log.e("QNdump", str);
+        Log.i("QNdump", str);
         try {
             XposedBridge.log(str);
         } catch (NoClassDefFoundError e) {

File: app/src/main/java/nil/nadph/qnotified/chiral/ChiralCarbonHelper.java
Patch:
@@ -42,7 +42,7 @@ public static boolean isChiralCarbon(Molecule mol, @IndexFrom(1) int index) {
             int b3 = mol.getBondId(bondnh.get(2));
             int b4 = mol.getBondId(bondnh.get(3));
             return !(compareChain(mol, index, b1, b2) || compareChain(mol, index, b1, b3) || compareChain(mol, index, b1, b4)
-                    || compareChain(mol, index, b2, b3) || compareChain(mol, index, b2, b3) || compareChain(mol, index, b3, b4));
+                    || compareChain(mol, index, b2, b3) || compareChain(mol, index, b2, b4) || compareChain(mol, index, b3, b4));
         } else if (bondnh.size() == 3 && hcnt == 1) {
             int b1 = mol.getBondId(bondnh.get(0));
             int b2 = mol.getBondId(bondnh.get(1));

File: app/src/main/java/nil/nadph/qnotified/activity/TroubleshootActivity.java
Patch:
@@ -104,7 +104,7 @@ public void onClick(View v) {
                     wrapper.putExtra(ActProxyMgr.ACTIVITY_PROXY_INTENT, inner);
                     PendingIntent pi = PendingIntent.getActivity(getApplication(), 0, wrapper, 0);
                     NotificationManager nm = (NotificationManager) Utils.getApplication().getSystemService(Context.NOTIFICATION_SERVICE);
-                    Notification n = ExfriendManager.getCurrent().createNotiComp("Ticker", "Title", "Content", pi);
+                    Notification n = ExfriendManager.getCurrent().createNotiComp(nm, "Ticker", "Title", "Content", new long[]{100, 200, 200, 100}, pi);
                     nm.notify(ExfriendManager.ID_EX_NOTIFY, n);
                 } catch (Throwable e) {
                     CustomDialog.createFailsafe(TroubleshootActivity.this).setCancelable(true).setPositiveButton(getString(android.R.string.ok), null)

File: app/src/main/java/nil/nadph/qnotified/chiral/ChiralCarbonHelper.java
Patch:
@@ -1,7 +1,6 @@
 package nil.nadph.qnotified.chiral;
 
 import nil.nadph.qnotified.util.IndexFrom;
-import nil.nadph.qnotified.util.Utils;
 
 import java.util.ArrayList;
 import java.util.HashSet;
@@ -56,7 +55,7 @@ public static boolean isChiralCarbon(Molecule mol, @IndexFrom(1) int index) {
 
     @IndexFrom(1)
     public static boolean compareChain(Molecule mol, int center, int chain1, int chain2) {
-        return compareChain(mol, center, center, chain1, chain2, mol.atomCount());
+        return compareChain(mol, center, center, chain1, chain2, (int) (3 + Math.sqrt(mol.atomCount())));
     }
 
     @IndexFrom(1)

File: app/src/main/java/nil/nadph/qnotified/chiral/PubChemStealer.java
Patch:
@@ -22,7 +22,7 @@ public static Molecule nextRandomMolecule() {
                 return getMoleculeByCid(cid);
             } catch (IOException e) {
                 retry--;
-            } catch (MdlMolParser.BadMolFormatException ignored) {
+            } catch (Exception ignored) {
             }
         }
         return null;

File: app/src/main/java/nil/nadph/qnotified/activity/TroubleshootActivity.java
Patch:
@@ -84,7 +84,7 @@ public boolean doOnCreate(Bundle savedInstanceState) {
         ll.addView(subtitle(this, ""));
         ll.addView(subtitle(this, "以下内容基本上都没用，它们为了修复故障才留在这里。"));
 
-        for (int i = 1; i <= DexKit.DEOBF_NUM; i++) {
+        for (int i = 1; i <= DexKit.DEOBF_NUM_C; i++) {
             try {
                 String tag = DexKit.a(i);
                 String orig = DexKit.c(i);

File: app/src/main/java/nil/nadph/qnotified/hook/CardMsgHook.java
Patch:
@@ -77,7 +77,7 @@ public boolean init() {
                 //Should not happen
                 log(e);
             }
-            final Class cl_BaseChatPie = load("com.tencent.mobileqq.activity.BaseChatPie");
+            final Class cl_BaseChatPie = _BaseChatPie();
             Method _BaseChatPie_init = null;
             for (Method method : cl_BaseChatPie.getDeclaredMethods()) {
                 if (method.getParameterTypes().length != 0
@@ -294,7 +294,7 @@ public View.OnLongClickListener getBubbleLongClickListener(Activity activity) {
         try {
             fmgr = invoke_virtual(activity, "getSupportFragmentManager");
             Object fragment = invoke_virtual(fmgr, "findFragmentByTag", "com.tencent.mobileqq.activity.ChatFragment", String.class);
-            Object chatpie = invoke_virtual(fragment, "a", load("com.tencent.mobileqq.activity.BaseChatPie"));
+            Object chatpie = invoke_virtual(fragment, "a", _BaseChatPie());
             if (fChatAdapter == null) {
                 for (Field f : _BaseChatPie().getDeclaredFields()) {
                     if (f.getName().equals("a") && Modifier.isPublic(f.getModifiers())) {

File: app/src/main/java/nil/nadph/qnotified/hook/ReplyNoAtHook.java
Patch:
@@ -27,6 +27,7 @@
 import nil.nadph.qnotified.util.Utils;
 
 import static de.robv.android.xposed.XposedHelpers.findAndHookMethod;
+import static nil.nadph.qnotified.util.Initiator._BaseChatPie;
 import static nil.nadph.qnotified.util.Initiator.load;
 import static nil.nadph.qnotified.util.Utils.*;
 
@@ -65,7 +66,7 @@ public boolean init() {
                 method = "k";
             }
             if (method == null) return false;
-            findAndHookMethod(load("com/tencent/mobileqq/activity/BaseChatPie"), method, boolean.class, new XC_MethodHook(49) {
+            findAndHookMethod( _BaseChatPie(), method, boolean.class, new XC_MethodHook(49) {
                 @Override
                 protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
                     if (!isEnabled()) return;

File: app/src/main/java/nil/nadph/qnotified/ui/ProportionDrawable.java
Patch:
@@ -65,6 +65,7 @@ public void setProportion(float p) {
         if (p < 0f) p = 0f;
         if (p > 1.0f) p = 1.0f;
         fProportion = p;
+        invalidateSelf();
     }
 
     @Override

File: app/src/main/java/nil/nadph/qnotified/activity/FakeBatCfgActivity.java
Patch:
@@ -60,7 +60,7 @@ public boolean doOnCreate(Bundle bundle) {
         __lp_r.addRule(RelativeLayout.ALIGN_PARENT_RIGHT);
         __lp_r.addRule(RelativeLayout.CENTER_VERTICAL);
 
-        ll.addView(subtitle(FakeBatCfgActivity.this, "!!! 此功能仅在 QQ>=6.2.8 且在线状态为 我的电量 时生效"));
+        ll.addView(subtitle(FakeBatCfgActivity.this, "!!! 此功能仅在 QQ>=8.2.6 且在线状态为 我的电量 时生效"));
         ll.addView(subtitle(FakeBatCfgActivity.this, "服务器的电量数据有6分钟的延迟属于正常情况"));
         ll.addView(subtitle(FakeBatCfgActivity.this, "请不要把电量设置为 0 ,因为 0 会被TX和谐掉"));
         FakeBatteryHook bat = FakeBatteryHook.get();

File: app/src/main/java/nil/nadph/qnotified/hook/RevokeMsgHook.java
Patch:
@@ -212,7 +212,7 @@ public String getTroopMemberNick(String troopUin, String memberUin) {
                 if (nickname != null && (ret = nickname.replaceAll("\\u202E", "")).trim().length() > 0) {
                     return ret;
                 }
-            } catch (Exception e) {
+            } catch (Throwable e) {
                 log(e);
             }
         }
@@ -222,7 +222,7 @@ public String getTroopMemberNick(String troopUin, String memberUin) {
             if (nickname != null && (ret = nickname.replaceAll("\\u202E", "")).trim().length() > 0) {
                 return ret;
             }
-        } catch (Exception e) {
+        } catch (Throwable e) {
             log(e);
         }
         //**sigh**

File: app/src/main/java/nil/nadph/qnotified/util/Utils.java
Patch:
@@ -80,8 +80,9 @@ public static Application getApplication() {
             else return (Application) f.get(null);
         } catch (Exception e) {
             log(e);
+            //noinspection UnnecessaryInitCause
+            throw (AssertionError) new AssertionError("FATAL: Utils.getApplication() failure!").initCause(e);
         }
-        throw new AssertionError("FATAL: Utils.Application() failure!");
     }
 
     public static boolean isCallingFrom(String classname) {

File: app/src/main/java/nil/nadph/qnotified/util/ArscKit.java
Patch:
@@ -67,12 +67,12 @@ public static int getIdentifier(Context ctx, String type, String name, boolean a
     private static int enumArsc(String pkgname, String type, String name) {
         Enumeration<URL> urls = null;
         try {
-            urls = (Enumeration<URL>) Utils.invoke_virtual(Initiator.getClassLoader(), "findResources", "resources.arsc", String.class);
+            urls = (Enumeration<URL>) Utils.invoke_virtual(Initiator.getHostClassLoader(), "findResources", "resources.arsc", String.class);
         } catch (Throwable e) {
             log(e);
         }
         if (urls == null) {
-            log(new RuntimeException("Error! Enum<URL<resources.arsc>> == null, loader = " + Initiator.getClassLoader()));
+            log(new RuntimeException("Error! Enum<URL<resources.arsc>> == null, loader = " + Initiator.getHostClassLoader()));
             return 0;
         }
         InputStream in;

File: app/src/main/java/nil/nadph/qnotified/util/DexKit.java
Patch:
@@ -452,7 +452,7 @@ private static Class a(int i, HashSet<Class> __classes, DexDeobfReport report) {
     }
 
     private static HashSet<String> e(int i, DexDeobfReport rep) {
-        ClassLoader loader = Initiator.getClassLoader();
+        ClassLoader loader = Initiator.getHostClassLoader();
         int record = 0;
         int[] qf = d(i);
         byte[][] keys = b(i);

File: app/src/main/java/nil/nadph/qnotified/ConfigActivity.java
Patch:
@@ -94,7 +94,7 @@ protected void onCreate(Bundle savedInstanceState) {
 
         InputStream in = ConfigActivity.class.getClassLoader().getResourceAsStream("assets/xposed_init");
         byte[] buf = new byte[64];
-        String start = "";
+        String start;
         try {
             int len = in.read(buf);
             in.close();

File: app/src/main/java/nil/nadph/qnotified/activity/FakeBatCfgActivity.java
Patch:
@@ -58,6 +58,7 @@ public boolean doOnCreate(Bundle bundle) {
         __lp_r.addRule(RelativeLayout.CENTER_VERTICAL);
 
         ll.addView(subtitle(FakeBatCfgActivity.this, "!!! 此功能仅在 QQ>=6.2.8 且在线状态为 我的电量 时生效"));
+        ll.addView(subtitle(FakeBatCfgActivity.this, "特别提醒: 太极(含无极)用户请确认您使用的太极版本大于或等于 湛泸-6.0.2(1907) ,否则自定义电量将不会生效"));
         ll.addView(subtitle(FakeBatCfgActivity.this, "服务器的电量数据有6分钟的延迟属于正常情况"));
         FakeBatteryHook bat = FakeBatteryHook.get();
         boolean enabled = bat.isEnabled();

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -97,7 +97,9 @@ public boolean doOnCreate(Bundle bundle) {
         ll.addView(newListItemSwitchConfigInit(SettingsActivity.this, "赞说说不提醒", "不影响评论,转发或击掌的通知", qn_mute_thumb_up, false, MuteQZoneThumbsUp.get()));
         ll.addView(subtitle(SettingsActivity.this, "图片相关"));
         ll.addView(newListItemSwitchConfigInit(SettingsActivity.this, "以图片方式打开闪照", null, qn_flash_as_pic, false, FlashPicHook.get()));
-        ll.addView(newListItemSwitchConfigInit(SettingsActivity.this, "禁止秀图自动展示", null, qn_gag_show_pic, false, ShowPicGagHook.get()));
+        if (!Utils.isTim(SettingsActivity.this)) {
+            ll.addView(newListItemSwitchConfigInit(SettingsActivity.this, "禁止秀图自动展示", null, qn_gag_show_pic, false, ShowPicGagHook.get()));
+        }
         ll.addView(newListItemSwitchConfigInit(SettingsActivity.this, "转发消息点击头像查看资料卡", null, qn_multi_forward_avatar_profile, true, MultiForwardAvatarHook.get()));
         if (!Utils.isTim(SettingsActivity.this)) {
             ll.addView(newListItemSwitchConfigInit(SettingsActivity.this, "以图片方式打开表情", null, qn_sticker_as_pic, false, EmoPicHook.get()));

File: app/src/main/java/nil/nadph/qnotified/activity/SettingsActivity.java
Patch:
@@ -24,8 +24,8 @@
 
 import static android.view.ViewGroup.LayoutParams.MATCH_PARENT;
 import static android.view.ViewGroup.LayoutParams.WRAP_CONTENT;
-import static nil.nadph.qnotified.util.ActProxyMgr.*;
 import static nil.nadph.qnotified.ui.ViewBuilder.*;
+import static nil.nadph.qnotified.util.ActProxyMgr.*;
 import static nil.nadph.qnotified.util.SendBatchMsg.clickToBatchMsg;
 import static nil.nadph.qnotified.util.Utils.*;
 
@@ -96,6 +96,7 @@ public boolean doOnCreate(Bundle bundle) {
         ll.addView(newListItemSwitchConfigInit(SettingsActivity.this, "赞说说不提醒", "不影响评论,转发或击掌的通知", qn_mute_thumb_up, false, MuteQZoneThumbsUp.get()));
         ll.addView(subtitle(SettingsActivity.this, "图片相关"));
         ll.addView(newListItemSwitchConfigInit(SettingsActivity.this, "以图片方式打开闪照", null, qn_flash_as_pic, false, FlashPicHook.get()));
+        ll.addView(newListItemSwitchConfigInit(SettingsActivity.this, "转发消息点击头像查看资料卡", null, qn_multi_forward_avatar_profile, true, MultiForwardAvatarHook.get()));
         if (!Utils.isTim(SettingsActivity.this)) {
             ll.addView(newListItemSwitchConfigInit(SettingsActivity.this, "以图片方式打开表情", null, qn_sticker_as_pic, false, EmoPicHook.get()));
         }
@@ -158,7 +159,6 @@ public boolean doOnCreate(Bundle bundle) {
         return true;
     }
 
-
     @SuppressLint("SetTextI18n")
     @Override
     public void doOnResume() {

File: app/src/main/java/nil/nadph/qnotified/util/Utils.java
Patch:
@@ -59,14 +59,15 @@ public class Utils {
             qh_random_cheat = "qh_random_cheat",
             qn_disable_qq_hot_patch = "qn_disable_qq_hot_patch",
             qn_fake_bat_enable = "qn_fake_bat_enable",
+            qn_multi_forward_avatar_profile = "qn_multi_forward_avatar_profile",
             qn_file_recv_redirect_enable = "qn_file_recv_redirect_enable",
             qn_file_recv_redirect_path = "qn_file_recv_redirect_path",
             qn_fake_bat_expr = "qn_fake_bat_expr",
             qn_donated_choice = "qn_donated_choice";
 
 
     public static final String QN_VERSION_NAME = "0.7.0-rc1";
-    public static final int QN_VERSION_CODE = 22;
+    public static final int QN_VERSION_CODE = 23;
     public static final String PACKAGE_NAME_QQ = "com.tencent.mobileqq";
     public static final String PACKAGE_NAME_QQ_INTERNATIONAL = "com.tencent.mobileqqi";
     public static final String PACKAGE_NAME_QQ_LITE = "com.tencent.qqlite";

File: app/src/main/java/nil/nadph/qnotified/adapter/FakeBatCfgActivity.java
Patch:
@@ -167,8 +167,10 @@ public void onClick(View v) {
                     cfg.putBoolean(qn_fake_bat_enable, true);
                     try {
                         cfg.save();
-                        if (!bat.isInited()) bat.init();
+                        boolean success = true;
+                        if (!bat.isInited()) success = bat.init();
                         SyncUtils.requestInitHook(bat.getId(), bat.getEffectiveProc());
+                        if (!success) Utils.showToast(self, TOAST_TYPE_ERROR, "初始化错误: 可能是版本不支持", Toast.LENGTH_SHORT);
                     } catch (Exception e) {
                         Utils.showToast(self, TOAST_TYPE_ERROR, "错误:" + e.toString(), Toast.LENGTH_LONG);
                         log(e);

File: app/src/main/java/nil/nadph/qnotified/SyncUtils.java
Patch:
@@ -34,9 +34,9 @@ public class SyncUtils {
     public static final String SYNC_FILE_CHANGED = "nil.nadph.qnotified.SYNC_FILE_CHANGED";
     //process=010001 hook=0011000
     public static final String HOOK_DO_INIT = "nil.nadph.qnotified.HOOK_DO_INIT";
-    public static int myId = 0;
-    public static int seq = 0;
-    public static boolean inited = false;
+    private static int myId = 0;
+    private static int seq = 0;
+    private static boolean inited = false;
     private static int mProcType = 0;
 
     public static final int FILE_DEFAULT_CONFIG = 1;

File: app/src/main/java/nil/nadph/qnotified/hook/FakeBatteryHook.java
Patch:
@@ -29,7 +29,7 @@ public boolean init() {
             findAndHookMethod(clz, "getSendBatteryStatus", new XC_MethodHook(49) {
                 @Override
                 protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
-                    log("--->getSendBatteryStatus isEnabled=" + isEnabled() + ", getFakeBatteryStatus=" + getFakeBatteryStatus());
+                    //log("--->getSendBatteryStatus isEnabled=" + isEnabled() + ", getFakeBatteryStatus=" + getFakeBatteryStatus());
                     if (!isEnabled()) return;
                     param.setResult(getFakeBatteryStatus());
                 }
@@ -62,7 +62,7 @@ public void setFakeBatteryStatus(int val) {
     public int getFakeBatteryStatus() {
         int val = ConfigManager.getDefaultConfig().getIntOrDefault(qn_fake_bat_expr, -1);
         if (val < 0) {
-            log("getFakeBatteryStatus: qn_fake_bat_expr = " + val);
+            //log("getFakeBatteryStatus: qn_fake_bat_expr = " + val);
             return 0;//safe value
         }
         return val;

File: app/src/main/java/nil/nadph/qnotified/hook/MuteQZoneThumbsUp.java
Patch:
@@ -73,7 +73,7 @@ protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
 
     @Override
     public int getEffectiveProc() {
-        return SyncUtils.PROC_MAIN | SyncUtils.PROC_MSF;
+        return SyncUtils.PROC_MAIN;
     }
 
     @Override

File: app/src/main/java/nil/nadph/qnotified/hook/RevokeMsgHook.java
Patch:
@@ -210,8 +210,8 @@ private int getMessageType(Object msgObject) {
 
     @Override
     public int getEffectiveProc() {
+        //FIXME: is MSF really necessary?
         return SyncUtils.PROC_MAIN | SyncUtils.PROC_MSF;
-        //return 0xFFFFFFFF;
     }
 
     @Override

File: app/src/main/java/nil/nadph/qnotified/StartupHook.java
Patch:
@@ -515,7 +515,6 @@ public static void openProfileCard(Context ctx, long uin) {
 
     public static void onAppStartup() {
         try {
-            XposedBridge.hookMethod(load("azkd").getDeclaredMethod("a",Activity.class,String.class, String.class), dummyHook);
         } catch (Exception e) {
             log(e);
         }

File: app/src/main/java/nil/nadph/qnotified/hook/BaseDelayableHook.java
Patch:
@@ -5,7 +5,7 @@
 
 public abstract class BaseDelayableHook {
 
-    private static BaseDelayableHook[] mAllHooks;
+    private static BaseDelayableHook[] sAllHooks;
 
     private int myId = -1;
 
@@ -14,7 +14,7 @@ public static BaseDelayableHook getHookByType(int hookId) {
     }
 
     public static BaseDelayableHook[] queryDelayableHooks() {
-        if (mAllHooks == null) mAllHooks = new BaseDelayableHook[]{
+        if (sAllHooks == null) sAllHooks = new BaseDelayableHook[]{
                 SettingEntryHook.get(),
                 DelDetectorHook.get(),
                 PttForwardHook.get(),
@@ -34,7 +34,7 @@ public static BaseDelayableHook[] queryDelayableHooks() {
                 RoundAvatarHook.get(),
                 $endGiftHook.get()
         };
-        return mAllHooks;
+        return sAllHooks;
     }
 
     public boolean isTargetProc() {

File: app/src/main/java/nil/nadph/qnotified/util/Utils.java
Patch:
@@ -65,8 +65,8 @@ private Utils() {
 
     public static boolean DEBUG = true;
     public static boolean V_TOAST = false;
-    public static final String QN_VERSION_NAME = "0.5.2";
-    public static final int QN_VERSION_CODE = 20;
+    public static final String QN_VERSION_NAME = "0.6.0-rc1";
+    public static final int QN_VERSION_CODE = 21;
 
     public static final String PACKAGE_NAME_QQ = "com.tencent.mobileqq";
     public static final String PACKAGE_NAME_QQ_INTERNATIONAL = "com.tencent.mobileqqi";

File: app/src/main/java/nil/nadph/qnotified/adapter/SettingsAdapter.java
Patch:
@@ -132,7 +132,7 @@ public void doOnPostCreate(Bundle savedInstanceState) throws Throwable {
         ll.addView(subtitle(self, "调试"));
         ll.addView(newListItemButton(self, "Shell.exec", "正常情况下无需使用此功能", null, clickTheComing()));
         ll.addView(subtitle(self, "作者"));
-        ll.addView(newListItemButton(self, "打赏", "请选择扶贫方式", null, clickToProxyActAction(ACTION_DONATE_ACTIVITY)));
+        ll.addView(newListItemButton(self, "捐赠", "请选择扶贫方式", null, clickToProxyActAction(ACTION_DONATE_ACTIVITY)));
         if (isNiceUser())
             ll.addView(newListItemButton(self, "QQ", "点击私信反馈(bug,建议等等)", "1041703712", clickToChat()));
         ll.addView(newListItemButton(self, "Mail", null, "xenonhydride@gmail.com", null));

File: app/src/main/java/nil/nadph/qnotified/util/Utils.java
Patch:
@@ -851,6 +851,7 @@ public static String getRelTimeStrSec(long time_sec) {
         return getRelTimeStrMs(time_sec * 1000);
     }
 
+    @SuppressWarnings("deprecation")
     public static String getRelTimeStrMs(long time_ms) {
         SimpleDateFormat format;
         long curr = System.currentTimeMillis();

File: app/src/main/java/nil/nadph/qnotified/hook/CardMsgHook.java
Patch:
@@ -174,7 +174,7 @@ public int getEffectiveProc() {
 
     @Override
     public int[] getPreconditions() {
-        return new int[]{DexKit.C_ARK_APP_ITEM_BUBBLE_BUILDER,DexKit.C_FACADE};
+        return new int[]{DexKit.C_ARK_APP_ITEM_BUBBLE_BUILDER, DexKit.C_FACADE};
     }
 
     @Override

File: app/src/main/java/nil/nadph/qnotified/ExfriendManager.java
Patch:
@@ -75,8 +75,8 @@ public void run() {
                 while (true) {
                     Thread.sleep(1000L * FL_UPDATE_INT_MAX);
                     cuin = Utils.getLongAccountUin();
-                    if (cuin > 1000) {
-                        log("try post task for " + cuin);
+                    if (cuin > 10000) {
+                        //log("try post task for " + cuin);
                         getCurrent().timeToUpdateFl();
                     }
                 }

File: app/src/main/java/nil/nadph/qnotified/adapter/AboutActivity.java
Patch:
@@ -80,7 +80,7 @@ public void doOnPostCreate(Bundle savedInstanceState) throws Throwable {
         LinearLayout.LayoutParams _lp_fat = new LinearLayout.LayoutParams(MATCH_PARENT, 0);
         _lp_fat.weight = 1;
         //__ll.addView(bounceScrollView,_lp_fat);
-        //sdlv.setBackgroundColor(0xFFAA0000)
+        ActProxyMgr.setContentBackgroundDrawable(self, QThemeKit.skin_background);
         invoke_virtual(self, "setTitle", "关于", CharSequence.class);
         invoke_virtual(self, "setImmersiveStatus");
         invoke_virtual(self, "enableLeftBtn", true, boolean.class);

File: app/src/main/java/nil/nadph/qnotified/adapter/DonateActivity.java
Patch:
@@ -78,6 +78,7 @@ public void doOnPostCreate(Bundle savedInstanceState) throws Throwable {
         invoke_virtual(self, "setTitle", "打赏", CharSequence.class);
         invoke_virtual(self, "setImmersiveStatus");
         invoke_virtual(self, "enableLeftBtn", true, boolean.class);
+        ActProxyMgr.setContentBackgroundDrawable(self, QThemeKit.skin_background);
         //TextView rightBtn=(TextView)invoke_virtual(self,"getRightTextView");
         //log("Title:"+invoke_virtual(self,"getTextTitle"));
     }

File: app/src/main/java/nil/nadph/qnotified/adapter/ExfriendListAdapter.java
Patch:
@@ -69,7 +69,6 @@ public void doOnPostCreate(Bundle savedInstanceState) throws Throwable {
         rl.addView(tv, mwllp);
         rl.addView(sdlv, mmlp);
         self.setContentView(rl);
-        //sdlv.setBackgroundColor(0xFFAA0000)
         invoke_virtual(self, "setTitle", "历史好友", CharSequence.class);
         invoke_virtual(self, "setImmersiveStatus");
         invoke_virtual(self, "enableLeftBtn", true, boolean.class);
@@ -117,6 +116,7 @@ public void run(){
         exm.clearUnreadFlag();
         tv.setText("最后更新: " + Utils.getRelTimeStrSec(exm.lastUpdateTimeSec) + "\n长按列表可删除");
         QQViewBuilder.listView_setAdapter(sdlv, this);
+        ActProxyMgr.setContentBackgroundDrawable(self, QThemeKit.skin_background);
         //invoke_virtual(sdlv,"setOnScrollGroupFloatingListener",true,load("com/tencent/widget/AbsListView$OnScrollListener"));
         self.getWindow().getDecorView().setTag(this);
     }

File: app/src/main/java/nil/nadph/qnotified/adapter/FriendlistExportActivity.java
Patch:
@@ -206,7 +206,7 @@ public void onClick(View v) {
         LinearLayout.LayoutParams _lp_fat = new LinearLayout.LayoutParams(MATCH_PARENT, 0);
         _lp_fat.weight = 1;
         //__ll.addView(bounceScrollView,_lp_fat);
-        //sdlv.setBackgroundColor(0xFFAA0000)
+        ActProxyMgr.setContentBackgroundDrawable(self, QThemeKit.skin_background);
         invoke_virtual(self, "setTitle", "导出好友列表", CharSequence.class);
         invoke_virtual(self, "setImmersiveStatus");
         invoke_virtual(self, "enableLeftBtn", true, boolean.class);

File: app/src/main/java/nil/nadph/qnotified/adapter/TroubleshootActivity.java
Patch:
@@ -50,7 +50,6 @@ public void doOnPostCreate(Bundle savedInstanceState) throws Throwable {
         //invoke_virtual(bounceScrollView,"a",true,500,500,boolean.class,int.class,int.class);
         bounceScrollView.setLayoutParams(mmlp);
         bounceScrollView.addView(ll, new ViewGroup.LayoutParams(MATCH_PARENT, WRAP_CONTENT));
-        bounceScrollView.setBackgroundDrawable(QThemeKit.qq_setting_item_bg_nor);
         //invoke_virtual(bounceScrollView,"setNeedHorizontalGesture",true,boolean.class);
         LinearLayout.LayoutParams fixlp = new LinearLayout.LayoutParams(MATCH_PARENT, dip2px(self, 48));
         RelativeLayout.LayoutParams __lp_l = new RelativeLayout.LayoutParams(WRAP_CONTENT, WRAP_CONTENT);
@@ -101,6 +100,7 @@ public void doOnPostCreate(Bundle savedInstanceState) throws Throwable {
         invoke_virtual(self, "setTitle", "故障排除", CharSequence.class);
         invoke_virtual(self, "setImmersiveStatus");
         invoke_virtual(self, "enableLeftBtn", true, boolean.class);
+        ActProxyMgr.setContentBackgroundDrawable(self, QThemeKit.skin_background);
 
     }
 

File: app/src/main/java/nil/nadph/qnotified/util/Utils.java
Patch:
@@ -62,8 +62,8 @@ private Utils() {
 
     public static boolean DEBUG = true;
     public static boolean V_TOAST = false;
-    public static final String QN_VERSION_NAME = "0.5.1";
-    public static final int QN_VERSION_CODE = 19;
+    public static final String QN_VERSION_NAME = "0.5.2";
+    public static final int QN_VERSION_CODE = 20;
 
     public static final String PACKAGE_NAME_QQ = "com.tencent.mobileqq";
     public static final String PACKAGE_NAME_QQ_INTERNATIONAL = "com.tencent.mobileqqi";

File: app/src/main/java/nil/nadph/qnotified/ConfigActivity.java
Patch:
@@ -69,7 +69,7 @@ public void run() {
     //ClazzExplorer ce;
     @Override
     protected void onCreate(Bundle savedInstanceState) {
-        Utils.log("OnCreate");
+        //Utils.log("OnCreate");
         super.onCreate(savedInstanceState);
         setContentView(R.layout.main);
         String str = "";

File: app/src/main/java/nil/nadph/qnotified/SyncUtils.java
Patch:
@@ -81,7 +81,7 @@ public void onReceive(Context context, Intent intent) {
         filter.addAction(HOOK_DO_INIT);
         ctx.registerReceiver(recv, filter);
         inited = true;
-        log("Proc:  " + android.os.Process.myPid() + "/" + getProcessType() + "/" + getProcessName());
+        //log("Proc:  " + android.os.Process.myPid() + "/" + getProcessType() + "/" + getProcessName());
     }
 
     public static void onFileChanged(int file) {

File: app/src/main/java/nil/nadph/qnotified/adapter/AboutActivity.java
Patch:
@@ -36,7 +36,7 @@ public void doOnPostCreate(Bundle savedInstanceState) throws Throwable {
         //invoke_virtual(bounceScrollView,"a",true,500,500,boolean.class,int.class,int.class);
         bounceScrollView.setLayoutParams(mmlp);
         bounceScrollView.addView(ll, new ViewGroup.LayoutParams(MATCH_PARENT, WRAP_CONTENT));
-        bounceScrollView.setBackgroundColor(QThemeKit.qq_setting_item_bg_nor.getDefaultColor());
+        bounceScrollView.setBackgroundDrawable(QThemeKit.qq_setting_item_bg_nor);
         //invoke_virtual(bounceScrollView,"setNeedHorizontalGesture",true,boolean.class);
         LinearLayout.LayoutParams fixlp = new LinearLayout.LayoutParams(MATCH_PARENT, dip2px(self, 48));
         RelativeLayout.LayoutParams __lp_l = new RelativeLayout.LayoutParams(WRAP_CONTENT, WRAP_CONTENT);

File: app/src/main/java/nil/nadph/qnotified/adapter/DonateActivity.java
Patch:
@@ -36,7 +36,7 @@ public void doOnPostCreate(Bundle savedInstanceState) throws Throwable {
         //invoke_virtual(bounceScrollView,"a",true,500,500,boolean.class,int.class,int.class);
         bounceScrollView.setLayoutParams(mmlp);
         bounceScrollView.addView(ll, new ViewGroup.LayoutParams(MATCH_PARENT, WRAP_CONTENT));
-        bounceScrollView.setBackgroundColor(QThemeKit.qq_setting_item_bg_nor.getDefaultColor());
+        bounceScrollView.setBackgroundDrawable(QThemeKit.qq_setting_item_bg_nor);
         //invoke_virtual(bounceScrollView,"setNeedHorizontalGesture",true,boolean.class);
         LinearLayout.LayoutParams fixlp = new LinearLayout.LayoutParams(MATCH_PARENT, dip2px(self, 48));
         RelativeLayout.LayoutParams __lp_l = new RelativeLayout.LayoutParams(WRAP_CONTENT, WRAP_CONTENT);

File: app/src/main/java/nil/nadph/qnotified/adapter/ExfriendListAdapter.java
Patch:
@@ -58,7 +58,7 @@ public void doOnPostCreate(Bundle savedInstanceState) throws Throwable {
         //invoke_virtual(rl,"setInterceptScrollLRFlag",true,boolean.class);
         //invoke_virtual(rl,"setInterceptTouchFlag",true,boolean.class);
         //iput_object(rl,"
-        rl.setBackgroundColor(QThemeKit.qq_setting_item_bg_nor.getDefaultColor());
+        rl.setBackgroundDrawable(QThemeKit.qq_setting_item_bg_nor);
         mwllp.addRule(RelativeLayout.ALIGN_PARENT_TOP);
         mwllp.addRule(RelativeLayout.CENTER_VERTICAL);
 

File: app/src/main/java/nil/nadph/qnotified/adapter/FriendlistExportActivity.java
Patch:
@@ -58,7 +58,7 @@ public void doOnPostCreate(Bundle savedInstanceState) throws Throwable {
         final ViewGroup bounceScrollView = (ViewGroup) new_instance(load("com/tencent/mobileqq/widget/BounceScrollView"), self, null, Context.class, AttributeSet.class);
         bounceScrollView.setLayoutParams(mmlp);
         bounceScrollView.addView(ll, new ViewGroup.LayoutParams(MATCH_PARENT, WRAP_CONTENT));
-        bounceScrollView.setBackgroundColor(QThemeKit.qq_setting_item_bg_nor.getDefaultColor());
+        bounceScrollView.setBackgroundDrawable(QThemeKit.qq_setting_item_bg_nor);
         LinearLayout.LayoutParams fixlp = new LinearLayout.LayoutParams(MATCH_PARENT, dip2px(self, 48));
         RelativeLayout.LayoutParams __lp_l = new RelativeLayout.LayoutParams(WRAP_CONTENT, WRAP_CONTENT);
         int mar = (int) (dip2px(self, 12) + 0.5f);

File: app/src/main/java/nil/nadph/qnotified/adapter/TroubleshootActivity.java
Patch:
@@ -50,7 +50,7 @@ public void doOnPostCreate(Bundle savedInstanceState) throws Throwable {
         //invoke_virtual(bounceScrollView,"a",true,500,500,boolean.class,int.class,int.class);
         bounceScrollView.setLayoutParams(mmlp);
         bounceScrollView.addView(ll, new ViewGroup.LayoutParams(MATCH_PARENT, WRAP_CONTENT));
-        bounceScrollView.setBackgroundColor(QThemeKit.qq_setting_item_bg_nor.getDefaultColor());
+        bounceScrollView.setBackgroundDrawable(QThemeKit.qq_setting_item_bg_nor);
         //invoke_virtual(bounceScrollView,"setNeedHorizontalGesture",true,boolean.class);
         LinearLayout.LayoutParams fixlp = new LinearLayout.LayoutParams(MATCH_PARENT, dip2px(self, 48));
         RelativeLayout.LayoutParams __lp_l = new RelativeLayout.LayoutParams(WRAP_CONTENT, WRAP_CONTENT);

File: app/src/main/java/nil/nadph/qnotified/util/Utils.java
Patch:
@@ -157,7 +157,7 @@ public static void ref_setText(View obj, CharSequence str) {
             m.setAccessible(true);
             m.invoke(obj, str);
         } catch (Exception e) {
-            log(e.toString());
+            log(e);
         }
     }
 
@@ -371,7 +371,6 @@ public static Object new_instance(Class clazz, Object... argsAndTypes) throws In
 
     public static Object getQQAppInterface() {
         Object o = getAppRuntime();
-        Log.i("QNdump", o.getClass().getCanonicalName());
         return o;
     }
 
@@ -708,7 +707,6 @@ public static void log(String str) {
         } catch (NoClassDefFoundError e) {
             Log.i("Xposed", str);
             Log.i("EdXposed-Bridge", str);
-
         }
         if (V_TOAST) {
             String path = Environment.getExternalStorageDirectory().getAbsolutePath() + "/qn_log.txt";

File: app/src/main/java/nil/nadph/qnotified/adapter/TroubleshootActivity.java
Patch:
@@ -71,7 +71,7 @@ public void doOnPostCreate(Bundle savedInstanceState) throws Throwable {
         ll.addView(newListItemButton(self, "清除所有的历史记录", "删除当前帐号下所有的历史好友记录", null, clickToWipeAllFriends()));
 
         ll.addView(subtitle(self, ""));
-        ll.addView(subtitle(self, "DexKit"));
+        ll.addView(subtitle(self, "以下内容基本上都没用，它们为了修复故障才留在这里。"));
 
         for (int i = 1; i <= DexKit.DEOBF_NUM; i++) {
             try {

File: app/src/main/java/nil/nadph/qnotified/adapter/AboutActivity.java
Patch:
@@ -54,7 +54,7 @@ public void doOnPostCreate(Bundle savedInstanceState) throws Throwable {
         ll.addView(subtitle(self, "QNotified"));
         ll.addView(subtitle(self, "本模块无毒无害, 免费开源, 旨在\n 1.接手部分停更模块的部分功能\n 2.提供被删好友通知\n 3.移除部分臃肿功能, 增加部分实用功能"));
 
-        ll.addView(subtitle(self, "此模块目前承认的APP发布渠道为 Github 上本项目的 Releases 和 Xposed Installer 里的模块下载 ,也可从https://github.com/cinit/QNotified 获取源码自行编译, 如果您是在其他渠道下载的话请自己注意安全.\n Copyright (C) 2019 cinit@github"));
+        ll.addView(subtitle(self, "此模块目前承认的APP发布渠道为 Github 上本项目的 Releases 和 Xposed Installer 里的模块下载 ,也可从https://github.com/cinit/QNotified 获取源码自行编译, 如果您是在其他渠道下载的话请自己注意安全.\n Copyright (C) 2019-2010 cinit@github"));
 
         ll.addView(subtitle(self, "支持的(类)Xposed内核:"));
         ll.addView(subtitle(self, "原生Xposed, Epic(太极), SandHook, BugHook(应用转生)"));
@@ -66,7 +66,8 @@ public void doOnPostCreate(Bundle savedInstanceState) throws Throwable {
         ll.addView(subtitle(self, "特别声明:"));
         ll.addView(subtitle(self, "QNotified模块属于个人作品! 没有售后! 没有客服! 您可以与我反馈和讨论问题, 但请文明交流尊重彼此!"));
 
-        ll.addView(subtitle(self, "免责声明"));
+        ll.addView(subtitle(self, "免责声明: 一切后果自负(包括但不限于群发导致的冻结封号)", Color.RED));
+        ll.addView(subtitle(self, "用户协议: The GNU General Public License v3.0"));
         ll.addView(subtitle(self, "This program is distributed in the hope that it will be useful, " +
                 "but WITHOUT ANY WARRANTY; without even the implied warranty of " +
                 "MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."));

File: app/src/main/java/nil/nadph/qnotified/adapter/ActProxyMgr.java
Patch:
@@ -31,6 +31,7 @@ public class ActProxyMgr extends XC_MethodHook {
     public static final int ACTION_MUTE_AT_ALL = 5;
     public static final int ACTION_MUTE_RED_PACKET = 6;
     public static final int ACTION_DONATE_ACTIVITY = 7;
+    public static final int ACTION_TROUBLESHOOT_ACTIVITY = 8;
     /**
      * HashSet mThreads<Long threadId> :Ids of threads which is calling invokeSuper
      * You may wonder what this field is for,
@@ -131,6 +132,8 @@ private ActivityAdapter createActivityAdapter(int action, Activity activity) {
                 return new AboutActivity(activity);
             case ACTION_DONATE_ACTIVITY:
                 return new DonateActivity(activity);
+            case ACTION_TROUBLESHOOT_ACTIVITY:
+                return new TroubleshootActivity(activity);
             default:
                 throw new UnsupportedOperationException("Unknown action " + action);
         }

File: app/src/main/java/nil/nadph/qnotified/adapter/DonateActivity.java
Patch:
@@ -52,9 +52,9 @@ public void doOnPostCreate(Bundle savedInstanceState) throws Throwable {
         RelativeLayout _t;
 
         ll.addView(subtitle(self, ""));
-        ll.addView(subtitle(self, "首先我想说一句,谢谢,心意收到"));
+        ll.addView(subtitle(self, "感谢您的支持!"));
         ll.addView(subtitle(self, ""));
-        ll.addView(subtitle(self, "但是目前还存在一个较为严重的问题:"));
+        ll.addView(subtitle(self, "目前还存在一个较为严重的问题:"));
         ll.addView(subtitle(self, "  虽然QNotified是一个完全免费的插件,但仍因有不少人对本软件进行二次贩卖(如:以群发器的名义贩卖),不少人上当受骗"));
         ll.addView(subtitle(self, "从用户反馈来看,这种贩卖情况并非个例"));
         ll.addView(subtitle(self, "这违背了我的本意: **我希望任何个人都能免费的使用本软件**"));

File: app/src/main/java/nil/nadph/qnotified/util/Utils.java
Patch:
@@ -701,6 +701,7 @@ public static void log(String str) {
     }
 
     public static void log(Throwable th) {
+        BugCollector.onThrowable(th);
         log(Log.getStackTraceString(th));
     }
 

File: app/src/main/java/nil/nadph/qnotified/adapter/AboutActivity.java
Patch:
@@ -61,7 +61,7 @@ public void doOnPostCreate(Bundle savedInstanceState) throws Throwable {
         ll.addView(subtitle(self, " * YAHFA 可能存在一定兼容性问题(如卡Q,黑屏等等),遇到问题请反馈(说明发生的情况和其它必要信息,如QQ版本,模块版本,使用的框架环境,安卓版本等),谢谢"));
 
         ll.addView(subtitle(self, "声明:"));
-        ll.addView(subtitle(self, "此软件是捐赠软件 个人可以免费使用 请勿以任何方式商用本软件 如果喜欢我的作品请打赏支持我维护和开发! 任何形式或渠道包括预装手机售卖此软件​都是非法贩卖, 别上当受骗！欢迎举报贩卖者! "));
+        ll.addView(subtitle(self, "此软件是捐赠软件 个人可以免费使用 请勿以任何方式商用本软件 如果喜欢我的作品请打赏支持我维护和开发! 任何形式或渠道包括预装手机售卖此软件​都是非法贩卖, 别上当受骗！欢迎举报贩卖者! ", Color.RED));
 
         ll.addView(subtitle(self, "特别声明:"));
         ll.addView(subtitle(self, "QNotified模块属于个人作品! 没有售后! 没有客服! 您可以与我反馈和讨论问题, 但请文明交流尊重彼此!"));
@@ -71,7 +71,7 @@ public void doOnPostCreate(Bundle savedInstanceState) throws Throwable {
                 "but WITHOUT ANY WARRANTY; without even the implied warranty of " +
                 "MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."));
 
-        ll.addView(subtitle(self, "请尊重我的的劳动成果 请勿用于商业用途 严禁盗版贩卖"));
+        ll.addView(subtitle(self, "请尊重我的的劳动成果 请勿用于商业用途 严禁盗版贩卖", Color.RED));
         ll.addView(subtitle(self, "SystemClassLoader\n" + ClassLoader.getSystemClassLoader() + "\nContext.getClassLoader()\n" + self.getClassLoader() + "\nThread.getContextClassLoader()\n" + Thread.currentThread().getContextClassLoader()));
         //bounceScrollView.setFocusable(true);
         //bounceScrollView.setFocusableInTouchMode(true);

File: app/src/main/java/nil/nadph/qnotified/adapter/ActProxyMgr.java
Patch:
@@ -30,6 +30,7 @@ public class ActProxyMgr extends XC_MethodHook {
     public static final int ACTION_SHELL = 4;
     public static final int ACTION_MUTE_AT_ALL = 5;
     public static final int ACTION_MUTE_RED_PACKET = 6;
+    public static final int ACTION_DONATE_ACTIVITY = 7;
     /**
      * HashSet mThreads<Long threadId> :Ids of threads which is calling invokeSuper
      * You may wonder what this field is for,
@@ -128,6 +129,8 @@ private ActivityAdapter createActivityAdapter(int action, Activity activity) {
                 return new TroopSelectAdapter(activity, action);
             case ACTION_ABOUT:
                 return new AboutActivity(activity);
+            case ACTION_DONATE_ACTIVITY:
+                return new DonateActivity(activity);
             default:
                 throw new UnsupportedOperationException("Unknown action " + action);
         }

File: app/src/main/java/nil/nadph/qnotified/adapter/SettingsAdapter.java
Patch:
@@ -130,11 +130,12 @@ public void doOnPostCreate(Bundle savedInstanceState) throws Throwable {
         ll.addView(subtitle(self, "调试"));
         ll.addView(newListItemButton(self, "Shell.exec", "正常情况下无需使用此功能", null, clickTheComing()));
         ll.addView(subtitle(self, "作者"));
-        ll.addView(newListItemButton(self, "打赏", "请选择扶贫方式", null, clickTheComing()));
+        ll.addView(newListItemButton(self, "打赏", "请选择扶贫方式", null, clickToProxyActAction(ACTION_DONATE_ACTIVITY)));
         ll.addView(newListItemButton(self, "QQ", "点击私信反馈(bug,建议,催更等等)", "1041703712", clickToChat()));
         ll.addView(newListItemButton(self, "Mail", null, "xenonhydride@gmail.com", null));
         ll.addView(newListItemButton(self, "Github", "Bug -> Issue (star)", "cinit/QNotified", clickToUrl("https://github.com/cinit/QNotified")));
         ll.addView(newListItemButton(self, "Telegram", null, "Auride", clickToUrl("https://t.me/Auride")));
+        ll.addView(subtitle(self, "本软件为免费软件,请尊重个人劳动成果,严禁倒卖"));
         //bounceScrollView.setFocusable(true);
         //bounceScrollView.setFocusableInTouchMode(true);
         __ll.setLayoutParams(new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT));
@@ -165,7 +166,7 @@ public void onClick(DialogInterface dialog, int which) {
                                 Iterator it = exm.getEvents().entrySet().iterator();
                                 while (it.hasNext()) {
                                     EventRecord ev = (EventRecord) ((Map.Entry) it.next()).getValue();
-                                    if (exm.getPersons().get(ev.operator).friendStatus == FriendRecord.STATUS_FRIEND_MUTUAL)
+                                    if (exm.getPersons().get(ev.operand).friendStatus == FriendRecord.STATUS_FRIEND_MUTUAL)
                                         it.remove();
                                 }
                                 exm.saveConfigure();

File: app/src/main/java/nil/nadph/qnotified/hook/DelDetectorHook.java
Patch:
@@ -21,6 +21,7 @@
 import nil.nadph.qnotified.util.QThemeKit;
 import nil.nadph.qnotified.util.Utils;
 
+import java.io.IOException;
 import java.lang.ref.WeakReference;
 import java.util.HashSet;
 
@@ -133,6 +134,7 @@ protected void afterHookedMethod(MethodHookParam param) throws Throwable {
 						 ret+=(i<fs.length-1?"├":"└")+fs[i].getName()+"="+ClazzExplorer.en_toStr(fs[i].get(param.thisObject))+"\n";
 						 }
 						 log(ret);*/
+                    param.setThrowable(new IOException("Connection closed"));
                 } catch (Throwable e) {
                     log(e);
                     throw e;

File: app/src/main/java/nil/nadph/qnotified/record/FriendRecord.java
Patch:
@@ -72,8 +72,8 @@ public String toString() {
 			sb.append(events[i].timeRangeEnd);
 			sb.append(",event=");
 			sb.append(events[i].event);
-			sb.append(",operator=");
-			sb.append(events[i].operator);
+			sb.append(",operand=");
+			sb.append(events[i].operand);
 			sb.append(",before=");
 			sb.append(en(events[i].before));
 			sb.append(",after=");

File: app/src/main/java/nil/nadph/qnotified/util/Utils.java
Patch:
@@ -53,8 +53,8 @@ private Utils() {
 
     public static boolean DEBUG = true;
     public static boolean V_TOAST = false;
-    public static final String QN_VERSION_NAME = "0.4.0";
-    public static final int QN_VERSION_CODE = 15;
+    public static final String QN_VERSION_NAME = "0.4.1";
+    public static final int QN_VERSION_CODE = 16;
 
     public static final String PACKAGE_NAME_QQ = "com.tencent.mobileqq";
     public static final String PACKAGE_NAME_QQ_INTERNATIONAL = "com.tencent.mobileqqi";

File: app/src/main/java/nil/nadph/qnotified/hook/BaseDelayableHook.java
Patch:
@@ -25,7 +25,8 @@ public static BaseDelayableHook[] queryDelayableHooks() {
                 EmoPicHook.get(),
                 //GalleryBgHook.get(),
                 FavMoreEmo.get(),
-                RevokeMsgHook.get()
+                RevokeMsgHook.get(),
+                FakeVipHook.get()
         };
         return mAllHooks;
     }

File: app/src/main/java/nil/nadph/qnotified/util/Utils.java
Patch:
@@ -49,7 +49,7 @@ private Utils() {
             qn_anti_revoke_msg = "qn_anti_revoke_msg";
 
     public static boolean DEBUG = true;
-    public static boolean V_TOAST = true;
+    public static boolean V_TOAST = false;
     public static final String QN_VERSION_NAME = "0.3.1test";
     public static final int QN_VERSION_CODE = 13;
 

File: app/src/main/java/nil/nadph/qnotified/SyncUtils.java
Patch:
@@ -98,7 +98,7 @@ public static void requestInitHook(int process, int hookId) {
         initId();
         changed.putExtra("process", process);
         changed.putExtra("hook", hookId);
-        log("Tx: ");
+        log("Tx: " + hookId);
         ctx.sendBroadcast(changed);
     }
 

File: app/src/main/java/nil/nadph/qnotified/util/Initiator.java
Patch:
@@ -25,7 +25,7 @@ public static ClassLoader getClassLoader() {
     }
 
     public static Class<?> load(String className) {
-        if (qqClassLoader == null || className.isEmpty()) {
+        if (qqClassLoader == null || className == null ||  className.isEmpty()) {
             return null;
         }
         className = className.replace('/', '.');

File: app/src/main/java/nil/nadph/qnotified/util/Utils.java
Patch:
@@ -49,8 +49,8 @@ private Utils() {
             qn_anti_revoke_msg = "qn_anti_revoke_msg";
 
     public static boolean DEBUG = true;
-    public static boolean V_TOAST = false;
-    public static final String QN_VERSION_NAME = "0.3.1";
+    public static boolean V_TOAST = true;
+    public static final String QN_VERSION_NAME = "0.3.1test";
     public static final int QN_VERSION_CODE = 13;
 
     public static final String PACKAGE_NAME_QQ = "com.tencent.mobileqq";

File: app/src/main/java/nil/nadph/qnotified/QQMainHook.java
Patch:
@@ -251,7 +251,6 @@ protected void beforeHookedMethod(MethodHookParam param) throws Throwable{
         hideMiniAppEntry();
         initCardMsg();
         initPttForward();
-        FlashPicHook.get().init();
     }
 
     private void initMuteAtAllAndRedPacket() {

File: app/src/main/java/nil/nadph/qnotified/ClazzExplorer.java
Patch:
@@ -13,6 +13,7 @@
 import android.widget.RelativeLayout.*;
 import android.text.*;
 import de.robv.android.xposed.*;
+import static nil.nadph.qnotified.Utils.log;
 
 public class ClazzExplorer{
 	public Application app;
@@ -141,7 +142,7 @@ public void onClick(View p1){
 						winMgr.addView(_view,_wlp);
 						refresh();
 					}catch(Throwable e){
-						XposedBridge.log(e);
+						log(e);
 					}
 				}
 			});

File: app/src/main/java/nil/nadph/qnotified/QQViewBuilder.java
Patch:
@@ -13,6 +13,7 @@
 import static android.widget.LinearLayout.LayoutParams.WRAP_CONTENT;
 import static nil.nadph.qnotified.QConst.load;
 
+@SuppressWarnings("unchecked")
 public class QQViewBuilder{
 	/*
 	//L stands for LinearLayout
@@ -68,7 +69,7 @@ public void onClick(View v){
 	}*/
 	
 	
-	@SuppressWarnings("unchecked")
+	
 	public static void listView_setAdapter(View v,ListAdapter adapter){
 		try{
 			Class clazz=v.getClass();

File: app/src/main/java/nil/nadph/qnotified/QThemeKit.java
Patch:
@@ -247,7 +247,7 @@ public static Drawable loadDrawableFromAsset(String name,@Nullable Resources res
 		if((ret=cachedDrawable.get(name))!=null)return ret;
 		try{
 			if(res==null&&mContext!=null)res=mContext.getResources();
-			XposedBridge.log(res+"is not null");
+			log(res+"is not null");
 			InputStream fin=openAsset(name);
 			ret=loadDrawableFromStream(fin,name,res);
 			cachedDrawable.put(name,ret);

